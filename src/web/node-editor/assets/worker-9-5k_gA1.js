(function(){var e=Object.defineProperty,t=t=>{let n={};for(var r in t)e(n,r,{get:t[r],enumerable:!0});return n},n=class{getStyleConfig(){return{}}getInputs(){return this.defineInputs()}getOutputs(){return this.defineOutputs()}getStyle(){return this.getStyleConfig()}getInput(e,t,n){if(e&&Object.prototype.hasOwnProperty.call(e,t))return e[t];let r=this.defineInputs().find(e=>e.name===t);return r&&r.defaultValue!==void 0?r.defaultValue:n}createOutput(e,t,n){let r=this.defineOutputs();if(r.length===1&&!this.isPlainObject(e)){let[i]=r;return{outputs:{[i.name]:e},raw:t??e,summary:n,success:!0}}return{outputs:this.isPlainObject(e)?e:{},raw:t??e,summary:n,success:!0}}createError(e){return{success:!1,error:e instanceof Error?e.message:e,outputs:{}}}validateInputs(e){let t=[],n=this.defineInputs();for(let r of n)if(r.required){let n=e[r.name];(n==null||n===``)&&t.push(`"${r.name}" 是必填项`)}return{valid:t.length===0,errors:t}}getMetadata(){return{type:this.type,label:this.label,description:this.description,category:this.category,inputs:this.defineInputs(),outputs:this.defineOutputs(),style:this.getStyleConfig()}}shouldUseCache(e,t){return!0}getCacheableInputs(e){return e}computeConfigHash(e,t={}){let n=this.getCacheableInputs(e),r={type:this.type,inputs:n};return this.hashObject(r)}hashObject(e){let t=this.stableStringify(e),n=5381;for(let e=0;e<t.length;e++)n=n*33^t.charCodeAt(e);return(n>>>0).toString(16)}stableStringify(e){return e==null?String(e):typeof e==`object`?Array.isArray(e)?`[`+e.map(e=>this.stableStringify(e)).join(`,`)+`]`:`{`+Object.keys(e).sort().map(t=>JSON.stringify(t)+`:`+this.stableStringify(e[t])).join(`,`)+`}`:JSON.stringify(e)}isPlainObject(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}},r=class{constructor(e,t,n,r={}){this.state=`idle`,this.nodeStates=new Map,this.nodeOutputs=new Map,this.startTime=0,this.endTime=0,this.paused=!1,this.cancelled=!1,this.loopVariables=void 0,this.nodeIterationHistories=new Map,this.workflow=e,this.executionId=t,this.workflowCache=n,this.options=r}getExecutionId(){return this.executionId}getWorkflowId(){return this.workflow.workflow_id}getWorkflow(){return this.workflow}getOptions(){return this.options}setState(e){this.state=e}getState(){return this.state}start(){this.state=`running`,this.startTime=Date.now()}complete(){this.state=`completed`,this.endTime=Date.now()}error(){this.state=`error`,this.endTime=Date.now()}pause(){this.paused=!0,this.state=`paused`}resume(){this.paused=!1,this.state=`running`}cancel(){this.cancelled=!0,this.state=`cancelled`,this.endTime=Date.now()}isPaused(){return this.paused}isCancelled(){return this.cancelled}getDuration(){return this.startTime===0?0:(this.endTime||Date.now())-this.startTime}getStartTime(){return this.startTime}getEndTime(){return this.endTime}setNodeState(e,t,n){let r={...this.nodeStates.get(e)||{nodeId:e,status:`pending`},status:t,...n};t===`running`&&!r.startTime&&(r.startTime=Date.now()),(t===`success`||t===`error`||t===`cached`)&&!r.endTime&&(r.endTime=Date.now(),r.startTime&&(r.duration=r.endTime-r.startTime)),this.nodeStates.set(e,r)}getNodeState(e){return this.nodeStates.get(e)}getAllNodeStates(){return new Map(this.nodeStates)}setNodeOutput(e,t){this.nodeOutputs.set(e,t)}getNodeOutput(e){return this.nodeOutputs.get(e)}getNodeInputs(e){let t={},n=this.workflow.edges.filter(t=>t.target===e);for(let e of n){let n=this.nodeOutputs.get(e.source);if(n){let r=e.targetHandle||`default`,i;if(e.sourceHandle&&(i=n[e.sourceHandle]),i===void 0){let e=Object.keys(n).filter(e=>n[e]!==void 0);e.length===1?i=n[e[0]]:n.result===void 0?n.default!==void 0&&(i=n.default):i=n.result}i!=null&&t[r]===void 0&&(t[r]=i)}}return console.log(`[getNodeInputs]`,t),t}setCachedResult(e,t){this.workflowCache.set(e,t)}getCachedResult(e){return this.workflowCache.get(e)??null}clearCache(e){e&&e!==this.workflow.workflow_id||this.workflowCache.clear()}clearAllCache(){this.workflowCache.clear()}getCacheStats(e){e||=this.workflow.workflow_id;let t=this.workflowCache.size,n=this.workflow.nodes.length,r=n>0?t/n:0;return{totalNodes:n,cachedNodes:t,hitRate:r}}hasValidCache(e,t){let n=this.getCachedResult(e);return!n||t&&n.configHash!==t?!1:n.status===`success`}getProgress(){let e=this.workflow.nodes.length;if(e===0)return 1;let t=0;for(let e of this.nodeStates.values())(e.status===`success`||e.status===`error`||e.status===`cached`||e.status===`skipped`)&&t++;return t/e}reset(){this.state=`idle`,this.nodeStates.clear(),this.nodeOutputs.clear(),this.nodeIterationHistories.clear(),this.startTime=0,this.endTime=0,this.paused=!1,this.cancelled=!1}appendIterationResult(e,t){let n=this.nodeIterationHistories.get(e);n||(n={iterations:[],totalIterations:0,currentPage:1},this.nodeIterationHistories.set(e,n)),n.iterations.push(t),n.totalIterations=n.iterations.length;let r=this.nodeStates.get(e);r&&(r.iterationHistory={...n})}getIterationHistory(e){return this.nodeIterationHistories.get(e)}clearIterationHistory(e){this.nodeIterationHistories.delete(e)}clearAllIterationHistories(){this.nodeIterationHistories.clear()}},i=class{extractOutputs(e){let t=e.data;if(!t)return null;if(t.executionResult)return typeof t.executionResult==`object`&&!Array.isArray(t.executionResult)?t.executionResult:{default:t.executionResult};if(t.result?.data?.outputs){let e=t.result.data.outputs,n={};return Object.entries(e).forEach(([e,t])=>{t&&typeof t==`object`&&`value`in t?n[e]=t.value:n[e]=t}),n}return t.result?.data?.raw===void 0?null:{default:t.result.data.raw}}},a=class{constructor(e){this.context=e}extractOutputs(e){return this.context.getNodeOutput(e.id)||null}};function o(e,t,n){let r=new Set,i=[],a=new Map(n.map(e=>[e.id,e])),o=e=>{let n=t.filter(t=>t.target===e);for(let e of n){if(!e.source||r.has(e.source))continue;let t=a.get(e.source);if(!t)continue;let n=t.data?.config?.forNodeId;if(n){if(!a.get(n))continue;r.add(n),i.push(n),o(n);continue}r.add(e.source),i.push(e.source),o(e.source)}};return o(e),i}function s(e,t,n){return e==null?[]:Array.isArray(e)?e.map((e,r)=>{let i=`${t}[${r}]`;n.set(i,e);let a=e!=null&&(Array.isArray(e)||typeof e==`object`);return{id:i,label:`[${r}]`,valueType:l(e),reference:u(i),value:e,children:a?s(e,i,n):[]}}):typeof e==`object`?Object.entries(e).filter(([e])=>e!==`type`).map(([e,r])=>{let i=`${t}.${e}`;n.set(i,r);let a=r!=null&&(Array.isArray(r)||typeof r==`object`);return{id:i,label:e,valueType:l(r),reference:u(i),value:r,children:a?s(r,i,n):[]}}):[]}function c(e,t,n,r){if(t==null)return[];let i=n&&e?`${n}.${e}`:n||e;if(Array.isArray(t))return t.map((e,t)=>{let n=`${i}[${t}]`;r.set(n,e);let a=e!=null&&(Array.isArray(e)||typeof e==`object`);return{id:n,label:`[${t}]`,valueType:l(e),reference:u(n),value:e,children:a?s(e,n,r):[]}});if(typeof t==`object`){let a=Object.entries(t).filter(([e])=>e!==`type`),o=(e,t)=>e.map(([e,n])=>{let i=`${t}.${e}`;r.set(i,n);let a=n!=null&&(Array.isArray(n)||typeof n==`object`);return{id:i,label:e,valueType:l(n),reference:u(i),value:n,children:a?s(n,i,r):[]}});if(!e)return o(a,i);r.set(i,t);let c=o(a,i);return[{id:i,label:e,valueType:`object`,reference:u(i),value:t,children:c,nodeId:n,outputId:e}]}return r.set(i,t),[{id:i,label:e,valueType:l(t),reference:u(i),value:t,children:[],nodeId:n,outputId:e}]}function l(e){return e===null?`null`:e===void 0?`undefined`:Array.isArray(e)?`array`:typeof e}function u(e){return`{{ ${e} }}`}function d(e,t,n,r,a,l){let d=new Map(t.map(e=>[e.id,e])),f=new Map,p=[],m=d.get(e),h=m?.parentNode||m?.data?.parentNode,_=o(e,n,t).reverse(),v=null;if(h){let e=d.get(h);if(e?.type===`forLoopContainer`&&(v=e.data?.config?.forNodeId,!v)){for(let e of t)if(e.type===`for`&&e.data?.config?.containerId===h){v=e.id;break}}}let y=r||new i;if(a&&Object.keys(a).length>0){let e=`全局变量`,t={id:`global-variables`,label:`全局变量`,valueType:`object`,reference:e,value:{},children:[]};Object.entries(a).forEach(([n,r])=>{f.set(`${e}.${n}`,r);let i=c(n,r,e,f);t.children?.push(...i)}),p.push(t)}return _.forEach(e=>{let t=d.get(e);if(!t)return;let n=t.label||t.data?.label||e,r=t.type,i=y.extractOutputs(t);if(r===`for`){let r=t.data?.config||{},i=r.containerId;if(h&&i&&h===i&&v===e){let i={id:e,label:n,valueType:`node`,value:null,children:[],nodeId:e},a=r.itemName||`item`,o=r.indexName||`index`,d,m,h=[],_=!1,v=t.data?.params?.items;if(v!=null){let e=g(v,f);Array.isArray(e)&&(h=e)}l?(d=l[a],m=l[o],_=!0):(d=h.length>0?h[0]:null,m=0);let y=c(a,d,n,f);!_&&y[0]&&(y[0].label=y[0].label+` [示例]`),y[0]&&i.children?.push(y[0]);let b=c(o,m,n,f);!_&&b[0]&&(b[0].label=b[0].label+` [示例]`),b[0]&&i.children?.push(b[0]);let ee=`${n}.list`;f.set(ee,h);let x={id:ee,label:`list`,valueType:`array`,reference:u(ee),value:h,children:h.length>0?s(h,ee,f):[],nodeId:e,outputId:`list`};i.children?.push(x),p.push(i);return}}if(!i||Object.keys(i).length===0)return;let a={id:e,label:n,valueType:`node`,value:null,children:[],nodeId:e};Object.entries(i).forEach(([e,t])=>{if(t===void 0)return;let r=t;if(r&&typeof r==`object`&&!Array.isArray(r)&&`data`in r){let e=r.data,t=r.isError;e&&typeof e==`object`&&(r={...e,...t===void 0?{}:{isError:t}})}let o=Object.keys(i);o.length===1&&o[0]===`default`?f.set(n,r):(f.set(n,r),f.set(`${n}.${e}`,r));let s=c(e,r,n,f);a.children?.push(...s)}),p.push(a)}),{tree:p.reverse(),map:f}}function f(e,t,n,r,i){let o=new a(t);return d(e,n,r,o,i,t.loopVariables)}function p(e,t){let n=JSON.parse(JSON.stringify(e));return m(n,t)}function m(e,t){if(typeof e==`string`)return g(e,t);if(Array.isArray(e))return e.map(e=>m(e,t));if(e&&typeof e==`object`){let n={};return Object.entries(e).forEach(([e,r])=>{n[e]=m(r,t)}),n}return e}let h=/\{\{\s*\$?([^{}]+?)\s*\}\}/g;function g(e,t){let n=[...e.matchAll(h)];if(n.length===0)return e;let r=n[0];if(!r)return e;if(n.length===1&&e.trim()===r[0]){let n=r[1];if(!n)return e;let i=n.trim(),a=t.get(i);return a===void 0?e:a}let i=e;return n.forEach(([e,n])=>{if(!n)return;let r=n.trim();if(!t.has(r))return;let a=t.get(r),o=typeof a==`string`?a:JSON.stringify(a,null,2);i=i.replace(e,o)}),i}var _=class{constructor(e,t){this.defaultOptions={timeout:6e4,maxRetries:3,useCache:!0,clearCache:!1,log:console.log,error:console.error},this.cacheStore=new Map,this.workflowNodeCounts=new Map,this.nodeResolver=e,t&&(this.defaultOptions={...this.defaultOptions,...t}),this.logger={log:this.defaultOptions.log||console.log,error:this.defaultOptions.error||console.error,warn:console.warn}}async execute(e,t){let n={...this.defaultOptions,...t},i=this.generateExecutionId();for(let t of e.nodes)t.data?.forceCacheUsage&&delete t.data.forceCacheUsage;let a=new r(e,i,this.getWorkflowCache(e.workflow_id));this.currentContext=a,this.workflowNodeCounts.set(e.workflow_id,e.nodes.length),n.clearCache&&a.clearCache();try{this.logger.log(`[WorkflowExecutor] 开始执行工作流: ${e.workflow_id}, 执行ID: ${i}`),this.logger.log(`[WorkflowExecutor] 工作流配置: 节点数=${e.nodes.length}, 边数=${e.edges.length}, 选中节点数=${e.selectedNodeIds?.length||0}`),a.start(),n.onProgress?.(0),this.emitExecutionStart(n,{executionId:i,workflowId:e.workflow_id});let t=this.determineStrategy(e);this.logger.log(`[WorkflowExecutor] 执行策略: ${t}`);let r=this.determineNodesToExecute(e,t);this.logger.log(`[WorkflowExecutor] 需要执行的节点数量: ${r.size}`);let o=this.identifyContainerNodes(e.nodes),s=new Set;for(let t of e.nodes){let e=t.parentNode||t.data?.parentNode;e&&typeof e==`string`&&s.add(t.id)}let c=e.nodes.filter(e=>!o.has(e.id)&&!s.has(e.id)),l=e.edges.filter(e=>{let t=!o.has(e.source)&&!s.has(e.source),n=!o.has(e.target)&&!s.has(e.target);return t&&n});this.logger.log(`[WorkflowExecutor] 排除 ${o.size} 个容器节点和 ${s.size} 个子节点后，对 ${c.length} 个顶层节点进行拓扑排序`);let u=this.topologicalSort(c,l);this.logger.log(`[WorkflowExecutor] 拓扑排序完成，执行顺序: ${u.map(e=>e.id).join(` -> `)}`);let d=u.filter(e=>r.has(e.id));this.logger.log(`[WorkflowExecutor] 最终执行顺序: ${d.map(e=>e.id).join(` -> `)}`);for(let t of e.nodes){let e=r.has(t.id)?`pending`:`skipped`;a.setNodeState(t.id,e),e===`skipped`&&(this.logger.log(`[WorkflowExecutor] 跳过节点: ${t.id} (未选中执行)`),n.onNodeSkipped?.(t.id,`not-selected`))}this.logger.log(`[WorkflowExecutor] 开始按顺序执行 ${d.length} 个节点`);for(let e of d){if(this.logger.log(`[WorkflowExecutor] 准备执行节点: ${e.id} (${e.data?.nodeType||e.type})`),a.isPaused()&&(this.logger.log(`[WorkflowExecutor] 执行已暂停，等待恢复...`),await this.waitForResume(a),this.logger.log(`[WorkflowExecutor] 执行已恢复`)),a.isCancelled()){this.logger.log(`[WorkflowExecutor] 执行已取消，停止后续节点执行`);break}await this.executeNode(e,a,n);let t=a.getProgress();this.logger.log(`[WorkflowExecutor] 节点 ${e.id} 执行完成，当前进度: ${t}%`),n.onProgress?.(t)}a.complete(),this.logger.log(`[WorkflowExecutor] 工作流执行完成，执行ID: ${i}`);let f=this.buildExecutionResult(a,t);return this.logger.log(`[WorkflowExecutor] 执行结果: 成功=${f.success}, 执行节点数=${f.executedNodeIds.length}, 跳过节点数=${f.skippedNodeIds.length}, 缓存节点数=${f.cachedNodeIds.length}`),this.emitExecutionComplete(n,f),f}catch(t){a.error();let r=t instanceof Error?t.message:String(t);this.logger.error(`[WorkflowExecutor] 工作流执行失败，执行ID: ${i}, 错误: ${r}`),this.logger.error(t);let o=this.determineStrategy(e),s=this.buildExecutionResult(a,o,r);return this.emitExecutionError(n,{executionId:i,workflowId:e.workflow_id,error:r,result:s}),s}}pause(){this.currentContext?.pause()}resume(){this.currentContext?.resume()}stop(){this.currentContext?.cancel()}getState(){return this.currentContext?.getState()||`idle`}getCachedResult(e,t){return this.cacheStore.get(e)?.get(t)??null}clearCache(e){this.cacheStore.get(e)?.clear(),this.workflowNodeCounts.delete(e)}clearAllCache(){this.cacheStore.clear(),this.workflowNodeCounts.clear()}getCacheStats(e){let t=this.cacheStore.get(e),n=t?t.size:0,r=this.workflowNodeCounts.get(e)??0,i=r>0?n/r:0;return{totalNodes:r,cachedNodes:n,hitRate:i}}determineStrategy(e){let t=e.selectedNodeIds;return!t||t.length===0?`full`:t.length===1?`single`:`selective`}determineNodesToExecute(e,t){let n=new Set;if(t===`full`)return this.findReachableNodesFromStart(e.nodes,e.edges);let r=e.selectedNodeIds||[];for(let t of r)n.add(t),this.findDependencies(t,e.nodes,e.edges).forEach(e=>n.add(e));return n}findReachableNodesFromStart(e,t){let n=e.filter(e=>e.data?.nodeType===`start`||e.type===`start`);if(n.length===0)return this.logger.warn(`[WorkflowExecutor] 工作流中没有找到开始节点，将不执行任何节点`),new Set;n.length>1&&this.logger.warn(`[WorkflowExecutor] 工作流中发现多个开始节点（${n.length}个），将从所有开始节点出发`);let r=new Set,i=n.map(e=>e.id);for(n.forEach(e=>r.add(e.id));i.length>0;){let e=i.shift(),n=t.filter(t=>t.source===e);for(let e of n)r.has(e.target)||(r.add(e.target),i.push(e.target))}let a=e.filter(e=>e.data?.isExecutionStart===!0);if(a.length>0){this.logger.log(`[WorkflowExecutor] 发现 ${a.length} 个标记的执行起点`);for(let n of a){let r=this.findDependencies(n.id,e,t);for(let t of r){let r=e.find(e=>e.id===t);r&&(r.data||={},r.data.forceCacheUsage=!0,this.logger.log(`[WorkflowExecutor] 节点 ${t} 标记为强制使用缓存（${n.id} 的前置依赖）`))}}}return this.logger.log(`[WorkflowExecutor] 从开始节点出发，找到 ${r.size} 个可达节点`),r}findDependencies(e,t,n){let r=new Set,i=new Set,a=e=>{if(i.has(e))return;i.add(e);let t=n.filter(t=>t.target===e);for(let e of t)r.add(e.source),a(e.source)};return a(e),r}shouldSkipNodeDueToInvalidInputs(e,t){let n=t.getWorkflow(),r=n.edges.filter(t=>t.target===e);if(r.length===0)return!1;let i=!1,a=!1,o=!1,s=!1;for(let e of r){let r=n.nodes.find(t=>t.id===e.source);if(!r)continue;let c=r.data?.nodeType||r.type;if(c===`forLoopContainer`){i=!0;break}let l=t.getNodeOutput(e.source);if(!l)continue;let u=e.sourceHandle||`default`,d=l[u];c===`if`?(a=!0,d!=null&&(o=!0)):(d??l)!=null&&(s=!0)}return i?!1:a?!o&&r.length===1:!s}topologicalSort(e,t){let n=new Map,r=new Map;for(let t of e)n.set(t.id,[]),r.set(t.id,0);for(let e of t)n.get(e.source)?.push(e.target),r.set(e.target,(r.get(e.target)||0)+1);let i=[],a=[];for(let[e,t]of r.entries())t===0&&i.push(e);for(;i.length>0;){let e=i.shift();a.push(e);let t=n.get(e)||[];for(let e of t){let t=(r.get(e)||0)-1;r.set(e,t),t===0&&i.push(e)}}if(a.length!==e.length){let t=Error(`工作流中存在循环依赖`);throw this.logger.error(`[WorkflowExecutor] 拓扑排序失败: ${t.message}`),this.logger.error(`[WorkflowExecutor] 节点总数: ${e.length}, 排序后: ${a.length}`),this.logger.error(`[WorkflowExecutor] 未排序的节点: ${e.filter(e=>!a.includes(e.id)).map(e=>e.id).join(`, `)}`),t}return a.map(t=>e.find(e=>e.id===t))}async executeNode(e,t,n){let r=e.id;try{let i=e.data?.nodeType||e.type;if(this.shouldSkipNodeDueToInvalidInputs(r,t)){this.logger.log(`[WorkflowExecutor] 跳过节点 ${r}: 所有输入端口都没有有效数据`),t.setNodeState(r,`skipped`),n.onNodeSkipped?.(r,`no-valid-input`);return}let a=t.getNodeInputs(r);if(this.logger.log(`[WorkflowExecutor] 节点 ${r} (${i}) 初始输入:`,{inputs:Object.keys(a),hasParams:!!e.data?.params}),e.data?.params){this.logger.log(`[WorkflowExecutor] 节点 ${r} 的 params:`,e.data.params);let{map:i}=f(r,t,t.getWorkflow().nodes,t.getWorkflow().edges,n.globalVariables);this.logger.log(`[WorkflowExecutor] 节点 ${r} 变量上下文包含 ${i.size} 个变量`);let o=p(e.data.params,i);this.logger.log(`[WorkflowExecutor] 节点 ${r} 解析后的 params:`,o),Object.assign(a,o),this.logger.log(`[WorkflowExecutor] 节点 ${r} 合并后的 inputs:`,Object.keys(a))}let o=!1,s,c=e.data?.forceCacheUsage===!0;if(c&&this.logger.log(`[WorkflowExecutor] 节点 ${r} 被标记为强制使用缓存（执行起点的前置依赖）`),n.useCache||c){this.logger.log(`[WorkflowExecutor] 节点 ${r} 缓存功能已启用`);let l=this.nodeResolver.resolveInstance(i);if(o=c||l.shouldUseCache(a,{nodeId:r,workflowId:t.getWorkflowId()}),this.logger.log(`[WorkflowExecutor] 节点 ${r} 缓存判断结果: ${o}`),o)if(s=l.computeConfigHash(a,e.data||{}),this.logger.log(`[WorkflowExecutor] 节点 ${r} 配置哈希: ${s}`),t.hasValidCache(r,s)){this.logger.log(`[WorkflowExecutor] 节点 ${r} 使用缓存结果`);let e=t.getCachedResult(r);t.setNodeState(r,`cached`,{outputs:e.outputs,fromCache:!0,duration:e.duration,inputs:e.inputs}),t.setNodeOutput(r,e.outputs),n.onCacheHit?.(r,e);return}else this.logger.log(`[WorkflowExecutor] 节点 ${r} 无有效缓存，将重新执行`)}else this.logger.log(`[WorkflowExecutor] 节点 ${r} 缓存功能已禁用`);this.logger.log(`[WorkflowExecutor] 开始执行节点 ${r} (${i})`),t.setNodeState(r,`running`),n.onNodeStart?.(r);let l=this.nodeResolver.resolve(i),u={nodeId:r,nodeData:e.data,workflowId:t.getWorkflowId()};i===`for`&&(u.executeContainer=async(e,r)=>await this.executeContainerNodes(e,r,t,n)),this.logger.log(`[WorkflowExecutor] 正在调用节点 ${r} 的执行函数`);let d=await this.executeWithTimeout(()=>l(a,u),n.timeout);if(this.logger.log(`[WorkflowExecutor] 节点 ${r} 执行函数调用完成`),d&&typeof d==`object`&&`success`in d&&d.success===!1){let e=d.error||`节点执行失败`;throw this.logger.error(`[WorkflowExecutor] 节点 ${r} 执行失败: ${e}`),Error(e)}let m=d?.outputs??{};if(this.logger.log(`[WorkflowExecutor] 节点 ${r} 输出数据:`,{outputKeys:Object.keys(m),hasOutput:Object.keys(m).length>0}),t.setNodeOutput(r,m),t.setNodeState(r,`success`,{outputs:m,inputs:a}),o&&s){this.logger.log(`[WorkflowExecutor] 缓存节点 ${r} 的执行结果`);let e=t.getNodeState(r);t.setCachedResult(r,{nodeId:r,status:`success`,timestamp:Date.now(),outputs:m,inputs:a,duration:e.duration||0,configHash:s})}this.logger.log(`[WorkflowExecutor] 节点 ${r} 执行成功完成`),n.onNodeComplete?.(r,m)}catch(e){let i=e instanceof Error?e.message:String(e);throw this.logger.error(`[WorkflowExecutor] 节点 ${r} 执行失败: ${i}`),this.logger.error(e),t.setNodeState(r,`error`,{error:i}),n.onNodeError?.(r,e instanceof Error?e:Error(i)),e}}async executeWithTimeout(e,t=6e4){return this.logger.log(`[WorkflowExecutor] 设置执行超时: ${t}ms`),new Promise((n,r)=>{let i=setTimeout(()=>{let e=Error(`执行超时`);this.logger.error(`[WorkflowExecutor] 执行超时: ${t}ms`),r(e)},t);e().then(e=>{clearTimeout(i),this.logger.log(`[WorkflowExecutor] 执行在超时前完成`),n(e)}).catch(e=>{clearTimeout(i),this.logger.error(`[WorkflowExecutor] 执行过程中发生错误:`,e),r(e)})})}async waitForResume(e){return new Promise(t=>{let n=setInterval(()=>{e.isPaused()||(clearInterval(n),t())},100)})}buildExecutionResult(e,t,n){let r=e.getAllNodeStates(),i=[],a=[],o=[];for(let[e,t]of r.entries())t.status===`success`||t.status===`running`||t.status===`error`?i.push(e):t.status===`skipped`?a.push(e):t.status===`cached`&&o.push(e);return{success:e.getState()===`completed`&&!n,executionId:e.getExecutionId(),workflowId:e.getWorkflowId(),startTime:e.getStartTime(),endTime:e.getEndTime(),duration:e.getDuration(),nodeResults:r,executedNodeIds:i,skippedNodeIds:a,cachedNodeIds:o,strategy:t,error:n}}generateExecutionId(){return`exec_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}getWorkflowCache(e){return this.cacheStore.has(e)||this.cacheStore.set(e,new Map),this.cacheStore.get(e)}emitExecutionStart(e,t){e.onExecutionStart?.(t)}emitExecutionComplete(e,t){e.onExecutionComplete?.(t)}emitExecutionError(e,t){e.onExecutionError?.(t)}identifyContainerNodes(e){let t=new Set;for(let n of e){let e=n.parentNode||n.data?.parentNode;e&&typeof e==`string`&&(t.add(e),this.logger.log(`[WorkflowExecutor] 节点 ${n.id} 的父节点是 ${e}（容器节点）`))}return this.logger.log(`[WorkflowExecutor] 识别到 ${t.size} 个容器节点:`,Array.from(t)),t}async executeContainerNodes(e,t,n,r){let i=n.getWorkflow(),a=i.nodes.filter(t=>t.id!==e&&(t.data?.parentNode===e||t.parentNode===e));if(a.length===0)return this.logger.warn(`[WorkflowExecutor] 容器 ${e} 内没有找到任何节点`),null;let o=t.index??0;if(this.logger.log(`[WorkflowExecutor] 容器 ${e} 第 ${o+1} 次迭代，内有 ${a.length} 个节点`),o===0){this.logger.log(`[WorkflowExecutor] 清空容器 ${e} 内 ${a.length} 个节点的迭代历史`);for(let e of a)n.clearIterationHistory(e.id)}for(let e of a)n.setNodeState(e.id,`pending`);let s=new Set(a.map(e=>e.id)),c=i.edges.filter(t=>s.has(t.source)&&s.has(t.target)&&t.source!==e&&t.target!==e);this.logger.log(`[WorkflowExecutor] 容器内有 ${c.length} 条边`);let l=this.topologicalSort(a,c);this.logger.log(`[WorkflowExecutor] 容器内节点执行顺序: ${l.map(e=>e.id).join(` -> `)}`),n.loopVariables=t,this.logger.log(`[WorkflowExecutor] 注入迭代变量:`,Object.keys(t));let u=null;this.logger.log(`[WorkflowExecutor] 开始执行容器 ${e} 内的节点`);for(let e of l){if(this.logger.log(`[WorkflowExecutor] 容器内执行节点: ${e.id}`),n.isCancelled()){this.logger.log(`[WorkflowExecutor] 容器执行已取消`);break}await this.executeNode(e,n,r);let i=n.getNodeOutput(e.id),a=n.getNodeState(e.id);if(a){let s={iterationIndex:o,iterationVars:t,executionResult:i||null,executionStatus:a.status,executionDuration:a.duration,executionTimestamp:Date.now(),executionError:a.error};n.appendIterationResult(e.id,s),r.onIterationUpdate?.(e.id,s),this.logger.log(`[WorkflowExecutor] 保存节点 ${e.id} 第 ${o+1} 次迭代结果:`,{status:a.status,hasOutput:!!i,duration:a.duration})}i&&(u=i)}return n.loopVariables=void 0,this.logger.log(`[WorkflowExecutor] 容器 ${e} 执行完成，恢复原始上下文`),u}},v=class{constructor(e){this.metadataCache=new Map,this.registry=e}getNodeClass(e){let t=this.registry[e];if(!t)throw Error(`未知的节点类型: ${e}`);return t}resolveInstance(e){return new(this.getNodeClass(e))}resolve(e){let t=this.getNodeClass(e);return async(e,n)=>await new t().execute(e,n)}getMetadata(e){if(this.metadataCache.has(e))return this.metadataCache.get(e);let t=new(this.getNodeClass(e)),n=t.getMetadata(),r={type:t.type,label:n.label,description:n.description,inputs:t.getInputs().map(e=>({name:e.name,label:e.description||e.name,type:e.type||`any`,required:e.required})),outputs:t.getOutputs().map(e=>({name:e.name,label:e.description||e.name,type:e.type||`any`})),category:n.category,icon:n.style?.icon};return this.metadataCache.set(e,r),r}getCode(e){try{return new(this.getNodeClass(e))().execute.toString()}catch(t){console.error(`获取节点代码失败 [${e}]:`,t);return}}hasNode(e){return e in this.registry}getAllTypes(){return Object.keys(this.registry)}clearCache(){this.metadataCache.clear()}};function y(e){return new v(e)}var b=typeof global==`object`&&global&&global.Object===Object&&global,ee=typeof self==`object`&&self&&self.Object===Object&&self,x=b||ee||Function(`return this`)(),S=x.Symbol,C=Object.prototype,te=C.hasOwnProperty,ne=C.toString,re=S?S.toStringTag:void 0;function ie(e){var t=te.call(e,re),n=e[re];try{e[re]=void 0;var r=!0}catch{}var i=ne.call(e);return r&&(t?e[re]=n:delete e[re]),i}var ae=ie,oe=Object.prototype.toString;function se(e){return oe.call(e)}var ce=se,le=`[object Null]`,ue=`[object Undefined]`,de=S?S.toStringTag:void 0;function fe(e){return e==null?e===void 0?ue:le:de&&de in Object(e)?ae(e):ce(e)}var pe=fe;function me(e){return typeof e==`object`&&!!e}var he=me,ge=Array.isArray;function _e(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)}var ve=_e,ye=`[object AsyncFunction]`,be=`[object Function]`,xe=`[object GeneratorFunction]`,Se=`[object Proxy]`;function Ce(e){if(!ve(e))return!1;var t=pe(e);return t==be||t==xe||t==ye||t==Se}var we=Ce,Te=x[`__core-js_shared__`],Ee=function(){var e=/[^.]+$/.exec(Te&&Te.keys&&Te.keys.IE_PROTO||``);return e?`Symbol(src)_1.`+e:``}();function De(e){return!!Ee&&Ee in e}var Oe=De,ke=Function.prototype.toString;function Ae(e){if(e!=null){try{return ke.call(e)}catch{}try{return e+``}catch{}}return``}var je=Ae,Me=/[\\^$.*+?()[\]{}|]/g,Ne=/^\[object .+?Constructor\]$/,Pe=Function.prototype,Fe=Object.prototype,Ie=Pe.toString,Le=Fe.hasOwnProperty,Re=RegExp(`^`+Ie.call(Le).replace(Me,`\\$&`).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,`$1.*?`)+`$`);function ze(e){return!ve(e)||Oe(e)?!1:(we(e)?Re:Ne).test(je(e))}var Be=ze;function Ve(e,t){return e?.[t]}var He=Ve;function Ue(e,t){var n=He(e,t);return Be(n)?n:void 0}var We=Ue,Ge=We(x,`WeakMap`),Ke=9007199254740991,qe=/^(?:0|[1-9]\d*)$/;function Je(e,t){var n=typeof e;return t??=Ke,!!t&&(n==`number`||n!=`symbol`&&qe.test(e))&&e>-1&&e%1==0&&e<t}var Ye=Je;function Xe(e,t){return e===t||e!==e&&t!==t}var Ze=Xe,Qe=9007199254740991;function $e(e){return typeof e==`number`&&e>-1&&e%1==0&&e<=Qe}var et=$e;function tt(e){return e!=null&&et(e.length)&&!we(e)}var nt=tt,rt=Object.prototype;function it(e){var t=e&&e.constructor,n=typeof t==`function`&&t.prototype||rt;return e===n}var at=it;function ot(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var st=ot,ct=`[object Arguments]`;function lt(e){return he(e)&&pe(e)==ct}var ut=lt,dt=Object.prototype,ft=dt.hasOwnProperty,pt=dt.propertyIsEnumerable,mt=ut(function(){return arguments}())?ut:function(e){return he(e)&&ft.call(e,`callee`)&&!pt.call(e,`callee`)};function ht(){return!1}var gt=ht,_t=typeof exports==`object`&&exports&&!exports.nodeType&&exports,vt=_t&&typeof module==`object`&&module&&!module.nodeType&&module,yt=vt&&vt.exports===_t?x.Buffer:void 0,bt=(yt?yt.isBuffer:void 0)||gt,xt=`[object Arguments]`,St=`[object Array]`,Ct=`[object Boolean]`,wt=`[object Date]`,Tt=`[object Error]`,Et=`[object Function]`,Dt=`[object Map]`,Ot=`[object Number]`,kt=`[object Object]`,At=`[object RegExp]`,jt=`[object Set]`,Mt=`[object String]`,Nt=`[object WeakMap]`,Pt=`[object ArrayBuffer]`,Ft=`[object DataView]`,It=`[object Float32Array]`,Lt=`[object Float64Array]`,Rt=`[object Int8Array]`,zt=`[object Int16Array]`,Bt=`[object Int32Array]`,Vt=`[object Uint8Array]`,Ht=`[object Uint8ClampedArray]`,Ut=`[object Uint16Array]`,Wt=`[object Uint32Array]`,w={};w[It]=w[Lt]=w[Rt]=w[zt]=w[Bt]=w[Vt]=w[Ht]=w[Ut]=w[Wt]=!0,w[xt]=w[St]=w[Pt]=w[Ct]=w[Ft]=w[wt]=w[Tt]=w[Et]=w[Dt]=w[Ot]=w[kt]=w[At]=w[jt]=w[Mt]=w[Nt]=!1;function Gt(e){return he(e)&&et(e.length)&&!!w[pe(e)]}var Kt=Gt;function qt(e){return function(t){return e(t)}}var Jt=qt,Yt=typeof exports==`object`&&exports&&!exports.nodeType&&exports,Xt=Yt&&typeof module==`object`&&module&&!module.nodeType&&module,Zt=Xt&&Xt.exports===Yt&&b.process,Qt=function(){try{return Xt&&Xt.require&&Xt.require(`util`).types||Zt&&Zt.binding&&Zt.binding(`util`)}catch{}}(),$t=Qt&&Qt.isTypedArray,en=$t?Jt($t):Kt,tn=Object.prototype.hasOwnProperty;function nn(e,t){var n=ge(e),r=!n&&mt(e),i=!n&&!r&&bt(e),a=!n&&!r&&!i&&en(e),o=n||r||i||a,s=o?st(e.length,String):[],c=s.length;for(var l in e)(t||tn.call(e,l))&&!(o&&(l==`length`||i&&(l==`offset`||l==`parent`)||a&&(l==`buffer`||l==`byteLength`||l==`byteOffset`)||Ye(l,c)))&&s.push(l);return s}var rn=nn;function an(e,t){return function(n){return e(t(n))}}var on=an(Object.keys,Object),sn=Object.prototype.hasOwnProperty;function cn(e){if(!at(e))return on(e);var t=[];for(var n in Object(e))sn.call(e,n)&&n!=`constructor`&&t.push(n);return t}var ln=cn;function un(e){return nt(e)?rn(e):ln(e)}var dn=un,fn=We(Object,`create`);function pn(){this.__data__=fn?fn(null):{},this.size=0}var mn=pn;function hn(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var gn=hn,_n=`__lodash_hash_undefined__`,vn=Object.prototype.hasOwnProperty;function yn(e){var t=this.__data__;if(fn){var n=t[e];return n===_n?void 0:n}return vn.call(t,e)?t[e]:void 0}var bn=yn,xn=Object.prototype.hasOwnProperty;function Sn(e){var t=this.__data__;return fn?t[e]!==void 0:xn.call(t,e)}var Cn=Sn,wn=`__lodash_hash_undefined__`;function Tn(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=fn&&t===void 0?wn:t,this}var En=Tn;function Dn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Dn.prototype.clear=mn,Dn.prototype.delete=gn,Dn.prototype.get=bn,Dn.prototype.has=Cn,Dn.prototype.set=En;var On=Dn;function kn(){this.__data__=[],this.size=0}var An=kn;function jn(e,t){for(var n=e.length;n--;)if(Ze(e[n][0],t))return n;return-1}var Mn=jn,Nn=Array.prototype.splice;function Pn(e){var t=this.__data__,n=Mn(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Nn.call(t,n,1),--this.size,!0}var Fn=Pn;function In(e){var t=this.__data__,n=Mn(t,e);return n<0?void 0:t[n][1]}var Ln=In;function Rn(e){return Mn(this.__data__,e)>-1}var zn=Rn;function Bn(e,t){var n=this.__data__,r=Mn(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var Vn=Bn;function Hn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Hn.prototype.clear=An,Hn.prototype.delete=Fn,Hn.prototype.get=Ln,Hn.prototype.has=zn,Hn.prototype.set=Vn;var Un=Hn,Wn=We(x,`Map`);function Gn(){this.size=0,this.__data__={hash:new On,map:new(Wn||Un),string:new On}}var Kn=Gn;function qn(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null}var Jn=qn;function Yn(e,t){var n=e.__data__;return Jn(t)?n[typeof t==`string`?`string`:`hash`]:n.map}var Xn=Yn;function Zn(e){var t=Xn(this,e).delete(e);return this.size-=t?1:0,t}var Qn=Zn;function $n(e){return Xn(this,e).get(e)}var er=$n;function tr(e){return Xn(this,e).has(e)}var nr=tr;function rr(e,t){var n=Xn(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var ir=rr;function ar(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ar.prototype.clear=Kn,ar.prototype.delete=Qn,ar.prototype.get=er,ar.prototype.has=nr,ar.prototype.set=ir;var or=ar;function sr(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var cr=sr;function lr(){this.__data__=new Un,this.size=0}var ur=lr;function dr(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var fr=dr;function pr(e){return this.__data__.get(e)}var mr=pr;function hr(e){return this.__data__.has(e)}var gr=hr,_r=200;function vr(e,t){var n=this.__data__;if(n instanceof Un){var r=n.__data__;if(!Wn||r.length<_r-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new or(r)}return n.set(e,t),this.size=n.size,this}var yr=vr;function br(e){this.size=(this.__data__=new Un(e)).size}br.prototype.clear=ur,br.prototype.delete=fr,br.prototype.get=mr,br.prototype.has=gr,br.prototype.set=yr;var xr=br;function Sr(e,t){for(var n=-1,r=e==null?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}var Cr=Sr;function wr(){return[]}var Tr=wr,Er=Object.prototype.propertyIsEnumerable,Dr=Object.getOwnPropertySymbols,Or=Dr?function(e){return e==null?[]:(e=Object(e),Cr(Dr(e),function(t){return Er.call(e,t)}))}:Tr;function kr(e,t,n){var r=t(e);return ge(e)?r:cr(r,n(e))}var Ar=kr;function jr(e){return Ar(e,dn,Or)}var Mr=jr,Nr=We(x,`DataView`),Pr=We(x,`Promise`),Fr=We(x,`Set`),Ir=`[object Map]`,Lr=`[object Object]`,Rr=`[object Promise]`,zr=`[object Set]`,Br=`[object WeakMap]`,Vr=`[object DataView]`,Hr=je(Nr),Ur=je(Wn),Wr=je(Pr),Gr=je(Fr),Kr=je(Ge),qr=pe;(Nr&&qr(new Nr(new ArrayBuffer(1)))!=Vr||Wn&&qr(new Wn)!=Ir||Pr&&qr(Pr.resolve())!=Rr||Fr&&qr(new Fr)!=zr||Ge&&qr(new Ge)!=Br)&&(qr=function(e){var t=pe(e),n=t==Lr?e.constructor:void 0,r=n?je(n):``;if(r)switch(r){case Hr:return Vr;case Ur:return Ir;case Wr:return Rr;case Gr:return zr;case Kr:return Br}return t});var Jr=qr,Yr=x.Uint8Array,Xr=`__lodash_hash_undefined__`;function Zr(e){return this.__data__.set(e,Xr),this}var Qr=Zr;function $r(e){return this.__data__.has(e)}var ei=$r;function ti(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new or;++t<n;)this.add(e[t])}ti.prototype.add=ti.prototype.push=Qr,ti.prototype.has=ei;var ni=ti;function ri(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var ii=ri;function ai(e,t){return e.has(t)}var oi=ai,si=1,ci=2;function li(e,t,n,r,i,a){var o=n&si,s=e.length,c=t.length;if(s!=c&&!(o&&c>s))return!1;var l=a.get(e),u=a.get(t);if(l&&u)return l==t&&u==e;var d=-1,f=!0,p=n&ci?new ni:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var m=e[d],h=t[d];if(r)var g=o?r(h,m,d,t,e,a):r(m,h,d,e,t,a);if(g!==void 0){if(g)continue;f=!1;break}if(p){if(!ii(t,function(e,t){if(!oi(p,t)&&(m===e||i(m,e,n,r,a)))return p.push(t)})){f=!1;break}}else if(!(m===h||i(m,h,n,r,a))){f=!1;break}}return a.delete(e),a.delete(t),f}var ui=li;function di(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}var fi=di;function pi(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var mi=pi,hi=1,gi=2,_i=`[object Boolean]`,vi=`[object Date]`,yi=`[object Error]`,bi=`[object Map]`,xi=`[object Number]`,Si=`[object RegExp]`,Ci=`[object Set]`,wi=`[object String]`,Ti=`[object Symbol]`,Ei=`[object ArrayBuffer]`,Di=`[object DataView]`,Oi=S?S.prototype:void 0,ki=Oi?Oi.valueOf:void 0;function Ai(e,t,n,r,i,a,o){switch(n){case Di:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ei:return!(e.byteLength!=t.byteLength||!a(new Yr(e),new Yr(t)));case _i:case vi:case xi:return Ze(+e,+t);case yi:return e.name==t.name&&e.message==t.message;case Si:case wi:return e==t+``;case bi:var s=fi;case Ci:var c=r&hi;if(s||=mi,e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=gi,o.set(e,t);var u=ui(s(e),s(t),r,i,a,o);return o.delete(e),u;case Ti:if(ki)return ki.call(e)==ki.call(t)}return!1}var ji=Ai,Mi=1,Ni=Object.prototype.hasOwnProperty;function Pi(e,t,n,r,i,a){var o=n&Mi,s=Mr(e),c=s.length,l=Mr(t).length;if(c!=l&&!o)return!1;for(var u=c;u--;){var d=s[u];if(!(o?d in t:Ni.call(t,d)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var m=!0;a.set(e,t),a.set(t,e);for(var h=o;++u<c;){d=s[u];var g=e[d],_=t[d];if(r)var v=o?r(_,g,d,t,e,a):r(g,_,d,e,t,a);if(!(v===void 0?g===_||i(g,_,n,r,a):v)){m=!1;break}h||=d==`constructor`}if(m&&!h){var y=e.constructor,b=t.constructor;y!=b&&`constructor`in e&&`constructor`in t&&!(typeof y==`function`&&y instanceof y&&typeof b==`function`&&b instanceof b)&&(m=!1)}return a.delete(e),a.delete(t),m}var Fi=Pi,Ii=1,Li=`[object Arguments]`,Ri=`[object Array]`,zi=`[object Object]`,Bi=Object.prototype.hasOwnProperty;function Vi(e,t,n,r,i,a){var o=ge(e),s=ge(t),c=o?Ri:Jr(e),l=s?Ri:Jr(t);c=c==Li?zi:c,l=l==Li?zi:l;var u=c==zi,d=l==zi,f=c==l;if(f&&bt(e)){if(!bt(t))return!1;o=!0,u=!1}if(f&&!u)return a||=new xr,o||en(e)?ui(e,t,n,r,i,a):ji(e,t,c,n,r,i,a);if(!(n&Ii)){var p=u&&Bi.call(e,`__wrapped__`),m=d&&Bi.call(t,`__wrapped__`);if(p||m){var h=p?e.value():e,g=m?t.value():t;return a||=new xr,i(h,g,n,r,a)}}return f?(a||=new xr,Fi(e,t,n,r,i,a)):!1}var Hi=Vi;function Ui(e,t,n,r,i){return e===t?!0:e==null||t==null||!he(e)&&!he(t)?e!==e&&t!==t:Hi(e,t,n,r,Ui,i)}var Wi=Ui;function Gi(e,t){return Wi(e,t)}var Ki=Gi,qi=t({DATA_TYPE_LABELS:()=>Yi,IfNode:()=>Zi,OPERATORS_BY_TYPE:()=>Xi,OPERATOR_LABELS:()=>Ji});let Ji={"is equal to":`等于`,"is not equal to":`不等于`,exists:`存在`,"does not exist":`不存在`,"is empty":`为空`,"is not empty":`不为空`,contains:`包含`,"does not contain":`不包含`,"starts with":`开头为`,"ends with":`结尾为`,"is greater than":`大于`,"is less than":`小于`,"is greater than or equal to":`大于等于`,"is less than or equal to":`小于等于`,"is true":`为真`,"is false":`为假`,"is before":`早于`,"is after":`晚于`,"is before or equal to":`早于或等于`,"is after or equal to":`晚于或等于`,"length equal to":`长度等于`,"length not equal to":`长度不等于`,"length greater than":`长度大于`,"length less than":`长度小于`,"length greater than or equal to":`长度大于等于`,"length less than or equal to":`长度小于等于`},Yi={string:`字符串`,number:`数字`,date:`日期`,boolean:`布尔值`,array:`数组`,object:`对象`},Xi={string:[`is equal to`,`is not equal to`,`contains`,`does not contain`,`starts with`,`ends with`,`exists`,`does not exist`,`is empty`,`is not empty`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],number:[`is equal to`,`is not equal to`,`is greater than`,`is less than`,`is greater than or equal to`,`is less than or equal to`,`exists`,`does not exist`],date:[`is equal to`,`is not equal to`,`is before`,`is after`,`is before or equal to`,`is after or equal to`,`exists`,`does not exist`],boolean:[`is equal to`,`is not equal to`,`is true`,`is false`,`exists`,`does not exist`],array:[`exists`,`does not exist`,`is empty`,`is not empty`,`contains`,`does not contain`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],object:[`exists`,`does not exist`,`is empty`,`is not empty`]};var Zi=class extends n{constructor(...e){super(...e),this.type=`if`,this.label=`条件判断`,this.description=`根据条件判断执行不同的分支`,this.category=`流程控制`,this.currentConfig=null}defineInputs(){return[{name:`config`,type:`object`,description:`条件配置`,defaultValue:this.getDefaultConfig(),required:!1}]}defineOutputs(){return this.currentConfig?this.getOutputsForConfig(this.currentConfig):this.getOutputsForConfig(this.getDefaultConfig())}getOutputsForConfig(e){let t=e.conditions||[],n=Math.max(t.length,1),r=[];for(let e=0;e<n;e++){let n=t[e];r.push({name:this.getConditionOutputId(e),type:`any`,description:n?this.describeCondition(n):`未配置条件`})}return r.push({name:`else`,type:`any`,description:`所有条件都不满足时执行`}),r}updateConfig(e){this.currentConfig=e}getDefaultConfig(){return{conditions:[{logic:`and`,subConditions:[{field:``,dataType:`string`,operator:`is equal to`,value:``}]}]}}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`question`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`config`,this.getDefaultConfig());this.updateConfig(t);let n=Array.isArray(t.conditions)?t.conditions:[];console.log(`[IfNode] 开始评估条件，条件数量:`,n.length),console.log(`[IfNode] 原始条件配置:`,JSON.stringify(n,null,2));let r=n.map((e,t)=>{console.log(`\n[IfNode] 评估条件 ${t+1}:`,{logic:e.logic,subConditionsCount:e.subConditions.length});let n=e.subConditions.map((e,t)=>{console.log(`  [IfNode] 子条件 ${t+1} - 原始值:`,{field:e.field,value:e.value,operator:e.operator,dataType:e.dataType});let n=this.resolveOperandValue(e.field,e.dataType),r=this.resolveOperandValue(e.value,e.dataType);if(console.log(`  [IfNode] 子条件 ${t+1} - 解析后的值:`,{actualValue:n,targetValue:r,actualType:typeof n,targetType:typeof r}),this.isEmptyCondition(e.field,e.value,e.operator))return console.log(`  [IfNode] 子条件 ${t+1} - 未配置（左右值都为空），返回 false`),{...e,actualValue:n,targetValue:r,result:!1};let i=this.compareValues(n,r,e.operator,e.dataType);return console.log(`  [IfNode] 子条件 ${t+1} - 比较结果:`,i),{...e,actualValue:n,targetValue:r,result:i}}),r=e.logic===`or`?n.some(e=>e.result):n.every(e=>e.result);return console.log(`[IfNode] 条件 ${t+1} 最终结果:`,{logic:e.logic,subResults:n.map(e=>e.result),conditionResult:r}),{index:t,outputId:this.getConditionOutputId(t),logic:e.logic,subResults:n,result:r}}),i=r.findIndex(e=>e.result),a=i!==-1;console.log(`
[IfNode] 条件评估汇总:`,{totalConditions:r.length,firstPassedIndex:i,anyPassed:a,allResults:r.map((e,t)=>({index:t,outputId:e.outputId,result:e.result}))});let o={};r.forEach((e,t)=>{o[e.outputId]=t===i?{branch:e.outputId,passed:!0,evaluation:e,allEvaluations:r}:void 0}),o.else=a?void 0:{branch:`else`,passed:!1,allEvaluations:r};let s=i===-1?null:r[i];return console.log(`[IfNode] 最终输出端口:`,{selectedBranch:s?s.outputId:`else`,outputKeys:Object.keys(o),outputsWithData:Object.entries(o).filter(([e,t])=>t!==void 0).map(([e])=>e)}),this.createOutput(o,{branch:s?s.outputId:`else`,passed:a,evaluations:r},s?`条件${i+1}满足`:`所有条件都不满足，执行 else`)}catch(e){return this.createError(e)}}getConditionOutputId(e){return`condition-${e}`}describeCondition(e){let{logic:t,subConditions:n}=e;if(!n||n.length===0)return`未配置子条件`;if(n.length===1)return this.describeSubCondition(n[0]);let r=t===`and`?` 且 `:` 或 `,i=n.map(e=>this.describeSubCondition(e)).join(r);return i.length>60?i.slice(0,57)+`...`:i}describeSubCondition(e){if(!e)return`未配置`;let t=this.formatOperand(e.field,`输入值`),n=Ji[e.operator]||e.operator;if([`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(e.operator))return`${t} ${n}`;let r=this.truncateValue(e.value,20,`''`);return`${t} ${n} ${r}`}truncateValue(e,t=48,n=``){let r=this.formatOperand(e,n);return r?r.length<=t?r:`${r.slice(0,t-1)}…`:n}formatOperand(e,t=``){if(e==null)return t;if(typeof e==`string`){let n=e.trim();return n.length>0?n:t}if(typeof e==`number`||typeof e==`boolean`)return String(e);if(e instanceof Date)return e.toISOString();try{return JSON.stringify(e)}catch{return String(e)}}isEmptyCondition(e,t,n){return[`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(n)?this.isOperandEmpty(e):this.isOperandEmpty(e)&&this.isOperandEmpty(t)}isOperandEmpty(e){return e==null?!0:typeof e==`string`?e.trim()===``:!1}resolveOperandValue(e,t){return e==null?e:this.coerceValueByType(e,t)}coerceValueByType(e,t){if(e==null)return e;switch(t){case`number`:{if(typeof e==`number`)return e;if(typeof e==`boolean`)return e?1:0;if(typeof e==`string`){let t=Number(e);return Number.isNaN(t)?e:t}let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`number`)return e!==0;if(typeof e==`string`){let t=e.toLowerCase();if([`true`,`1`,`yes`].includes(t))return!0;if([`false`,`0`,`no`].includes(t))return!1}return!!e;case`date`:if(e instanceof Date)return e;if(typeof e==`number`)return new Date(e);if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?e:t}return e;case`array`:if(Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return[];try{let n=JSON.parse(t);return Array.isArray(n)?n:e}catch{return e}}return e;case`object`:if(e&&typeof e==`object`&&!Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return{};try{let n=JSON.parse(t);return n&&typeof n==`object`?n:e}catch{return e}}return e;default:return typeof e==`string`?e:String(e)}}compareValues(e,t,n,r){console.log(`    [IfNode.compareValues] 比较参数:`,{actual:e,target:t,operator:n,dataType:r,actualType:typeof e,targetType:typeof t});let i;switch(n){case`is equal to`:return i=this.compareEquality(e,t,r),console.log(`    [IfNode.compareValues] is equal to 结果:`,i),i;case`is not equal to`:return!this.compareEquality(e,t,r);case`exists`:return e!=null;case`does not exist`:return e==null;case`is empty`:return e==null?!0:typeof e==`string`?e.trim().length===0:Array.isArray(e)?e.length===0:typeof e==`object`?Object.keys(e).length===0:!1;case`is not empty`:return e==null?!1:typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:typeof e==`object`?Object.keys(e).length>0:!0;case`contains`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?e.includes(t):!1;case`does not contain`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?!e.includes(t):!0;case`starts with`:return typeof e==`string`&&typeof t==`string`?e.startsWith(t):!1;case`ends with`:return typeof e==`string`&&typeof t==`string`?e.endsWith(t):!1;case`is greater than`:return Number(e)>Number(t);case`is less than`:return Number(e)<Number(t);case`is greater than or equal to`:return Number(e)>=Number(t);case`is less than or equal to`:return Number(e)<=Number(t);case`is true`:return e===!0;case`is false`:return e===!1;case`is before`:return new Date(e)<new Date(t);case`is after`:return new Date(e)>new Date(t);case`is before or equal to`:return new Date(e)<=new Date(t);case`is after or equal to`:return new Date(e)>=new Date(t);case`length equal to`:return this.getLength(e)===Number(t);case`length not equal to`:return this.getLength(e)!==Number(t);case`length greater than`:return this.getLength(e)>Number(t);case`length less than`:return this.getLength(e)<Number(t);case`length greater than or equal to`:return this.getLength(e)>=Number(t);case`length less than or equal to`:return this.getLength(e)<=Number(t);default:return!1}}getLength(e){return typeof e==`string`||Array.isArray(e)?e.length:typeof e==`object`&&e?Object.keys(e).length:0}compareEquality(e,t,n){let r=this.normalizeEqualityValue(e,n),i=this.normalizeEqualityValue(t,n);return n===`array`||n===`object`?Ki(r,i):r===i}normalizeEqualityValue(e,t){if(e==null)return e;switch(t){case`number`:{let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`string`){let t=e.trim().toLowerCase();if(t===`true`||t===`1`)return!0;if(t===`false`||t===`0`)return!1}return typeof e==`number`?e===1:!!e;case`date`:{let t=e instanceof Date?e.getTime():new Date(e).getTime();return Number.isNaN(t)?e:t}case`string`:return String(e);default:return e}}},Qi=t({CodeNode:()=>ea});let $i=/^[A-Za-z][A-Za-z0-9_]*$/;var ea=class extends n{constructor(...e){super(...e),this.type=`code`,this.label=`代码执行`,this.description=`执行自定义 TypeScript/JavaScript 代码`,this.category=`数据处理`}defineInputs(){return[{name:`dataItems`,type:`array`,description:`参数对象（如提供则覆盖由 dataItems 构建的参数）`,required:!1},{name:`code`,type:`string`,description:`动态代码（如提供则覆盖配置中的 code）`,required:!1}]}defineOutputs(){return[{name:`result`,type:`any`,description:`执行结果`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`code`,showIcon:!0}}getDefaultConfig(){return{code:`export async function main(params) {
  return {
    receivedKeys: Object.keys(params),
    example: params,
  };
}`,dataItems:[]}}shouldUseCache(e,t){return!1}async execute(e,t){try{let t=this.getDefaultConfig(),n=this.getInput(e,`code`,``),r=typeof n==`string`&&n.trim()?n:void 0,i=this.getInput(e,`dataItems`,null),a=Array.isArray(i),o=i&&typeof i==`object`&&!a?i:void 0,s=r??t.code,c=o??this.buildParams(a?i:t.dataItems),l=this.prepareRuntime(s);try{let e=Function(`params`,l)(c),t=e instanceof Promise?await e:e,n={result:t};return this.createOutput(n,t,this.buildSummary(t,Object.keys(c)))}catch(e){throw Error(`代码执行错误: ${e?.message??e}`)}}catch(e){return this.createError(e)}}buildParams(e){let t={},n=new Set;return e.forEach((e,r)=>{let i=(e?.key??``).trim();if(!i){console.error(`第 ${r+1} 项的键名不能为空`);return}if(!$i.test(i)){console.error(`第 ${r+1} 项的键名 "${i}" 无效：仅支持以字母开头，由字母、数字或下划线组成`);return}if(n.has(i)){console.error(`检测到重复的键名 "${i}"，请确保唯一`);return}n.add(i),t[i]=e?.value}),t}prepareRuntime(e){return`"use strict";
${this.normalizeExports(e)}

if (typeof main !== "function") {
  throw new Error("main 函数未定义，请确保导出 export function main(params) {}");
}

const result = main(params);
return result;`}normalizeExports(e){let t=e;return[[/export\s+default\s+async\s+function\s+main/g,`async function main`],[/export\s+default\s+function\s+main/g,`function main`],[/export\s+async\s+function\s+main/g,`async function main`],[/export\s+function\s+main/g,`function main`],[/export\s+default\s+main\s*;?/g,``],[/export\s+{\s*main\s+as\s+default\s*};?/g,``],[/export\s+const\s+main\s*=\s*/g,`const main = `],[/export\s+let\s+main\s*=\s*/g,`let main = `],[/export\s+var\s+main\s*=\s*/g,`var main = `]].forEach(([e,n])=>{t=t.replace(e,n)}),t}buildSummary(e,t){let n=t.length>0?t.join(`, `):`无`,r=this.formatValue(e);return`main(params) 执行完成 | 参数键: [${n}] | 结果: ${r}`}formatValue(e){if(e===null)return`null`;if(e===void 0)return`undefined`;if(typeof e==`string`)return e.length>40?`"${e.slice(0,37)}..."`:`"${e}"`;if(typeof e==`number`||typeof e==`boolean`)return String(e);if(Array.isArray(e))return`Array(${e.length})`;if(typeof e==`object`){let t=Object.keys(e);if(t.length===0)return`{}`;let n=t.slice(0,3).join(`, `),r=t.length>3?`, ...`:``;return`{ ${n}${r} }`}return String(e)}},ta=t({ConnectorNode:()=>na}),na=class extends n{constructor(...e){super(...e),this.type=`connector`,this.label=`连接`,this.description=`用于优化连接线布局，执行时返回 undefined`,this.category=`工具`}defineInputs(){return[]}defineOutputs(){return[{name:`output`,type:`any`,description:`输出数据（undefined）`}]}getStyleConfig(){return{}}async execute(e,t){return this.createOutput({output:void 0},void 0,`连接节点：已返回 undefined`)}},ra=t({DataPreviewNode:()=>ia}),ia=class extends n{constructor(...e){super(...e),this.type=`dataPreview`,this.label=`数据预览`,this.description=`预览任意数据，支持查看各种数据类型的输出结果`,this.category=`工具`}defineInputs(){return[{name:`data`,type:`any`,description:`要预览的数据`,required:!1}]}defineOutputs(){return[{name:`data`,type:`any`,description:`输出的数据（与输入相同）`}]}getStyleConfig(){return{headerColor:[`#06b6d4`,`#0891b2`],icon:`eye`,showIcon:!0,bodyStyle:{minWidth:`300px`,minHeight:`200px`}}}async execute(e,t){try{let t=this.getInput(e,`data`,void 0);if(t!=null){let e=Array.isArray(t)?`数组`:typeof t;typeof t==`string`&&t.length>0||Array.isArray(t)?`${t.length}`:typeof t==`object`?`${Object.keys(t).length}`:`${e}${String(t)}`}return this.createOutput({data:t})}catch(e){return this.createError(e)}}},aa=t({DelayNode:()=>oa}),oa=class extends n{constructor(...e){super(...e),this.type=`delay`,this.label=`延迟`,this.description=`暂停工作流执行指定的时间`,this.category=`流程控制`}defineInputs(){return[{name:`delay`,type:`number`,description:`延迟时间（毫秒）`,required:!0,defaultValue:1e3}]}defineOutputs(){return[{name:`output`,type:`any`,description:`延迟后输出的数据`}]}getStyleConfig(){return{headerColor:[`#f59e0b`,`#d97706`],icon:`clock`,showIcon:!0}}shouldUseCache(e,t){return!1}async execute(e,t){try{let n=this.getInput(e,`delay`,1e3);return console.log(`DelayNode execute`,n),typeof n!=`number`||n<0?this.createError(`延迟时间必须是非负数`):n===0?this.createOutput({output:void 0}):(await this.sleep(n,t.signal),this.createOutput({output:void 0},void 0,`延迟 ${n}ms 完成`))}catch(e){return e instanceof Error&&e.name===`AbortError`?this.createError(`延迟被取消`):this.createError(e)}}sleep(e,t){return new Promise((n,r)=>{if(t?.aborted){let e=Error(`延迟被取消`);e.name=`AbortError`,r(e);return}let i=setTimeout(()=>{o(),n()},e),a=()=>{o();let e=Error(`延迟被取消`);e.name=`AbortError`,r(e)},o=()=>{clearTimeout(i),t?.removeEventListener(`abort`,a)};t?.addEventListener(`abort`,a)})}},sa=t({EndNode:()=>ca}),ca=class extends n{constructor(...e){super(...e),this.type=`end`,this.label=`结束`,this.description=`工作流程的结束节点`,this.category=`流程控制`}defineInputs(){return[{name:`input`,type:`any`,description:`接收任意输入`,required:!1}]}defineOutputs(){return[]}getStyleConfig(){return{headerColor:[`#ef4444`,`#dc2626`],icon:`stop`,showIcon:!0}}async execute(e,t){let n=this.getInput(e,`input`,null);return{success:!0,summary:`工作流结束`,outputs:{},raw:{completed:!0,timestamp:Date.now(),finalInput:n}}}},la=t({ForNode:()=>ua}),ua=class extends n{constructor(...e){super(...e),this.type=`for`,this.label=`批处理`,this.description=`遍历集合并运行循环体`,this.category=`流程控制`}defineInputs(){return[{name:`items`,type:`array`,description:`输入集合`,required:!1}]}defineOutputs(){return[{name:`loop`,type:`any`,description:`循环体`},{name:`next`,type:`any`,description:`循环结束`}]}getStyleConfig(){return{headerColor:[`#f97316`,`#ea580c`],icon:`repeat`,showIcon:!0}}async execute(e,t){try{let n=this.getInput(e,`items`,[]);if(!Array.isArray(n))throw Error(`循环源数据必须是数组`);let r=t.nodeData||{},i={...this.getDefaultConfig(),...r.config||{}};if(!i.containerId)throw Error(`For 节点未配置循环体容器`);if(!t.executeContainer)throw Error(`执行上下文缺少 executeContainer 方法`);let a=n.map((e,t)=>({[i.itemName]:e,[i.indexName]:t,list:n}));if(a.length===0)return this.createOutput({next:{totalCount:0,executedCount:0,successCount:0,errorCount:0,results:[],summary:`无迭代数据`}},{count:0},`无迭代数据`);let o=i.pagination,s=o?.enabled??!1,c=o?.pageSize??10,l=o?.currentPage??1,u=a,d=0,f=a.length;s&&c>0?(d=(l-1)*c,f=Math.min(d+c,a.length),u=a.slice(d,f),console.log(`[ForNode] 启用分页：第 ${l} 页，每页 ${c} 条，执行 ${u.length} 次迭代（总共 ${a.length} 次）`)):console.log(`[ForNode] 开始执行循环，共 ${a.length} 次迭代`);let p=[];for(let e=0;e<u.length;e++){let n=d+e,r=u[e]||{};console.log(`[ForNode] 执行第 ${n+1}/${a.length} 次迭代`,r);try{let e=await t.executeContainer(i.containerId,r);p.push({index:n,variables:r,result:e,status:`success`})}catch(e){let t=e instanceof Error?e.message:String(e);if(console.error(`[ForNode] 第 ${n+1} 次迭代失败:`,t),p.push({index:n,variables:r,error:t,status:`error`}),!i.errorHandling?.continueOnError)throw e}}let m=a.length,h=u.length,g=p.filter(e=>e.status===`success`).length,_=p.filter(e=>e.status===`error`).length,v={next:{totalCount:m,executedCount:h,successCount:g,errorCount:_,results:p,pagination:s?{enabled:!0,currentPage:l,pageSize:c,totalPages:Math.ceil(m/c),startIndex:d,endIndex:f-1}:void 0,summary:s?`第 ${l} 页：执行 ${h} 次，成功 ${g} 次，失败 ${_} 次`:`循环执行 ${h} 次，成功 ${g} 次，失败 ${_} 次`}};return this.createOutput(v,{totalCount:m,executedCount:h,successCount:g,errorCount:_},v.next.summary)}catch(e){return this.createError(e)}}getDefaultConfig(){return{mode:`variable`,variable:``,range:{start:0,end:10,step:1},itemName:`item`,indexName:`index`,containerId:null,errorHandling:{continueOnError:!1}}}};function da(e,t){return function(){return e.apply(t,arguments)}}let{toString:fa}=Object.prototype,{getPrototypeOf:pa}=Object,{iterator:ma,toStringTag:ha}=Symbol,ga=(e=>t=>{let n=fa.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),_a=e=>(e=e.toLowerCase(),t=>ga(t)===e),va=e=>t=>typeof t===e,{isArray:ya}=Array,ba=va(`undefined`);function xa(e){return e!==null&&!ba(e)&&e.constructor!==null&&!ba(e.constructor)&&T(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}let Sa=_a(`ArrayBuffer`);function Ca(e){let t;return t=typeof ArrayBuffer<`u`&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Sa(e.buffer),t}let wa=va(`string`),T=va(`function`),Ta=va(`number`),Ea=e=>typeof e==`object`&&!!e,Da=e=>e===!0||e===!1,Oa=e=>{if(ga(e)!==`object`)return!1;let t=pa(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(ha in e)&&!(ma in e)},ka=e=>{if(!Ea(e)||xa(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Aa=_a(`Date`),ja=_a(`File`),Ma=_a(`Blob`),Na=_a(`FileList`),Pa=e=>Ea(e)&&T(e.pipe),Fa=e=>{let t;return e&&(typeof FormData==`function`&&e instanceof FormData||T(e.append)&&((t=ga(e))===`formdata`||t===`object`&&T(e.toString)&&e.toString()===`[object FormData]`))},Ia=_a(`URLSearchParams`),[La,Ra,za,Ba]=[`ReadableStream`,`Request`,`Response`,`Headers`].map(_a),Va=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,``);function Ha(e,t,{allOwnKeys:n=!1}={}){if(e==null)return;let r,i;if(typeof e!=`object`&&(e=[e]),ya(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{if(xa(e))return;let i=n?Object.getOwnPropertyNames(e):Object.keys(e),a=i.length,o;for(r=0;r<a;r++)o=i[r],t.call(null,e[o],o,e)}}function Ua(e,t){if(xa(e))return null;t=t.toLowerCase();let n=Object.keys(e),r=n.length,i;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}let Wa=(()=>typeof globalThis<`u`?globalThis:typeof self<`u`?self:typeof window<`u`?window:global)(),Ga=e=>!ba(e)&&e!==Wa;function Ka(){let{caseless:e,skipUndefined:t}=Ga(this)&&this||{},n={},r=(r,i)=>{let a=e&&Ua(n,i)||i;Oa(n[a])&&Oa(r)?n[a]=Ka(n[a],r):Oa(r)?n[a]=Ka({},r):ya(r)?n[a]=r.slice():(!t||!ba(r))&&(n[a]=r)};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Ha(arguments[e],r);return n}let qa=(e,t,n,{allOwnKeys:r}={})=>(Ha(t,(t,r)=>{n&&T(t)?e[r]=da(t,n):e[r]=t},{allOwnKeys:r}),e),Ja=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Ya=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,`super`,{value:t.prototype}),n&&Object.assign(e.prototype,n)},Xa=(e,t,n,r)=>{let i,a,o,s={};if(t||={},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],(!r||r(o,e,t))&&!s[o]&&(t[o]=e[o],s[o]=!0);e=n!==!1&&pa(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},Za=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;let r=e.indexOf(t,n);return r!==-1&&r===n},Qa=e=>{if(!e)return null;if(ya(e))return e;let t=e.length;if(!Ta(t))return null;let n=Array(t);for(;t-- >0;)n[t]=e[t];return n},$a=(e=>t=>e&&t instanceof e)(typeof Uint8Array<`u`&&pa(Uint8Array)),eo=(e,t)=>{let n=(e&&e[ma]).call(e),r;for(;(r=n.next())&&!r.done;){let n=r.value;t.call(e,n[0],n[1])}},to=(e,t)=>{let n,r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},no=_a(`HTMLFormElement`),ro=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),io=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),ao=_a(`RegExp`),oo=(e,t)=>{let n=Object.getOwnPropertyDescriptors(e),r={};Ha(n,(n,i)=>{let a;(a=t(n,i,e))!==!1&&(r[i]=a||n)}),Object.defineProperties(e,r)},so=e=>{oo(e,(t,n)=>{if(T(e)&&[`arguments`,`caller`,`callee`].indexOf(n)!==-1)return!1;let r=e[n];if(T(r)){if(t.enumerable=!1,`writable`in t){t.writable=!1;return}t.set||=()=>{throw Error(`Can not rewrite read-only method '`+n+`'`)}}})},co=(e,t)=>{let n={},r=e=>{e.forEach(e=>{n[e]=!0})};return ya(e)?r(e):r(String(e).split(t)),n},lo=()=>{},uo=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function fo(e){return!!(e&&T(e.append)&&e[ha]===`FormData`&&e[ma])}let po=e=>{let t=Array(10),n=(e,r)=>{if(Ea(e)){if(t.indexOf(e)>=0)return;if(xa(e))return e;if(!(`toJSON`in e)){t[r]=e;let i=ya(e)?[]:{};return Ha(e,(e,t)=>{let a=n(e,r+1);!ba(a)&&(i[t]=a)}),t[r]=void 0,i}}return e};return n(e,0)},mo=_a(`AsyncFunction`),ho=e=>e&&(Ea(e)||T(e))&&T(e.then)&&T(e.catch),go=((e,t)=>e?setImmediate:t?((e,t)=>(Wa.addEventListener(`message`,({source:n,data:r})=>{n===Wa&&r===e&&t.length&&t.shift()()},!1),n=>{t.push(n),Wa.postMessage(e,`*`)}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate==`function`,T(Wa.postMessage)),_o=typeof queueMicrotask<`u`?queueMicrotask.bind(Wa):typeof process<`u`&&process.nextTick||go;var E={isArray:ya,isArrayBuffer:Sa,isBuffer:xa,isFormData:Fa,isArrayBufferView:Ca,isString:wa,isNumber:Ta,isBoolean:Da,isObject:Ea,isPlainObject:Oa,isEmptyObject:ka,isReadableStream:La,isRequest:Ra,isResponse:za,isHeaders:Ba,isUndefined:ba,isDate:Aa,isFile:ja,isBlob:Ma,isRegExp:ao,isFunction:T,isStream:Pa,isURLSearchParams:Ia,isTypedArray:$a,isFileList:Na,forEach:Ha,merge:Ka,extend:qa,trim:Va,stripBOM:Ja,inherits:Ya,toFlatObject:Xa,kindOf:ga,kindOfTest:_a,endsWith:Za,toArray:Qa,forEachEntry:eo,matchAll:to,isHTMLForm:no,hasOwnProperty:io,hasOwnProp:io,reduceDescriptors:oo,freezeMethods:so,toObjectSet:co,toCamelCase:ro,noop:lo,toFiniteNumber:uo,findKey:Ua,global:Wa,isContextDefined:Ga,isSpecCompliantForm:fo,toJSONObject:po,isAsyncFn:mo,isThenable:ho,setImmediate:go,asap:_o,isIterable:e=>e!=null&&T(e[ma])};function vo(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=e,this.name=`AxiosError`,t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}E.inherits(vo,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:E.toJSONObject(this.config),code:this.code,status:this.status}}});let yo=vo.prototype,bo={};[`ERR_BAD_OPTION_VALUE`,`ERR_BAD_OPTION`,`ECONNABORTED`,`ETIMEDOUT`,`ERR_NETWORK`,`ERR_FR_TOO_MANY_REDIRECTS`,`ERR_DEPRECATED`,`ERR_BAD_RESPONSE`,`ERR_BAD_REQUEST`,`ERR_CANCELED`,`ERR_NOT_SUPPORT`,`ERR_INVALID_URL`].forEach(e=>{bo[e]={value:e}}),Object.defineProperties(vo,bo),Object.defineProperty(yo,`isAxiosError`,{value:!0}),vo.from=(e,t,n,r,i,a)=>{let o=Object.create(yo);E.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>e!==`isAxiosError`);let s=e&&e.message?e.message:`Error`,c=t==null&&e?e.code:t;return vo.call(o,s,c,n,r,i),e&&o.cause==null&&Object.defineProperty(o,`cause`,{value:e,configurable:!0}),o.name=e&&e.name||`Error`,a&&Object.assign(o,a),o};var D=vo,xo=null;function So(e){return E.isPlainObject(e)||E.isArray(e)}function Co(e){return E.endsWith(e,`[]`)?e.slice(0,-2):e}function wo(e,t,n){return e?e.concat(t).map(function(e,t){return e=Co(e),!n&&t?`[`+e+`]`:e}).join(n?`.`:``):t}function To(e){return E.isArray(e)&&!e.some(So)}let Eo=E.toFlatObject(E,{},null,function(e){return/^is[A-Z]/.test(e)});function Do(e,t,n){if(!E.isObject(e))throw TypeError(`target must be an object`);t||=new(xo||FormData),n=E.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!E.isUndefined(t[e])});let r=n.metaTokens,i=n.visitor||l,a=n.dots,o=n.indexes,s=(n.Blob||typeof Blob<`u`&&Blob)&&E.isSpecCompliantForm(t);if(!E.isFunction(i))throw TypeError(`visitor must be a function`);function c(e){if(e===null)return``;if(E.isDate(e))return e.toISOString();if(E.isBoolean(e))return e.toString();if(!s&&E.isBlob(e))throw new D(`Blob is not supported. Use a Buffer instead.`);return E.isArrayBuffer(e)||E.isTypedArray(e)?s&&typeof Blob==`function`?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let s=e;if(e&&!i&&typeof e==`object`){if(E.endsWith(n,`{}`))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(E.isArray(e)&&To(e)||(E.isFileList(e)||E.endsWith(n,`[]`))&&(s=E.toArray(e)))return n=Co(n),s.forEach(function(e,r){!(E.isUndefined(e)||e===null)&&t.append(o===!0?wo([n],r,a):o===null?n:n+`[]`,c(e))}),!1}return So(e)?!0:(t.append(wo(i,n,a),c(e)),!1)}let u=[],d=Object.assign(Eo,{defaultVisitor:l,convertValue:c,isVisitable:So});function f(e,n){if(!E.isUndefined(e)){if(u.indexOf(e)!==-1)throw Error(`Circular reference detected in `+n.join(`.`));u.push(e),E.forEach(e,function(e,r){(!(E.isUndefined(e)||e===null)&&i.call(t,e,E.isString(r)?r.trim():r,n,d))===!0&&f(e,n?n.concat(r):[r])}),u.pop()}}if(!E.isObject(e))throw TypeError(`data must be an object`);return f(e),t}var Oo=Do;function ko(e){let t={"!":`%21`,"'":`%27`,"(":`%28`,")":`%29`,"~":`%7E`,"%20":`+`,"%00":`\0`};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Ao(e,t){this._pairs=[],e&&Oo(e,this,t)}let jo=Ao.prototype;jo.append=function(e,t){this._pairs.push([e,t])},jo.toString=function(e){let t=e?function(t){return e.call(this,t,ko)}:ko;return this._pairs.map(function(e){return t(e[0])+`=`+t(e[1])},``).join(`&`)};var Mo=Ao;function No(e){return encodeURIComponent(e).replace(/%3A/gi,`:`).replace(/%24/g,`$`).replace(/%2C/gi,`,`).replace(/%20/g,`+`)}function Po(e,t,n){if(!t)return e;let r=n&&n.encode||No;E.isFunction(n)&&(n={serialize:n});let i=n&&n.serialize,a;if(a=i?i(t,n):E.isURLSearchParams(t)?t.toString():new Mo(t,n).toString(r),a){let t=e.indexOf(`#`);t!==-1&&(e=e.slice(0,t)),e+=(e.indexOf(`?`)===-1?`?`:`&`)+a}return e}var Fo=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&=[]}forEach(e){E.forEach(this.handlers,function(t){t!==null&&e(t)})}},Io={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Lo={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<`u`?URLSearchParams:Mo,FormData:typeof FormData<`u`?FormData:null,Blob:typeof Blob<`u`?Blob:null},protocols:[`http`,`https`,`file`,`blob`,`url`,`data`]},Ro=t({hasBrowserEnv:()=>zo,hasStandardBrowserEnv:()=>Vo,hasStandardBrowserWebWorkerEnv:()=>Ho,navigator:()=>Bo,origin:()=>Uo});let zo=typeof window<`u`&&typeof document<`u`,Bo=typeof navigator==`object`&&navigator||void 0,Vo=zo&&(!Bo||[`ReactNative`,`NativeScript`,`NS`].indexOf(Bo.product)<0),Ho=(()=>typeof WorkerGlobalScope<`u`&&self instanceof WorkerGlobalScope&&typeof self.importScripts==`function`)(),Uo=zo&&window.location.href||`http://localhost`;var O={...Ro,...Lo};function Wo(e,t){return Oo(e,new O.classes.URLSearchParams,{visitor:function(e,t,n,r){return O.isNode&&E.isBuffer(e)?(this.append(t,e.toString(`base64`)),!1):r.defaultVisitor.apply(this,arguments)},...t})}function Go(e){return E.matchAll(/\w+|\[(\w*)]/g,e).map(e=>e[0]===`[]`?``:e[1]||e[0])}function Ko(e){let t={},n=Object.keys(e),r,i=n.length,a;for(r=0;r<i;r++)a=n[r],t[a]=e[a];return t}function qo(e){function t(e,n,r,i){let a=e[i++];if(a===`__proto__`)return!0;let o=Number.isFinite(+a),s=i>=e.length;return a=!a&&E.isArray(r)?r.length:a,s?(E.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!o):((!r[a]||!E.isObject(r[a]))&&(r[a]=[]),t(e,n,r[a],i)&&E.isArray(r[a])&&(r[a]=Ko(r[a])),!o)}if(E.isFormData(e)&&E.isFunction(e.entries)){let n={};return E.forEachEntry(e,(e,r)=>{t(Go(e),r,n,0)}),n}return null}var Jo=qo;function Yo(e,t,n){if(E.isString(e))try{return(t||JSON.parse)(e),E.trim(e)}catch(e){if(e.name!==`SyntaxError`)throw e}return(n||JSON.stringify)(e)}let Xo={transitional:Io,adapter:[`xhr`,`http`,`fetch`],transformRequest:[function(e,t){let n=t.getContentType()||``,r=n.indexOf(`application/json`)>-1,i=E.isObject(e);if(i&&E.isHTMLForm(e)&&(e=new FormData(e)),E.isFormData(e))return r?JSON.stringify(Jo(e)):e;if(E.isArrayBuffer(e)||E.isBuffer(e)||E.isStream(e)||E.isFile(e)||E.isBlob(e)||E.isReadableStream(e))return e;if(E.isArrayBufferView(e))return e.buffer;if(E.isURLSearchParams(e))return t.setContentType(`application/x-www-form-urlencoded;charset=utf-8`,!1),e.toString();let a;if(i){if(n.indexOf(`application/x-www-form-urlencoded`)>-1)return Wo(e,this.formSerializer).toString();if((a=E.isFileList(e))||n.indexOf(`multipart/form-data`)>-1){let t=this.env&&this.env.FormData;return Oo(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType(`application/json`,!1),Yo(e)):e}],transformResponse:[function(e){let t=this.transitional||Xo.transitional,n=t&&t.forcedJSONParsing,r=this.responseType===`json`;if(E.isResponse(e)||E.isReadableStream(e))return e;if(e&&E.isString(e)&&(n&&!this.responseType||r)){let n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(e){if(n)throw e.name===`SyntaxError`?D.from(e,D.ERR_BAD_RESPONSE,this,null,this.response):e}}return e}],timeout:0,xsrfCookieName:`XSRF-TOKEN`,xsrfHeaderName:`X-XSRF-TOKEN`,maxContentLength:-1,maxBodyLength:-1,env:{FormData:O.classes.FormData,Blob:O.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:`application/json, text/plain, */*`,"Content-Type":void 0}}};E.forEach([`delete`,`get`,`head`,`post`,`put`,`patch`],e=>{Xo.headers[e]={}});var Zo=Xo;let Qo=E.toObjectSet([`age`,`authorization`,`content-length`,`content-type`,`etag`,`expires`,`from`,`host`,`if-modified-since`,`if-unmodified-since`,`last-modified`,`location`,`max-forwards`,`proxy-authorization`,`referer`,`retry-after`,`user-agent`]);var $o=e=>{let t={},n,r,i;return e&&e.split(`
`).forEach(function(e){i=e.indexOf(`:`),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!(!n||t[n]&&Qo[n])&&(n===`set-cookie`?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+`, `+r:r)}),t};let es=Symbol(`internals`);function ts(e){return e&&String(e).trim().toLowerCase()}function ns(e){return e===!1||e==null?e:E.isArray(e)?e.map(ns):String(e)}function rs(e){let t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}let os=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function ss(e,t,n,r,i){if(E.isFunction(r))return r.call(this,t,n);if(i&&(t=n),E.isString(t)){if(E.isString(r))return t.indexOf(r)!==-1;if(E.isRegExp(r))return r.test(t)}}function cs(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function ls(e,t){let n=E.toCamelCase(` `+t);[`get`,`set`,`has`].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})})}var us=class{constructor(e){e&&this.set(e)}set(e,t,n){let r=this;function i(e,t,n){let i=ts(t);if(!i)throw Error(`header name must be a non-empty string`);let a=E.findKey(r,i);(!a||r[a]===void 0||n===!0||n===void 0&&r[a]!==!1)&&(r[a||t]=ns(e))}let a=(e,t)=>E.forEach(e,(e,n)=>i(e,n,t));if(E.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(E.isString(e)&&(e=e.trim())&&!os(e))a($o(e),t);else if(E.isObject(e)&&E.isIterable(e)){let n={},r,i;for(let t of e){if(!E.isArray(t))throw TypeError(`Object iterator must return a key-value pair`);n[i=t[0]]=(r=n[i])?E.isArray(r)?[...r,t[1]]:[r,t[1]]:t[1]}a(n,t)}else e!=null&&i(t,e,n);return this}get(e,t){if(e=ts(e),e){let n=E.findKey(this,e);if(n){let e=this[n];if(!t)return e;if(t===!0)return rs(e);if(E.isFunction(t))return t.call(this,e,n);if(E.isRegExp(t))return t.exec(e);throw TypeError(`parser must be boolean|regexp|function`)}}}has(e,t){if(e=ts(e),e){let n=E.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||ss(this,this[n],n,t)))}return!1}delete(e,t){let n=this,r=!1;function i(e){if(e=ts(e),e){let i=E.findKey(n,e);i&&(!t||ss(n,n[i],i,t))&&(delete n[i],r=!0)}}return E.isArray(e)?e.forEach(i):i(e),r}clear(e){let t=Object.keys(this),n=t.length,r=!1;for(;n--;){let i=t[n];(!e||ss(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){let t=this,n={};return E.forEach(this,(r,i)=>{let a=E.findKey(n,i);if(a){t[a]=ns(r),delete t[i];return}let o=e?cs(i):String(i).trim();o!==i&&delete t[i],t[o]=ns(r),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return E.forEach(this,(n,r)=>{n!=null&&n!==!1&&(t[r]=e&&E.isArray(n)?n.join(`, `):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+`: `+t).join(`
`)}getSetCookie(){return this.get(`set-cookie`)||[]}get[Symbol.toStringTag](){return`AxiosHeaders`}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let n=new this(e);return t.forEach(e=>n.set(e)),n}static accessor(e){let t=(this[es]=this[es]={accessors:{}}).accessors,n=this.prototype;function r(e){let r=ts(e);t[r]||(ls(n,e),t[r]=!0)}return E.isArray(e)?e.forEach(r):r(e),this}};us.accessor([`Content-Type`,`Content-Length`,`Accept`,`Accept-Encoding`,`User-Agent`,`Authorization`]),E.reduceDescriptors(us.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}}),E.freezeMethods(us);var ds=us;function fs(e,t){let n=this||Zo,r=t||n,i=ds.from(r.headers),a=r.data;return E.forEach(e,function(e){a=e.call(n,a,i.normalize(),t?t.status:void 0)}),i.normalize(),a}function ps(e){return!!(e&&e.__CANCEL__)}function ms(e,t,n){D.call(this,e??`canceled`,D.ERR_CANCELED,t,n),this.name=`CanceledError`}E.inherits(ms,D,{__CANCEL__:!0});var hs=ms;function gs(e,t,n){let r=n.config.validateStatus;!n.status||!r||r(n.status)?e(n):t(new D(`Request failed with status code `+n.status,[D.ERR_BAD_REQUEST,D.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function _s(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||``}function vs(e,t){e||=10;let n=Array(e),r=Array(e),i=0,a=0,o;return t=t===void 0?1e3:t,function(s){let c=Date.now(),l=r[a];o||=c,n[i]=s,r[i]=c;let u=a,d=0;for(;u!==i;)d+=n[u++],u%=e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),c-o<t)return;let f=l&&c-l;return f?Math.round(d*1e3/f):void 0}}var ys=vs;function bs(e,t){let n=0,r=1e3/t,i,a,o=(t,r=Date.now())=>{n=r,i=null,a&&=(clearTimeout(a),null),e(...t)};return[(...e)=>{let t=Date.now(),s=t-n;s>=r?o(e,t):(i=e,a||=setTimeout(()=>{a=null,o(i)},r-s))},()=>i&&o(i)]}var xs=bs;let Ss=(e,t,n=3)=>{let r=0,i=ys(50,250);return xs(n=>{let a=n.loaded,o=n.lengthComputable?n.total:void 0,s=a-r,c=i(s),l=a<=o;r=a;let u={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:c||void 0,estimated:c&&o&&l?(o-a)/c:void 0,event:n,lengthComputable:o!=null,[t?`download`:`upload`]:!0};e(u)},n)},Cs=(e,t)=>{let n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},ws=e=>(...t)=>E.asap(()=>e(...t));var Ts=O.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,O.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(O.origin),O.navigator&&/(msie|trident)/i.test(O.navigator.userAgent)):()=>!0,Es=O.hasStandardBrowserEnv?{write(e,t,n,r,i,a,o){if(typeof document>`u`)return;let s=[`${e}=${encodeURIComponent(t)}`];E.isNumber(n)&&s.push(`expires=${new Date(n).toUTCString()}`),E.isString(r)&&s.push(`path=${r}`),E.isString(i)&&s.push(`domain=${i}`),a===!0&&s.push(`secure`),E.isString(o)&&s.push(`SameSite=${o}`),document.cookie=s.join(`; `)},read(e){if(typeof document>`u`)return null;let t=document.cookie.match(RegExp(`(?:^|; )`+e+`=([^;]*)`));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,``,Date.now()-864e5,`/`)}}:{write(){},read(){return null},remove(){}};function Ds(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Os(e,t){return t?e.replace(/\/?\/$/,``)+`/`+t.replace(/^\/+/,``):e}function ks(e,t,n){let r=!Ds(t);return e&&(r||n==0)?Os(e,t):t}let As=e=>e instanceof ds?{...e}:e;function js(e,t){t||={};let n={};function r(e,t,n,r){return E.isPlainObject(e)&&E.isPlainObject(t)?E.merge.call({caseless:r},e,t):E.isPlainObject(t)?E.merge({},t):E.isArray(t)?t.slice():t}function i(e,t,n,i){if(E.isUndefined(t)){if(!E.isUndefined(e))return r(void 0,e,n,i)}else return r(e,t,n,i)}function a(e,t){if(!E.isUndefined(t))return r(void 0,t)}function o(e,t){if(E.isUndefined(t)){if(!E.isUndefined(e))return r(void 0,e)}else return r(void 0,t)}function s(n,i,a){if(a in t)return r(n,i);if(a in e)return r(void 0,n)}let c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t,n)=>i(As(e),As(t),n,!0)};return E.forEach(Object.keys({...e,...t}),function(r){let a=c[r]||i,o=a(e[r],t[r],r);E.isUndefined(o)&&a!==s||(n[r]=o)}),n}var Ms=e=>{let t=js({},e),{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:a,headers:o,auth:s}=t;if(t.headers=o=ds.from(o),t.url=Po(ks(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&o.set(`Authorization`,`Basic `+btoa((s.username||``)+`:`+(s.password?unescape(encodeURIComponent(s.password)):``))),E.isFormData(n)){if(O.hasStandardBrowserEnv||O.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(E.isFunction(n.getHeaders)){let e=n.getHeaders(),t=[`content-type`,`content-length`];Object.entries(e).forEach(([e,n])=>{t.includes(e.toLowerCase())&&o.set(e,n)})}}if(O.hasStandardBrowserEnv&&(r&&E.isFunction(r)&&(r=r(t)),r||r!==!1&&Ts(t.url))){let e=i&&a&&Es.read(a);e&&o.set(i,e)}return t},Ns=typeof XMLHttpRequest<`u`&&function(e){return new Promise(function(t,n){let r=Ms(e),i=r.data,a=ds.from(r.headers).normalize(),{responseType:o,onUploadProgress:s,onDownloadProgress:c}=r,l,u,d,f,p;function m(){f&&f(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(l),r.signal&&r.signal.removeEventListener(`abort`,l)}let h=new XMLHttpRequest;h.open(r.method.toUpperCase(),r.url,!0),h.timeout=r.timeout;function g(){if(!h)return;let r=ds.from(`getAllResponseHeaders`in h&&h.getAllResponseHeaders()),i={data:!o||o===`text`||o===`json`?h.responseText:h.response,status:h.status,statusText:h.statusText,headers:r,config:e,request:h};gs(function(e){t(e),m()},function(e){n(e),m()},i),h=null}`onloadend`in h?h.onloadend=g:h.onreadystatechange=function(){!h||h.readyState!==4||h.status===0&&!(h.responseURL&&h.responseURL.indexOf(`file:`)===0)||setTimeout(g)},h.onabort=function(){h&&=(n(new D(`Request aborted`,D.ECONNABORTED,e,h)),null)},h.onerror=function(t){let r=t&&t.message?t.message:`Network Error`,i=new D(r,D.ERR_NETWORK,e,h);i.event=t||null,n(i),h=null},h.ontimeout=function(){let t=r.timeout?`timeout of `+r.timeout+`ms exceeded`:`timeout exceeded`,i=r.transitional||Io;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new D(t,i.clarifyTimeoutError?D.ETIMEDOUT:D.ECONNABORTED,e,h)),h=null},i===void 0&&a.setContentType(null),`setRequestHeader`in h&&E.forEach(a.toJSON(),function(e,t){h.setRequestHeader(t,e)}),E.isUndefined(r.withCredentials)||(h.withCredentials=!!r.withCredentials),o&&o!==`json`&&(h.responseType=r.responseType),c&&([d,p]=Ss(c,!0),h.addEventListener(`progress`,d)),s&&h.upload&&([u,f]=Ss(s),h.upload.addEventListener(`progress`,u),h.upload.addEventListener(`loadend`,f)),(r.cancelToken||r.signal)&&(l=t=>{h&&=(n(!t||t.type?new hs(null,e,h):t),h.abort(),null)},r.cancelToken&&r.cancelToken.subscribe(l),r.signal&&(r.signal.aborted?l():r.signal.addEventListener(`abort`,l)));let _=_s(r.url);if(_&&O.protocols.indexOf(_)===-1){n(new D(`Unsupported protocol `+_+`:`,D.ERR_BAD_REQUEST,e));return}h.send(i||null)})},Ps=(e,t)=>{let{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n=new AbortController,r,i=function(e){if(!r){r=!0,o();let t=e instanceof Error?e:this.reason;n.abort(t instanceof D?t:new hs(t instanceof Error?t.message:t))}},a=t&&setTimeout(()=>{a=null,i(new D(`timeout ${t} of ms exceeded`,D.ETIMEDOUT))},t),o=()=>{e&&=(a&&clearTimeout(a),a=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener(`abort`,i)}),null)};e.forEach(e=>e.addEventListener(`abort`,i));let{signal:s}=n;return s.unsubscribe=()=>E.asap(o),s}};let Fs=function*(e,t){let n=e.byteLength;if(!t||n<t){yield e;return}let r=0,i;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},Is=async function*(e,t){for await(let n of Ls(e))yield*Fs(n,t)},Ls=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}let t=e.getReader();try{for(;;){let{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}},Rs=(e,t,n,r)=>{let i=Is(e,t),a=0,o,s=e=>{o||(o=!0,r&&r(e))};return new ReadableStream({async pull(e){try{let{done:t,value:r}=await i.next();if(t){s(),e.close();return}let o=r.byteLength;if(n){let e=a+=o;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw s(e),e}},cancel(e){return s(e),i.return()}},{highWaterMark:2})},zs=64*1024,{isFunction:Bs}=E,Vs=(({Request:e,Response:t})=>({Request:e,Response:t}))(E.global),{ReadableStream:Hs,TextEncoder:Us}=E.global,Ws=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Gs=e=>{e=E.merge.call({skipUndefined:!0},Vs,e);let{fetch:t,Request:n,Response:r}=e,i=t?Bs(t):typeof fetch==`function`,a=Bs(n),o=Bs(r);if(!i)return!1;let s=i&&Bs(Hs),c=i&&(typeof Us==`function`?(e=>t=>e.encode(t))(new Us):async e=>new Uint8Array(await new n(e).arrayBuffer())),l=a&&s&&Ws(()=>{let e=!1,t=new n(O.origin,{body:new Hs,method:`POST`,get duplex(){return e=!0,`half`}}).headers.has(`Content-Type`);return e&&!t}),u=o&&s&&Ws(()=>E.isReadableStream(new r(``).body)),d={stream:u&&(e=>e.body)};i&&[`text`,`arrayBuffer`,`blob`,`formData`,`stream`].forEach(e=>{!d[e]&&(d[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new D(`Response type '${e}' is not supported`,D.ERR_NOT_SUPPORT,n)})});let f=async e=>{if(e==null)return 0;if(E.isBlob(e))return e.size;if(E.isSpecCompliantForm(e))return(await new n(O.origin,{method:`POST`,body:e}).arrayBuffer()).byteLength;if(E.isArrayBufferView(e)||E.isArrayBuffer(e))return e.byteLength;if(E.isURLSearchParams(e)&&(e+=``),E.isString(e))return(await c(e)).byteLength},p=async(e,t)=>E.toFiniteNumber(e.getContentLength())??f(t);return async e=>{let{url:i,method:o,data:s,signal:c,cancelToken:f,timeout:m,onDownloadProgress:h,onUploadProgress:g,responseType:_,headers:v,withCredentials:y=`same-origin`,fetchOptions:b}=Ms(e),ee=t||fetch;_=_?(_+``).toLowerCase():`text`;let x=Ps([c,f&&f.toAbortSignal()],m),S=null,C=x&&x.unsubscribe&&(()=>{x.unsubscribe()}),te;try{if(g&&l&&o!==`get`&&o!==`head`&&(te=await p(v,s))!==0){let e=new n(i,{method:`POST`,body:s,duplex:`half`}),t;if(E.isFormData(s)&&(t=e.headers.get(`content-type`))&&v.setContentType(t),e.body){let[t,n]=Cs(te,Ss(ws(g)));s=Rs(e.body,zs,t,n)}}E.isString(y)||(y=y?`include`:`omit`);let t=a&&`credentials`in n.prototype,c={...b,signal:x,method:o.toUpperCase(),headers:v.normalize().toJSON(),body:s,duplex:`half`,credentials:t?y:void 0};S=a&&new n(i,c);let f=await(a?ee(S,b):ee(i,c)),m=u&&(_===`stream`||_===`response`);if(u&&(h||m&&C)){let e={};[`status`,`statusText`,`headers`].forEach(t=>{e[t]=f[t]});let t=E.toFiniteNumber(f.headers.get(`content-length`)),[n,i]=h&&Cs(t,Ss(ws(h),!0))||[];f=new r(Rs(f.body,zs,n,()=>{i&&i(),C&&C()}),e)}_||=`text`;let ne=await d[E.findKey(d,_)||`text`](f,e);return!m&&C&&C(),await new Promise((t,n)=>{gs(t,n,{data:ne,headers:ds.from(f.headers),status:f.status,statusText:f.statusText,config:e,request:S})})}catch(t){throw C&&C(),t&&t.name===`TypeError`&&/Load failed|fetch/i.test(t.message)?Object.assign(new D(`Network Error`,D.ERR_NETWORK,e,S),{cause:t.cause||t}):D.from(t,t&&t.code,e,S)}}},Ks=new Map,qs=e=>{let t=e&&e.env||{},{fetch:n,Request:r,Response:i}=t,a=[r,i,n],o=a.length,s,c,l=Ks;for(;o--;)s=a[o],c=l.get(s),c===void 0&&l.set(s,c=o?new Map:Gs(t)),l=c;return c};qs();let Js={http:xo,xhr:Ns,fetch:{get:qs}};E.forEach(Js,(e,t)=>{if(e){try{Object.defineProperty(e,`name`,{value:t})}catch{}Object.defineProperty(e,`adapterName`,{value:t})}});let Ys=e=>`- ${e}`,Xs=e=>E.isFunction(e)||e===null||e===!1;function Zs(e,t){e=E.isArray(e)?e:[e];let{length:n}=e,r,i,a={};for(let o=0;o<n;o++){r=e[o];let n;if(i=r,!Xs(r)&&(i=Js[(n=String(r)).toLowerCase()],i===void 0))throw new D(`Unknown adapter '${n}'`);if(i&&(E.isFunction(i)||(i=i.get(t))))break;a[n||`#`+o]=i}if(!i){let e=Object.entries(a).map(([e,t])=>`adapter ${e} `+(t===!1?`is not supported by the environment`:`is not available in the build`)),t=n?e.length>1?`since :
`+e.map(Ys).join(`
`):` `+Ys(e[0]):`as no adapter specified`;throw new D(`There is no suitable adapter to dispatch the request `+t,`ERR_NOT_SUPPORT`)}return i}var Qs={getAdapter:Zs,adapters:Js};function $s(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new hs(null,e)}function ec(e){return $s(e),e.headers=ds.from(e.headers),e.data=fs.call(e,e.transformRequest),[`post`,`put`,`patch`].indexOf(e.method)!==-1&&e.headers.setContentType(`application/x-www-form-urlencoded`,!1),Qs.getAdapter(e.adapter||Zo.adapter,e)(e).then(function(t){return $s(e),t.data=fs.call(e,e.transformResponse,t),t.headers=ds.from(t.headers),t},function(t){return ps(t)||($s(e),t&&t.response&&(t.response.data=fs.call(e,e.transformResponse,t.response),t.response.headers=ds.from(t.response.headers))),Promise.reject(t)})}let tc=`1.13.2`,nc={};[`object`,`boolean`,`number`,`function`,`string`,`symbol`].forEach((e,t)=>{nc[e]=function(n){return typeof n===e||`a`+(t<1?`n `:` `)+e}});let rc={};nc.transitional=function(e,t,n){function r(e,t){return`[Axios v`+tc+`] Transitional option '`+e+`'`+t+(n?`. `+n:``)}return(n,i,a)=>{if(e===!1)throw new D(r(i,` has been removed`+(t?` in `+t:``)),D.ERR_DEPRECATED);return t&&!rc[i]&&(rc[i]=!0,console.warn(r(i,` has been deprecated since v`+t+` and will be removed in the near future`))),e?e(n,i,a):!0}},nc.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function ic(e,t,n){if(typeof e!=`object`)throw new D(`options must be an object`,D.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),i=r.length;for(;i-- >0;){let a=r[i],o=t[a];if(o){let t=e[a],n=t===void 0||o(t,a,e);if(n!==!0)throw new D(`option `+a+` must be `+n,D.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new D(`Unknown option `+a,D.ERR_BAD_OPTION)}}var ac={assertOptions:ic,validators:nc};let oc=ac.validators;var sc=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Fo,response:new Fo}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=Error();let n=t.stack?t.stack.replace(/^.+\n/,``):``;try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,``))&&(e.stack+=`
`+n):e.stack=n}catch{}}throw e}}_request(e,t){typeof e==`string`?(t||={},t.url=e):t=e||{},t=js(this.defaults,t);let{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&ac.assertOptions(n,{silentJSONParsing:oc.transitional(oc.boolean),forcedJSONParsing:oc.transitional(oc.boolean),clarifyTimeoutError:oc.transitional(oc.boolean)},!1),r!=null&&(E.isFunction(r)?t.paramsSerializer={serialize:r}:ac.assertOptions(r,{encode:oc.function,serialize:oc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls===void 0?t.allowAbsoluteUrls=!0:t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls),ac.assertOptions(t,{baseUrl:oc.spelling(`baseURL`),withXsrfToken:oc.spelling(`withXSRFToken`)},!0),t.method=(t.method||this.defaults.method||`get`).toLowerCase();let a=i&&E.merge(i.common,i[t.method]);i&&E.forEach([`delete`,`get`,`head`,`post`,`put`,`patch`,`common`],e=>{delete i[e]}),t.headers=ds.concat(a,i);let o=[],s=!0;this.interceptors.request.forEach(function(e){typeof e.runWhen==`function`&&e.runWhen(t)===!1||(s&&=e.synchronous,o.unshift(e.fulfilled,e.rejected))});let c=[];this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let l,u=0,d;if(!s){let e=[ec.bind(this),void 0];for(e.unshift(...o),e.push(...c),d=e.length,l=Promise.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=o.length;let f=t;for(;u<d;){let e=o[u++],t=o[u++];try{f=e(f)}catch(e){t.call(this,e);break}}try{l=ec.call(this,f)}catch(e){return Promise.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){e=js(this.defaults,e);let t=ks(e.baseURL,e.url,e.allowAbsoluteUrls);return Po(t,e.params,e.paramsSerializer)}};E.forEach([`delete`,`get`,`head`,`options`],function(e){sc.prototype[e]=function(t,n){return this.request(js(n||{},{method:e,url:t,data:(n||{}).data}))}}),E.forEach([`post`,`put`,`patch`],function(e){function t(t){return function(n,r,i){return this.request(js(i||{},{method:e,headers:t?{"Content-Type":`multipart/form-data`}:{},url:n,data:r}))}}sc.prototype[e]=t(),sc.prototype[e+`Form`]=t(!0)});var cc=sc,lc=class e{constructor(e){if(typeof e!=`function`)throw TypeError(`executor must be a function.`);let t;this.promise=new Promise(function(e){t=e});let n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t,r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,i){n.reason||(n.reason=new hs(e,r,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}};function uc(e){return function(t){return e.apply(null,t)}}function dc(e){return E.isObject(e)&&e.isAxiosError===!0}let fc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(fc).forEach(([e,t])=>{fc[t]=e});var pc=fc;function mc(e){let t=new cc(e),n=da(cc.prototype.request,t);return E.extend(n,cc.prototype,t,{allOwnKeys:!0}),E.extend(n,t,null,{allOwnKeys:!0}),n.create=function(t){return mc(js(e,t))},n}let k=mc(Zo);k.Axios=cc,k.CanceledError=hs,k.CancelToken=lc,k.isCancel=ps,k.VERSION=tc,k.toFormData=Oo,k.AxiosError=D,k.Cancel=k.CanceledError,k.all=function(e){return Promise.all(e)},k.spread=uc,k.isAxiosError=dc,k.mergeConfig=js,k.AxiosHeaders=ds,k.formToJSON=e=>Jo(E.isHTMLForm(e)?new FormData(e):e),k.getAdapter=Qs.getAdapter,k.HttpStatusCode=pc,k.default=k;var hc=k,gc=t({HttpRequestNode:()=>_c}),_c=class extends n{constructor(...e){super(...e),this.type=`http-request`,this.label=`HTTP 请求`,this.description=`发送 HTTP 请求并返回响应`,this.category=`网络`}defineInputs(){return[{name:`url`,type:`string`,description:`请求 URL`,required:!0},{name:`method`,type:`string`,description:`请求方法（GET/POST/PUT/DELETE/PATCH）`,defaultValue:`GET`},{name:`headers`,type:`object`,description:`请求头（JSON 对象）`,defaultValue:`{}`},{name:`body`,type:`any`,description:`请求体（POST/PUT/PATCH 时使用）`},{name:`timeout`,type:`number`,description:`超时时间（毫秒）`,defaultValue:3e4},{name:`retryCount`,type:`number`,description:`重试次数（失败时自动重试）`,defaultValue:0},{name:`retryDelay`,type:`number`,description:`重试间隔时间（毫秒），0 表示使用指数退避`,defaultValue:0}]}defineOutputs(){return[{name:`data`,type:`any`,description:`响应数据`},{name:`status`,type:`number`,description:`HTTP 状态码`},{name:`headers`,type:`object`,description:`响应头`},{name:`success`,type:`boolean`,description:`请求是否成功（状态码 2xx）`}]}getStyleConfig(){return{headerColor:[`#3b82f6`,`#06b6d4`],icon:`globe`,showIcon:!0,bodyStyle:{minWidth:`240px`}}}async execute(e,t){try{let n=this.getInput(e,`url`),r=this.getInput(e,`method`,`GET`),i=this.getInput(e,`headers`,{}),a=this.getInput(e,`body`),o=this.getInput(e,`timeout`,3e4),s=this.getInput(e,`retryCount`,0),c=this.getInput(e,`retryDelay`,0),l=this.validateInputs(e);if(!l.valid)return this.createError(l.errors.join(`; `));if(t.signal?.aborted)return this.createError(`请求已中止`);let u={method:r.toLowerCase(),url:n,timeout:o,headers:{"Content-Type":`application/json`,...i},signal:t.signal};[`POST`,`PUT`,`PATCH`].includes(r)&&a!==void 0&&(u.data=a);let d=null;for(let e=0;e<=s;e++)try{if(t.signal?.aborted)return this.createError(`请求已中止`);let e=await hc(u),i=e.data,a={};Object.keys(e.headers).forEach(t=>{let n=e.headers[t];typeof n==`string`?a[t]=n:Array.isArray(n)&&n.length>0&&(a[t]=n[0])});let o=e.status>=200&&e.status<300;return this.createOutput({data:i,status:e.status,headers:a,success:o},i,`${r} ${n} - ${e.status} ${e.statusText||``}`)}catch(t){if(d=t,e===s)break;let n=t;if(n.response){let e=n.response.status;if(e<500&&e!==429)break}else if(n.code!==`ECONNABORTED`&&n.code!==`ERR_NETWORK`){if(n.code===`ERR_CANCELED`)return this.createError(`请求已中止`);break}if(e<s){let t;t=c>0?c:Math.min(1e3*2**e,1e4),await new Promise(e=>setTimeout(e,t))}}if(d){let e=d;return e.response?this.createError(`请求失败: ${e.response.status} ${e.response.statusText||``}`):e.code===`ECONNABORTED`?this.createError(`请求超时`):e.code===`ERR_NETWORK`?this.createError(`网络错误`):this.createError(e.message||`请求失败`)}return this.createError(`请求失败`)}catch(e){return this.createError(e)}}},vc=t({NoteNode:()=>yc}),yc=class extends n{constructor(...e){super(...e),this.type=`note`,this.label=`笔记`,this.description=`在工作流中添加注释和说明`,this.category=`工具`}defineInputs(){return[]}defineOutputs(){return[]}getStyleConfig(){return{headerColor:`#fbbf24`,icon:`edit`,showIcon:!0}}async execute(e,t){return{success:!0,summary:`笔记节点（跳过执行）`,outputs:{}}}};function A(e,t,n,r,i){if(r===`m`)throw TypeError(`Private method is not writable`);if(r===`a`&&!i)throw TypeError(`Private accessor was defined without a setter`);if(typeof t==`function`?e!==t||!i:!t.has(e))throw TypeError(`Cannot write private member to an object whose class did not declare it`);return r===`a`?i.call(e,n):i?i.value=n:t.set(e,n),n}function j(e,t,n,r){if(n===`a`&&!r)throw TypeError(`Private accessor was defined without a getter`);if(typeof t==`function`?e!==t||!r:!t.has(e))throw TypeError(`Cannot read private member from an object whose class did not declare it`);return n===`m`?r:n===`a`?r.call(e):r?r.value:t.get(e)}let bc=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return bc=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return`10000000-1000-4000-8000-100000000000`.replace(/[018]/g,e=>(e^n()&15>>e/4).toString(16))};function xc(e){return typeof e==`object`&&!!e&&(`name`in e&&e.name===`AbortError`||`message`in e&&String(e.message).includes(`FetchRequestCanceledException`))}let Sc=e=>{if(e instanceof Error)return e;if(typeof e==`object`&&e){try{if(Object.prototype.toString.call(e)===`[object Error]`){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};var M=class extends Error{},N=class e extends M{constructor(t,n,r,i){super(`${e.makeMessage(t,n,r)}`),this.status=t,this.headers=i,this.requestID=i?.get(`x-request-id`),this.error=n;let a=n;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){let r=t?.message?typeof t.message==`string`?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||`(no status code or body)`}static generate(t,n,r,i){if(!t||!i)return new Cc({message:r,cause:Sc(n)});let a=n?.error;return t===400?new Tc(t,a,r,i):t===401?new Ec(t,a,r,i):t===403?new Dc(t,a,r,i):t===404?new Oc(t,a,r,i):t===409?new kc(t,a,r,i):t===422?new Ac(t,a,r,i):t===429?new jc(t,a,r,i):t>=500?new Mc(t,a,r,i):new e(t,a,r,i)}},P=class extends N{constructor({message:e}={}){super(void 0,void 0,e||`Request was aborted.`,void 0)}},Cc=class extends N{constructor({message:e,cause:t}){super(void 0,void 0,e||`Connection error.`,void 0),t&&(this.cause=t)}},wc=class extends Cc{constructor({message:e}={}){super({message:e??`Request timed out.`})}},Tc=class extends N{},Ec=class extends N{},Dc=class extends N{},Oc=class extends N{},kc=class extends N{},Ac=class extends N{},jc=class extends N{},Mc=class extends N{},Nc=class extends M{constructor(){super(`Could not parse response content as the length limit was reached`)}},Pc=class extends M{constructor(){super(`Could not parse response content as the request was rejected by the content filter`)}},Fc=class extends Error{constructor(e){super(e)}};let Ic=/^[a-z][a-z0-9+.-]*:/i,Lc=e=>Ic.test(e),F=e=>(F=Array.isArray,F(e)),Rc=F;function zc(e){return typeof e==`object`?e??{}:{}}function Bc(e){if(!e)return!0;for(let t in e)return!1;return!0}function Vc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Hc(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}let Uc=(e,t)=>{if(typeof t!=`number`||!Number.isInteger(t))throw new M(`${e} must be an integer`);if(t<0)throw new M(`${e} must be a positive integer`);return t},Wc=e=>{try{return JSON.parse(e)}catch{return}},Gc=e=>new Promise(t=>setTimeout(t,e)),Kc=`6.9.0`,qc=()=>typeof window<`u`&&window.document!==void 0&&typeof navigator<`u`;function Jc(){return typeof Deno<`u`&&Deno.build!=null?`deno`:typeof EdgeRuntime<`u`?`edge`:Object.prototype.toString.call(globalThis.process===void 0?0:globalThis.process)===`[object process]`?`node`:`unknown`}let Yc=()=>{let e=Jc();if(e===`deno`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Kc,"X-Stainless-OS":Qc(Deno.build.os),"X-Stainless-Arch":Zc(Deno.build.arch),"X-Stainless-Runtime":`deno`,"X-Stainless-Runtime-Version":typeof Deno.version==`string`?Deno.version:Deno.version?.deno??`unknown`};if(typeof EdgeRuntime<`u`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Kc,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":`edge`,"X-Stainless-Runtime-Version":globalThis.process.version};if(e===`node`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Kc,"X-Stainless-OS":Qc(globalThis.process.platform??`unknown`),"X-Stainless-Arch":Zc(globalThis.process.arch??`unknown`),"X-Stainless-Runtime":`node`,"X-Stainless-Runtime-Version":globalThis.process.version??`unknown`};let t=Xc();return t?{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Kc,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Kc,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`unknown`,"X-Stainless-Runtime-Version":`unknown`}};function Xc(){if(typeof navigator>`u`||!navigator)return null;for(let{key:e,pattern:t}of[{key:`edge`,pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`chrome`,pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`firefox`,pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`safari`,pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=t.exec(navigator.userAgent);if(n){let t=n[1]||0,r=n[2]||0,i=n[3]||0;return{browser:e,version:`${t}.${r}.${i}`}}}return null}let Zc=e=>e===`x32`?`x32`:e===`x86_64`||e===`x64`?`x64`:e===`arm`?`arm`:e===`aarch64`||e===`arm64`?`arm64`:e?`other:${e}`:`unknown`,Qc=e=>(e=e.toLowerCase(),e.includes(`ios`)?`iOS`:e===`android`?`Android`:e===`darwin`?`MacOS`:e===`win32`?`Windows`:e===`freebsd`?`FreeBSD`:e===`openbsd`?`OpenBSD`:e===`linux`?`Linux`:e?`Other:${e}`:`Unknown`),$c,el=()=>$c??=Yc();function tl(){if(typeof fetch<`u`)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function nl(...e){let t=globalThis.ReadableStream;if(t===void 0)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function rl(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return nl({start(){},async pull(e){let{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function il(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function al(e){if(typeof e!=`object`||!e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),n=t.cancel();t.releaseLock(),await n}let ol=({headers:e,body:t})=>({bodyHeaders:{"content-type":`application/json`},body:JSON.stringify(t)}),sl=`RFC3986`,cl=e=>String(e),ll={RFC1738:e=>String(e).replace(/%20/g,`+`),RFC3986:cl},ul=(e,t)=>(ul=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),ul(e,t)),dl=(()=>{let e=[];for(let t=0;t<256;++t)e.push(`%`+((t<16?`0`:``)+t.toString(16)).toUpperCase());return e})(),fl=1024,pl=(e,t,n,r,i)=>{if(e.length===0)return e;let a=e;if(typeof e==`symbol`?a=Symbol.prototype.toString.call(e):typeof e!=`string`&&(a=String(e)),n===`iso-8859-1`)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return`%26%23`+parseInt(e.slice(2),16)+`%3B`});let o=``;for(let e=0;e<a.length;e+=fl){let t=a.length>=fl?a.slice(e,e+fl):a,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);if(r===45||r===46||r===95||r===126||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||i===`RFC1738`&&(r===40||r===41)){n[n.length]=t.charAt(e);continue}if(r<128){n[n.length]=dl[r];continue}if(r<2048){n[n.length]=dl[192|r>>6]+dl[128|r&63];continue}if(r<55296||r>=57344){n[n.length]=dl[224|r>>12]+dl[128|r>>6&63]+dl[128|r&63];continue}e+=1,r=65536+((r&1023)<<10|t.charCodeAt(e)&1023),n[n.length]=dl[240|r>>18]+dl[128|r>>12&63]+dl[128|r>>6&63]+dl[128|r&63]}o+=n.join(``)}return o};function ml(e){return!e||typeof e!=`object`?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function hl(e,t){if(F(e)){let n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}let gl={brackets(e){return String(e)+`[]`},comma:`comma`,indices(e,t){return String(e)+`[`+t+`]`},repeat(e){return String(e)}},_l=function(e,t){Array.prototype.push.apply(e,F(t)?t:[t])},vl,I={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:`indices`,charset:`utf-8`,charsetSentinel:!1,delimiter:`&`,encode:!0,encodeDotInKeys:!1,encoder:pl,encodeValuesOnly:!1,format:sl,formatter:cl,indices:!1,serializeDate(e){return(vl??=Function.prototype.call.bind(Date.prototype.toISOString))(e)},skipNulls:!1,strictNullHandling:!1};function yl(e){return typeof e==`string`||typeof e==`number`||typeof e==`boolean`||typeof e==`symbol`||typeof e==`bigint`}let bl={};function xl(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_){let v=e,y=_,b=0,ee=!1;for(;(y=y.get(bl))!==void 0&&!ee;){let t=y.get(e);if(b+=1,t!==void 0){if(t===b)throw RangeError(`Cyclic object value`);ee=!0}y.get(bl)===void 0&&(b=0)}if(typeof l==`function`?v=l(t,v):v instanceof Date?v=f?.(v):n===`comma`&&F(v)&&(v=hl(v,function(e){return e instanceof Date?f?.(e):e})),v===null){if(a)return c&&!h?c(t,I.encoder,g,`key`,p):t;v=``}if(yl(v)||ml(v)){if(c){let e=h?t:c(t,I.encoder,g,`key`,p);return[m?.(e)+`=`+m?.(c(v,I.encoder,g,`value`,p))]}return[m?.(t)+`=`+m?.(String(v))]}let x=[];if(v===void 0)return x;let S;if(n===`comma`&&F(v))h&&c&&(v=hl(v,c)),S=[{value:v.length>0?v.join(`,`)||null:void 0}];else if(F(l))S=l;else{let e=Object.keys(v);S=u?e.sort(u):e}let C=s?String(t).replace(/\./g,`%2E`):String(t),te=r&&F(v)&&v.length===1?C+`[]`:C;if(i&&F(v)&&v.length===0)return te+`[]`;for(let t=0;t<S.length;++t){let y=S[t],ee=typeof y==`object`&&y.value!==void 0?y.value:v[y];if(o&&ee===null)continue;let C=d&&s?y.replace(/\./g,`%2E`):y,ne=F(v)?typeof n==`function`?n(te,C):te:te+(d?`.`+C:`[`+C+`]`);_.set(e,b);let re=new WeakMap;re.set(bl,_),_l(x,xl(ee,ne,n,r,i,a,o,s,n===`comma`&&h&&F(v)?null:c,l,u,d,f,p,m,h,g,re))}return x}function Sl(e=I){if(e.allowEmptyArrays!==void 0&&typeof e.allowEmptyArrays!=`boolean`)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(e.encodeDotInKeys!==void 0&&typeof e.encodeDotInKeys!=`boolean`)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&e.encoder!==void 0&&typeof e.encoder!=`function`)throw TypeError(`Encoder has to be a function.`);let t=e.charset||I.charset;if(e.charset!==void 0&&e.charset!==`utf-8`&&e.charset!==`iso-8859-1`)throw TypeError(`The charset option must be either utf-8, iso-8859-1, or undefined`);let n=sl;if(e.format!==void 0){if(!ul(ll,e.format))throw TypeError(`Unknown format option provided.`);n=e.format}let r=ll[n],i=I.filter;(typeof e.filter==`function`||F(e.filter))&&(i=e.filter);let a;if(a=e.arrayFormat&&e.arrayFormat in gl?e.arrayFormat:`indices`in e?e.indices?`indices`:`repeat`:I.arrayFormat,`commaRoundTrip`in e&&typeof e.commaRoundTrip!=`boolean`)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let o=e.allowDots===void 0?e.encodeDotInKeys?!0:I.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix==`boolean`?e.addQueryPrefix:I.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof e.allowEmptyArrays==`boolean`?!!e.allowEmptyArrays:I.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:typeof e.charsetSentinel==`boolean`?e.charsetSentinel:I.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:e.delimiter===void 0?I.delimiter:e.delimiter,encode:typeof e.encode==`boolean`?e.encode:I.encode,encodeDotInKeys:typeof e.encodeDotInKeys==`boolean`?e.encodeDotInKeys:I.encodeDotInKeys,encoder:typeof e.encoder==`function`?e.encoder:I.encoder,encodeValuesOnly:typeof e.encodeValuesOnly==`boolean`?e.encodeValuesOnly:I.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:typeof e.serializeDate==`function`?e.serializeDate:I.serializeDate,skipNulls:typeof e.skipNulls==`boolean`?e.skipNulls:I.skipNulls,sort:typeof e.sort==`function`?e.sort:null,strictNullHandling:typeof e.strictNullHandling==`boolean`?e.strictNullHandling:I.strictNullHandling}}function Cl(e,t={}){let n=e,r=Sl(t),i,a;typeof r.filter==`function`?(a=r.filter,n=a(``,n)):F(r.filter)&&(a=r.filter,i=a);let o=[];if(typeof n!=`object`||!n)return``;let s=gl[r.arrayFormat],c=s===`comma`&&r.commaRoundTrip;i||=Object.keys(n),r.sort&&i.sort(r.sort);let l=new WeakMap;for(let e=0;e<i.length;++e){let t=i[e];r.skipNulls&&n[t]===null||_l(o,xl(n[t],t,s,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let u=o.join(r.delimiter),d=r.addQueryPrefix===!0?`?`:``;return r.charsetSentinel&&(r.charset===`iso-8859-1`?d+=`utf8=%26%2310003%3B&`:d+=`utf8=%E2%9C%93&`),u.length>0?d+u:``}function wl(e){let t=0;for(let n of e)t+=n.length;let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}let Tl;function El(e){let t;return(Tl??=(t=new globalThis.TextEncoder,t.encode.bind(t)))(e)}let Dl;function Ol(e){let t;return(Dl??=(t=new globalThis.TextDecoder,t.decode.bind(t)))(e)}var L,R,kl=class{constructor(){L.set(this,void 0),R.set(this,void 0),A(this,L,new Uint8Array,`f`),A(this,R,null,`f`)}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e==`string`?El(e):e;A(this,L,wl([j(this,L,`f`),t]),`f`);let n=[],r;for(;(r=Al(j(this,L,`f`),j(this,R,`f`)))!=null;){if(r.carriage&&j(this,R,`f`)==null){A(this,R,r.index,`f`);continue}if(j(this,R,`f`)!=null&&(r.index!==j(this,R,`f`)+1||r.carriage)){n.push(Ol(j(this,L,`f`).subarray(0,j(this,R,`f`)-1))),A(this,L,j(this,L,`f`).subarray(j(this,R,`f`)),`f`),A(this,R,null,`f`);continue}let e=j(this,R,`f`)===null?r.preceding:r.preceding-1,t=Ol(j(this,L,`f`).subarray(0,e));n.push(t),A(this,L,j(this,L,`f`).subarray(r.index),`f`),A(this,R,null,`f`)}return n}flush(){return j(this,L,`f`).length?this.decode(`
`):[]}};L=new WeakMap,R=new WeakMap,kl.NEWLINE_CHARS=new Set([`
`,`\r`]),kl.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Al(e,t){for(let n=t??0;n<e.length;n++){if(e[n]===10)return{preceding:n,index:n+1,carriage:!1};if(e[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function jl(e){for(let t=0;t<e.length-1;t++){if(e[t]===10&&e[t+1]===10||e[t]===13&&e[t+1]===13)return t+2;if(e[t]===13&&e[t+1]===10&&t+3<e.length&&e[t+2]===13&&e[t+3]===10)return t+4}return-1}let Ml={off:0,error:200,warn:300,info:400,debug:500},Nl=(e,t,n)=>{if(e){if(Vc(Ml,e))return e;z(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(Ml))}`)}};function Pl(){}function Fl(e,t,n){return!t||Ml[e]>Ml[n]?Pl:t[e].bind(t)}let Il={error:Pl,warn:Pl,info:Pl,debug:Pl},Ll=new WeakMap;function z(e){let t=e.logger,n=e.logLevel??`off`;if(!t)return Il;let r=Ll.get(t);if(r&&r[0]===n)return r[1];let i={error:Fl(`error`,t,n),warn:Fl(`warn`,t,n),info:Fl(`info`,t,n),debug:Fl(`debug`,t,n)};return Ll.set(t,[n,i]),i}let Rl=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,e.toLowerCase()===`authorization`||e.toLowerCase()===`cookie`||e.toLowerCase()===`set-cookie`?`***`:t])),`retryOfRequestLogID`in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var zl,Bl=class e{constructor(e,t,n){this.iterator=e,zl.set(this,void 0),this.controller=t,A(this,zl,n,`f`)}static fromSSEResponse(t,n,r){let i=!1,a=r?z(r):console;async function*o(){if(i)throw new M("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let e=!1;try{for await(let r of Vl(t,n))if(!e){if(r.data.startsWith(`[DONE]`)){e=!0;continue}if(r.event===null||!r.event.startsWith(`thread.`)){let e;try{e=JSON.parse(r.data)}catch(e){throw a.error(`Could not parse message into JSON:`,r.data),a.error(`From chunk:`,r.raw),e}if(e&&e.error)throw new N(void 0,e.error,void 0,t.headers);yield e}else{let e;try{e=JSON.parse(r.data)}catch(e){throw console.error(`Could not parse message into JSON:`,r.data),console.error(`From chunk:`,r.raw),e}if(r.event==`error`)throw new N(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}}e=!0}catch(e){if(xc(e))return;throw e}finally{e||n.abort()}}return new e(o,n,r)}static fromReadableStream(t,n,r){let i=!1;async function*a(){let e=new kl,n=il(t);for await(let t of n)for(let n of e.decode(t))yield n;for(let t of e.flush())yield t}async function*o(){if(i)throw new M("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let e=!1;try{for await(let t of a())e||t&&(yield JSON.parse(t));e=!0}catch(e){if(xc(e))return;throw e}finally{e||n.abort()}}return new e(o,n,r)}[(zl=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let t=[],n=[],r=this.iterator(),i=e=>({next:()=>{if(e.length===0){let e=r.next();t.push(e),n.push(e)}return e.shift()}});return[new e(()=>i(t),this.controller,j(this,zl,`f`)),new e(()=>i(n),this.controller,j(this,zl,`f`))]}toReadableStream(){let e=this,t;return nl({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{let{value:n,done:r}=await t.next();if(r)return e.close();let i=El(JSON.stringify(n)+`
`);e.enqueue(i)}catch(t){e.error(t)}},async cancel(){await t.return?.()}})}};async function*Vl(e,t){if(!e.body)throw t.abort(),globalThis.navigator!==void 0&&globalThis.navigator.product===`ReactNative`?new M(`The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api`):new M(`Attempted to iterate over a response with no body`);let n=new Ul,r=new kl,i=il(e.body);for await(let e of Hl(i))for(let t of r.decode(e)){let e=n.decode(t);e&&(yield e)}for(let e of r.flush()){let t=n.decode(e);t&&(yield t)}}async function*Hl(e){let t=new Uint8Array;for await(let n of e){if(n==null)continue;let e=n instanceof ArrayBuffer?new Uint8Array(n):typeof n==`string`?El(n):n,r=new Uint8Array(t.length+e.length);r.set(t),r.set(e,t.length),t=r;let i;for(;(i=jl(t))!==-1;)yield t.slice(0,i),t=t.slice(i)}t.length>0&&(yield t)}var Ul=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith(`\r`)&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(`:`))return null;let[t,n,r]=Wl(e,`:`);return r.startsWith(` `)&&(r=r.substring(1)),t===`event`?this.event=r:t===`data`&&this.data.push(r),null}};function Wl(e,t){let n=e.indexOf(t);return n===-1?[e,``,``]:[e.substring(0,n),t,e.substring(n+t.length)]}async function Gl(e,t){let{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:a}=t,o=await(async()=>{if(t.options.stream)return z(e).debug(`response`,n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):Bl.fromSSEResponse(n,t.controller,e);if(n.status===204)return null;if(t.options.__binaryResponse)return n;let r=n.headers.get(`content-type`)?.split(`;`)[0]?.trim();if(r?.includes(`application/json`)||r?.endsWith(`+json`)){let e=await n.json();return Kl(e,n)}return await n.text()})();return z(e).debug(`[${r}] response parsed`,Rl({retryOfRequestLogID:i,url:n.url,status:n.status,body:o,durationMs:Date.now()-a})),o}function Kl(e,t){return!e||typeof e!=`object`||Array.isArray(e)?e:Object.defineProperty(e,`_request_id`,{value:t.headers.get(`x-request-id`),enumerable:!1})}var ql,Jl=class e extends Promise{constructor(e,t,n=Gl){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,ql.set(this,void 0),A(this,ql,e,`f`)}_thenUnwrap(t){return new e(j(this,ql,`f`),this.responsePromise,async(e,n)=>Kl(t(await this.parseResponse(e,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get(`x-request-id`)}}parse(){return this.parsedPromise||=this.responsePromise.then(e=>this.parseResponse(j(this,ql,`f`),e)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};ql=new WeakMap;var Yl,Xl=class{constructor(e,t,n,r){Yl.set(this,void 0),A(this,Yl,e,`f`),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new M("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await j(this,Yl,`f`).requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Yl=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Zl=class extends Jl{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await Gl(e,t),t.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Ql=class extends Xl{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},B=class extends Xl{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...zc(this.options.query),after:t}}:null}},$l=class extends Xl{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||``}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...zc(this.options.query),after:e}}:null}};let eu=()=>{if(typeof File>`u`){let{process:e}=globalThis,t=typeof e?.versions?.node==`string`&&parseInt(e.versions.node.split(`.`))<20;throw Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":``))}};function tu(e,t,n){return eu(),new File(e,t??`unknown_file`,n)}function nu(e){return(typeof e==`object`&&!!e&&(`name`in e&&e.name&&String(e.name)||`url`in e&&e.url&&String(e.url)||`filename`in e&&e.filename&&String(e.filename)||`path`in e&&e.path&&String(e.path))||``).split(/[\\/]/).pop()||void 0}let ru=e=>typeof e==`object`&&!!e&&typeof e[Symbol.asyncIterator]==`function`,iu=async(e,t)=>du(e.body)?{...e,body:await cu(e.body,t)}:e,au=async(e,t)=>({...e,body:await cu(e.body,t)}),ou=new WeakMap;function su(e){let t=typeof e==`function`?e:e.fetch,n=ou.get(t);if(n)return n;let r=(async()=>{try{let e=`Response`in t?t.Response:(await t(`data:,`)).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch{return!0}})();return ou.set(t,r),r}let cu=async(e,t)=>{if(!await su(t))throw TypeError(`The provided fetch function does not support file uploads with the current global FormData class.`);let n=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>fu(n,e,t))),n},lu=e=>e instanceof Blob&&`name`in e,uu=e=>typeof e==`object`&&!!e&&(e instanceof Response||ru(e)||lu(e)),du=e=>{if(uu(e))return!0;if(Array.isArray(e))return e.some(du);if(e&&typeof e==`object`){for(let t in e)if(du(e[t]))return!0}return!1},fu=async(e,t,n)=>{if(n!==void 0){if(n==null)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n==`string`||typeof n==`number`||typeof n==`boolean`)e.append(t,String(n));else if(n instanceof Response)e.append(t,tu([await n.blob()],nu(n)));else if(ru(n))e.append(t,tu([await new Response(rl(n)).blob()],nu(n)));else if(lu(n))e.append(t,n,nu(n));else if(Array.isArray(n))await Promise.all(n.map(n=>fu(e,t+`[]`,n)));else if(typeof n==`object`)await Promise.all(Object.entries(n).map(([n,r])=>fu(e,`${t}[${n}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},pu=e=>typeof e==`object`&&!!e&&typeof e.size==`number`&&typeof e.type==`string`&&typeof e.text==`function`&&typeof e.slice==`function`&&typeof e.arrayBuffer==`function`,mu=e=>typeof e==`object`&&!!e&&typeof e.name==`string`&&typeof e.lastModified==`number`&&pu(e),hu=e=>typeof e==`object`&&!!e&&typeof e.url==`string`&&typeof e.blob==`function`;async function gu(e,t,n){if(eu(),e=await e,mu(e))return e instanceof File?e:tu([await e.arrayBuffer()],e.name);if(hu(e)){let r=await e.blob();return t||=new URL(e.url).pathname.split(/[\\/]/).pop(),tu(await _u(r),t,n)}let r=await _u(e);if(t||=nu(e),!n?.type){let e=r.find(e=>typeof e==`object`&&`type`in e&&e.type);typeof e==`string`&&(n={...n,type:e})}return tu(r,t,n)}async function _u(e){let t=[];if(typeof e==`string`||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(pu(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(ru(e))for await(let n of e)t.push(...await _u(n));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:``}${vu(e)}`)}return t}function vu(e){return typeof e!=`object`||!e?``:`; props: [${Object.getOwnPropertyNames(e).map(e=>`"${e}"`).join(`, `)}]`}var V=class{constructor(e){this._client=e}};function yu(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let bu=Object.freeze(Object.create(null)),H=((e=yu)=>function(t,...n){if(t.length===1)return t[0];let r=!1,i=[],a=t.reduce((t,a,o)=>{/[?#]/.test(a)&&(r=!0);let s=n[o],c=(r?encodeURIComponent:e)(``+s);return o!==n.length&&(s==null||typeof s==`object`&&s.toString===Object.getPrototypeOf(Object.getPrototypeOf(s.hasOwnProperty??bu)??bu)?.toString)&&(c=s+``,i.push({start:t.length+a.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(s).slice(8,-1)} is not a valid path parameter`})),t+a+(o===n.length?``:c)},``),o=a.split(/[?#]/,1)[0],s=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=s.exec(o))!==null;)i.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can\'t be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,n)=>{let r=` `.repeat(n.start-e),i=`^`.repeat(n.length);return e=n.start+n.length,t+r+i},``);throw new M(`Path parameters result in path with invalid segments:\n${i.map(e=>e.error).join(`
`)}\n${a}\n${t}`)}return a})(yu);var xu=class extends V{list(e,t={},n){return this._client.getAPIList(H`/chat/completions/${e}/messages`,B,{query:t,...n})}};function Su(e){return e!==void 0&&`function`in e&&e.function!==void 0}function Cu(e){return e?.$brand===`auto-parseable-response-format`}function wu(e){return e?.$brand===`auto-parseable-tool`}function Tu(e,t){return!t||!Au(t)?{...e,choices:e.choices.map(e=>(ju(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}:Eu(e,t)}function Eu(e,t){let n=e.choices.map(e=>{if(e.finish_reason===`length`)throw new Nc;if(e.finish_reason===`content_filter`)throw new Pc;return ju(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>Ou(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?Du(t,e.message.content):null}}});return{...e,choices:n}}function Du(e,t){return e.response_format?.type===`json_schema`&&e.response_format?.type===`json_schema`?`$parseRaw`in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function Ou(e,t){let n=e.tools?.find(e=>Su(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:wu(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}function ku(e,t){if(!e||!(`tools`in e)||!e.tools)return!1;let n=e.tools?.find(e=>Su(e)&&e.function?.name===t.function.name);return Su(n)&&(wu(n)||n?.function.strict||!1)}function Au(e){return Cu(e.response_format)?!0:e.tools?.some(e=>wu(e)||e.type===`function`&&e.function.strict===!0)??!1}function ju(e){for(let t of e||[])if(t.type!==`function`)throw new M(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}function Mu(e){for(let t of e??[]){if(t.type!==`function`)throw new M(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new M(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}let Nu=e=>e?.role===`assistant`,Pu=e=>e?.role===`tool`;var Fu,Iu,Lu,Ru,zu,Bu,Vu,Hu,Uu,Wu,Gu,Ku,qu,Ju=class{constructor(){Fu.add(this),this.controller=new AbortController,Iu.set(this,void 0),Lu.set(this,()=>{}),Ru.set(this,()=>{}),zu.set(this,void 0),Bu.set(this,()=>{}),Vu.set(this,()=>{}),Hu.set(this,{}),Uu.set(this,!1),Wu.set(this,!1),Gu.set(this,!1),Ku.set(this,!1),A(this,Iu,new Promise((e,t)=>{A(this,Lu,e,`f`),A(this,Ru,t,`f`)}),`f`),A(this,zu,new Promise((e,t)=>{A(this,Bu,e,`f`),A(this,Vu,t,`f`)}),`f`),j(this,Iu,`f`).catch(()=>{}),j(this,zu,`f`).catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit(`end`)},j(this,Fu,`m`,qu).bind(this))},0)}_connected(){this.ended||(j(this,Lu,`f`).call(this),this._emit(`connect`))}get ended(){return j(this,Uu,`f`)}get errored(){return j(this,Wu,`f`)}get aborted(){return j(this,Gu,`f`)}abort(){this.controller.abort()}on(e,t){return(j(this,Hu,`f`)[e]||(j(this,Hu,`f`)[e]=[])).push({listener:t}),this}off(e,t){let n=j(this,Hu,`f`)[e];if(!n)return this;let r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(j(this,Hu,`f`)[e]||(j(this,Hu,`f`)[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{A(this,Ku,!0,`f`),e!==`error`&&this.once(`error`,n),this.once(e,t)})}async done(){A(this,Ku,!0,`f`),await j(this,zu,`f`)}_emit(e,...t){if(j(this,Uu,`f`))return;e===`end`&&(A(this,Uu,!0,`f`),j(this,Bu,`f`).call(this));let n=j(this,Hu,`f`)[e];if(n&&(j(this,Hu,`f`)[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),e===`abort`){let e=t[0];!j(this,Ku,`f`)&&!n?.length&&Promise.reject(e),j(this,Ru,`f`).call(this,e),j(this,Vu,`f`).call(this,e),this._emit(`end`);return}if(e===`error`){let e=t[0];!j(this,Ku,`f`)&&!n?.length&&Promise.reject(e),j(this,Ru,`f`).call(this,e),j(this,Vu,`f`).call(this,e),this._emit(`end`)}}_emitFinal(){}};Iu=new WeakMap,Lu=new WeakMap,Ru=new WeakMap,zu=new WeakMap,Bu=new WeakMap,Vu=new WeakMap,Hu=new WeakMap,Uu=new WeakMap,Wu=new WeakMap,Gu=new WeakMap,Ku=new WeakMap,Fu=new WeakSet,qu=function(e){if(A(this,Wu,!0,`f`),e instanceof Error&&e.name===`AbortError`&&(e=new P),e instanceof P)return A(this,Gu,!0,`f`),this._emit(`abort`,e);if(e instanceof M)return this._emit(`error`,e);if(e instanceof Error){let t=new M(e.message);return t.cause=e,this._emit(`error`,t)}return this._emit(`error`,new M(String(e)))};function Yu(e){return typeof e.parse==`function`}var U,Xu,Zu,Qu,$u,ed,td,nd,rd=class extends Ju{constructor(){super(...arguments),U.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit(`chatCompletion`,e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if(`content`in e||(e.content=null),this.messages.push(e),t){if(this._emit(`message`,e),Pu(e)&&e.content)this._emit(`functionToolCallResult`,e.content);else if(Nu(e)&&e.tool_calls)for(let t of e.tool_calls)t.type===`function`&&this._emit(`functionToolCall`,t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new M(`stream ended without producing a ChatCompletion`);return e}async finalContent(){return await this.done(),j(this,U,`m`,Xu).call(this)}async finalMessage(){return await this.done(),j(this,U,`m`,Zu).call(this)}async finalFunctionToolCall(){return await this.done(),j(this,U,`m`,Qu).call(this)}async finalFunctionToolCallResult(){return await this.done(),j(this,U,`m`,$u).call(this)}async totalUsage(){return await this.done(),j(this,U,`m`,ed).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit(`finalChatCompletion`,e);let t=j(this,U,`m`,Zu).call(this);t&&this._emit(`finalMessage`,t);let n=j(this,U,`m`,Xu).call(this);n&&this._emit(`finalContent`,n);let r=j(this,U,`m`,Qu).call(this);r&&this._emit(`finalFunctionToolCall`,r);let i=j(this,U,`m`,$u).call(this);i!=null&&this._emit(`finalFunctionToolCallResult`,i),this._chatCompletions.some(e=>e.usage)&&this._emit(`totalUsage`,j(this,U,`m`,ed).call(this))}async _createChatCompletion(e,t,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort())),j(this,U,`m`,td).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Eu(i,t))}async _runChatCompletion(e,t,n){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){let r=`tool`,{tool_choice:i=`auto`,stream:a,...o}=t,s=typeof i!=`string`&&i.type===`function`&&i?.function?.name,{maxChatCompletions:c=10}=n||{},l=t.tools.map(e=>{if(wu(e)){if(!e.$callback)throw new M("Tool given to `.runTools()` that does not have an associated function");return{type:`function`,function:{function:e.$callback,name:e.function.name,description:e.function.description||``,parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of l)e.type===`function`&&(u[e.function.name||e.function.function.name]=e.function);let d=`tools`in t?l.map(e=>e.type===`function`?{type:`function`,function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){let t=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},n)).choices[0]?.message;if(!t)throw new M(`missing message in ChatCompletion response`);if(!t.tool_calls?.length)return;for(let e of t.tool_calls){if(e.type!==`function`)continue;let t=e.id,{name:n,arguments:i}=e.function,a=u[n];if(a){if(s&&s!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(s)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(`, `)}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let o;try{o=Yu(a)?await a.parse(i):i}catch(e){let n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}let c=await a.function(o,this),l=j(this,U,`m`,nd).call(this,c);if(this._addMessage({role:r,tool_call_id:t,content:l}),s)return}}}};U=new WeakSet,Xu=function(){return j(this,U,`m`,Zu).call(this).content??null},Zu=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Nu(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new M(`stream ended without producing a ChatCompletionMessage with role=assistant`)},Qu=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Nu(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>e.type===`function`).at(-1)?.function}},$u=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Pu(t)&&t.content!=null&&typeof t.content==`string`&&this.messages.some(e=>e.role===`assistant`&&e.tool_calls?.some(e=>e.type===`function`&&e.id===t.tool_call_id)))return t.content}},ed=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},td=function(e){if(e.n!=null&&e.n>1)throw new M(`ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.`)},nd=function(e){return typeof e==`string`?e:e===void 0?`undefined`:JSON.stringify(e)};var id=class e extends rd{static runTools(t,n,r){let i=new e,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`runTools`}};return i._run(()=>i._runTools(t,n,a)),i}_addMessage(e,t=!0){super._addMessage(e,t),Nu(e)&&e.content&&this._emit(`content`,e.content)}};let W={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511};var ad=class extends Error{},od=class extends Error{};function sd(e,t=W.ALL){if(typeof e!=`string`)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return cd(e.trim(),t)}let cd=(e,t)=>{let n=e.length,r=0,i=e=>{throw new ad(`${e} at position ${r}`)},a=e=>{throw new od(`${e} at position ${r}`)},o=()=>(d(),r>=n&&i(`Unexpected end of input`),e[r]===`"`?s():e[r]===`{`?c():e[r]===`[`?l():e.substring(r,r+4)===`null`||W.NULL&t&&n-r<4&&`null`.startsWith(e.substring(r))?(r+=4,null):e.substring(r,r+4)===`true`||W.BOOL&t&&n-r<4&&`true`.startsWith(e.substring(r))?(r+=4,!0):e.substring(r,r+5)===`false`||W.BOOL&t&&n-r<5&&`false`.startsWith(e.substring(r))?(r+=5,!1):e.substring(r,r+8)===`Infinity`||W.INFINITY&t&&n-r<8&&`Infinity`.startsWith(e.substring(r))?(r+=8,1/0):e.substring(r,r+9)===`-Infinity`||W.MINUS_INFINITY&t&&1<n-r&&n-r<9&&`-Infinity`.startsWith(e.substring(r))?(r+=9,-1/0):e.substring(r,r+3)===`NaN`||W.NAN&t&&n-r<3&&`NaN`.startsWith(e.substring(r))?(r+=3,NaN):u()),s=()=>{let o=r,s=!1;for(r++;r<n&&(e[r]!==`"`||s&&e[r-1]===`\\`);)s=e[r]===`\\`?!s:!1,r++;if(e.charAt(r)==`"`)try{return JSON.parse(e.substring(o,++r-Number(s)))}catch(e){a(String(e))}else if(W.STR&t)try{return JSON.parse(e.substring(o,r-Number(s))+`"`)}catch{return JSON.parse(e.substring(o,e.lastIndexOf(`\\`))+`"`)}i(`Unterminated string literal`)},c=()=>{r++,d();let a={};try{for(;e[r]!==`}`;){if(d(),r>=n&&W.OBJ&t)return a;let i=s();d(),r++;try{let e=o();Object.defineProperty(a,i,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(W.OBJ&t)return a;throw e}d(),e[r]===`,`&&r++}}catch{if(W.OBJ&t)return a;i(`Expected '}' at end of object`)}return r++,a},l=()=>{r++;let n=[];try{for(;e[r]!==`]`;)n.push(o()),d(),e[r]===`,`&&r++}catch{if(W.ARR&t)return n;i(`Expected ']' at end of array`)}return r++,n},u=()=>{if(r===0){e===`-`&&W.NUM&t&&i(`Not sure what '-' is`);try{return JSON.parse(e)}catch(n){if(W.NUM&t)try{return e[e.length-1]===`.`?JSON.parse(e.substring(0,e.lastIndexOf(`.`))):JSON.parse(e.substring(0,e.lastIndexOf(`e`)))}catch{}a(String(n))}}let o=r;for(e[r]===`-`&&r++;e[r]&&!`,]}`.includes(e[r]);)r++;r==n&&!(W.NUM&t)&&i(`Unterminated number literal`);try{return JSON.parse(e.substring(o,r))}catch{e.substring(o,r)===`-`&&W.NUM&t&&i(`Not sure what '-' is`);try{return JSON.parse(e.substring(o,e.lastIndexOf(`e`)))}catch(e){a(String(e))}}},d=()=>{for(;r<n&&` 
\r	`.includes(e[r]);)r++};return o()},ld=e=>sd(e,W.ALL^W.NUM);var G,ud,dd,fd,pd,md,hd,gd,_d,vd,yd,bd,xd=class e extends rd{constructor(e){super(),G.add(this),ud.set(this,void 0),dd.set(this,void 0),fd.set(this,void 0),A(this,ud,e,`f`),A(this,dd,[],`f`)}get currentChatCompletionSnapshot(){return j(this,fd,`f`)}static fromReadableStream(t){let n=new e(null);return n._run(()=>n._fromReadableStream(t)),n}static createChatCompletion(t,n,r){let i=new e(n);return i._run(()=>i._runChatCompletion(t,{...n,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createChatCompletion(e,t,n){super._createChatCompletion;let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort())),j(this,G,`m`,pd).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let e of i)j(this,G,`m`,hd).call(this,e);if(i.controller.signal?.aborted)throw new P;return this._addChatCompletion(j(this,G,`m`,vd).call(this))}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener(`abort`,()=>this.controller.abort())),j(this,G,`m`,pd).call(this),this._connected();let r=Bl.fromReadableStream(e,this.controller),i;for await(let e of r)i&&i!==e.id&&this._addChatCompletion(j(this,G,`m`,vd).call(this)),j(this,G,`m`,hd).call(this,e),i=e.id;if(r.controller.signal?.aborted)throw new P;return this._addChatCompletion(j(this,G,`m`,vd).call(this))}[(ud=new WeakMap,dd=new WeakMap,fd=new WeakMap,G=new WeakSet,pd=function(){this.ended||A(this,fd,void 0,`f`)},md=function(e){let t=j(this,dd,`f`)[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},j(this,dd,`f`)[e.index]=t,t)},hd=function(e){if(this.ended)return;let t=j(this,G,`m`,bd).call(this,e);this._emit(`chunk`,e,t);for(let n of e.choices){let e=t.choices[n.index];n.delta.content!=null&&e.message?.role===`assistant`&&e.message?.content&&(this._emit(`content`,n.delta.content,e.message.content),this._emit(`content.delta`,{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),n.delta.refusal!=null&&e.message?.role===`assistant`&&e.message?.refusal&&this._emit(`refusal.delta`,{delta:n.delta.refusal,snapshot:e.message.refusal}),n.logprobs?.content!=null&&e.message?.role===`assistant`&&this._emit(`logprobs.content.delta`,{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),n.logprobs?.refusal!=null&&e.message?.role===`assistant`&&this._emit(`logprobs.refusal.delta`,{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let r=j(this,G,`m`,md).call(this,e);e.finish_reason&&(j(this,G,`m`,_d).call(this,e),r.current_tool_call_index!=null&&j(this,G,`m`,gd).call(this,e,r.current_tool_call_index));for(let t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(j(this,G,`m`,_d).call(this,e),r.current_tool_call_index!=null&&j(this,G,`m`,gd).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(let t of n.delta.tool_calls??[]){let n=e.message.tool_calls?.[t.index];n?.type&&(n?.type===`function`?this._emit(`tool_calls.function.arguments.delta`,{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??``}):n?.type)}}},gd=function(e,t){if(j(this,G,`m`,md).call(this,e).done_tool_calls.has(t))return;let n=e.message.tool_calls?.[t];if(!n)throw Error(`no tool call snapshot`);if(!n.type)throw Error("tool call snapshot missing `type`");if(n.type===`function`){let e=j(this,ud,`f`)?.tools?.find(e=>Su(e)&&e.function.name===n.function.name);this._emit(`tool_calls.function.arguments.done`,{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:wu(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},_d=function(e){let t=j(this,G,`m`,md).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let n=j(this,G,`m`,yd).call(this);this._emit(`content.done`,{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit(`refusal.done`,{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit(`logprobs.content.done`,{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit(`logprobs.refusal.done`,{refusal:e.logprobs.refusal}))},vd=function(){if(this.ended)throw new M(`stream has ended, this shouldn't happen`);let e=j(this,fd,`f`);if(!e)throw new M(`request ended without sending any chunks`);return A(this,fd,void 0,`f`),A(this,dd,[],`f`),Sd(e,j(this,ud,`f`))},yd=function(){let e=j(this,ud,`f`)?.response_format;return Cu(e)?e:null},bd=function(e){var t,n,r,i;let a=j(this,fd,`f`),{choices:o,...s}=e;a?Object.assign(a,s):a=A(this,fd,{...s,choices:[]},`f`);for(let{delta:o,finish_reason:s,index:c,logprobs:l=null,...u}of e.choices){let e=a.choices[c];if(e||=a.choices[c]={finish_reason:s,index:c,message:{},logprobs:l,...u},l)if(!e.logprobs)e.logprobs=Object.assign({},l);else{let{content:r,refusal:i,...a}=l;Object.assign(e.logprobs,a),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),i&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...i))}if(s&&(e.finish_reason=s,j(this,ud,`f`)&&Au(j(this,ud,`f`)))){if(s===`length`)throw new Nc;if(s===`content_filter`)throw new Pc}if(Object.assign(e,u),!o)continue;let{content:d,refusal:f,function_call:p,role:m,tool_calls:h,...g}=o;if(Object.assign(e.message,g),f&&(e.message.refusal=(e.message.refusal||``)+f),m&&(e.message.role=m),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((r=e.message.function_call).arguments??(r.arguments=``),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),d&&(e.message.content=(e.message.content||``)+d,!e.message.refusal&&j(this,G,`m`,yd).call(this)&&(e.message.parsed=ld(e.message.content))),h){e.message.tool_calls||(e.message.tool_calls=[]);for(let{index:t,id:n,type:r,function:a,...o}of h){let s=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(s,o),n&&(s.id=n),r&&(s.type=r),a&&(s.function??={name:a.name??``,arguments:``}),a?.name&&(s.function.name=a.name),a?.arguments&&(s.function.arguments+=a.arguments,ku(j(this,ud,`f`),s)&&(s.function.parsed_arguments=ld(s.function.arguments)))}}}return a},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`chunk`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Bl(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Sd(e,t){let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...s}=e,c={...s,id:n,choices:r.map(({message:t,finish_reason:n,index:r,logprobs:i,...a})=>{if(!n)throw new M(`missing finish_reason for choice ${r}`);let{content:o=null,function_call:s,tool_calls:c,...l}=t,u=t.role;if(!u)throw new M(`missing role for choice ${r}`);if(s){let{arguments:e,name:c}=s;if(e==null)throw new M(`missing function_call.arguments for choice ${r}`);if(!c)throw new M(`missing function_call.name for choice ${r}`);return{...a,message:{content:o,function_call:{arguments:e,name:c},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}return c?{...a,index:r,finish_reason:n,logprobs:i,message:{...l,role:u,content:o,refusal:t.refusal??null,tool_calls:c.map((t,n)=>{let{function:i,type:a,id:o,...s}=t,{arguments:c,name:l,...u}=i||{};if(o==null)throw new M(`missing choices[${r}].tool_calls[${n}].id\n${Cd(e)}`);if(a==null)throw new M(`missing choices[${r}].tool_calls[${n}].type\n${Cd(e)}`);if(l==null)throw new M(`missing choices[${r}].tool_calls[${n}].function.name\n${Cd(e)}`);if(c==null)throw new M(`missing choices[${r}].tool_calls[${n}].function.arguments\n${Cd(e)}`);return{...s,id:o,type:a,function:{...u,name:l,arguments:c}}})}}:{...a,message:{...l,content:o,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}),created:i,model:a,object:`chat.completion`,...o?{system_fingerprint:o}:{}};return Tu(c,t)}function Cd(e){return JSON.stringify(e)}var wd=class e extends xd{static fromReadableStream(t){let n=new e(null);return n._run(()=>n._fromReadableStream(t)),n}static runTools(t,n,r){let i=new e(n),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`runTools`}};return i._run(()=>i._runTools(t,n,a)),i}},Td=class extends V{constructor(){super(...arguments),this.messages=new xu(this._client)}create(e,t){return this._client.post(`/chat/completions`,{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(H`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(H`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList(`/chat/completions`,B,{query:e,...t})}delete(e,t){return this._client.delete(H`/chat/completions/${e}`,t)}parse(e,t){return Mu(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":`chat.completions.parse`}})._thenUnwrap(t=>Eu(t,e))}runTools(e,t){return e.stream?wd.runTools(this._client,e,t):id.runTools(this._client,e,t)}stream(e,t){return xd.createChatCompletion(this._client,e,t)}};Td.Messages=xu;var Ed=class extends V{constructor(){super(...arguments),this.completions=new Td(this._client)}};Ed.Completions=Td;let Dd=Symbol(`brand.privateNullableHeaders`);function*Od(e){if(!e)return;if(Dd in e){let{values:t,nulls:n}=e;yield*t.entries();for(let e of n)yield[e,null];return}let t=!1,n;e instanceof Headers?n=e.entries():Rc(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let e of n){let n=e[0];if(typeof n!=`string`)throw TypeError(`expected header name to be a string`);let r=Rc(e[1])?e[1]:[e[1]],i=!1;for(let e of r)e!==void 0&&(t&&!i&&(i=!0,yield[n,null]),yield[n,e])}}let K=e=>{let t=new Headers,n=new Set;for(let r of e){let e=new Set;for(let[i,a]of Od(r)){let r=i.toLowerCase();e.has(r)||(t.delete(i),e.add(r)),a===null?(t.delete(i),n.add(r)):(t.append(i,a),n.delete(r))}}return{[Dd]:!0,values:t,nulls:n}};var kd=class extends V{create(e,t){return this._client.post(`/audio/speech`,{body:e,...t,headers:K([{Accept:`application/octet-stream`},t?.headers]),__binaryResponse:!0})}},Ad=class extends V{create(e,t){return this._client.post(`/audio/transcriptions`,au({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}},jd=class extends V{create(e,t){return this._client.post(`/audio/translations`,au({body:e,...t,__metadata:{model:e.model}},this._client))}},Md=class extends V{constructor(){super(...arguments),this.transcriptions=new Ad(this._client),this.translations=new jd(this._client),this.speech=new kd(this._client)}};Md.Transcriptions=Ad,Md.Translations=jd,Md.Speech=kd;var Nd=class extends V{create(e,t){return this._client.post(`/batches`,{body:e,...t})}retrieve(e,t){return this._client.get(H`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList(`/batches`,B,{query:e,...t})}cancel(e,t){return this._client.post(H`/batches/${e}/cancel`,t)}},Pd=class extends V{create(e,t){return this._client.post(`/assistants`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(H`/assistants/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(H`/assistants/${e}`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e={},t){return this._client.getAPIList(`/assistants`,B,{query:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}delete(e,t){return this._client.delete(H`/assistants/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},Fd=class extends V{create(e,t){return this._client.post(`/realtime/sessions`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},Id=class extends V{create(e,t){return this._client.post(`/realtime/transcription_sessions`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},Ld=class extends V{constructor(){super(...arguments),this.sessions=new Fd(this._client),this.transcriptionSessions=new Id(this._client)}};Ld.Sessions=Fd,Ld.TranscriptionSessions=Id;var Rd=class extends V{create(e,t){return this._client.post(`/chatkit/sessions`,{body:e,...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}cancel(e,t){return this._client.post(H`/chatkit/sessions/${e}/cancel`,{...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}},zd=class extends V{retrieve(e,t){return this._client.get(H`/chatkit/threads/${e}`,{...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}list(e={},t){return this._client.getAPIList(`/chatkit/threads`,$l,{query:e,...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}delete(e,t){return this._client.delete(H`/chatkit/threads/${e}`,{...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}listItems(e,t={},n){return this._client.getAPIList(H`/chatkit/threads/${e}/items`,$l,{query:t,...n,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},n?.headers])})}},Bd=class extends V{constructor(){super(...arguments),this.sessions=new Rd(this._client),this.threads=new zd(this._client)}};Bd.Sessions=Rd,Bd.Threads=zd;var Vd=class extends V{create(e,t,n){return this._client.post(H`/threads/${e}/messages`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{thread_id:r}=t;return this._client.get(H`/threads/${r}/messages/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{thread_id:r,...i}=t;return this._client.post(H`/threads/${r}/messages/${e}`,{body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(H`/threads/${e}/messages`,B,{query:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t,n){let{thread_id:r}=t;return this._client.delete(H`/threads/${r}/messages/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}},Hd=class extends V{retrieve(e,t,n){let{thread_id:r,run_id:i,...a}=t;return this._client.get(H`/threads/${r}/runs/${i}/steps/${e}`,{query:a,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t,n){let{thread_id:r,...i}=t;return this._client.getAPIList(H`/threads/${r}/runs/${e}/steps`,B,{query:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}};let Ud=e=>{if(typeof Buffer<`u`){let t=Buffer.from(e,`base64`);return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{let t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}},Wd=e=>{if(globalThis.process!==void 0)return{}?.[e]?.trim()??void 0;if(globalThis.Deno!==void 0)return globalThis.Deno.env?.get?.(e)?.trim()};var q,Gd,Kd,qd,Jd,Yd,Xd,Zd,Qd,$d,J,ef,tf,nf,rf,af,sf,cf,lf,uf,df,ff,pf,mf=class extends Ju{constructor(){super(...arguments),q.add(this),Kd.set(this,[]),qd.set(this,{}),Jd.set(this,{}),Yd.set(this,void 0),Xd.set(this,void 0),Zd.set(this,void 0),Qd.set(this,void 0),$d.set(this,void 0),J.set(this,void 0),ef.set(this,void 0),tf.set(this,void 0),nf.set(this,void 0)}[(Kd=new WeakMap,qd=new WeakMap,Jd=new WeakMap,Yd=new WeakMap,Xd=new WeakMap,Zd=new WeakMap,Qd=new WeakMap,$d=new WeakMap,J=new WeakMap,ef=new WeakMap,tf=new WeakMap,nf=new WeakMap,q=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`event`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new Gd;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener(`abort`,()=>this.controller.abort())),this._connected();let r=Bl.fromReadableStream(e,this.controller);for await(let e of r)j(this,q,`m`,rf).call(this,e);if(r.controller.signal?.aborted)throw new P;return this._addRun(j(this,q,`m`,af).call(this))}toReadableStream(){return new Bl(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){let i=new Gd;return i._run(()=>i._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createToolAssistantStream(e,t,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener(`abort`,()=>this.controller.abort()));let a={...n,stream:!0},o=await e.submitToolOutputs(t,a,{...r,signal:this.controller.signal});this._connected();for await(let e of o)j(this,q,`m`,rf).call(this,e);if(o.controller.signal?.aborted)throw new P;return this._addRun(j(this,q,`m`,af).call(this))}static createThreadAssistantStream(e,t,n){let r=new Gd;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":`stream`}})),r}static createAssistantStream(e,t,n,r){let i=new Gd;return i._run(()=>i._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}currentEvent(){return j(this,ef,`f`)}currentRun(){return j(this,tf,`f`)}currentMessageSnapshot(){return j(this,Yd,`f`)}currentRunStepSnapshot(){return j(this,nf,`f`)}async finalRunSteps(){return await this.done(),Object.values(j(this,qd,`f`))}async finalMessages(){return await this.done(),Object.values(j(this,Jd,`f`))}async finalRun(){if(await this.done(),!j(this,Xd,`f`))throw Error(`Final run was not received.`);return j(this,Xd,`f`)}async _createThreadAssistantStream(e,t,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let e of a)j(this,q,`m`,rf).call(this,e);if(a.controller.signal?.aborted)throw new P;return this._addRun(j(this,q,`m`,af).call(this))}async _createAssistantStream(e,t,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener(`abort`,()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(let e of o)j(this,q,`m`,rf).call(this,e);if(o.controller.signal?.aborted)throw new P;return this._addRun(j(this,q,`m`,af).call(this))}static accumulateDelta(e,t){for(let[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(t==null){e[n]=r;continue}if(n===`index`||n===`type`){e[n]=r;continue}if(typeof t==`string`&&typeof r==`string`)t+=r;else if(typeof t==`number`&&typeof r==`number`)t+=r;else if(Hc(t)&&Hc(r))t=this.accumulateDelta(t,r);else if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>typeof e==`string`||typeof e==`number`)){t.push(...r);continue}for(let e of r){if(!Hc(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let n=e.index;if(n==null)throw console.error(e),Error("Expected array delta entry to have an `index` property");if(typeof n!=`number`)throw Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);let r=t[n];r==null?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`);e[n]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}};Gd=mf,rf=function(e){if(!this.ended)switch(A(this,ef,e,`f`),j(this,q,`m`,lf).call(this,e),e.event){case`thread.created`:break;case`thread.run.created`:case`thread.run.queued`:case`thread.run.in_progress`:case`thread.run.requires_action`:case`thread.run.completed`:case`thread.run.incomplete`:case`thread.run.failed`:case`thread.run.cancelling`:case`thread.run.cancelled`:case`thread.run.expired`:j(this,q,`m`,pf).call(this,e);break;case`thread.run.step.created`:case`thread.run.step.in_progress`:case`thread.run.step.delta`:case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:j(this,q,`m`,cf).call(this,e);break;case`thread.message.created`:case`thread.message.in_progress`:case`thread.message.delta`:case`thread.message.completed`:case`thread.message.incomplete`:j(this,q,`m`,sf).call(this,e);break;case`error`:throw Error(`Encountered an error event in event processing - errors should be processed earlier`);default:}},af=function(){if(this.ended)throw new M(`stream has ended, this shouldn't happen`);if(!j(this,Xd,`f`))throw Error(`Final run has not been received`);return j(this,Xd,`f`)},sf=function(e){let[t,n]=j(this,q,`m`,df).call(this,e,j(this,Yd,`f`));A(this,Yd,t,`f`),j(this,Jd,`f`)[t.id]=t;for(let e of n){let n=t.content[e.index];n?.type==`text`&&this._emit(`textCreated`,n.text)}switch(e.event){case`thread.message.created`:this._emit(`messageCreated`,e.data);break;case`thread.message.in_progress`:break;case`thread.message.delta`:if(this._emit(`messageDelta`,e.data.delta,t),e.data.delta.content)for(let n of e.data.delta.content){if(n.type==`text`&&n.text){let e=n.text,r=t.content[n.index];if(r&&r.type==`text`)this._emit(`textDelta`,e,r.text);else throw Error(`The snapshot associated with this text delta is not text or missing`)}if(n.index!=j(this,Zd,`f`)){if(j(this,Qd,`f`))switch(j(this,Qd,`f`).type){case`text`:this._emit(`textDone`,j(this,Qd,`f`).text,j(this,Yd,`f`));break;case`image_file`:this._emit(`imageFileDone`,j(this,Qd,`f`).image_file,j(this,Yd,`f`));break}A(this,Zd,n.index,`f`)}A(this,Qd,t.content[n.index],`f`)}break;case`thread.message.completed`:case`thread.message.incomplete`:if(j(this,Zd,`f`)!==void 0){let t=e.data.content[j(this,Zd,`f`)];if(t)switch(t.type){case`image_file`:this._emit(`imageFileDone`,t.image_file,j(this,Yd,`f`));break;case`text`:this._emit(`textDone`,t.text,j(this,Yd,`f`));break}}j(this,Yd,`f`)&&this._emit(`messageDone`,e.data),A(this,Yd,void 0,`f`)}},cf=function(e){let t=j(this,q,`m`,uf).call(this,e);switch(A(this,nf,t,`f`),e.event){case`thread.run.step.created`:this._emit(`runStepCreated`,e.data);break;case`thread.run.step.delta`:let n=e.data.delta;if(n.step_details&&n.step_details.type==`tool_calls`&&n.step_details.tool_calls&&t.step_details.type==`tool_calls`)for(let e of n.step_details.tool_calls)e.index==j(this,$d,`f`)?this._emit(`toolCallDelta`,e,t.step_details.tool_calls[e.index]):(j(this,J,`f`)&&this._emit(`toolCallDone`,j(this,J,`f`)),A(this,$d,e.index,`f`),A(this,J,t.step_details.tool_calls[e.index],`f`),j(this,J,`f`)&&this._emit(`toolCallCreated`,j(this,J,`f`)));this._emit(`runStepDelta`,e.data.delta,t);break;case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:A(this,nf,void 0,`f`),e.data.step_details.type==`tool_calls`&&j(this,J,`f`)&&(this._emit(`toolCallDone`,j(this,J,`f`)),A(this,J,void 0,`f`)),this._emit(`runStepDone`,e.data,t);break;case`thread.run.step.in_progress`:break}},lf=function(e){j(this,Kd,`f`).push(e),this._emit(`event`,e)},uf=function(e){switch(e.event){case`thread.run.step.created`:return j(this,qd,`f`)[e.data.id]=e.data,e.data;case`thread.run.step.delta`:let t=j(this,qd,`f`)[e.data.id];if(!t)throw Error(`Received a RunStepDelta before creation of a snapshot`);let n=e.data;if(n.delta){let r=Gd.accumulateDelta(t,n.delta);j(this,qd,`f`)[e.data.id]=r}return j(this,qd,`f`)[e.data.id];case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:case`thread.run.step.in_progress`:j(this,qd,`f`)[e.data.id]=e.data;break}if(j(this,qd,`f`)[e.data.id])return j(this,qd,`f`)[e.data.id];throw Error(`No snapshot available`)},df=function(e,t){let n=[];switch(e.event){case`thread.message.created`:return[e.data,n];case`thread.message.delta`:if(!t)throw Error(`Received a delta with no existing snapshot (there should be one from message creation)`);let r=e.data;if(r.delta.content)for(let e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=j(this,q,`m`,ff).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case`thread.message.in_progress`:case`thread.message.completed`:case`thread.message.incomplete`:if(t)return[t,n];throw Error(`Received thread message event with no existing snapshot`)}throw Error(`Tried to accumulate a non-message event`)},ff=function(e,t){return Gd.accumulateDelta(t,e)},pf=function(e){switch(A(this,tf,e.data,`f`),e.event){case`thread.run.created`:break;case`thread.run.queued`:break;case`thread.run.in_progress`:break;case`thread.run.requires_action`:case`thread.run.cancelled`:case`thread.run.failed`:case`thread.run.completed`:case`thread.run.expired`:case`thread.run.incomplete`:A(this,Xd,e.data,`f`),j(this,J,`f`)&&(this._emit(`toolCallDone`,j(this,J,`f`)),A(this,J,void 0,`f`));break;case`thread.run.cancelling`:break}};var hf=class extends V{constructor(){super(...arguments),this.steps=new Hd(this._client)}create(e,t,n){let{include:r,...i}=t;return this._client.post(H`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){let{thread_id:r}=t;return this._client.get(H`/threads/${r}/runs/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{thread_id:r,...i}=t;return this._client.post(H`/threads/${r}/runs/${e}`,{body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(H`/threads/${e}/runs`,B,{query:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}cancel(e,t,n){let{thread_id:r}=t;return this._client.post(H`/threads/${r}/runs/${e}/cancel`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return mf.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let r=K([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(i.status){case`queued`:case`in_progress`:case`cancelling`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=a.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await Gc(e);break;case`requires_action`:case`incomplete`:case`cancelled`:case`completed`:case`failed`:case`expired`:return i}}}stream(e,t,n){return mf.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){let{thread_id:r,...i}=t;return this._client.post(H`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){let r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return mf.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};hf.Steps=Hd;var gf=class extends V{constructor(){super(...arguments),this.runs=new hf(this._client),this.messages=new Vd(this._client)}create(e={},t){return this._client.post(`/threads`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(H`/threads/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(H`/threads/${e}`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t){return this._client.delete(H`/threads/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}createAndRun(e,t){return this._client.post(`/threads/runs`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return mf.createThreadAssistantStream(e,this._client.beta.threads,t)}};gf.Runs=hf,gf.Messages=Vd;var _f=class extends V{constructor(){super(...arguments),this.realtime=new Ld(this._client),this.chatkit=new Bd(this._client),this.assistants=new Pd(this._client),this.threads=new gf(this._client)}};_f.Realtime=Ld,_f.ChatKit=Bd,_f.Assistants=Pd,_f.Threads=gf;var vf=class extends V{create(e,t){return this._client.post(`/completions`,{body:e,...t,stream:e.stream??!1})}},yf=class extends V{retrieve(e,t,n){let{container_id:r}=t;return this._client.get(H`/containers/${r}/files/${e}/content`,{...n,headers:K([{Accept:`application/binary`},n?.headers]),__binaryResponse:!0})}},bf=class extends V{constructor(){super(...arguments),this.content=new yf(this._client)}create(e,t,n){return this._client.post(H`/containers/${e}/files`,au({body:t,...n},this._client))}retrieve(e,t,n){let{container_id:r}=t;return this._client.get(H`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(H`/containers/${e}/files`,B,{query:t,...n})}delete(e,t,n){let{container_id:r}=t;return this._client.delete(H`/containers/${r}/files/${e}`,{...n,headers:K([{Accept:`*/*`},n?.headers])})}};bf.Content=yf;var xf=class extends V{constructor(){super(...arguments),this.files=new bf(this._client)}create(e,t){return this._client.post(`/containers`,{body:e,...t})}retrieve(e,t){return this._client.get(H`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList(`/containers`,B,{query:e,...t})}delete(e,t){return this._client.delete(H`/containers/${e}`,{...t,headers:K([{Accept:`*/*`},t?.headers])})}};xf.Files=bf;var Sf=class extends V{create(e,t,n){let{include:r,...i}=t;return this._client.post(H`/conversations/${e}/items`,{query:{include:r},body:i,...n})}retrieve(e,t,n){let{conversation_id:r,...i}=t;return this._client.get(H`/conversations/${r}/items/${e}`,{query:i,...n})}list(e,t={},n){return this._client.getAPIList(H`/conversations/${e}/items`,$l,{query:t,...n})}delete(e,t,n){let{conversation_id:r}=t;return this._client.delete(H`/conversations/${r}/items/${e}`,n)}},Cf=class extends V{constructor(){super(...arguments),this.items=new Sf(this._client)}create(e={},t){return this._client.post(`/conversations`,{body:e,...t})}retrieve(e,t){return this._client.get(H`/conversations/${e}`,t)}update(e,t,n){return this._client.post(H`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(H`/conversations/${e}`,t)}};Cf.Items=Sf;var wf=class extends V{create(e,t){let n=!!e.encoding_format,r=n?e.encoding_format:`base64`;n&&z(this._client).debug(`embeddings/user defined encoding_format:`,e.encoding_format);let i=this._client.post(`/embeddings`,{body:{...e,encoding_format:r},...t});return n?i:(z(this._client).debug(`embeddings/decoding base64 embeddings from base64`),i._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=Ud(t)}),e)))}},Tf=class extends V{retrieve(e,t,n){let{eval_id:r,run_id:i}=t;return this._client.get(H`/evals/${r}/runs/${i}/output_items/${e}`,n)}list(e,t,n){let{eval_id:r,...i}=t;return this._client.getAPIList(H`/evals/${r}/runs/${e}/output_items`,B,{query:i,...n})}},Ef=class extends V{constructor(){super(...arguments),this.outputItems=new Tf(this._client)}create(e,t,n){return this._client.post(H`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){let{eval_id:r}=t;return this._client.get(H`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(H`/evals/${e}/runs`,B,{query:t,...n})}delete(e,t,n){let{eval_id:r}=t;return this._client.delete(H`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){let{eval_id:r}=t;return this._client.post(H`/evals/${r}/runs/${e}`,n)}};Ef.OutputItems=Tf;var Df=class extends V{constructor(){super(...arguments),this.runs=new Ef(this._client)}create(e,t){return this._client.post(`/evals`,{body:e,...t})}retrieve(e,t){return this._client.get(H`/evals/${e}`,t)}update(e,t,n){return this._client.post(H`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList(`/evals`,B,{query:e,...t})}delete(e,t){return this._client.delete(H`/evals/${e}`,t)}};Df.Runs=Ef;var Of=class extends V{create(e,t){return this._client.post(`/files`,au({body:e,...t},this._client))}retrieve(e,t){return this._client.get(H`/files/${e}`,t)}list(e={},t){return this._client.getAPIList(`/files`,B,{query:e,...t})}delete(e,t){return this._client.delete(H`/files/${e}`,t)}content(e,t){return this._client.get(H`/files/${e}/content`,{...t,headers:K([{Accept:`application/binary`},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){let r=new Set([`processed`,`error`,`deleted`]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await Gc(t),a=await this.retrieve(e),Date.now()-i>n)throw new wc({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}},kf=class extends V{},Af=class extends V{run(e,t){return this._client.post(`/fine_tuning/alpha/graders/run`,{body:e,...t})}validate(e,t){return this._client.post(`/fine_tuning/alpha/graders/validate`,{body:e,...t})}},jf=class extends V{constructor(){super(...arguments),this.graders=new Af(this._client)}};jf.Graders=Af;var Mf=class extends V{create(e,t,n){return this._client.getAPIList(H`/fine_tuning/checkpoints/${e}/permissions`,Ql,{body:t,method:`post`,...n})}retrieve(e,t={},n){return this._client.get(H`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){let{fine_tuned_model_checkpoint:r}=t;return this._client.delete(H`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}},Nf=class extends V{constructor(){super(...arguments),this.permissions=new Mf(this._client)}};Nf.Permissions=Mf;var Pf=class extends V{list(e,t={},n){return this._client.getAPIList(H`/fine_tuning/jobs/${e}/checkpoints`,B,{query:t,...n})}},Ff=class extends V{constructor(){super(...arguments),this.checkpoints=new Pf(this._client)}create(e,t){return this._client.post(`/fine_tuning/jobs`,{body:e,...t})}retrieve(e,t){return this._client.get(H`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList(`/fine_tuning/jobs`,B,{query:e,...t})}cancel(e,t){return this._client.post(H`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(H`/fine_tuning/jobs/${e}/events`,B,{query:t,...n})}pause(e,t){return this._client.post(H`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(H`/fine_tuning/jobs/${e}/resume`,t)}};Ff.Checkpoints=Pf;var If=class extends V{constructor(){super(...arguments),this.methods=new kf(this._client),this.jobs=new Ff(this._client),this.checkpoints=new Nf(this._client),this.alpha=new jf(this._client)}};If.Methods=kf,If.Jobs=Ff,If.Checkpoints=Nf,If.Alpha=jf;var Lf=class extends V{},Rf=class extends V{constructor(){super(...arguments),this.graderModels=new Lf(this._client)}};Rf.GraderModels=Lf;var zf=class extends V{createVariation(e,t){return this._client.post(`/images/variations`,au({body:e,...t},this._client))}edit(e,t){return this._client.post(`/images/edits`,au({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post(`/images/generations`,{body:e,...t,stream:e.stream??!1})}},Bf=class extends V{retrieve(e,t){return this._client.get(H`/models/${e}`,t)}list(e){return this._client.getAPIList(`/models`,Ql,e)}delete(e,t){return this._client.delete(H`/models/${e}`,t)}},Vf=class extends V{create(e,t){return this._client.post(`/moderations`,{body:e,...t})}},Hf=class extends V{accept(e,t,n){return this._client.post(H`/realtime/calls/${e}/accept`,{body:t,...n,headers:K([{Accept:`*/*`},n?.headers])})}hangup(e,t){return this._client.post(H`/realtime/calls/${e}/hangup`,{...t,headers:K([{Accept:`*/*`},t?.headers])})}refer(e,t,n){return this._client.post(H`/realtime/calls/${e}/refer`,{body:t,...n,headers:K([{Accept:`*/*`},n?.headers])})}reject(e,t={},n){return this._client.post(H`/realtime/calls/${e}/reject`,{body:t,...n,headers:K([{Accept:`*/*`},n?.headers])})}},Uf=class extends V{create(e,t){return this._client.post(`/realtime/client_secrets`,{body:e,...t})}},Wf=class extends V{constructor(){super(...arguments),this.clientSecrets=new Uf(this._client),this.calls=new Hf(this._client)}};Wf.ClientSecrets=Uf,Wf.Calls=Hf;function Gf(e,t){return!t||!Jf(t)?{...e,output_parsed:null,output:e.output.map(e=>e.type===`function_call`?{...e,parsed_arguments:null}:e.type===`message`?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}:Kf(e,t)}function Kf(e,t){let n=e.output.map(e=>{if(e.type===`function_call`)return{...e,parsed_arguments:Zf(t,e)};if(e.type===`message`){let n=e.content.map(e=>e.type===`output_text`?{...e,parsed:qf(t,e.text)}:e);return{...e,content:n}}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,`output_text`)||Qf(r),Object.defineProperty(r,`output_parsed`,{enumerable:!0,get(){for(let e of r.output)if(e.type===`message`){for(let t of e.content)if(t.type===`output_text`&&t.parsed!==null)return t.parsed}return null}}),r}function qf(e,t){return e.text?.format?.type===`json_schema`?`$parseRaw`in e.text?.format?(e.text?.format).$parseRaw(t):JSON.parse(t):null}function Jf(e){return!!Cu(e.text?.format)}function Yf(e){return e?.$brand===`auto-parseable-tool`}function Xf(e,t){return e.find(e=>e.type===`function`&&e.name===t)}function Zf(e,t){let n=Xf(e.tools??[],t.name);return{...t,...t,parsed_arguments:Yf(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function Qf(e){let t=[];for(let n of e.output)if(n.type===`message`)for(let e of n.content)e.type===`output_text`&&t.push(e.text);e.output_text=t.join(``)}var $f,ep,tp,np,rp,ip,ap,op,sp=class e extends Ju{constructor(e){super(),$f.add(this),ep.set(this,void 0),tp.set(this,void 0),np.set(this,void 0),A(this,ep,e,`f`)}static createResponse(t,n,r){let i=new e(n);return i._run(()=>i._createOrRetrieveResponse(t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createOrRetrieveResponse(e,t,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort())),j(this,$f,`m`,rp).call(this);let i,a=null;`response_id`in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let e of i)j(this,$f,`m`,ip).call(this,e,a);if(i.controller.signal?.aborted)throw new P;return j(this,$f,`m`,ap).call(this)}[(ep=new WeakMap,tp=new WeakMap,np=new WeakMap,$f=new WeakSet,rp=function(){this.ended||A(this,tp,void 0,`f`)},ip=function(e,t){if(this.ended)return;let n=(e,n)=>{(t==null||n.sequence_number>t)&&this._emit(e,n)},r=j(this,$f,`m`,op).call(this,e);switch(n(`event`,e),e.type){case`response.output_text.delta`:{let t=r.output[e.output_index];if(!t)throw new M(`missing output at index ${e.output_index}`);if(t.type===`message`){let r=t.content[e.content_index];if(!r)throw new M(`missing content at index ${e.content_index}`);if(r.type!==`output_text`)throw new M(`expected content to be 'output_text', got ${r.type}`);n(`response.output_text.delta`,{...e,snapshot:r.text})}break}case`response.function_call_arguments.delta`:{let t=r.output[e.output_index];if(!t)throw new M(`missing output at index ${e.output_index}`);t.type===`function_call`&&n(`response.function_call_arguments.delta`,{...e,snapshot:t.arguments});break}default:n(e.type,e);break}},ap=function(){if(this.ended)throw new M(`stream has ended, this shouldn't happen`);let e=j(this,tp,`f`);if(!e)throw new M(`request ended without sending any events`);A(this,tp,void 0,`f`);let t=cp(e,j(this,ep,`f`));return A(this,np,t,`f`),t},op=function(e){let t=j(this,tp,`f`);if(!t){if(e.type!==`response.created`)throw new M(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=A(this,tp,e.response,`f`),t}switch(e.type){case`response.output_item.added`:t.output.push(e.item);break;case`response.content_part.added`:{let n=t.output[e.output_index];if(!n)throw new M(`missing output at index ${e.output_index}`);let r=n.type,i=e.part;r===`message`&&i.type!==`reasoning_text`?n.content.push(i):r===`reasoning`&&i.type===`reasoning_text`&&(n.content||=[],n.content.push(i));break}case`response.output_text.delta`:{let n=t.output[e.output_index];if(!n)throw new M(`missing output at index ${e.output_index}`);if(n.type===`message`){let t=n.content[e.content_index];if(!t)throw new M(`missing content at index ${e.content_index}`);if(t.type!==`output_text`)throw new M(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case`response.function_call_arguments.delta`:{let n=t.output[e.output_index];if(!n)throw new M(`missing output at index ${e.output_index}`);n.type===`function_call`&&(n.arguments+=e.delta);break}case`response.reasoning_text.delta`:{let n=t.output[e.output_index];if(!n)throw new M(`missing output at index ${e.output_index}`);if(n.type===`reasoning`){let t=n.content?.[e.content_index];if(!t)throw new M(`missing content at index ${e.content_index}`);if(t.type!==`reasoning_text`)throw new M(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case`response.completed`:A(this,tp,e.response,`f`);break}return t},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`event`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=j(this,np,`f`);if(!e)throw new M(`stream ended without producing a ChatCompletion`);return e}};function cp(e,t){return Gf(e,t)}var lp=class extends V{list(e,t={},n){return this._client.getAPIList(H`/responses/${e}/input_items`,B,{query:t,...n})}},up=class extends V{count(e={},t){return this._client.post(`/responses/input_tokens`,{body:e,...t})}},dp=class extends V{constructor(){super(...arguments),this.inputItems=new lp(this._client),this.inputTokens=new up(this._client)}create(e,t){return this._client.post(`/responses`,{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>(`object`in e&&e.object===`response`&&Qf(e),e))}retrieve(e,t={},n){return this._client.get(H`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(e=>(`object`in e&&e.object===`response`&&Qf(e),e))}delete(e,t){return this._client.delete(H`/responses/${e}`,{...t,headers:K([{Accept:`*/*`},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>Kf(t,e))}stream(e,t){return sp.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(H`/responses/${e}/cancel`,t)}};dp.InputItems=lp,dp.InputTokens=up;var fp=class extends V{create(e,t,n){return this._client.post(H`/uploads/${e}/parts`,au({body:t,...n},this._client))}},pp=class extends V{constructor(){super(...arguments),this.parts=new fp(this._client)}create(e,t){return this._client.post(`/uploads`,{body:e,...t})}cancel(e,t){return this._client.post(H`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(H`/uploads/${e}/complete`,{body:t,...n})}};pp.Parts=fp;let mp=async e=>{let t=await Promise.allSettled(e),n=t.filter(e=>e.status===`rejected`);if(n.length){for(let e of n)console.error(e.reason);throw Error(`${n.length} promise(s) failed - see the above errors`)}let r=[];for(let e of t)e.status===`fulfilled`&&r.push(e.value);return r};var hp=class extends V{create(e,t,n){return this._client.post(H`/vector_stores/${e}/file_batches`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{vector_store_id:r}=t;return this._client.get(H`/vector_stores/${r}/file_batches/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}cancel(e,t,n){let{vector_store_id:r}=t;return this._client.post(H`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){let{vector_store_id:r,...i}=t;return this._client.getAPIList(H`/vector_stores/${r}/file_batches/${e}/files`,B,{query:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async poll(e,t,n){let r=K([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(i.status){case`in_progress`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=a.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await Gc(e);break;case`failed`:case`cancelled`:case`completed`:return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=r?.maxConcurrency??5,a=Math.min(i,t.length),o=this._client,s=t.values(),c=[...n];async function l(e){for(let t of e){let e=await o.files.create({file:t,purpose:`assistants`},r);c.push(e.id)}}let u=Array(a).fill(s).map(l);return await mp(u),await this.createAndPoll(e,{file_ids:c})}},gp=class extends V{create(e,t,n){return this._client.post(H`/vector_stores/${e}/files`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{vector_store_id:r}=t;return this._client.get(H`/vector_stores/${r}/files/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{vector_store_id:r,...i}=t;return this._client.post(H`/vector_stores/${r}/files/${e}`,{body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(H`/vector_stores/${e}/files`,B,{query:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t,n){let{vector_store_id:r}=t;return this._client.delete(H`/vector_stores/${r}/files/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){let r=K([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),a=i.data;switch(a.status){case`in_progress`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=i.response.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await Gc(e);break;case`failed`:case`completed`:return a}}}async upload(e,t,n){let r=await this._client.files.create({file:t,purpose:`assistants`},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){let r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){let{vector_store_id:r}=t;return this._client.getAPIList(H`/vector_stores/${r}/files/${e}/content`,Ql,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}},_p=class extends V{constructor(){super(...arguments),this.files=new gp(this._client),this.fileBatches=new hp(this._client)}create(e,t){return this._client.post(`/vector_stores`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(H`/vector_stores/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(H`/vector_stores/${e}`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e={},t){return this._client.getAPIList(`/vector_stores`,B,{query:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}delete(e,t){return this._client.delete(H`/vector_stores/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}search(e,t,n){return this._client.getAPIList(H`/vector_stores/${e}/search`,Ql,{body:t,method:`post`,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}};_p.Files=gp,_p.FileBatches=hp;var vp=class extends V{create(e,t){return this._client.post(`/videos`,iu({body:e,...t},this._client))}retrieve(e,t){return this._client.get(H`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList(`/videos`,$l,{query:e,...t})}delete(e,t){return this._client.delete(H`/videos/${e}`,t)}downloadContent(e,t={},n){return this._client.get(H`/videos/${e}/content`,{query:t,...n,headers:K([{Accept:`application/binary`},n?.headers]),__binaryResponse:!0})}remix(e,t,n){return this._client.post(H`/videos/${e}/remix`,iu({body:t,...n},this._client))}},yp,bp,xp,Sp=class extends V{constructor(){super(...arguments),yp.add(this)}async unwrap(e,t,n=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,r=300){if(typeof crypto>`u`||typeof crypto.subtle.importKey!=`function`||typeof crypto.subtle.verify!=`function`)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");j(this,yp,`m`,bp).call(this,n);let i=K([t]).values,a=j(this,yp,`m`,xp).call(this,i,`webhook-signature`),o=j(this,yp,`m`,xp).call(this,i,`webhook-timestamp`),s=j(this,yp,`m`,xp).call(this,i,`webhook-id`),c=parseInt(o,10);if(isNaN(c))throw new Fc(`Invalid webhook timestamp format`);let l=Math.floor(Date.now()/1e3);if(l-c>r)throw new Fc(`Webhook timestamp is too old`);if(c>l+r)throw new Fc(`Webhook timestamp is too new`);let u=a.split(` `).map(e=>e.startsWith(`v1,`)?e.substring(3):e),d=n.startsWith(`whsec_`)?Buffer.from(n.replace(`whsec_`,``),`base64`):Buffer.from(n,`utf-8`),f=s?`${s}.${o}.${e}`:`${o}.${e}`,p=await crypto.subtle.importKey(`raw`,d,{name:`HMAC`,hash:`SHA-256`},!1,[`verify`]);for(let e of u)try{let t=Buffer.from(e,`base64`);if(await crypto.subtle.verify(`HMAC`,p,t,new TextEncoder().encode(f)))return}catch{continue}throw new Fc(`The given webhook signature does not match the expected signature`)}};yp=new WeakSet,bp=function(e){if(typeof e!=`string`||e.length===0)throw Error(`The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function`)},xp=function(e,t){if(!e)throw Error(`Headers are required`);let n=e.get(t);if(n==null)throw Error(`Missing required header: ${t}`);return n};var Cp,wp,Tp,Ep,Y=class{constructor({baseURL:e=Wd(`OPENAI_BASE_URL`),apiKey:t=Wd(`OPENAI_API_KEY`),organization:n=Wd(`OPENAI_ORG_ID`)??null,project:r=Wd(`OPENAI_PROJECT_ID`)??null,webhookSecret:i=Wd(`OPENAI_WEBHOOK_SECRET`)??null,...a}={}){if(Cp.add(this),Tp.set(this,void 0),this.completions=new vf(this),this.chat=new Ed(this),this.embeddings=new wf(this),this.files=new Of(this),this.images=new zf(this),this.audio=new Md(this),this.moderations=new Vf(this),this.models=new Bf(this),this.fineTuning=new If(this),this.graders=new Rf(this),this.vectorStores=new _p(this),this.webhooks=new Sp(this),this.beta=new _f(this),this.batches=new Nd(this),this.uploads=new pp(this),this.responses=new dp(this),this.realtime=new Wf(this),this.conversations=new Cf(this),this.evals=new Df(this),this.containers=new xf(this),this.videos=new vp(this),t===void 0)throw new M("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:t,organization:n,project:r,webhookSecret:i,...a,baseURL:e||`https://api.openai.com/v1`};if(!o.dangerouslyAllowBrowser&&qc())throw new M(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??wp.DEFAULT_TIMEOUT,this.logger=o.logger??console;let s=`warn`;this.logLevel=s,this.logLevel=Nl(o.logLevel,`ClientOptions.logLevel`,this)??Nl(Wd(`OPENAI_LOG`),`process.env['OPENAI_LOG']`,this)??s,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??tl(),A(this,Tp,ol,`f`),this._options=o,this.apiKey=typeof t==`string`?t:`Missing Key`,this.organization=n,this.project=r,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return K([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Cl(e,{arrayFormat:`brackets`})}getUserAgent(){return`${this.constructor.name}/JS ${Kc}`}defaultIdempotencyKey(){return`stainless-node-retry-${bc()}`}makeStatusError(e,t,n,r){return N.generate(e,t,n,r)}async _callApiKey(){let e=this._options.apiKey;if(typeof e!=`function`)return!1;let t;try{t=await e()}catch(e){throw e instanceof M?e:new M(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if(typeof t!=`string`||!t)throw new M(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,n){let r=!j(this,Cp,`m`,Ep).call(this)&&n||this.baseURL,i=Lc(e)?new URL(e):new URL(r+(r.endsWith(`/`)&&e.startsWith(`/`)?e.slice(1):e)),a=this.defaultQuery();return Bc(a)||(t={...a,...t}),typeof t==`object`&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest(`get`,e,t)}post(e,t){return this.methodRequest(`post`,e,t)}patch(e,t){return this.methodRequest(`patch`,e,t)}put(e,t){return this.methodRequest(`put`,e,t)}delete(e,t){return this.methodRequest(`delete`,e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new Jl(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let r=await e,i=r.maxRetries??this.maxRetries;t??=i,await this.prepareOptions(r);let{req:a,url:o,timeout:s}=await this.buildRequest(r,{retryCount:i-t});await this.prepareRequest(a,{url:o,options:r});let c=`log_`+(Math.random()*(1<<24)|0).toString(16).padStart(6,`0`),l=n===void 0?``:`, retryOf: ${n}`,u=Date.now();if(z(this).debug(`[${c}] sending request`,Rl({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:a.headers})),r.signal?.aborted)throw new P;let d=new AbortController,f=await this.fetchWithTimeout(o,a,s,d).catch(Sc),p=Date.now();if(f instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new P;let i=xc(f)||/timed? ?out/i.test(String(f)+(`cause`in f?String(f.cause):``));if(t)return z(this).info(`[${c}] connection ${i?`timed out`:`failed`} - ${e}`),z(this).debug(`[${c}] connection ${i?`timed out`:`failed`} (${e})`,Rl({retryOfRequestLogID:n,url:o,durationMs:p-u,message:f.message})),this.retryRequest(r,t,n??c);throw z(this).info(`[${c}] connection ${i?`timed out`:`failed`} - error; no more retries left`),z(this).debug(`[${c}] connection ${i?`timed out`:`failed`} (error; no more retries left)`,Rl({retryOfRequestLogID:n,url:o,durationMs:p-u,message:f.message})),i?new wc:new Cc({cause:f})}let m=[...f.headers.entries()].filter(([e])=>e===`x-request-id`).map(([e,t])=>`, `+e+`: `+JSON.stringify(t)).join(``),h=`[${c}${l}${m}] ${a.method} ${o} ${f.ok?`succeeded`:`failed`} with status ${f.status} in ${p-u}ms`;if(!f.ok){let e=await this.shouldRetry(f);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await al(f.body),z(this).info(`${h} - ${e}`),z(this).debug(`[${c}] response error (${e})`,Rl({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:p-u})),this.retryRequest(r,t,n??c,f.headers)}let i=e?`error; no more retries left`:`error; not retryable`;z(this).info(`${h} - ${i}`);let a=await f.text().catch(e=>Sc(e).message),o=Wc(a),s=o?void 0:a;throw z(this).debug(`[${c}] response error (${i})`,Rl({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,message:s,durationMs:Date.now()-u})),this.makeStatusError(f.status,o,s,f.headers)}return z(this).info(h),z(this).debug(`[${c}] response start`,Rl({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:p-u})),{response:f,options:r,controller:d,requestLogID:c,retryOfRequestLogID:n,startTime:u}}getAPIList(e,t,n){return this.requestAPIList(t,{method:`get`,path:e,...n})}requestAPIList(e,t){let n=this.makeRequest(t,null,void 0);return new Zl(this,n,e)}async fetchWithTimeout(e,t,n,r){let{signal:i,method:a,...o}=t||{};i&&i.addEventListener(`abort`,()=>r.abort());let s=setTimeout(()=>r.abort(),n),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body==`object`&&o.body!==null&&Symbol.asyncIterator in o.body,l={signal:r.signal,...c?{duplex:`half`}:{},method:`GET`,...o};a&&(l.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(s)}}async shouldRetry(e){let t=e.headers.get(`x-should-retry`);return t===`true`?!0:t===`false`?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let i,a=r?.get(`retry-after-ms`);if(a){let e=parseFloat(a);Number.isNaN(e)||(i=e)}let o=r?.get(`retry-after`);if(o&&!i){let e=parseFloat(o);i=Number.isNaN(e)?Date.parse(o)-Date.now():e*1e3}if(!(i&&0<=i&&i<60*1e3)){let n=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Gc(i),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let n=t-e,r=Math.min(.5*2**n,8),i=1-Math.random()*.25;return r*i*1e3}async buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:r,path:i,query:a,defaultBaseURL:o}=n,s=this.buildURL(i,a,o);`timeout`in n&&Uc(`timeout`,n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:c,body:l}=this.buildBody({options:n}),u=await this.buildHeaders({options:e,method:r,bodyHeaders:c,retryCount:t});return{req:{method:r,headers:u,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:`half`},...l&&{body:l},...this.fetchOptions??{},...n.fetchOptions??{}},url:s,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let i={};this.idempotencyHeader&&t!==`get`&&(e.idempotencyKey||=this.defaultIdempotencyKey(),i[this.idempotencyHeader]=e.idempotencyKey);let a=K([i,{Accept:`application/json`,"User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...el(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=K([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e==`string`&&n.values.has(`content-type`)||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e==`object`&&(Symbol.asyncIterator in e||Symbol.iterator in e&&`next`in e&&typeof e.next==`function`)?{bodyHeaders:void 0,body:rl(e)}:j(this,Tp,`f`).call(this,{body:e,headers:n})}};wp=Y,Tp=new WeakMap,Cp=new WeakSet,Ep=function(){return this.baseURL!==`https://api.openai.com/v1`},Y.OpenAI=wp,Y.DEFAULT_TIMEOUT=6e5,Y.OpenAIError=M,Y.APIError=N,Y.APIConnectionError=Cc,Y.APIConnectionTimeoutError=wc,Y.APIUserAbortError=P,Y.NotFoundError=Oc,Y.ConflictError=kc,Y.RateLimitError=jc,Y.BadRequestError=Tc,Y.AuthenticationError=Ec,Y.InternalServerError=Mc,Y.PermissionDeniedError=Dc,Y.UnprocessableEntityError=Ac,Y.InvalidWebhookSignatureError=Fc,Y.toFile=gu,Y.Completions=vf,Y.Chat=Ed,Y.Embeddings=wf,Y.Files=Of,Y.Images=zf,Y.Audio=Md,Y.Moderations=Vf,Y.Models=Bf,Y.FineTuning=If,Y.Graders=Rf,Y.VectorStores=_p,Y.Webhooks=Sp,Y.Beta=_f,Y.Batches=Nd,Y.Uploads=pp,Y.Responses=dp,Y.Realtime=Wf,Y.Conversations=Cf,Y.Evals=Df,Y.Containers=xf,Y.Videos=vp;var Dp=t({OpenAILlmNode:()=>Op}),Op=class extends n{constructor(...e){super(...e),this.type=`openaiLlm`,this.label=`AI 大模型`,this.description=`调用 OpenAI 兼容的大模型 API`,this.category=`AI`}defineInputs(){return[{name:`baseUrl`,type:`string`,description:`API 基础 URL`,required:!0,defaultValue:`https://api.openai.com/v1`},{name:`apiKey`,type:`string`,description:`API Key`,required:!0},{name:`model`,type:`string`,description:`模型名称`,required:!0,defaultValue:`gpt-3.5-turbo`},{name:`systemMessages`,type:`array`,description:`系统提示词列表`,defaultValue:[]},{name:`userMessages`,type:`array`,description:`用户提示词列表`,defaultValue:[]},{name:`temperature`,type:`number`,description:`温度参数（0-2）`,defaultValue:1},{name:`maxTokens`,type:`number`,description:`最大 token 数`,defaultValue:2048},{name:`topP`,type:`number`,description:`Top P 参数（0-1）`,defaultValue:1},{name:`frequencyPenalty`,type:`number`,description:`频率惩罚（-2 到 2）`,defaultValue:0},{name:`presencePenalty`,type:`number`,description:`存在惩罚（-2 到 2）`,defaultValue:0}]}defineOutputs(){return[{name:`response`,type:`string`,description:`AI 响应内容`},{name:`fullResponse`,type:`object`,description:`完整的 API 响应`}]}getStyleConfig(){return{headerColor:[`#10b981`,`#059669`],icon:`ai`,showIcon:!0}}async execute(e,t){try{let n=this.getInput(e,`baseUrl`,`https://api.openai.com/v1`),r=this.getInput(e,`apiKey`,``),i=this.getInput(e,`model`,`gpt-3.5-turbo`),a=this.getInput(e,`systemMessages`,[]),o=this.getInput(e,`userMessages`,[]),s=this.getInput(e,`temperature`,1),c=this.getInput(e,`maxTokens`,2048),l=this.getInput(e,`topP`,1),u=this.getInput(e,`frequencyPenalty`,0),d=this.getInput(e,`presencePenalty`,0),f=this.validateInputs(e);if(!f.valid)return this.createError(f.errors.join(`; `));if(t.signal?.aborted)return this.createError(`请求已中止`);n=n.replace(/\/$/,``),n.endsWith(`/v1`)||(n=`${n}/v1`);let p=new Y({apiKey:r,baseURL:n}),m=[];if(Array.isArray(a)&&a.length>0)for(let e of a)e.role===`system`&&e.message&&(e.type===`text`?m.push({role:`system`,content:e.message}):e.type===`image`&&m.push({role:`user`,content:[{type:`image_url`,image_url:{url:e.message}}]}));if(Array.isArray(o)&&o.length>0)for(let e of o)e.role===`user`&&e.message&&(e.type===`text`?m.push({role:`user`,content:e.message}):e.type===`image`&&m.push({role:`user`,content:[{type:`image_url`,image_url:{url:e.message}}]}));if(m.length===0)return this.createError(`至少需要提供一个系统或用户消息`);let h=await p.chat.completions.create({model:i,messages:m,temperature:Math.max(0,Math.min(2,s)),max_tokens:Math.max(1,c),top_p:Math.max(0,Math.min(1,l)),frequency_penalty:Math.max(-2,Math.min(2,u)),presence_penalty:Math.max(-2,Math.min(2,d))},{signal:t.signal}),g=h.choices?.[0]?.message?.content||``,_={id:h.id,object:h.object,created:h.created,model:h.model,choices:h.choices,usage:h.usage};return this.createOutput({response:g,fullResponse:_},g,`模型 ${i} 调用成功`)}catch(e){return e instanceof Y.APIError?this.createError(`API 错误: ${e.status} - ${e.message}`):e.name===`AbortError`?this.createError(`请求已中止`):this.createError(e)}}},kp=t({StartNode:()=>Ap}),Ap=class extends n{constructor(...e){super(...e),this.type=`start`,this.label=`开始`,this.description=`工作流程的起始节点`,this.category=`流程控制`}defineInputs(){return[]}defineOutputs(){return[{name:`output`,type:`any`,description:`开始信号`}]}getStyleConfig(){return{headerColor:[`#10b981`,`#059669`],icon:`start`,showIcon:!0}}async execute(e,t){return console.log(`[StartNode execute]`,t),this.createOutput({output:{started:!0,timestamp:Date.now(),workflowId:t.workflow?.workflowId}})}},jp=t({TextProcessNode:()=>Mp}),Mp=class extends n{constructor(...e){super(...e),this.type=`text-process`,this.label=`文本处理`,this.description=`对输入文本进行转换处理`,this.category=`工具`}defineInputs(){return[{name:`text`,type:`string`,description:`输入文本`,required:!0},{name:`mode`,type:`string`,description:`处理模式`,defaultValue:`uppercase`,options:[{label:`大写`,value:`uppercase`},{label:`小写`,value:`lowercase`},{label:`反转`,value:`reverse`}]},{name:`prefix`,type:`string`,description:`添加前缀`,defaultValue:``}]}defineOutputs(){return[{name:`result`,type:`string`,description:`处理后的文本`},{name:`length`,type:`number`,description:`文本长度`}]}getStyleConfig(){return{headerColor:`#3b82f6`,icon:`edit`,showIcon:!0,bodyStyle:{minWidth:`200px`}}}async execute(e,t){try{let t=this.getInput(e,`text`,``).toString(),n=this.getInput(e,`mode`,`uppercase`),r=this.getInput(e,`prefix`,``),i=this.validateInputs(e);if(!i.valid)return this.createError(i.errors.join(`; `));let a=t;switch(n){case`uppercase`:a=t.toUpperCase();break;case`lowercase`:a=t.toLowerCase();break;case`reverse`:a=t.split(``).reverse().join(``);break}return r&&(a=r+a),this.createOutput({result:a,length:a.length})}catch(e){return this.createError(e)}}},Np=t({VariableAggregateNode:()=>Pp}),Pp=class extends n{constructor(...e){super(...e),this.type=`variableAggregate`,this.label=`变量聚合`,this.description=`将多个分组的数据聚合，返回每个分组的第一项`,this.category=`数据处理`}defineInputs(){return[{name:`data`,type:`any`,description:`输入数据数组，格式: [{ name: string, children: any[] }, ...]`,required:!0}]}defineOutputs(){return[{name:`aggregated`,type:`any`,description:`聚合结果，键为分组名称，值为该分组的第一项有数据的值`}]}shouldUseCache(e,t){return!1}getStyleConfig(){return{headerColor:[`#06b6d4`,`#0891b2`],icon:`package`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`data`,[]);if(!Array.isArray(t))return this.createError(`输入数据必须是数组类型`);let n={};for(let e of t){if(!e||typeof e!=`object`)continue;let t=e.name||`unknown`,r=Array.isArray(e.children)?e.children:[],i=null;for(let e of r)if(e!=null&&e!==``){i=e;break}n[t]=i}return this.createOutput({aggregated:n})}catch(e){return this.createError(e)}}},Fp=t({ImagePreviewNode:()=>Ip}),Ip=class extends n{constructor(...e){super(...e),this.type=`preview`,this.label=`图片预览`,this.description=`预览图片，支持完整 URL 或相对路径`,this.category=`工具`}defineInputs(){return[{name:`imageUrl`,type:`string`,description:`图片 URL`,required:!1},{name:`baseUrl`,type:`string`,description:`基础 URL`,required:!1}]}defineOutputs(){return[{name:`imageUrl`,type:`string`,description:`处理后的图片地址`},{name:`imageInfo`,type:`object`,description:`图片的元数据信息`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`image`,showIcon:!0,bodyStyle:{minWidth:`300px`}}}async execute(e,t){try{let t=this.getInput(e,`imageUrl`,``),n=this.getInput(e,`baseUrl`,``),r;if(!t)return this.createError(`请提供图片 URL 或相对路径`);if(t.startsWith(`http://`)||t.startsWith(`https://`))r=t;else{if(!n)return this.createError(`相对路径需要提供 baseUrl`);r=this.concatenateUrl(n,t)}let i={url:r,type:`url`,size:`未知`};try{if(typeof window<`u`&&`Image`in window){let e=await this.getImageDimensions(r);i={...i,width:e.width,height:e.height}}}catch(e){console.warn(`无法获取图片尺寸:`,e)}let a=`图片预览`;return i.width&&i.height&&(a=`图片: ${i.width}x${i.height}`),this.createOutput({imageUrl:r,imageInfo:i},a)}catch(e){return this.createError(e)}}concatenateUrl(e,t){if(t.startsWith(`http://`)||t.startsWith(`https://`))return t;let n=e.endsWith(`/`)?e.slice(0,-1):e,r=t.startsWith(`/`)?t.slice(1):t;return`${n}/${r}`}getImageDimensions(e){return new Promise((t,n)=>{let r=document.createElement(`img`);r.onload=()=>{t({width:r.naturalWidth,height:r.naturalHeight})},r.onerror=()=>{n(Error(`无法加载图片`))},r.src=e,setTimeout(()=>{n(Error(`加载图片超时`))},5e3)})}};let Lp={},Rp={"./nodes/CodeNode.ts":Qi,"./nodes/ConnectorNode.ts":ta,"./nodes/DataPreviewNode.ts":ra,"./nodes/DelayNode.ts":aa,"./nodes/EndNode.ts":sa,"./nodes/ForNode.ts":la,"./nodes/HttpRequestNode.ts":gc,"./nodes/IfNode.ts":qi,"./nodes/NoteNode.ts":vc,"./nodes/OpenAILlmNode.ts":Dp,"./nodes/StartNode.ts":kp,"./nodes/TextProcessNode.ts":jp,"./nodes/VariableAggregateNode.ts":Np,"./nodes/previewNode.ts":Fp};for(let e in Rp){let t=Rp[e];for(let e in t){let n=t[e];if(typeof n==`function`&&n.prototype)try{let e=new n;e&&typeof e.type==`string`&&(Lp[e.type]=n)}catch{}}}function zp(){return Object.values(Lp).map(e=>new e().getMetadata())}let X=`[FlowWorker]`,Z=null,Bp=!1,Q={executionId:null,workflowId:null},$=e=>self.postMessage(e),Vp=()=>({executionId:Q.executionId??void 0,workflowId:Q.workflowId??void 0}),Hp=[];function Up(){return Hp}function Wp(e){Hp=e.slice(-1e3)}function Gp(e,t){try{let n={};e.nodeResults instanceof Map&&e.nodeResults.forEach((e,t)=>{n[t]=e});let r={executionId:e.executionId,workflowId:e.workflowId,success:e.success,startTime:e.startTime,endTime:e.endTime,duration:e.duration,error:e.error,executedNodeCount:e.executedNodeIds.length,skippedNodeCount:e.skippedNodeIds.length,cachedNodeCount:e.cachedNodeIds.length,executedNodeIds:e.executedNodeIds,skippedNodeIds:e.skippedNodeIds,cachedNodeIds:e.cachedNodeIds,nodeResults:n,nodes:t?.nodes,edges:t?.edges},i=Up();i.push(r),Wp(i),console.log(`${X} 已保存执行历史:`,r.executionId)}catch(e){console.error(`${X} 添加执行历史失败:`,e)}}function Kp(e,t,n=1,r=20){try{let i=Up();t&&(i=i.filter(e=>e.workflowId===t)),i.sort((e,t)=>t.startTime-e.startTime);let a=i.length,o=(n-1)*r,s=o+r,c=i.slice(o,s);$({type:`HISTORY_DATA`,payload:{requestId:e,history:c,total:a,page:n,pageSize:r}}),console.log(`${X} 已返回历史记录，第 ${n} 页，共 ${c.length} 条（总计 ${a} 条）`,t?`(工作流: ${t})`:`(全部)`)}catch(e){console.error(`${X} 获取执行历史失败:`,e)}}function qp(e){try{if(e){let t=Up().filter(t=>t.workflowId!==e);Wp(t),console.log(`${X} 已清空工作流历史:`,e)}else Hp=[],console.log(`${X} 已清空所有执行历史`)}catch(e){console.error(`${X} 清空执行历史失败:`,e)}}function Jp(e){try{let t=Up().filter(t=>t.executionId!==e);Wp(t),console.log(`${X} 已删除执行历史:`,e)}catch(e){console.error(`${X} 删除执行历史失败:`,e)}}let Yp=()=>{if(!Q.executionId||!Q.workflowId)throw Error(`执行上下文未初始化`);return{executionId:Q.executionId,workflowId:Q.workflowId}},Xp=e=>{$({type:`STATE_CHANGE`,payload:{...Vp(),state:e}})},Zp=()=>{Q.executionId=null,Q.workflowId=null},Qp=(e,t,n)=>{let r=Date.now();return{success:!1,executionId:e,workflowId:t,startTime:r,endTime:r,duration:0,nodeResults:new Map,executedNodeIds:[],skippedNodeIds:[],cachedNodeIds:[],strategy:`full`,error:n}},$p=e=>{let t=e.workflowId??Q.workflowId??``;return e.result&&e.workflowId?e:{...e,workflowId:t,result:e.result??Qp(e.executionId,t,e.error)}},em=e=>({...e,onExecutionStart:t=>{Q.executionId=t.executionId,Q.workflowId=t.workflowId,$({type:`EXECUTION_START`,payload:t}),Xp(`running`),e?.onExecutionStart?.(t)},onExecutionComplete:t=>{Q.executionId=t.executionId,Q.workflowId=t.workflowId,$({type:`EXECUTION_COMPLETE`,payload:t}),Xp(`completed`),e?.onExecutionComplete?.(t),Zp()},onExecutionError:t=>{let n=$p(t);Q.executionId=n.executionId,Q.workflowId=n.workflowId,$({type:`EXECUTION_ERROR`,payload:n}),Xp(`error`),e?.onExecutionError?.(n),Zp()},onNodeStart:t=>{let n=Yp();$({type:`NODE_START`,payload:{...n,nodeId:t}}),e?.onNodeStart?.(t)},onNodeComplete:(t,n)=>{let r=Yp();$({type:`NODE_COMPLETE`,payload:{...r,nodeId:t,result:n}}),e?.onNodeComplete?.(t,n)},onNodeError:(t,n)=>{let r=Yp();$({type:`NODE_ERROR`,payload:{...r,nodeId:t,error:n.message}}),e?.onNodeError?.(t,n)},onProgress:t=>{$({type:`PROGRESS`,payload:{...Vp(),progress:t}}),e?.onProgress?.(t)},onCacheHit:(t,n)=>{let r=Yp();$({type:`CACHE_HIT`,payload:{...r,nodeId:t,cachedResult:n}}),e?.onCacheHit?.(t,n)},onIterationUpdate:(t,n)=>{let r=Yp();$({type:`ITERATION_UPDATE`,payload:{...r,nodeId:t,iterationData:n}}),e?.onIterationUpdate?.(t,n)}}),tm=(e,t,n)=>{let r=t instanceof Error?t.message:String(t),i=Q.executionId??`exec_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,a=Q.workflowId??e.workflow_id,o=Qp(i,a,r),s={executionId:i,workflowId:a,error:r,result:o};Gp(o,e),$({type:`EXECUTION_ERROR`,payload:s}),Xp(`error`),n?.onExecutionError?.(s),Zp()};function nm(){try{console.log(`${X} 开始初始化...`,Lp);let e=y(Lp);console.log(`${X} 已加载 ${e.getAllTypes().length} 个节点类型:`,e.getAllTypes()),Z=new _(e),Bp=!0,$({type:`INITIALIZED`}),console.log(`${X} 初始化完成`)}catch(e){console.error(`${X} 初始化失败:`,e);let t={type:`ERROR`,payload:{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}};$(t)}}async function rm(e,t){if(!Z)throw Error(`执行器未初始化`);try{console.log(`${X} 开始执行工作流:`,e.workflow_id);let n=em(t),r=await Z.execute(e,n).catch(e=>{throw e});return console.log(`${X} 工作流执行完成:`,r),Gp(r,e),r}catch(n){console.error(`${X} 工作流执行失败:`,n),tm(e,n,t)}}function im(){Z&&(Z.pause(),Xp(`paused`),console.log(`${X} 执行已暂停`))}function am(){Z&&(Z.resume(),Xp(`running`),console.log(`${X} 执行已恢复`))}function om(){Z&&(Z.stop(),Xp(`cancelled`),Zp(),console.log(`${X} 执行已停止`))}function sm(e,t){if(!Z)return;let n=Z.getCacheStats(e);$({type:`CACHE_STATS`,payload:{requestId:t,stats:n}})}function cm(e){Z&&(Z.clearCache(e),console.log(`${X} 已清空缓存:`,e))}function lm(){Z&&(Z.clearAllCache(),console.log(`${X} 已清空所有缓存`))}function um(e){try{let t=zp().map(e=>({type:e.type,label:e.label,description:e.description,category:e.category,icon:e.style?.icon,tags:[],inputs:e.inputs.map(e=>({name:e.name,type:e.type,description:e.description,required:e.required,defaultValue:e.defaultValue,options:e?.options??[]})),outputs:e.outputs.map(e=>({name:e.name,type:e.type,description:e.description}))}));$({type:`NODE_LIST`,payload:{requestId:e,nodes:t}}),console.log(`${X} 已返回节点列表，共 ${t.length} 个节点`)}catch(e){console.error(`${X} 获取节点列表失败:`,e)}}self.addEventListener(`message`,async e=>{let t=e.data;try{switch(t.type){case`INIT`:nm();break;case`EXECUTE`:if(!Bp)throw Error(`执行器未初始化，请先发送 INIT 消息`);await rm(t.payload.workflow,t.payload.options);break;case`PAUSE`:im();break;case`RESUME`:am();break;case`STOP`:om();break;case`GET_CACHE_STATS`:sm(t.payload.workflowId,t.payload.requestId);break;case`CLEAR_CACHE`:cm(t.payload.workflowId);break;case`CLEAR_ALL_CACHE`:lm();break;case`GET_NODE_LIST`:um(t.payload.requestId);break;case`GET_HISTORY`:Kp(t.payload.requestId,t.payload.workflowId,t.payload.page,t.payload.pageSize);break;case`CLEAR_HISTORY`:qp(t.payload.workflowId);break;case`DELETE_HISTORY`:Jp(t.payload.executionId);break;default:console.warn(`${X} 未知消息类型:`,t)}}catch(e){console.error(`${X} 处理消息时出错:`,e);let t={type:`ERROR`,payload:{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}};$(t)}}),console.log(`${X} VueFlow 执行 Worker 已启动`)})();