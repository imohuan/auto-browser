import{Dt as e,lt as t,ot as n,r}from"./index-BBQwUZyz.js";var i=class{getStyleConfig(){return{}}createNodeData(){let e=this.defineInputs(),t=this.defineOutputs(),n=e.some(e=>e.isPort),r=t.some(e=>e.isPort),i=e.filter(e=>!e.isPort),a=n?e:[...i,{id:`__input__`,name:`输入`,type:`any`,isPort:!0}],o=r?t:[{id:`__output__`,name:`输出`,type:`any`,isPort:!0}];return{config:this.getDefaultConfig(),inputs:a,outputs:o,label:this.label,category:this.category,style:this.getStyleConfig()}}getInputDefinitions(){return this.defineInputs()}getOutputDefinitions(){return this.defineOutputs()}async run(e,t,n){let r=Date.now(),i=Date.now();try{let a={...e};for(let[e,n]of Object.entries(t))n!=null&&(a[e]=n);let o=await this.execute(a,t,n),s=Date.now()-r,c=this.formatExecutionResult(o);return{duration:s,data:c,status:`success`,timestamp:i}}catch(e){return{duration:Date.now()-r,data:{outputs:{},raw:null},status:`error`,error:e.message||`执行失败`,timestamp:i}}}formatExecutionResult(e){let t=this.getOutputDefinitions(),{outputsPayload:n,rawPayload:r,summary:i}=this.extractOutputs(e),a={};if(t.length===0)return{outputs:a,raw:r,summary:i};if(t.length===1){let[e]=t;if(e){let t=this.pickOutputValue(n,e.id,r);a[e.id]={id:e.id,label:e.name,type:e.type,description:e.description,value:t}}}else for(let e of t){if(!e)continue;let t=this.pickOutputValue(n,e.id,void 0);a[e.id]={id:e.id,label:e.name,type:e.type,description:e.description,value:t}}return{outputs:a,raw:r,summary:i}}extractOutputs(e){let t=e,n=e,r;if(e&&typeof e==`object`&&!Array.isArray(e)){let i=Object.prototype.hasOwnProperty.call(e,`outputs`),a=Object.prototype.hasOwnProperty.call(e,`raw`);i&&(t=e.outputs),n=a?e.raw:i?e.outputs:e,typeof e.summary==`string`&&(r=e.summary)}return{outputsPayload:t,rawPayload:n,summary:r}}pickOutputValue(e,t,n){if(e&&typeof e==`object`&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,t))return e[t];if(n!==void 0)return n}validateConfig(e){let t=[],n=this.defineInputs();for(let r of n)r.required&&!e[r.id]&&t.push(`${r.name} 是必填项`);return{valid:t.length===0,errors:t}}getMetadata(){return{type:this.type,label:this.label,description:this.description,category:this.category,inputs:this.defineInputs(),outputs:this.defineOutputs(),defaultConfig:this.getDefaultConfig()}}},a=class extends i{constructor(...e){super(...e),this.type=`start`,this.label=`开始`,this.description=`工作流的入口节点`,this.category=`流程控制`}defineInputs(){return[{id:`initialPayload`,name:`初始数据`,type:`any`,description:`作为流程上下文传递给后续节点，可为空`}]}defineOutputs(){return[{id:`next`,name:`输出`,type:`any`,isPort:!0,description:`传递给下一个节点的数据`}]}getDefaultConfig(){return{initialPayload:null}}createNodeData(){return{config:this.getDefaultConfig(),inputs:this.defineInputs(),outputs:this.defineOutputs(),label:this.label,category:this.category,variant:this.type}}async execute(e,t,n){let r=e.initialPayload??null;return{outputs:{next:r},raw:r,summary:`流程开始`}}},o=class extends i{constructor(...e){super(...e),this.type=`end`,this.label=`结束`,this.description=`工作流的结束节点`,this.category=`流程控制`}defineInputs(){return[{id:`input`,name:`输入`,type:`any`,isPort:!0,description:`接收上一个节点的执行结果`},{id:`returnInput`,name:`返回输入结果`,type:`boolean`,description:`开启后将输入作为最终输出返回`},{id:`summary`,name:`结束摘要`,type:`string`,description:`可选，展示在执行日志中的描述信息`}]}defineOutputs(){return[]}getDefaultConfig(){return{returnInput:!0,summary:`流程结束`}}createNodeData(){return{config:this.getDefaultConfig(),inputs:this.defineInputs(),outputs:[],label:this.label,category:this.category,variant:this.type}}async execute(e,t,n){return{raw:e.returnInput?t.input??null:e,summary:e.summary||`流程结束`}}},s=typeof global==`object`&&global&&global.Object===Object&&global,c=typeof self==`object`&&self&&self.Object===Object&&self,l=s||c||Function(`return this`)(),u=l.Symbol,d=Object.prototype,f=d.hasOwnProperty,p=d.toString,m=u?u.toStringTag:void 0;function h(e){var t=f.call(e,m),n=e[m];try{e[m]=void 0;var r=!0}catch{}var i=p.call(e);return r&&(t?e[m]=n:delete e[m]),i}var g=h,_=Object.prototype.toString;function v(e){return _.call(e)}var y=v,b=`[object Null]`,ee=`[object Undefined]`,te=u?u.toStringTag:void 0;function ne(e){return e==null?e===void 0?ee:b:te&&te in Object(e)?g(e):y(e)}var x=ne;function re(e){return typeof e==`object`&&!!e}var S=re,C=Array.isArray;function ie(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)}var ae=ie,oe=`[object AsyncFunction]`,se=`[object Function]`,ce=`[object GeneratorFunction]`,le=`[object Proxy]`;function ue(e){if(!ae(e))return!1;var t=x(e);return t==se||t==ce||t==oe||t==le}var de=ue,w=l[`__core-js_shared__`],fe=function(){var e=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||``);return e?`Symbol(src)_1.`+e:``}();function pe(e){return!!fe&&fe in e}var me=pe,he=Function.prototype.toString;function ge(e){if(e!=null){try{return he.call(e)}catch{}try{return e+``}catch{}}return``}var T=ge,_e=/[\\^$.*+?()[\]{}|]/g,ve=/^\[object .+?Constructor\]$/,ye=Function.prototype,be=Object.prototype,xe=ye.toString,Se=be.hasOwnProperty,Ce=RegExp(`^`+xe.call(Se).replace(_e,`\\$&`).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,`$1.*?`)+`$`);function we(e){return!ae(e)||me(e)?!1:(de(e)?Ce:ve).test(T(e))}var Te=we;function Ee(e,t){return e?.[t]}var De=Ee;function Oe(e,t){var n=De(e,t);return Te(n)?n:void 0}var E=Oe,D=E(l,`WeakMap`),ke=9007199254740991,Ae=/^(?:0|[1-9]\d*)$/;function je(e,t){var n=typeof e;return t??=ke,!!t&&(n==`number`||n!=`symbol`&&Ae.test(e))&&e>-1&&e%1==0&&e<t}var Me=je;function Ne(e,t){return e===t||e!==e&&t!==t}var O=Ne,Pe=9007199254740991;function Fe(e){return typeof e==`number`&&e>-1&&e%1==0&&e<=Pe}var Ie=Fe;function Le(e){return e!=null&&Ie(e.length)&&!de(e)}var Re=Le,ze=Object.prototype;function Be(e){var t=e&&e.constructor,n=typeof t==`function`&&t.prototype||ze;return e===n}var Ve=Be;function He(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var Ue=He,We=`[object Arguments]`;function Ge(e){return S(e)&&x(e)==We}var Ke=Ge,qe=Object.prototype,Je=qe.hasOwnProperty,Ye=qe.propertyIsEnumerable,Xe=Ke(function(){return arguments}())?Ke:function(e){return S(e)&&Je.call(e,`callee`)&&!Ye.call(e,`callee`)};function Ze(){return!1}var Qe=Ze,$e=typeof exports==`object`&&exports&&!exports.nodeType&&exports,et=$e&&typeof module==`object`&&module&&!module.nodeType&&module,tt=et&&et.exports===$e?l.Buffer:void 0,k=(tt?tt.isBuffer:void 0)||Qe,nt=`[object Arguments]`,rt=`[object Array]`,it=`[object Boolean]`,at=`[object Date]`,ot=`[object Error]`,st=`[object Function]`,ct=`[object Map]`,lt=`[object Number]`,ut=`[object Object]`,dt=`[object RegExp]`,ft=`[object Set]`,pt=`[object String]`,mt=`[object WeakMap]`,ht=`[object ArrayBuffer]`,gt=`[object DataView]`,_t=`[object Float32Array]`,vt=`[object Float64Array]`,yt=`[object Int8Array]`,bt=`[object Int16Array]`,xt=`[object Int32Array]`,St=`[object Uint8Array]`,Ct=`[object Uint8ClampedArray]`,wt=`[object Uint16Array]`,Tt=`[object Uint32Array]`,A={};A[_t]=A[vt]=A[yt]=A[bt]=A[xt]=A[St]=A[Ct]=A[wt]=A[Tt]=!0,A[nt]=A[rt]=A[ht]=A[it]=A[gt]=A[at]=A[ot]=A[st]=A[ct]=A[lt]=A[ut]=A[dt]=A[ft]=A[pt]=A[mt]=!1;function Et(e){return S(e)&&Ie(e.length)&&!!A[x(e)]}var Dt=Et;function Ot(e){return function(t){return e(t)}}var kt=Ot,At=typeof exports==`object`&&exports&&!exports.nodeType&&exports,j=At&&typeof module==`object`&&module&&!module.nodeType&&module,M=j&&j.exports===At&&s.process,N=function(){try{return j&&j.require&&j.require(`util`).types||M&&M.binding&&M.binding(`util`)}catch{}}(),jt=N&&N.isTypedArray,Mt=jt?kt(jt):Dt,Nt=Object.prototype.hasOwnProperty;function Pt(e,t){var n=C(e),r=!n&&Xe(e),i=!n&&!r&&k(e),a=!n&&!r&&!i&&Mt(e),o=n||r||i||a,s=o?Ue(e.length,String):[],c=s.length;for(var l in e)(t||Nt.call(e,l))&&!(o&&(l==`length`||i&&(l==`offset`||l==`parent`)||a&&(l==`buffer`||l==`byteLength`||l==`byteOffset`)||Me(l,c)))&&s.push(l);return s}var Ft=Pt;function It(e,t){return function(n){return e(t(n))}}var Lt=It,Rt=Lt(Object.keys,Object),zt=Object.prototype.hasOwnProperty;function Bt(e){if(!Ve(e))return Rt(e);var t=[];for(var n in Object(e))zt.call(e,n)&&n!=`constructor`&&t.push(n);return t}var Vt=Bt;function Ht(e){return Re(e)?Ft(e):Vt(e)}var Ut=Ht,P=E(Object,`create`);function Wt(){this.__data__=P?P(null):{},this.size=0}var Gt=Wt;function Kt(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var qt=Kt,Jt=`__lodash_hash_undefined__`,Yt=Object.prototype.hasOwnProperty;function Xt(e){var t=this.__data__;if(P){var n=t[e];return n===Jt?void 0:n}return Yt.call(t,e)?t[e]:void 0}var Zt=Xt,Qt=Object.prototype.hasOwnProperty;function $t(e){var t=this.__data__;return P?t[e]!==void 0:Qt.call(t,e)}var en=$t,tn=`__lodash_hash_undefined__`;function nn(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=P&&t===void 0?tn:t,this}var rn=nn;function F(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}F.prototype.clear=Gt,F.prototype.delete=qt,F.prototype.get=Zt,F.prototype.has=en,F.prototype.set=rn;var an=F;function on(){this.__data__=[],this.size=0}var sn=on;function cn(e,t){for(var n=e.length;n--;)if(O(e[n][0],t))return n;return-1}var I=cn,ln=Array.prototype.splice;function un(e){var t=this.__data__,n=I(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():ln.call(t,n,1),--this.size,!0}var dn=un;function fn(e){var t=this.__data__,n=I(t,e);return n<0?void 0:t[n][1]}var pn=fn;function mn(e){return I(this.__data__,e)>-1}var hn=mn;function gn(e,t){var n=this.__data__,r=I(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var _n=gn;function L(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}L.prototype.clear=sn,L.prototype.delete=dn,L.prototype.get=pn,L.prototype.has=hn,L.prototype.set=_n;var R=L,z=E(l,`Map`);function vn(){this.size=0,this.__data__={hash:new an,map:new(z||R),string:new an}}var yn=vn;function bn(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null}var xn=bn;function Sn(e,t){var n=e.__data__;return xn(t)?n[typeof t==`string`?`string`:`hash`]:n.map}var B=Sn;function Cn(e){var t=B(this,e).delete(e);return this.size-=t?1:0,t}var wn=Cn;function Tn(e){return B(this,e).get(e)}var En=Tn;function Dn(e){return B(this,e).has(e)}var On=Dn;function kn(e,t){var n=B(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var An=kn;function V(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}V.prototype.clear=yn,V.prototype.delete=wn,V.prototype.get=En,V.prototype.has=On,V.prototype.set=An;var jn=V;function Mn(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Nn=Mn;function Pn(){this.__data__=new R,this.size=0}var Fn=Pn;function In(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var Ln=In;function Rn(e){return this.__data__.get(e)}var zn=Rn;function Bn(e){return this.__data__.has(e)}var Vn=Bn,Hn=200;function Un(e,t){var n=this.__data__;if(n instanceof R){var r=n.__data__;if(!z||r.length<Hn-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new jn(r)}return n.set(e,t),this.size=n.size,this}var Wn=Un;function H(e){this.size=(this.__data__=new R(e)).size}H.prototype.clear=Fn,H.prototype.delete=Ln,H.prototype.get=zn,H.prototype.has=Vn,H.prototype.set=Wn;var U=H;function Gn(e,t){for(var n=-1,r=e==null?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}var Kn=Gn;function qn(){return[]}var Jn=qn,Yn=Object.prototype.propertyIsEnumerable,Xn=Object.getOwnPropertySymbols,Zn=Xn?function(e){return e==null?[]:(e=Object(e),Kn(Xn(e),function(t){return Yn.call(e,t)}))}:Jn;function Qn(e,t,n){var r=t(e);return C(e)?r:Nn(r,n(e))}var $n=Qn;function er(e){return $n(e,Ut,Zn)}var W=er,G=E(l,`DataView`),K=E(l,`Promise`),q=E(l,`Set`),tr=`[object Map]`,nr=`[object Object]`,rr=`[object Promise]`,ir=`[object Set]`,ar=`[object WeakMap]`,or=`[object DataView]`,sr=T(G),cr=T(z),lr=T(K),ur=T(q),dr=T(D),J=x;(G&&J(new G(new ArrayBuffer(1)))!=or||z&&J(new z)!=tr||K&&J(K.resolve())!=rr||q&&J(new q)!=ir||D&&J(new D)!=ar)&&(J=function(e){var t=x(e),n=t==nr?e.constructor:void 0,r=n?T(n):``;if(r)switch(r){case sr:return or;case cr:return tr;case lr:return rr;case ur:return ir;case dr:return ar}return t});var Y=J,fr=l.Uint8Array,pr=`__lodash_hash_undefined__`;function mr(e){return this.__data__.set(e,pr),this}var hr=mr;function gr(e){return this.__data__.has(e)}var _r=gr;function X(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new jn;++t<n;)this.add(e[t])}X.prototype.add=X.prototype.push=hr,X.prototype.has=_r;var vr=X;function yr(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var br=yr;function xr(e,t){return e.has(t)}var Sr=xr,Cr=1,wr=2;function Tr(e,t,n,r,i,a){var o=n&Cr,s=e.length,c=t.length;if(s!=c&&!(o&&c>s))return!1;var l=a.get(e),u=a.get(t);if(l&&u)return l==t&&u==e;var d=-1,f=!0,p=n&wr?new vr:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var m=e[d],h=t[d];if(r)var g=o?r(h,m,d,t,e,a):r(m,h,d,e,t,a);if(g!==void 0){if(g)continue;f=!1;break}if(p){if(!br(t,function(e,t){if(!Sr(p,t)&&(m===e||i(m,e,n,r,a)))return p.push(t)})){f=!1;break}}else if(!(m===h||i(m,h,n,r,a))){f=!1;break}}return a.delete(e),a.delete(t),f}var Er=Tr;function Dr(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}var Or=Dr;function kr(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var Ar=kr,jr=1,Mr=2,Nr=`[object Boolean]`,Pr=`[object Date]`,Fr=`[object Error]`,Ir=`[object Map]`,Lr=`[object Number]`,Rr=`[object RegExp]`,zr=`[object Set]`,Br=`[object String]`,Vr=`[object Symbol]`,Hr=`[object ArrayBuffer]`,Ur=`[object DataView]`,Wr=u?u.prototype:void 0,Z=Wr?Wr.valueOf:void 0;function Gr(e,t,n,r,i,a,o){switch(n){case Ur:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Hr:return!(e.byteLength!=t.byteLength||!a(new fr(e),new fr(t)));case Nr:case Pr:case Lr:return O(+e,+t);case Fr:return e.name==t.name&&e.message==t.message;case Rr:case Br:return e==t+``;case Ir:var s=Or;case zr:var c=r&jr;if(s||=Ar,e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=Mr,o.set(e,t);var u=Er(s(e),s(t),r,i,a,o);return o.delete(e),u;case Vr:if(Z)return Z.call(e)==Z.call(t)}return!1}var Kr=Gr,qr=1,Jr=Object.prototype.hasOwnProperty;function Yr(e,t,n,r,i,a){var o=n&qr,s=W(e),c=s.length,l=W(t).length;if(c!=l&&!o)return!1;for(var u=c;u--;){var d=s[u];if(!(o?d in t:Jr.call(t,d)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var m=!0;a.set(e,t),a.set(t,e);for(var h=o;++u<c;){d=s[u];var g=e[d],_=t[d];if(r)var v=o?r(_,g,d,t,e,a):r(g,_,d,e,t,a);if(!(v===void 0?g===_||i(g,_,n,r,a):v)){m=!1;break}h||=d==`constructor`}if(m&&!h){var y=e.constructor,b=t.constructor;y!=b&&`constructor`in e&&`constructor`in t&&!(typeof y==`function`&&y instanceof y&&typeof b==`function`&&b instanceof b)&&(m=!1)}return a.delete(e),a.delete(t),m}var Xr=Yr,Zr=1,Qr=`[object Arguments]`,$r=`[object Array]`,Q=`[object Object]`,ei=Object.prototype.hasOwnProperty;function ti(e,t,n,r,i,a){var o=C(e),s=C(t),c=o?$r:Y(e),l=s?$r:Y(t);c=c==Qr?Q:c,l=l==Qr?Q:l;var u=c==Q,d=l==Q,f=c==l;if(f&&k(e)){if(!k(t))return!1;o=!0,u=!1}if(f&&!u)return a||=new U,o||Mt(e)?Er(e,t,n,r,i,a):Kr(e,t,c,n,r,i,a);if(!(n&Zr)){var p=u&&ei.call(e,`__wrapped__`),m=d&&ei.call(t,`__wrapped__`);if(p||m){var h=p?e.value():e,g=m?t.value():t;return a||=new U,i(h,g,n,r,a)}}return f?(a||=new U,Xr(e,t,n,r,i,a)):!1}var ni=ti;function ri(e,t,n,r,i){return e===t?!0:e==null||t==null||!S(e)&&!S(t)?e!==e&&t!==t:ni(e,t,n,r,ri,i)}var ii=ri;function ai(e,t){return ii(e,t)}var oi=ai;const si={"is equal to":`等于`,"is not equal to":`不等于`,exists:`存在`,"does not exist":`不存在`,"is empty":`为空`,"is not empty":`不为空`,contains:`包含`,"does not contain":`不包含`,"starts with":`开头为`,"ends with":`结尾为`,"is greater than":`大于`,"is less than":`小于`,"is greater than or equal to":`大于等于`,"is less than or equal to":`小于等于`,"is true":`为真`,"is false":`为假`,"is before":`早于`,"is after":`晚于`,"is before or equal to":`早于或等于`,"is after or equal to":`晚于或等于`,"length equal to":`长度等于`,"length not equal to":`长度不等于`,"length greater than":`长度大于`,"length less than":`长度小于`,"length greater than or equal to":`长度大于等于`,"length less than or equal to":`长度小于等于`},ci={string:[`is equal to`,`is not equal to`,`contains`,`does not contain`,`starts with`,`ends with`,`is empty`,`is not empty`,`exists`,`does not exist`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],number:[`is equal to`,`is not equal to`,`is greater than`,`is less than`,`is greater than or equal to`,`is less than or equal to`,`exists`,`does not exist`],date:[`is equal to`,`is not equal to`,`is before`,`is after`,`is before or equal to`,`is after or equal to`,`exists`,`does not exist`],boolean:[`is true`,`is false`,`is equal to`,`is not equal to`,`exists`,`does not exist`],array:[`is empty`,`is not empty`,`contains`,`does not contain`,`exists`,`does not exist`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],object:[`is empty`,`is not empty`,`exists`,`does not exist`]};var $=class extends i{constructor(...e){super(...e),this.type=`if`,this.label=`条件判断`,this.description=`根据条件判断执行不同的分支`,this.category=`流程控制`}defineInputs(){return[{id:`input`,name:`输入数据`,type:`any`,required:!1,isPort:!0}]}defineOutputs(){return this.getOutputsForConfig(this.getDefaultConfig())}getDefaultConfig(){return{conditions:[{logic:`and`,subConditions:[{field:``,dataType:`string`,operator:`is equal to`,value:``}]}]}}getOutputsForConfig(e){let t=e.conditions||[],n=Math.max(t.length,1),r=[];for(let e=0;e<n;e++){let n=t[e];r.push({id:this.getConditionOutputId(e),name:this.createConditionPortName(e),type:`any`,description:n?this.describeCondition(n):`未配置条件`,isPort:!0})}return r.push({id:`else`,name:`否则`,type:`any`,description:`所有条件都不满足时执行`,isPort:!0}),r}async execute(e,t,n){let r=t.input,i=(Array.isArray(e.conditions)?e.conditions:[]).map((e,t)=>{let n=e.subConditions.map(e=>{let t=this.resolveOperandValue(e.field,e.dataType,{fallbackSource:r,preferPath:!0}),n=this.resolveOperandValue(e.value,e.dataType),i=this.compareValues(t,n,e.operator,e.dataType);return{...e,actualValue:t,targetValue:n,result:i}}),i=e.logic===`or`?n.some(e=>e.result):n.every(e=>e.result);return{index:t,outputId:this.getConditionOutputId(t),logic:e.logic,subResults:n,result:i}}),a=i.findIndex(e=>e.result),o=a!==-1,s={};i.forEach((e,t)=>{s[e.outputId]=t===a?{branch:e.outputId,passed:!0,input:r,evaluation:e,allEvaluations:i}:void 0}),s.else=o?void 0:{branch:`else`,passed:!1,input:r,allEvaluations:i};let c=a===-1?null:i[a];return{outputs:s,raw:{branch:c?c.outputId:`else`,passed:o,input:r,evaluations:i},summary:c?`条件${a+1}满足`:`所有条件都不满足，执行 else`}}getConditionOutputId(e){return`condition_${e+1}`}createConditionPortName(e){return`条件${e+1}`}describeCondition(e){let{logic:t,subConditions:n}=e;if(!n||n.length===0)return`未配置子条件`;if(n.length===1)return this.describeSubCondition(n[0]);let r=t===`and`?` 且 `:` 或 `,i=n.map(e=>this.describeSubCondition(e)).join(r);return i.length>60?i.slice(0,57)+`...`:i}describeSubCondition(e){if(!e)return`未配置`;let t=this.formatOperand(e.field,`输入值`),n=si[e.operator]||e.operator;if([`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(e.operator))return`${t} ${n}`;let r=this.truncateValue(e.value,20,`''`);return`${t} ${n} ${r}`}truncateValue(e,t=48,n=``){let r=this.formatOperand(e,n);return r?r.length<=t?r:`${r.slice(0,t-1)}…`:n}formatOperand(e,t=``){if(e==null)return t;if(typeof e==`string`){let n=e.trim();return n.length>0?n:t}if(typeof e==`number`||typeof e==`boolean`)return String(e);if(e instanceof Date)return e.toISOString();try{return JSON.stringify(e)}catch{return String(e)}}resolveFieldValue(e,t){if(!t)return e;if(e==null)return;let n=t.split(`.`).map(e=>e.trim()).filter(Boolean),r=e;for(let e of n){if(r==null)return;if(Array.isArray(r)){let t=Number(e);r=Number.isInteger(t)?r[t]:void 0}else r=r[e]}return r}resolveOperandValue(e,t,n={}){if(e==null)return e;if(typeof e==`string`){let r=e.trim();if(n.preferPath&&n.fallbackSource!==void 0&&this.isPathLikeString(r)){let e=this.resolveFieldValue(n.fallbackSource,r);if(e!==void 0)return e}return this.coerceValueByType(r,t)}return this.coerceValueByType(e,t)}coerceValueByType(e,t){if(e==null)return e;switch(t){case`number`:{if(typeof e==`number`)return e;if(typeof e==`boolean`)return e?1:0;if(typeof e==`string`){let t=Number(e);return Number.isNaN(t)?e:t}let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`number`)return e!==0;if(typeof e==`string`){let t=e.toLowerCase();if([`true`,`1`,`yes`].includes(t))return!0;if([`false`,`0`,`no`].includes(t))return!1}return!!e;case`date`:if(e instanceof Date)return e;if(typeof e==`number`)return new Date(e);if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?e:t}return e;case`array`:if(Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return[];try{let n=JSON.parse(t);return Array.isArray(n)?n:e}catch{return e}}return e;case`object`:if(e&&typeof e==`object`&&!Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return{};try{let n=JSON.parse(t);return n&&typeof n==`object`?n:e}catch{return e}}return e;default:return typeof e==`string`?e:String(e)}}isPathLikeString(e){return!e||/\s/.test(e)?!1:e===`input`?!0:e.includes(`.`)||/\[\d+\]/.test(e)}compareValues(e,t,n,r){switch(n){case`is equal to`:return this.compareEquality(e,t,r);case`is not equal to`:return!this.compareEquality(e,t,r);case`exists`:return e!=null;case`does not exist`:return e==null;case`is empty`:return e==null?!0:typeof e==`string`?e.trim().length===0:Array.isArray(e)?e.length===0:typeof e==`object`?Object.keys(e).length===0:!1;case`is not empty`:return e==null?!1:typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:typeof e==`object`?Object.keys(e).length>0:!0;case`contains`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?e.includes(t):!1;case`does not contain`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?!e.includes(t):!0;case`starts with`:return typeof e==`string`&&typeof t==`string`?e.startsWith(t):!1;case`ends with`:return typeof e==`string`&&typeof t==`string`?e.endsWith(t):!1;case`is greater than`:return Number(e)>Number(t);case`is less than`:return Number(e)<Number(t);case`is greater than or equal to`:return Number(e)>=Number(t);case`is less than or equal to`:return Number(e)<=Number(t);case`is true`:return e===!0;case`is false`:return e===!1;case`is before`:return new Date(e)<new Date(t);case`is after`:return new Date(e)>new Date(t);case`is before or equal to`:return new Date(e)<=new Date(t);case`is after or equal to`:return new Date(e)>=new Date(t);case`length equal to`:return this.getLength(e)===Number(t);case`length not equal to`:return this.getLength(e)!==Number(t);case`length greater than`:return this.getLength(e)>Number(t);case`length less than`:return this.getLength(e)<Number(t);case`length greater than or equal to`:return this.getLength(e)>=Number(t);case`length less than or equal to`:return this.getLength(e)<=Number(t);default:return!1}}getLength(e){return typeof e==`string`||Array.isArray(e)?e.length:typeof e==`object`&&e?Object.keys(e).length:0}compareEquality(e,t,n){let r=this.normalizeEqualityValue(e,n),i=this.normalizeEqualityValue(t,n);return n===`array`||n===`object`?oi(r,i):r===i}normalizeEqualityValue(e,t){if(e==null)return e;switch(t){case`number`:{let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`string`){let t=e.trim().toLowerCase();if(t===`true`||t===`1`)return!0;if(t===`false`||t===`0`)return!1}return typeof e==`number`?e===1:!!e;case`date`:{let t=e instanceof Date?e.getTime():new Date(e).getTime();return Number.isNaN(t)?e:t}case`string`:return String(e);default:return e}}},li=class extends i{constructor(...e){super(...e),this.type=`for`,this.label=`批处理`,this.description=`遍历集合并运行循环体`,this.category=`流程控制`}defineInputs(){return[{id:`items`,name:`输入集合`,type:`array`,required:!1,isPort:!0}]}defineOutputs(){return[{id:`loop`,name:`循环体`,type:`any`,isPort:!0},{id:`next`,name:`循环结束`,type:`any`,isPort:!0}]}getDefaultConfig(){return{mode:`input`,itemsPath:``,staticItems:[],range:{start:0,end:5,step:1},itemName:`item`,indexName:`index`,containerId:null,errorHandling:{continueOnError:!1}}}async execute(e,t,n){let r=this.resolveItems(e,t.items);if(!Array.isArray(r))throw Error(`循环源数据必须是数组`);let i=r.map((t,n)=>({[e.itemName]:t,[e.indexName]:n})),a={mode:e.mode,count:r.length,items:r,itemName:e.itemName,indexName:e.indexName,containerId:e.containerId||null,errorHandling:e.errorHandling,iterations:i};return{outputs:{loop:i,next:{count:a.count,items:a.items,itemName:a.itemName,indexName:a.indexName,containerId:a.containerId}},raw:a,summary:`循环 ${a.count} 次`}}resolveItems(e,t){switch(e.mode){case`input`:{if(!e.itemsPath)return Array.isArray(t)?t:[];let n=this.resolveByPath(t,e.itemsPath);return Array.isArray(n)?n:[]}case`static`:return Array.isArray(e.staticItems)?e.staticItems:[];case`range`:{let{start:t=0,end:n=0,step:r=1}=e.range||{};if(r===0)throw Error(`步长不能为 0`);let i=[];if(r>0)for(let e=t;e<n;e+=r)i.push(e);else for(let e=t;e>n;e+=r)i.push(e);return i}default:return[]}}resolveByPath(e,t){if(!t)return e;if(e==null)return;let n=t.split(`.`).map(e=>e.trim()).filter(Boolean),r=e;for(let e of n){if(r==null)return;if(Array.isArray(r)){let t=Number(e);r=Number.isInteger(t)?r[t]:void 0}else r=r[e]}return r}};new a,new o,new $,new li,new a,new o,new $,new li;var ui={},di={class:`w-16 h-16`,viewBox:`0 0 24 24`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function fi(r,i){return e(),t(`svg`,di,[...i[0]||=[n(`path`,{d:`M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z`,stroke:`currentColor`,"stroke-width":`1.5`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1)]])}var pi=r(ui,[[`render`,fi]]);export{ae as C,l as D,u as E,i as O,E as S,S as T,kt as _,fr as a,Re as b,$n as c,U as d,Nn as f,N as g,Ft as h,si as i,Zn as l,Lt as m,$ as n,Y as o,Ut as p,ci as r,W as s,pi as t,Jn as u,k as v,C as w,O as x,Ve as y};