import{$ as e,C as t,Et as n,F as r,Ft as i,G as a,H as o,I as s,L as c,Lt as l,M as u,Mt as d,N as f,Ot as p,P as m,Pt as h,R as g,St as _,T as v,Tt as y,U as b,W as x,X as S,Z as C,_t as w,at as ee,bt as T,ct as E,dt as D,ft as te,j as ne,jt as re,kt as O,nt as ie,ot as k,pt as ae,rt as A,st as j,tt as oe,ut as se,v as ce,w as le,wt as M,x as ue,xt as de}from"./index-DIItrjPD.js";import{n as N,r as fe}from"./events-CdBEY3Zi.js";import{t as P}from"./_plugin-vue_export-helper-DEnkkObV.js";import{t as pe}from"./IconChevronRight-CfR8zh3l.js";function me(e,t){return ue(e,t)}var he=me;function ge(e,t){return w()?(de(e,t),!0):!1}var _e=typeof window<`u`&&typeof document<`u`;typeof WorkerGlobalScope<`u`&&globalThis instanceof WorkerGlobalScope;var ve=e=>e!=null,ye=Object.prototype.toString,be=e=>ye.call(e)===`[object Object]`,xe=()=>{},Se=Ce();function Ce(){var e,t;return _e&&((e=window)==null||(e=e.navigator)==null?void 0:e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((t=window)==null||(t=t.navigator)==null?void 0:t.maxTouchPoints)>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function we(e){return Array.isArray(e)?e:[e]}function Te(e,t,n){return D(e,t,{...n,immediate:!0})}function Ee(e,t,n){let r=D(e,(e,i,a)=>{e&&(n?.once&&C(()=>r()),t(e,i,a))},{...n,once:!1});return r}var De=_e?window:void 0;_e&&window.document,_e&&window.navigator,_e&&window.location;function Oe(e){let t=O(e);return t?.$el??t}function ke(...e){let t=[],n=()=>{t.forEach(e=>e()),t.length=0},r=(e,t,n,r)=>(e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)),i=m(()=>{let t=we(O(e[0])).filter(e=>e!=null);return t.every(e=>typeof e!=`string`)?t:void 0}),a=Te(()=>[i.value?.map(e=>Oe(e))??[De].filter(e=>e!=null),we(O(i.value?e[1]:e[0])),we(re(i.value?e[2]:e[1])),O(i.value?e[3]:e[2])],([e,i,a,o])=>{if(n(),!e?.length||!i?.length||!a?.length)return;let s=be(o)?{...o}:o;t.push(...e.flatMap(e=>i.flatMap(t=>a.map(n=>r(e,t,n,s)))))},{flush:`post`});return ge(n),()=>{a(),n()}}var Ae=!1;function je(e,t,n={}){let{window:r=De,ignore:i=[],capture:a=!0,detectIframe:o=!1,controls:s=!1}=n;if(!r)return s?{stop:xe,cancel:xe,trigger:xe}:xe;if(Se&&!Ae){Ae=!0;let e={passive:!0};Array.from(r.document.body.children).forEach(t=>t.addEventListener(`click`,xe,e)),r.document.documentElement.addEventListener(`click`,xe,e)}let c=!0,l=e=>O(i).some(t=>{if(typeof t==`string`)return Array.from(r.document.querySelectorAll(t)).some(t=>t===e.target||e.composedPath().includes(t));{let n=Oe(t);return n&&(e.target===n||e.composedPath().includes(n))}});function u(e){let t=O(e);return t&&t.$.subTree.shapeFlag===16}function d(e,t){let n=O(e),r=n.$.subTree&&n.$.subTree.children;return r==null||!Array.isArray(r)?!1:r.some(e=>e.el===t.target||t.composedPath().includes(e.el))}let f=n=>{let r=Oe(e);if(n.target!=null&&!(!(r instanceof Element)&&u(e)&&d(e,n))&&!(!r||r===n.target||n.composedPath().includes(r))){if(`detail`in n&&n.detail===0&&(c=!l(n)),!c){c=!0;return}t(n)}},p=!1,m=[ke(r,`click`,e=>{p||(p=!0,setTimeout(()=>{p=!1},0),f(e))},{passive:!0,capture:a}),ke(r,`pointerdown`,t=>{let n=Oe(e);c=!l(t)&&!!(n&&!t.composedPath().includes(n))},{passive:!0}),o&&ke(r,`blur`,n=>{setTimeout(()=>{let i=Oe(e);r.document.activeElement?.tagName===`IFRAME`&&!i?.contains(r.document.activeElement)&&t(n)},0)},{passive:!0})].filter(Boolean),h=()=>m.forEach(e=>e());return s?{stop:h,cancel:()=>{c=!1},trigger:e=>{c=!0,f(e),c=!1}}:h}function Me(){let e=y(!1),t=a();return t&&oe(()=>{e.value=!0},t),e}function Ne(e){let t=Me();return m(()=>(t.value,!!e()))}function Pe(e,t,n={}){let{window:r=De,...i}=n,a,o=Ne(()=>r&&`MutationObserver`in r),s=()=>{a&&=(a.disconnect(),void 0)},c=D(m(()=>{let t=we(O(e)).map(Oe).filter(ve);return new Set(t)}),e=>{s(),o.value&&e.size&&(a=new MutationObserver(t),e.forEach(e=>a.observe(e,i)))},{immediate:!0,flush:`post`}),l=()=>a?.takeRecords(),u=()=>{c(),s()};return ge(u),{isSupported:o,stop:u,takeRecords:l}}function Fe(e,t,n={}){let{window:r=De,document:i=r?.document,flush:a=`sync`}=n;if(!r||!i)return xe;let o,s=e=>{o?.(),o=e},c=te(()=>{let n=Oe(e);if(n){let{stop:e}=Pe(i,e=>{e.map(e=>[...e.removedNodes]).flat().some(e=>e===n||e.contains(n))&&t(e)},{window:r,childList:!0,subtree:!0});s(e)}},{flush:a}),l=()=>{c(),s()};return ge(l),l}function Ie(e){return typeof e==`function`?e:typeof e==`string`?t=>t.key===e:Array.isArray(e)?t=>e.includes(t.key):()=>!0}function Le(...e){let t,n,r={};e.length===3?(t=e[0],n=e[1],r=e[2]):e.length===2?typeof e[1]==`object`?(t=!0,n=e[0],r=e[1]):(t=e[0],n=e[1]):(t=!0,n=e[0]);let{target:i=De,eventName:a=`keydown`,passive:o=!1,dedupe:s=!1}=r,c=Ie(t);return ke(i,a,e=>{e.repeat&&O(s)||c(e)&&n(e)},o)}function Re(e={}){let{window:t=De,deep:n=!0,triggerOnRemoval:r=!1}=e,i=e.document??t?.document,a=()=>{let e=i?.activeElement;if(n)for(var t;e?.shadowRoot;)e=e==null||(t=e.shadowRoot)==null?void 0:t.activeElement;return e},o=y(),s=()=>{o.value=a()};if(t){let e={capture:!0,passive:!0};ke(t,`blur`,e=>{e.relatedTarget===null&&s()},e),ke(t,`focus`,s,e)}return r&&Fe(o,s,{document:i}),s(),o}var ze={ctrl:`control`,command:`meta`,cmd:`meta`,option:`alt`,up:`arrowup`,down:`arrowdown`,left:`arrowleft`,right:`arrowright`};function Be(e={}){let{reactive:t=!1,target:n=De,aliasMap:r=ze,passive:i=!0,onEventFired:a=xe}=e,o=_(new Set),s={toJSON(){return{}},current:o},c=t?_(s):s,l=new Set,u=new Map([[`Meta`,l],[`Shift`,new Set],[`Alt`,new Set]]),d=new Set;function f(e,n){e in c&&(t?c[e]=n:c[e].value=n)}function p(){o.clear();for(let e of d)f(e,!1)}function h(e,t,n){if(!(!e||typeof t.getModifierState!=`function`)){for(let[e,r]of u)if(t.getModifierState(e)){n.forEach(e=>r.add(e));break}}}function g(e,t){if(e)return;let n=`${t[0].toUpperCase()}${t.slice(1)}`,r=u.get(n);if(![`shift`,`alt`].includes(t)||!r)return;let i=Array.from(r),a=i.indexOf(t);i.forEach((e,t)=>{t>=a&&(o.delete(e),f(e,!1))}),r.clear()}function v(e,t){let n=e.key?.toLowerCase(),r=[e.code?.toLowerCase(),n].filter(Boolean);n&&(t?o.add(n):o.delete(n));for(let e of r)d.add(e),f(e,t);h(t,e,[...o,...r]),g(t,n),n===`meta`&&!t&&(l.forEach(e=>{o.delete(e),f(e,!1)}),l.clear())}ke(n,`keydown`,e=>(v(e,!0),a(e)),{passive:i}),ke(n,`keyup`,e=>(v(e,!1),a(e)),{passive:i}),ke(`blur`,p,{passive:i}),ke(`focus`,p,{passive:i});let b=new Proxy(c,{get(e,n,i){if(typeof n!=`string`)return Reflect.get(e,n,i);if(n=n.toLowerCase(),n in r&&(n=r[n]),!(n in c))if(/[+_-]/.test(n)){let e=n.split(/[+_-]/g).map(e=>e.trim());c[n]=m(()=>e.map(e=>O(b[e])).every(Boolean))}else c[n]=y(!1);let a=Reflect.get(e,n,i);return t?O(a):a}});return b}var Ve={page:e=>[e.pageX,e.pageY],client:e=>[e.clientX,e.clientY],screen:e=>[e.screenX,e.screenY],movement:e=>e instanceof MouseEvent?[e.movementX,e.movementY]:null};function He(e={}){let{type:t=`page`,touch:n=!0,resetOnTouchEnds:r=!1,initialValue:i={x:0,y:0},window:a=De,target:o=a,scroll:s=!0,eventFilter:c}=e,l=null,u=0,d=0,f=y(i.x),p=y(i.y),m=y(null),h=typeof t==`function`?t:Ve[t],g=e=>{let t=h(e);l=e,t&&([f.value,p.value]=t,m.value=`mouse`),a&&(u=a.scrollX,d=a.scrollY)},_=e=>{if(e.touches.length>0){let t=h(e.touches[0]);t&&([f.value,p.value]=t,m.value=`touch`)}},v=()=>{if(!l||!a)return;let e=h(l);l instanceof MouseEvent&&e&&(f.value=e[0]+a.scrollX-u,p.value=e[1]+a.scrollY-d)},b=()=>{f.value=i.x,p.value=i.y},x=c?e=>c(()=>g(e),{}):e=>g(e),S=c?e=>c(()=>_(e),{}):e=>_(e),C=c?()=>c(()=>v(),{}):()=>v();if(o){let e={passive:!0};ke(o,[`mousemove`,`dragover`],x,e),n&&t!==`movement`&&(ke(o,[`touchstart`,`touchmove`],S,e),r&&ke(o,`touchend`,b,e)),s&&t===`page`&&ke(a,`scroll`,C,e)}return{x:f,y:p,sourceType:m}}var Ue=`http://localhost:3001`;function We(e={}){let t=e.serverUrl||Ue;async function n(e,n=[]){let r=`${t}/api/invoke`,i={channel:e,args:n};console.log(`[ç¼“å­˜è¯·æ±‚] å‘é€åˆ°: ${r}`),console.log(`[ç¼“å­˜è¯·æ±‚] æ“ä½œ: ${e}`),console.log(`[ç¼“å­˜è¯·æ±‚] å‚æ•°:`,n);try{let e=await fetch(r,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(i)});if(console.log(`[ç¼“å­˜å“åº”] çŠ¶æ€ç : ${e.status}`),console.log(`[ç¼“å­˜å“åº”] çŠ¶æ€: ${e.ok?`æˆåŠŸ`:`å¤±è´¥`}`),!e.ok){let t;try{t=await e.json(),console.log(`[ç¼“å­˜å“åº”] é”™è¯¯æ•°æ®:`,t)}catch{t={error:`HTTP ${e.status}`},console.log(`[ç¼“å­˜å“åº”] æ— æ³•è§£æé”™è¯¯å“åº”ï¼ŒçŠ¶æ€ç : ${e.status}`)}throw Error(t.error||`HTTP ${e.status}`)}let t=await e.json();if(console.log(`[ç¼“å­˜å“åº”] æˆåŠŸ:`,t),!t.success)throw Error(t.error||`æ“ä½œå¤±è´¥`);return t.data}catch(t){throw console.error(`ç¼“å­˜æ“ä½œå¤±è´¥ [${e}]:`,t),t}}return{async get(e,t){try{return(await n(`cache:get`,[e,t])).value}catch(t){let n=t instanceof Error?t.message:String(t);console.warn(`[ç¼“å­˜] è¯»å–å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°å­˜å‚¨ä½œä¸ºå¤‡é€‰ [${e}]:`,n);return}},async set(e,t,r){try{await n(`cache:set`,[e,t,r])}catch(e){throw console.error(`ä¿å­˜ç¼“å­˜å¤±è´¥:`,e),e}},async remove(e,t){try{await n(`cache:remove`,[e,t])}catch(e){throw console.error(`åˆ é™¤ç¼“å­˜å¤±è´¥:`,e),e}},async clear(e){try{await n(`cache:clear`,[e])}catch(e){throw console.error(`æ¸…ç©ºç¼“å­˜å¤±è´¥:`,e),e}}}}function Ge(){if(typeof window>`u`)return;let e;if(window?.httpApi?.url)e=window.httpApi.url;else{let t=window.location.href.split(`?`)[1];t&&(e=new URLSearchParams(t).get(`httpUrl`)||void 0)}e&&(globalThis.__CONTEXT__HANDLER__=We({serverUrl:e}))}Ge();var Ke=`app`;function qe(e,t){return`ctx:${t||Ke}:${e}`}var Je={async get(e,t){try{let n=qe(e,t?.namespace),r=globalThis.localStorage?.getItem(n);if(!r)return;let i=JSON.parse(r);if(typeof i?.expireAt==`number`&&Date.now()>i.expireAt){globalThis.localStorage?.removeItem(n);return}return i?.value}catch{return}},async set(e,t,n){let r=qe(e,n?.namespace),i={value:t,expireAt:n?.ttlMs?Date.now()+n.ttlMs:void 0};globalThis.localStorage?.setItem(r,JSON.stringify(i))},async remove(e,t){let n=qe(e,t?.namespace);globalThis.localStorage?.removeItem(n)},async clear(e){let t=`ctx:${e?.namespace||Ke}:`,n=globalThis.localStorage;if(!n)return;let r=[];for(let e=0;e<n.length;e++){let i=n.key(e);i&&i.startsWith(t)&&r.push(i)}for(let e of r)n.removeItem(e)}};function Ye(){let e=fe(),t=Je;return{cache:{get handler(){return t},setHandler(e){t=e},async save(n,r,i){try{await t.set(n,r,i),e.emit(`save`,{key:n,value:r,options:i})}catch(t){throw e.emit(`save`,{key:n,value:r,options:i,error:t}),t}},async read(n,r){try{let i=await t.get(n,r);return e.emit(`read`,{key:n,options:r,result:i}),i}catch(t){throw e.emit(`read`,{key:n,options:r,error:t}),t}},async remove(n,r){try{await t.remove(n,r),e.emit(`remove`,{key:n,options:r})}catch(t){throw e.emit(`remove`,{key:n,options:r,error:t}),t}},async clear(n){try{typeof t.clear==`function`&&await t.clear(n),e.emit(`clear`,{options:n})}catch(t){throw e.emit(`clear`,{options:n,error:t}),t}},subscribe(t,n){return e.on(t,n),()=>e.off(t,n)}}}}globalThis.__CONTEXT__||(globalThis.__CONTEXT__=Ye(),globalThis.__CONTEXT__HANDLER__&&(console.log(`ğŸš€ ~ åŠ è½½ä¸Šä¸‹æ–‡å¤„ç†å™¨:`,globalThis.__CONTEXT__HANDLER__),globalThis.__CONTEXT__.cache.setHandler(globalThis.__CONTEXT__HANDLER__)));const Xe=()=>globalThis.__CONTEXT__,Ze={autoSave:!0,gridSize:20,snapToGrid:!1,executionMode:`worker`,serverUrl:`http://localhost:3000`,maxConcurrent:3,defaultZoom:1,minZoom:.1,maxZoom:4,edgeType:`default`,edgeWidth:2,edgeColor:`#94a3b8`,edgeActiveColor:`#3b82f6`,edgeAnimation:!1,edgeShowArrow:!0,showGrid:!0,gridType:`dots`,gridGap:20,bgColor:`#ffffff`,gridColor:`#e2e8f0`,showMiniMap:!1,autoLayoutDirection:`LR`,autoLayoutNodeSpacing:50,autoLayoutRankSpacing:80,autoLayoutPadding:120,autoLayoutFitView:!0,autoLayoutFitViewPadding:.2,autoLayoutFitViewDuration:400};var Qe=`editorConfig`,$e=`v2`;async function et(){try{let e=await Xe().cache.read(Qe,{namespace:$e});if(e)return{...Ze,...e}}catch(e){console.error(`[EditorConfig Store] åŠ è½½é…ç½®å¤±è´¥:`,e)}return{...Ze}}async function tt(e){try{await Xe().cache.save(Qe,e,{namespace:$e})}catch(e){console.error(`[EditorConfig Store] ä¿å­˜é…ç½®å¤±è´¥:`,e)}}const nt=t(`editorConfig`,()=>{let e=M(!1),t=M({...Ze});(async()=>{t.value=await et();let n=new URLSearchParams(window.location.href.split(`?`)[1]),r=n.get(`serverUrl`);console.log(n,r),r&&(t.value.executionMode=`server`,t.value.serverUrl=r),e.value=!0})();let n=null;function r(e){t.value={...t.value,...e}}function i(){t.value={...Ze}}function a(){return JSON.stringify(t.value,null,2)}function o(e){try{let n=JSON.parse(e);return t.value={...Ze,...n},!0}catch(e){return console.error(`[EditorConfig Store] å¯¼å…¥é…ç½®å¤±è´¥:`,e),!1}}D(t,e=>{n!==null&&clearTimeout(n),n=window.setTimeout(()=>{tt(e),n=null},500)},{deep:!0,flush:`post`});async function s(){for(;!e.value;)await new Promise(e=>setTimeout(e,10));return!0}return{init:e,config:t,updateConfig:r,resetConfig:i,exportConfig:a,importConfig:o,ready:s}});var rt=`workflows`,it=`current-workflow-id`,at=`global-variables`,ot=2,st=`v2`;function ct(e){return`${e}-${Math.random().toString(36).slice(2,8)}-${Date.now()}`}async function lt(){try{return await Xe().cache.read(it,{namespace:st})??null}catch(e){return console.error(`åŠ è½½å½“å‰å·¥ä½œæµ ID å¤±è´¥:`,e),null}}async function ut(e){try{let t=Xe();e?await t.cache.save(it,e,{namespace:st}):await t.cache.remove(it,{namespace:st})}catch(e){console.error(`ä¿å­˜å½“å‰å·¥ä½œæµ ID å¤±è´¥:`,e)}}async function dt(){try{let e=await Xe().cache.read(at,{namespace:st});return Array.isArray(e)?e:[]}catch(e){return console.error(`åŠ è½½å…¨å±€å˜é‡å¤±è´¥:`,e),[]}}async function ft(e){try{await Xe().cache.save(at,e,{namespace:st})}catch(e){console.error(`ä¿å­˜å…¨å±€å˜é‡å¤±è´¥:`,e)}}function pt(){let e=Date.now(),t={id:ct(`folder`),name:`æˆ‘çš„å·¥ä½œæµ`,parentId:null,order:0,createdAt:e,updatedAt:e},n={workflow_id:`workflow-1`,name:`åŸºç¡€æµç¨‹`,description:`åŸºç¡€æµç¨‹ç¤ºä¾‹`,folderId:t.id,order:0,nodes:[],edges:[],createdAt:e,updatedAt:e};return{version:ot,workflows:[n],folders:[t]}}function mt(e){let t=Date.now(),n=[],r=new Map,i=new Map,a=e=>{let t=i.get(e)??0;return i.set(e,t+1),t},o=e=>{if(!e)return null;if(r.has(e))return r.get(e)||null;let i=e.split(`/`).filter(Boolean),o=null,s=``;for(let e of i){if(s=s?`${s}/${e}`:e,r.has(s)){o=r.get(s)||null;continue}let i={id:ct(`folder`),name:e,parentId:o,order:a(o),createdAt:t,updatedAt:t};n.push(i),r.set(s,i.id),o=i.id}return r.get(e)??null},s=e.map((e,n)=>{let r=o(e.path);return{...e,folderId:r,order:n,createdAt:e.createdAt??t,updatedAt:e.updatedAt??t}});if(n.length===0){let e=pt();return{version:ot,workflows:e.workflows,folders:e.folders}}return{version:ot,workflows:s,folders:n}}async function ht(){try{let e=await Xe().cache.read(rt,{namespace:st});if(!e)return pt();if(Array.isArray(e))return mt(e);if(!e.version||e.version<ot){let t=e.workflows;return t&&Array.isArray(t)?mt(t):pt()}return e}catch(e){return console.error(`åŠ è½½å·¥ä½œæµå¤±è´¥:`,e),pt()}}async function gt(e){try{await Xe().cache.save(rt,e,{namespace:st})}catch(e){console.error(`ä¿å­˜å·¥ä½œæµå¤±è´¥:`,e)}}function _t(e,t,n){if(!t)return``;if(n.has(t))return n.get(t)||``;let r=e.find(e=>e.id===t);if(!r)return``;let i=_t(e,r.parentId,n),a=i?`${i}/${r.name}`:r.name;return n.set(t,a),a}function vt(e){let t=[],n=new Map,r=i=>{let a=e.filter(e=>e.parentId===i).sort((e,t)=>e.order-t.order);for(let i of a){let a=_t(e,i.id,n);a&&t.push(a),r(i.id)}};return r(null),t}function yt(e,t){return t.type===`folder`?e.kind===`folder`&&e.data.id===t.folderId:e.kind===`workflow`&&e.data.workflow_id===t.workflowId}function bt(e,t){let n=new Map,r=i=>{let a=e.filter(e=>e.parentId===i).map(t=>{let i=r(t.id),a={type:`folder`,folderId:t.id,parentFolderId:t.parentId,order:t.order,path:_t(e,t.id,n)};return{key:`folder-${t.id}`,label:t.name,isLeaf:!1,children:i,meta:a}}),o=t.filter(e=>e.folderId===i).map(t=>{let r={type:`workflow`,workflowId:t.workflow_id,parentFolderId:t.folderId,order:t.order,path:_t(e,t.folderId,n),createdAt:t.createdAt,updatedAt:t.updatedAt,nodeCount:t.nodes.length,description:t.description};return{key:t.workflow_id,label:t.name||`æœªå‘½åå·¥ä½œæµ`,isLeaf:!0,meta:r}}),s=[...a,...o];return s.sort((e,t)=>{let n=e.meta,r=t.meta,i=n?.order??0,a=r?.order??0;return i-a}),s};return r(null)}const xt=t(`workflow`,()=>{let e=pt(),t=M(e.workflows),r=M(e.folders),i=M(null),a=M([]);(async()=>{let e=await ht();t.value=e.workflows,r.value=e.folders,i.value=await lt(),a.value=await dt()})();let o=null,s=m(()=>i.value&&t.value.find(e=>e.workflow_id===i.value)||null),c=m(()=>t.value.length),l=m(()=>bt(r.value,t.value)),u=m(()=>vt(r.value));async function d(){await gt({version:ot,workflows:t.value,folders:r.value})}D([t,r],()=>{o!==null&&clearTimeout(o),o=window.setTimeout(()=>{d(),o=null},500)},{deep:!0,flush:`post`}),D(i,e=>{ut(e)}),D(a,()=>{ft(a.value)},{deep:!0});function f(e){if(e)return r.value.find(t=>t.id===e)}function p(e){return t.value.find(t=>t.workflow_id===e)}function h(e){return _t(r.value,e,new Map)}function g(e){let n=r.value.filter(t=>t.parentId===e).map(e=>({kind:`folder`,data:e})),i=t.value.filter(t=>t.folderId===e).map(e=>({kind:`workflow`,data:e})),a=[...n,...i];return a.sort((e,t)=>{let n=(e.kind,e.data.order),r=(t.kind,t.data.order);return n-r}),a}function _(e){e.forEach((e,t)=>{e.kind,e.data.order=t,e.data.updatedAt=Date.now()})}function v(e){let t=e.split(`/`).map(e=>e.trim()).filter(Boolean);if(t.length===0)return null;let n=null;for(let e of t){let t=r.value.find(t=>t.parentId===n&&t.name===e);if(!t){let i=Date.now(),a=g(n).length;t={id:ct(`folder`),name:e,parentId:n,order:a,createdAt:i,updatedAt:i},r.value.push(t)}n=t.id}return n}function y(e,n=`æˆ‘çš„å·¥ä½œæµ`,r){let i=Date.now(),a=n?v(n):null,o=g(a).length,s={workflow_id:ct(`workflow`),name:e,description:r,folderId:a,order:o,nodes:[],edges:[],createdAt:i,updatedAt:i};return t.value.push(s),s}function b(e){let n=t.value.findIndex(t=>t.workflow_id===e);if(n===-1)return;let r=t.value[n],a=g(r.folderId).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));_(a),t.value.splice(n,1),i.value===e&&(i.value=null)}function x(e,t){let n=p(e);n&&Object.assign(n,t,{updatedAt:Date.now()})}function S(e){i.value=e}function C(e){return p(e)}function w(e,t){x(e,{name:t})}function ee(e,t){let n=p(e);if(!n)return;let r=t?v(t):null,i=g(r).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));if(n.folderId!==r){let t=g(n.folderId).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));_(t)}i.push({kind:`workflow`,data:n}),_(i),n.folderId=r,n.updatedAt=Date.now()}function T(e){let n=p(e);if(!n)return null;let r=Date.now(),i=g(n.folderId).length,a={...JSON.parse(JSON.stringify(n)),workflow_id:ct(`workflow`),name:`${n.name} (å‰¯æœ¬)`,order:i,createdAt:r,updatedAt:r};return t.value.push(a),a}function E(){t.value=[],r.value=[],i.value=null}function te(){let e=pt();t.value=e.workflows,r.value=e.folders,i.value=null}function ne(e){let t=p(e);return t?JSON.stringify(t,null,2):null}function re(e){try{let n=JSON.parse(e),r=Date.now(),i=g(null).length,a={...n,workflow_id:ct(`workflow`),folderId:null,order:i,createdAt:r,updatedAt:r};return t.value.push(a),a}catch(e){return console.error(`å¯¼å…¥å·¥ä½œæµå¤±è´¥:`,e),null}}function O(e,t=``){let n=e.trim(),i=t.trim(),a=i?v(i):null,o=r.value.find(e=>e.parentId===a&&e.name===n);if(o)return o;let s=Date.now(),c=g(a).length,l={id:ct(`folder`),name:n,parentId:a,order:c,createdAt:s,updatedAt:s};return r.value.push(l),l}function ie(e,n=!1){let a=f(e);if(!a)return{success:!1,message:`æ–‡ä»¶å¤¹ä¸å­˜åœ¨`};let o=g(e);if(o.length>0&&!n)return{success:!1,message:`æ–‡ä»¶å¤¹ä¸ä¸ºç©ºï¼ŒåŒ…å« ${o.length} ä¸ªé¡¹ç›®`};let s=0,c=0;if(n){let n=e=>{let a=g(e);for(let e of a)if(e.kind===`folder`){n(e.data.id);let t=r.value.findIndex(t=>t.id===e.data.id);t>-1&&(r.value.splice(t,1),s++)}else{let n=t.value.findIndex(t=>t.workflow_id===e.data.workflow_id);n>-1&&(t.value.splice(n,1),c++,i.value===e.data.workflow_id&&(i.value=null))}};n(e)}let l=r.value.findIndex(t=>t.id===e);l>-1&&(r.value.splice(l,1),s++);let u=g(a.parentId).filter(t=>!(t.kind===`folder`&&t.data.id===e));return _(u),{success:!0,message:n?`å·²åˆ é™¤æ–‡ä»¶å¤¹åŠå…¶å†…å®¹`:`æ–‡ä»¶å¤¹å·²åˆ é™¤`,deletedCount:{folders:s,workflows:c}}}function k(e,t){let n=e;for(;n;){if(n===t)return!0;n=f(n)?.parentId??null}return!1}function ae(e,t){return t===`inside`?e.type===`folder`?e.folderId:e.parentFolderId:(e.type,e.parentFolderId)}function A(e,t,n){if(n===`inside`)return e.length;let r=e.findIndex(e=>yt(e,t));return r===-1?e.length:n===`before`?r:r+1}function j(e){let{dragMeta:t,targetMeta:n,dropPosition:r}=e;if(t.type===`workflow`&&n.type===`workflow`&&t.workflowId===n.workflowId||t.type===`folder`&&n.type===`folder`&&t.folderId===n.folderId)return;let i=ae(n,r);if(t.type===`workflow`){let e=p(t.workflowId);if(!e)return;let a=e.folderId,o=g(i).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e.workflow_id));if(a!==i){let t=g(a).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e.workflow_id));_(t),e.folderId=i}let s=A(o,n,r);o.splice(s,0,{kind:`workflow`,data:e}),_(o),e.updatedAt=Date.now();return}let a=f(t.type===`folder`?t.folderId:null);if(!a||i===a.id||k(i,a.id))return;let o=a.parentId,s=g(i).filter(e=>!(e.kind===`folder`&&e.data.id===a.id));if(o!==i){let e=g(o).filter(e=>!(e.kind===`folder`&&e.data.id===a.id));_(e),a.parentId=i}let c=A(s,n,r);s.splice(c,0,{kind:`folder`,data:a}),_(s),a.updatedAt=Date.now()}function oe(e){a.value.push(e)}function se(e,t){let n=a.value.find(t=>t.key===e);n&&Object.assign(n,t)}function ce(e){let t=a.value.findIndex(t=>t.key===e);t>-1&&a.value.splice(t,1)}function le(e){return a.value.find(t=>t.key===e)}function ue(e){a.value=e}function de(){return a.value.reduce((e,t)=>(e[t.key]=n(t.value),e),{})}return{workflows:t,folders:r,currentWorkflowId:i,currentWorkflow:s,workflowCount:c,treeData:l,folderPathList:u,createWorkflow:y,deleteWorkflow:b,updateWorkflow:x,setCurrentWorkflow:S,getWorkflowById:C,renameWorkflow:w,moveWorkflow:ee,duplicateWorkflow:T,clearAllWorkflows:E,resetToDefaults:te,exportWorkflow:ne,importWorkflow:re,createFolder:O,deleteFolder:ie,ensureFolderPath:v,handleTreeDrop:j,buildFolderPath:h,globalVariables:a,addGlobalVariable:oe,updateGlobalVariable:se,deleteGlobalVariable:ce,getGlobalVariable:le,setGlobalVariables:ue,getGlobalVariableJson:de}});function St(){let e=M(`idle`),t=M(0),n=M(null),r=M(null),i=M(new Map),a=M(null),o=M(null),s=M(null),c=m(()=>e.value===`running`),l=m(()=>e.value===`paused`),u=m(()=>e.value===`completed`),d=m(()=>e.value===`error`),f=m(()=>o.value?(s.value||Date.now())-o.value:null);function p(t){e.value=t}function h(e){t.value=Math.max(0,Math.min(1,e))}function g(a,c){n.value=a,r.value=c,e.value=`running`,t.value=0,o.value=Date.now(),s.value=null,i.value.clear()}function _(n){a.value=n,e.value=n.success?`completed`:`error`,t.value=1,s.value=Date.now(),n.nodeResults&&(n.nodeResults instanceof Map?i.value=new Map(n.nodeResults):typeof n.nodeResults==`object`&&(i.value=new Map(Object.entries(n.nodeResults))))}function v(e,t){let n={...i.value.get(e)||{nodeId:e,status:`pending`},...t};i.value.set(e,n),i.value=new Map(i.value)}function y(){e.value=`idle`,t.value=0,n.value=null,r.value=null,i.value.clear(),a.value=null,o.value=null,s.value=null}return{state:e,progress:t,executionId:n,workflowId:r,nodeStates:i,lastResult:a,isExecuting:c,isPaused:l,isCompleted:u,hasError:d,startTime:o,endTime:s,duration:f,setState:p,setProgress:h,startExecution:g,completeExecution:_,updateNodeState:v,reset:y}}var Ct=class{constructor(e){this.ws=null,this.reconnectAttempts=0,this.reconnectTimer=null,this.messageHandlers=new Map,this.loggerPrefix=`[WSClient]`,this.initialized=!1,this.pendingCommands=[],this.config={url:e.url,autoReconnect:e.autoReconnect??!0,reconnectInterval:e.reconnectInterval??3e3,maxReconnectAttempts:e.maxReconnectAttempts??5,enableLogging:e.enableLogging??!0}}async connect(){return new Promise((e,t)=>{try{this.log(`æ­£åœ¨è¿æ¥åˆ°æœåŠ¡å™¨:`,this.config.url),this.ws=new WebSocket(this.config.url),this.ws.onopen=()=>{this.log(`å·²è¿æ¥åˆ°æœåŠ¡å™¨`),this.reconnectAttempts=0,this.sendCommand({type:`INIT`}),this.flushPendingCommands(),e()},this.ws.onmessage=e=>{this.handleMessage(e.data)},this.ws.onerror=e=>{this.error(`WebSocket é”™è¯¯:`,e),t(e)},this.ws.onclose=()=>{this.log(`è¿æ¥å·²å…³é—­`),this.initialized=!1,this.config.autoReconnect&&this.attemptReconnect()}}catch(e){t(e)}})}attemptReconnect(){if(this.reconnectAttempts>=this.config.maxReconnectAttempts){this.error(`å·²è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°`);return}this.reconnectAttempts++,this.log(`å°è¯•é‡è¿ (${this.reconnectAttempts}/${this.config.maxReconnectAttempts})`),this.reconnectTimer=window.setTimeout(()=>{this.connect().catch(()=>{})},this.config.reconnectInterval)}disconnect(){this.reconnectTimer&&=(clearTimeout(this.reconnectTimer),null),this.ws&&=(this.ws.close(),null)}sendCommand(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){this.pendingCommands.push(e);return}this.ws.send(JSON.stringify(e))}flushPendingCommands(){for(;this.pendingCommands.length>0;){let e=this.pendingCommands.shift();e&&this.sendCommand(e)}}handleMessage(e){try{let t=JSON.parse(e),n=this.messageHandlers.get(t.type);n&&n(t.payload),t.type===`INITIALIZED`&&(this.initialized=!0,this.log(`æœåŠ¡ç«¯æ‰§è¡Œå™¨å·²åˆå§‹åŒ–`))}catch(e){this.error(`è§£ææ¶ˆæ¯å¤±è´¥:`,e)}}on(e,t){this.messageHandlers.set(e,t)}off(e){this.messageHandlers.delete(e)}execute(e,t){this.sendCommand({type:`EXECUTE`,payload:{workflow:e,options:t}})}pause(){this.sendCommand({type:`PAUSE`})}resume(){this.sendCommand({type:`RESUME`})}stop(){this.sendCommand({type:`STOP`})}getCacheStats(e,t){this.sendCommand({type:`GET_CACHE_STATS`,payload:{workflowId:e,requestId:t}})}clearCache(e){this.sendCommand({type:`CLEAR_CACHE`,payload:{workflowId:e}})}clearAllCache(){this.sendCommand({type:`CLEAR_ALL_CACHE`})}getNodeList(e){this.sendCommand({type:`GET_NODE_LIST`,payload:{requestId:e}})}getHistory(e,t,n,r){this.sendCommand({type:`GET_HISTORY`,payload:{requestId:e,workflowId:t,page:n,pageSize:r}})}clearHistory(e){this.sendCommand({type:`CLEAR_HISTORY`,payload:{workflowId:e}})}deleteHistory(e){this.sendCommand({type:`DELETE_HISTORY`,payload:{executionId:e}})}isInitialized(){return this.initialized}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}log(...e){this.config.enableLogging&&console.log(this.loggerPrefix,...e)}error(...e){this.config.enableLogging&&console.error(this.loggerPrefix,...e)}},wt={mode:`worker`,serverUrl:`ws://localhost:3001`,timeout:6e4,useCache:!0,autoReconnect:!0},Tt=5e3;function Et(e){let t=null,n=new Set,r=e=>{n.forEach(t=>t(e))};return{async init(){t||(t=e?new Worker(e,{type:`module`}):new Worker(new URL(``+new URL(`worker-9-5k_gA1.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),t.onmessage=e=>{r(e.data)},t.onerror=e=>{console.error(`[VueFlowExecution][Worker] é”™è¯¯:`,e.message)})},terminate(){t&&=(t.terminate(),null)},send(e){if(!t)throw Error(`æ‰§è¡Œé€šé“æœªåˆå§‹åŒ–`);t.postMessage(e)},onMessage(e){n.add(e)},offMessage(e){n.delete(e)}}}function Dt(e){let t={...wt,...e},n=nt(),{config:r}=le(n),i=m(()=>r.value.executionMode),a=M(!1),o=St(),s=null,c=null,l=null,u=new Map,d=new Map,f=new Map,p=new Map;async function h(){if(s&&a.value)return s;if(s&&fe(),await n.ready(),i.value===`worker`){let e=Et(t.workerUrl);c=de,e.onMessage(de),await e.init(),e.send({type:`INIT`}),s=e,a.value=!0,console.log(`[VueFlowExecution] Worker é€šé“å·²å‡†å¤‡`)}else if(i.value===`server`){let e=r.value.serverUrl;e.startsWith(`http://`)?e=e.replace(`http://`,`ws://`):e.startsWith(`https://`)?e=e.replace(`https://`,`wss://`):!e.startsWith(`ws://`)&&!e.startsWith(`wss://`)&&(e=`ws://`+e);let t=new Ct({url:e,autoReconnect:!0,enableLogging:!0});await t.connect();let n={init:async()=>Promise.resolve(),send:e=>{switch(e.type){case`EXECUTE`:t.execute(e.payload.workflow,e.payload.options);break;case`PAUSE`:t.pause();break;case`RESUME`:t.resume();break;case`STOP`:t.stop();break;case`GET_CACHE_STATS`:t.getCacheStats(e.payload.workflowId,e.payload.requestId);break;case`CLEAR_CACHE`:t.clearCache(e.payload.workflowId);break;case`CLEAR_ALL_CACHE`:t.clearAllCache();break;case`GET_NODE_LIST`:t.getNodeList(e.payload.requestId);break;case`GET_HISTORY`:t.getHistory(e.payload.requestId,e.payload.workflowId,e.payload.page,e.payload.pageSize);break;case`CLEAR_HISTORY`:t.clearHistory(e.payload.workflowId);break;case`DELETE_HISTORY`:t.deleteHistory(e.payload.executionId);break;default:console.warn(`[VueFlowExecution] æœªçŸ¥çš„å‘½ä»¤ç±»å‹:`,e)}},onMessage:e=>{[`INITIALIZED`,`EXECUTION_START`,`EXECUTION_COMPLETE`,`EXECUTION_ERROR`,`NODE_START`,`NODE_COMPLETE`,`NODE_ERROR`,`PROGRESS`,`CACHE_HIT`,`ITERATION_UPDATE`,`STATE_CHANGE`,`CACHE_STATS`,`NODE_LIST`,`HISTORY_DATA`,`ERROR`].forEach(n=>{t.on(n,t=>{e({type:n,payload:t})})})},offMessage:()=>{},terminate:()=>{t.disconnect()}};s=n,c=de,n.onMessage(de),a.value=!0,console.log(`[VueFlowExecution] WebSocket é€šé“å·²å‡†å¤‡`)}else throw Error(`ä¸æ”¯æŒçš„æ‰§è¡Œæ¨¡å¼: ${i.value}`);return s}async function g(e,t){return await h(),l?Promise.reject(Error(`å·²æœ‰æ‰§è¡Œä»»åŠ¡æ­£åœ¨ç­‰å¾…å¼€å§‹`)):new Promise((n,r)=>{l={resolve:n,reject:r},s.send({type:`EXECUTE`,payload:{workflow:e,options:t}})})}function _(){s?.send({type:`PAUSE`})}function v(){s?.send({type:`RESUME`})}function y(){s?.send({type:`STOP`})}async function b(e){await h();let t=P();return new Promise((n,r)=>{let i=setTimeout(()=>{d.delete(t),r(Error(`è·å–ç¼“å­˜ç»Ÿè®¡è¶…æ—¶`))},Tt);d.set(t,{resolve:n,reject:r,timer:i}),s.send({type:`GET_CACHE_STATS`,payload:{workflowId:e,requestId:t}})})}async function x(e){await h(),s.send({type:`CLEAR_CACHE`,payload:{workflowId:e}})}async function S(){await h(),s.send({type:`CLEAR_ALL_CACHE`})}async function C(){await h();let e=P();return new Promise((t,n)=>{let r=setTimeout(()=>{f.delete(e),n(Error(`è·å–èŠ‚ç‚¹åˆ—è¡¨è¶…æ—¶`))},Tt);f.set(e,{resolve:t,reject:n,timer:r}),s.send({type:`GET_NODE_LIST`,payload:{requestId:e}})})}async function w(e,t=1,n=20){await h();let r=P();return new Promise((i,a)=>{let o=setTimeout(()=>{p.delete(r),a(Error(`è·å–å†å²è®°å½•è¶…æ—¶`))},Tt);p.set(r,{resolve:i,reject:a,timer:o}),s.send({type:`GET_HISTORY`,payload:{requestId:r,workflowId:e,page:t,pageSize:n}})})}async function ee(e){await h(),s.send({type:`CLEAR_HISTORY`,payload:{workflowId:e}})}async function T(e){await h(),s.send({type:`DELETE_HISTORY`,payload:{executionId:e}})}async function E(e){console.warn(`[VueFlowExecution] switchMode å·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨é…ç½®é¢æ¿åˆ‡æ¢æ‰§è¡Œæ¨¡å¼`),e!==i.value&&(fe(),n.updateConfig({executionMode:e}),await h(),console.log(`[VueFlowExecution] å·²åˆ‡æ¢åˆ° ${e} æ¨¡å¼`))}function D(e){o.startExecution(e.executionId,e.workflowId),N.emit(`execution:start`,e),N.emit(`workflow:execution-started`,{workflowId:e.workflowId}),l&&=(u.set(e.executionId,l),null)}function te(e){o.completeExecution(e),N.emit(`execution:complete`,e),N.emit(`workflow:execution-completed`,{workflowId:e.workflowId,success:e.success});let t=u.get(e.executionId);t&&(t.resolve(e),u.delete(e.executionId))}function ne(e){o.setState(`error`),N.emit(`execution:error`,e);let t=u.get(e.executionId);if(t){t.reject(Error(e.error)),u.delete(e.executionId);return}l&&=(l.reject(Error(e.error)),null)}function re(e){o.updateNodeState(e.nodeId,{status:`running`,startTime:Date.now()}),N.emit(`execution:node:start`,e)}function O(e){o.updateNodeState(e.nodeId,{status:`success`,outputs:e.result,endTime:Date.now()}),N.emit(`execution:node:complete`,e)}function k(e){o.updateNodeState(e.nodeId,{status:`error`,error:e.error,endTime:Date.now()}),N.emit(`execution:node:error`,e)}function ae(e){o.setProgress(e.progress),N.emit(`execution:progress`,e)}function A(e){o.updateNodeState(e.nodeId,{status:`cached`,outputs:e.cachedResult.outputs,fromCache:!0}),N.emit(`execution:cache-hit`,e)}function j(e){N.emit(`execution:iteration:update`,e)}function oe(e){o.setState(e.state),N.emit(`execution:state`,e)}function se(e,t){let n=d.get(e);n&&(clearTimeout(n.timer),n.resolve(t),d.delete(e))}function ce(e,t){let n=f.get(e);n&&(clearTimeout(n.timer),n.resolve(t),f.delete(e))}function ue(e,t,n,r,i){let a=p.get(e);a&&(clearTimeout(a.timer),a.resolve({history:t,total:n,page:r,pageSize:i}),p.delete(e))}function de(e){switch(e.type){case`INITIALIZED`:console.log(`[VueFlowExecution] Worker åˆå§‹åŒ–å®Œæˆ`);break;case`EXECUTION_START`:D(e.payload);break;case`EXECUTION_COMPLETE`:te(e.payload);break;case`EXECUTION_ERROR`:ne(e.payload);break;case`NODE_START`:re(e.payload);break;case`NODE_COMPLETE`:O(e.payload);break;case`NODE_ERROR`:k(e.payload);break;case`PROGRESS`:ae(e.payload);break;case`CACHE_HIT`:A(e.payload);break;case`ITERATION_UPDATE`:j(e.payload);break;case`CACHE_STATS`:se(e.payload.requestId,e.payload.stats);break;case`NODE_LIST`:ce(e.payload.requestId,e.payload.nodes);break;case`HISTORY_DATA`:ue(e.payload.requestId,e.payload.history,e.payload.total,e.payload.page,e.payload.pageSize);break;case`STATE_CHANGE`:oe(e.payload);break;case`ERROR`:console.error(`[VueFlowExecution] é€šé“é”™è¯¯:`,e.payload);break;default:console.warn(`[VueFlowExecution] æœªçŸ¥çš„é€šé“æ¶ˆæ¯:`,e)}}function fe(){s&&(c&&s.offMessage(c),s.terminate(),s=null,c=null),l&&=(l.reject(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`)),null),u.forEach(({reject:e})=>e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))),u.clear(),d.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),d.clear(),f.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),f.clear(),p.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),p.clear(),a.value=!1}ie(()=>{fe()});function P(){return`req_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}return{mode:i,state:o,execute:g,pause:_,resume:v,stop:y,getCacheStats:b,clearCache:x,clearAllCache:S,switchMode:E,getNodeList:C,getHistory:w,clearHistory:ee,deleteHistory:T,isInitialized:a,ensureChannel:h,cleanupChannel:fe}}const Ot=t(`newCanvas`,()=>{let e=xt(),t=T(Dt()),n=M(!1),r=M([]),i=M(0),a=M([]),o=M(!1),s=M(null),c=M(new Map),l=M(null),u=m(()=>e.currentWorkflow?.nodes||[]),d=m(()=>e.currentWorkflow?.edges||[]),f=m(()=>u.value.length),p=m(()=>d.value.length),h=m(()=>e.currentWorkflowId),g=m(()=>e.currentWorkflow?.name||`æœªå‘½åå·¥ä½œæµ`),_=0,v=performance.now(),y=null;function b(){_++;let e=performance.now(),t=e-v;t>=1e3&&(i.value=Math.round(_*1e3/t),_=0,v=e),y=requestAnimationFrame(b)}b();function x(e){n.value=e}function S(e){let t=new Date().toLocaleTimeString();r.value=[{...e,timestamp:t},...r.value].slice(0,10)}function C(){r.value=[]}function w(e){return u.value.find(t=>t.id===e)}function ee(t){if(!e.currentWorkflow){console.warn(`æ²¡æœ‰æ´»åŠ¨çš„å·¥ä½œæµï¼Œæ— æ³•æ·»åŠ èŠ‚ç‚¹`);return}e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:[...u.value,t]})}function E(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:u.value.filter(e=>e.id!==t),edges:d.value.filter(e=>e.source!==t&&e.target!==t)})}function D(t,n){if(!e.currentWorkflow)return;let r=u.value.map(e=>e.id===t?{...e,...n}:e);e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:r})}function te(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:t})}function ne(t){if(!e.currentWorkflow){console.warn(`æ²¡æœ‰æ´»åŠ¨çš„å·¥ä½œæµï¼Œæ— æ³•æ·»åŠ è¿çº¿`);return}e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:[...d.value,t]})}function re(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:d.value.filter(e=>e.id!==t)})}function O(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:t})}function ie(t){e.setCurrentWorkflow(t),C()}function k(){e.currentWorkflow&&(e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:[],edges:[]}),C())}function ae(){y!==null&&(cancelAnimationFrame(y),y=null)}function A(e,t){let n=w(e);if(!n)return;let r=n.data?.iterationHistory||{iterations:[],totalIterations:0,currentPage:1};r.iterations.push(t),r.totalIterations=r.iterations.length,D(e,{data:{...n.data,iterationHistory:r}})}function j(e,t){let n=w(e);if(!n?.data?.iterationHistory)return;let r=n.data.iterationHistory;r.currentPage=Math.max(1,Math.min(t,r.totalIterations)),D(e,{data:{...n.data,iterationHistory:r}})}function oe(e){let t=w(e);t&&D(e,{data:{...t.data,iterationHistory:void 0}})}async function se(e=!1){if(!o.value&&!(!e&&a.value.length>0)){o.value=!0;try{a.value=await t.getNodeList(),s.value=Date.now()}catch(e){console.error(`[Canvas] åŠ è½½èŠ‚ç‚¹åˆ—è¡¨å¤±è´¥:`,e),a.value=[]}finally{o.value=!1}}}function ce(e){return c.value.get(e)}function le(e,t){let n=c.value.get(e),r={nodeId:e,status:`pending`,...n,...t};r.duration===void 0&&r.startTime&&r.endTime&&(r.duration=r.endTime-r.startTime),c.value.set(e,r),c.value=new Map(c.value)}function ue(){c.value.clear(),l.value=null}function de(n,r){if(console.log(`[Canvas] åŠ è½½æ‰§è¡ŒçŠ¶æ€:`,n),ue(),l.value=n.executionId,t.state.completeExecution(n),r?.nodes&&r?.edges&&(console.log(`[Canvas] æ¢å¤å·¥ä½œæµç»“æ„:`,{nodes:r.nodes.length,edges:r.edges.length}),e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:r.nodes,edges:r.edges})),n.nodeResults){let e=n.nodeResults instanceof Map?n.nodeResults:new Map(Object.entries(n.nodeResults));for(let[t,n]of e.entries())if(n&&typeof n==`object`){let e=n,r=e.status||`success`;r===`success`||r===`completed`?le(t,{status:`success`,result:e.outputs||n,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()}):r===`error`||r===`failed`?le(t,{status:`error`,error:e.error||`æ‰§è¡Œå¤±è´¥`,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()}):r===`cached`&&le(t,{status:`cached`,result:e.outputs||n,duration:e.duration||0,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()})}}console.log(`[Canvas] å·²åŠ è½½æ‰§è¡ŒçŠ¶æ€ï¼ŒèŠ‚ç‚¹æ•°é‡:`,c.value.size)}return{nodes:u,edges:d,nodeCount:f,edgeCount:p,currentWorkflowId:h,currentWorkflowName:g,isExecuting:n,lastNodeResults:r,fps:i,setExecuting:x,pushNodeResult:S,clearResults:C,getNodeById:w,addNode:ee,removeNode:E,updateNode:D,updateNodes:te,addEdge:ne,removeEdge:re,updateEdges:O,loadWorkflowById:ie,clearCanvas:k,appendNodeIterationHistory:A,setNodeIterationPage:j,clearNodeIterationHistory:oe,availableNodes:a,isLoadingNodeList:o,nodeListLoadedAt:s,loadNodeList:se,nodeExecutionStatuses:c,currentExecutionId:l,getNodeExecutionStatus:ce,setNodeExecutionStatus:le,clearNodeExecutionStatuses:ue,loadExecutionStatus:de,vueFlowExecution:t,stopFPSCalculation:ae}});var kt=class{getStyleConfig(){return{}}getInputs(){return this.defineInputs()}getOutputs(){return this.defineOutputs()}getStyle(){return this.getStyleConfig()}getInput(e,t,n){if(e&&Object.prototype.hasOwnProperty.call(e,t))return e[t];let r=this.defineInputs().find(e=>e.name===t);return r&&r.defaultValue!==void 0?r.defaultValue:n}createOutput(e,t,n){let r=this.defineOutputs();if(r.length===1&&!this.isPlainObject(e)){let[i]=r;return{outputs:{[i.name]:e},raw:t??e,summary:n,success:!0}}return{outputs:this.isPlainObject(e)?e:{},raw:t??e,summary:n,success:!0}}createError(e){return{success:!1,error:e instanceof Error?e.message:e,outputs:{}}}validateInputs(e){let t=[],n=this.defineInputs();for(let r of n)if(r.required){let n=e[r.name];(n==null||n===``)&&t.push(`"${r.name}" æ˜¯å¿…å¡«é¡¹`)}return{valid:t.length===0,errors:t}}getMetadata(){return{type:this.type,label:this.label,description:this.description,category:this.category,inputs:this.defineInputs(),outputs:this.defineOutputs(),style:this.getStyleConfig()}}shouldUseCache(e,t){return!0}getCacheableInputs(e){return e}computeConfigHash(e,t={}){let n=this.getCacheableInputs(e),r={type:this.type,inputs:n};return this.hashObject(r)}hashObject(e){let t=this.stableStringify(e),n=5381;for(let e=0;e<t.length;e++)n=n*33^t.charCodeAt(e);return(n>>>0).toString(16)}stableStringify(e){return e==null?String(e):typeof e==`object`?Array.isArray(e)?`[`+e.map(e=>this.stableStringify(e)).join(`,`)+`]`:`{`+Object.keys(e).sort().map(t=>JSON.stringify(t)+`:`+this.stableStringify(e[t])).join(`,`)+`}`:JSON.stringify(e)}isPlainObject(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}},At=class{extractOutputs(e){let t=e.data;if(!t)return null;if(t.executionResult)return typeof t.executionResult==`object`&&!Array.isArray(t.executionResult)?t.executionResult:{default:t.executionResult};if(t.result?.data?.outputs){let e=t.result.data.outputs,n={};return Object.entries(e).forEach(([e,t])=>{t&&typeof t==`object`&&`value`in t?n[e]=t.value:n[e]=t}),n}return t.result?.data?.raw===void 0?null:{default:t.result.data.raw}}};function jt(e,t,n){let r=new Set,i=[],a=new Map(n.map(e=>[e.id,e])),o=e=>{let n=t.filter(t=>t.target===e);for(let e of n){if(!e.source||r.has(e.source))continue;let t=a.get(e.source);if(!t)continue;let n=t.data?.config?.forNodeId;if(n){if(!a.get(n))continue;r.add(n),i.push(n),o(n);continue}r.add(e.source),i.push(e.source),o(e.source)}};return o(e),i}function Mt(e,t,n){return e==null?[]:Array.isArray(e)?e.map((e,r)=>{let i=`${t}[${r}]`;n.set(i,e);let a=e!=null&&(Array.isArray(e)||typeof e==`object`);return{id:i,label:`[${r}]`,valueType:Pt(e),reference:Ft(i),value:e,children:a?Mt(e,i,n):[]}}):typeof e==`object`?Object.entries(e).filter(([e])=>e!==`type`).map(([e,r])=>{let i=`${t}.${e}`;n.set(i,r);let a=r!=null&&(Array.isArray(r)||typeof r==`object`);return{id:i,label:e,valueType:Pt(r),reference:Ft(i),value:r,children:a?Mt(r,i,n):[]}}):[]}function Nt(e,t,n,r){if(t==null)return[];let i=n&&e?`${n}.${e}`:n||e;if(Array.isArray(t))return t.map((e,t)=>{let n=`${i}[${t}]`;r.set(n,e);let a=e!=null&&(Array.isArray(e)||typeof e==`object`);return{id:n,label:`[${t}]`,valueType:Pt(e),reference:Ft(n),value:e,children:a?Mt(e,n,r):[]}});if(typeof t==`object`){let a=Object.entries(t).filter(([e])=>e!==`type`),o=(e,t)=>e.map(([e,n])=>{let i=`${t}.${e}`;r.set(i,n);let a=n!=null&&(Array.isArray(n)||typeof n==`object`);return{id:i,label:e,valueType:Pt(n),reference:Ft(i),value:n,children:a?Mt(n,i,r):[]}});if(!e)return o(a,i);r.set(i,t);let s=o(a,i);return[{id:i,label:e,valueType:`object`,reference:Ft(i),value:t,children:s,nodeId:n,outputId:e}]}return r.set(i,t),[{id:i,label:e,valueType:Pt(t),reference:Ft(i),value:t,children:[],nodeId:n,outputId:e}]}function Pt(e){return e===null?`null`:e===void 0?`undefined`:Array.isArray(e)?`array`:typeof e}function Ft(e){return`{{ ${e} }}`}function It(e,t,n,r,i,a){let o=new Map(t.map(e=>[e.id,e])),s=new Map,c=[],l=o.get(e),u=l?.parentNode||l?.data?.parentNode,d=jt(e,n,t).reverse(),f=null;if(u){let e=o.get(u);if(e?.type===`forLoopContainer`&&(f=e.data?.config?.forNodeId,!f)){for(let e of t)if(e.type===`for`&&e.data?.config?.containerId===u){f=e.id;break}}}let p=r||new At;if(i&&Object.keys(i).length>0){let e=`å…¨å±€å˜é‡`,t={id:`global-variables`,label:`å…¨å±€å˜é‡`,valueType:`object`,reference:e,value:{},children:[]};Object.entries(i).forEach(([n,r])=>{s.set(`${e}.${n}`,r);let i=Nt(n,r,e,s);t.children?.push(...i)}),c.push(t)}return d.forEach(e=>{let t=o.get(e);if(!t)return;let n=t.label||t.data?.label||e,r=t.type,i=p.extractOutputs(t);if(r===`for`){let r=t.data?.config||{},i=r.containerId;if(u&&i&&u===i&&f===e){let i={id:e,label:n,valueType:`node`,value:null,children:[],nodeId:e},o=r.itemName||`item`,l=r.indexName||`index`,u,d,f=[],p=!1,m=t.data?.params?.items;if(m!=null){let e=Vt(m,s);Array.isArray(e)&&(f=e)}a?(u=a[o],d=a[l],p=!0):(u=f.length>0?f[0]:null,d=0);let h=Nt(o,u,n,s);!p&&h[0]&&(h[0].label=h[0].label+` [ç¤ºä¾‹]`),h[0]&&i.children?.push(h[0]);let g=Nt(l,d,n,s);!p&&g[0]&&(g[0].label=g[0].label+` [ç¤ºä¾‹]`),g[0]&&i.children?.push(g[0]);let _=`${n}.list`;s.set(_,f);let v={id:_,label:`list`,valueType:`array`,reference:Ft(_),value:f,children:f.length>0?Mt(f,_,s):[],nodeId:e,outputId:`list`};i.children?.push(v),c.push(i);return}}if(!i||Object.keys(i).length===0)return;let l={id:e,label:n,valueType:`node`,value:null,children:[],nodeId:e};Object.entries(i).forEach(([e,t])=>{if(t===void 0)return;let r=t;if(r&&typeof r==`object`&&!Array.isArray(r)&&`data`in r){let e=r.data,t=r.isError;e&&typeof e==`object`&&(r={...e,...t===void 0?{}:{isError:t}})}let a=Object.keys(i);a.length===1&&a[0]===`default`?s.set(n,r):(s.set(n,r),s.set(`${n}.${e}`,r));let o=Nt(e,r,n,s);l.children?.push(...o)}),c.push(l)}),{tree:c.reverse(),map:s}}function Lt(e,t){let n=JSON.parse(JSON.stringify(e));return Rt(n,t)}function Rt(e,t){if(typeof e==`string`)return Vt(e,t);if(Array.isArray(e))return e.map(e=>Rt(e,t));if(e&&typeof e==`object`){let n={};return Object.entries(e).forEach(([e,r])=>{n[e]=Rt(r,t)}),n}return e}const zt=/\{\{\s*\$?([^{}]+?)\s*\}\}/g;function Bt(e){return zt.test(e)}function Vt(e,t){let n=[...e.matchAll(zt)];if(n.length===0)return e;let r=n[0];if(!r)return e;if(n.length===1&&e.trim()===r[0]){let n=r[1];if(!n)return e;let i=n.trim(),a=t.get(i);return a===void 0?e:a}let i=e;return n.forEach(([e,n])=>{if(!n)return;let r=n.trim();if(!t.has(r))return;let a=t.get(r),o=typeof a==`string`?a:JSON.stringify(a,null,2);i=i.replace(e,o)}),i}var Ht=l({DATA_TYPE_LABELS:()=>Wt,IfNode:()=>Kt,OPERATORS_BY_TYPE:()=>Gt,OPERATOR_LABELS:()=>Ut});const Ut={"is equal to":`ç­‰äº`,"is not equal to":`ä¸ç­‰äº`,exists:`å­˜åœ¨`,"does not exist":`ä¸å­˜åœ¨`,"is empty":`ä¸ºç©º`,"is not empty":`ä¸ä¸ºç©º`,contains:`åŒ…å«`,"does not contain":`ä¸åŒ…å«`,"starts with":`å¼€å¤´ä¸º`,"ends with":`ç»“å°¾ä¸º`,"is greater than":`å¤§äº`,"is less than":`å°äº`,"is greater than or equal to":`å¤§äºç­‰äº`,"is less than or equal to":`å°äºç­‰äº`,"is true":`ä¸ºçœŸ`,"is false":`ä¸ºå‡`,"is before":`æ—©äº`,"is after":`æ™šäº`,"is before or equal to":`æ—©äºæˆ–ç­‰äº`,"is after or equal to":`æ™šäºæˆ–ç­‰äº`,"length equal to":`é•¿åº¦ç­‰äº`,"length not equal to":`é•¿åº¦ä¸ç­‰äº`,"length greater than":`é•¿åº¦å¤§äº`,"length less than":`é•¿åº¦å°äº`,"length greater than or equal to":`é•¿åº¦å¤§äºç­‰äº`,"length less than or equal to":`é•¿åº¦å°äºç­‰äº`},Wt={string:`å­—ç¬¦ä¸²`,number:`æ•°å­—`,date:`æ—¥æœŸ`,boolean:`å¸ƒå°”å€¼`,array:`æ•°ç»„`,object:`å¯¹è±¡`},Gt={string:[`is equal to`,`is not equal to`,`contains`,`does not contain`,`starts with`,`ends with`,`exists`,`does not exist`,`is empty`,`is not empty`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],number:[`is equal to`,`is not equal to`,`is greater than`,`is less than`,`is greater than or equal to`,`is less than or equal to`,`exists`,`does not exist`],date:[`is equal to`,`is not equal to`,`is before`,`is after`,`is before or equal to`,`is after or equal to`,`exists`,`does not exist`],boolean:[`is equal to`,`is not equal to`,`is true`,`is false`,`exists`,`does not exist`],array:[`exists`,`does not exist`,`is empty`,`is not empty`,`contains`,`does not contain`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],object:[`exists`,`does not exist`,`is empty`,`is not empty`]};var Kt=class extends kt{constructor(...e){super(...e),this.type=`if`,this.label=`æ¡ä»¶åˆ¤æ–­`,this.description=`æ ¹æ®æ¡ä»¶åˆ¤æ–­æ‰§è¡Œä¸åŒçš„åˆ†æ”¯`,this.category=`æµç¨‹æ§åˆ¶`,this.currentConfig=null}defineInputs(){return[{name:`config`,type:`object`,description:`æ¡ä»¶é…ç½®`,defaultValue:this.getDefaultConfig(),required:!1}]}defineOutputs(){return this.currentConfig?this.getOutputsForConfig(this.currentConfig):this.getOutputsForConfig(this.getDefaultConfig())}getOutputsForConfig(e){let t=e.conditions||[],n=Math.max(t.length,1),r=[];for(let e=0;e<n;e++){let n=t[e];r.push({name:this.getConditionOutputId(e),type:`any`,description:n?this.describeCondition(n):`æœªé…ç½®æ¡ä»¶`})}return r.push({name:`else`,type:`any`,description:`æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³æ—¶æ‰§è¡Œ`}),r}updateConfig(e){this.currentConfig=e}getDefaultConfig(){return{conditions:[{logic:`and`,subConditions:[{field:``,dataType:`string`,operator:`is equal to`,value:``}]}]}}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`question`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`config`,this.getDefaultConfig());this.updateConfig(t);let n=Array.isArray(t.conditions)?t.conditions:[];console.log(`[IfNode] å¼€å§‹è¯„ä¼°æ¡ä»¶ï¼Œæ¡ä»¶æ•°é‡:`,n.length),console.log(`[IfNode] åŸå§‹æ¡ä»¶é…ç½®:`,JSON.stringify(n,null,2));let r=n.map((e,t)=>{console.log(`\n[IfNode] è¯„ä¼°æ¡ä»¶ ${t+1}:`,{logic:e.logic,subConditionsCount:e.subConditions.length});let n=e.subConditions.map((e,t)=>{console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - åŸå§‹å€¼:`,{field:e.field,value:e.value,operator:e.operator,dataType:e.dataType});let n=this.resolveOperandValue(e.field,e.dataType),r=this.resolveOperandValue(e.value,e.dataType);if(console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - è§£æåçš„å€¼:`,{actualValue:n,targetValue:r,actualType:typeof n,targetType:typeof r}),this.isEmptyCondition(e.field,e.value,e.operator))return console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - æœªé…ç½®ï¼ˆå·¦å³å€¼éƒ½ä¸ºç©ºï¼‰ï¼Œè¿”å› false`),{...e,actualValue:n,targetValue:r,result:!1};let i=this.compareValues(n,r,e.operator,e.dataType);return console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - æ¯”è¾ƒç»“æœ:`,i),{...e,actualValue:n,targetValue:r,result:i}}),r=e.logic===`or`?n.some(e=>e.result):n.every(e=>e.result);return console.log(`[IfNode] æ¡ä»¶ ${t+1} æœ€ç»ˆç»“æœ:`,{logic:e.logic,subResults:n.map(e=>e.result),conditionResult:r}),{index:t,outputId:this.getConditionOutputId(t),logic:e.logic,subResults:n,result:r}}),i=r.findIndex(e=>e.result),a=i!==-1;console.log(`
[IfNode] æ¡ä»¶è¯„ä¼°æ±‡æ€»:`,{totalConditions:r.length,firstPassedIndex:i,anyPassed:a,allResults:r.map((e,t)=>({index:t,outputId:e.outputId,result:e.result}))});let o={};r.forEach((e,t)=>{o[e.outputId]=t===i?{branch:e.outputId,passed:!0,evaluation:e,allEvaluations:r}:void 0}),o.else=a?void 0:{branch:`else`,passed:!1,allEvaluations:r};let s=i===-1?null:r[i];return console.log(`[IfNode] æœ€ç»ˆè¾“å‡ºç«¯å£:`,{selectedBranch:s?s.outputId:`else`,outputKeys:Object.keys(o),outputsWithData:Object.entries(o).filter(([e,t])=>t!==void 0).map(([e])=>e)}),this.createOutput(o,{branch:s?s.outputId:`else`,passed:a,evaluations:r},s?`æ¡ä»¶${i+1}æ»¡è¶³`:`æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæ‰§è¡Œ else`)}catch(e){return this.createError(e)}}getConditionOutputId(e){return`condition-${e}`}describeCondition(e){let{logic:t,subConditions:n}=e;if(!n||n.length===0)return`æœªé…ç½®å­æ¡ä»¶`;if(n.length===1)return this.describeSubCondition(n[0]);let r=t===`and`?` ä¸” `:` æˆ– `,i=n.map(e=>this.describeSubCondition(e)).join(r);return i.length>60?i.slice(0,57)+`...`:i}describeSubCondition(e){if(!e)return`æœªé…ç½®`;let t=this.formatOperand(e.field,`è¾“å…¥å€¼`),n=Ut[e.operator]||e.operator;if([`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(e.operator))return`${t} ${n}`;let r=this.truncateValue(e.value,20,`''`);return`${t} ${n} ${r}`}truncateValue(e,t=48,n=``){let r=this.formatOperand(e,n);return r?r.length<=t?r:`${r.slice(0,t-1)}â€¦`:n}formatOperand(e,t=``){if(e==null)return t;if(typeof e==`string`){let n=e.trim();return n.length>0?n:t}if(typeof e==`number`||typeof e==`boolean`)return String(e);if(e instanceof Date)return e.toISOString();try{return JSON.stringify(e)}catch{return String(e)}}isEmptyCondition(e,t,n){return[`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(n)?this.isOperandEmpty(e):this.isOperandEmpty(e)&&this.isOperandEmpty(t)}isOperandEmpty(e){return e==null?!0:typeof e==`string`?e.trim()===``:!1}resolveOperandValue(e,t){return e==null?e:this.coerceValueByType(e,t)}coerceValueByType(e,t){if(e==null)return e;switch(t){case`number`:{if(typeof e==`number`)return e;if(typeof e==`boolean`)return e?1:0;if(typeof e==`string`){let t=Number(e);return Number.isNaN(t)?e:t}let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`number`)return e!==0;if(typeof e==`string`){let t=e.toLowerCase();if([`true`,`1`,`yes`].includes(t))return!0;if([`false`,`0`,`no`].includes(t))return!1}return!!e;case`date`:if(e instanceof Date)return e;if(typeof e==`number`)return new Date(e);if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?e:t}return e;case`array`:if(Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return[];try{let n=JSON.parse(t);return Array.isArray(n)?n:e}catch{return e}}return e;case`object`:if(e&&typeof e==`object`&&!Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return{};try{let n=JSON.parse(t);return n&&typeof n==`object`?n:e}catch{return e}}return e;default:return typeof e==`string`?e:String(e)}}compareValues(e,t,n,r){console.log(`    [IfNode.compareValues] æ¯”è¾ƒå‚æ•°:`,{actual:e,target:t,operator:n,dataType:r,actualType:typeof e,targetType:typeof t});let i;switch(n){case`is equal to`:return i=this.compareEquality(e,t,r),console.log(`    [IfNode.compareValues] is equal to ç»“æœ:`,i),i;case`is not equal to`:return!this.compareEquality(e,t,r);case`exists`:return e!=null;case`does not exist`:return e==null;case`is empty`:return e==null?!0:typeof e==`string`?e.trim().length===0:Array.isArray(e)?e.length===0:typeof e==`object`?Object.keys(e).length===0:!1;case`is not empty`:return e==null?!1:typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:typeof e==`object`?Object.keys(e).length>0:!0;case`contains`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?e.includes(t):!1;case`does not contain`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?!e.includes(t):!0;case`starts with`:return typeof e==`string`&&typeof t==`string`?e.startsWith(t):!1;case`ends with`:return typeof e==`string`&&typeof t==`string`?e.endsWith(t):!1;case`is greater than`:return Number(e)>Number(t);case`is less than`:return Number(e)<Number(t);case`is greater than or equal to`:return Number(e)>=Number(t);case`is less than or equal to`:return Number(e)<=Number(t);case`is true`:return e===!0;case`is false`:return e===!1;case`is before`:return new Date(e)<new Date(t);case`is after`:return new Date(e)>new Date(t);case`is before or equal to`:return new Date(e)<=new Date(t);case`is after or equal to`:return new Date(e)>=new Date(t);case`length equal to`:return this.getLength(e)===Number(t);case`length not equal to`:return this.getLength(e)!==Number(t);case`length greater than`:return this.getLength(e)>Number(t);case`length less than`:return this.getLength(e)<Number(t);case`length greater than or equal to`:return this.getLength(e)>=Number(t);case`length less than or equal to`:return this.getLength(e)<=Number(t);default:return!1}}getLength(e){return typeof e==`string`||Array.isArray(e)?e.length:typeof e==`object`&&e?Object.keys(e).length:0}compareEquality(e,t,n){let r=this.normalizeEqualityValue(e,n),i=this.normalizeEqualityValue(t,n);return n===`array`||n===`object`?he(r,i):r===i}normalizeEqualityValue(e,t){if(e==null)return e;switch(t){case`number`:{let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`string`){let t=e.trim().toLowerCase();if(t===`true`||t===`1`)return!0;if(t===`false`||t===`0`)return!1}return typeof e==`number`?e===1:!!e;case`date`:{let t=e instanceof Date?e.getTime():new Date(e).getTime();return Number.isNaN(t)?e:t}case`string`:return String(e);default:return e}}},qt=l({CodeNode:()=>Xt}),Jt=`export async function main(params) {
  return {
    receivedKeys: Object.keys(params),
    example: params,
  };
}`,Yt=/^[A-Za-z][A-Za-z0-9_]*$/,Xt=class extends kt{constructor(...e){super(...e),this.type=`code`,this.label=`ä»£ç æ‰§è¡Œ`,this.description=`æ‰§è¡Œè‡ªå®šä¹‰ TypeScript/JavaScript ä»£ç `,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`dataItems`,type:`array`,description:`å‚æ•°å¯¹è±¡ï¼ˆå¦‚æä¾›åˆ™è¦†ç›–ç”± dataItems æ„å»ºçš„å‚æ•°ï¼‰`,required:!1},{name:`code`,type:`string`,description:`åŠ¨æ€ä»£ç ï¼ˆå¦‚æä¾›åˆ™è¦†ç›–é…ç½®ä¸­çš„ codeï¼‰`,required:!1}]}defineOutputs(){return[{name:`result`,type:`any`,description:`æ‰§è¡Œç»“æœ`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`code`,showIcon:!0}}getDefaultConfig(){return{code:Jt,dataItems:[]}}shouldUseCache(e,t){return!1}async execute(e,t){try{let t=this.getDefaultConfig(),n=this.getInput(e,`code`,``),r=typeof n==`string`&&n.trim()?n:void 0,i=this.getInput(e,`dataItems`,null),a=Array.isArray(i),o=i&&typeof i==`object`&&!a?i:void 0,s=r??t.code,c=o??this.buildParams(a?i:t.dataItems),l=this.prepareRuntime(s);try{let e=Function(`params`,l)(c),t=e instanceof Promise?await e:e,n={result:t};return this.createOutput(n,t,this.buildSummary(t,Object.keys(c)))}catch(e){throw Error(`ä»£ç æ‰§è¡Œé”™è¯¯: ${e?.message??e}`)}}catch(e){return this.createError(e)}}buildParams(e){let t={},n=new Set;return e.forEach((e,r)=>{let i=(e?.key??``).trim();if(!i){console.error(`ç¬¬ ${r+1} é¡¹çš„é”®åä¸èƒ½ä¸ºç©º`);return}if(!Yt.test(i)){console.error(`ç¬¬ ${r+1} é¡¹çš„é”®å "${i}" æ— æ•ˆï¼šä»…æ”¯æŒä»¥å­—æ¯å¼€å¤´ï¼Œç”±å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ç»„æˆ`);return}if(n.has(i)){console.error(`æ£€æµ‹åˆ°é‡å¤çš„é”®å "${i}"ï¼Œè¯·ç¡®ä¿å”¯ä¸€`);return}n.add(i),t[i]=e?.value}),t}prepareRuntime(e){return`"use strict";
${this.normalizeExports(e)}

if (typeof main !== "function") {
  throw new Error("main å‡½æ•°æœªå®šä¹‰ï¼Œè¯·ç¡®ä¿å¯¼å‡º export function main(params) {}");
}

const result = main(params);
return result;`}normalizeExports(e){let t=e;return[[/export\s+default\s+async\s+function\s+main/g,`async function main`],[/export\s+default\s+function\s+main/g,`function main`],[/export\s+async\s+function\s+main/g,`async function main`],[/export\s+function\s+main/g,`function main`],[/export\s+default\s+main\s*;?/g,``],[/export\s+{\s*main\s+as\s+default\s*};?/g,``],[/export\s+const\s+main\s*=\s*/g,`const main = `],[/export\s+let\s+main\s*=\s*/g,`let main = `],[/export\s+var\s+main\s*=\s*/g,`var main = `]].forEach(([e,n])=>{t=t.replace(e,n)}),t}buildSummary(e,t){let n=t.length>0?t.join(`, `):`æ— `,r=this.formatValue(e);return`main(params) æ‰§è¡Œå®Œæˆ | å‚æ•°é”®: [${n}] | ç»“æœ: ${r}`}formatValue(e){if(e===null)return`null`;if(e===void 0)return`undefined`;if(typeof e==`string`)return e.length>40?`"${e.slice(0,37)}..."`:`"${e}"`;if(typeof e==`number`||typeof e==`boolean`)return String(e);if(Array.isArray(e))return`Array(${e.length})`;if(typeof e==`object`){let t=Object.keys(e);if(t.length===0)return`{}`;let n=t.slice(0,3).join(`, `),r=t.length>3?`, ...`:``;return`{ ${n}${r} }`}return String(e)}},Zt=l({ConnectorNode:()=>Qt}),Qt=class extends kt{constructor(...e){super(...e),this.type=`connector`,this.label=`è¿æ¥`,this.description=`ç”¨äºä¼˜åŒ–è¿æ¥çº¿å¸ƒå±€ï¼Œæ‰§è¡Œæ—¶è¿”å› undefined`,this.category=`å·¥å…·`}defineInputs(){return[]}defineOutputs(){return[{name:`output`,type:`any`,description:`è¾“å‡ºæ•°æ®ï¼ˆundefinedï¼‰`}]}getStyleConfig(){return{}}async execute(e,t){return this.createOutput({output:void 0},void 0,`è¿æ¥èŠ‚ç‚¹ï¼šå·²è¿”å› undefined`)}},$t=l({DataPreviewNode:()=>en}),en=class extends kt{constructor(...e){super(...e),this.type=`dataPreview`,this.label=`æ•°æ®é¢„è§ˆ`,this.description=`é¢„è§ˆä»»æ„æ•°æ®ï¼Œæ”¯æŒæŸ¥çœ‹å„ç§æ•°æ®ç±»å‹çš„è¾“å‡ºç»“æœ`,this.category=`å·¥å…·`}defineInputs(){return[{name:`data`,type:`any`,description:`è¦é¢„è§ˆçš„æ•°æ®`,required:!1}]}defineOutputs(){return[{name:`data`,type:`any`,description:`è¾“å‡ºçš„æ•°æ®ï¼ˆä¸è¾“å…¥ç›¸åŒï¼‰`}]}getStyleConfig(){return{headerColor:[`#06b6d4`,`#0891b2`],icon:`eye`,showIcon:!0,bodyStyle:{minWidth:`300px`,minHeight:`200px`}}}async execute(e,t){try{let t=this.getInput(e,`data`,void 0);if(t!=null){let e=Array.isArray(t)?`æ•°ç»„`:typeof t;typeof t==`string`&&t.length>0||Array.isArray(t)?`${t.length}`:typeof t==`object`?`${Object.keys(t).length}`:`${e}${String(t)}`}return this.createOutput({data:t})}catch(e){return this.createError(e)}}},tn=l({DelayNode:()=>nn}),nn=class extends kt{constructor(...e){super(...e),this.type=`delay`,this.label=`å»¶è¿Ÿ`,this.description=`æš‚åœå·¥ä½œæµæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{name:`delay`,type:`number`,description:`å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰`,required:!0,defaultValue:1e3}]}defineOutputs(){return[{name:`output`,type:`any`,description:`å»¶è¿Ÿåè¾“å‡ºçš„æ•°æ®`}]}getStyleConfig(){return{headerColor:[`#f59e0b`,`#d97706`],icon:`clock`,showIcon:!0}}shouldUseCache(e,t){return!1}async execute(e,t){try{let n=this.getInput(e,`delay`,1e3);return console.log(`DelayNode execute`,n),typeof n!=`number`||n<0?this.createError(`å»¶è¿Ÿæ—¶é—´å¿…é¡»æ˜¯éè´Ÿæ•°`):n===0?this.createOutput({output:void 0}):(await this.sleep(n,t.signal),this.createOutput({output:void 0},void 0,`å»¶è¿Ÿ ${n}ms å®Œæˆ`))}catch(e){return e instanceof Error&&e.name===`AbortError`?this.createError(`å»¶è¿Ÿè¢«å–æ¶ˆ`):this.createError(e)}}sleep(e,t){return new Promise((n,r)=>{if(t?.aborted){let e=Error(`å»¶è¿Ÿè¢«å–æ¶ˆ`);e.name=`AbortError`,r(e);return}let i=setTimeout(()=>{o(),n()},e),a=()=>{o();let e=Error(`å»¶è¿Ÿè¢«å–æ¶ˆ`);e.name=`AbortError`,r(e)},o=()=>{clearTimeout(i),t?.removeEventListener(`abort`,a)};t?.addEventListener(`abort`,a)})}},rn=l({EndNode:()=>an}),an=class extends kt{constructor(...e){super(...e),this.type=`end`,this.label=`ç»“æŸ`,this.description=`å·¥ä½œæµç¨‹çš„ç»“æŸèŠ‚ç‚¹`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{name:`input`,type:`any`,description:`æ¥æ”¶ä»»æ„è¾“å…¥`,required:!1}]}defineOutputs(){return[]}getStyleConfig(){return{headerColor:[`#ef4444`,`#dc2626`],icon:`stop`,showIcon:!0}}async execute(e,t){let n=this.getInput(e,`input`,null);return{success:!0,summary:`å·¥ä½œæµç»“æŸ`,outputs:{},raw:{completed:!0,timestamp:Date.now(),finalInput:n}}}},on=l({ForNode:()=>sn}),sn=class extends kt{constructor(...e){super(...e),this.type=`for`,this.label=`æ‰¹å¤„ç†`,this.description=`éå†é›†åˆå¹¶è¿è¡Œå¾ªç¯ä½“`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{name:`items`,type:`array`,description:`è¾“å…¥é›†åˆ`,required:!1}]}defineOutputs(){return[{name:`loop`,type:`any`,description:`å¾ªç¯ä½“`},{name:`next`,type:`any`,description:`å¾ªç¯ç»“æŸ`}]}getStyleConfig(){return{headerColor:[`#f97316`,`#ea580c`],icon:`repeat`,showIcon:!0}}async execute(e,t){try{let n=this.getInput(e,`items`,[]);if(!Array.isArray(n))throw Error(`å¾ªç¯æºæ•°æ®å¿…é¡»æ˜¯æ•°ç»„`);let r=t.nodeData||{},i={...this.getDefaultConfig(),...r.config||{}};if(!i.containerId)throw Error(`For èŠ‚ç‚¹æœªé…ç½®å¾ªç¯ä½“å®¹å™¨`);if(!t.executeContainer)throw Error(`æ‰§è¡Œä¸Šä¸‹æ–‡ç¼ºå°‘ executeContainer æ–¹æ³•`);let a=n.map((e,t)=>({[i.itemName]:e,[i.indexName]:t,list:n}));if(a.length===0)return this.createOutput({next:{totalCount:0,executedCount:0,successCount:0,errorCount:0,results:[],summary:`æ— è¿­ä»£æ•°æ®`}},{count:0},`æ— è¿­ä»£æ•°æ®`);let o=i.pagination,s=o?.enabled??!1,c=o?.pageSize??10,l=o?.currentPage??1,u=a,d=0,f=a.length;s&&c>0?(d=(l-1)*c,f=Math.min(d+c,a.length),u=a.slice(d,f),console.log(`[ForNode] å¯ç”¨åˆ†é¡µï¼šç¬¬ ${l} é¡µï¼Œæ¯é¡µ ${c} æ¡ï¼Œæ‰§è¡Œ ${u.length} æ¬¡è¿­ä»£ï¼ˆæ€»å…± ${a.length} æ¬¡ï¼‰`)):console.log(`[ForNode] å¼€å§‹æ‰§è¡Œå¾ªç¯ï¼Œå…± ${a.length} æ¬¡è¿­ä»£`);let p=[];for(let e=0;e<u.length;e++){let n=d+e,r=u[e]||{};console.log(`[ForNode] æ‰§è¡Œç¬¬ ${n+1}/${a.length} æ¬¡è¿­ä»£`,r);try{let e=await t.executeContainer(i.containerId,r);p.push({index:n,variables:r,result:e,status:`success`})}catch(e){let t=e instanceof Error?e.message:String(e);if(console.error(`[ForNode] ç¬¬ ${n+1} æ¬¡è¿­ä»£å¤±è´¥:`,t),p.push({index:n,variables:r,error:t,status:`error`}),!i.errorHandling?.continueOnError)throw e}}let m=a.length,h=u.length,g=p.filter(e=>e.status===`success`).length,_=p.filter(e=>e.status===`error`).length,v={next:{totalCount:m,executedCount:h,successCount:g,errorCount:_,results:p,pagination:s?{enabled:!0,currentPage:l,pageSize:c,totalPages:Math.ceil(m/c),startIndex:d,endIndex:f-1}:void 0,summary:s?`ç¬¬ ${l} é¡µï¼šæ‰§è¡Œ ${h} æ¬¡ï¼ŒæˆåŠŸ ${g} æ¬¡ï¼Œå¤±è´¥ ${_} æ¬¡`:`å¾ªç¯æ‰§è¡Œ ${h} æ¬¡ï¼ŒæˆåŠŸ ${g} æ¬¡ï¼Œå¤±è´¥ ${_} æ¬¡`}};return this.createOutput(v,{totalCount:m,executedCount:h,successCount:g,errorCount:_},v.next.summary)}catch(e){return this.createError(e)}}getDefaultConfig(){return{mode:`variable`,variable:``,range:{start:0,end:10,step:1},itemName:`item`,indexName:`index`,containerId:null,errorHandling:{continueOnError:!1}}}};function cn(e,t){return function(){return e.apply(t,arguments)}}var{toString:ln}=Object.prototype,{getPrototypeOf:un}=Object,{iterator:dn,toStringTag:fn}=Symbol,pn=(e=>t=>{let n=ln.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),mn=e=>(e=e.toLowerCase(),t=>pn(t)===e),hn=e=>t=>typeof t===e,{isArray:gn}=Array,_n=hn(`undefined`);function vn(e){return e!==null&&!_n(e)&&e.constructor!==null&&!_n(e.constructor)&&Sn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}var yn=mn(`ArrayBuffer`);function bn(e){let t;return t=typeof ArrayBuffer<`u`&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&yn(e.buffer),t}var xn=hn(`string`),Sn=hn(`function`),Cn=hn(`number`),wn=e=>typeof e==`object`&&!!e,Tn=e=>e===!0||e===!1,En=e=>{if(pn(e)!==`object`)return!1;let t=un(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(fn in e)&&!(dn in e)},Dn=e=>{if(!wn(e)||vn(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},On=mn(`Date`),kn=mn(`File`),An=mn(`Blob`),jn=mn(`FileList`),Mn=e=>wn(e)&&Sn(e.pipe),Nn=e=>{let t;return e&&(typeof FormData==`function`&&e instanceof FormData||Sn(e.append)&&((t=pn(e))===`formdata`||t===`object`&&Sn(e.toString)&&e.toString()===`[object FormData]`))},Pn=mn(`URLSearchParams`),[Fn,In,Ln,Rn]=[`ReadableStream`,`Request`,`Response`,`Headers`].map(mn),zn=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,``);function Bn(e,t,{allOwnKeys:n=!1}={}){if(e==null)return;let r,i;if(typeof e!=`object`&&(e=[e]),gn(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{if(vn(e))return;let i=n?Object.getOwnPropertyNames(e):Object.keys(e),a=i.length,o;for(r=0;r<a;r++)o=i[r],t.call(null,e[o],o,e)}}function Vn(e,t){if(vn(e))return null;t=t.toLowerCase();let n=Object.keys(e),r=n.length,i;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}var Hn=(()=>typeof globalThis<`u`?globalThis:typeof self<`u`?self:typeof window<`u`?window:global)(),Un=e=>!_n(e)&&e!==Hn;function Wn(){let{caseless:e,skipUndefined:t}=Un(this)&&this||{},n={},r=(r,i)=>{let a=e&&Vn(n,i)||i;En(n[a])&&En(r)?n[a]=Wn(n[a],r):En(r)?n[a]=Wn({},r):gn(r)?n[a]=r.slice():(!t||!_n(r))&&(n[a]=r)};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Bn(arguments[e],r);return n}var Gn=(e,t,n,{allOwnKeys:r}={})=>(Bn(t,(t,r)=>{n&&Sn(t)?e[r]=cn(t,n):e[r]=t},{allOwnKeys:r}),e),Kn=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),qn=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,`super`,{value:t.prototype}),n&&Object.assign(e.prototype,n)},Jn=(e,t,n,r)=>{let i,a,o,s={};if(t||={},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],(!r||r(o,e,t))&&!s[o]&&(t[o]=e[o],s[o]=!0);e=n!==!1&&un(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},Yn=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;let r=e.indexOf(t,n);return r!==-1&&r===n},Xn=e=>{if(!e)return null;if(gn(e))return e;let t=e.length;if(!Cn(t))return null;let n=Array(t);for(;t-- >0;)n[t]=e[t];return n},Zn=(e=>t=>e&&t instanceof e)(typeof Uint8Array<`u`&&un(Uint8Array)),Qn=(e,t)=>{let n=(e&&e[dn]).call(e),r;for(;(r=n.next())&&!r.done;){let n=r.value;t.call(e,n[0],n[1])}},$n=(e,t)=>{let n,r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},er=mn(`HTMLFormElement`),tr=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),nr=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),rr=mn(`RegExp`),ir=(e,t)=>{let n=Object.getOwnPropertyDescriptors(e),r={};Bn(n,(n,i)=>{let a;(a=t(n,i,e))!==!1&&(r[i]=a||n)}),Object.defineProperties(e,r)},ar=e=>{ir(e,(t,n)=>{if(Sn(e)&&[`arguments`,`caller`,`callee`].indexOf(n)!==-1)return!1;let r=e[n];if(Sn(r)){if(t.enumerable=!1,`writable`in t){t.writable=!1;return}t.set||=()=>{throw Error(`Can not rewrite read-only method '`+n+`'`)}}})},or=(e,t)=>{let n={},r=e=>{e.forEach(e=>{n[e]=!0})};return gn(e)?r(e):r(String(e).split(t)),n},sr=()=>{},cr=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function lr(e){return!!(e&&Sn(e.append)&&e[fn]===`FormData`&&e[dn])}var ur=e=>{let t=Array(10),n=(e,r)=>{if(wn(e)){if(t.indexOf(e)>=0)return;if(vn(e))return e;if(!(`toJSON`in e)){t[r]=e;let i=gn(e)?[]:{};return Bn(e,(e,t)=>{let a=n(e,r+1);!_n(a)&&(i[t]=a)}),t[r]=void 0,i}}return e};return n(e,0)},dr=mn(`AsyncFunction`),fr=e=>e&&(wn(e)||Sn(e))&&Sn(e.then)&&Sn(e.catch),pr=((e,t)=>e?setImmediate:t?((e,t)=>(Hn.addEventListener(`message`,({source:n,data:r})=>{n===Hn&&r===e&&t.length&&t.shift()()},!1),n=>{t.push(n),Hn.postMessage(e,`*`)}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate==`function`,Sn(Hn.postMessage)),mr=typeof queueMicrotask<`u`?queueMicrotask.bind(Hn):typeof process<`u`&&process.nextTick||pr,F={isArray:gn,isArrayBuffer:yn,isBuffer:vn,isFormData:Nn,isArrayBufferView:bn,isString:xn,isNumber:Cn,isBoolean:Tn,isObject:wn,isPlainObject:En,isEmptyObject:Dn,isReadableStream:Fn,isRequest:In,isResponse:Ln,isHeaders:Rn,isUndefined:_n,isDate:On,isFile:kn,isBlob:An,isRegExp:rr,isFunction:Sn,isStream:Mn,isURLSearchParams:Pn,isTypedArray:Zn,isFileList:jn,forEach:Bn,merge:Wn,extend:Gn,trim:zn,stripBOM:Kn,inherits:qn,toFlatObject:Jn,kindOf:pn,kindOfTest:mn,endsWith:Yn,toArray:Xn,forEachEntry:Qn,matchAll:$n,isHTMLForm:er,hasOwnProperty:nr,hasOwnProp:nr,reduceDescriptors:ir,freezeMethods:ar,toObjectSet:or,toCamelCase:tr,noop:sr,toFiniteNumber:cr,findKey:Vn,global:Hn,isContextDefined:Un,isSpecCompliantForm:lr,toJSONObject:ur,isAsyncFn:dr,isThenable:fr,setImmediate:pr,asap:mr,isIterable:e=>e!=null&&Sn(e[dn])};function hr(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=e,this.name=`AxiosError`,t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}F.inherits(hr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:F.toJSONObject(this.config),code:this.code,status:this.status}}});var gr=hr.prototype,_r={};[`ERR_BAD_OPTION_VALUE`,`ERR_BAD_OPTION`,`ECONNABORTED`,`ETIMEDOUT`,`ERR_NETWORK`,`ERR_FR_TOO_MANY_REDIRECTS`,`ERR_DEPRECATED`,`ERR_BAD_RESPONSE`,`ERR_BAD_REQUEST`,`ERR_CANCELED`,`ERR_NOT_SUPPORT`,`ERR_INVALID_URL`].forEach(e=>{_r[e]={value:e}}),Object.defineProperties(hr,_r),Object.defineProperty(gr,`isAxiosError`,{value:!0}),hr.from=(e,t,n,r,i,a)=>{let o=Object.create(gr);F.toFlatObject(e,o,function(e){return e!==Error.prototype},e=>e!==`isAxiosError`);let s=e&&e.message?e.message:`Error`,c=t==null&&e?e.code:t;return hr.call(o,s,c,n,r,i),e&&o.cause==null&&Object.defineProperty(o,`cause`,{value:e,configurable:!0}),o.name=e&&e.name||`Error`,a&&Object.assign(o,a),o};var I=hr;function vr(e){return F.isPlainObject(e)||F.isArray(e)}function yr(e){return F.endsWith(e,`[]`)?e.slice(0,-2):e}function br(e,t,n){return e?e.concat(t).map(function(e,t){return e=yr(e),!n&&t?`[`+e+`]`:e}).join(n?`.`:``):t}function xr(e){return F.isArray(e)&&!e.some(vr)}var Sr=F.toFlatObject(F,{},null,function(e){return/^is[A-Z]/.test(e)});function Cr(e,t,n){if(!F.isObject(e))throw TypeError(`target must be an object`);t||=new FormData,n=F.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!F.isUndefined(t[e])});let r=n.metaTokens,i=n.visitor||l,a=n.dots,o=n.indexes,s=(n.Blob||typeof Blob<`u`&&Blob)&&F.isSpecCompliantForm(t);if(!F.isFunction(i))throw TypeError(`visitor must be a function`);function c(e){if(e===null)return``;if(F.isDate(e))return e.toISOString();if(F.isBoolean(e))return e.toString();if(!s&&F.isBlob(e))throw new I(`Blob is not supported. Use a Buffer instead.`);return F.isArrayBuffer(e)||F.isTypedArray(e)?s&&typeof Blob==`function`?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let s=e;if(e&&!i&&typeof e==`object`){if(F.endsWith(n,`{}`))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(F.isArray(e)&&xr(e)||(F.isFileList(e)||F.endsWith(n,`[]`))&&(s=F.toArray(e)))return n=yr(n),s.forEach(function(e,r){!(F.isUndefined(e)||e===null)&&t.append(o===!0?br([n],r,a):o===null?n:n+`[]`,c(e))}),!1}return vr(e)?!0:(t.append(br(i,n,a),c(e)),!1)}let u=[],d=Object.assign(Sr,{defaultVisitor:l,convertValue:c,isVisitable:vr});function f(e,n){if(!F.isUndefined(e)){if(u.indexOf(e)!==-1)throw Error(`Circular reference detected in `+n.join(`.`));u.push(e),F.forEach(e,function(e,r){(!(F.isUndefined(e)||e===null)&&i.call(t,e,F.isString(r)?r.trim():r,n,d))===!0&&f(e,n?n.concat(r):[r])}),u.pop()}}if(!F.isObject(e))throw TypeError(`data must be an object`);return f(e),t}var wr=Cr;function Tr(e){let t={"!":`%21`,"'":`%27`,"(":`%28`,")":`%29`,"~":`%7E`,"%20":`+`,"%00":`\0`};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Er(e,t){this._pairs=[],e&&wr(e,this,t)}var Dr=Er.prototype;Dr.append=function(e,t){this._pairs.push([e,t])},Dr.toString=function(e){let t=e?function(t){return e.call(this,t,Tr)}:Tr;return this._pairs.map(function(e){return t(e[0])+`=`+t(e[1])},``).join(`&`)};var Or=Er;function kr(e){return encodeURIComponent(e).replace(/%3A/gi,`:`).replace(/%24/g,`$`).replace(/%2C/gi,`,`).replace(/%20/g,`+`)}function Ar(e,t,n){if(!t)return e;let r=n&&n.encode||kr;F.isFunction(n)&&(n={serialize:n});let i=n&&n.serialize,a;if(a=i?i(t,n):F.isURLSearchParams(t)?t.toString():new Or(t,n).toString(r),a){let t=e.indexOf(`#`);t!==-1&&(e=e.slice(0,t)),e+=(e.indexOf(`?`)===-1?`?`:`&`)+a}return e}var jr=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&=[]}forEach(e){F.forEach(this.handlers,function(t){t!==null&&e(t)})}},Mr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Nr={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<`u`?URLSearchParams:Or,FormData:typeof FormData<`u`?FormData:null,Blob:typeof Blob<`u`?Blob:null},protocols:[`http`,`https`,`file`,`blob`,`url`,`data`]},Pr=l({hasBrowserEnv:()=>Fr,hasStandardBrowserEnv:()=>Lr,hasStandardBrowserWebWorkerEnv:()=>Rr,navigator:()=>Ir,origin:()=>zr}),Fr=typeof window<`u`&&typeof document<`u`,Ir=typeof navigator==`object`&&navigator||void 0,Lr=Fr&&(!Ir||[`ReactNative`,`NativeScript`,`NS`].indexOf(Ir.product)<0),Rr=(()=>typeof WorkerGlobalScope<`u`&&self instanceof WorkerGlobalScope&&typeof self.importScripts==`function`)(),zr=Fr&&window.location.href||`http://localhost`,Br={...Pr,...Nr};function Vr(e,t){return wr(e,new Br.classes.URLSearchParams,{visitor:function(e,t,n,r){return Br.isNode&&F.isBuffer(e)?(this.append(t,e.toString(`base64`)),!1):r.defaultVisitor.apply(this,arguments)},...t})}function Hr(e){return F.matchAll(/\w+|\[(\w*)]/g,e).map(e=>e[0]===`[]`?``:e[1]||e[0])}function Ur(e){let t={},n=Object.keys(e),r,i=n.length,a;for(r=0;r<i;r++)a=n[r],t[a]=e[a];return t}function Wr(e){function t(e,n,r,i){let a=e[i++];if(a===`__proto__`)return!0;let o=Number.isFinite(+a),s=i>=e.length;return a=!a&&F.isArray(r)?r.length:a,s?(F.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!o):((!r[a]||!F.isObject(r[a]))&&(r[a]=[]),t(e,n,r[a],i)&&F.isArray(r[a])&&(r[a]=Ur(r[a])),!o)}if(F.isFormData(e)&&F.isFunction(e.entries)){let n={};return F.forEachEntry(e,(e,r)=>{t(Hr(e),r,n,0)}),n}return null}var Gr=Wr;function Kr(e,t,n){if(F.isString(e))try{return(t||JSON.parse)(e),F.trim(e)}catch(e){if(e.name!==`SyntaxError`)throw e}return(n||JSON.stringify)(e)}var qr={transitional:Mr,adapter:[`xhr`,`http`,`fetch`],transformRequest:[function(e,t){let n=t.getContentType()||``,r=n.indexOf(`application/json`)>-1,i=F.isObject(e);if(i&&F.isHTMLForm(e)&&(e=new FormData(e)),F.isFormData(e))return r?JSON.stringify(Gr(e)):e;if(F.isArrayBuffer(e)||F.isBuffer(e)||F.isStream(e)||F.isFile(e)||F.isBlob(e)||F.isReadableStream(e))return e;if(F.isArrayBufferView(e))return e.buffer;if(F.isURLSearchParams(e))return t.setContentType(`application/x-www-form-urlencoded;charset=utf-8`,!1),e.toString();let a;if(i){if(n.indexOf(`application/x-www-form-urlencoded`)>-1)return Vr(e,this.formSerializer).toString();if((a=F.isFileList(e))||n.indexOf(`multipart/form-data`)>-1){let t=this.env&&this.env.FormData;return wr(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType(`application/json`,!1),Kr(e)):e}],transformResponse:[function(e){let t=this.transitional||qr.transitional,n=t&&t.forcedJSONParsing,r=this.responseType===`json`;if(F.isResponse(e)||F.isReadableStream(e))return e;if(e&&F.isString(e)&&(n&&!this.responseType||r)){let n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(e){if(n)throw e.name===`SyntaxError`?I.from(e,I.ERR_BAD_RESPONSE,this,null,this.response):e}}return e}],timeout:0,xsrfCookieName:`XSRF-TOKEN`,xsrfHeaderName:`X-XSRF-TOKEN`,maxContentLength:-1,maxBodyLength:-1,env:{FormData:Br.classes.FormData,Blob:Br.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:`application/json, text/plain, */*`,"Content-Type":void 0}}};F.forEach([`delete`,`get`,`head`,`post`,`put`,`patch`],e=>{qr.headers[e]={}});var Jr=qr,Yr=F.toObjectSet([`age`,`authorization`,`content-length`,`content-type`,`etag`,`expires`,`from`,`host`,`if-modified-since`,`if-unmodified-since`,`last-modified`,`location`,`max-forwards`,`proxy-authorization`,`referer`,`retry-after`,`user-agent`]),Xr=e=>{let t={},n,r,i;return e&&e.split(`
`).forEach(function(e){i=e.indexOf(`:`),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!(!n||t[n]&&Yr[n])&&(n===`set-cookie`?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+`, `+r:r)}),t},Zr=Symbol(`internals`);function Qr(e){return e&&String(e).trim().toLowerCase()}function $r(e){return e===!1||e==null?e:F.isArray(e)?e.map($r):String(e)}function ei(e){let t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}var ti=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function ni(e,t,n,r,i){if(F.isFunction(r))return r.call(this,t,n);if(i&&(t=n),F.isString(t)){if(F.isString(r))return t.indexOf(r)!==-1;if(F.isRegExp(r))return r.test(t)}}function ri(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function ii(e,t){let n=F.toCamelCase(` `+t);[`get`,`set`,`has`].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})})}var ai=class{constructor(e){e&&this.set(e)}set(e,t,n){let r=this;function i(e,t,n){let i=Qr(t);if(!i)throw Error(`header name must be a non-empty string`);let a=F.findKey(r,i);(!a||r[a]===void 0||n===!0||n===void 0&&r[a]!==!1)&&(r[a||t]=$r(e))}let a=(e,t)=>F.forEach(e,(e,n)=>i(e,n,t));if(F.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(F.isString(e)&&(e=e.trim())&&!ti(e))a(Xr(e),t);else if(F.isObject(e)&&F.isIterable(e)){let n={},r,i;for(let t of e){if(!F.isArray(t))throw TypeError(`Object iterator must return a key-value pair`);n[i=t[0]]=(r=n[i])?F.isArray(r)?[...r,t[1]]:[r,t[1]]:t[1]}a(n,t)}else e!=null&&i(t,e,n);return this}get(e,t){if(e=Qr(e),e){let n=F.findKey(this,e);if(n){let e=this[n];if(!t)return e;if(t===!0)return ei(e);if(F.isFunction(t))return t.call(this,e,n);if(F.isRegExp(t))return t.exec(e);throw TypeError(`parser must be boolean|regexp|function`)}}}has(e,t){if(e=Qr(e),e){let n=F.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||ni(this,this[n],n,t)))}return!1}delete(e,t){let n=this,r=!1;function i(e){if(e=Qr(e),e){let i=F.findKey(n,e);i&&(!t||ni(n,n[i],i,t))&&(delete n[i],r=!0)}}return F.isArray(e)?e.forEach(i):i(e),r}clear(e){let t=Object.keys(this),n=t.length,r=!1;for(;n--;){let i=t[n];(!e||ni(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){let t=this,n={};return F.forEach(this,(r,i)=>{let a=F.findKey(n,i);if(a){t[a]=$r(r),delete t[i];return}let o=e?ri(i):String(i).trim();o!==i&&delete t[i],t[o]=$r(r),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return F.forEach(this,(n,r)=>{n!=null&&n!==!1&&(t[r]=e&&F.isArray(n)?n.join(`, `):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+`: `+t).join(`
`)}getSetCookie(){return this.get(`set-cookie`)||[]}get[Symbol.toStringTag](){return`AxiosHeaders`}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let n=new this(e);return t.forEach(e=>n.set(e)),n}static accessor(e){let t=(this[Zr]=this[Zr]={accessors:{}}).accessors,n=this.prototype;function r(e){let r=Qr(e);t[r]||(ii(n,e),t[r]=!0)}return F.isArray(e)?e.forEach(r):r(e),this}};ai.accessor([`Content-Type`,`Content-Length`,`Accept`,`Accept-Encoding`,`User-Agent`,`Authorization`]),F.reduceDescriptors(ai.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}}),F.freezeMethods(ai);var oi=ai;function si(e,t){let n=this||Jr,r=t||n,i=oi.from(r.headers),a=r.data;return F.forEach(e,function(e){a=e.call(n,a,i.normalize(),t?t.status:void 0)}),i.normalize(),a}function ci(e){return!!(e&&e.__CANCEL__)}function li(e,t,n){I.call(this,e??`canceled`,I.ERR_CANCELED,t,n),this.name=`CanceledError`}F.inherits(li,I,{__CANCEL__:!0});var ui=li;function di(e,t,n){let r=n.config.validateStatus;!n.status||!r||r(n.status)?e(n):t(new I(`Request failed with status code `+n.status,[I.ERR_BAD_REQUEST,I.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function fi(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||``}function pi(e,t){e||=10;let n=Array(e),r=Array(e),i=0,a=0,o;return t=t===void 0?1e3:t,function(s){let c=Date.now(),l=r[a];o||=c,n[i]=s,r[i]=c;let u=a,d=0;for(;u!==i;)d+=n[u++],u%=e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),c-o<t)return;let f=l&&c-l;return f?Math.round(d*1e3/f):void 0}}var mi=pi;function hi(e,t){let n=0,r=1e3/t,i,a,o=(t,r=Date.now())=>{n=r,i=null,a&&=(clearTimeout(a),null),e(...t)};return[(...e)=>{let t=Date.now(),s=t-n;s>=r?o(e,t):(i=e,a||=setTimeout(()=>{a=null,o(i)},r-s))},()=>i&&o(i)]}var gi=hi;const _i=(e,t,n=3)=>{let r=0,i=mi(50,250);return gi(n=>{let a=n.loaded,o=n.lengthComputable?n.total:void 0,s=a-r,c=i(s),l=a<=o;r=a;let u={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:c||void 0,estimated:c&&o&&l?(o-a)/c:void 0,event:n,lengthComputable:o!=null,[t?`download`:`upload`]:!0};e(u)},n)},vi=(e,t)=>{let n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},yi=e=>(...t)=>F.asap(()=>e(...t));var bi=Br.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Br.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Br.origin),Br.navigator&&/(msie|trident)/i.test(Br.navigator.userAgent)):()=>!0,xi=Br.hasStandardBrowserEnv?{write(e,t,n,r,i,a,o){if(typeof document>`u`)return;let s=[`${e}=${encodeURIComponent(t)}`];F.isNumber(n)&&s.push(`expires=${new Date(n).toUTCString()}`),F.isString(r)&&s.push(`path=${r}`),F.isString(i)&&s.push(`domain=${i}`),a===!0&&s.push(`secure`),F.isString(o)&&s.push(`SameSite=${o}`),document.cookie=s.join(`; `)},read(e){if(typeof document>`u`)return null;let t=document.cookie.match(RegExp(`(?:^|; )`+e+`=([^;]*)`));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,``,Date.now()-864e5,`/`)}}:{write(){},read(){return null},remove(){}};function Si(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Ci(e,t){return t?e.replace(/\/?\/$/,``)+`/`+t.replace(/^\/+/,``):e}function wi(e,t,n){let r=!Si(t);return e&&(r||n==0)?Ci(e,t):t}var Ti=e=>e instanceof oi?{...e}:e;function Ei(e,t){t||={};let n={};function r(e,t,n,r){return F.isPlainObject(e)&&F.isPlainObject(t)?F.merge.call({caseless:r},e,t):F.isPlainObject(t)?F.merge({},t):F.isArray(t)?t.slice():t}function i(e,t,n,i){if(F.isUndefined(t)){if(!F.isUndefined(e))return r(void 0,e,n,i)}else return r(e,t,n,i)}function a(e,t){if(!F.isUndefined(t))return r(void 0,t)}function o(e,t){if(F.isUndefined(t)){if(!F.isUndefined(e))return r(void 0,e)}else return r(void 0,t)}function s(n,i,a){if(a in t)return r(n,i);if(a in e)return r(void 0,n)}let c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t,n)=>i(Ti(e),Ti(t),n,!0)};return F.forEach(Object.keys({...e,...t}),function(r){let a=c[r]||i,o=a(e[r],t[r],r);F.isUndefined(o)&&a!==s||(n[r]=o)}),n}var Di=e=>{let t=Ei({},e),{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:a,headers:o,auth:s}=t;if(t.headers=o=oi.from(o),t.url=Ar(wi(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&o.set(`Authorization`,`Basic `+btoa((s.username||``)+`:`+(s.password?unescape(encodeURIComponent(s.password)):``))),F.isFormData(n)){if(Br.hasStandardBrowserEnv||Br.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(F.isFunction(n.getHeaders)){let e=n.getHeaders(),t=[`content-type`,`content-length`];Object.entries(e).forEach(([e,n])=>{t.includes(e.toLowerCase())&&o.set(e,n)})}}if(Br.hasStandardBrowserEnv&&(r&&F.isFunction(r)&&(r=r(t)),r||r!==!1&&bi(t.url))){let e=i&&a&&xi.read(a);e&&o.set(i,e)}return t},Oi=typeof XMLHttpRequest<`u`&&function(e){return new Promise(function(t,n){let r=Di(e),i=r.data,a=oi.from(r.headers).normalize(),{responseType:o,onUploadProgress:s,onDownloadProgress:c}=r,l,u,d,f,p;function m(){f&&f(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(l),r.signal&&r.signal.removeEventListener(`abort`,l)}let h=new XMLHttpRequest;h.open(r.method.toUpperCase(),r.url,!0),h.timeout=r.timeout;function g(){if(!h)return;let r=oi.from(`getAllResponseHeaders`in h&&h.getAllResponseHeaders()),i={data:!o||o===`text`||o===`json`?h.responseText:h.response,status:h.status,statusText:h.statusText,headers:r,config:e,request:h};di(function(e){t(e),m()},function(e){n(e),m()},i),h=null}`onloadend`in h?h.onloadend=g:h.onreadystatechange=function(){!h||h.readyState!==4||h.status===0&&!(h.responseURL&&h.responseURL.indexOf(`file:`)===0)||setTimeout(g)},h.onabort=function(){h&&=(n(new I(`Request aborted`,I.ECONNABORTED,e,h)),null)},h.onerror=function(t){let r=t&&t.message?t.message:`Network Error`,i=new I(r,I.ERR_NETWORK,e,h);i.event=t||null,n(i),h=null},h.ontimeout=function(){let t=r.timeout?`timeout of `+r.timeout+`ms exceeded`:`timeout exceeded`,i=r.transitional||Mr;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new I(t,i.clarifyTimeoutError?I.ETIMEDOUT:I.ECONNABORTED,e,h)),h=null},i===void 0&&a.setContentType(null),`setRequestHeader`in h&&F.forEach(a.toJSON(),function(e,t){h.setRequestHeader(t,e)}),F.isUndefined(r.withCredentials)||(h.withCredentials=!!r.withCredentials),o&&o!==`json`&&(h.responseType=r.responseType),c&&([d,p]=_i(c,!0),h.addEventListener(`progress`,d)),s&&h.upload&&([u,f]=_i(s),h.upload.addEventListener(`progress`,u),h.upload.addEventListener(`loadend`,f)),(r.cancelToken||r.signal)&&(l=t=>{h&&=(n(!t||t.type?new ui(null,e,h):t),h.abort(),null)},r.cancelToken&&r.cancelToken.subscribe(l),r.signal&&(r.signal.aborted?l():r.signal.addEventListener(`abort`,l)));let _=fi(r.url);if(_&&Br.protocols.indexOf(_)===-1){n(new I(`Unsupported protocol `+_+`:`,I.ERR_BAD_REQUEST,e));return}h.send(i||null)})},ki=(e,t)=>{let{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n=new AbortController,r,i=function(e){if(!r){r=!0,o();let t=e instanceof Error?e:this.reason;n.abort(t instanceof I?t:new ui(t instanceof Error?t.message:t))}},a=t&&setTimeout(()=>{a=null,i(new I(`timeout ${t} of ms exceeded`,I.ETIMEDOUT))},t),o=()=>{e&&=(a&&clearTimeout(a),a=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener(`abort`,i)}),null)};e.forEach(e=>e.addEventListener(`abort`,i));let{signal:s}=n;return s.unsubscribe=()=>F.asap(o),s}};const Ai=function*(e,t){let n=e.byteLength;if(!t||n<t){yield e;return}let r=0,i;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},ji=async function*(e,t){for await(let n of Mi(e))yield*Ai(n,t)};var Mi=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}let t=e.getReader();try{for(;;){let{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}};const Ni=(e,t,n,r)=>{let i=ji(e,t),a=0,o,s=e=>{o||(o=!0,r&&r(e))};return new ReadableStream({async pull(e){try{let{done:t,value:r}=await i.next();if(t){s(),e.close();return}let o=r.byteLength;if(n){let e=a+=o;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw s(e),e}},cancel(e){return s(e),i.return()}},{highWaterMark:2})};var Pi=64*1024,{isFunction:Fi}=F,Ii=(({Request:e,Response:t})=>({Request:e,Response:t}))(F.global),{ReadableStream:Li,TextEncoder:Ri}=F.global,zi=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Bi=e=>{e=F.merge.call({skipUndefined:!0},Ii,e);let{fetch:t,Request:n,Response:r}=e,i=t?Fi(t):typeof fetch==`function`,a=Fi(n),o=Fi(r);if(!i)return!1;let s=i&&Fi(Li),c=i&&(typeof Ri==`function`?(e=>t=>e.encode(t))(new Ri):async e=>new Uint8Array(await new n(e).arrayBuffer())),l=a&&s&&zi(()=>{let e=!1,t=new n(Br.origin,{body:new Li,method:`POST`,get duplex(){return e=!0,`half`}}).headers.has(`Content-Type`);return e&&!t}),u=o&&s&&zi(()=>F.isReadableStream(new r(``).body)),d={stream:u&&(e=>e.body)};i&&[`text`,`arrayBuffer`,`blob`,`formData`,`stream`].forEach(e=>{!d[e]&&(d[e]=(t,n)=>{let r=t&&t[e];if(r)return r.call(t);throw new I(`Response type '${e}' is not supported`,I.ERR_NOT_SUPPORT,n)})});let f=async e=>{if(e==null)return 0;if(F.isBlob(e))return e.size;if(F.isSpecCompliantForm(e))return(await new n(Br.origin,{method:`POST`,body:e}).arrayBuffer()).byteLength;if(F.isArrayBufferView(e)||F.isArrayBuffer(e))return e.byteLength;if(F.isURLSearchParams(e)&&(e+=``),F.isString(e))return(await c(e)).byteLength},p=async(e,t)=>F.toFiniteNumber(e.getContentLength())??f(t);return async e=>{let{url:i,method:o,data:s,signal:c,cancelToken:f,timeout:m,onDownloadProgress:h,onUploadProgress:g,responseType:_,headers:v,withCredentials:y=`same-origin`,fetchOptions:b}=Di(e),x=t||fetch;_=_?(_+``).toLowerCase():`text`;let S=ki([c,f&&f.toAbortSignal()],m),C=null,w=S&&S.unsubscribe&&(()=>{S.unsubscribe()}),ee;try{if(g&&l&&o!==`get`&&o!==`head`&&(ee=await p(v,s))!==0){let e=new n(i,{method:`POST`,body:s,duplex:`half`}),t;if(F.isFormData(s)&&(t=e.headers.get(`content-type`))&&v.setContentType(t),e.body){let[t,n]=vi(ee,_i(yi(g)));s=Ni(e.body,Pi,t,n)}}F.isString(y)||(y=y?`include`:`omit`);let t=a&&`credentials`in n.prototype,c={...b,signal:S,method:o.toUpperCase(),headers:v.normalize().toJSON(),body:s,duplex:`half`,credentials:t?y:void 0};C=a&&new n(i,c);let f=await(a?x(C,b):x(i,c)),m=u&&(_===`stream`||_===`response`);if(u&&(h||m&&w)){let e={};[`status`,`statusText`,`headers`].forEach(t=>{e[t]=f[t]});let t=F.toFiniteNumber(f.headers.get(`content-length`)),[n,i]=h&&vi(t,_i(yi(h),!0))||[];f=new r(Ni(f.body,Pi,n,()=>{i&&i(),w&&w()}),e)}_||=`text`;let T=await d[F.findKey(d,_)||`text`](f,e);return!m&&w&&w(),await new Promise((t,n)=>{di(t,n,{data:T,headers:oi.from(f.headers),status:f.status,statusText:f.statusText,config:e,request:C})})}catch(t){throw w&&w(),t&&t.name===`TypeError`&&/Load failed|fetch/i.test(t.message)?Object.assign(new I(`Network Error`,I.ERR_NETWORK,e,C),{cause:t.cause||t}):I.from(t,t&&t.code,e,C)}}},Vi=new Map;const Hi=e=>{let t=e&&e.env||{},{fetch:n,Request:r,Response:i}=t,a=[r,i,n],o=a.length,s,c,l=Vi;for(;o--;)s=a[o],c=l.get(s),c===void 0&&l.set(s,c=o?new Map:Bi(t)),l=c;return c};Hi();var Ui={http:null,xhr:Oi,fetch:{get:Hi}};F.forEach(Ui,(e,t)=>{if(e){try{Object.defineProperty(e,`name`,{value:t})}catch{}Object.defineProperty(e,`adapterName`,{value:t})}});var Wi=e=>`- ${e}`,Gi=e=>F.isFunction(e)||e===null||e===!1;function Ki(e,t){e=F.isArray(e)?e:[e];let{length:n}=e,r,i,a={};for(let o=0;o<n;o++){r=e[o];let n;if(i=r,!Gi(r)&&(i=Ui[(n=String(r)).toLowerCase()],i===void 0))throw new I(`Unknown adapter '${n}'`);if(i&&(F.isFunction(i)||(i=i.get(t))))break;a[n||`#`+o]=i}if(!i){let e=Object.entries(a).map(([e,t])=>`adapter ${e} `+(t===!1?`is not supported by the environment`:`is not available in the build`)),t=n?e.length>1?`since :
`+e.map(Wi).join(`
`):` `+Wi(e[0]):`as no adapter specified`;throw new I(`There is no suitable adapter to dispatch the request `+t,`ERR_NOT_SUPPORT`)}return i}var qi={getAdapter:Ki,adapters:Ui};function Ji(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ui(null,e)}function Yi(e){return Ji(e),e.headers=oi.from(e.headers),e.data=si.call(e,e.transformRequest),[`post`,`put`,`patch`].indexOf(e.method)!==-1&&e.headers.setContentType(`application/x-www-form-urlencoded`,!1),qi.getAdapter(e.adapter||Jr.adapter,e)(e).then(function(t){return Ji(e),t.data=si.call(e,e.transformResponse,t),t.headers=oi.from(t.headers),t},function(t){return ci(t)||(Ji(e),t&&t.response&&(t.response.data=si.call(e,e.transformResponse,t.response),t.response.headers=oi.from(t.response.headers))),Promise.reject(t)})}const Xi=`1.13.2`;var Zi={};[`object`,`boolean`,`number`,`function`,`string`,`symbol`].forEach((e,t)=>{Zi[e]=function(n){return typeof n===e||`a`+(t<1?`n `:` `)+e}});var Qi={};Zi.transitional=function(e,t,n){function r(e,t){return`[Axios v`+Xi+`] Transitional option '`+e+`'`+t+(n?`. `+n:``)}return(n,i,a)=>{if(e===!1)throw new I(r(i,` has been removed`+(t?` in `+t:``)),I.ERR_DEPRECATED);return t&&!Qi[i]&&(Qi[i]=!0,console.warn(r(i,` has been deprecated since v`+t+` and will be removed in the near future`))),e?e(n,i,a):!0}},Zi.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function $i(e,t,n){if(typeof e!=`object`)throw new I(`options must be an object`,I.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),i=r.length;for(;i-- >0;){let a=r[i],o=t[a];if(o){let t=e[a],n=t===void 0||o(t,a,e);if(n!==!0)throw new I(`option `+a+` must be `+n,I.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new I(`Unknown option `+a,I.ERR_BAD_OPTION)}}var ea={assertOptions:$i,validators:Zi},ta=ea.validators,na=class{constructor(e){this.defaults=e||{},this.interceptors={request:new jr,response:new jr}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=Error();let n=t.stack?t.stack.replace(/^.+\n/,``):``;try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,``))&&(e.stack+=`
`+n):e.stack=n}catch{}}throw e}}_request(e,t){typeof e==`string`?(t||={},t.url=e):t=e||{},t=Ei(this.defaults,t);let{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&ea.assertOptions(n,{silentJSONParsing:ta.transitional(ta.boolean),forcedJSONParsing:ta.transitional(ta.boolean),clarifyTimeoutError:ta.transitional(ta.boolean)},!1),r!=null&&(F.isFunction(r)?t.paramsSerializer={serialize:r}:ea.assertOptions(r,{encode:ta.function,serialize:ta.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls===void 0?t.allowAbsoluteUrls=!0:t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls),ea.assertOptions(t,{baseUrl:ta.spelling(`baseURL`),withXsrfToken:ta.spelling(`withXSRFToken`)},!0),t.method=(t.method||this.defaults.method||`get`).toLowerCase();let a=i&&F.merge(i.common,i[t.method]);i&&F.forEach([`delete`,`get`,`head`,`post`,`put`,`patch`,`common`],e=>{delete i[e]}),t.headers=oi.concat(a,i);let o=[],s=!0;this.interceptors.request.forEach(function(e){typeof e.runWhen==`function`&&e.runWhen(t)===!1||(s&&=e.synchronous,o.unshift(e.fulfilled,e.rejected))});let c=[];this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let l,u=0,d;if(!s){let e=[Yi.bind(this),void 0];for(e.unshift(...o),e.push(...c),d=e.length,l=Promise.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=o.length;let f=t;for(;u<d;){let e=o[u++],t=o[u++];try{f=e(f)}catch(e){t.call(this,e);break}}try{l=Yi.call(this,f)}catch(e){return Promise.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){e=Ei(this.defaults,e);let t=wi(e.baseURL,e.url,e.allowAbsoluteUrls);return Ar(t,e.params,e.paramsSerializer)}};F.forEach([`delete`,`get`,`head`,`options`],function(e){na.prototype[e]=function(t,n){return this.request(Ei(n||{},{method:e,url:t,data:(n||{}).data}))}}),F.forEach([`post`,`put`,`patch`],function(e){function t(t){return function(n,r,i){return this.request(Ei(i||{},{method:e,headers:t?{"Content-Type":`multipart/form-data`}:{},url:n,data:r}))}}na.prototype[e]=t(),na.prototype[e+`Form`]=t(!0)});var ra=na,ia=class e{constructor(e){if(typeof e!=`function`)throw TypeError(`executor must be a function.`);let t;this.promise=new Promise(function(e){t=e});let n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t,r=new Promise(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,i){n.reason||(n.reason=new ui(e,r,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}};function aa(e){return function(t){return e.apply(null,t)}}function oa(e){return F.isObject(e)&&e.isAxiosError===!0}var sa={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(sa).forEach(([e,t])=>{sa[t]=e});var ca=sa;function la(e){let t=new ra(e),n=cn(ra.prototype.request,t);return F.extend(n,ra.prototype,t,{allOwnKeys:!0}),F.extend(n,t,null,{allOwnKeys:!0}),n.create=function(t){return la(Ei(e,t))},n}var L=la(Jr);L.Axios=ra,L.CanceledError=ui,L.CancelToken=ia,L.isCancel=ci,L.VERSION=Xi,L.toFormData=wr,L.AxiosError=I,L.Cancel=L.CanceledError,L.all=function(e){return Promise.all(e)},L.spread=aa,L.isAxiosError=oa,L.mergeConfig=Ei,L.AxiosHeaders=oi,L.formToJSON=e=>Gr(F.isHTMLForm(e)?new FormData(e):e),L.getAdapter=qi.getAdapter,L.HttpStatusCode=ca,L.default=L;var ua=L,da=l({HttpRequestNode:()=>fa}),fa=class extends kt{constructor(...e){super(...e),this.type=`http-request`,this.label=`HTTP è¯·æ±‚`,this.description=`å‘é€ HTTP è¯·æ±‚å¹¶è¿”å›å“åº”`,this.category=`ç½‘ç»œ`}defineInputs(){return[{name:`url`,type:`string`,description:`è¯·æ±‚ URL`,required:!0},{name:`method`,type:`string`,description:`è¯·æ±‚æ–¹æ³•ï¼ˆGET/POST/PUT/DELETE/PATCHï¼‰`,defaultValue:`GET`},{name:`headers`,type:`object`,description:`è¯·æ±‚å¤´ï¼ˆJSON å¯¹è±¡ï¼‰`,defaultValue:`{}`},{name:`body`,type:`any`,description:`è¯·æ±‚ä½“ï¼ˆPOST/PUT/PATCH æ—¶ä½¿ç”¨ï¼‰`},{name:`timeout`,type:`number`,description:`è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰`,defaultValue:3e4},{name:`retryCount`,type:`number`,description:`é‡è¯•æ¬¡æ•°ï¼ˆå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼‰`,defaultValue:0},{name:`retryDelay`,type:`number`,description:`é‡è¯•é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ0 è¡¨ç¤ºä½¿ç”¨æŒ‡æ•°é€€é¿`,defaultValue:0}]}defineOutputs(){return[{name:`data`,type:`any`,description:`å“åº”æ•°æ®`},{name:`status`,type:`number`,description:`HTTP çŠ¶æ€ç `},{name:`headers`,type:`object`,description:`å“åº”å¤´`},{name:`success`,type:`boolean`,description:`è¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆçŠ¶æ€ç  2xxï¼‰`}]}getStyleConfig(){return{headerColor:[`#3b82f6`,`#06b6d4`],icon:`globe`,showIcon:!0,bodyStyle:{minWidth:`240px`}}}async execute(e,t){try{let n=this.getInput(e,`url`),r=this.getInput(e,`method`,`GET`),i=this.getInput(e,`headers`,{}),a=this.getInput(e,`body`),o=this.getInput(e,`timeout`,3e4),s=this.getInput(e,`retryCount`,0),c=this.getInput(e,`retryDelay`,0),l=this.validateInputs(e);if(!l.valid)return this.createError(l.errors.join(`; `));if(t.signal?.aborted)return this.createError(`è¯·æ±‚å·²ä¸­æ­¢`);let u={method:r.toLowerCase(),url:n,timeout:o,headers:{"Content-Type":`application/json`,...i},signal:t.signal};[`POST`,`PUT`,`PATCH`].includes(r)&&a!==void 0&&(u.data=a);let d=null;for(let e=0;e<=s;e++)try{if(t.signal?.aborted)return this.createError(`è¯·æ±‚å·²ä¸­æ­¢`);let e=await ua(u),i=e.data,a={};Object.keys(e.headers).forEach(t=>{let n=e.headers[t];typeof n==`string`?a[t]=n:Array.isArray(n)&&n.length>0&&(a[t]=n[0])});let o=e.status>=200&&e.status<300;return this.createOutput({data:i,status:e.status,headers:a,success:o},i,`${r} ${n} - ${e.status} ${e.statusText||``}`)}catch(t){if(d=t,e===s)break;let n=t;if(n.response){let e=n.response.status;if(e<500&&e!==429)break}else if(n.code!==`ECONNABORTED`&&n.code!==`ERR_NETWORK`){if(n.code===`ERR_CANCELED`)return this.createError(`è¯·æ±‚å·²ä¸­æ­¢`);break}if(e<s){let t;t=c>0?c:Math.min(1e3*2**e,1e4),await new Promise(e=>setTimeout(e,t))}}if(d){let e=d;return e.response?this.createError(`è¯·æ±‚å¤±è´¥: ${e.response.status} ${e.response.statusText||``}`):e.code===`ECONNABORTED`?this.createError(`è¯·æ±‚è¶…æ—¶`):e.code===`ERR_NETWORK`?this.createError(`ç½‘ç»œé”™è¯¯`):this.createError(e.message||`è¯·æ±‚å¤±è´¥`)}return this.createError(`è¯·æ±‚å¤±è´¥`)}catch(e){return this.createError(e)}}},pa=l({NoteNode:()=>ma}),ma=class extends kt{constructor(...e){super(...e),this.type=`note`,this.label=`ç¬”è®°`,this.description=`åœ¨å·¥ä½œæµä¸­æ·»åŠ æ³¨é‡Šå’Œè¯´æ˜`,this.category=`å·¥å…·`}defineInputs(){return[]}defineOutputs(){return[]}getStyleConfig(){return{headerColor:`#fbbf24`,icon:`edit`,showIcon:!0}}async execute(e,t){return{success:!0,summary:`ç¬”è®°èŠ‚ç‚¹ï¼ˆè·³è¿‡æ‰§è¡Œï¼‰`,outputs:{}}}};function R(e,t,n,r,i){if(r===`m`)throw TypeError(`Private method is not writable`);if(r===`a`&&!i)throw TypeError(`Private accessor was defined without a setter`);if(typeof t==`function`?e!==t||!i:!t.has(e))throw TypeError(`Cannot write private member to an object whose class did not declare it`);return r===`a`?i.call(e,n):i?i.value=n:t.set(e,n),n}function z(e,t,n,r){if(n===`a`&&!r)throw TypeError(`Private accessor was defined without a getter`);if(typeof t==`function`?e!==t||!r:!t.has(e))throw TypeError(`Cannot read private member from an object whose class did not declare it`);return n===`m`?r:n===`a`?r.call(e):r?r.value:t.get(e)}let ha=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return ha=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return`10000000-1000-4000-8000-100000000000`.replace(/[018]/g,e=>(e^n()&15>>e/4).toString(16))};function ga(e){return typeof e==`object`&&!!e&&(`name`in e&&e.name===`AbortError`||`message`in e&&String(e.message).includes(`FetchRequestCanceledException`))}const _a=e=>{if(e instanceof Error)return e;if(typeof e==`object`&&e){try{if(Object.prototype.toString.call(e)===`[object Error]`){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};var B=class extends Error{},va=class e extends B{constructor(t,n,r,i){super(`${e.makeMessage(t,n,r)}`),this.status=t,this.headers=i,this.requestID=i?.get(`x-request-id`),this.error=n;let a=n;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){let r=t?.message?typeof t.message==`string`?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||`(no status code or body)`}static generate(t,n,r,i){if(!t||!i)return new ba({message:r,cause:_a(n)});let a=n?.error;return t===400?new Sa(t,a,r,i):t===401?new Ca(t,a,r,i):t===403?new wa(t,a,r,i):t===404?new Ta(t,a,r,i):t===409?new Ea(t,a,r,i):t===422?new Da(t,a,r,i):t===429?new Oa(t,a,r,i):t>=500?new ka(t,a,r,i):new e(t,a,r,i)}},ya=class extends va{constructor({message:e}={}){super(void 0,void 0,e||`Request was aborted.`,void 0)}},ba=class extends va{constructor({message:e,cause:t}){super(void 0,void 0,e||`Connection error.`,void 0),t&&(this.cause=t)}},xa=class extends ba{constructor({message:e}={}){super({message:e??`Request timed out.`})}},Sa=class extends va{},Ca=class extends va{},wa=class extends va{},Ta=class extends va{},Ea=class extends va{},Da=class extends va{},Oa=class extends va{},ka=class extends va{},Aa=class extends B{constructor(){super(`Could not parse response content as the length limit was reached`)}},ja=class extends B{constructor(){super(`Could not parse response content as the request was rejected by the content filter`)}},Ma=class extends Error{constructor(e){super(e)}},Na=/^[a-z][a-z0-9+.-]*:/i;const Pa=e=>Na.test(e);let Fa=e=>(Fa=Array.isArray,Fa(e)),Ia=Fa;function La(e){return typeof e==`object`?e??{}:{}}function Ra(e){if(!e)return!0;for(let t in e)return!1;return!0}function za(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ba(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}const Va=(e,t)=>{if(typeof t!=`number`||!Number.isInteger(t))throw new B(`${e} must be an integer`);if(t<0)throw new B(`${e} must be a positive integer`);return t},Ha=e=>{try{return JSON.parse(e)}catch{return}},Ua=e=>new Promise(t=>setTimeout(t,e)),Wa=`6.9.0`,Ga=()=>typeof window<`u`&&window.document!==void 0&&typeof navigator<`u`;function Ka(){return typeof Deno<`u`&&Deno.build!=null?`deno`:typeof EdgeRuntime<`u`?`edge`:Object.prototype.toString.call(globalThis.process===void 0?0:globalThis.process)===`[object process]`?`node`:`unknown`}var qa=()=>{let e=Ka();if(e===`deno`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Wa,"X-Stainless-OS":Xa(Deno.build.os),"X-Stainless-Arch":Ya(Deno.build.arch),"X-Stainless-Runtime":`deno`,"X-Stainless-Runtime-Version":typeof Deno.version==`string`?Deno.version:Deno.version?.deno??`unknown`};if(typeof EdgeRuntime<`u`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Wa,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":`edge`,"X-Stainless-Runtime-Version":globalThis.process.version};if(e===`node`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Wa,"X-Stainless-OS":Xa(globalThis.process.platform??`unknown`),"X-Stainless-Arch":Ya(globalThis.process.arch??`unknown`),"X-Stainless-Runtime":`node`,"X-Stainless-Runtime-Version":globalThis.process.version??`unknown`};let t=Ja();return t?{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Wa,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Wa,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`unknown`,"X-Stainless-Runtime-Version":`unknown`}};function Ja(){if(typeof navigator>`u`||!navigator)return null;for(let{key:e,pattern:t}of[{key:`edge`,pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`chrome`,pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`firefox`,pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`safari`,pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=t.exec(navigator.userAgent);if(n){let t=n[1]||0,r=n[2]||0,i=n[3]||0;return{browser:e,version:`${t}.${r}.${i}`}}}return null}var Ya=e=>e===`x32`?`x32`:e===`x86_64`||e===`x64`?`x64`:e===`arm`?`arm`:e===`aarch64`||e===`arm64`?`arm64`:e?`other:${e}`:`unknown`,Xa=e=>(e=e.toLowerCase(),e.includes(`ios`)?`iOS`:e===`android`?`Android`:e===`darwin`?`MacOS`:e===`win32`?`Windows`:e===`freebsd`?`FreeBSD`:e===`openbsd`?`OpenBSD`:e===`linux`?`Linux`:e?`Other:${e}`:`Unknown`),Za;const Qa=()=>Za??=qa();function $a(){if(typeof fetch<`u`)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function eo(...e){let t=globalThis.ReadableStream;if(t===void 0)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function to(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return eo({start(){},async pull(e){let{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function no(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function ro(e){if(typeof e!=`object`||!e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),n=t.cancel();t.releaseLock(),await n}const io=({headers:e,body:t})=>({bodyHeaders:{"content-type":`application/json`},body:JSON.stringify(t)}),ao=`RFC3986`,oo=e=>String(e),so={RFC1738:e=>String(e).replace(/%20/g,`+`),RFC3986:oo};let co=(e,t)=>(co=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),co(e,t));var lo=(()=>{let e=[];for(let t=0;t<256;++t)e.push(`%`+((t<16?`0`:``)+t.toString(16)).toUpperCase());return e})(),uo=1024;const fo=(e,t,n,r,i)=>{if(e.length===0)return e;let a=e;if(typeof e==`symbol`?a=Symbol.prototype.toString.call(e):typeof e!=`string`&&(a=String(e)),n===`iso-8859-1`)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return`%26%23`+parseInt(e.slice(2),16)+`%3B`});let o=``;for(let e=0;e<a.length;e+=uo){let t=a.length>=uo?a.slice(e,e+uo):a,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);if(r===45||r===46||r===95||r===126||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||i===`RFC1738`&&(r===40||r===41)){n[n.length]=t.charAt(e);continue}if(r<128){n[n.length]=lo[r];continue}if(r<2048){n[n.length]=lo[192|r>>6]+lo[128|r&63];continue}if(r<55296||r>=57344){n[n.length]=lo[224|r>>12]+lo[128|r>>6&63]+lo[128|r&63];continue}e+=1,r=65536+((r&1023)<<10|t.charCodeAt(e)&1023),n[n.length]=lo[240|r>>18]+lo[128|r>>12&63]+lo[128|r>>6&63]+lo[128|r&63]}o+=n.join(``)}return o};function po(e){return!e||typeof e!=`object`?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function mo(e,t){if(Fa(e)){let n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}var ho={brackets(e){return String(e)+`[]`},comma:`comma`,indices(e,t){return String(e)+`[`+t+`]`},repeat(e){return String(e)}},go=function(e,t){Array.prototype.push.apply(e,Fa(t)?t:[t])},_o,V={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:`indices`,charset:`utf-8`,charsetSentinel:!1,delimiter:`&`,encode:!0,encodeDotInKeys:!1,encoder:fo,encodeValuesOnly:!1,format:ao,formatter:oo,indices:!1,serializeDate(e){return(_o??=Function.prototype.call.bind(Date.prototype.toISOString))(e)},skipNulls:!1,strictNullHandling:!1};function vo(e){return typeof e==`string`||typeof e==`number`||typeof e==`boolean`||typeof e==`symbol`||typeof e==`bigint`}var yo={};function bo(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_){let v=e,y=_,b=0,x=!1;for(;(y=y.get(yo))!==void 0&&!x;){let t=y.get(e);if(b+=1,t!==void 0){if(t===b)throw RangeError(`Cyclic object value`);x=!0}y.get(yo)===void 0&&(b=0)}if(typeof l==`function`?v=l(t,v):v instanceof Date?v=f?.(v):n===`comma`&&Fa(v)&&(v=mo(v,function(e){return e instanceof Date?f?.(e):e})),v===null){if(a)return c&&!h?c(t,V.encoder,g,`key`,p):t;v=``}if(vo(v)||po(v)){if(c){let e=h?t:c(t,V.encoder,g,`key`,p);return[m?.(e)+`=`+m?.(c(v,V.encoder,g,`value`,p))]}return[m?.(t)+`=`+m?.(String(v))]}let S=[];if(v===void 0)return S;let C;if(n===`comma`&&Fa(v))h&&c&&(v=mo(v,c)),C=[{value:v.length>0?v.join(`,`)||null:void 0}];else if(Fa(l))C=l;else{let e=Object.keys(v);C=u?e.sort(u):e}let w=s?String(t).replace(/\./g,`%2E`):String(t),ee=r&&Fa(v)&&v.length===1?w+`[]`:w;if(i&&Fa(v)&&v.length===0)return ee+`[]`;for(let t=0;t<C.length;++t){let y=C[t],x=typeof y==`object`&&y.value!==void 0?y.value:v[y];if(o&&x===null)continue;let w=d&&s?y.replace(/\./g,`%2E`):y,T=Fa(v)?typeof n==`function`?n(ee,w):ee:ee+(d?`.`+w:`[`+w+`]`);_.set(e,b);let E=new WeakMap;E.set(yo,_),go(S,bo(x,T,n,r,i,a,o,s,n===`comma`&&h&&Fa(v)?null:c,l,u,d,f,p,m,h,g,E))}return S}function xo(e=V){if(e.allowEmptyArrays!==void 0&&typeof e.allowEmptyArrays!=`boolean`)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(e.encodeDotInKeys!==void 0&&typeof e.encodeDotInKeys!=`boolean`)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&e.encoder!==void 0&&typeof e.encoder!=`function`)throw TypeError(`Encoder has to be a function.`);let t=e.charset||V.charset;if(e.charset!==void 0&&e.charset!==`utf-8`&&e.charset!==`iso-8859-1`)throw TypeError(`The charset option must be either utf-8, iso-8859-1, or undefined`);let n=ao;if(e.format!==void 0){if(!co(so,e.format))throw TypeError(`Unknown format option provided.`);n=e.format}let r=so[n],i=V.filter;(typeof e.filter==`function`||Fa(e.filter))&&(i=e.filter);let a;if(a=e.arrayFormat&&e.arrayFormat in ho?e.arrayFormat:`indices`in e?e.indices?`indices`:`repeat`:V.arrayFormat,`commaRoundTrip`in e&&typeof e.commaRoundTrip!=`boolean`)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let o=e.allowDots===void 0?e.encodeDotInKeys?!0:V.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix==`boolean`?e.addQueryPrefix:V.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof e.allowEmptyArrays==`boolean`?!!e.allowEmptyArrays:V.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:typeof e.charsetSentinel==`boolean`?e.charsetSentinel:V.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:e.delimiter===void 0?V.delimiter:e.delimiter,encode:typeof e.encode==`boolean`?e.encode:V.encode,encodeDotInKeys:typeof e.encodeDotInKeys==`boolean`?e.encodeDotInKeys:V.encodeDotInKeys,encoder:typeof e.encoder==`function`?e.encoder:V.encoder,encodeValuesOnly:typeof e.encodeValuesOnly==`boolean`?e.encodeValuesOnly:V.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:typeof e.serializeDate==`function`?e.serializeDate:V.serializeDate,skipNulls:typeof e.skipNulls==`boolean`?e.skipNulls:V.skipNulls,sort:typeof e.sort==`function`?e.sort:null,strictNullHandling:typeof e.strictNullHandling==`boolean`?e.strictNullHandling:V.strictNullHandling}}function So(e,t={}){let n=e,r=xo(t),i,a;typeof r.filter==`function`?(a=r.filter,n=a(``,n)):Fa(r.filter)&&(a=r.filter,i=a);let o=[];if(typeof n!=`object`||!n)return``;let s=ho[r.arrayFormat],c=s===`comma`&&r.commaRoundTrip;i||=Object.keys(n),r.sort&&i.sort(r.sort);let l=new WeakMap;for(let e=0;e<i.length;++e){let t=i[e];r.skipNulls&&n[t]===null||go(o,bo(n[t],t,s,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let u=o.join(r.delimiter),d=r.addQueryPrefix===!0?`?`:``;return r.charsetSentinel&&(r.charset===`iso-8859-1`?d+=`utf8=%26%2310003%3B&`:d+=`utf8=%E2%9C%93&`),u.length>0?d+u:``}function Co(e){let t=0;for(let n of e)t+=n.length;let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}var wo;function To(e){let t;return(wo??=(t=new globalThis.TextEncoder,t.encode.bind(t)))(e)}var Eo;function Do(e){let t;return(Eo??=(t=new globalThis.TextDecoder,t.decode.bind(t)))(e)}var Oo,ko,Ao=class{constructor(){Oo.set(this,void 0),ko.set(this,void 0),R(this,Oo,new Uint8Array,`f`),R(this,ko,null,`f`)}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e==`string`?To(e):e;R(this,Oo,Co([z(this,Oo,`f`),t]),`f`);let n=[],r;for(;(r=jo(z(this,Oo,`f`),z(this,ko,`f`)))!=null;){if(r.carriage&&z(this,ko,`f`)==null){R(this,ko,r.index,`f`);continue}if(z(this,ko,`f`)!=null&&(r.index!==z(this,ko,`f`)+1||r.carriage)){n.push(Do(z(this,Oo,`f`).subarray(0,z(this,ko,`f`)-1))),R(this,Oo,z(this,Oo,`f`).subarray(z(this,ko,`f`)),`f`),R(this,ko,null,`f`);continue}let e=z(this,ko,`f`)===null?r.preceding:r.preceding-1,t=Do(z(this,Oo,`f`).subarray(0,e));n.push(t),R(this,Oo,z(this,Oo,`f`).subarray(r.index),`f`),R(this,ko,null,`f`)}return n}flush(){return z(this,Oo,`f`).length?this.decode(`
`):[]}};Oo=new WeakMap,ko=new WeakMap,Ao.NEWLINE_CHARS=new Set([`
`,`\r`]),Ao.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function jo(e,t){for(let n=t??0;n<e.length;n++){if(e[n]===10)return{preceding:n,index:n+1,carriage:!1};if(e[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function Mo(e){for(let t=0;t<e.length-1;t++){if(e[t]===10&&e[t+1]===10||e[t]===13&&e[t+1]===13)return t+2;if(e[t]===13&&e[t+1]===10&&t+3<e.length&&e[t+2]===13&&e[t+3]===10)return t+4}return-1}var No={off:0,error:200,warn:300,info:400,debug:500};const Po=(e,t,n)=>{if(e){if(za(No,e))return e;zo(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(No))}`)}};function Fo(){}function Io(e,t,n){return!t||No[e]>No[n]?Fo:t[e].bind(t)}var Lo={error:Fo,warn:Fo,info:Fo,debug:Fo},Ro=new WeakMap;function zo(e){let t=e.logger,n=e.logLevel??`off`;if(!t)return Lo;let r=Ro.get(t);if(r&&r[0]===n)return r[1];let i={error:Io(`error`,t,n),warn:Io(`warn`,t,n),info:Io(`info`,t,n),debug:Io(`debug`,t,n)};return Ro.set(t,[n,i]),i}const Bo=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,e.toLowerCase()===`authorization`||e.toLowerCase()===`cookie`||e.toLowerCase()===`set-cookie`?`***`:t])),`retryOfRequestLogID`in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var Vo,Ho=class e{constructor(e,t,n){this.iterator=e,Vo.set(this,void 0),this.controller=t,R(this,Vo,n,`f`)}static fromSSEResponse(t,n,r){let i=!1,a=r?zo(r):console;async function*o(){if(i)throw new B("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let e=!1;try{for await(let r of Uo(t,n))if(!e){if(r.data.startsWith(`[DONE]`)){e=!0;continue}if(r.event===null||!r.event.startsWith(`thread.`)){let e;try{e=JSON.parse(r.data)}catch(e){throw a.error(`Could not parse message into JSON:`,r.data),a.error(`From chunk:`,r.raw),e}if(e&&e.error)throw new va(void 0,e.error,void 0,t.headers);yield e}else{let e;try{e=JSON.parse(r.data)}catch(e){throw console.error(`Could not parse message into JSON:`,r.data),console.error(`From chunk:`,r.raw),e}if(r.event==`error`)throw new va(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}}e=!0}catch(e){if(ga(e))return;throw e}finally{e||n.abort()}}return new e(o,n,r)}static fromReadableStream(t,n,r){let i=!1;async function*a(){let e=new Ao,n=no(t);for await(let t of n)for(let n of e.decode(t))yield n;for(let t of e.flush())yield t}async function*o(){if(i)throw new B("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let e=!1;try{for await(let t of a())e||t&&(yield JSON.parse(t));e=!0}catch(e){if(ga(e))return;throw e}finally{e||n.abort()}}return new e(o,n,r)}[(Vo=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let t=[],n=[],r=this.iterator(),i=e=>({next:()=>{if(e.length===0){let e=r.next();t.push(e),n.push(e)}return e.shift()}});return[new e(()=>i(t),this.controller,z(this,Vo,`f`)),new e(()=>i(n),this.controller,z(this,Vo,`f`))]}toReadableStream(){let e=this,t;return eo({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{let{value:n,done:r}=await t.next();if(r)return e.close();let i=To(JSON.stringify(n)+`
`);e.enqueue(i)}catch(t){e.error(t)}},async cancel(){await t.return?.()}})}};async function*Uo(e,t){if(!e.body)throw t.abort(),globalThis.navigator!==void 0&&globalThis.navigator.product===`ReactNative`?new B(`The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api`):new B(`Attempted to iterate over a response with no body`);let n=new Go,r=new Ao,i=no(e.body);for await(let e of Wo(i))for(let t of r.decode(e)){let e=n.decode(t);e&&(yield e)}for(let e of r.flush()){let t=n.decode(e);t&&(yield t)}}async function*Wo(e){let t=new Uint8Array;for await(let n of e){if(n==null)continue;let e=n instanceof ArrayBuffer?new Uint8Array(n):typeof n==`string`?To(n):n,r=new Uint8Array(t.length+e.length);r.set(t),r.set(e,t.length),t=r;let i;for(;(i=Mo(t))!==-1;)yield t.slice(0,i),t=t.slice(i)}t.length>0&&(yield t)}var Go=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith(`\r`)&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(`:`))return null;let[t,n,r]=Ko(e,`:`);return r.startsWith(` `)&&(r=r.substring(1)),t===`event`?this.event=r:t===`data`&&this.data.push(r),null}};function Ko(e,t){let n=e.indexOf(t);return n===-1?[e,``,``]:[e.substring(0,n),t,e.substring(n+t.length)]}async function qo(e,t){let{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:a}=t,o=await(async()=>{if(t.options.stream)return zo(e).debug(`response`,n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):Ho.fromSSEResponse(n,t.controller,e);if(n.status===204)return null;if(t.options.__binaryResponse)return n;let r=n.headers.get(`content-type`)?.split(`;`)[0]?.trim();if(r?.includes(`application/json`)||r?.endsWith(`+json`)){let e=await n.json();return Jo(e,n)}return await n.text()})();return zo(e).debug(`[${r}] response parsed`,Bo({retryOfRequestLogID:i,url:n.url,status:n.status,body:o,durationMs:Date.now()-a})),o}function Jo(e,t){return!e||typeof e!=`object`||Array.isArray(e)?e:Object.defineProperty(e,`_request_id`,{value:t.headers.get(`x-request-id`),enumerable:!1})}var Yo,Xo=class e extends Promise{constructor(e,t,n=qo){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,Yo.set(this,void 0),R(this,Yo,e,`f`)}_thenUnwrap(t){return new e(z(this,Yo,`f`),this.responsePromise,async(e,n)=>Jo(t(await this.parseResponse(e,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get(`x-request-id`)}}parse(){return this.parsedPromise||=this.responsePromise.then(e=>this.parseResponse(z(this,Yo,`f`),e)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Yo=new WeakMap;var Zo,Qo=class{constructor(e,t,n,r){Zo.set(this,void 0),R(this,Zo,e,`f`),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new B("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await z(this,Zo,`f`).requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Zo=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},$o=class extends Xo{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await qo(e,t),t.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},es=class extends Qo{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},H=class extends Qo{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...La(this.options.query),after:t}}:null}},ts=class extends Qo{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||``}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...La(this.options.query),after:e}}:null}};const ns=()=>{if(typeof File>`u`){let{process:e}=globalThis,t=typeof e?.versions?.node==`string`&&parseInt(e.versions.node.split(`.`))<20;throw Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":``))}};function rs(e,t,n){return ns(),new File(e,t??`unknown_file`,n)}function ss(e){return(typeof e==`object`&&!!e&&(`name`in e&&e.name&&String(e.name)||`url`in e&&e.url&&String(e.url)||`filename`in e&&e.filename&&String(e.filename)||`path`in e&&e.path&&String(e.path))||``).split(/[\\/]/).pop()||void 0}const cs=e=>typeof e==`object`&&!!e&&typeof e[Symbol.asyncIterator]==`function`,ls=async(e,t)=>gs(e.body)?{...e,body:await ps(e.body,t)}:e,us=async(e,t)=>({...e,body:await ps(e.body,t)});var ds=new WeakMap;function fs(e){let t=typeof e==`function`?e:e.fetch,n=ds.get(t);if(n)return n;let r=(async()=>{try{let e=`Response`in t?t.Response:(await t(`data:,`)).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch{return!0}})();return ds.set(t,r),r}const ps=async(e,t)=>{if(!await fs(t))throw TypeError(`The provided fetch function does not support file uploads with the current global FormData class.`);let n=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>_s(n,e,t))),n};var ms=e=>e instanceof Blob&&`name`in e,hs=e=>typeof e==`object`&&!!e&&(e instanceof Response||cs(e)||ms(e)),gs=e=>{if(hs(e))return!0;if(Array.isArray(e))return e.some(gs);if(e&&typeof e==`object`){for(let t in e)if(gs(e[t]))return!0}return!1},_s=async(e,t,n)=>{if(n!==void 0){if(n==null)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n==`string`||typeof n==`number`||typeof n==`boolean`)e.append(t,String(n));else if(n instanceof Response)e.append(t,rs([await n.blob()],ss(n)));else if(cs(n))e.append(t,rs([await new Response(to(n)).blob()],ss(n)));else if(ms(n))e.append(t,n,ss(n));else if(Array.isArray(n))await Promise.all(n.map(n=>_s(e,t+`[]`,n)));else if(typeof n==`object`)await Promise.all(Object.entries(n).map(([n,r])=>_s(e,`${t}[${n}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},vs=e=>typeof e==`object`&&!!e&&typeof e.size==`number`&&typeof e.type==`string`&&typeof e.text==`function`&&typeof e.slice==`function`&&typeof e.arrayBuffer==`function`,ys=e=>typeof e==`object`&&!!e&&typeof e.name==`string`&&typeof e.lastModified==`number`&&vs(e),bs=e=>typeof e==`object`&&!!e&&typeof e.url==`string`&&typeof e.blob==`function`;async function xs(e,t,n){if(ns(),e=await e,ys(e))return e instanceof File?e:rs([await e.arrayBuffer()],e.name);if(bs(e)){let r=await e.blob();return t||=new URL(e.url).pathname.split(/[\\/]/).pop(),rs(await Ss(r),t,n)}let r=await Ss(e);if(t||=ss(e),!n?.type){let e=r.find(e=>typeof e==`object`&&`type`in e&&e.type);typeof e==`string`&&(n={...n,type:e})}return rs(r,t,n)}async function Ss(e){let t=[];if(typeof e==`string`||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(vs(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(cs(e))for await(let n of e)t.push(...await Ss(n));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:``}${Cs(e)}`)}return t}function Cs(e){return typeof e!=`object`||!e?``:`; props: [${Object.getOwnPropertyNames(e).map(e=>`"${e}"`).join(`, `)}]`}var U=class{constructor(e){this._client=e}};function ws(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Ts=Object.freeze(Object.create(null));const W=((e=ws)=>function(t,...n){if(t.length===1)return t[0];let r=!1,i=[],a=t.reduce((t,a,o)=>{/[?#]/.test(a)&&(r=!0);let s=n[o],c=(r?encodeURIComponent:e)(``+s);return o!==n.length&&(s==null||typeof s==`object`&&s.toString===Object.getPrototypeOf(Object.getPrototypeOf(s.hasOwnProperty??Ts)??Ts)?.toString)&&(c=s+``,i.push({start:t.length+a.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(s).slice(8,-1)} is not a valid path parameter`})),t+a+(o===n.length?``:c)},``),o=a.split(/[?#]/,1)[0],s=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,c;for(;(c=s.exec(o))!==null;)i.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can\'t be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,n)=>{let r=` `.repeat(n.start-e),i=`^`.repeat(n.length);return e=n.start+n.length,t+r+i},``);throw new B(`Path parameters result in path with invalid segments:\n${i.map(e=>e.error).join(`
`)}\n${a}\n${t}`)}return a})(ws);var Es=class extends U{list(e,t={},n){return this._client.getAPIList(W`/chat/completions/${e}/messages`,H,{query:t,...n})}};function Ds(e){return e!==void 0&&`function`in e&&e.function!==void 0}function Os(e){return e?.$brand===`auto-parseable-response-format`}function ks(e){return e?.$brand===`auto-parseable-tool`}function As(e,t){return!t||!Fs(t)?{...e,choices:e.choices.map(e=>(Is(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}:js(e,t)}function js(e,t){let n=e.choices.map(e=>{if(e.finish_reason===`length`)throw new Aa;if(e.finish_reason===`content_filter`)throw new ja;return Is(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>Ns(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?Ms(t,e.message.content):null}}});return{...e,choices:n}}function Ms(e,t){return e.response_format?.type===`json_schema`&&e.response_format?.type===`json_schema`?`$parseRaw`in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function Ns(e,t){let n=e.tools?.find(e=>Ds(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:ks(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}function Ps(e,t){if(!e||!(`tools`in e)||!e.tools)return!1;let n=e.tools?.find(e=>Ds(e)&&e.function?.name===t.function.name);return Ds(n)&&(ks(n)||n?.function.strict||!1)}function Fs(e){return Os(e.response_format)?!0:e.tools?.some(e=>ks(e)||e.type===`function`&&e.function.strict===!0)??!1}function Is(e){for(let t of e||[])if(t.type!==`function`)throw new B(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}function Ls(e){for(let t of e??[]){if(t.type!==`function`)throw new B(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new B(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const Rs=e=>e?.role===`assistant`,zs=e=>e?.role===`tool`;var Bs,Vs,Hs,Us,Ws,Gs,Ks,qs,Js,Ys,Xs,Zs,Qs,$s=class{constructor(){Bs.add(this),this.controller=new AbortController,Vs.set(this,void 0),Hs.set(this,()=>{}),Us.set(this,()=>{}),Ws.set(this,void 0),Gs.set(this,()=>{}),Ks.set(this,()=>{}),qs.set(this,{}),Js.set(this,!1),Ys.set(this,!1),Xs.set(this,!1),Zs.set(this,!1),R(this,Vs,new Promise((e,t)=>{R(this,Hs,e,`f`),R(this,Us,t,`f`)}),`f`),R(this,Ws,new Promise((e,t)=>{R(this,Gs,e,`f`),R(this,Ks,t,`f`)}),`f`),z(this,Vs,`f`).catch(()=>{}),z(this,Ws,`f`).catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit(`end`)},z(this,Bs,`m`,Qs).bind(this))},0)}_connected(){this.ended||(z(this,Hs,`f`).call(this),this._emit(`connect`))}get ended(){return z(this,Js,`f`)}get errored(){return z(this,Ys,`f`)}get aborted(){return z(this,Xs,`f`)}abort(){this.controller.abort()}on(e,t){return(z(this,qs,`f`)[e]||(z(this,qs,`f`)[e]=[])).push({listener:t}),this}off(e,t){let n=z(this,qs,`f`)[e];if(!n)return this;let r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(z(this,qs,`f`)[e]||(z(this,qs,`f`)[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{R(this,Zs,!0,`f`),e!==`error`&&this.once(`error`,n),this.once(e,t)})}async done(){R(this,Zs,!0,`f`),await z(this,Ws,`f`)}_emit(e,...t){if(z(this,Js,`f`))return;e===`end`&&(R(this,Js,!0,`f`),z(this,Gs,`f`).call(this));let n=z(this,qs,`f`)[e];if(n&&(z(this,qs,`f`)[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),e===`abort`){let e=t[0];!z(this,Zs,`f`)&&!n?.length&&Promise.reject(e),z(this,Us,`f`).call(this,e),z(this,Ks,`f`).call(this,e),this._emit(`end`);return}if(e===`error`){let e=t[0];!z(this,Zs,`f`)&&!n?.length&&Promise.reject(e),z(this,Us,`f`).call(this,e),z(this,Ks,`f`).call(this,e),this._emit(`end`)}}_emitFinal(){}};Vs=new WeakMap,Hs=new WeakMap,Us=new WeakMap,Ws=new WeakMap,Gs=new WeakMap,Ks=new WeakMap,qs=new WeakMap,Js=new WeakMap,Ys=new WeakMap,Xs=new WeakMap,Zs=new WeakMap,Bs=new WeakSet,Qs=function(e){if(R(this,Ys,!0,`f`),e instanceof Error&&e.name===`AbortError`&&(e=new ya),e instanceof ya)return R(this,Xs,!0,`f`),this._emit(`abort`,e);if(e instanceof B)return this._emit(`error`,e);if(e instanceof Error){let t=new B(e.message);return t.cause=e,this._emit(`error`,t)}return this._emit(`error`,new B(String(e)))};function ec(e){return typeof e.parse==`function`}var tc,nc,rc,ic,ac,oc,sc,cc,lc=10,uc=class extends $s{constructor(){super(...arguments),tc.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit(`chatCompletion`,e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if(`content`in e||(e.content=null),this.messages.push(e),t){if(this._emit(`message`,e),zs(e)&&e.content)this._emit(`functionToolCallResult`,e.content);else if(Rs(e)&&e.tool_calls)for(let t of e.tool_calls)t.type===`function`&&this._emit(`functionToolCall`,t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new B(`stream ended without producing a ChatCompletion`);return e}async finalContent(){return await this.done(),z(this,tc,`m`,nc).call(this)}async finalMessage(){return await this.done(),z(this,tc,`m`,rc).call(this)}async finalFunctionToolCall(){return await this.done(),z(this,tc,`m`,ic).call(this)}async finalFunctionToolCallResult(){return await this.done(),z(this,tc,`m`,ac).call(this)}async totalUsage(){return await this.done(),z(this,tc,`m`,oc).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit(`finalChatCompletion`,e);let t=z(this,tc,`m`,rc).call(this);t&&this._emit(`finalMessage`,t);let n=z(this,tc,`m`,nc).call(this);n&&this._emit(`finalContent`,n);let r=z(this,tc,`m`,ic).call(this);r&&this._emit(`finalFunctionToolCall`,r);let i=z(this,tc,`m`,ac).call(this);i!=null&&this._emit(`finalFunctionToolCallResult`,i),this._chatCompletions.some(e=>e.usage)&&this._emit(`totalUsage`,z(this,tc,`m`,oc).call(this))}async _createChatCompletion(e,t,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort())),z(this,tc,`m`,sc).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(js(i,t))}async _runChatCompletion(e,t,n){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){let r=`tool`,{tool_choice:i=`auto`,stream:a,...o}=t,s=typeof i!=`string`&&i.type===`function`&&i?.function?.name,{maxChatCompletions:c=lc}=n||{},l=t.tools.map(e=>{if(ks(e)){if(!e.$callback)throw new B("Tool given to `.runTools()` that does not have an associated function");return{type:`function`,function:{function:e.$callback,name:e.function.name,description:e.function.description||``,parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of l)e.type===`function`&&(u[e.function.name||e.function.function.name]=e.function);let d=`tools`in t?l.map(e=>e.type===`function`?{type:`function`,function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){let t=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},n)).choices[0]?.message;if(!t)throw new B(`missing message in ChatCompletion response`);if(!t.tool_calls?.length)return;for(let e of t.tool_calls){if(e.type!==`function`)continue;let t=e.id,{name:n,arguments:i}=e.function,a=u[n];if(a){if(s&&s!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(s)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(`, `)}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let o;try{o=ec(a)?await a.parse(i):i}catch(e){let n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}let c=await a.function(o,this),l=z(this,tc,`m`,cc).call(this,c);if(this._addMessage({role:r,tool_call_id:t,content:l}),s)return}}}};tc=new WeakSet,nc=function(){return z(this,tc,`m`,rc).call(this).content??null},rc=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Rs(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new B(`stream ended without producing a ChatCompletionMessage with role=assistant`)},ic=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Rs(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>e.type===`function`).at(-1)?.function}},ac=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(zs(t)&&t.content!=null&&typeof t.content==`string`&&this.messages.some(e=>e.role===`assistant`&&e.tool_calls?.some(e=>e.type===`function`&&e.id===t.tool_call_id)))return t.content}},oc=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},sc=function(e){if(e.n!=null&&e.n>1)throw new B(`ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.`)},cc=function(e){return typeof e==`string`?e:e===void 0?`undefined`:JSON.stringify(e)};var dc=class e extends uc{static runTools(t,n,r){let i=new e,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`runTools`}};return i._run(()=>i._runTools(t,n,a)),i}_addMessage(e,t=!0){super._addMessage(e,t),Rs(e)&&e.content&&this._emit(`content`,e.content)}},fc=1,pc=2,mc=4,hc=8,gc=16,_c=32,vc=64,yc=128,bc=256,xc=yc|bc,Sc=496,Cc=pc|497,wc=mc|hc,Tc=Cc|wc,Ec={STR:fc,NUM:pc,ARR:mc,OBJ:hc,NULL:gc,BOOL:_c,NAN:vc,INFINITY:yc,MINUS_INFINITY:bc,INF:xc,SPECIAL:Sc,ATOM:Cc,COLLECTION:wc,ALL:Tc},Dc=class extends Error{},Oc=class extends Error{};function kc(e,t=Ec.ALL){if(typeof e!=`string`)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return Ac(e.trim(),t)}var Ac=(e,t)=>{let n=e.length,r=0,i=e=>{throw new Dc(`${e} at position ${r}`)},a=e=>{throw new Oc(`${e} at position ${r}`)},o=()=>(d(),r>=n&&i(`Unexpected end of input`),e[r]===`"`?s():e[r]===`{`?c():e[r]===`[`?l():e.substring(r,r+4)===`null`||Ec.NULL&t&&n-r<4&&`null`.startsWith(e.substring(r))?(r+=4,null):e.substring(r,r+4)===`true`||Ec.BOOL&t&&n-r<4&&`true`.startsWith(e.substring(r))?(r+=4,!0):e.substring(r,r+5)===`false`||Ec.BOOL&t&&n-r<5&&`false`.startsWith(e.substring(r))?(r+=5,!1):e.substring(r,r+8)===`Infinity`||Ec.INFINITY&t&&n-r<8&&`Infinity`.startsWith(e.substring(r))?(r+=8,1/0):e.substring(r,r+9)===`-Infinity`||Ec.MINUS_INFINITY&t&&1<n-r&&n-r<9&&`-Infinity`.startsWith(e.substring(r))?(r+=9,-1/0):e.substring(r,r+3)===`NaN`||Ec.NAN&t&&n-r<3&&`NaN`.startsWith(e.substring(r))?(r+=3,NaN):u()),s=()=>{let o=r,s=!1;for(r++;r<n&&(e[r]!==`"`||s&&e[r-1]===`\\`);)s=e[r]===`\\`?!s:!1,r++;if(e.charAt(r)==`"`)try{return JSON.parse(e.substring(o,++r-Number(s)))}catch(e){a(String(e))}else if(Ec.STR&t)try{return JSON.parse(e.substring(o,r-Number(s))+`"`)}catch{return JSON.parse(e.substring(o,e.lastIndexOf(`\\`))+`"`)}i(`Unterminated string literal`)},c=()=>{r++,d();let a={};try{for(;e[r]!==`}`;){if(d(),r>=n&&Ec.OBJ&t)return a;let i=s();d(),r++;try{let e=o();Object.defineProperty(a,i,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(Ec.OBJ&t)return a;throw e}d(),e[r]===`,`&&r++}}catch{if(Ec.OBJ&t)return a;i(`Expected '}' at end of object`)}return r++,a},l=()=>{r++;let n=[];try{for(;e[r]!==`]`;)n.push(o()),d(),e[r]===`,`&&r++}catch{if(Ec.ARR&t)return n;i(`Expected ']' at end of array`)}return r++,n},u=()=>{if(r===0){e===`-`&&Ec.NUM&t&&i(`Not sure what '-' is`);try{return JSON.parse(e)}catch(n){if(Ec.NUM&t)try{return e[e.length-1]===`.`?JSON.parse(e.substring(0,e.lastIndexOf(`.`))):JSON.parse(e.substring(0,e.lastIndexOf(`e`)))}catch{}a(String(n))}}let o=r;for(e[r]===`-`&&r++;e[r]&&!`,]}`.includes(e[r]);)r++;r==n&&!(Ec.NUM&t)&&i(`Unterminated number literal`);try{return JSON.parse(e.substring(o,r))}catch{e.substring(o,r)===`-`&&Ec.NUM&t&&i(`Not sure what '-' is`);try{return JSON.parse(e.substring(o,e.lastIndexOf(`e`)))}catch(e){a(String(e))}}},d=()=>{for(;r<n&&` 
\r	`.includes(e[r]);)r++};return o()},jc=e=>kc(e,Ec.ALL^Ec.NUM),G,Mc,Nc,Pc,Fc,Ic,Lc,Rc,zc,Bc,Vc,Hc,Uc=class e extends uc{constructor(e){super(),G.add(this),Mc.set(this,void 0),Nc.set(this,void 0),Pc.set(this,void 0),R(this,Mc,e,`f`),R(this,Nc,[],`f`)}get currentChatCompletionSnapshot(){return z(this,Pc,`f`)}static fromReadableStream(t){let n=new e(null);return n._run(()=>n._fromReadableStream(t)),n}static createChatCompletion(t,n,r){let i=new e(n);return i._run(()=>i._runChatCompletion(t,{...n,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createChatCompletion(e,t,n){super._createChatCompletion;let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort())),z(this,G,`m`,Fc).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let e of i)z(this,G,`m`,Lc).call(this,e);if(i.controller.signal?.aborted)throw new ya;return this._addChatCompletion(z(this,G,`m`,Bc).call(this))}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener(`abort`,()=>this.controller.abort())),z(this,G,`m`,Fc).call(this),this._connected();let r=Ho.fromReadableStream(e,this.controller),i;for await(let e of r)i&&i!==e.id&&this._addChatCompletion(z(this,G,`m`,Bc).call(this)),z(this,G,`m`,Lc).call(this,e),i=e.id;if(r.controller.signal?.aborted)throw new ya;return this._addChatCompletion(z(this,G,`m`,Bc).call(this))}[(Mc=new WeakMap,Nc=new WeakMap,Pc=new WeakMap,G=new WeakSet,Fc=function(){this.ended||R(this,Pc,void 0,`f`)},Ic=function(e){let t=z(this,Nc,`f`)[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},z(this,Nc,`f`)[e.index]=t,t)},Lc=function(e){if(this.ended)return;let t=z(this,G,`m`,Hc).call(this,e);this._emit(`chunk`,e,t);for(let n of e.choices){let e=t.choices[n.index];n.delta.content!=null&&e.message?.role===`assistant`&&e.message?.content&&(this._emit(`content`,n.delta.content,e.message.content),this._emit(`content.delta`,{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),n.delta.refusal!=null&&e.message?.role===`assistant`&&e.message?.refusal&&this._emit(`refusal.delta`,{delta:n.delta.refusal,snapshot:e.message.refusal}),n.logprobs?.content!=null&&e.message?.role===`assistant`&&this._emit(`logprobs.content.delta`,{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),n.logprobs?.refusal!=null&&e.message?.role===`assistant`&&this._emit(`logprobs.refusal.delta`,{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let r=z(this,G,`m`,Ic).call(this,e);e.finish_reason&&(z(this,G,`m`,zc).call(this,e),r.current_tool_call_index!=null&&z(this,G,`m`,Rc).call(this,e,r.current_tool_call_index));for(let t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(z(this,G,`m`,zc).call(this,e),r.current_tool_call_index!=null&&z(this,G,`m`,Rc).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(let t of n.delta.tool_calls??[]){let n=e.message.tool_calls?.[t.index];n?.type&&(n?.type===`function`?this._emit(`tool_calls.function.arguments.delta`,{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??``}):n?.type)}}},Rc=function(e,t){if(z(this,G,`m`,Ic).call(this,e).done_tool_calls.has(t))return;let n=e.message.tool_calls?.[t];if(!n)throw Error(`no tool call snapshot`);if(!n.type)throw Error("tool call snapshot missing `type`");if(n.type===`function`){let e=z(this,Mc,`f`)?.tools?.find(e=>Ds(e)&&e.function.name===n.function.name);this._emit(`tool_calls.function.arguments.done`,{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:ks(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},zc=function(e){let t=z(this,G,`m`,Ic).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let n=z(this,G,`m`,Vc).call(this);this._emit(`content.done`,{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit(`refusal.done`,{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit(`logprobs.content.done`,{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit(`logprobs.refusal.done`,{refusal:e.logprobs.refusal}))},Bc=function(){if(this.ended)throw new B(`stream has ended, this shouldn't happen`);let e=z(this,Pc,`f`);if(!e)throw new B(`request ended without sending any chunks`);return R(this,Pc,void 0,`f`),R(this,Nc,[],`f`),Wc(e,z(this,Mc,`f`))},Vc=function(){let e=z(this,Mc,`f`)?.response_format;return Os(e)?e:null},Hc=function(e){var t,n,r,i;let a=z(this,Pc,`f`),{choices:o,...s}=e;a?Object.assign(a,s):a=R(this,Pc,{...s,choices:[]},`f`);for(let{delta:o,finish_reason:s,index:c,logprobs:l=null,...u}of e.choices){let e=a.choices[c];if(e||=a.choices[c]={finish_reason:s,index:c,message:{},logprobs:l,...u},l)if(!e.logprobs)e.logprobs=Object.assign({},l);else{let{content:r,refusal:i,...a}=l;Object.assign(e.logprobs,a),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),i&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...i))}if(s&&(e.finish_reason=s,z(this,Mc,`f`)&&Fs(z(this,Mc,`f`)))){if(s===`length`)throw new Aa;if(s===`content_filter`)throw new ja}if(Object.assign(e,u),!o)continue;let{content:d,refusal:f,function_call:p,role:m,tool_calls:h,...g}=o;if(Object.assign(e.message,g),f&&(e.message.refusal=(e.message.refusal||``)+f),m&&(e.message.role=m),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((r=e.message.function_call).arguments??(r.arguments=``),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),d&&(e.message.content=(e.message.content||``)+d,!e.message.refusal&&z(this,G,`m`,Vc).call(this)&&(e.message.parsed=jc(e.message.content))),h){e.message.tool_calls||(e.message.tool_calls=[]);for(let{index:t,id:n,type:r,function:a,...o}of h){let s=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(s,o),n&&(s.id=n),r&&(s.type=r),a&&(s.function??={name:a.name??``,arguments:``}),a?.name&&(s.function.name=a.name),a?.arguments&&(s.function.arguments+=a.arguments,Ps(z(this,Mc,`f`),s)&&(s.function.parsed_arguments=jc(s.function.arguments)))}}}return a},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`chunk`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ho(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Wc(e,t){let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...s}=e,c={...s,id:n,choices:r.map(({message:t,finish_reason:n,index:r,logprobs:i,...a})=>{if(!n)throw new B(`missing finish_reason for choice ${r}`);let{content:o=null,function_call:s,tool_calls:c,...l}=t,u=t.role;if(!u)throw new B(`missing role for choice ${r}`);if(s){let{arguments:e,name:c}=s;if(e==null)throw new B(`missing function_call.arguments for choice ${r}`);if(!c)throw new B(`missing function_call.name for choice ${r}`);return{...a,message:{content:o,function_call:{arguments:e,name:c},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}return c?{...a,index:r,finish_reason:n,logprobs:i,message:{...l,role:u,content:o,refusal:t.refusal??null,tool_calls:c.map((t,n)=>{let{function:i,type:a,id:o,...s}=t,{arguments:c,name:l,...u}=i||{};if(o==null)throw new B(`missing choices[${r}].tool_calls[${n}].id\n${Gc(e)}`);if(a==null)throw new B(`missing choices[${r}].tool_calls[${n}].type\n${Gc(e)}`);if(l==null)throw new B(`missing choices[${r}].tool_calls[${n}].function.name\n${Gc(e)}`);if(c==null)throw new B(`missing choices[${r}].tool_calls[${n}].function.arguments\n${Gc(e)}`);return{...s,id:o,type:a,function:{...u,name:l,arguments:c}}})}}:{...a,message:{...l,content:o,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}),created:i,model:a,object:`chat.completion`,...o?{system_fingerprint:o}:{}};return As(c,t)}function Gc(e){return JSON.stringify(e)}var Kc=class e extends Uc{static fromReadableStream(t){let n=new e(null);return n._run(()=>n._fromReadableStream(t)),n}static runTools(t,n,r){let i=new e(n),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`runTools`}};return i._run(()=>i._runTools(t,n,a)),i}},qc=class extends U{constructor(){super(...arguments),this.messages=new Es(this._client)}create(e,t){return this._client.post(`/chat/completions`,{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(W`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(W`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList(`/chat/completions`,H,{query:e,...t})}delete(e,t){return this._client.delete(W`/chat/completions/${e}`,t)}parse(e,t){return Ls(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":`chat.completions.parse`}})._thenUnwrap(t=>js(t,e))}runTools(e,t){return e.stream?Kc.runTools(this._client,e,t):dc.runTools(this._client,e,t)}stream(e,t){return Uc.createChatCompletion(this._client,e,t)}};qc.Messages=Es;var Jc=class extends U{constructor(){super(...arguments),this.completions=new qc(this._client)}};Jc.Completions=qc;var Yc=Symbol(`brand.privateNullableHeaders`);function*Xc(e){if(!e)return;if(Yc in e){let{values:t,nulls:n}=e;yield*t.entries();for(let e of n)yield[e,null];return}let t=!1,n;e instanceof Headers?n=e.entries():Ia(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let e of n){let n=e[0];if(typeof n!=`string`)throw TypeError(`expected header name to be a string`);let r=Ia(e[1])?e[1]:[e[1]],i=!1;for(let e of r)e!==void 0&&(t&&!i&&(i=!0,yield[n,null]),yield[n,e])}}const K=e=>{let t=new Headers,n=new Set;for(let r of e){let e=new Set;for(let[i,a]of Xc(r)){let r=i.toLowerCase();e.has(r)||(t.delete(i),e.add(r)),a===null?(t.delete(i),n.add(r)):(t.append(i,a),n.delete(r))}}return{[Yc]:!0,values:t,nulls:n}};var Zc=class extends U{create(e,t){return this._client.post(`/audio/speech`,{body:e,...t,headers:K([{Accept:`application/octet-stream`},t?.headers]),__binaryResponse:!0})}},Qc=class extends U{create(e,t){return this._client.post(`/audio/transcriptions`,us({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}},$c=class extends U{create(e,t){return this._client.post(`/audio/translations`,us({body:e,...t,__metadata:{model:e.model}},this._client))}},el=class extends U{constructor(){super(...arguments),this.transcriptions=new Qc(this._client),this.translations=new $c(this._client),this.speech=new Zc(this._client)}};el.Transcriptions=Qc,el.Translations=$c,el.Speech=Zc;var tl=class extends U{create(e,t){return this._client.post(`/batches`,{body:e,...t})}retrieve(e,t){return this._client.get(W`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList(`/batches`,H,{query:e,...t})}cancel(e,t){return this._client.post(W`/batches/${e}/cancel`,t)}},nl=class extends U{create(e,t){return this._client.post(`/assistants`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(W`/assistants/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(W`/assistants/${e}`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e={},t){return this._client.getAPIList(`/assistants`,H,{query:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}delete(e,t){return this._client.delete(W`/assistants/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},rl=class extends U{create(e,t){return this._client.post(`/realtime/sessions`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},il=class extends U{create(e,t){return this._client.post(`/realtime/transcription_sessions`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},al=class extends U{constructor(){super(...arguments),this.sessions=new rl(this._client),this.transcriptionSessions=new il(this._client)}};al.Sessions=rl,al.TranscriptionSessions=il;var ol=class extends U{create(e,t){return this._client.post(`/chatkit/sessions`,{body:e,...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}cancel(e,t){return this._client.post(W`/chatkit/sessions/${e}/cancel`,{...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}},sl=class extends U{retrieve(e,t){return this._client.get(W`/chatkit/threads/${e}`,{...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}list(e={},t){return this._client.getAPIList(`/chatkit/threads`,ts,{query:e,...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}delete(e,t){return this._client.delete(W`/chatkit/threads/${e}`,{...t,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}listItems(e,t={},n){return this._client.getAPIList(W`/chatkit/threads/${e}/items`,ts,{query:t,...n,headers:K([{"OpenAI-Beta":`chatkit_beta=v1`},n?.headers])})}},cl=class extends U{constructor(){super(...arguments),this.sessions=new ol(this._client),this.threads=new sl(this._client)}};cl.Sessions=ol,cl.Threads=sl;var ll=class extends U{create(e,t,n){return this._client.post(W`/threads/${e}/messages`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{thread_id:r}=t;return this._client.get(W`/threads/${r}/messages/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{thread_id:r,...i}=t;return this._client.post(W`/threads/${r}/messages/${e}`,{body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(W`/threads/${e}/messages`,H,{query:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t,n){let{thread_id:r}=t;return this._client.delete(W`/threads/${r}/messages/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}},ul=class extends U{retrieve(e,t,n){let{thread_id:r,run_id:i,...a}=t;return this._client.get(W`/threads/${r}/runs/${i}/steps/${e}`,{query:a,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t,n){let{thread_id:r,...i}=t;return this._client.getAPIList(W`/threads/${r}/runs/${e}/steps`,H,{query:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}};const dl=e=>{if(typeof Buffer<`u`){let t=Buffer.from(e,`base64`);return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{let t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}},fl=e=>{if(globalThis.process!==void 0)return{}?.[e]?.trim()??void 0;if(globalThis.Deno!==void 0)return globalThis.Deno.env?.get?.(e)?.trim()};var pl,ml,hl,gl,_l,vl,yl,bl,xl,Sl,Cl,wl,Tl,El,Dl,Ol,kl,Al,jl,Ml,Nl,Pl,Fl,Il=class extends $s{constructor(){super(...arguments),pl.add(this),hl.set(this,[]),gl.set(this,{}),_l.set(this,{}),vl.set(this,void 0),yl.set(this,void 0),bl.set(this,void 0),xl.set(this,void 0),Sl.set(this,void 0),Cl.set(this,void 0),wl.set(this,void 0),Tl.set(this,void 0),El.set(this,void 0)}[(hl=new WeakMap,gl=new WeakMap,_l=new WeakMap,vl=new WeakMap,yl=new WeakMap,bl=new WeakMap,xl=new WeakMap,Sl=new WeakMap,Cl=new WeakMap,wl=new WeakMap,Tl=new WeakMap,El=new WeakMap,pl=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`event`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new ml;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener(`abort`,()=>this.controller.abort())),this._connected();let r=Ho.fromReadableStream(e,this.controller);for await(let e of r)z(this,pl,`m`,Dl).call(this,e);if(r.controller.signal?.aborted)throw new ya;return this._addRun(z(this,pl,`m`,Ol).call(this))}toReadableStream(){return new Ho(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){let i=new ml;return i._run(()=>i._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createToolAssistantStream(e,t,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener(`abort`,()=>this.controller.abort()));let a={...n,stream:!0},o=await e.submitToolOutputs(t,a,{...r,signal:this.controller.signal});this._connected();for await(let e of o)z(this,pl,`m`,Dl).call(this,e);if(o.controller.signal?.aborted)throw new ya;return this._addRun(z(this,pl,`m`,Ol).call(this))}static createThreadAssistantStream(e,t,n){let r=new ml;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":`stream`}})),r}static createAssistantStream(e,t,n,r){let i=new ml;return i._run(()=>i._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}currentEvent(){return z(this,wl,`f`)}currentRun(){return z(this,Tl,`f`)}currentMessageSnapshot(){return z(this,vl,`f`)}currentRunStepSnapshot(){return z(this,El,`f`)}async finalRunSteps(){return await this.done(),Object.values(z(this,gl,`f`))}async finalMessages(){return await this.done(),Object.values(z(this,_l,`f`))}async finalRun(){if(await this.done(),!z(this,yl,`f`))throw Error(`Final run was not received.`);return z(this,yl,`f`)}async _createThreadAssistantStream(e,t,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let e of a)z(this,pl,`m`,Dl).call(this,e);if(a.controller.signal?.aborted)throw new ya;return this._addRun(z(this,pl,`m`,Ol).call(this))}async _createAssistantStream(e,t,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener(`abort`,()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(let e of o)z(this,pl,`m`,Dl).call(this,e);if(o.controller.signal?.aborted)throw new ya;return this._addRun(z(this,pl,`m`,Ol).call(this))}static accumulateDelta(e,t){for(let[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(t==null){e[n]=r;continue}if(n===`index`||n===`type`){e[n]=r;continue}if(typeof t==`string`&&typeof r==`string`)t+=r;else if(typeof t==`number`&&typeof r==`number`)t+=r;else if(Ba(t)&&Ba(r))t=this.accumulateDelta(t,r);else if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>typeof e==`string`||typeof e==`number`)){t.push(...r);continue}for(let e of r){if(!Ba(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let n=e.index;if(n==null)throw console.error(e),Error("Expected array delta entry to have an `index` property");if(typeof n!=`number`)throw Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);let r=t[n];r==null?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`);e[n]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}};ml=Il,Dl=function(e){if(!this.ended)switch(R(this,wl,e,`f`),z(this,pl,`m`,jl).call(this,e),e.event){case`thread.created`:break;case`thread.run.created`:case`thread.run.queued`:case`thread.run.in_progress`:case`thread.run.requires_action`:case`thread.run.completed`:case`thread.run.incomplete`:case`thread.run.failed`:case`thread.run.cancelling`:case`thread.run.cancelled`:case`thread.run.expired`:z(this,pl,`m`,Fl).call(this,e);break;case`thread.run.step.created`:case`thread.run.step.in_progress`:case`thread.run.step.delta`:case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:z(this,pl,`m`,Al).call(this,e);break;case`thread.message.created`:case`thread.message.in_progress`:case`thread.message.delta`:case`thread.message.completed`:case`thread.message.incomplete`:z(this,pl,`m`,kl).call(this,e);break;case`error`:throw Error(`Encountered an error event in event processing - errors should be processed earlier`);default:}},Ol=function(){if(this.ended)throw new B(`stream has ended, this shouldn't happen`);if(!z(this,yl,`f`))throw Error(`Final run has not been received`);return z(this,yl,`f`)},kl=function(e){let[t,n]=z(this,pl,`m`,Nl).call(this,e,z(this,vl,`f`));R(this,vl,t,`f`),z(this,_l,`f`)[t.id]=t;for(let e of n){let n=t.content[e.index];n?.type==`text`&&this._emit(`textCreated`,n.text)}switch(e.event){case`thread.message.created`:this._emit(`messageCreated`,e.data);break;case`thread.message.in_progress`:break;case`thread.message.delta`:if(this._emit(`messageDelta`,e.data.delta,t),e.data.delta.content)for(let n of e.data.delta.content){if(n.type==`text`&&n.text){let e=n.text,r=t.content[n.index];if(r&&r.type==`text`)this._emit(`textDelta`,e,r.text);else throw Error(`The snapshot associated with this text delta is not text or missing`)}if(n.index!=z(this,bl,`f`)){if(z(this,xl,`f`))switch(z(this,xl,`f`).type){case`text`:this._emit(`textDone`,z(this,xl,`f`).text,z(this,vl,`f`));break;case`image_file`:this._emit(`imageFileDone`,z(this,xl,`f`).image_file,z(this,vl,`f`));break}R(this,bl,n.index,`f`)}R(this,xl,t.content[n.index],`f`)}break;case`thread.message.completed`:case`thread.message.incomplete`:if(z(this,bl,`f`)!==void 0){let t=e.data.content[z(this,bl,`f`)];if(t)switch(t.type){case`image_file`:this._emit(`imageFileDone`,t.image_file,z(this,vl,`f`));break;case`text`:this._emit(`textDone`,t.text,z(this,vl,`f`));break}}z(this,vl,`f`)&&this._emit(`messageDone`,e.data),R(this,vl,void 0,`f`)}},Al=function(e){let t=z(this,pl,`m`,Ml).call(this,e);switch(R(this,El,t,`f`),e.event){case`thread.run.step.created`:this._emit(`runStepCreated`,e.data);break;case`thread.run.step.delta`:let n=e.data.delta;if(n.step_details&&n.step_details.type==`tool_calls`&&n.step_details.tool_calls&&t.step_details.type==`tool_calls`)for(let e of n.step_details.tool_calls)e.index==z(this,Sl,`f`)?this._emit(`toolCallDelta`,e,t.step_details.tool_calls[e.index]):(z(this,Cl,`f`)&&this._emit(`toolCallDone`,z(this,Cl,`f`)),R(this,Sl,e.index,`f`),R(this,Cl,t.step_details.tool_calls[e.index],`f`),z(this,Cl,`f`)&&this._emit(`toolCallCreated`,z(this,Cl,`f`)));this._emit(`runStepDelta`,e.data.delta,t);break;case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:R(this,El,void 0,`f`),e.data.step_details.type==`tool_calls`&&z(this,Cl,`f`)&&(this._emit(`toolCallDone`,z(this,Cl,`f`)),R(this,Cl,void 0,`f`)),this._emit(`runStepDone`,e.data,t);break;case`thread.run.step.in_progress`:break}},jl=function(e){z(this,hl,`f`).push(e),this._emit(`event`,e)},Ml=function(e){switch(e.event){case`thread.run.step.created`:return z(this,gl,`f`)[e.data.id]=e.data,e.data;case`thread.run.step.delta`:let t=z(this,gl,`f`)[e.data.id];if(!t)throw Error(`Received a RunStepDelta before creation of a snapshot`);let n=e.data;if(n.delta){let r=ml.accumulateDelta(t,n.delta);z(this,gl,`f`)[e.data.id]=r}return z(this,gl,`f`)[e.data.id];case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:case`thread.run.step.in_progress`:z(this,gl,`f`)[e.data.id]=e.data;break}if(z(this,gl,`f`)[e.data.id])return z(this,gl,`f`)[e.data.id];throw Error(`No snapshot available`)},Nl=function(e,t){let n=[];switch(e.event){case`thread.message.created`:return[e.data,n];case`thread.message.delta`:if(!t)throw Error(`Received a delta with no existing snapshot (there should be one from message creation)`);let r=e.data;if(r.delta.content)for(let e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=z(this,pl,`m`,Pl).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case`thread.message.in_progress`:case`thread.message.completed`:case`thread.message.incomplete`:if(t)return[t,n];throw Error(`Received thread message event with no existing snapshot`)}throw Error(`Tried to accumulate a non-message event`)},Pl=function(e,t){return ml.accumulateDelta(t,e)},Fl=function(e){switch(R(this,Tl,e.data,`f`),e.event){case`thread.run.created`:break;case`thread.run.queued`:break;case`thread.run.in_progress`:break;case`thread.run.requires_action`:case`thread.run.cancelled`:case`thread.run.failed`:case`thread.run.completed`:case`thread.run.expired`:case`thread.run.incomplete`:R(this,yl,e.data,`f`),z(this,Cl,`f`)&&(this._emit(`toolCallDone`,z(this,Cl,`f`)),R(this,Cl,void 0,`f`));break;case`thread.run.cancelling`:break}};var Ll=class extends U{constructor(){super(...arguments),this.steps=new ul(this._client)}create(e,t,n){let{include:r,...i}=t;return this._client.post(W`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){let{thread_id:r}=t;return this._client.get(W`/threads/${r}/runs/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{thread_id:r,...i}=t;return this._client.post(W`/threads/${r}/runs/${e}`,{body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(W`/threads/${e}/runs`,H,{query:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}cancel(e,t,n){let{thread_id:r}=t;return this._client.post(W`/threads/${r}/runs/${e}/cancel`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return Il.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let r=K([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(i.status){case`queued`:case`in_progress`:case`cancelling`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=a.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await Ua(e);break;case`requires_action`:case`incomplete`:case`cancelled`:case`completed`:case`failed`:case`expired`:return i}}}stream(e,t,n){return Il.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){let{thread_id:r,...i}=t;return this._client.post(W`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){let r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return Il.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};Ll.Steps=ul;var Rl=class extends U{constructor(){super(...arguments),this.runs=new Ll(this._client),this.messages=new ll(this._client)}create(e={},t){return this._client.post(`/threads`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(W`/threads/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(W`/threads/${e}`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t){return this._client.delete(W`/threads/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}createAndRun(e,t){return this._client.post(`/threads/runs`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return Il.createThreadAssistantStream(e,this._client.beta.threads,t)}};Rl.Runs=Ll,Rl.Messages=ll;var zl=class extends U{constructor(){super(...arguments),this.realtime=new al(this._client),this.chatkit=new cl(this._client),this.assistants=new nl(this._client),this.threads=new Rl(this._client)}};zl.Realtime=al,zl.ChatKit=cl,zl.Assistants=nl,zl.Threads=Rl;var Bl=class extends U{create(e,t){return this._client.post(`/completions`,{body:e,...t,stream:e.stream??!1})}},Vl=class extends U{retrieve(e,t,n){let{container_id:r}=t;return this._client.get(W`/containers/${r}/files/${e}/content`,{...n,headers:K([{Accept:`application/binary`},n?.headers]),__binaryResponse:!0})}},Hl=class extends U{constructor(){super(...arguments),this.content=new Vl(this._client)}create(e,t,n){return this._client.post(W`/containers/${e}/files`,us({body:t,...n},this._client))}retrieve(e,t,n){let{container_id:r}=t;return this._client.get(W`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(W`/containers/${e}/files`,H,{query:t,...n})}delete(e,t,n){let{container_id:r}=t;return this._client.delete(W`/containers/${r}/files/${e}`,{...n,headers:K([{Accept:`*/*`},n?.headers])})}};Hl.Content=Vl;var Ul=class extends U{constructor(){super(...arguments),this.files=new Hl(this._client)}create(e,t){return this._client.post(`/containers`,{body:e,...t})}retrieve(e,t){return this._client.get(W`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList(`/containers`,H,{query:e,...t})}delete(e,t){return this._client.delete(W`/containers/${e}`,{...t,headers:K([{Accept:`*/*`},t?.headers])})}};Ul.Files=Hl;var Wl=class extends U{create(e,t,n){let{include:r,...i}=t;return this._client.post(W`/conversations/${e}/items`,{query:{include:r},body:i,...n})}retrieve(e,t,n){let{conversation_id:r,...i}=t;return this._client.get(W`/conversations/${r}/items/${e}`,{query:i,...n})}list(e,t={},n){return this._client.getAPIList(W`/conversations/${e}/items`,ts,{query:t,...n})}delete(e,t,n){let{conversation_id:r}=t;return this._client.delete(W`/conversations/${r}/items/${e}`,n)}},Gl=class extends U{constructor(){super(...arguments),this.items=new Wl(this._client)}create(e={},t){return this._client.post(`/conversations`,{body:e,...t})}retrieve(e,t){return this._client.get(W`/conversations/${e}`,t)}update(e,t,n){return this._client.post(W`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(W`/conversations/${e}`,t)}};Gl.Items=Wl;var Kl=class extends U{create(e,t){let n=!!e.encoding_format,r=n?e.encoding_format:`base64`;n&&zo(this._client).debug(`embeddings/user defined encoding_format:`,e.encoding_format);let i=this._client.post(`/embeddings`,{body:{...e,encoding_format:r},...t});return n?i:(zo(this._client).debug(`embeddings/decoding base64 embeddings from base64`),i._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=dl(t)}),e)))}},ql=class extends U{retrieve(e,t,n){let{eval_id:r,run_id:i}=t;return this._client.get(W`/evals/${r}/runs/${i}/output_items/${e}`,n)}list(e,t,n){let{eval_id:r,...i}=t;return this._client.getAPIList(W`/evals/${r}/runs/${e}/output_items`,H,{query:i,...n})}},Jl=class extends U{constructor(){super(...arguments),this.outputItems=new ql(this._client)}create(e,t,n){return this._client.post(W`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){let{eval_id:r}=t;return this._client.get(W`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(W`/evals/${e}/runs`,H,{query:t,...n})}delete(e,t,n){let{eval_id:r}=t;return this._client.delete(W`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){let{eval_id:r}=t;return this._client.post(W`/evals/${r}/runs/${e}`,n)}};Jl.OutputItems=ql;var Yl=class extends U{constructor(){super(...arguments),this.runs=new Jl(this._client)}create(e,t){return this._client.post(`/evals`,{body:e,...t})}retrieve(e,t){return this._client.get(W`/evals/${e}`,t)}update(e,t,n){return this._client.post(W`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList(`/evals`,H,{query:e,...t})}delete(e,t){return this._client.delete(W`/evals/${e}`,t)}};Yl.Runs=Jl;var Xl=class extends U{create(e,t){return this._client.post(`/files`,us({body:e,...t},this._client))}retrieve(e,t){return this._client.get(W`/files/${e}`,t)}list(e={},t){return this._client.getAPIList(`/files`,H,{query:e,...t})}delete(e,t){return this._client.delete(W`/files/${e}`,t)}content(e,t){return this._client.get(W`/files/${e}/content`,{...t,headers:K([{Accept:`application/binary`},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){let r=new Set([`processed`,`error`,`deleted`]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await Ua(t),a=await this.retrieve(e),Date.now()-i>n)throw new xa({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}},Zl=class extends U{},Ql=class extends U{run(e,t){return this._client.post(`/fine_tuning/alpha/graders/run`,{body:e,...t})}validate(e,t){return this._client.post(`/fine_tuning/alpha/graders/validate`,{body:e,...t})}},$l=class extends U{constructor(){super(...arguments),this.graders=new Ql(this._client)}};$l.Graders=Ql;var eu=class extends U{create(e,t,n){return this._client.getAPIList(W`/fine_tuning/checkpoints/${e}/permissions`,es,{body:t,method:`post`,...n})}retrieve(e,t={},n){return this._client.get(W`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){let{fine_tuned_model_checkpoint:r}=t;return this._client.delete(W`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}},tu=class extends U{constructor(){super(...arguments),this.permissions=new eu(this._client)}};tu.Permissions=eu;var nu=class extends U{list(e,t={},n){return this._client.getAPIList(W`/fine_tuning/jobs/${e}/checkpoints`,H,{query:t,...n})}},ru=class extends U{constructor(){super(...arguments),this.checkpoints=new nu(this._client)}create(e,t){return this._client.post(`/fine_tuning/jobs`,{body:e,...t})}retrieve(e,t){return this._client.get(W`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList(`/fine_tuning/jobs`,H,{query:e,...t})}cancel(e,t){return this._client.post(W`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(W`/fine_tuning/jobs/${e}/events`,H,{query:t,...n})}pause(e,t){return this._client.post(W`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(W`/fine_tuning/jobs/${e}/resume`,t)}};ru.Checkpoints=nu;var iu=class extends U{constructor(){super(...arguments),this.methods=new Zl(this._client),this.jobs=new ru(this._client),this.checkpoints=new tu(this._client),this.alpha=new $l(this._client)}};iu.Methods=Zl,iu.Jobs=ru,iu.Checkpoints=tu,iu.Alpha=$l;var au=class extends U{},ou=class extends U{constructor(){super(...arguments),this.graderModels=new au(this._client)}};ou.GraderModels=au;var su=class extends U{createVariation(e,t){return this._client.post(`/images/variations`,us({body:e,...t},this._client))}edit(e,t){return this._client.post(`/images/edits`,us({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post(`/images/generations`,{body:e,...t,stream:e.stream??!1})}},cu=class extends U{retrieve(e,t){return this._client.get(W`/models/${e}`,t)}list(e){return this._client.getAPIList(`/models`,es,e)}delete(e,t){return this._client.delete(W`/models/${e}`,t)}},lu=class extends U{create(e,t){return this._client.post(`/moderations`,{body:e,...t})}},uu=class extends U{accept(e,t,n){return this._client.post(W`/realtime/calls/${e}/accept`,{body:t,...n,headers:K([{Accept:`*/*`},n?.headers])})}hangup(e,t){return this._client.post(W`/realtime/calls/${e}/hangup`,{...t,headers:K([{Accept:`*/*`},t?.headers])})}refer(e,t,n){return this._client.post(W`/realtime/calls/${e}/refer`,{body:t,...n,headers:K([{Accept:`*/*`},n?.headers])})}reject(e,t={},n){return this._client.post(W`/realtime/calls/${e}/reject`,{body:t,...n,headers:K([{Accept:`*/*`},n?.headers])})}},du=class extends U{create(e,t){return this._client.post(`/realtime/client_secrets`,{body:e,...t})}},fu=class extends U{constructor(){super(...arguments),this.clientSecrets=new du(this._client),this.calls=new uu(this._client)}};fu.ClientSecrets=du,fu.Calls=uu;function pu(e,t){return!t||!gu(t)?{...e,output_parsed:null,output:e.output.map(e=>e.type===`function_call`?{...e,parsed_arguments:null}:e.type===`message`?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}:mu(e,t)}function mu(e,t){let n=e.output.map(e=>{if(e.type===`function_call`)return{...e,parsed_arguments:yu(t,e)};if(e.type===`message`){let n=e.content.map(e=>e.type===`output_text`?{...e,parsed:hu(t,e.text)}:e);return{...e,content:n}}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,`output_text`)||bu(r),Object.defineProperty(r,`output_parsed`,{enumerable:!0,get(){for(let e of r.output)if(e.type===`message`){for(let t of e.content)if(t.type===`output_text`&&t.parsed!==null)return t.parsed}return null}}),r}function hu(e,t){return e.text?.format?.type===`json_schema`?`$parseRaw`in e.text?.format?(e.text?.format).$parseRaw(t):JSON.parse(t):null}function gu(e){return!!Os(e.text?.format)}function _u(e){return e?.$brand===`auto-parseable-tool`}function vu(e,t){return e.find(e=>e.type===`function`&&e.name===t)}function yu(e,t){let n=vu(e.tools??[],t.name);return{...t,...t,parsed_arguments:_u(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function bu(e){let t=[];for(let n of e.output)if(n.type===`message`)for(let e of n.content)e.type===`output_text`&&t.push(e.text);e.output_text=t.join(``)}var xu,Su,Cu,wu,Tu,Eu,Du,Ou,ku=class e extends $s{constructor(e){super(),xu.add(this),Su.set(this,void 0),Cu.set(this,void 0),wu.set(this,void 0),R(this,Su,e,`f`)}static createResponse(t,n,r){let i=new e(n);return i._run(()=>i._createOrRetrieveResponse(t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createOrRetrieveResponse(e,t,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort())),z(this,xu,`m`,Tu).call(this);let i,a=null;`response_id`in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let e of i)z(this,xu,`m`,Eu).call(this,e,a);if(i.controller.signal?.aborted)throw new ya;return z(this,xu,`m`,Du).call(this)}[(Su=new WeakMap,Cu=new WeakMap,wu=new WeakMap,xu=new WeakSet,Tu=function(){this.ended||R(this,Cu,void 0,`f`)},Eu=function(e,t){if(this.ended)return;let n=(e,n)=>{(t==null||n.sequence_number>t)&&this._emit(e,n)},r=z(this,xu,`m`,Ou).call(this,e);switch(n(`event`,e),e.type){case`response.output_text.delta`:{let t=r.output[e.output_index];if(!t)throw new B(`missing output at index ${e.output_index}`);if(t.type===`message`){let r=t.content[e.content_index];if(!r)throw new B(`missing content at index ${e.content_index}`);if(r.type!==`output_text`)throw new B(`expected content to be 'output_text', got ${r.type}`);n(`response.output_text.delta`,{...e,snapshot:r.text})}break}case`response.function_call_arguments.delta`:{let t=r.output[e.output_index];if(!t)throw new B(`missing output at index ${e.output_index}`);t.type===`function_call`&&n(`response.function_call_arguments.delta`,{...e,snapshot:t.arguments});break}default:n(e.type,e);break}},Du=function(){if(this.ended)throw new B(`stream has ended, this shouldn't happen`);let e=z(this,Cu,`f`);if(!e)throw new B(`request ended without sending any events`);R(this,Cu,void 0,`f`);let t=Au(e,z(this,Su,`f`));return R(this,wu,t,`f`),t},Ou=function(e){let t=z(this,Cu,`f`);if(!t){if(e.type!==`response.created`)throw new B(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=R(this,Cu,e.response,`f`),t}switch(e.type){case`response.output_item.added`:t.output.push(e.item);break;case`response.content_part.added`:{let n=t.output[e.output_index];if(!n)throw new B(`missing output at index ${e.output_index}`);let r=n.type,i=e.part;r===`message`&&i.type!==`reasoning_text`?n.content.push(i):r===`reasoning`&&i.type===`reasoning_text`&&(n.content||=[],n.content.push(i));break}case`response.output_text.delta`:{let n=t.output[e.output_index];if(!n)throw new B(`missing output at index ${e.output_index}`);if(n.type===`message`){let t=n.content[e.content_index];if(!t)throw new B(`missing content at index ${e.content_index}`);if(t.type!==`output_text`)throw new B(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case`response.function_call_arguments.delta`:{let n=t.output[e.output_index];if(!n)throw new B(`missing output at index ${e.output_index}`);n.type===`function_call`&&(n.arguments+=e.delta);break}case`response.reasoning_text.delta`:{let n=t.output[e.output_index];if(!n)throw new B(`missing output at index ${e.output_index}`);if(n.type===`reasoning`){let t=n.content?.[e.content_index];if(!t)throw new B(`missing content at index ${e.content_index}`);if(t.type!==`reasoning_text`)throw new B(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case`response.completed`:R(this,Cu,e.response,`f`);break}return t},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`event`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=z(this,wu,`f`);if(!e)throw new B(`stream ended without producing a ChatCompletion`);return e}};function Au(e,t){return pu(e,t)}var ju=class extends U{list(e,t={},n){return this._client.getAPIList(W`/responses/${e}/input_items`,H,{query:t,...n})}},Mu=class extends U{count(e={},t){return this._client.post(`/responses/input_tokens`,{body:e,...t})}},Nu=class extends U{constructor(){super(...arguments),this.inputItems=new ju(this._client),this.inputTokens=new Mu(this._client)}create(e,t){return this._client.post(`/responses`,{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>(`object`in e&&e.object===`response`&&bu(e),e))}retrieve(e,t={},n){return this._client.get(W`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(e=>(`object`in e&&e.object===`response`&&bu(e),e))}delete(e,t){return this._client.delete(W`/responses/${e}`,{...t,headers:K([{Accept:`*/*`},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>mu(t,e))}stream(e,t){return ku.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(W`/responses/${e}/cancel`,t)}};Nu.InputItems=ju,Nu.InputTokens=Mu;var Pu=class extends U{create(e,t,n){return this._client.post(W`/uploads/${e}/parts`,us({body:t,...n},this._client))}},Fu=class extends U{constructor(){super(...arguments),this.parts=new Pu(this._client)}create(e,t){return this._client.post(`/uploads`,{body:e,...t})}cancel(e,t){return this._client.post(W`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(W`/uploads/${e}/complete`,{body:t,...n})}};Fu.Parts=Pu;const Iu=async e=>{let t=await Promise.allSettled(e),n=t.filter(e=>e.status===`rejected`);if(n.length){for(let e of n)console.error(e.reason);throw Error(`${n.length} promise(s) failed - see the above errors`)}let r=[];for(let e of t)e.status===`fulfilled`&&r.push(e.value);return r};var Lu=class extends U{create(e,t,n){return this._client.post(W`/vector_stores/${e}/file_batches`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{vector_store_id:r}=t;return this._client.get(W`/vector_stores/${r}/file_batches/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}cancel(e,t,n){let{vector_store_id:r}=t;return this._client.post(W`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){let{vector_store_id:r,...i}=t;return this._client.getAPIList(W`/vector_stores/${r}/file_batches/${e}/files`,H,{query:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async poll(e,t,n){let r=K([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(i.status){case`in_progress`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=a.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await Ua(e);break;case`failed`:case`cancelled`:case`completed`:return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=r?.maxConcurrency??5,a=Math.min(i,t.length),o=this._client,s=t.values(),c=[...n];async function l(e){for(let t of e){let e=await o.files.create({file:t,purpose:`assistants`},r);c.push(e.id)}}let u=Array(a).fill(s).map(l);return await Iu(u),await this.createAndPoll(e,{file_ids:c})}},Ru=class extends U{create(e,t,n){return this._client.post(W`/vector_stores/${e}/files`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{vector_store_id:r}=t;return this._client.get(W`/vector_stores/${r}/files/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{vector_store_id:r,...i}=t;return this._client.post(W`/vector_stores/${r}/files/${e}`,{body:i,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(W`/vector_stores/${e}/files`,H,{query:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t,n){let{vector_store_id:r}=t;return this._client.delete(W`/vector_stores/${r}/files/${e}`,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){let r=K([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),a=i.data;switch(a.status){case`in_progress`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=i.response.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await Ua(e);break;case`failed`:case`completed`:return a}}}async upload(e,t,n){let r=await this._client.files.create({file:t,purpose:`assistants`},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){let r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){let{vector_store_id:r}=t;return this._client.getAPIList(W`/vector_stores/${r}/files/${e}/content`,es,{...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}},zu=class extends U{constructor(){super(...arguments),this.files=new Ru(this._client),this.fileBatches=new Lu(this._client)}create(e,t){return this._client.post(`/vector_stores`,{body:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(W`/vector_stores/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(W`/vector_stores/${e}`,{body:t,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e={},t){return this._client.getAPIList(`/vector_stores`,H,{query:e,...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}delete(e,t){return this._client.delete(W`/vector_stores/${e}`,{...t,headers:K([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}search(e,t,n){return this._client.getAPIList(W`/vector_stores/${e}/search`,es,{body:t,method:`post`,...n,headers:K([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}};zu.Files=Ru,zu.FileBatches=Lu;var Bu=class extends U{create(e,t){return this._client.post(`/videos`,ls({body:e,...t},this._client))}retrieve(e,t){return this._client.get(W`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList(`/videos`,ts,{query:e,...t})}delete(e,t){return this._client.delete(W`/videos/${e}`,t)}downloadContent(e,t={},n){return this._client.get(W`/videos/${e}/content`,{query:t,...n,headers:K([{Accept:`application/binary`},n?.headers]),__binaryResponse:!0})}remix(e,t,n){return this._client.post(W`/videos/${e}/remix`,ls({body:t,...n},this._client))}},Vu,Hu,Uu,Wu=class extends U{constructor(){super(...arguments),Vu.add(this)}async unwrap(e,t,n=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,r=300){if(typeof crypto>`u`||typeof crypto.subtle.importKey!=`function`||typeof crypto.subtle.verify!=`function`)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");z(this,Vu,`m`,Hu).call(this,n);let i=K([t]).values,a=z(this,Vu,`m`,Uu).call(this,i,`webhook-signature`),o=z(this,Vu,`m`,Uu).call(this,i,`webhook-timestamp`),s=z(this,Vu,`m`,Uu).call(this,i,`webhook-id`),c=parseInt(o,10);if(isNaN(c))throw new Ma(`Invalid webhook timestamp format`);let l=Math.floor(Date.now()/1e3);if(l-c>r)throw new Ma(`Webhook timestamp is too old`);if(c>l+r)throw new Ma(`Webhook timestamp is too new`);let u=a.split(` `).map(e=>e.startsWith(`v1,`)?e.substring(3):e),d=n.startsWith(`whsec_`)?Buffer.from(n.replace(`whsec_`,``),`base64`):Buffer.from(n,`utf-8`),f=s?`${s}.${o}.${e}`:`${o}.${e}`,p=await crypto.subtle.importKey(`raw`,d,{name:`HMAC`,hash:`SHA-256`},!1,[`verify`]);for(let e of u)try{let t=Buffer.from(e,`base64`);if(await crypto.subtle.verify(`HMAC`,p,t,new TextEncoder().encode(f)))return}catch{continue}throw new Ma(`The given webhook signature does not match the expected signature`)}};Vu=new WeakSet,Hu=function(e){if(typeof e!=`string`||e.length===0)throw Error(`The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function`)},Uu=function(e,t){if(!e)throw Error(`Headers are required`);let n=e.get(t);if(n==null)throw Error(`Missing required header: ${t}`);return n};var Gu,Ku,qu,Ju,q=class{constructor({baseURL:e=fl(`OPENAI_BASE_URL`),apiKey:t=fl(`OPENAI_API_KEY`),organization:n=fl(`OPENAI_ORG_ID`)??null,project:r=fl(`OPENAI_PROJECT_ID`)??null,webhookSecret:i=fl(`OPENAI_WEBHOOK_SECRET`)??null,...a}={}){if(Gu.add(this),qu.set(this,void 0),this.completions=new Bl(this),this.chat=new Jc(this),this.embeddings=new Kl(this),this.files=new Xl(this),this.images=new su(this),this.audio=new el(this),this.moderations=new lu(this),this.models=new cu(this),this.fineTuning=new iu(this),this.graders=new ou(this),this.vectorStores=new zu(this),this.webhooks=new Wu(this),this.beta=new zl(this),this.batches=new tl(this),this.uploads=new Fu(this),this.responses=new Nu(this),this.realtime=new fu(this),this.conversations=new Gl(this),this.evals=new Yl(this),this.containers=new Ul(this),this.videos=new Bu(this),t===void 0)throw new B("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:t,organization:n,project:r,webhookSecret:i,...a,baseURL:e||`https://api.openai.com/v1`};if(!o.dangerouslyAllowBrowser&&Ga())throw new B(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??Ku.DEFAULT_TIMEOUT,this.logger=o.logger??console;let s=`warn`;this.logLevel=s,this.logLevel=Po(o.logLevel,`ClientOptions.logLevel`,this)??Po(fl(`OPENAI_LOG`),`process.env['OPENAI_LOG']`,this)??s,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??$a(),R(this,qu,io,`f`),this._options=o,this.apiKey=typeof t==`string`?t:`Missing Key`,this.organization=n,this.project=r,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return K([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return So(e,{arrayFormat:`brackets`})}getUserAgent(){return`${this.constructor.name}/JS ${Wa}`}defaultIdempotencyKey(){return`stainless-node-retry-${ha()}`}makeStatusError(e,t,n,r){return va.generate(e,t,n,r)}async _callApiKey(){let e=this._options.apiKey;if(typeof e!=`function`)return!1;let t;try{t=await e()}catch(e){throw e instanceof B?e:new B(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if(typeof t!=`string`||!t)throw new B(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,n){let r=!z(this,Gu,`m`,Ju).call(this)&&n||this.baseURL,i=Pa(e)?new URL(e):new URL(r+(r.endsWith(`/`)&&e.startsWith(`/`)?e.slice(1):e)),a=this.defaultQuery();return Ra(a)||(t={...a,...t}),typeof t==`object`&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest(`get`,e,t)}post(e,t){return this.methodRequest(`post`,e,t)}patch(e,t){return this.methodRequest(`patch`,e,t)}put(e,t){return this.methodRequest(`put`,e,t)}delete(e,t){return this.methodRequest(`delete`,e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new Xo(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let r=await e,i=r.maxRetries??this.maxRetries;t??=i,await this.prepareOptions(r);let{req:a,url:o,timeout:s}=await this.buildRequest(r,{retryCount:i-t});await this.prepareRequest(a,{url:o,options:r});let c=`log_`+(Math.random()*(1<<24)|0).toString(16).padStart(6,`0`),l=n===void 0?``:`, retryOf: ${n}`,u=Date.now();if(zo(this).debug(`[${c}] sending request`,Bo({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:a.headers})),r.signal?.aborted)throw new ya;let d=new AbortController,f=await this.fetchWithTimeout(o,a,s,d).catch(_a),p=Date.now();if(f instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new ya;let i=ga(f)||/timed? ?out/i.test(String(f)+(`cause`in f?String(f.cause):``));if(t)return zo(this).info(`[${c}] connection ${i?`timed out`:`failed`} - ${e}`),zo(this).debug(`[${c}] connection ${i?`timed out`:`failed`} (${e})`,Bo({retryOfRequestLogID:n,url:o,durationMs:p-u,message:f.message})),this.retryRequest(r,t,n??c);throw zo(this).info(`[${c}] connection ${i?`timed out`:`failed`} - error; no more retries left`),zo(this).debug(`[${c}] connection ${i?`timed out`:`failed`} (error; no more retries left)`,Bo({retryOfRequestLogID:n,url:o,durationMs:p-u,message:f.message})),i?new xa:new ba({cause:f})}let m=[...f.headers.entries()].filter(([e])=>e===`x-request-id`).map(([e,t])=>`, `+e+`: `+JSON.stringify(t)).join(``),h=`[${c}${l}${m}] ${a.method} ${o} ${f.ok?`succeeded`:`failed`} with status ${f.status} in ${p-u}ms`;if(!f.ok){let e=await this.shouldRetry(f);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await ro(f.body),zo(this).info(`${h} - ${e}`),zo(this).debug(`[${c}] response error (${e})`,Bo({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:p-u})),this.retryRequest(r,t,n??c,f.headers)}let i=e?`error; no more retries left`:`error; not retryable`;zo(this).info(`${h} - ${i}`);let a=await f.text().catch(e=>_a(e).message),o=Ha(a),s=o?void 0:a;throw zo(this).debug(`[${c}] response error (${i})`,Bo({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,message:s,durationMs:Date.now()-u})),this.makeStatusError(f.status,o,s,f.headers)}return zo(this).info(h),zo(this).debug(`[${c}] response start`,Bo({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:p-u})),{response:f,options:r,controller:d,requestLogID:c,retryOfRequestLogID:n,startTime:u}}getAPIList(e,t,n){return this.requestAPIList(t,{method:`get`,path:e,...n})}requestAPIList(e,t){let n=this.makeRequest(t,null,void 0);return new $o(this,n,e)}async fetchWithTimeout(e,t,n,r){let{signal:i,method:a,...o}=t||{};i&&i.addEventListener(`abort`,()=>r.abort());let s=setTimeout(()=>r.abort(),n),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body==`object`&&o.body!==null&&Symbol.asyncIterator in o.body,l={signal:r.signal,...c?{duplex:`half`}:{},method:`GET`,...o};a&&(l.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(s)}}async shouldRetry(e){let t=e.headers.get(`x-should-retry`);return t===`true`?!0:t===`false`?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let i,a=r?.get(`retry-after-ms`);if(a){let e=parseFloat(a);Number.isNaN(e)||(i=e)}let o=r?.get(`retry-after`);if(o&&!i){let e=parseFloat(o);i=Number.isNaN(e)?Date.parse(o)-Date.now():e*1e3}if(!(i&&0<=i&&i<60*1e3)){let n=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Ua(i),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let n=t-e,r=Math.min(.5*2**n,8),i=1-Math.random()*.25;return r*i*1e3}async buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:r,path:i,query:a,defaultBaseURL:o}=n,s=this.buildURL(i,a,o);`timeout`in n&&Va(`timeout`,n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:c,body:l}=this.buildBody({options:n}),u=await this.buildHeaders({options:e,method:r,bodyHeaders:c,retryCount:t});return{req:{method:r,headers:u,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:`half`},...l&&{body:l},...this.fetchOptions??{},...n.fetchOptions??{}},url:s,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let i={};this.idempotencyHeader&&t!==`get`&&(e.idempotencyKey||=this.defaultIdempotencyKey(),i[this.idempotencyHeader]=e.idempotencyKey);let a=K([i,{Accept:`application/json`,"User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Qa(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=K([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e==`string`&&n.values.has(`content-type`)||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e==`object`&&(Symbol.asyncIterator in e||Symbol.iterator in e&&`next`in e&&typeof e.next==`function`)?{bodyHeaders:void 0,body:to(e)}:z(this,qu,`f`).call(this,{body:e,headers:n})}};Ku=q,qu=new WeakMap,Gu=new WeakSet,Ju=function(){return this.baseURL!==`https://api.openai.com/v1`},q.OpenAI=Ku,q.DEFAULT_TIMEOUT=6e5,q.OpenAIError=B,q.APIError=va,q.APIConnectionError=ba,q.APIConnectionTimeoutError=xa,q.APIUserAbortError=ya,q.NotFoundError=Ta,q.ConflictError=Ea,q.RateLimitError=Oa,q.BadRequestError=Sa,q.AuthenticationError=Ca,q.InternalServerError=ka,q.PermissionDeniedError=wa,q.UnprocessableEntityError=Da,q.InvalidWebhookSignatureError=Ma,q.toFile=xs,q.Completions=Bl,q.Chat=Jc,q.Embeddings=Kl,q.Files=Xl,q.Images=su,q.Audio=el,q.Moderations=lu,q.Models=cu,q.FineTuning=iu,q.Graders=ou,q.VectorStores=zu,q.Webhooks=Wu,q.Beta=zl,q.Batches=tl,q.Uploads=Fu,q.Responses=Nu,q.Realtime=fu,q.Conversations=Gl,q.Evals=Yl,q.Containers=Ul,q.Videos=Bu;var Yu=l({OpenAILlmNode:()=>Xu}),Xu=class extends kt{constructor(...e){super(...e),this.type=`openaiLlm`,this.label=`AI å¤§æ¨¡å‹`,this.description=`è°ƒç”¨ OpenAI å…¼å®¹çš„å¤§æ¨¡å‹ API`,this.category=`AI`}defineInputs(){return[{name:`baseUrl`,type:`string`,description:`API åŸºç¡€ URL`,required:!0,defaultValue:`https://api.openai.com/v1`},{name:`apiKey`,type:`string`,description:`API Key`,required:!0},{name:`model`,type:`string`,description:`æ¨¡å‹åç§°`,required:!0,defaultValue:`gpt-3.5-turbo`},{name:`systemMessages`,type:`array`,description:`ç³»ç»Ÿæç¤ºè¯åˆ—è¡¨`,defaultValue:[]},{name:`userMessages`,type:`array`,description:`ç”¨æˆ·æç¤ºè¯åˆ—è¡¨`,defaultValue:[]},{name:`temperature`,type:`number`,description:`æ¸©åº¦å‚æ•°ï¼ˆ0-2ï¼‰`,defaultValue:1},{name:`maxTokens`,type:`number`,description:`æœ€å¤§ token æ•°`,defaultValue:2048},{name:`topP`,type:`number`,description:`Top P å‚æ•°ï¼ˆ0-1ï¼‰`,defaultValue:1},{name:`frequencyPenalty`,type:`number`,description:`é¢‘ç‡æƒ©ç½šï¼ˆ-2 åˆ° 2ï¼‰`,defaultValue:0},{name:`presencePenalty`,type:`number`,description:`å­˜åœ¨æƒ©ç½šï¼ˆ-2 åˆ° 2ï¼‰`,defaultValue:0}]}defineOutputs(){return[{name:`response`,type:`string`,description:`AI å“åº”å†…å®¹`},{name:`fullResponse`,type:`object`,description:`å®Œæ•´çš„ API å“åº”`}]}getStyleConfig(){return{headerColor:[`#10b981`,`#059669`],icon:`ai`,showIcon:!0}}async execute(e,t){try{let n=this.getInput(e,`baseUrl`,`https://api.openai.com/v1`),r=this.getInput(e,`apiKey`,``),i=this.getInput(e,`model`,`gpt-3.5-turbo`),a=this.getInput(e,`systemMessages`,[]),o=this.getInput(e,`userMessages`,[]),s=this.getInput(e,`temperature`,1),c=this.getInput(e,`maxTokens`,2048),l=this.getInput(e,`topP`,1),u=this.getInput(e,`frequencyPenalty`,0),d=this.getInput(e,`presencePenalty`,0),f=this.validateInputs(e);if(!f.valid)return this.createError(f.errors.join(`; `));if(t.signal?.aborted)return this.createError(`è¯·æ±‚å·²ä¸­æ­¢`);n=n.replace(/\/$/,``),n.endsWith(`/v1`)||(n=`${n}/v1`);let p=new q({apiKey:r,baseURL:n}),m=[];if(Array.isArray(a)&&a.length>0)for(let e of a)e.role===`system`&&e.message&&(e.type===`text`?m.push({role:`system`,content:e.message}):e.type===`image`&&m.push({role:`user`,content:[{type:`image_url`,image_url:{url:e.message}}]}));if(Array.isArray(o)&&o.length>0)for(let e of o)e.role===`user`&&e.message&&(e.type===`text`?m.push({role:`user`,content:e.message}):e.type===`image`&&m.push({role:`user`,content:[{type:`image_url`,image_url:{url:e.message}}]}));if(m.length===0)return this.createError(`è‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªç³»ç»Ÿæˆ–ç”¨æˆ·æ¶ˆæ¯`);let h=await p.chat.completions.create({model:i,messages:m,temperature:Math.max(0,Math.min(2,s)),max_tokens:Math.max(1,c),top_p:Math.max(0,Math.min(1,l)),frequency_penalty:Math.max(-2,Math.min(2,u)),presence_penalty:Math.max(-2,Math.min(2,d))},{signal:t.signal}),g=h.choices?.[0]?.message?.content||``,_={id:h.id,object:h.object,created:h.created,model:h.model,choices:h.choices,usage:h.usage};return this.createOutput({response:g,fullResponse:_},g,`æ¨¡å‹ ${i} è°ƒç”¨æˆåŠŸ`)}catch(e){return e instanceof q.APIError?this.createError(`API é”™è¯¯: ${e.status} - ${e.message}`):e.name===`AbortError`?this.createError(`è¯·æ±‚å·²ä¸­æ­¢`):this.createError(e)}}},Zu=l({StartNode:()=>Qu}),Qu=class extends kt{constructor(...e){super(...e),this.type=`start`,this.label=`å¼€å§‹`,this.description=`å·¥ä½œæµç¨‹çš„èµ·å§‹èŠ‚ç‚¹`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[]}defineOutputs(){return[{name:`output`,type:`any`,description:`å¼€å§‹ä¿¡å·`}]}getStyleConfig(){return{headerColor:[`#10b981`,`#059669`],icon:`start`,showIcon:!0}}async execute(e,t){return console.log(`[StartNode execute]`,t),this.createOutput({output:{started:!0,timestamp:Date.now(),workflowId:t.workflow?.workflowId}})}},$u=l({TextProcessNode:()=>ed}),ed=class extends kt{constructor(...e){super(...e),this.type=`text-process`,this.label=`æ–‡æœ¬å¤„ç†`,this.description=`å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œè½¬æ¢å¤„ç†`,this.category=`å·¥å…·`}defineInputs(){return[{name:`text`,type:`string`,description:`è¾“å…¥æ–‡æœ¬`,required:!0},{name:`mode`,type:`string`,description:`å¤„ç†æ¨¡å¼`,defaultValue:`uppercase`,options:[{label:`å¤§å†™`,value:`uppercase`},{label:`å°å†™`,value:`lowercase`},{label:`åè½¬`,value:`reverse`}]},{name:`prefix`,type:`string`,description:`æ·»åŠ å‰ç¼€`,defaultValue:``}]}defineOutputs(){return[{name:`result`,type:`string`,description:`å¤„ç†åçš„æ–‡æœ¬`},{name:`length`,type:`number`,description:`æ–‡æœ¬é•¿åº¦`}]}getStyleConfig(){return{headerColor:`#3b82f6`,icon:`edit`,showIcon:!0,bodyStyle:{minWidth:`200px`}}}async execute(e,t){try{let t=this.getInput(e,`text`,``).toString(),n=this.getInput(e,`mode`,`uppercase`),r=this.getInput(e,`prefix`,``),i=this.validateInputs(e);if(!i.valid)return this.createError(i.errors.join(`; `));let a=t;switch(n){case`uppercase`:a=t.toUpperCase();break;case`lowercase`:a=t.toLowerCase();break;case`reverse`:a=t.split(``).reverse().join(``);break}return r&&(a=r+a),this.createOutput({result:a,length:a.length})}catch(e){return this.createError(e)}}},td=l({VariableAggregateNode:()=>nd}),nd=class extends kt{constructor(...e){super(...e),this.type=`variableAggregate`,this.label=`å˜é‡èšåˆ`,this.description=`å°†å¤šä¸ªåˆ†ç»„çš„æ•°æ®èšåˆï¼Œè¿”å›æ¯ä¸ªåˆ†ç»„çš„ç¬¬ä¸€é¡¹`,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`data`,type:`any`,description:`è¾“å…¥æ•°æ®æ•°ç»„ï¼Œæ ¼å¼: [{ name: string, children: any[] }, ...]`,required:!0}]}defineOutputs(){return[{name:`aggregated`,type:`any`,description:`èšåˆç»“æœï¼Œé”®ä¸ºåˆ†ç»„åç§°ï¼Œå€¼ä¸ºè¯¥åˆ†ç»„çš„ç¬¬ä¸€é¡¹æœ‰æ•°æ®çš„å€¼`}]}shouldUseCache(e,t){return!1}getStyleConfig(){return{headerColor:[`#06b6d4`,`#0891b2`],icon:`package`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`data`,[]);if(!Array.isArray(t))return this.createError(`è¾“å…¥æ•°æ®å¿…é¡»æ˜¯æ•°ç»„ç±»å‹`);let n={};for(let e of t){if(!e||typeof e!=`object`)continue;let t=e.name||`unknown`,r=Array.isArray(e.children)?e.children:[],i=null;for(let e of r)if(e!=null&&e!==``){i=e;break}n[t]=i}return this.createOutput({aggregated:n})}catch(e){return this.createError(e)}}},rd=l({ImagePreviewNode:()=>id}),id=class extends kt{constructor(...e){super(...e),this.type=`preview`,this.label=`å›¾ç‰‡é¢„è§ˆ`,this.description=`é¢„è§ˆå›¾ç‰‡ï¼Œæ”¯æŒå®Œæ•´ URL æˆ–ç›¸å¯¹è·¯å¾„`,this.category=`å·¥å…·`}defineInputs(){return[{name:`imageUrl`,type:`string`,description:`å›¾ç‰‡ URL`,required:!1},{name:`baseUrl`,type:`string`,description:`åŸºç¡€ URL`,required:!1}]}defineOutputs(){return[{name:`imageUrl`,type:`string`,description:`å¤„ç†åçš„å›¾ç‰‡åœ°å€`},{name:`imageInfo`,type:`object`,description:`å›¾ç‰‡çš„å…ƒæ•°æ®ä¿¡æ¯`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`image`,showIcon:!0,bodyStyle:{minWidth:`300px`}}}async execute(e,t){try{let t=this.getInput(e,`imageUrl`,``),n=this.getInput(e,`baseUrl`,``),r;if(!t)return this.createError(`è¯·æä¾›å›¾ç‰‡ URL æˆ–ç›¸å¯¹è·¯å¾„`);if(t.startsWith(`http://`)||t.startsWith(`https://`))r=t;else{if(!n)return this.createError(`ç›¸å¯¹è·¯å¾„éœ€è¦æä¾› baseUrl`);r=this.concatenateUrl(n,t)}let i={url:r,type:`url`,size:`æœªçŸ¥`};try{if(typeof window<`u`&&`Image`in window){let e=await this.getImageDimensions(r);i={...i,width:e.width,height:e.height}}}catch(e){console.warn(`æ— æ³•è·å–å›¾ç‰‡å°ºå¯¸:`,e)}let a=`å›¾ç‰‡é¢„è§ˆ`;return i.width&&i.height&&(a=`å›¾ç‰‡: ${i.width}x${i.height}`),this.createOutput({imageUrl:r,imageInfo:i},a)}catch(e){return this.createError(e)}}concatenateUrl(e,t){if(t.startsWith(`http://`)||t.startsWith(`https://`))return t;let n=e.endsWith(`/`)?e.slice(0,-1):e,r=t.startsWith(`/`)?t.slice(1):t;return`${n}/${r}`}getImageDimensions(e){return new Promise((t,n)=>{let r=document.createElement(`img`);r.onload=()=>{t({width:r.naturalWidth,height:r.naturalHeight})},r.onerror=()=>{n(Error(`æ— æ³•åŠ è½½å›¾ç‰‡`))},r.src=e,setTimeout(()=>{n(Error(`åŠ è½½å›¾ç‰‡è¶…æ—¶`))},5e3)})}};const ad={};var od={"./nodes/CodeNode.ts":qt,"./nodes/ConnectorNode.ts":Zt,"./nodes/DataPreviewNode.ts":$t,"./nodes/DelayNode.ts":tn,"./nodes/EndNode.ts":rn,"./nodes/ForNode.ts":on,"./nodes/HttpRequestNode.ts":da,"./nodes/IfNode.ts":Ht,"./nodes/NoteNode.ts":pa,"./nodes/OpenAILlmNode.ts":Yu,"./nodes/StartNode.ts":Zu,"./nodes/TextProcessNode.ts":$u,"./nodes/VariableAggregateNode.ts":td,"./nodes/previewNode.ts":rd};for(let e in od){let t=od[e];for(let e in t){let n=t[e];if(typeof n==`function`&&n.prototype)try{let e=new n;e&&typeof e.type==`string`&&(ad[e.type]=n)}catch{}}}function sd(e){let t=ad[e];if(!t)throw Error(`æœªçŸ¥çš„èŠ‚ç‚¹ç±»å‹: ${e}`);return new t}var cd={},ld={class:`w-4 h-4`,viewBox:`0 0 24 24`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function ud(e,t){return A(),g(`svg`,ld,[...t[0]||=[r(`path`,{d:`M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1),r(`path`,{d:`M15 12a3 3 0 11-6 0 3 3 0 016 0z`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1)]])}var dd=P(cd,[[`render`,ud]]),fd={},pd={viewBox:`0 0 24 24`,class:`n8n-icon`,"aria-hidden":`true`,focusable:`false`,role:`img`,"data-icon":`external-link`};function md(e,t){return A(),g(`svg`,pd,[...t[0]||=[r(`path`,{fill:`none`,stroke:`currentColor`,"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M15 3h6v6m-11 5L21 3m-3 10v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6`},null,-1)]])}var hd=P(fd,[[`render`,md]]);const gd=t(`ui`,()=>{let e=M(!1),t=M(null),n=M(`medium`),r=M(null),i=M({x:0,y:0}),a={small:280,medium:360,large:480},o=m(()=>r.value??a[n.value]),s=M(!1),c=M({title:``,content:``,type:`info`}),l=M(!1),u=M({title:``,content:``,language:`javascript`}),d=M(!1),f=M(!1),p=M({value:``,onSave:null}),h=M(!1),g=M({title:``,content:``,language:`javascript`,onSave:null}),_=M(null),v=M(null),y=M(null),b=Re(),x=m(()=>b.value?.tagName!==`INPUT`&&b.value?.tagName!==`TEXTAREA`&&!b.value?.isContentEditable),S=m(()=>s.value||l.value||d.value||f.value||h.value),C=m(()=>S.value?!1:x.value);function w(n){t.value===n&&e.value?e.value=!1:(t.value=n,e.value=!0)}function ee(){e.value=!1}function T(){t.value||=`workflows`,e.value=!0}function E(){e.value=!e.value}function D(e){n.value=e,r.value=null}function te(e){r.value=e}function ne(){n.value=`medium`,r.value=null,i.value={x:0,y:0}}function re(e,t,n=`info`){c.value={title:e,content:t,type:n},s.value=!0}function O(){s.value=!1}function ie(e,t,n=`javascript`){u.value={title:e,content:t,language:n},l.value=!0}function k(){l.value=!1}function ae(e){_.value=e,e&&(d.value=!0)}function A(){_.value=null,d.value=!1,t.value===`node-config`&&(e.value=!1)}function j(){_.value&&(d.value=!0)}function oe(){d.value=!1}function se(e,t){p.value={value:e,onSave:t},f.value=!0}function ce(){f.value=!1,setTimeout(()=>{p.value={value:``,onSave:null}},300)}function le(n,r){v.value=n,y.value=r,t.value=`node-result-preview`,e.value=!0}function ue(){v.value=null,y.value=null,t.value===`node-result-preview`&&(e.value=!1)}function de(e,t,n=`javascript`,r){g.value={title:e,content:t,language:n,onSave:r||null},h.value=!0}function N(){h.value=!1,setTimeout(()=>{g.value={title:``,content:``,language:`javascript`,onSave:null}},300)}return{hasModalOpen:S,hasFoucsInput:x,enableShortcut:C,floatingPanelVisible:e,activeTab:t,panelSize:n,customPanelWidth:r,panelPosition:i,panelWidth:o,infoModalVisible:s,infoModalContent:c,editorModalVisible:l,editorModalContent:u,nodeConfigModalVisible:d,variableEditorModalVisible:f,variableEditorModalContent:p,editorPanelModalVisible:h,editorPanelContent:g,selectedNodeId:_,previewNodeId:v,previewNodeData:y,setActiveTab:w,closeFloatingPanel:ee,openFloatingPanel:T,toggleFloatingPanel:E,setPanelSize:D,setCustomPanelWidth:te,resetPanel:ne,showInfoModal:re,closeInfoModal:O,showEditorModal:ie,closeEditorModal:k,selectNode:ae,clearNodeSelection:A,openNodeConfigModal:j,closeNodeConfigModal:oe,openVariableEditorModal:se,closeVariableEditorModal:ce,openEditorPanelModal:de,closeEditorPanelModal:N,showNodePreview:le,clearNodePreview:ue}});var _d={},vd={class:`w-4 h-4`,viewBox:`0 0 24 24`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function yd(e,t){return A(),g(`svg`,vd,[...t[0]||=[r(`path`,{d:`M6 18L18 6M6 6l12 12`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1)]])}var bd=P(_d,[[`render`,yd]]),xd={key:0,class:`shrink-0 text-slate-500`},Sd={class:`flex-1 min-w-0`},Cd={key:0,class:`text-sm font-semibold leading-6 text-slate-900`},wd={key:1,class:`mt-1 text-xs leading-5 text-slate-500`},Td={class:`flex items-center gap-2 shrink-0`},Ed=x({__name:`PanelShell`,props:{title:{default:void 0},description:{default:void 0},closable:{type:Boolean,default:!1},size:{default:`md`},padding:{default:`md`},elevated:{type:Boolean,default:!1},headerSticky:{type:Boolean,default:!1},footerSticky:{type:Boolean,default:!1}},emits:[`close`],setup(e,{emit:t}){let n=e,a=t,o=se(),l=m(()=>({sm:`w-72`,md:`w-80`,lg:`w-96`,xl:`w-[28rem]`,full:`w-full`})[n.size]),u=m(()=>({none:`p-0`,xs:`px-4 py-3`,sm:`px-4 py-4`,md:`px-5 py-5`,lg:`px-6 py-6`})[n.padding]),f=m(()=>!!(n.title||n.description||o.header||o.icon||o.actions||n.closable)),{headerSticky:h,footerSticky:_,elevated:v}=p(n);return(t,n)=>{let o=j(`n-button`);return A(),g(`section`,{class:d([`panel-shell flex flex-col rounded-xl border border-slate-200 bg-white text-slate-900 shadow-sm transition-shadow duration-200`,re(v)?`shadow-lg`:`shadow-sm`,l.value])},[f.value?(A(),g(`header`,{key:0,class:d([`flex items-center gap-3 border-b border-slate-200 px-4`,e.description?`items-start py-3`:`items-center py-2`,re(h)?`sticky top-0 z-10 bg-white/95 backdrop-blur supports-backdrop-filter:bg-white/80`:``])},[t.$slots.icon?(A(),g(`div`,xd,[k(t.$slots,`icon`,{},void 0,!0)])):c(``,!0),r(`div`,Sd,[e.title?(A(),g(`h2`,Cd,i(e.title),1)):c(``,!0),e.description?(A(),g(`p`,wd,i(e.description),1)):c(``,!0),k(t.$slots,`header`,{},void 0,!0)]),r(`div`,Td,[k(t.$slots,`actions`,{},void 0,!0),e.closable?(A(),s(o,{key:0,text:``,class:`h-9! w-9! min-w-0! p-0!`,onClick:n[0]||=e=>a(`close`)},{default:ae(()=>[b(bd,{class:`h-4 w-4`})]),_:1})):c(``,!0)])],2)):c(``,!0),r(`div`,{class:d([`flex-1 overflow-auto variable-scroll`,u.value])},[k(t.$slots,`default`,{},void 0,!0)],2),t.$slots.footer?(A(),g(`footer`,{key:1,class:d([`border-t border-slate-200 px-5 py-3`,re(_)?`sticky bottom-0 z-10 bg-white/95 backdrop-blur supports-backdrop-filter:bg-white/80`:``])},[k(t.$slots,`footer`,{},void 0,!0)],2)):c(``,!0)],2)}}}),Dd=P(Ed,[[`__scopeId`,`data-v-5b177938`]]),Od={key:0,class:`flex items-center justify-between px-5 py-3 bg-white border-b border-slate-200 shrink-0`},kd={class:`flex items-center gap-3`},Ad={key:0,class:`flex items-center justify-center w-7 h-7 rounded-lg bg-linear-to-br from-purple-500 to-purple-700 text-white transition-transform duration-200 hover:scale-105`},jd={key:1,class:`flex items-center justify-center w-7 h-7 rounded-lg bg-linear-to-br from-purple-500 to-purple-700 text-white transition-transform duration-200 hover:scale-105`},Md={class:`flex-1 min-w-0`},Nd={key:0,class:`text-[15px] font-medium text-[#1a1a1a] tracking-tight`},Pd={key:1,class:`mt-1 text-sm text-slate-500`},Fd={class:`flex items-center gap-2`},Id={key:1,class:`border-t border-slate-200 px-6 py-4`},Ld=x({__name:`ModalShell`,props:{modelValue:{type:Boolean},title:{default:void 0},description:{default:void 0},width:{default:`lg`},padding:{default:`md`},closable:{type:Boolean,default:!0},closeOnOverlay:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},verticalAlign:{default:`center`},zIndex:{default:60}},emits:[`update:modelValue`,`close`],setup(t,{emit:n}){let a=t,o=n,l=se(),{modelValue:u,closeOnEsc:_,verticalAlign:y}=p(a),x=m(()=>!!(a.title||a.description||l.header||l.icon||l.actions||a.closable)),S=m(()=>({sm:`max-w-md`,md:`max-w-lg`,lg:`max-w-3xl`,xl:`max-w-4xl`,"2xl":`max-w-5xl`,full:`w-[95vw] h-[95vh]`})[a.width]),C=m(()=>({none:`p-0`,sm:`px-5 py-5`,md:`px-6 py-6`,lg:`px-8 py-8`})[a.padding]),w=()=>{o(`update:modelValue`,!1),o(`close`)},ee=()=>{a.closeOnOverlay&&w()};oe(()=>{u.value&&document.body.classList.add(`overflow-hidden`)}),e(()=>{document.body.classList.remove(`overflow-hidden`)}),D(()=>u.value,e=>{if(e){document.body.classList.add(`overflow-hidden`);return}document.body.classList.remove(`overflow-hidden`)});let{zIndex:T,closable:E}=p(a);return(e,n)=>(A(),s(f,{to:`body`},[b(v,{name:re(y)===`top`?`slide-up`:`fade`},{default:ae(()=>[re(u)?(A(),g(`div`,{key:0,style:h({zIndex:re(T).toString()}),class:d([`fixed inset-0 flex justify-center bg-black/10 backdrop-blur-sm transition`,re(y)===`center`?`items-center`:`items-end`]),onClick:ne(ee,[`self`])},[r(`div`,{class:d([`modal-shell relative mx-auto flex w-10/12 flex-col overflow-hidden bg-[#fafafa] text-slate-900 shadow-[0_8px_40px_rgba(0,0,0,0.08)]`,S.value,re(y)===`center`?a.width===`full`?`rounded-md border border-slate-200`:`my-auto max-h-[calc(100vh-4rem)] rounded-md border border-slate-200`:`max-h-[85vh] rounded-t-2xl`]),role:`dialog`,"aria-modal":`true`},[x.value?(A(),g(`header`,Od,[r(`div`,kd,[e.$slots.icon?(A(),g(`div`,Ad,[k(e.$slots,`icon`,{},void 0,!0)])):t.title?(A(),g(`div`,jd,[b(dd,{class:`w-4 h-4`})])):c(``,!0),r(`div`,Md,[t.title?(A(),g(`h2`,Nd,i(t.title),1)):c(``,!0),t.description?(A(),g(`p`,Pd,i(t.description),1)):c(``,!0),k(e.$slots,`header`,{},void 0,!0)])]),r(`div`,Fd,[k(e.$slots,`actions`,{},void 0,!0),re(E)?(A(),g(`button`,{key:0,class:`flex items-center justify-center w-7 h-7 rounded-lg text-slate-400 transition-colors duration-200 hover:bg-slate-100 hover:text-slate-700`,onClick:n[0]||=e=>w()},[b(bd,{class:`w-4 h-4`})])):c(``,!0)])])):c(``,!0),r(`div`,{class:d([`flex-1 overflow-auto variable-scroll`,C.value])},[k(e.$slots,`default`,{},void 0,!0)],2),e.$slots.footer?(A(),g(`footer`,Id,[k(e.$slots,`footer`,{},void 0,!0)])):c(``,!0)],2)],6)):c(``,!0)]),_:3},8,[`name`])]))}}),Rd=P(Ld,[[`__scopeId`,`data-v-bfb4b045`]]),zd={},Bd={width:`14`,height:`14`,viewBox:`0 0 14 14`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function Vd(e,t){return A(),g(`svg`,Bd,[...t[0]||=[r(`path`,{d:`M3.69653 4.35645L3.29907 4.80566L3.33813 4.97559H4.36157C4.15258 6.18457 3.99633 7.27441 3.69653 8.9541C3.33813 11.0967 3.13207 11.623 3.01 11.8154C2.90258 12.0059 2.74829 12.1045 2.5393 12.1045C2.30981 12.1045 1.89477 11.9229 1.67211 11.7168C1.59204 11.6621 1.49731 11.6758 1.39672 11.7422C1.19555 11.9121 1.00024 12.1738 1.00024 12.4082C0.988519 12.7246 1.41137 13 1.81469 13C2.17016 13 2.6936 12.7773 3.24438 12.2539C3.99731 11.54 4.56079 10.5605 5.03149 8.44336C5.33422 7.0918 5.4768 6.21289 5.68969 4.97656L6.96118 4.86133L7.23657 4.35645H5.80493C6.17504 2.02832 6.46411 1.68359 6.81957 1.68359C7.0559 1.68359 7.33129 1.86523 7.6477 2.22266C7.74145 2.35156 7.88207 2.33789 7.9895 2.25C8.17016 2.14258 8.39282 1.86719 8.40747 1.61719C8.41821 1.3418 8.09008 1 7.52563 1C7.01391 1 6.22973 1.3418 5.57055 2.01367C4.99243 2.62598 4.68969 3.39062 4.48071 4.35645H3.69653ZM7.76489 5.91504C8.15942 5.38965 8.39575 5.21484 8.51782 5.21484C8.64379 5.21484 8.74438 5.33887 8.9602 6.03613L9.32934 7.22656C8.61547 8.31836 8.09301 8.92676 7.77563 8.92676C7.67016 8.92676 7.56372 8.89355 7.48852 8.81934C7.4143 8.74512 7.33227 8.68359 7.25219 8.68359C6.99047 8.68359 6.66625 9.00098 6.66039 9.39453C6.65454 9.7959 6.93579 10.083 7.30493 10.083C7.93872 10.083 8.47485 9.46094 9.51 7.81152L9.81274 8.83203C10.0725 9.70898 10.3772 10.083 10.7581 10.083C11.2288 10.083 11.8616 9.68164 12.552 8.59668L12.2629 8.2666C11.8479 8.7666 11.5725 9.00098 11.4094 9.00098C11.2278 9.00098 11.0686 8.72363 10.8586 8.04199L10.4163 6.60352C10.678 6.21777 10.9358 5.89355 11.1623 5.63477C11.4319 5.32715 11.6399 5.19629 11.7815 5.19629C11.9006 5.19629 12.0041 5.24707 12.0686 5.31836C12.1536 5.41211 12.2043 5.45605 12.3049 5.45605C12.5325 5.45605 12.884 5.16699 12.8967 4.78418C12.9084 4.42871 12.6877 4.12598 12.3049 4.12598C11.7268 4.12598 11.217 4.62402 10.2356 6.08301L10.0334 5.45703C9.75024 4.57812 9.56274 4.12598 9.16821 4.12598C8.70922 4.12598 8.07836 4.69043 7.46118 5.58496L7.76489 5.91504Z`,fill:`#7D838F`},null,-1)]])}var Hd=P(zd,[[`render`,Vd],[`__scopeId`,`data-v-6c4a700e`]]);function Ud(e){return{id:e.id,type:e.type||`custom`,label:e.data?.label||e.label,position:e.position,data:e.data||{},parentNode:e.parentNode}}function Wd(e){return{id:e.id,source:e.source,sourceHandle:e.sourceHandle||void 0,target:e.target,targetHandle:e.targetHandle||void 0,data:e.data||{}}}function Gd(e,t,n,r){let i=t.map(Ud),a=n.map(Wd);return It(e,i,a,void 0,r)}function Kd(){let e=gd(),t=Ot(),n=xt(),{selectedNodeId:r}=le(e),i=m(()=>{if(!r.value)return null;try{let e=t.nodes||[],i=t.edges||[],a=n.getGlobalVariableJson();return console.log(`[useVariableContext] æå–å˜é‡`,e,i),Gd(r.value,e,i,a)}catch(e){return console.error(`[useVariableContext] æå–å˜é‡ä¸Šä¸‹æ–‡å¤±è´¥:`,e),null}}),a=m(()=>i.value?.tree||[]),o=m(()=>i.value?.map||new Map);return{variableContext:i,variableTree:a,contextMap:o}}var qd=[`innerHTML`],Jd={key:1,class:`p-3 bg-white/90 border border-slate-200 rounded-md shadow-sm`},Yd=[`innerHTML`],Xd=x({__name:`VariablePreview`,props:{value:{},currentItemIndex:{default:void 0},inline:{type:Boolean,default:!1}},setup(e){let t=e,{contextMap:n}=Kd(),i=m(()=>{let e=t.value;if(!e||typeof e!=`string`)return``;if(!/\{\{\s*\$?[^{}]+?\s*\}\}/.test(e)||!n.value||n.value.size===0)return e;try{let r=Lt({preview:e},n.value).preview;return r===e?e:t.currentItemIndex!==void 0&&Array.isArray(r)&&r[t.currentItemIndex]!==void 0?s(r[t.currentItemIndex]):s(r)}catch(e){return`è§£æé”™è¯¯: ${e}`}}),a=m(()=>{let e=t.value;if(!e||typeof e!=`string`)return``;if(!/\{\{\s*\$?[^{}]+?\s*\}\}/.test(e)||!n.value||n.value.size===0)return l(e);try{return o(e,n.value,t.currentItemIndex)||l(e)}catch(e){return l(`è§£æé”™è¯¯: ${e}`)}});function o(e,t,n){let r=/\{\{\s*\$?[^{}]+?\s*\}\}/g,i=0,a=``,o,c=!1;for(;(o=r.exec(e))!==null;){c=!0;let r=o[0],u=o.index;a+=l(e.slice(i,u));try{let e=Lt({temp:r},t),i;i=n!==void 0&&Array.isArray(e.temp)?e.temp[n]===void 0?r:s(e.temp[n]):s(e.temp),i===r||e.temp===r?a+=l(r):a+=`<span class="inline-flex items-baseline mx-[1px] bg-indigo-100/80 text-[12px] font-medium text-indigo-700 shadow-sm" title="${l(r)}">${l(i)}</span>`}catch{a+=l(r)}i=u+r.length}return a+=l(e.slice(i)),c?a:l(e)}function s(e){if(e==null)return``;if(typeof e==`object`)try{return JSON.stringify(e,null,2)}catch{return String(e)}return String(e)}function l(e){return e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/"/g,`&quot;`).replace(/'/g,`&#39;`)}return(t,n)=>e.inline&&i.value?(A(),g(`div`,{key:0,class:`text-xs text-slate-700 whitespace-pre-wrap wrap-break-word`,style:{"font-family":`'Fira Code', 'Courier New', 'Microsoft YaHei', 'SimHei',\r
        monospace`},innerHTML:a.value},null,8,qd)):!e.inline&&i.value?(A(),g(`div`,Jd,[n[0]||=r(`div`,{class:`flex items-center justify-between mb-2`},[r(`span`,{class:`text-[10px] font-semibold tracking-wide text-slate-500`},`å®æ—¶é¢„è§ˆ`),r(`span`,{class:`text-[9px] text-slate-400`},`å·²è§£æå˜é‡`)],-1),r(`div`,{class:`text-xs text-slate-700 whitespace-pre-wrap wrap-break-word max-h-32 overflow-y-auto variable-scroll`,style:{"font-family":`'Fira Code', 'Courier New', 'Microsoft YaHei', 'SimHei',\r
          monospace`},innerHTML:a.value},null,8,Yd)])):c(``,!0)}});function Zd(e){this.content=e}Zd.prototype={constructor:Zd,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return t==-1?void 0:this.content[t+1]},update:function(e,t,n){var r=n&&n!=e?this.remove(n):this,i=r.find(e),a=r.content.slice();return i==-1?a.push(n||e,t):(a[i+1]=t,n&&(a[i]=n)),new Zd(a)},remove:function(e){var t=this.find(e);if(t==-1)return this;var n=this.content.slice();return n.splice(t,2),new Zd(n)},addToStart:function(e,t){return new Zd([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new Zd(n)},addBefore:function(e,t,n){var r=this.remove(t),i=r.content.slice(),a=r.find(e);return i.splice(a==-1?i.length:a,0,t,n),new Zd(i)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return e=Zd.from(e),e.size?new Zd(e.content.concat(this.subtract(e).content)):this},append:function(e){return e=Zd.from(e),e.size?new Zd(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=Zd.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach(function(t,n){e[t]=n}),e},get size(){return this.content.length>>1}},Zd.from=function(e){if(e instanceof Zd)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new Zd(t)};var Qd=Zd;function $d(e,t,n){for(let r=0;;r++){if(r==e.childCount||r==t.childCount)return e.childCount==t.childCount?null:n;let i=e.child(r),a=t.child(r);if(i==a){n+=i.nodeSize;continue}if(!i.sameMarkup(a))return n;if(i.isText&&i.text!=a.text){for(let e=0;i.text[e]==a.text[e];e++)n++;return n}if(i.content.size||a.content.size){let e=$d(i.content,a.content,n+1);if(e!=null)return e}n+=i.nodeSize}}function ef(e,t,n,r){for(let i=e.childCount,a=t.childCount;;){if(i==0||a==0)return i==a?null:{a:n,b:r};let o=e.child(--i),s=t.child(--a),c=o.nodeSize;if(o==s){n-=c,r-=c;continue}if(!o.sameMarkup(s))return{a:n,b:r};if(o.isText&&o.text!=s.text){let e=0,t=Math.min(o.text.length,s.text.length);for(;e<t&&o.text[o.text.length-e-1]==s.text[s.text.length-e-1];)e++,n--,r--;return{a:n,b:r}}if(o.content.size||s.content.size){let e=ef(o.content,s.content,n-1,r-1);if(e)return e}n-=c,r-=c}}var J=class e{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let t=0;t<e.length;t++)this.size+=e[t].nodeSize}nodesBetween(e,t,n,r=0,i){for(let a=0,o=0;o<t;a++){let s=this.content[a],c=o+s.nodeSize;if(c>e&&n(s,r+o,i||null,a)!==!1&&s.content.size){let i=o+1;s.nodesBetween(Math.max(0,e-i),Math.min(s.content.size,t-i),n,r+i)}o=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let i=``,a=!0;return this.nodesBetween(e,t,(o,s)=>{let c=o.isText?o.text.slice(Math.max(e,s)-s,t-s):o.isLeaf?r?typeof r==`function`?r(o):r:o.type.spec.leafText?o.type.spec.leafText(o):``:``;o.isBlock&&(o.isLeaf&&c||o.isTextblock)&&n&&(a?a=!1:i+=n),i+=c},0),i}append(t){if(!t.size)return this;if(!this.size)return t;let n=this.lastChild,r=t.firstChild,i=this.content.slice(),a=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),a=1);a<t.content.length;a++)i.push(t.content[a]);return new e(i,this.size+t.size)}cut(t,n=this.size){if(t==0&&n==this.size)return this;let r=[],i=0;if(n>t)for(let e=0,a=0;a<n;e++){let o=this.content[e],s=a+o.nodeSize;s>t&&((a<t||s>n)&&(o=o.isText?o.cut(Math.max(0,t-a),Math.min(o.text.length,n-a)):o.cut(Math.max(0,t-a-1),Math.min(o.content.size,n-a-1))),r.push(o),i+=o.nodeSize),a=s}return new e(r,i)}cutByIndex(t,n){return t==n?e.empty:t==0&&n==this.content.length?this:new e(this.content.slice(t,n))}replaceChild(t,n){let r=this.content[t];if(r==n)return this;let i=this.content.slice(),a=this.size+n.nodeSize-r.nodeSize;return i[t]=n,new e(i,a)}addToStart(t){return new e([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new e(this.content.concat(t),this.size+t.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw RangeError(`Index `+e+` out of range for `+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return $d(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return ef(this,e,t,n)}findIndex(e){if(e==0)return nf(0,e);if(e==this.size)return nf(this.content.length,e);if(e>this.size||e<0)throw RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let r=this.child(t),i=n+r.nodeSize;if(i>=e)return i==e?nf(t+1,i):nf(t,n);n=i}}toString(){return`<`+this.toStringInner()+`>`}toStringInner(){return this.content.join(`, `)}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(t,n){if(!n)return e.empty;if(!Array.isArray(n))throw RangeError(`Invalid input for Fragment.fromJSON`);return new e(n.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return e.empty;let n,r=0;for(let e=0;e<t.length;e++){let i=t[e];r+=i.nodeSize,e&&i.isText&&t[e-1].sameMarkup(i)?(n||=t.slice(0,e),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new e(n||t,r)}static from(t){if(!t)return e.empty;if(t instanceof e)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new e([t],t.nodeSize);throw RangeError(`Can not convert `+t+` to a Fragment`+(t.nodesBetween?` (looks like multiple versions of prosemirror-model were loaded)`:``))}};J.empty=new J([],0);var tf={index:0,offset:0};function nf(e,t){return tf.index=e,tf.offset=t,tf}function rf(e,t){if(e===t)return!0;if(!(e&&typeof e==`object`)||!(t&&typeof t==`object`))return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!rf(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!rf(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}var Y=class e{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let i=e[r];if(this.eq(i))return e;if(this.type.excludes(i.type))t||=e.slice(0,r);else if(i.type.excludes(this.type))return e;else !n&&i.type.rank>this.type.rank&&(t||=e.slice(0,r),t.push(this),n=!0),t&&t.push(i)}return t||=e.slice(),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&rf(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw RangeError(`Invalid input for Mark.fromJSON`);let n=e.marks[t.type];if(!n)throw RangeError(`There is no mark type ${t.type} in this schema`);let r=n.create(t.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return e.none;if(t instanceof e)return[t];let n=t.slice();return n.sort((e,t)=>e.type.rank-t.type.rank),n}};Y.none=[];var af=class extends Error{},X=class e{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,n){let r=cf(this.content,t+this.openStart,n);return r&&new e(r,this.openStart,this.openEnd)}removeBetween(t,n){return new e(sf(this.content,t+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+`(`+this.openStart+`,`+this.openEnd+`)`}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(t,n){if(!n)return e.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!=`number`||typeof i!=`number`)throw RangeError(`Invalid input for Slice.fromJSON`);return new e(J.fromJSON(t,n.content),r,i)}static maxOpen(t,n=!0){let r=0,i=0;for(let e=t.firstChild;e&&!e.isLeaf&&(n||!e.type.spec.isolating);e=e.firstChild)r++;for(let e=t.lastChild;e&&!e.isLeaf&&(n||!e.type.spec.isolating);e=e.lastChild)i++;return new e(t,r,i)}};X.empty=new X(J.empty,0,0);function sf(e,t,n){let{index:r,offset:i}=e.findIndex(t),a=e.maybeChild(r),{index:o,offset:s}=e.findIndex(n);if(i==t||a.isText){if(s!=n&&!e.child(o).isText)throw RangeError(`Removing non-flat range`);return e.cut(0,t).append(e.cut(n))}if(r!=o)throw RangeError(`Removing non-flat range`);return e.replaceChild(r,a.copy(sf(a.content,t-i-1,n-i-1)))}function cf(e,t,n,r){let{index:i,offset:a}=e.findIndex(t),o=e.maybeChild(i);if(a==t||o.isText)return r&&!r.canReplace(i,i,n)?null:e.cut(0,t).append(n).append(e.cut(t));let s=cf(o.content,t-a-1,n,o);return s&&e.replaceChild(i,o.copy(s))}function lf(e,t,n){if(n.openStart>e.depth)throw new af(`Inserted content deeper than insertion position`);if(e.depth-n.openStart!=t.depth-n.openEnd)throw new af(`Inconsistent open depths`);return uf(e,t,n,0)}function uf(e,t,n,r){let i=e.index(r),a=e.node(r);if(i==t.index(r)&&r<e.depth-n.openStart){let o=uf(e,t,n,r+1);return a.copy(a.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&e.depth==r&&t.depth==r){let r=e.parent,i=r.content;return hf(r,i.cut(0,e.parentOffset).append(n.content).append(i.cut(t.parentOffset)))}else{let{start:i,end:o}=vf(n,e);return hf(a,gf(e,i,o,t,r))}else return hf(a,_f(e,t,r))}function df(e,t){if(!t.type.compatibleContent(e.type))throw new af(`Cannot join `+t.type.name+` onto `+e.type.name)}function ff(e,t,n){let r=e.node(n);return df(r,t.node(n)),r}function pf(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function mf(e,t,n,r){let i=(t||e).node(n),a=0,o=t?t.index(n):i.childCount;e&&(a=e.index(n),e.depth>n?a++:e.textOffset&&(pf(e.nodeAfter,r),a++));for(let e=a;e<o;e++)pf(i.child(e),r);t&&t.depth==n&&t.textOffset&&pf(t.nodeBefore,r)}function hf(e,t){return e.type.checkContent(t),e.copy(t)}function gf(e,t,n,r,i){let a=e.depth>i&&ff(e,t,i+1),o=r.depth>i&&ff(n,r,i+1),s=[];return mf(null,e,i,s),a&&o&&t.index(i)==n.index(i)?(df(a,o),pf(hf(a,gf(e,t,n,r,i+1)),s)):(a&&pf(hf(a,_f(e,t,i+1)),s),mf(t,n,i,s),o&&pf(hf(o,_f(n,r,i+1)),s)),mf(r,null,i,s),new J(s)}function _f(e,t,n){let r=[];if(mf(null,e,n,r),e.depth>n){let i=ff(e,t,n+1);pf(hf(i,_f(e,t,n+1)),r)}return mf(t,null,n,r),new J(r)}function vf(e,t){let n=t.depth-e.openStart,r=t.node(n).copy(e.content);for(let e=n-1;e>=0;e--)r=t.node(e).copy(J.from(r));return{start:r.resolveNoCache(e.openStart+n),end:r.resolveNoCache(r.content.size-e.openEnd-n)}}var yf=class e{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw RangeError(`There is no position before the top-level node`);return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw RangeError(`There is no position after the top-level node`);return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],r=t==0?0:this.path[t*3-1]+1;for(let t=0;t<e;t++)r+=n.child(t).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Y.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let e=n;n=r,r=e}let i=n.marks;for(var a=0;a<i.length;a++)i[a].type.spec.inclusive===!1&&(!r||!i[a].isInSet(r.marks))&&(i=i[a--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var i=0;i<n.length;i++)n[i].type.spec.inclusive===!1&&(!r||!n[i].isInSet(r.marks))&&(n=n[i--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new Cf(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e=``;for(let t=1;t<=this.depth;t++)e+=(e?`/`:``)+this.node(t).type.name+`_`+this.index(t-1);return e+`:`+this.parentOffset}static resolve(t,n){if(!(n>=0&&n<=t.content.size))throw RangeError(`Position `+n+` out of range`);let r=[],i=0,a=n;for(let e=t;;){let{index:t,offset:n}=e.content.findIndex(a),o=a-n;if(r.push(e,t,i+n),!o||(e=e.child(t),e.isText))break;a=o-1,i+=n+1}return new e(n,r,a)}static resolveCached(t,n){let r=Sf.get(t);if(r)for(let e=0;e<r.elts.length;e++){let t=r.elts[e];if(t.pos==n)return t}else Sf.set(t,r=new bf);let i=r.elts[r.i]=e.resolve(t,n);return r.i=(r.i+1)%xf,i}},bf=class{constructor(){this.elts=[],this.i=0}},xf=12,Sf=new WeakMap,Cf=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},wf=Object.create(null),Tf=class e{constructor(e,t,n,r=Y.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||J.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,``)}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&rf(this.attrs,t||e.defaultAttrs||wf)&&Y.sameSet(this.marks,n||Y.none)}copy(t=null){return t==this.content?this:new e(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new e(this.type,this.attrs,this.content,t)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return X.empty;let r=this.resolve(e),i=this.resolve(t),a=n?0:r.sharedDepth(t),o=r.start(a),s=r.node(a).content.cut(r.pos-o,i.pos-o);return new X(s,r.depth-a,i.depth-a)}replace(e,t,n){return lf(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return yf.resolveCached(this,e)}resolveNoCache(e){return yf.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,e=>(n.isInSet(e.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+=`(`+this.content.toStringInner()+`)`),Df(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw Error(`Called contentMatchAt on a node with invalid content`);return t}canReplace(e,t,n=J.empty,r=0,i=n.childCount){let a=this.contentMatchAt(e).matchFragment(n,r,i),o=a&&a.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let e=r;e<i;e++)if(!this.type.allowsMarks(n.child(e).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(e).matchType(n),a=i&&i.matchFragment(this.content,t);return a?a.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Y.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!Y.sameSet(e,this.marks))throw RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(e=>e.toJSON())),e}static fromJSON(e,t){if(!t)throw RangeError(`Invalid input for Node.fromJSON`);let n;if(t.marks){if(!Array.isArray(t.marks))throw RangeError(`Invalid mark data for Node.fromJSON`);n=t.marks.map(e.markFromJSON)}if(t.type==`text`){if(typeof t.text!=`string`)throw RangeError(`Invalid text node in JSON`);return e.text(t.text,n)}let r=J.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,r,n);return i.type.checkAttrs(i.attrs),i}};Tf.prototype.text=void 0;var Ef=class e extends Tf{constructor(e,t,n,r){if(super(e,t,null,r),!n)throw RangeError(`Empty text nodes are not allowed`);this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Df(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function Df(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+`(`+t+`)`;return t}var Of=class e{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(t,n){let r=new kf(t,n);if(r.next==null)return e.empty;let i=Af(r);r.next&&r.err(`Unexpected trailing text`);let a=Bf(Lf(i));return Vf(a,r),a}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let i=t;r&&i<n;i++)r=r.matchType(e.child(i).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];function i(a,o){let s=a.matchFragment(e,n);if(s&&(!t||s.validEnd))return J.from(o.map(e=>e.createAndFill()));for(let e=0;e<a.next.length;e++){let{type:t,next:n}=a.next[e];if(!(t.isText||t.hasRequiredAttrs())&&r.indexOf(n)==-1){r.push(n);let e=i(n,o.concat(t));if(e)return e}}return null}return i(this,[])}findWrapping(e){for(let t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),i=r.match;if(i.matchType(e)){let e=[];for(let t=r;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<i.next.length;e++){let{type:a,next:o}=i.next[e];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!r.type||o.validEnd)&&(n.push({match:a.contentMatch,type:a,via:r}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let r=0;r<n.next.length;r++)e.indexOf(n.next[r].next)==-1&&t(n.next[r].next)}return t(this),e.map((t,n)=>{let r=n+(t.validEnd?`*`:` `)+` `;for(let n=0;n<t.next.length;n++)r+=(n?`, `:``)+t.next[n].type.name+`->`+e.indexOf(t.next[n].next);return r}).join(`
`)}};Of.empty=new Of(!0);var kf=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==``&&this.tokens.pop(),this.tokens[0]==``&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw SyntaxError(e+` (in content expression '`+this.string+`')`)}};function Af(e){let t=[];do t.push(jf(e));while(e.eat(`|`));return t.length==1?t[0]:{type:`choice`,exprs:t}}function jf(e){let t=[];do t.push(Mf(e));while(e.next&&e.next!=`)`&&e.next!=`|`);return t.length==1?t[0]:{type:`seq`,exprs:t}}function Mf(e){let t=If(e);for(;;)if(e.eat(`+`))t={type:`plus`,expr:t};else if(e.eat(`*`))t={type:`star`,expr:t};else if(e.eat(`?`))t={type:`opt`,expr:t};else if(e.eat(`{`))t=Pf(e,t);else break;return t}function Nf(e){/\D/.test(e.next)&&e.err(`Expected number, got '`+e.next+`'`);let t=Number(e.next);return e.pos++,t}function Pf(e,t){let n=Nf(e),r=n;return e.eat(`,`)&&(r=e.next==`}`?-1:Nf(e)),e.eat(`}`)||e.err(`Unclosed braced range`),{type:`range`,min:n,max:r,expr:t}}function Ff(e,t){let n=e.nodeTypes,r=n[t];if(r)return[r];let i=[];for(let e in n){let r=n[e];r.isInGroup(t)&&i.push(r)}return i.length==0&&e.err(`No node type or group '`+t+`' found`),i}function If(e){if(e.eat(`(`)){let t=Af(e);return e.eat(`)`)||e.err(`Missing closing paren`),t}else if(/\W/.test(e.next))e.err(`Unexpected token '`+e.next+`'`);else{let t=Ff(e,e.next).map(t=>(e.inline==null?e.inline=t.isInline:e.inline!=t.isInline&&e.err(`Mixing inline and block content`),{type:`name`,value:t}));return e.pos++,t.length==1?t[0]:{type:`choice`,exprs:t}}}function Lf(e){let t=[[]];return i(a(e,0),n()),t;function n(){return t.push([])-1}function r(e,n,r){let i={term:r,to:n};return t[e].push(i),i}function i(e,t){e.forEach(e=>e.to=t)}function a(e,t){if(e.type==`choice`)return e.exprs.reduce((e,n)=>e.concat(a(n,t)),[]);if(e.type==`seq`)for(let r=0;;r++){let o=a(e.exprs[r],t);if(r==e.exprs.length-1)return o;i(o,t=n())}else if(e.type==`star`){let o=n();return r(t,o),i(a(e.expr,o),o),[r(o)]}else if(e.type==`plus`){let o=n();return i(a(e.expr,t),o),i(a(e.expr,o),o),[r(o)]}else if(e.type==`opt`)return[r(t)].concat(a(e.expr,t));else if(e.type==`range`){let o=t;for(let t=0;t<e.min;t++){let t=n();i(a(e.expr,o),t),o=t}if(e.max==-1)i(a(e.expr,o),o);else for(let t=e.min;t<e.max;t++){let t=n();r(o,t),i(a(e.expr,o),t),o=t}return[r(o)]}else if(e.type==`name`)return[r(t,void 0,e.value)];else throw Error(`Unknown expr type`)}}function Rf(e,t){return t-e}function zf(e,t){let n=[];return r(t),n.sort(Rf);function r(t){let i=e[t];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(t);for(let e=0;e<i.length;e++){let{term:t,to:a}=i[e];!t&&n.indexOf(a)==-1&&r(a)}}}function Bf(e){let t=Object.create(null);return n(zf(e,0));function n(r){let i=[];r.forEach(t=>{e[t].forEach(({term:t,to:n})=>{if(!t)return;let r;for(let e=0;e<i.length;e++)i[e][0]==t&&(r=i[e][1]);zf(e,n).forEach(e=>{r||i.push([t,r=[]]),r.indexOf(e)==-1&&r.push(e)})})});let a=t[r.join(`,`)]=new Of(r.indexOf(e.length-1)>-1);for(let e=0;e<i.length;e++){let r=i[e][1].sort(Rf);a.next.push({type:i[e][0],next:t[r.join(`,`)]||n(r)})}return a}}function Vf(e,t){for(let n=0,r=[e];n<r.length;n++){let e=r[n],i=!e.validEnd,a=[];for(let t=0;t<e.next.length;t++){let{type:n,next:o}=e.next[t];a.push(n.name),i&&!(n.isText||n.hasRequiredAttrs())&&(i=!1),r.indexOf(o)==-1&&r.push(o)}i&&t.err(`Only non-generatable nodes (`+a.join(`, `)+`) in a required position (see https://prosemirror.net/docs/guide/#generatable)`)}}function Hf(e){let t=Object.create(null);for(let n in e){let r=e[n];if(!r.hasDefault)return null;t[n]=r.default}return t}function Uf(e,t){let n=Object.create(null);for(let r in e){let i=t&&t[r];if(i===void 0){let t=e[r];if(t.hasDefault)i=t.default;else throw RangeError(`No value supplied for attribute `+r)}n[r]=i}return n}function Wf(e,t,n,r){for(let r in t)if(!(r in e))throw RangeError(`Unsupported attribute ${r} for ${n} of type ${r}`);for(let n in e){let r=e[n];r.validate&&r.validate(t[n])}}function Gf(e,t){let n=Object.create(null);if(t)for(let r in t)n[r]=new Jf(e,r,t[r]);return n}var Kf=class e{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(` `):[],this.attrs=Gf(e,n.attrs),this.defaultAttrs=Hf(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e==`text`),this.isText=e==`text`}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Of.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?`pre`:`normal`)}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Uf(this.attrs,e)}create(e=null,t,n){if(this.isText)throw Error(`NodeType.create can't construct text nodes`);return new Tf(this,this.computeAttrs(e),J.from(t),Y.setFrom(n))}createChecked(e=null,t,n){return t=J.from(t),this.checkContent(t),new Tf(this,this.computeAttrs(e),t,Y.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=J.from(t),t.size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let r=this.contentMatch.matchFragment(t),i=r&&r.fillBefore(J.empty,!0);return i?new Tf(this,e,t.append(i),Y.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let t=0;t<e.childCount;t++)if(!this.allowsMarks(e.child(t).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Wf(this.attrs,e,`node`,this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||=e.slice(0,n);return t?t.length?t:Y.none:e}static compile(t,n){let r=Object.create(null);t.forEach((t,i)=>r[t]=new e(t,n,i));let i=n.spec.topNode||`doc`;if(!r[i])throw RangeError(`Schema is missing its top node type ('`+i+`')`);if(!r.text)throw RangeError(`Every schema needs a 'text' type`);for(let e in r.text.attrs)throw RangeError(`The text node type should not have attributes`);return r}};function qf(e,t,n){let r=n.split(`|`);return n=>{let i=n===null?`null`:typeof n;if(r.indexOf(i)<0)throw RangeError(`Expected value of type ${r} for attribute ${t} on type ${e}, got ${i}`)}}var Jf=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,`default`),this.default=n.default,this.validate=typeof n.validate==`string`?qf(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},Yf=class e{constructor(e,t,n,r){this.name=e,this.rank=t,this.schema=n,this.spec=r,this.attrs=Gf(e,r.attrs),this.excluded=null;let i=Hf(this.attrs);this.instance=i?new Y(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Y(this,Uf(this.attrs,e))}static compile(t,n){let r=Object.create(null),i=0;return t.forEach((t,a)=>r[t]=new e(t,i++,n,a)),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Wf(this.attrs,e,`mark`,this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},Xf=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let n in e)t[n]=e[n];t.nodes=Qd.from(e.nodes),t.marks=Qd.from(e.marks||{}),this.nodes=Kf.compile(this.spec.nodes,this),this.marks=Yf.compile(this.spec.marks,this);let n=Object.create(null);for(let e in this.nodes){if(e in this.marks)throw RangeError(e+` can not be both a node and a mark`);let t=this.nodes[e],r=t.spec.content||``,i=t.spec.marks;if(t.contentMatch=n[r]||(n[r]=Of.parse(r,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.spec.linebreakReplacement){if(this.linebreakReplacement)throw RangeError(`Multiple linebreak nodes defined`);if(!t.isInline||!t.isLeaf)throw RangeError(`Linebreak replacement nodes must be inline leaf nodes`);this.linebreakReplacement=t}t.markSet=i==`_`?null:i?Zf(this,i.split(` `)):i==``||!t.inlineContent?[]:null}for(let e in this.marks){let t=this.marks[e],n=t.spec.excludes;t.excluded=n==null?[t]:n==``?[]:Zf(this,n.split(` `))}this.nodeFromJSON=e=>Tf.fromJSON(this,e),this.markFromJSON=e=>Y.fromJSON(this,e),this.topNodeType=this.nodes[this.spec.topNode||`doc`],this.cached.wrappings=Object.create(null)}node(e,t=null,n,r){if(typeof e==`string`)e=this.nodeType(e);else if(e instanceof Kf){if(e.schema!=this)throw RangeError(`Node type from different schema used (`+e.name+`)`)}else throw RangeError(`Invalid node type: `+e);return e.createChecked(t,n,r)}text(e,t){let n=this.nodes.text;return new Ef(n,n.defaultAttrs,e,Y.setFrom(t))}mark(e,t){return typeof e==`string`&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw RangeError(`Unknown node type: `+e);return t}};function Zf(e,t){let n=[];for(let r=0;r<t.length;r++){let i=t[r],a=e.marks[i],o=a;if(a)n.push(a);else for(let t in e.marks){let r=e.marks[t];(i==`_`||r.spec.group&&r.spec.group.split(` `).indexOf(i)>-1)&&n.push(o=r)}if(!o)throw SyntaxError(`Unknown mark type: '`+t[r]+`'`)}return n}function Qf(e){return e.tag!=null}function $f(e){return e.style!=null}var ep=class e{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(e=>{if(Qf(e))this.tags.push(e);else if($f(e)){let t=/[^=]*/.exec(e.style)[0];n.indexOf(t)<0&&n.push(t),this.styles.push(e)}}),this.normalizeLists=!this.tags.some(t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)})}parse(e,t={}){let n=new lp(this,t,!1);return n.addAll(e,Y.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new lp(this,t,!0);return n.addAll(e,Y.none,t.from,t.to),X.maxOpen(n.finish())}matchTag(e,t,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(dp(e,n.tag)&&(n.namespace===void 0||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(t===!1)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let r=this.styles[i],a=r.style;if(!(a.indexOf(e)!=0||r.context&&!n.matchesContext(r.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(r.getAttrs){let e=r.getAttrs(t);if(e===!1)continue;r.attrs=e||void 0}return r}}}static schemaRules(e){let t=[];function n(e){let n=e.priority==null?50:e.priority,r=0;for(;r<t.length;r++){let e=t[r];if((e.priority==null?50:e.priority)<n)break}t.splice(r,0,e)}for(let t in e.marks){let r=e.marks[t].spec.parseDOM;r&&r.forEach(e=>{n(e=fp(e)),e.mark||e.ignore||e.clearMark||(e.mark=t)})}for(let t in e.nodes){let r=e.nodes[t].spec.parseDOM;r&&r.forEach(e=>{n(e=fp(e)),e.node||e.ignore||e.mark||(e.node=t)})}return t}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new e(t,e.schemaRules(t)))}},tp={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},np={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},rp={ol:!0,ul:!0},ip=1,ap=2,op=4;function sp(e,t,n){return t==null?e&&e.whitespace==`pre`?ip|ap:n&~op:(t?ip:0)|(t===`full`?ap:0)}var cp=class{constructor(e,t,n,r,i,a){this.type=e,this.attrs=t,this.marks=n,this.solid=r,this.options=a,this.content=[],this.activeMarks=Y.none,this.match=i||(a&op?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(J.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let t=this.type.contentMatch,n;return(n=t.findWrapping(e.type))?(this.match=t,n):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&ip)){let e=this.content[this.content.length-1],t;if(e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))){let n=e;e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-t[0].length))}}let t=J.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(J.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!tp.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},lp=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r=t.topNode,i,a=sp(null,t.preserveWhitespace,0)|(n?op:0);i=r?new cp(r.type,r.attrs,Y.none,!0,t.topMatch||r.type.contentMatch,a):n?new cp(null,null,Y.none,!0,null,a):new cp(e.schema.topNodeType,null,Y.none,!0,null,a),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,r=this.top,i=r.options&ap?`full`:this.localPreserveWS||(r.options&ip)>0,{schema:a}=this.parser;if(i===`full`||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(i)if(i===`full`)n=n.replace(/\r\n?/g,`
`);else if(a.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(a.linebreakReplacement.create())){let e=n.split(/\r?\n|\r/);for(let n=0;n<e.length;n++)n&&this.insertNode(a.linebreakReplacement.create(),t,!0),e[n]&&this.insertNode(a.text(e[n]),t,!/\S/.test(e[n]));n=``}else n=n.replace(/\r?\n|\r/g,` `);else if(n=n.replace(/[ \t\r\n\u000c]+/g,` `),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let t=r.content[r.content.length-1],i=e.previousSibling;(!t||i&&i.nodeName==`BR`||t.isText&&/[ \t\r\n\u000c]$/.test(t.text))&&(n=n.slice(1))}n&&this.insertNode(a.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let r=this.localPreserveWS,i=this.top;(e.tagName==`PRE`||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let a=e.nodeName.toLowerCase(),o;rp.hasOwnProperty(a)&&this.parser.normalizeLists&&up(e);let s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));out:if(s?s.ignore:np.hasOwnProperty(a))this.findInside(e),this.ignoreFallback(e,t);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);let n,r=this.needsBlock;if(tp.hasOwnProperty(a))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),n=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break out}let o=s&&s.skip?t:this.readStyles(e,t);o&&this.addAll(e,o),n&&this.sync(i),this.needsBlock=r}else{let n=this.readStyles(e,t);n&&this.addElementByRule(e,s,n,s.consuming===!1?o:void 0)}this.localPreserveWS=r}leafFallback(e,t){e.nodeName==`BR`&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName==`BR`&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text(`-`),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let e=0;e<this.parser.matchedStyles.length;e++){let r=this.parser.matchedStyles[e],i=n.getPropertyValue(r);if(i)for(let e;;){let n=this.parser.matchStyle(r,i,this,e);if(!n)break;if(n.ignore)return null;if(t=n.clearMark?t.filter(e=>!n.clearMark(e)):t.concat(this.parser.schema.marks[n.mark].create(n.attrs)),n.consuming===!1)e=n;else break}}return t}addElementByRule(e,t,n,r){let i,a;if(t.node)if(a=this.parser.schema.nodes[t.node],a.isLeaf)this.insertNode(a.create(t.attrs),n,e.nodeName==`BR`)||this.leafFallback(e,n);else{let e=this.enter(a,t.attrs||null,n,t.preserveWhitespace);e&&(i=!0,n=e)}else{let e=this.parser.schema.marks[t.mark];n=n.concat(e.create(t.attrs))}let o=this.top;if(a&&a.isLeaf)this.findInside(e);else if(r)this.addElement(e,n,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(e=>this.insertNode(e,n,!1));else{let r=e;typeof t.contentElement==`string`?r=e.querySelector(t.contentElement):typeof t.contentElement==`function`?r=t.contentElement(e):t.contentElement&&(r=t.contentElement),this.findAround(e,r,!0),this.addAll(r,n),this.findAround(e,r,!1)}i&&this.sync(o)&&this.open--}addAll(e,t,n,r){let i=n||0;for(let a=n?e.childNodes[n]:e.firstChild,o=r==null?null:e.childNodes[r];a!=o;a=a.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(a,t);this.findAtPoint(e,i)}findPlace(e,t,n){let r,i;for(let t=this.open,a=0;t>=0;t--){let o=this.nodes[t],s=o.findWrapping(e);if(s&&(!r||r.length>s.length+a)&&(r=s,i=o,!s.length))break;if(o.solid){if(n)break;a+=2}}if(!r)return null;this.sync(i);for(let e=0;e<r.length;e++)t=this.enterInner(r[e],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&(t=this.enterInner(e,null,t))}let r=this.findPlace(e,t,n);if(r){this.closeExtra();let t=this.top;t.match&&=t.match.matchType(e.type);let n=Y.none;for(let i of r.concat(e.marks))(t.type?t.type.allowsMarkType(i.type):pp(i.type,e.type))&&(n=i.addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n,r){let i=this.findPlace(e.create(t),n,!1);return i&&=this.enterInner(e,t,n,!0,r),i}enterInner(e,t,n,r=!1,i){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(e);let o=sp(e,i,a.options);a.options&op&&a.content.length==0&&(o|=op);let s=Y.none;return n=n.filter(t=>(a.type?a.type.allowsMarkType(t.type):pp(t.type,e))?(s=t.addToSet(s),!1):!0),this.nodes.push(new cp(e,t,s,r,null,o)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;else this.localPreserveWS&&(this.nodes[t].options|=ip);return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&t.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf(`|`)>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split(`/`),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),a=(e,o)=>{for(;e>=0;e--){let s=t[e];if(s==``){if(e==t.length-1||e==0)continue;for(;o>=i;o--)if(a(e-1,o))return!0;return!1}else{let e=o>0||o==0&&r?this.nodes[o].type:n&&o>=i?n.node(o-i).type:null;if(!e||e.name!=s&&!e.isInGroup(s))return!1;o--}}return!0};return a(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}};function up(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=t.nodeType==1?t.nodeName.toLowerCase():null;e&&rp.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):e==`li`?n=t:e&&(n=null)}}function dp(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function fp(e){let t={};for(let n in e)t[n]=e[n];return t}function pp(e,t){let n=t.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(e))continue;let a=[],o=e=>{a.push(e);for(let n=0;n<e.edgeCount;n++){let{type:r,next:i}=e.edge(n);if(r==t||a.indexOf(i)<0&&o(i))return!0}};if(o(i.contentMatch))return!0}}var mp=class e{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||=gp(t).createDocumentFragment();let r=n,i=[];return e.forEach(e=>{if(i.length||e.marks.length){let n=0,a=0;for(;n<i.length&&a<e.marks.length;){let t=e.marks[a];if(!this.marks[t.type.name]){a++;continue}if(!t.eq(i[n][0])||t.type.spec.spanning===!1)break;n++,a++}for(;n<i.length;)r=i.pop()[1];for(;a<e.marks.length;){let n=e.marks[a++],o=this.serializeMark(n,e.isInline,t);o&&(i.push([n,r]),r.appendChild(o.dom),r=o.contentDOM||o.dom)}}r.appendChild(this.serializeNodeInner(e,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=bp(gp(t),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw RangeError(`Content hole not allowed in a leaf node spec`);this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let i=this.serializeMark(e.marks[r],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&bp(gp(n),r(e,t),null,e.attrs)}static renderSpec(e,t,n=null,r){return bp(e,t,n,r)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new e(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(e){let t=hp(e.nodes);return t.text||=e=>e.text,t}static marksFromSchema(e){return hp(e.marks)}};function hp(e){let t={};for(let n in e){let r=e[n].spec.toDOM;r&&(t[n]=r)}return t}function gp(e){return e.document||window.document}var _p=new WeakMap;function vp(e){let t=_p.get(e);return t===void 0&&_p.set(e,t=yp(e)),t}function yp(e){let t=null;function n(e){if(e&&typeof e==`object`)if(Array.isArray(e))if(typeof e[0]==`string`)t||=[],t.push(e);else for(let t=0;t<e.length;t++)n(e[t]);else for(let t in e)n(e[t])}return n(e),t}function bp(e,t,n,r){if(typeof t==`string`)return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let i=t[0],a;if(typeof i!=`string`)throw RangeError(`Invalid array passed to renderSpec`);if(r&&(a=vp(r))&&a.indexOf(t)>-1)throw RangeError(`Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.`);let o=i.indexOf(` `);o>0&&(n=i.slice(0,o),i=i.slice(o+1));let s,c=n?e.createElementNS(n,i):e.createElement(i),l=t[1],u=1;if(l&&typeof l==`object`&&l.nodeType==null&&!Array.isArray(l)){for(let e in u=2,l)if(l[e]!=null){let t=e.indexOf(` `);t>0?c.setAttributeNS(e.slice(0,t),e.slice(t+1),l[e]):e==`style`&&c.style?c.style.cssText=l[e]:c.setAttribute(e,l[e])}}for(let i=u;i<t.length;i++){let a=t[i];if(a===0){if(i<t.length-1||i>u)throw RangeError(`Content hole must be the only child of its parent node`);return{dom:c,contentDOM:c}}else{let{dom:t,contentDOM:i}=bp(e,a,n,r);if(c.appendChild(t),i){if(s)throw RangeError(`Multiple content holes`);s=i}}}return{dom:c,contentDOM:s}}var xp=65535,Sp=2**16;function Cp(e,t){return e+t*Sp}function wp(e){return e&xp}function Tp(e){return(e-(e&xp))/Sp}var Ep=1,Dp=2,Op=4,kp=8,Ap=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&kp)>0}get deletedBefore(){return(this.delInfo&(Ep|Op))>0}get deletedAfter(){return(this.delInfo&(Dp|Op))>0}get deletedAcross(){return(this.delInfo&Op)>0}},jp=class e{constructor(t,n=!1){if(this.ranges=t,this.inverted=n,!t.length&&e.empty)return e.empty}recover(e){let t=0,n=wp(e);if(!this.inverted)for(let e=0;e<n;e++)t+=this.ranges[e*3+2]-this.ranges[e*3+1];return this.ranges[n*3]+t+Tp(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,i=this.inverted?2:1,a=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let s=this.ranges[o]-(this.inverted?r:0);if(s>e)break;let c=this.ranges[o+i],l=this.ranges[o+a],u=s+c;if(e<=u){let i=c?e==s?-1:e==u?1:t:t,a=s+r+(i<0?0:l);if(n)return a;let d=e==(t<0?s:u)?null:Cp(o/3,e-s),f=e==s?Dp:e==u?Ep:Op;return(t<0?e!=s:e!=u)&&(f|=kp),new Ap(a,f,d)}r+=l-c}return n?e+r:new Ap(e+r,0,null)}touches(e,t){let n=0,r=wp(t),i=this.inverted?2:1,a=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let o=this.ranges[t]-(this.inverted?n:0);if(o>e)break;let s=this.ranges[t+i],c=o+s;if(e<=c&&t==r*3)return!0;n+=this.ranges[t+a]-s}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let a=this.ranges[r],o=a-(this.inverted?i:0),s=a+(this.inverted?0:i),c=this.ranges[r+t],l=this.ranges[r+n];e(o,o+c,s,s+l),i+=l-c}}invert(){return new e(this.ranges,!this.inverted)}toString(){return(this.inverted?`-`:``)+JSON.stringify(this.ranges)}static offset(t){return t==0?e.empty:new e(t<0?[0,-t,0]:[0,0,t])}};jp.empty=new jp([]);var Mp=class e{constructor(e,t,n=0,r=e?e.length:0){this.mirror=t,this.from=n,this.to=r,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(t=0,n=this.maps.length){return new e(this._maps,this.mirror,t,n)}appendMap(e,t){this.ownData||=(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let r=e.getMirror(t);this.appendMap(e._maps[t],r!=null&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||=[],this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e._maps[t].invert(),r!=null&&r>t?n-r-1:void 0)}}invert(){let t=new e;return t.appendMappingInverted(this),t}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let n=this.from;n<this.to;n++){let i=this._maps[n].mapResult(e,t);if(i.recover!=null){let t=this.getMirror(n);if(t!=null&&t>n&&t<this.to){n=t,e=this._maps[t].recover(i.recover);continue}}r|=i.delInfo,e=i.pos}return n?e:new Ap(e,r,null)}},Np=Object.create(null),Pp=class{getMap(){return jp.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw RangeError(`Invalid input for Step.fromJSON`);let n=Np[t.stepType];if(!n)throw RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Np)throw RangeError(`Duplicate use of step JSON ID `+e);return Np[e]=t,t.prototype.jsonID=e,t}},Fp=class e{constructor(e,t){this.doc=e,this.failed=t}static ok(t){return new e(t,null)}static fail(t){return new e(null,t)}static fromReplace(t,n,r,i){try{return e.ok(t.replace(n,r,i))}catch(t){if(t instanceof af)return e.fail(t.message);throw t}}};function Ip(e,t,n){let r=[];for(let i=0;i<e.childCount;i++){let a=e.child(i);a.content.size&&(a=a.copy(Ip(a.content,t,a))),a.isInline&&(a=t(a,n,i)),r.push(a)}return J.fromArray(r)}var Lp=class e extends Pp{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),i=new X(Ip(t.content,(e,t)=>!e.isAtom||!t.type.allowsMarkType(this.mark.type)?e:e.mark(this.mark.addToSet(e.marks)),r),t.openStart,t.openEnd);return Fp.fromReplace(e,this.from,this.to,i)}invert(){return new Rp(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:`addMark`,mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if(typeof n.from!=`number`||typeof n.to!=`number`)throw RangeError(`Invalid input for AddMarkStep.fromJSON`);return new e(n.from,n.to,t.markFromJSON(n.mark))}};Pp.jsonID(`addMark`,Lp);var Rp=class e extends Pp{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new X(Ip(t.content,e=>e.mark(this.mark.removeFromSet(e.marks)),e),t.openStart,t.openEnd);return Fp.fromReplace(e,this.from,this.to,n)}invert(){return new Lp(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:`removeMark`,mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if(typeof n.from!=`number`||typeof n.to!=`number`)throw RangeError(`Invalid input for RemoveMarkStep.fromJSON`);return new e(n.from,n.to,t.markFromJSON(n.mark))}};Pp.jsonID(`removeMark`,Rp);var zp=class e extends Pp{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Fp.fail(`No node at mark step's position`);let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Fp.fromReplace(e,this.pos,this.pos+1,new X(J.from(n),0,t.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);if(n){let t=this.mark.addToSet(n.marks);if(t.length==n.marks.length){for(let r=0;r<n.marks.length;r++)if(!n.marks[r].isInSet(t))return new e(this.pos,n.marks[r]);return new e(this.pos,this.mark)}}return new Bp(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:`addNodeMark`,pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if(typeof n.pos!=`number`)throw RangeError(`Invalid input for AddNodeMarkStep.fromJSON`);return new e(n.pos,t.markFromJSON(n.mark))}};Pp.jsonID(`addNodeMark`,zp);var Bp=class e extends Pp{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Fp.fail(`No node at mark step's position`);let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Fp.fromReplace(e,this.pos,this.pos+1,new X(J.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new zp(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:`removeNodeMark`,pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if(typeof n.pos!=`number`)throw RangeError(`Invalid input for RemoveNodeMarkStep.fromJSON`);return new e(n.pos,t.markFromJSON(n.mark))}};Pp.jsonID(`removeNodeMark`,Bp);var Vp=class e extends Pp{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&Up(e,this.from,this.to)?Fp.fail(`Structure replace would overwrite content`):Fp.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new jp([this.from,this.to-this.from,this.slice.size])}invert(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let n=this.slice.size+t.slice.size==0?X.empty:new X(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),n,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let n=this.slice.size+t.slice.size==0?X.empty:new X(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:`replace`,from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if(typeof n.from!=`number`||typeof n.to!=`number`)throw RangeError(`Invalid input for ReplaceStep.fromJSON`);return new e(n.from,n.to,X.fromJSON(t,n.slice),!!n.structure)}};Pp.jsonID(`replace`,Vp);var Hp=class e extends Pp{constructor(e,t,n,r,i,a,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=a,this.structure=o}apply(e){if(this.structure&&(Up(e,this.from,this.gapFrom)||Up(e,this.gapTo,this.to)))return Fp.fail(`Structure gap-replace would overwrite content`);let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Fp.fail(`Gap is not a flat range`);let n=this.slice.insertAt(this.insert,t.content);return n?Fp.fromReplace(e,this.from,this.to,n):Fp.fail(`Content does not fit in gap`)}getMap(){return new jp([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:t.map(this.gapFrom,-1),a=this.to==this.gapTo?r.pos:t.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||a>r.pos?null:new e(n.pos,r.pos,i,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:`replaceAround`,from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if(typeof n.from!=`number`||typeof n.to!=`number`||typeof n.gapFrom!=`number`||typeof n.gapTo!=`number`||typeof n.insert!=`number`)throw RangeError(`Invalid input for ReplaceAroundStep.fromJSON`);return new e(n.from,n.to,n.gapFrom,n.gapTo,X.fromJSON(t,n.slice),n.insert,!!n.structure)}};Pp.jsonID(`replaceAround`,Hp);function Up(e,t,n){let r=e.resolve(t),i=n-t,a=r.depth;for(;i>0&&a>0&&r.indexAfter(a)==r.node(a).childCount;)a--,i--;if(i>0){let e=r.node(a).maybeChild(r.indexAfter(a));for(;i>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,i--}}return!1}function Wp(e,t,n,r){let i=[],a=[],o,s;e.doc.nodesBetween(t,n,(e,c,l)=>{if(!e.isInline)return;let u=e.marks;if(!r.isInSet(u)&&l.type.allowsMarkType(r.type)){let l=Math.max(c,t),d=Math.min(c+e.nodeSize,n),f=r.addToSet(u);for(let e=0;e<u.length;e++)u[e].isInSet(f)||(o&&o.to==l&&o.mark.eq(u[e])?o.to=d:i.push(o=new Rp(l,d,u[e])));s&&s.to==l?s.to=d:a.push(s=new Lp(l,d,r))}}),i.forEach(t=>e.step(t)),a.forEach(t=>e.step(t))}function Gp(e,t,n,r){let i=[],a=0;e.doc.nodesBetween(t,n,(e,o)=>{if(!e.isInline)return;a++;let s=null;if(r instanceof Yf){let t=e.marks,n;for(;n=r.isInSet(t);)(s||=[]).push(n),t=n.removeFromSet(t)}else r?r.isInSet(e.marks)&&(s=[r]):s=e.marks;if(s&&s.length){let r=Math.min(o+e.nodeSize,n);for(let e=0;e<s.length;e++){let n=s[e],c;for(let e=0;e<i.length;e++){let t=i[e];t.step==a-1&&n.eq(i[e].style)&&(c=t)}c?(c.to=r,c.step=a):i.push({style:n,from:Math.max(o,t),to:r,step:a})}}}),i.forEach(t=>e.step(new Rp(t.from,t.to,t.style)))}function Kp(e,t,n,r=n.contentMatch,i=!0){let a=e.doc.nodeAt(t),o=[],s=t+1;for(let t=0;t<a.childCount;t++){let c=a.child(t),l=s+c.nodeSize,u=r.matchType(c.type);if(!u)o.push(new Vp(s,l,X.empty));else{r=u;for(let t=0;t<c.marks.length;t++)n.allowsMarkType(c.marks[t].type)||e.step(new Rp(s,l,c.marks[t]));if(i&&c.isText&&n.whitespace!=`pre`){let e,t=/\r?\n|\r/g,r;for(;e=t.exec(c.text);)r||=new X(J.from(n.schema.text(` `,n.allowedMarks(c.marks))),0,0),o.push(new Vp(s+e.index,s+e.index+e[0].length,r))}}s=l}if(!r.validEnd){let t=r.fillBefore(J.empty,!0);e.replace(s,s,new X(t,0,0))}for(let t=o.length-1;t>=0;t--)e.step(o[t])}function qp(e,t,n){return(t==0||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function Jp(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth,r=0,i=0;;--n){let a=e.$from.node(n),o=e.$from.index(n)+r,s=e.$to.indexAfter(n)-i;if(n<e.depth&&a.canReplace(o,s,t))return n;if(n==0||a.type.spec.isolating||!qp(a,o,s))break;o&&(r=1),s<a.childCount&&(i=1)}return null}function Yp(e,t,n){let{$from:r,$to:i,depth:a}=t,o=r.before(a+1),s=i.after(a+1),c=o,l=s,u=J.empty,d=0;for(let e=a,t=!1;e>n;e--)t||r.index(e)>0?(t=!0,u=J.from(r.node(e).copy(u)),d++):c--;let f=J.empty,p=0;for(let e=a,t=!1;e>n;e--)t||i.after(e+1)<i.end(e)?(t=!0,f=J.from(i.node(e).copy(f)),p++):l++;e.step(new Hp(c,l,o,s,new X(u.append(f),d,p),u.size-d,!0))}function Xp(e,t,n){let r=J.empty;for(let e=n.length-1;e>=0;e--){if(r.size){let t=n[e].type.contentMatch.matchFragment(r);if(!t||!t.validEnd)throw RangeError(`Wrapper type given to Transform.wrap does not form valid content of its parent wrapper`)}r=J.from(n[e].type.create(n[e].attrs,r))}let i=t.start,a=t.end;e.step(new Hp(i,a,i,a,new X(r,0,0),n.length,!0))}function Zp(e,t,n,r,i){if(!r.isTextblock)throw RangeError(`Type given to setBlockType should be a textblock`);let a=e.steps.length;e.doc.nodesBetween(t,n,(t,n)=>{let o=typeof i==`function`?i(t):i;if(t.isTextblock&&!t.hasMarkup(r,o)&&em(e.doc,e.mapping.slice(a).map(n),r)){let i=null;if(r.schema.linebreakReplacement){let e=r.whitespace==`pre`,t=!!r.contentMatch.matchType(r.schema.linebreakReplacement);e&&!t?i=!1:!e&&t&&(i=!0)}i===!1&&$p(e,t,n,a),Kp(e,e.mapping.slice(a).map(n,1),r,void 0,i===null);let s=e.mapping.slice(a),c=s.map(n,1),l=s.map(n+t.nodeSize,1);return e.step(new Hp(c,l,c+1,l-1,new X(J.from(r.create(o,null,t.marks)),0,0),1,!0)),i===!0&&Qp(e,t,n,a),!1}})}function Qp(e,t,n,r){t.forEach((i,a)=>{if(i.isText){let o,s=/\r?\n|\r/g;for(;o=s.exec(i.text);){let i=e.mapping.slice(r).map(n+1+a+o.index);e.replaceWith(i,i+1,t.type.schema.linebreakReplacement.create())}}})}function $p(e,t,n,r){t.forEach((i,a)=>{if(i.type==i.type.schema.linebreakReplacement){let i=e.mapping.slice(r).map(n+1+a);e.replaceWith(i,i+1,t.type.schema.text(`
`))}})}function em(e,t,n){let r=e.resolve(t),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function tm(e,t,n,r,i){let a=e.doc.nodeAt(t);if(!a)throw RangeError(`No node at given position`);n||=a.type;let o=n.create(r,null,i||a.marks);if(a.isLeaf)return e.replaceWith(t,t+a.nodeSize,o);if(!n.validContent(a.content))throw RangeError(`Invalid content for node type `+n.name);e.step(new Hp(t,t+a.nodeSize,t+1,t+a.nodeSize-1,new X(J.from(o),0,0),1,!0))}function nm(e,t,n=1,r){let i=e.resolve(t),a=i.depth-n,o=r&&r[r.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let e=i.depth-1,t=n-2;e>a;e--,t--){let n=i.node(e),a=i.index(e);if(n.type.spec.isolating)return!1;let o=n.content.cutByIndex(a,n.childCount),s=r&&r[t+1];s&&(o=o.replaceChild(0,s.type.create(s.attrs)));let c=r&&r[t]||n;if(!n.canReplace(a+1,n.childCount)||!c.type.validContent(o))return!1}let s=i.indexAfter(a),c=r&&r[0];return i.node(a).canReplaceWith(s,s,c?c.type:i.node(a+1).type)}function rm(e,t,n=1,r){let i=e.doc.resolve(t),a=J.empty,o=J.empty;for(let e=i.depth,t=i.depth-n,s=n-1;e>t;e--,s--){a=J.from(i.node(e).copy(a));let t=r&&r[s];o=J.from(t?t.type.create(t.attrs,o):i.node(e).copy(o))}e.step(new Vp(t,t,new X(a.append(o),n,n),!0))}function im(e,t){let n=e.resolve(t),r=n.index();return om(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function am(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:r}=e.type.schema;for(let i=0;i<t.childCount;i++){let a=t.child(i),o=a.type==r?e.type.schema.nodes.text:a.type;if(n=n.matchType(o),!n||!e.type.allowsMarks(a.marks))return!1}return n.validEnd}function om(e,t){return!!(e&&t&&!e.isLeaf&&am(e,t))}function sm(e,t,n){let r=null,{linebreakReplacement:i}=e.doc.type.schema,a=e.doc.resolve(t-n),o=a.node().type;if(i&&o.inlineContent){let e=o.whitespace==`pre`,t=!!o.contentMatch.matchType(i);e&&!t?r=!1:!e&&t&&(r=!0)}let s=e.steps.length;if(r===!1){let r=e.doc.resolve(t+n);$p(e,r.node(),r.before(),s)}o.inlineContent&&Kp(e,t+n-1,o,a.node().contentMatchAt(a.index()),r==null);let c=e.mapping.slice(s),l=c.map(t-n);if(e.step(new Vp(l,c.map(t+n,-1),X.empty,!0)),r===!0){let t=e.doc.resolve(l);Qp(e,t.node(),t.before(),e.steps.length)}return e}function cm(e,t,n){let r=e.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),n))return t;if(r.parentOffset==0)for(let e=r.depth-1;e>=0;e--){let t=r.index(e);if(r.node(e).canReplaceWith(t,t,n))return r.before(e+1);if(t>0)return null}if(r.parentOffset==r.parent.content.size)for(let e=r.depth-1;e>=0;e--){let t=r.indexAfter(e);if(r.node(e).canReplaceWith(t,t,n))return r.after(e+1);if(t<r.node(e).childCount)return null}return null}function lm(e,t,n){let r=e.resolve(t);if(!n.content.size)return t;let i=n.content;for(let e=0;e<n.openStart;e++)i=i.firstChild.content;for(let e=1;e<=(n.openStart==0&&n.size?2:1);e++)for(let t=r.depth;t>=0;t--){let n=t==r.depth?0:r.pos<=(r.start(t+1)+r.end(t+1))/2?-1:1,a=r.index(t)+(n>0?1:0),o=r.node(t),s=!1;if(e==1)s=o.canReplace(a,a,i);else{let e=o.contentMatchAt(a).findWrapping(i.firstChild.type);s=e&&o.canReplaceWith(a,a,e[0])}if(s)return n==0?r.pos:n<0?r.before(t+1):r.after(t+1)}return null}function um(e,t,n=t,r=X.empty){if(t==n&&!r.size)return null;let i=e.resolve(t),a=e.resolve(n);return dm(i,a,r)?new Vp(t,n,r):new fm(i,a,r).fit()}function dm(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}var fm=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=J.empty;for(let t=0;t<=e.depth;t++){let n=e.node(t);this.frontier.push({type:n.type,match:n.contentMatchAt(e.indexAfter(t))})}for(let t=e.depth;t>0;t--)this.placed=J.from(e.node(t).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(e<0?this.$to:n.doc.resolve(e));if(!r)return null;let i=this.placed,a=n.depth,o=r.depth;for(;a&&o&&i.childCount==1;)i=i.firstChild.content,a--,o--;let s=new X(i,a,o);return e>-1?new Hp(n.pos,e,this.$to.pos,this.$to.end(),s,t):s.size||n.pos!=this.$to.pos?new Vp(n.pos,r.pos,s):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let i=t.firstChild;if(t.childCount>1&&(r=0),i.type.spec.isolating&&r<=n){e=n;break}t=i.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let e,r=null;n?(r=hm(this.unplaced.content,n-1).firstChild,e=r.content):e=this.unplaced.content;let i=e.firstChild;for(let e=this.depth;e>=0;e--){let{type:a,match:o}=this.frontier[e],s,c=null;if(t==1&&(i?o.matchType(i.type)||(c=o.fillBefore(J.from(i),!1)):r&&a.compatibleContent(r.type)))return{sliceDepth:n,frontierDepth:e,parent:r,inject:c};if(t==2&&i&&(s=o.findWrapping(i.type)))return{sliceDepth:n,frontierDepth:e,parent:r,wrap:s};if(r&&o.matchType(r.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=hm(e,t);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new X(e,t+1,Math.max(n,r.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=hm(e,t);if(r.childCount<=1&&t>0){let i=e.size-t<=t+r.size;this.unplaced=new X(pm(e,t-1,1),t-1,i?t-1:n)}else this.unplaced=new X(pm(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:r,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let e=0;e<i.length;e++)this.openFrontierNode(i[e]);let a=this.unplaced,o=n?n.content:a.content,s=a.openStart-e,c=0,l=[],{match:u,type:d}=this.frontier[t];if(r){for(let e=0;e<r.childCount;e++)l.push(r.child(e));u=u.matchFragment(r)}let f=o.size+e-(a.content.size-a.openEnd);for(;c<o.childCount;){let e=o.child(c),t=u.matchType(e.type);if(!t)break;c++,(c>1||s==0||e.content.size)&&(u=t,l.push(gm(e.mark(d.allowedMarks(e.marks)),c==1?s:0,c==o.childCount?f:-1)))}let p=c==o.childCount;p||(f=-1),this.placed=mm(this.placed,t,J.from(l)),this.frontier[t].match=u,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let e=0,t=o;e<f;e++){let e=t.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),t=e.content}this.unplaced=p?e==0?X.empty:new X(pm(a.content,e-1,1),e-1,f<0?a.openEnd:e-1):new X(pm(a.content,e,c),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!_m(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(e){scan:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:r}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),a=_m(e,t,r,n,i);if(a){for(let n=t-1;n>=0;n--){let{match:t,type:r}=this.frontier[n],i=_m(e,n,r,t,!0);if(!i||i.childCount)continue scan}return{depth:t,fit:a,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=mm(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),r=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,r)}return e}openFrontierNode(e,t=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(e),this.placed=mm(this.placed,this.depth,J.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(J.empty,!0);e.childCount&&(this.placed=mm(this.placed,this.frontier.length,e))}};function pm(e,t,n){return t==0?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(pm(e.firstChild.content,t-1,n)))}function mm(e,t,n){return t==0?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(mm(e.lastChild.content,t-1,n)))}function hm(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function gm(e,t,n){if(t<=0)return e;let r=e.content;return t>1&&(r=r.replaceChild(0,gm(r.firstChild,t-1,r.childCount==1?n-1:0))),t>0&&(r=e.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(e.type.contentMatch.matchFragment(r).fillBefore(J.empty,!0)))),e.copy(r)}function _m(e,t,n,r,i){let a=e.node(t),o=i?e.indexAfter(t):e.index(t);if(o==a.childCount&&!n.compatibleContent(a.type))return null;let s=r.fillBefore(a.content,!0,o);return s&&!vm(n,a.content,o)?s:null}function vm(e,t,n){for(let r=n;r<t.childCount;r++)if(!e.allowsMarks(t.child(r).marks))return!0;return!1}function ym(e){return e.spec.defining||e.spec.definingForContent}function bm(e,t,n,r){if(!r.size)return e.deleteRange(t,n);let i=e.doc.resolve(t),a=e.doc.resolve(n);if(dm(i,a,r))return e.step(new Vp(t,n,r));let o=wm(i,a);o[o.length-1]==0&&o.pop();let s=-(i.depth+1);o.unshift(s);for(let e=i.depth,t=i.pos-1;e>0;e--,t--){let n=i.node(e).type.spec;if(n.defining||n.definingAsContext||n.isolating)break;o.indexOf(e)>-1?s=e:i.before(e)==t&&o.splice(1,0,-e)}let c=o.indexOf(s),l=[],u=r.openStart;for(let e=r.content,t=0;;t++){let n=e.firstChild;if(l.push(n),t==r.openStart)break;e=n.content}for(let e=u-1;e>=0;e--){let t=l[e],n=ym(t.type);if(n&&!t.sameMarkup(i.node(Math.abs(s)-1)))u=e;else if(n||!t.type.isTextblock)break}for(let t=r.openStart;t>=0;t--){let s=(t+u+1)%(r.openStart+1),d=l[s];if(d)for(let t=0;t<o.length;t++){let l=o[(t+c)%o.length],u=!0;l<0&&(u=!1,l=-l);let f=i.node(l-1),p=i.index(l-1);if(f.canReplaceWith(p,p,d.type,d.marks))return e.replace(i.before(l),u?a.after(l):n,new X(xm(r.content,0,r.openStart,s),s,r.openEnd))}}let d=e.steps.length;for(let s=o.length-1;s>=0&&(e.replace(t,n,r),!(e.steps.length>d));s--){let e=o[s];e<0||(t=i.before(e),n=a.after(e))}}function xm(e,t,n,r,i){if(t<n){let i=e.firstChild;e=e.replaceChild(0,i.copy(xm(i.content,t+1,n,r,i)))}if(t>r){let t=i.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(J.empty,!0))}return e}function Sm(e,t,n,r){if(!r.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let i=cm(e.doc,t,r.type);i!=null&&(t=n=i)}e.replaceRange(t,n,new X(J.from(r),0,0))}function Cm(e,t,n){let r=e.doc.resolve(t),i=e.doc.resolve(n),a=wm(r,i);for(let t=0;t<a.length;t++){let n=a[t],o=t==a.length-1;if(o&&n==0||r.node(n).type.contentMatch.validEnd)return e.delete(r.start(n),i.end(n));if(n>0&&(o||r.node(n-1).canReplace(r.index(n-1),i.indexAfter(n-1))))return e.delete(r.before(n),i.after(n))}for(let a=1;a<=r.depth&&a<=i.depth;a++)if(t-r.start(a)==r.depth-a&&n>r.end(a)&&i.end(a)-n!=i.depth-a&&r.start(a-1)==i.start(a-1)&&r.node(a-1).canReplace(r.index(a-1),i.index(a-1)))return e.delete(r.before(a),n);e.delete(t,n)}function wm(e,t){let n=[],r=Math.min(e.depth,t.depth);for(let i=r;i>=0;i--){let r=e.start(i);if(r<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(r==t.start(i)||i==e.depth&&i==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==r-1)&&n.push(i)}return n}var Tm=class e extends Pp{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return Fp.fail(`No node at attribute step's position`);let n=Object.create(null);for(let e in t.attrs)n[e]=t.attrs[e];n[this.attr]=this.value;let r=t.type.create(n,null,t.marks);return Fp.fromReplace(e,this.pos,this.pos+1,new X(J.from(r),0,t.isLeaf?0:1))}getMap(){return jp.empty}invert(t){return new e(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.attr,this.value)}toJSON(){return{stepType:`attr`,pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,n){if(typeof n.pos!=`number`||typeof n.attr!=`string`)throw RangeError(`Invalid input for AttrStep.fromJSON`);return new e(n.pos,n.attr,n.value)}};Pp.jsonID(`attr`,Tm);var Em=class e extends Pp{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let n in e.attrs)t[n]=e.attrs[n];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return Fp.ok(n)}getMap(){return jp.empty}invert(t){return new e(this.attr,t.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:`docAttr`,attr:this.attr,value:this.value}}static fromJSON(t,n){if(typeof n.attr!=`string`)throw RangeError(`Invalid input for DocAttrStep.fromJSON`);return new e(n.attr,n.value)}};Pp.jsonID(`docAttr`,Em);var Dm=class extends Error{};Dm=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},Dm.prototype=Object.create(Error.prototype),Dm.prototype.constructor=Dm,Dm.prototype.name=`TransformError`;var Om=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Mp}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Dm(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=X.empty){let r=um(this.doc,e,t,n);return r&&this.step(r),this}replaceWith(e,t,n){return this.replace(e,t,new X(J.from(n),0,0))}delete(e,t){return this.replace(e,t,X.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return bm(this,e,t,n),this}replaceRangeWith(e,t,n){return Sm(this,e,t,n),this}deleteRange(e,t){return Cm(this,e,t),this}lift(e,t){return Yp(this,e,t),this}join(e,t=1){return sm(this,e,t),this}wrap(e,t){return Xp(this,e,t),this}setBlockType(e,t=e,n,r=null){return Zp(this,e,t,n,r),this}setNodeMarkup(e,t,n=null,r){return tm(this,e,t,n,r),this}setNodeAttribute(e,t,n){return this.step(new Tm(e,t,n)),this}setDocAttribute(e,t){return this.step(new Em(e,t)),this}addNodeMark(e,t){return this.step(new zp(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw RangeError(`No node at position `+e);if(t instanceof Y)t.isInSet(n.marks)&&this.step(new Bp(e,t));else{let r=n.marks,i,a=[];for(;i=t.isInSet(r);)a.push(new Bp(e,i)),r=i.removeFromSet(r);for(let e=a.length-1;e>=0;e--)this.step(a[e])}return this}split(e,t=1,n){return rm(this,e,t,n),this}addMark(e,t,n){return Wp(this,e,t,n),this}removeMark(e,t,n){return Gp(this,e,t,n),this}clearIncompatible(e,t,n){return Kp(this,e,t,n),this}},km=Object.create(null),Z=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Am(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=X.empty){let n=t.content.lastChild,r=null;for(let e=0;e<t.openEnd;e++)r=n,n=n.lastChild;let i=e.steps.length,a=this.ranges;for(let o=0;o<a.length;o++){let{$from:s,$to:c}=a[o],l=e.mapping.slice(i);e.replaceRange(l.map(s.pos),l.map(c.pos),o?X.empty:t),o==0&&Rm(e,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:a,$to:o}=r[i],s=e.mapping.slice(n),c=s.map(a.pos),l=s.map(o.pos);i?e.deleteRange(c,l):(e.replaceRangeWith(c,l,t),Rm(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new Q(e):Lm(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let r=e.depth-1;r>=0;r--){let i=t<0?Lm(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):Lm(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(i)return i}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Fm(e.node(0))}static atStart(e){return Lm(e,e,0,0,1)||new Fm(e)}static atEnd(e){return Lm(e,e,e.content.size,e.childCount,-1)||new Fm(e)}static fromJSON(e,t){if(!t||!t.type)throw RangeError(`Invalid input for Selection.fromJSON`);let n=km[t.type];if(!n)throw RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in km)throw RangeError(`Duplicate use of selection JSON ID `+e);return km[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Q.between(this.$anchor,this.$head).getBookmark()}};Z.prototype.visible=!0;var Am=class{constructor(e,t){this.$from=e,this.$to=t}},jm=!1;function Mm(e){!jm&&!e.parent.inlineContent&&(jm=!0,console.warn(`TextSelection endpoint not pointing into a node with inline content (`+e.parent.type.name+`)`))}var Q=class e extends Z{constructor(e,t=e){Mm(e),Mm(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,n){let r=t.resolve(n.map(this.head));if(!r.parent.inlineContent)return Z.near(r);let i=t.resolve(n.map(this.anchor));return new e(i.parent.inlineContent?i:r,r)}replace(e,t=X.empty){if(super.replace(e,t),t==X.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new Nm(this.anchor,this.head)}toJSON(){return{type:`text`,anchor:this.anchor,head:this.head}}static fromJSON(t,n){if(typeof n.anchor!=`number`||typeof n.head!=`number`)throw RangeError(`Invalid input for TextSelection.fromJSON`);return new e(t.resolve(n.anchor),t.resolve(n.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(t,n,r){let i=t.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let e=Z.findFrom(n,r,!0)||Z.findFrom(n,-r,!0);if(e)n=e.$head;else return Z.near(n,r)}return t.parent.inlineContent||(i==0?t=n:(t=(Z.findFrom(t,-r,!0)||Z.findFrom(t,r,!0)).$anchor,t.pos<n.pos!=i<0&&(t=n))),new e(t,n)}};Z.jsonID(`text`,Q);var Nm=class e{constructor(e,t){this.anchor=e,this.head=t}map(t){return new e(t.map(this.anchor),t.map(this.head))}resolve(e){return Q.between(e.resolve(this.anchor),e.resolve(this.head))}},$=class e extends Z{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(t,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),a=t.resolve(i);return r?Z.near(a):new e(a)}content(){return new X(J.from(this.node),0,0)}eq(t){return t instanceof e&&t.anchor==this.anchor}toJSON(){return{type:`node`,anchor:this.anchor}}getBookmark(){return new Pm(this.anchor)}static fromJSON(t,n){if(typeof n.anchor!=`number`)throw RangeError(`Invalid input for NodeSelection.fromJSON`);return new e(t.resolve(n.anchor))}static create(t,n){return new e(t.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};$.prototype.visible=!1,Z.jsonID(`node`,$);var Pm=class e{constructor(e){this.anchor=e}map(t){let{deleted:n,pos:r}=t.mapResult(this.anchor);return n?new Nm(r,r):new e(r)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&$.isSelectable(n)?new $(t):Z.near(t)}},Fm=class e extends Z{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=X.empty){if(t==X.empty){e.delete(0,e.doc.content.size);let t=Z.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:`all`}}static fromJSON(t){return new e(t)}map(t){return new e(t)}eq(t){return t instanceof e}getBookmark(){return Im}};Z.jsonID(`all`,Fm);var Im={map(){return this},resolve(e){return new Fm(e)}};function Lm(e,t,n,r,i,a=!1){if(t.inlineContent)return Q.create(e,n);for(let o=r-(i>0?0:1);i>0?o<t.childCount:o>=0;o+=i){let r=t.child(o);if(r.isAtom){if(!a&&$.isSelectable(r))return $.create(e,n-(i<0?r.nodeSize:0))}else{let t=Lm(e,r,n+i,i<0?r.childCount:0,i,a);if(t)return t}n+=r.nodeSize*i}return null}function Rm(e,t,n){let r=e.steps.length-1;if(r<t)return;let i=e.steps[r];if(!(i instanceof Vp||i instanceof Hp))return;let a=e.mapping.maps[r],o;a.forEach((e,t,n,r)=>{o??=r}),e.setSelection(Z.near(e.doc.resolve(o),n))}var zm=1,Bm=2,Vm=4,Hm=class extends Om{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw RangeError(`Selection passed to setSelection must point at the current document`);return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|zm)&~Bm,this.storedMarks=null,this}get selectionSet(){return(this.updated&zm)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Bm,this}ensureMarks(e){return Y.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Bm)>0}addStep(e,t){super.addStep(e,t),this.updated&=~Bm,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Y.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(n??=t,!e)return this.deleteRange(t,n);let i=this.storedMarks;if(!i){let e=this.doc.resolve(t);i=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,i)),!this.selection.empty&&this.selection.to==t+e.length&&this.setSelection(Z.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e==`string`?e:e.key]=t,this}getMeta(e){return this.meta[typeof e==`string`?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Vm,this}get scrolledIntoView(){return(this.updated&Vm)>0}};function Um(e,t){return!t||!e?e:e.bind(t)}var Wm=class{constructor(e,t,n){this.name=e,this.init=Um(t.init,n),this.apply=Um(t.apply,n)}},Gm=[new Wm(`doc`,{init(e){return e.doc||e.schema.topNodeType.createAndFill()},apply(e){return e.doc}}),new Wm(`selection`,{init(e,t){return e.selection||Z.atStart(t.doc)},apply(e){return e.selection}}),new Wm(`storedMarks`,{init(e){return e.storedMarks||null},apply(e,t,n,r){return r.selection.$cursor?e.storedMarks:null}}),new Wm(`scrollToSelection`,{init(){return 0},apply(e,t){return e.scrolledIntoView?t+1:t}})],Km=class{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Gm.slice(),t&&t.forEach(e=>{if(this.pluginsByKey[e.key])throw RangeError(`Adding different instances of a keyed plugin (`+e.key+`)`);this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new Wm(e.key,e.spec.state,e))})}},qm=class e{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let i=!1;for(let a=0;a<this.config.plugins.length;a++){let o=this.config.plugins[a];if(o.spec.appendTransaction){let s=r?r[a].n:0,c=r?r[a].state:this,l=s<t.length&&o.spec.appendTransaction.call(o,s?t.slice(s):t,c,n);if(l&&n.filterTransaction(l,a)){if(l.setMeta(`appendedTransaction`,e),!r){r=[];for(let e=0;e<this.config.plugins.length;e++)r.push(e<a?{state:n,n:t.length}:{state:this,n:0})}t.push(l),n=n.applyInner(l),i=!0}r&&(r[a]={state:n,n:t.length})}}if(!i)return{state:n,transactions:t}}}applyInner(t){if(!t.before.eq(this.doc))throw RangeError(`Applying a mismatched transaction`);let n=new e(this.config),r=this.config.fields;for(let e=0;e<r.length;e++){let i=r[e];n[i.name]=i.apply(t,this[i.name],this,n)}return n}get tr(){return new Hm(this)}static create(t){let n=new Km(t.doc?t.doc.type.schema:t.schema,t.plugins),r=new e(n);for(let e=0;e<n.fields.length;e++)r[n.fields[e].name]=n.fields[e].init(t,r);return r}reconfigure(t){let n=new Km(this.schema,t.plugins),r=n.fields,i=new e(n);for(let e=0;e<r.length;e++){let n=r[e].name;i[n]=this.hasOwnProperty(n)?this[n]:r[e].init(t,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(e=>e.toJSON())),e&&typeof e==`object`)for(let n in e){if(n==`doc`||n==`selection`)throw RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],i=r.spec.state;i&&i.toJSON&&(t[n]=i.toJSON.call(r,this[r.key]))}return t}static fromJSON(t,n,r){if(!n)throw RangeError(`Invalid input for EditorState.fromJSON`);if(!t.schema)throw RangeError(`Required config field 'schema' missing`);let i=new Km(t.schema,t.plugins),a=new e(i);return i.fields.forEach(e=>{if(e.name==`doc`)a.doc=Tf.fromJSON(t.schema,n.doc);else if(e.name==`selection`)a.selection=Z.fromJSON(a.doc,n.selection);else if(e.name==`storedMarks`)n.storedMarks&&(a.storedMarks=n.storedMarks.map(t.schema.markFromJSON));else{if(r)for(let i in r){let o=r[i],s=o.spec.state;if(o.key==e.name&&s&&s.fromJSON&&Object.prototype.hasOwnProperty.call(n,i)){a[e.name]=s.fromJSON.call(o,t,n[i],a);return}}a[e.name]=e.init(t,a)}}),a}};function Jm(e,t,n){for(let r in e){let i=e[r];i instanceof Function?i=i.bind(t):r==`handleDOMEvents`&&(i=Jm(i,t,{})),n[r]=i}return n}var Ym=class{constructor(e){this.spec=e,this.props={},e.props&&Jm(e.props,this,this.props),this.key=e.key?e.key.key:Zm(`plugin`)}getState(e){return e[this.key]}},Xm=Object.create(null);function Zm(e){return e in Xm?e+`$`+ ++Xm[e]:(Xm[e]=0,e+`$`)}var Qm=class{constructor(e=`key`){this.key=Zm(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}},$m=function(e){for(var t=0;;t++)if(e=e.previousSibling,!e)return t},eh=function(e){let t=e.assignedSlot||e.parentNode;return t&&t.nodeType==11?t.host:t},th=null,nh=function(e,t,n){let r=th||=document.createRange();return r.setEnd(e,n??e.nodeValue.length),r.setStart(e,t||0),r},rh=function(){th=null},ih=function(e,t,n,r){return n&&(oh(e,t,n,r,-1)||oh(e,t,n,r,1))},ah=/^(img|br|input|textarea|hr)$/i;function oh(e,t,n,r,i){for(;;){if(e==n&&t==r)return!0;if(t==(i<0?0:sh(e))){let n=e.parentNode;if(!n||n.nodeType!=1||dh(e)||ah.test(e.nodeName)||e.contentEditable==`false`)return!1;t=$m(e)+(i<0?0:1),e=n}else if(e.nodeType==1){let n=e.childNodes[t+(i<0?-1:0)];if(n.nodeType==1&&n.contentEditable==`false`)if(n.pmViewDesc?.ignoreForSelection)t+=i;else return!1;else e=n,t=i<0?sh(e):0}else return!1}}function sh(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function ch(e,t){for(;;){if(e.nodeType==3&&t)return e;if(e.nodeType==1&&t>0){if(e.contentEditable==`false`)return null;e=e.childNodes[t-1],t=sh(e)}else if(e.parentNode&&!dh(e))t=$m(e),e=e.parentNode;else return null}}function lh(e,t){for(;;){if(e.nodeType==3&&t<e.nodeValue.length)return e;if(e.nodeType==1&&t<e.childNodes.length){if(e.contentEditable==`false`)return null;e=e.childNodes[t],t=0}else if(e.parentNode&&!dh(e))t=$m(e)+1,e=e.parentNode;else return null}}function uh(e,t,n){for(let r=t==0,i=t==sh(e);r||i;){if(e==n)return!0;let t=$m(e);if(e=e.parentNode,!e)return!1;r&&=t==0,i&&=t==sh(e)}}function dh(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}var fh=function(e){return e.focusNode&&ih(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function ph(e,t){let n=document.createEvent(`Event`);return n.initEvent(`keydown`,!0,!0),n.keyCode=e,n.key=n.code=t,n}function mh(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function hh(e,t,n){if(e.caretPositionFromPoint)try{let r=e.caretPositionFromPoint(t,n);if(r)return{node:r.offsetNode,offset:Math.min(sh(r.offsetNode),r.offset)}}catch{}if(e.caretRangeFromPoint){let r=e.caretRangeFromPoint(t,n);if(r)return{node:r.startContainer,offset:Math.min(sh(r.startContainer),r.startOffset)}}}var gh=typeof navigator<`u`?navigator:null,_h=typeof document<`u`?document:null,vh=gh&&gh.userAgent||``,yh=/Edge\/(\d+)/.exec(vh),bh=/MSIE \d/.exec(vh),xh=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(vh),Sh=!!(bh||xh||yh),Ch=bh?document.documentMode:xh?+xh[1]:yh?+yh[1]:0,wh=!Sh&&/gecko\/(\d+)/i.test(vh);wh&&+(/Firefox\/(\d+)/.exec(vh)||[0,0])[1];var Th=!Sh&&/Chrome\/(\d+)/.exec(vh),Eh=!!Th,Dh=Th?+Th[1]:0,Oh=!Sh&&!!gh&&/Apple Computer/.test(gh.vendor),kh=Oh&&(/Mobile\/\w+/.test(vh)||!!gh&&gh.maxTouchPoints>2),Ah=kh||(gh?/Mac/.test(gh.platform):!1),jh=gh?/Win/.test(gh.platform):!1,Mh=/Android \d/.test(vh),Nh=!!_h&&`webkitFontSmoothing`in _h.documentElement.style,Ph=Nh?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Fh(e){let t=e.defaultView&&e.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function Ih(e,t){return typeof e==`number`?e:e[t]}function Lh(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,r=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*r}}function Rh(e,t,n){let r=e.someProp(`scrollThreshold`)||0,i=e.someProp(`scrollMargin`)||5,a=e.dom.ownerDocument;for(let o=n||e.dom;o;){if(o.nodeType!=1){o=eh(o);continue}let e=o,n=e==a.body,s=n?Fh(a):Lh(e),c=0,l=0;if(t.top<s.top+Ih(r,`top`)?l=-(s.top-t.top+Ih(i,`top`)):t.bottom>s.bottom-Ih(r,`bottom`)&&(l=t.bottom-t.top>s.bottom-s.top?t.top+Ih(i,`top`)-s.top:t.bottom-s.bottom+Ih(i,`bottom`)),t.left<s.left+Ih(r,`left`)?c=-(s.left-t.left+Ih(i,`left`)):t.right>s.right-Ih(r,`right`)&&(c=t.right-s.right+Ih(i,`right`)),c||l)if(n)a.defaultView.scrollBy(c,l);else{let n=e.scrollLeft,r=e.scrollTop;l&&(e.scrollTop+=l),c&&(e.scrollLeft+=c);let i=e.scrollLeft-n,a=e.scrollTop-r;t={left:t.left-i,top:t.top-a,right:t.right-i,bottom:t.bottom-a}}let u=n?`fixed`:getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(u))break;o=u==`absolute`?o.offsetParent:eh(o)}}function zh(e){let t=e.dom.getBoundingClientRect(),n=Math.max(0,t.top),r,i;for(let a=(t.left+t.right)/2,o=n+1;o<Math.min(innerHeight,t.bottom);o+=5){let t=e.root.elementFromPoint(a,o);if(!t||t==e.dom||!e.dom.contains(t))continue;let s=t.getBoundingClientRect();if(s.top>=n-20){r=t,i=s.top;break}}return{refDOM:r,refTop:i,stack:Bh(e.dom)}}function Bh(e){let t=[],n=e.ownerDocument;for(let r=e;r&&(t.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),e!=n);r=eh(r));return t}function Vh({refDOM:e,refTop:t,stack:n}){let r=e?e.getBoundingClientRect().top:0;Hh(n,r==0?0:r-t)}function Hh(e,t){for(let n=0;n<e.length;n++){let{dom:r,top:i,left:a}=e[n];r.scrollTop!=i+t&&(r.scrollTop=i+t),r.scrollLeft!=a&&(r.scrollLeft=a)}}var Uh=null;function Wh(e){if(e.setActive)return e.setActive();if(Uh)return e.focus(Uh);let t=Bh(e);e.focus(Uh==null?{get preventScroll(){return Uh={preventScroll:!0},!0}}:void 0),Uh||(Uh=!1,Hh(t,0))}function Gh(e,t){let n,r=2e8,i,a=0,o=t.top,s=t.top,c,l;for(let u=e.firstChild,d=0;u;u=u.nextSibling,d++){let e;if(u.nodeType==1)e=u.getClientRects();else if(u.nodeType==3)e=nh(u).getClientRects();else continue;for(let f=0;f<e.length;f++){let p=e[f];if(p.top<=o&&p.bottom>=s){o=Math.max(p.bottom,o),s=Math.min(p.top,s);let e=p.left>t.left?p.left-t.left:p.right<t.left?t.left-p.right:0;if(e<r){n=u,r=e,i=e&&n.nodeType==3?{left:p.right<t.left?p.right:p.left,top:t.top}:t,u.nodeType==1&&e&&(a=d+(t.left>=(p.left+p.right)/2?1:0));continue}}else p.top>t.top&&!c&&p.left<=t.left&&p.right>=t.left&&(c=u,l={left:Math.max(p.left,Math.min(p.right,t.left)),top:p.top});!n&&(t.left>=p.right&&t.top>=p.top||t.left>=p.left&&t.top>=p.bottom)&&(a=d+1)}}return!n&&c&&(n=c,i=l,r=0),n&&n.nodeType==3?Kh(n,i):!n||r&&n.nodeType==1?{node:e,offset:a}:Gh(n,i)}function Kh(e,t){let n=e.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(e,i+1),r.setStart(e,i);let n=eg(r,1);if(n.top!=n.bottom&&qh(t,n))return{node:e,offset:i+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}function qh(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function Jh(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}function Yh(e,t,n){let{node:r,offset:i}=Gh(t,n),a=-1;if(r.nodeType==1&&!r.firstChild){let e=r.getBoundingClientRect();a=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(r,i,a)}function Xh(e,t,n,r){let i=-1;for(let n=t,a=!1;n!=e.dom;){let t=e.docView.nearestDesc(n,!0),o;if(!t)return null;if(t.dom.nodeType==1&&(t.node.isBlock&&t.parent||!t.contentDOM)&&((o=t.dom.getBoundingClientRect()).width||o.height)&&(t.node.isBlock&&t.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(t.dom.nodeName)&&(!a&&o.left>r.left||o.top>r.top?i=t.posBefore:(!a&&o.right<r.left||o.bottom<r.top)&&(i=t.posAfter),a=!0),!t.contentDOM&&i<0&&!t.node.isText))return(t.node.isBlock?r.top<(o.top+o.bottom)/2:r.left<(o.left+o.right)/2)?t.posBefore:t.posAfter;n=t.dom.parentNode}return i>-1?i:e.docView.posFromDOM(t,n,-1)}function Zh(e,t,n){let r=e.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(t.top-n.top)/(n.bottom-n.top))-2)),a=i;;){let n=e.childNodes[a];if(n.nodeType==1){let e=n.getClientRects();for(let r=0;r<e.length;r++){let i=e[r];if(qh(t,i))return Zh(n,t,i)}}if((a=(a+1)%r)==i)break}return e}function Qh(e,t){let n=e.dom.ownerDocument,r,i=0,a=hh(n,t.left,t.top);a&&({node:r,offset:i}=a);let o=(e.root.elementFromPoint?e.root:n).elementFromPoint(t.left,t.top),s;if(!o||!e.dom.contains(o.nodeType==1?o:o.parentNode)){let n=e.dom.getBoundingClientRect();if(!qh(t,n)||(o=Zh(e.dom,t,n),!o))return null}if(Oh)for(let e=o;r&&e;e=eh(e))e.draggable&&(r=void 0);if(o=Jh(o,t),r){if(wh&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let e=r.childNodes[i],n;e.nodeName==`IMG`&&(n=e.getBoundingClientRect()).right<=t.left&&n.bottom>t.top&&i++}let n;Nh&&i&&r.nodeType==1&&(n=r.childNodes[i-1]).nodeType==1&&n.contentEditable==`false`&&n.getBoundingClientRect().top>=t.top&&i--,r==e.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&t.top>r.lastChild.getBoundingClientRect().bottom?s=e.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!=`BR`)&&(s=Xh(e,r,i,t))}s??=Yh(e,o,t);let c=e.docView.nearestDesc(o,!0);return{pos:s,inside:c?c.posAtStart-c.border:-1}}function $h(e){return e.top<e.bottom||e.left<e.right}function eg(e,t){let n=e.getClientRects();if(n.length){let e=n[t<0?0:n.length-1];if($h(e))return e}return Array.prototype.find.call(n,$h)||e.getBoundingClientRect()}var tg=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function ng(e,t,n){let{node:r,offset:i,atom:a}=e.docView.domFromPos(t,n<0?-1:1),o=Nh||wh;if(r.nodeType==3)if(o&&(tg.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let e=eg(nh(r,i,i),n);if(wh&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let t=eg(nh(r,i-1,i-1),-1);if(t.top==e.top){let n=eg(nh(r,i,i+1),-1);if(n.top!=e.top)return rg(n,n.left<t.left)}}return e}else{let e=i,t=i,a=n<0?1:-1;return n<0&&!i?(t++,a=-1):n>=0&&i==r.nodeValue.length?(e--,a=1):n<0?e--:t++,rg(eg(nh(r,e,t),a),a<0)}if(!e.state.doc.resolve(t-(a||0)).parent.inlineContent){if(a==null&&i&&(n<0||i==sh(r))){let e=r.childNodes[i-1];if(e.nodeType==1)return ig(e.getBoundingClientRect(),!1)}if(a==null&&i<sh(r)){let e=r.childNodes[i];if(e.nodeType==1)return ig(e.getBoundingClientRect(),!0)}return ig(r.getBoundingClientRect(),n>=0)}if(a==null&&i&&(n<0||i==sh(r))){let e=r.childNodes[i-1],t=e.nodeType==3?nh(e,sh(e)-(o?0:1)):e.nodeType==1&&(e.nodeName!=`BR`||!e.nextSibling)?e:null;if(t)return rg(eg(t,1),!1)}if(a==null&&i<sh(r)){let e=r.childNodes[i];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?e.nodeType==3?nh(e,0,o?0:1):e.nodeType==1?e:null:null;if(t)return rg(eg(t,-1),!0)}return rg(eg(r.nodeType==3?nh(r):r,-n),n>=0)}function rg(e,t){if(e.width==0)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function ig(e,t){if(e.height==0)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function ag(e,t,n){let r=e.state,i=e.root.activeElement;r!=t&&e.updateState(t),i!=e.dom&&e.focus();try{return n()}finally{r!=t&&e.updateState(r),i!=e.dom&&i&&i.focus()}}function og(e,t,n){let r=t.selection,i=n==`up`?r.$from:r.$to;return ag(e,t,()=>{let{node:t}=e.docView.domFromPos(i.pos,n==`up`?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let r=ng(e,i.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(e.nodeType==1)t=e.getClientRects();else if(e.nodeType==3)t=nh(e,0,e.nodeValue.length).getClientRects();else continue;for(let e=0;e<t.length;e++){let i=t[e];if(i.bottom>i.top+1&&(n==`up`?r.top-i.top>(i.bottom-r.top)*2:i.bottom-r.bottom>(r.bottom-i.top)*2))return!1}}return!0})}var sg=/[\u0590-\u08ac]/;function cg(e,t,n){let{$head:r}=t.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,a=!i,o=i==r.parent.content.size,s=e.domSelection();return s?!sg.test(r.parent.textContent)||!s.modify?n==`left`||n==`backward`?a:o:ag(e,t,()=>{let{focusNode:t,focusOffset:i,anchorNode:a,anchorOffset:o}=e.domSelectionRange(),c=s.caretBidiLevel;s.modify(`move`,n,`character`);let l=r.depth?e.docView.domAfterPos(r.before()):e.dom,{focusNode:u,focusOffset:d}=e.domSelectionRange(),f=u&&!l.contains(u.nodeType==1?u:u.parentNode)||t==u&&i==d;try{s.collapse(a,o),t&&(t!=a||i!=o)&&s.extend&&s.extend(t,i)}catch{}return c!=null&&(s.caretBidiLevel=c),f}):r.pos==r.start()||r.pos==r.end()}var lg=null,ug=null,dg=!1;function fg(e,t,n){return lg==t&&ug==n?dg:(lg=t,ug=n,dg=n==`up`||n==`down`?og(e,t,n):cg(e,t,n))}var pg=0,mg=1,hg=2,gg=3,_g=class{constructor(e,t,n,r){this.parent=e,this.children=t,this.dom=n,this.contentDOM=r,this.dirty=pg,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let r=this.children[t];if(r==e)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let n,r;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&!((r=n.pmViewDesc)&&r.parent==this);)n=n.previousSibling;return n?this.posBeforeChild(r)+r.size:this.posAtStart}else{let n,r;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&!((r=n.pmViewDesc)&&r.parent==this);)n=n.nextSibling;return n?this.posBeforeChild(r):this.posAtEnd}let r;if(e==this.dom&&this.contentDOM)r=t>$m(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let t=e;;t=t.parentNode){if(t==this.dom){r=!1;break}if(t.previousSibling)break}if(r==null&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){r=!0;break}if(t.nextSibling)break}}return r??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,r=e;r;r=r.parentNode){let i=this.getDesc(r),a;if(i&&(!t||i.node))if(n&&(a=i.nodeDOM)&&!(a.nodeType==1?a.contains(e.nodeType==1?e:e.parentNode):a==e))n=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let e=t;e;e=e.parent)if(e==this)return t}posFromDOM(e,t,n){for(let r=e;r;r=r.parentNode){let i=this.getDesc(r);if(i)return i.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let r=this.children[t],i=n+r.size;if(n==e&&i!=n){for(;!r.border&&r.children.length;)for(let e=0;e<r.children.length;e++){let t=r.children[e];if(t.size){r=t;break}}return r}if(e<i)return r.descAt(e-n-r.border);n=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,r=0;for(let t=0;n<this.children.length;n++){let i=this.children[n],a=t+i.size;if(a>e||i instanceof wg){r=e-t;break}t=a}if(r)return this.children[n].domFromPos(r-this.children[n].border,t);for(let e;n&&!(e=this.children[n-1]).size&&e instanceof vg&&e.side>=0;n--);if(t<=0){let e,r=!0;for(;e=n?this.children[n-1]:null,!(!e||e.dom.parentNode==this.contentDOM);n--,r=!1);return e&&t&&r&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?$m(e.dom)+1:0}}else{let e,r=!0;for(;e=n<this.children.length?this.children[n]:null,!(!e||e.dom.parentNode==this.contentDOM);n++,r=!1);return e&&r&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?$m(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,i=-1;for(let a=n,o=0;;o++){let n=this.children[o],s=a+n.size;if(r==-1&&e<=s){let i=a+n.border;if(e>=i&&t<=s-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,i);e=a;for(let t=o;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){r=$m(n.dom)+1;break}e-=n.size}r==-1&&(r=0)}if(r>-1&&(s>t||o==this.children.length-1)){t=s;for(let e=o+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){i=$m(n.dom);break}t+=n.size}i==-1&&(i=this.contentDOM.childNodes.length);break}a=s}return{node:this.contentDOM,from:e,to:t,fromOffset:r,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(t.nodeType!=1||n==t.childNodes.length)throw RangeError(`No node after pos `+e);return t.childNodes[n]}setSelection(e,t,n,r=!1){let i=Math.min(e,t),a=Math.max(e,t);for(let o=0,s=0;o<this.children.length;o++){let c=this.children[o],l=s+c.size;if(i>s&&a<l)return c.setSelection(e-s-c.border,t-s-c.border,n,r);s=l}let o=this.domFromPos(e,e?-1:1),s=t==e?o:this.domFromPos(t,t?-1:1),c=n.root.getSelection(),l=n.domSelectionRange(),u=!1;if((wh||Oh)&&e==t){let{node:e,offset:t}=o;if(e.nodeType==3){if(u=!!(t&&e.nodeValue[t-1]==`
`),u&&t==e.nodeValue.length)for(let t=e,n;t;t=t.parentNode){if(n=t.nextSibling){n.nodeName==`BR`&&(o=s={node:n.parentNode,offset:$m(n)+1});break}let e=t.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];u=n&&(n.nodeName==`BR`||n.contentEditable==`false`)}}if(wh&&l.focusNode&&l.focusNode!=s.node&&l.focusNode.nodeType==1){let e=l.focusNode.childNodes[l.focusOffset];e&&e.contentEditable==`false`&&(r=!0)}if(!(r||u&&Oh)&&ih(o.node,o.offset,l.anchorNode,l.anchorOffset)&&ih(s.node,s.offset,l.focusNode,l.focusOffset))return;let d=!1;if((c.extend||e==t)&&!(u&&wh)){c.collapse(o.node,o.offset);try{e!=t&&c.extend(s.node,s.offset),d=!0}catch{}}if(!d){if(e>t){let e=o;o=s,s=e}let n=document.createRange();n.setEnd(s.node,s.offset),n.setStart(o.node,o.offset),c.removeAllRanges(),c.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&e.type!=`selection`}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,r=0;r<this.children.length;r++){let i=this.children[r],a=n+i.size;if(n==a?e<=a&&t>=n:e<a&&t>n){let r=n+i.border,o=a-i.border;if(e>=r&&t<=o){this.dirty=e==n||t==a?hg:mg,e==r&&t==o&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=gg:i.markDirty(e-r,t-r);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?hg:gg}n=a}this.dirty=hg}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=e==1?hg:mg;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}},vg=class extends _g{constructor(e,t,n,r){let i,a=t.type.toDOM;if(typeof a==`function`&&(a=a(n,()=>{if(!i)return r;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(a.nodeType!=1){let e=document.createElement(`span`);e.appendChild(a),a=e}a.contentEditable=`false`,a.classList.add(`ProseMirror-widget`)}super(e,[],a,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==pg&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!=`selection`||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}},yg=class extends _g{constructor(e,t,n,r){super(e,[],t,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(e,t){return e==this.textDOM?this.posAtStart+t:this.posAtStart+(t?this.size:0)}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type===`characterData`&&e.target.nodeValue==e.oldValue}},bg=class e extends _g{constructor(e,t,n,r,i){super(e,[],n,r),this.mark=t,this.spec=i}static create(t,n,r,i){let a=i.nodeViews[n.type.name],o=a&&a(n,i,r);return(!o||!o.dom)&&(o=mp.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new e(t,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&gg||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=gg&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=pg){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=pg}}slice(t,n,r){let i=e.create(this.parent,this.mark,!0,r),a=this.children,o=this.size;n<o&&(a=Vg(a,n,o,r)),t>0&&(a=Vg(a,0,t,r));for(let e=0;e<a.length;e++)a[e].parent=i;return i.children=a,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}},xg=class e extends _g{constructor(e,t,n,r,i,a,o,s,c){super(e,[],i,a),this.node=t,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=o}static create(t,n,r,i,a,o){let s=a.nodeViews[n.type.name],c,l=s&&s(n,a,()=>{if(!c)return o;if(c.parent)return c.parent.posBeforeChild(c)},r,i),u=l&&l.dom,d=l&&l.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw RangeError(`Text must be rendered as a DOM text node`)}else if(!u){let e=mp.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs);({dom:u,contentDOM:d}=e)}!d&&!n.isText&&u.nodeName!=`BR`&&(u.hasAttribute(`contenteditable`)||(u.contentEditable=`false`),n.type.spec.draggable&&(u.draggable=!0));let f=u;return u=Mg(u,r,n),l?c=new Tg(t,n,r,i,u,d||null,f,l,a,o+1):n.isText?new Cg(t,n,r,i,u,f,a):new e(t,n,r,i,u,d||null,f,a,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace==`pre`&&(e.preserveWhitespace=`full`),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>J.empty)}return e}matchesNode(e,t,n){return this.dirty==pg&&e.eq(this.node)&&Ng(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,r=t,i=e.composing?this.localCompositionInfo(e,t):null,a=i&&i.pos>-1?i:null,o=i&&i.pos<0,s=new Fg(this,a&&a.node,e);Rg(this.node,this.innerDeco,(t,i,a)=>{t.spec.marks?s.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!a&&s.syncToMarks(i==this.node.childCount?Y.none:this.node.child(i).marks,n,e),s.placeWidget(t,e,r)},(t,a,c,l)=>{s.syncToMarks(t.marks,n,e);let u;s.findNodeMatch(t,a,c,l)||o&&e.state.selection.from>r&&e.state.selection.to<r+t.nodeSize&&(u=s.findIndexWithChild(i.node))>-1&&s.updateNodeAt(t,a,c,u,e)||s.updateNextNode(t,a,c,e,l,r)||s.addNode(t,a,c,e,r),r+=t.nodeSize}),s.syncToMarks([],n,e),this.node.isTextblock&&s.addTextblockHacks(),s.destroyRest(),(s.changed||this.dirty==hg)&&(a&&this.protectLocalComposition(e,a),Eg(this.contentDOM,this.children,e),kh&&zg(this.dom))}localCompositionInfo(e,t){let{from:n,to:r}=e.state.selection;if(!(e.state.selection instanceof Q)||n<t||r>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let e=i.nodeValue,a=Bg(this.node.content,e,n-t,r-t);return a<0?null:{node:i,pos:a,text:e}}else return{node:i,pos:-1,text:``}}protectLocalComposition(e,{node:t,pos:n,text:r}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&=void 0}let a=new yg(this,i,t,r);e.input.compositionNodes.push(a),this.children=Vg(this.children,n,n+r.length,e,a)}update(e,t,n,r){return this.dirty==gg||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,n,r),!0)}updateInner(e,t,n,r){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=pg}updateOuterDeco(e){if(Ng(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=Ag(this.dom,this.nodeDOM,kg(this.outerDeco,this.node,t),kg(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add(`ProseMirror-selectednode`),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove(`ProseMirror-selectednode`),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute(`draggable`))}get domAtom(){return this.node.isAtom}};function Sg(e,t,n,r,i){Mg(r,t,e);let a=new xg(void 0,e,t,n,r,r,r,i,0);return a.contentDOM&&a.updateChildren(i,0),a}var Cg=class e extends xg{constructor(e,t,n,r,i,a,o){super(e,t,n,r,i,null,a,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,r){return this.dirty==gg||this.dirty!=pg&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=pg||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=e,this.dirty=pg,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return e.type!=`characterData`&&e.type!=`selection`}slice(t,n,r){let i=this.node.cut(t,n),a=document.createTextNode(i.text);return new e(this.parent,i,this.outerDeco,this.innerDeco,a,a,r)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=gg)}get domAtom(){return!1}isText(e){return this.node.text==e}},wg=class extends _g{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==pg&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName==`IMG`}},Tg=class extends xg{constructor(e,t,n,r,i,a,o,s,c,l){super(e,t,n,r,i,a,o,c,l),this.spec=s}update(e,t,n,r){if(this.dirty==gg)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,n);return i&&this.updateInner(e,t,n,r),i}else if(!this.contentDOM&&!e.isLeaf)return!1;else return super.update(e,t,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,r){this.spec.setSelection?this.spec.setSelection(e,t,n.root):super.setSelection(e,t,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}};function Eg(e,t,n){let r=e.firstChild,i=!1;for(let a=0;a<t.length;a++){let o=t[a],s=o.dom;if(s.parentNode==e){for(;s!=r;)r=Pg(r),i=!0;r=r.nextSibling}else i=!0,e.insertBefore(s,r);if(o instanceof bg){let t=r?r.previousSibling:e.lastChild;Eg(o.contentDOM,o.children,n),r=t?t.nextSibling:e.firstChild}}for(;r;)r=Pg(r),i=!0;i&&n.trackWrites==e&&(n.trackWrites=null)}var Dg=function(e){e&&(this.nodeName=e)};Dg.prototype=Object.create(null);var Og=[new Dg];function kg(e,t,n){if(e.length==0)return Og;let r=n?Og[0]:new Dg,i=[r];for(let a=0;a<e.length;a++){let o=e[a].type.attrs;if(o)for(let e in o.nodeName&&i.push(r=new Dg(o.nodeName)),o){let a=o[e];a!=null&&(n&&i.length==1&&i.push(r=new Dg(t.isInline?`span`:`div`)),e==`class`?r.class=(r.class?r.class+` `:``)+a:e==`style`?r.style=(r.style?r.style+`;`:``)+a:e!=`nodeName`&&(r[e]=a))}}return i}function Ag(e,t,n,r){if(n==Og&&r==Og)return t;let i=t;for(let t=0;t<r.length;t++){let a=r[t],o=n[t];if(t){let t;o&&o.nodeName==a.nodeName&&i!=e&&(t=i.parentNode)&&t.nodeName.toLowerCase()==a.nodeName?i=t:(t=document.createElement(a.nodeName),t.pmIsDeco=!0,t.appendChild(i),o=Og[0],i=t)}jg(i,o||Og[0],a)}return i}function jg(e,t,n){for(let r in t)r!=`class`&&r!=`style`&&r!=`nodeName`&&!(r in n)&&e.removeAttribute(r);for(let r in n)r!=`class`&&r!=`style`&&r!=`nodeName`&&n[r]!=t[r]&&e.setAttribute(r,n[r]);if(t.class!=n.class){let r=t.class?t.class.split(` `).filter(Boolean):[],i=n.class?n.class.split(` `).filter(Boolean):[];for(let t=0;t<r.length;t++)i.indexOf(r[t])==-1&&e.classList.remove(r[t]);for(let t=0;t<i.length;t++)r.indexOf(i[t])==-1&&e.classList.add(i[t]);e.classList.length==0&&e.removeAttribute(`class`)}if(t.style!=n.style){if(t.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,r;for(;r=n.exec(t.style);)e.style.removeProperty(r[1])}n.style&&(e.style.cssText+=n.style)}}function Mg(e,t,n){return Ag(e,e,Og,kg(t,n,e.nodeType!=1))}function Ng(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function Pg(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}var Fg=class{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Ig(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let r=0,i=this.stack.length>>1,a=Math.min(i,e.length);for(;r<a&&(r==i-1?this.top:this.stack[r+1<<1]).matchesMark(e[r])&&e[r].type.spec.spanning!==!1;)r++;for(;r<i;)this.destroyRest(),this.top.dirty=pg,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let r=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[i])&&!this.isLocked(n.dom)){r=t;break}}if(r>-1)r>this.index&&(this.changed=!0,this.destroyBetween(this.index,r)),this.top=this.top.children[this.index];else{let r=bg.create(this.top,e[i],t,n);this.top.children.splice(this.index,0,r),this.top=r,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,n,r){let i=-1,a;if(r>=this.preMatch.index&&(a=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&a.matchesNode(e,t,n))i=this.top.children.indexOf(a,this.index);else for(let r=this.index,a=Math.min(this.top.children.length,r+5);r<a;r++){let a=this.top.children[r];if(a.matchesNode(e,t,n)&&!this.preMatch.matched.has(a)){i=r;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,n,r,i){let a=this.top.children[r];return a.dirty==gg&&a.dom==a.contentDOM&&(a.dirty=hg),a.update(e,t,n,i)?(this.destroyBetween(this.index,r),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t){for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e}return-1}e=t}}updateNextNode(e,t,n,r,i,a){for(let o=this.index;o<this.top.children.length;o++){let s=this.top.children[o];if(s instanceof xg){let c=this.preMatch.matched.get(s);if(c!=null&&c!=i)return!1;let l=s.dom,u,d=this.isLocked(l)&&!(e.isText&&s.node&&s.node.isText&&s.nodeDOM.nodeValue==e.text&&s.dirty!=gg&&Ng(t,s.outerDeco));if(!d&&s.update(e,t,n,r))return this.destroyBetween(this.index,o),s.dom!=l&&(this.changed=!0),this.index++,!0;if(!d&&(u=this.recreateWrapper(s,e,t,n,r,a)))return this.destroyBetween(this.index,o),this.top.children[this.index]=u,u.contentDOM&&(u.dirty=hg,u.updateChildren(r,a+1),u.dirty=pg),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,r,i,a){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!Ng(n,e.outerDeco)||!r.eq(e.innerDeco))return null;let o=xg.create(this.top,t,n,r,i,a);if(o.contentDOM){o.children=e.children,e.children=[];for(let e of o.children)e.parent=o}return e.destroy(),o}addNode(e,t,n,r,i){let a=xg.create(this.top,e,t,n,r,i);a.contentDOM&&a.updateChildren(r,i+1),this.top.children.splice(this.index++,0,a),this.changed=!0}placeWidget(e,t,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(r&&r.matchesWidget(e)&&(e==r.widget||!r.widget.type.toDOM.parentNode))this.index++;else{let r=new vg(this.top,e,t,n);this.top.children.splice(this.index++,0,r),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof bg;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Cg)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Oh||Eh)&&e&&e.dom.contentEditable==`false`&&this.addHackNode(`IMG`,t),this.addHackNode(`BR`,this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e==`IMG`&&(n.className=`ProseMirror-separator`,n.alt=``),e==`BR`&&(n.className=`ProseMirror-trailingBreak`);let r=new wg(this.top,[],n,null);t==this.top?t.children.splice(this.index++,0,r):t.children.push(r),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}};function Ig(e,t){let n=t,r=n.children.length,i=e.childCount,a=new Map,o=[];outer:for(;i>0;){let s;for(;;)if(r){let e=n.children[r-1];if(e instanceof bg)n=e,r=e.children.length;else{s=e,r--;break}}else if(n==t)break outer;else r=n.parent.children.indexOf(n),n=n.parent;let c=s.node;if(c){if(c!=e.child(i-1))break;--i,a.set(s,i),o.push(s)}}return{index:i,matched:a,matches:o.reverse()}}function Lg(e,t){return e.type.side-t.type.side}function Rg(e,t,n,r){let i=t.locals(e),a=0;if(i.length==0){for(let n=0;n<e.childCount;n++){let o=e.child(n);r(o,i,t.forChild(a,o),n),a+=o.nodeSize}return}let o=0,s=[],c=null;for(let l=0;;){let u,d;for(;o<i.length&&i[o].to==a;){let e=i[o++];e.widget&&(u?(d||=[u]).push(e):u=e)}if(u)if(d){d.sort(Lg);for(let e=0;e<d.length;e++)n(d[e],l,!!c)}else n(u,l,!!c);let f,p;if(c)p=-1,f=c,c=null;else if(l<e.childCount)p=l,f=e.child(l++);else break;for(let e=0;e<s.length;e++)s[e].to<=a&&s.splice(e--,1);for(;o<i.length&&i[o].from<=a&&i[o].to>a;)s.push(i[o++]);let m=a+f.nodeSize;if(f.isText){let e=m;o<i.length&&i[o].from<e&&(e=i[o].from);for(let t=0;t<s.length;t++)s[t].to<e&&(e=s[t].to);e<m&&(c=f.cut(e-a),f=f.cut(0,e-a),m=e,p=-1)}else for(;o<i.length&&i[o].to<m;)o++;let h=f.isInline&&!f.isLeaf?s.filter(e=>!e.inline):s.slice();r(f,h,t.forChild(a,f),p),a=m}}function zg(e){if(e.nodeName==`UL`||e.nodeName==`OL`){let t=e.style.cssText;e.style.cssText=t+`; list-style: square !important`,window.getComputedStyle(e).listStyle,e.style.cssText=t}}function Bg(e,t,n,r){for(let i=0,a=0;i<e.childCount&&a<=r;){let o=e.child(i++),s=a;if(a+=o.nodeSize,!o.isText)continue;let c=o.text;for(;i<e.childCount;){let t=e.child(i++);if(a+=t.nodeSize,!t.isText)break;c+=t.text}if(a>=n){if(a>=r&&c.slice(r-t.length-s,r-s)==t)return r-t.length;let e=s<r?c.lastIndexOf(t,r-s-1):-1;if(e>=0&&e+t.length+s>=n)return s+e;if(n==r&&c.length>=r+t.length-s&&c.slice(r-s,r-s+t.length)==t)return r}}return-1}function Vg(e,t,n,r,i){let a=[];for(let o=0,s=0;o<e.length;o++){let c=e[o],l=s,u=s+=c.size;l>=n||u<=t?a.push(c):(l<t&&a.push(c.slice(0,t-l,r)),i&&=(a.push(i),void 0),u>n&&a.push(c.slice(n-l,c.size,r)))}return a}function Hg(e,t=null){let n=e.domSelectionRange(),r=e.state.doc;if(!n.focusNode)return null;let i=e.docView.nearestDesc(n.focusNode),a=i&&i.size==0,o=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let s=r.resolve(o),c,l;if(fh(n)){for(c=o;i&&!i.node;)i=i.parent;let e=i.node;if(i&&e.isAtom&&$.isSelectable(e)&&i.parent&&!(e.isInline&&uh(n.focusNode,n.focusOffset,i.dom))){let e=i.posBefore;l=new $(o==e?s:r.resolve(e))}}else{if(n instanceof e.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let t=o,i=o;for(let r=0;r<n.rangeCount;r++){let a=n.getRangeAt(r);t=Math.min(t,e.docView.posFromDOM(a.startContainer,a.startOffset,1)),i=Math.max(i,e.docView.posFromDOM(a.endContainer,a.endOffset,-1))}if(t<0)return null;[c,o]=i==e.state.selection.anchor?[i,t]:[t,i],s=r.resolve(o)}else c=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(c<0)return null}let u=r.resolve(c);if(!l){let n=t==`pointer`||e.state.selection.head<s.pos&&!a?1:-1;l=$g(e,u,s,n)}return l}function Ug(e){return e.editable?e.hasFocus():t_(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function Wg(e,t=!1){let n=e.state.selection;if(Zg(e,n),Ug(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&Eh){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&ih(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset)){e.input.mouseDown.delayedSelectionSync=!0,e.domObserver.setCurSelection();return}}if(e.domObserver.disconnectSelection(),e.cursorWrapper)Xg(e);else{let{anchor:r,head:i}=n,a,o;Gg&&!(n instanceof Q)&&(n.$from.parent.inlineContent||(a=Kg(e,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=Kg(e,n.to))),e.docView.setSelection(r,i,e,t),Gg&&(a&&Jg(a),o&&Jg(o)),n.visible?e.dom.classList.remove(`ProseMirror-hideselection`):(e.dom.classList.add(`ProseMirror-hideselection`),`onselectionchange`in document&&Yg(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}var Gg=Oh||Eh&&Dh<63;function Kg(e,t){let{node:n,offset:r}=e.docView.domFromPos(t,0),i=r<n.childNodes.length?n.childNodes[r]:null,a=r?n.childNodes[r-1]:null;if(Oh&&i&&i.contentEditable==`false`)return qg(i);if((!i||i.contentEditable==`false`)&&(!a||a.contentEditable==`false`)){if(i)return qg(i);if(a)return qg(a)}}function qg(e){return e.contentEditable=`true`,Oh&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Jg(e){e.contentEditable=`false`,e.wasDraggable&&=(e.draggable=!0,null)}function Yg(e){let t=e.dom.ownerDocument;t.removeEventListener(`selectionchange`,e.input.hideSelectionGuard);let n=e.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;t.addEventListener(`selectionchange`,e.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(t.removeEventListener(`selectionchange`,e.input.hideSelectionGuard),setTimeout(()=>{(!Ug(e)||e.state.selection.visible)&&e.dom.classList.remove(`ProseMirror-hideselection`)},20))})}function Xg(e){let t=e.domSelection();if(!t)return;let n=e.cursorWrapper.dom,r=n.nodeName==`IMG`;r?t.collapse(n.parentNode,$m(n)+1):t.collapse(n,0),!r&&!e.state.selection.visible&&Sh&&Ch<=11&&(n.disabled=!0,n.disabled=!1)}function Zg(e,t){if(t instanceof $){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(Qg(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else Qg(e)}function Qg(e){e.lastSelectedViewDesc&&=(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),void 0)}function $g(e,t,n,r){return e.someProp(`createSelectionBetween`,r=>r(e,t,n))||Q.between(t,n,r)}function e_(e){return e.editable&&!e.hasFocus()?!1:t_(e)}function t_(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function n_(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return ih(t.node,t.offset,n.anchorNode,n.anchorOffset)}function r_(e,t){let{$anchor:n,$head:r}=e.selection,i=t>0?n.max(r):n.min(r),a=i.parent.inlineContent?i.depth?e.doc.resolve(t>0?i.after():i.before()):null:i;return a&&Z.findFrom(a,t)}function i_(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function a_(e,t,n){let r=e.state.selection;if(r instanceof Q)if(n.indexOf(`s`)>-1){let{$head:n}=r,i=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let a=e.state.doc.resolve(n.pos+i.nodeSize*(t<0?-1:1));return i_(e,new Q(r.$anchor,a))}else if(r.empty){if(e.endOfTextblock(t>0?`forward`:`backward`)){let n=r_(e.state,t);return n&&n instanceof $?i_(e,n):!1}else if(!(Ah&&n.indexOf(`m`)>-1)){let n=r.$head,i=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter,a;if(!i||i.isText)return!1;let o=t<0?n.pos-i.nodeSize:n.pos;return i.isAtom||(a=e.docView.descAt(o))&&!a.contentDOM?$.isSelectable(i)?i_(e,new $(t<0?e.state.doc.resolve(n.pos-i.nodeSize):n)):Nh?i_(e,new Q(e.state.doc.resolve(t<0?o:o+i.nodeSize))):!1:!1}}else return!1;else if(r instanceof $&&r.node.isInline)return i_(e,new Q(t>0?r.$to:r.$from));else{let n=r_(e.state,t);return n?i_(e,n):!1}}function o_(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function s_(e,t){let n=e.pmViewDesc;return n&&n.size==0&&(t<0||e.nextSibling||e.nodeName!=`BR`)}function c_(e,t){return t<0?l_(e):u_(e)}function l_(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let i,a,o=!1;for(wh&&n.nodeType==1&&r<o_(n)&&s_(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let e=n.childNodes[r-1];if(s_(e,-1))i=n,a=--r;else if(e.nodeType==3)n=e,r=n.nodeValue.length;else break}}else if(d_(n))break;else{let t=n.previousSibling;for(;t&&s_(t,-1);)i=n.parentNode,a=$m(t),t=t.previousSibling;if(t)n=t,r=o_(n);else{if(n=n.parentNode,n==e.dom)break;r=0}}o?m_(e,n,r):i&&m_(e,i,a)}function u_(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let i=o_(n),a,o;for(;;)if(r<i){if(n.nodeType!=1)break;let e=n.childNodes[r];if(s_(e,1))a=n,o=++r;else break}else if(d_(n))break;else{let t=n.nextSibling;for(;t&&s_(t,1);)a=t.parentNode,o=$m(t)+1,t=t.nextSibling;if(t)n=t,r=0,i=o_(n);else{if(n=n.parentNode,n==e.dom)break;r=i=0}}a&&m_(e,a,o)}function d_(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function f_(e,t){for(;e&&t==e.childNodes.length&&!dh(e);)t=$m(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable==`false`)break;e=n,t=0}}function p_(e,t){for(;e&&!t&&!dh(e);)t=$m(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable==`false`)break;e=n,t=e.childNodes.length}}function m_(e,t,n){if(t.nodeType!=3){let e,r;(r=f_(t,n))?(t=r,n=0):(e=p_(t,n))&&(t=e,n=e.nodeValue.length)}let r=e.domSelection();if(!r)return;if(fh(r)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),r.removeAllRanges(),r.addRange(e)}else r.extend&&r.extend(t,n);e.domObserver.setCurSelection();let{state:i}=e;setTimeout(()=>{e.state==i&&Wg(e)},50)}function h_(e,t){let n=e.state.doc.resolve(t);if(!(Eh||jh)&&n.parent.inlineContent){let r=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),i=(n.top+n.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(n.left-r.left)>1)return n.left<r.left?`ltr`:`rtl`}if(t<n.end()){let n=e.coordsAtPos(t+1),i=(n.top+n.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(n.left-r.left)>1)return n.left>r.left?`ltr`:`rtl`}}return getComputedStyle(e.dom).direction==`rtl`?`rtl`:`ltr`}function g_(e,t,n){let r=e.state.selection;if(r instanceof Q&&!r.empty||n.indexOf(`s`)>-1||Ah&&n.indexOf(`m`)>-1)return!1;let{$from:i,$to:a}=r;if(!i.parent.inlineContent||e.endOfTextblock(t<0?`up`:`down`)){let n=r_(e.state,t);if(n&&n instanceof $)return i_(e,n)}if(!i.parent.inlineContent){let n=t<0?i:a,o=r instanceof Fm?Z.near(n,t):Z.findFrom(n,t);return o?i_(e,o):!1}return!1}function __(e,t){if(!(e.state.selection instanceof Q))return!0;let{$head:n,$anchor:r,empty:i}=e.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(e.endOfTextblock(t>0?`forward`:`backward`))return!0;let a=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(a&&!a.isText){let r=e.state.tr;return t<0?r.delete(n.pos-a.nodeSize,n.pos):r.delete(n.pos,n.pos+a.nodeSize),e.dispatch(r),!0}return!1}function v_(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function y_(e){if(!Oh||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&t.nodeType==1&&n==0&&t.firstChild&&t.firstChild.contentEditable==`false`){let n=t.firstChild;v_(e,n,`true`),setTimeout(()=>v_(e,n,`false`),20)}return!1}function b_(e){let t=``;return e.ctrlKey&&(t+=`c`),e.metaKey&&(t+=`m`),e.altKey&&(t+=`a`),e.shiftKey&&(t+=`s`),t}function x_(e,t){let n=t.keyCode,r=b_(t);if(n==8||Ah&&n==72&&r==`c`)return __(e,-1)||c_(e,-1);if(n==46&&!t.shiftKey||Ah&&n==68&&r==`c`)return __(e,1)||c_(e,1);if(n==13||n==27)return!0;if(n==37||Ah&&n==66&&r==`c`){let t=n==37?h_(e,e.state.selection.from)==`ltr`?-1:1:-1;return a_(e,t,r)||c_(e,t)}else if(n==39||Ah&&n==70&&r==`c`){let t=n==39?h_(e,e.state.selection.from)==`ltr`?1:-1:1;return a_(e,t,r)||c_(e,t)}else if(n==38||Ah&&n==80&&r==`c`)return g_(e,-1,r)||c_(e,-1);else if(n==40||Ah&&n==78&&r==`c`)return y_(e)||g_(e,1,r)||c_(e,1);else if(r==(Ah?`m`:`c`)&&(n==66||n==73||n==89||n==90))return!0;return!1}function S_(e,t){e.someProp(`transformCopied`,n=>{t=n(t,e)});let n=[],{content:r,openStart:i,openEnd:a}=t;for(;i>1&&a>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,a--;let e=r.firstChild;n.push(e.type.name,e.attrs==e.type.defaultAttrs?null:e.attrs),r=e.content}let o=e.someProp(`clipboardSerializer`)||mp.fromSchema(e.state.schema),s=N_(),c=s.createElement(`div`);c.appendChild(o.serializeFragment(r,{document:s}));let l=c.firstChild,u,d=0;for(;l&&l.nodeType==1&&(u=j_[l.nodeName.toLowerCase()]);){for(let e=u.length-1;e>=0;e--){let t=s.createElement(u[e]);for(;c.firstChild;)t.appendChild(c.firstChild);c.appendChild(t),d++}l=c.firstChild}l&&l.nodeType==1&&l.setAttribute(`data-pm-slice`,`${i} ${a}${d?` -${d}`:``} ${JSON.stringify(n)}`);let f=e.someProp(`clipboardTextSerializer`,n=>n(t,e))||t.content.textBetween(0,t.content.size,`

`);return{dom:c,text:f,slice:t}}function C_(e,t,n,r,i){let a=i.parent.type.spec.code,o,s;if(!n&&!t)return null;let c=!!t&&(r||a||!n);if(c){if(e.someProp(`transformPastedText`,n=>{t=n(t,a||r,e)}),a)return s=new X(J.from(e.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0),e.someProp(`transformPasted`,t=>{s=t(s,e,!0)}),s;let n=e.someProp(`clipboardTextParser`,n=>n(t,i,r,e));if(n)s=n;else{let n=i.marks(),{schema:r}=e.state,a=mp.fromSchema(r);o=document.createElement(`div`),t.split(/(?:\r\n?|\n)+/).forEach(e=>{let t=o.appendChild(document.createElement(`p`));e&&t.appendChild(a.serializeNode(r.text(e,n)))})}}else e.someProp(`transformPastedHTML`,t=>{n=t(n,e)}),o=I_(n),Nh&&L_(o);let l=o&&o.querySelector(`[data-pm-slice]`),u=l&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(l.getAttribute(`data-pm-slice`)||``);if(u&&u[3])for(let e=+u[3];e>0;e--){let e=o.firstChild;for(;e&&e.nodeType!=1;)e=e.nextSibling;if(!e)break;o=e}if(s||=(e.someProp(`clipboardParser`)||e.someProp(`domParser`)||ep.fromSchema(e.state.schema)).parseSlice(o,{preserveWhitespace:!!(c||u),context:i,ruleFromNode(e){return e.nodeName==`BR`&&!e.nextSibling&&e.parentNode&&!w_.test(e.parentNode.nodeName)?{ignore:!0}:null}}),u)s=R_(A_(s,+u[1],+u[2]),u[4]);else if(s=X.maxOpen(T_(s.content,i),!0),s.openStart||s.openEnd){let e=0,t=0;for(let t=s.content.firstChild;e<s.openStart&&!t.type.spec.isolating;e++,t=t.firstChild);for(let e=s.content.lastChild;t<s.openEnd&&!e.type.spec.isolating;t++,e=e.lastChild);s=A_(s,e,t)}return e.someProp(`transformPasted`,t=>{s=t(s,e,c)}),s}var w_=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function T_(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let r=t.node(n).contentMatchAt(t.index(n)),i,a=[];if(e.forEach(e=>{if(!a)return;let t=r.findWrapping(e.type),n;if(!t)return a=null;if(n=a.length&&i.length&&D_(t,i,e,a[a.length-1],0))a[a.length-1]=n;else{a.length&&(a[a.length-1]=O_(a[a.length-1],i.length));let n=E_(e,t);a.push(n),r=r.matchType(n.type),i=t}}),a)return J.from(a)}return e}function E_(e,t,n=0){for(let r=t.length-1;r>=n;r--)e=t[r].create(null,J.from(e));return e}function D_(e,t,n,r,i){if(i<e.length&&i<t.length&&e[i]==t[i]){let a=D_(e,t,n,r.lastChild,i+1);if(a)return r.copy(r.content.replaceChild(r.childCount-1,a));if(r.contentMatchAt(r.childCount).matchType(i==e.length-1?n.type:e[i+1]))return r.copy(r.content.append(J.from(E_(n,e,i+1))))}}function O_(e,t){if(t==0)return e;let n=e.content.replaceChild(e.childCount-1,O_(e.lastChild,t-1)),r=e.contentMatchAt(e.childCount).fillBefore(J.empty,!0);return e.copy(n.append(r))}function k_(e,t,n,r,i,a){let o=t<0?e.firstChild:e.lastChild,s=o.content;return e.childCount>1&&(a=0),i<r-1&&(s=k_(s,t,n,r,i+1,a)),i>=n&&(s=t<0?o.contentMatchAt(0).fillBefore(s,a<=i).append(s):s.append(o.contentMatchAt(o.childCount).fillBefore(J.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,o.copy(s))}function A_(e,t,n){return t<e.openStart&&(e=new X(k_(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new X(k_(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}var j_={thead:[`table`],tbody:[`table`],tfoot:[`table`],caption:[`table`],colgroup:[`table`],col:[`table`,`colgroup`],tr:[`table`,`tbody`],td:[`table`,`tbody`,`tr`],th:[`table`,`tbody`,`tr`]},M_=null;function N_(){return M_||=document.implementation.createHTMLDocument(`title`)}var P_=null;function F_(e){let t=window.trustedTypes;return t?(P_||=t.defaultPolicy||t.createPolicy(`ProseMirrorClipboard`,{createHTML:e=>e}),P_.createHTML(e)):e}function I_(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n=N_().createElement(`div`),r=/<([a-z][^>\s]+)/i.exec(e),i;if((i=r&&j_[r[1].toLowerCase()])&&(e=i.map(e=>`<`+e+`>`).join(``)+e+i.map(e=>`</`+e+`>`).reverse().join(``)),n.innerHTML=F_(e),i)for(let e=0;e<i.length;e++)n=n.querySelector(i[e])||n;return n}function L_(e){let t=e.querySelectorAll(Eh?`span:not([class]):not([style])`:`span.Apple-converted-space`);for(let n=0;n<t.length;n++){let r=t[n];r.childNodes.length==1&&r.textContent==`\xA0`&&r.parentNode&&r.parentNode.replaceChild(e.ownerDocument.createTextNode(` `),r)}}function R_(e,t){if(!e.size)return e;let n=e.content.firstChild.type.schema,r;try{r=JSON.parse(t)}catch{return e}let{content:i,openStart:a,openEnd:o}=e;for(let e=r.length-2;e>=0;e-=2){let t=n.nodes[r[e]];if(!t||t.hasRequiredAttrs())break;i=J.from(t.create(r[e+1],i)),a++,o++}return new X(i,a,o)}var z_={},B_={},V_={touchstart:!0,touchmove:!0},H_=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:``,button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function U_(e){for(let t in z_){let n=z_[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{J_(e,t)&&!q_(e,t)&&(e.editable||!(t.type in B_))&&n(e,t)},V_[t]?{passive:!0}:void 0)}Oh&&e.dom.addEventListener(`input`,()=>null),K_(e)}function W_(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function G_(e){for(let t in e.domObserver.stop(),e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}function K_(e){e.someProp(`handleDOMEvents`,t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>q_(e,t))})}function q_(e,t){return e.someProp(`handleDOMEvents`,n=>{let r=n[t.type];return r?r(e,t)||t.defaultPrevented:!1})}function J_(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function Y_(e,t){!q_(e,t)&&z_[t.type]&&(e.editable||!(t.type in B_))&&z_[t.type](e,t)}B_.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=n.keyCode==16||n.shiftKey,!lv(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!(Mh&&Eh&&n.keyCode==13)))if(n.keyCode!=229&&e.domObserver.forceFlush(),kh&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{e.input.lastIOSEnter==t&&(e.someProp(`handleKeyDown`,t=>t(e,ph(13,`Enter`))),e.input.lastIOSEnter=0)},200)}else e.someProp(`handleKeyDown`,t=>t(e,n))||x_(e,n)?n.preventDefault():W_(e,`key`)},B_.keyup=(e,t)=>{t.keyCode==16&&(e.input.shiftKey=!1)},B_.keypress=(e,t)=>{let n=t;if(lv(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ah&&n.metaKey)return;if(e.someProp(`handleKeyPress`,t=>t(e,n))){n.preventDefault();return}let r=e.state.selection;if(!(r instanceof Q)||!r.$from.sameParent(r.$to)){let t=String.fromCharCode(n.charCode),i=()=>e.state.tr.insertText(t).scrollIntoView();!/[\r\n]/.test(t)&&!e.someProp(`handleTextInput`,n=>n(e,r.$from.pos,r.$to.pos,t,i))&&e.dispatch(i()),n.preventDefault()}};function X_(e){return{left:e.clientX,top:e.clientY}}function Z_(e,t){let n=t.x-e.clientX,r=t.y-e.clientY;return n*n+r*r<100}function Q_(e,t,n,r,i){if(r==-1)return!1;let a=e.state.doc.resolve(r);for(let r=a.depth+1;r>0;r--)if(e.someProp(t,t=>r>a.depth?t(e,n,a.nodeAfter,a.before(r),i,!0):t(e,n,a.node(r),a.before(r),i,!1)))return!0;return!1}function $_(e,t,n){if(e.focused||e.focus(),e.state.selection.eq(t))return;let r=e.state.tr.setSelection(t);n==`pointer`&&r.setMeta(`pointer`,!0),e.dispatch(r)}function ev(e,t){if(t==-1)return!1;let n=e.state.doc.resolve(t),r=n.nodeAfter;return r&&r.isAtom&&$.isSelectable(r)?($_(e,new $(n),`pointer`),!0):!1}function tv(e,t){if(t==-1)return!1;let n=e.state.selection,r,i;n instanceof $&&(r=n.node);let a=e.state.doc.resolve(t);for(let e=a.depth+1;e>0;e--){let t=e>a.depth?a.nodeAfter:a.node(e);if($.isSelectable(t)){i=r&&n.$from.depth>0&&e>=n.$from.depth&&a.before(n.$from.depth+1)==n.$from.pos?a.before(n.$from.depth):a.before(e);break}}return i==null?!1:($_(e,$.create(e.state.doc,i),`pointer`),!0)}function nv(e,t,n,r,i){return Q_(e,`handleClickOn`,t,n,r)||e.someProp(`handleClick`,n=>n(e,t,r))||(i?tv(e,n):ev(e,n))}function rv(e,t,n,r){return Q_(e,`handleDoubleClickOn`,t,n,r)||e.someProp(`handleDoubleClick`,n=>n(e,t,r))}function iv(e,t,n,r){return Q_(e,`handleTripleClickOn`,t,n,r)||e.someProp(`handleTripleClick`,n=>n(e,t,r))||av(e,n,r)}function av(e,t,n){if(n.button!=0)return!1;let r=e.state.doc;if(t==-1)return r.inlineContent?($_(e,Q.create(r,0,r.content.size),`pointer`),!0):!1;let i=r.resolve(t);for(let t=i.depth+1;t>0;t--){let n=t>i.depth?i.nodeAfter:i.node(t),a=i.before(t);if(n.inlineContent)$_(e,Q.create(r,a+1,a+1+n.content.size),`pointer`);else if($.isSelectable(n))$_(e,$.create(r,a),`pointer`);else continue;return!0}}function ov(e){return hv(e)}var sv=Ah?`metaKey`:`ctrlKey`;z_.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let r=ov(e),i=Date.now(),a=`singleClick`;i-e.input.lastClick.time<500&&Z_(n,e.input.lastClick)&&!n[sv]&&e.input.lastClick.button==n.button&&(e.input.lastClick.type==`singleClick`?a=`doubleClick`:e.input.lastClick.type==`doubleClick`&&(a=`tripleClick`)),e.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:a,button:n.button};let o=e.posAtCoords(X_(n));o&&(a==`singleClick`?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new cv(e,o,n,!!r)):(a==`doubleClick`?rv:iv)(e,o.pos,o.inside,n)?n.preventDefault():W_(e,`pointer`))};var cv=class{constructor(e,t,n,r){this.view=e,this.pos=t,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[sv],this.allowDefault=n.shiftKey;let i,a;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),a=t.inside;else{let n=e.state.doc.resolve(t.pos);i=n.parent,a=n.depth?n.before():0}let o=r?null:n.target,s=o?e.docView.nearestDesc(o,!0):null;this.target=s&&s.nodeDOM.nodeType==1?s.nodeDOM:null;let{selection:c}=e.state;(n.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof $&&c.from<=a&&c.to>a)&&(this.mightDrag={node:i,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&wh&&!this.target.hasAttribute(`contentEditable`))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute(`contentEditable`,`false`)},20),this.view.domObserver.start()),e.root.addEventListener(`mouseup`,this.up=this.up.bind(this)),e.root.addEventListener(`mousemove`,this.move=this.move.bind(this)),W_(e,`pointer`)}done(){this.view.root.removeEventListener(`mouseup`,this.up),this.view.root.removeEventListener(`mousemove`,this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute(`draggable`),this.mightDrag.setUneditable&&this.target.removeAttribute(`contentEditable`),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Wg(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(X_(e))),this.updateAllowDefault(e),this.allowDefault||!t?W_(this.view,`pointer`):nv(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Oh&&this.mightDrag&&!this.mightDrag.node.isAtom||Eh&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?($_(this.view,Z.near(this.view.state.doc.resolve(t.pos)),`pointer`),e.preventDefault()):W_(this.view,`pointer`)}move(e){this.updateAllowDefault(e),W_(this.view,`pointer`),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}};z_.touchstart=e=>{e.input.lastTouch=Date.now(),ov(e),W_(e,`pointer`)},z_.touchmove=e=>{e.input.lastTouch=Date.now(),W_(e,`pointer`)},z_.contextmenu=e=>ov(e);function lv(e,t){return e.composing?!0:Oh&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500?(e.input.compositionEndedAt=-2e8,!0):!1}var uv=Mh?5e3:-1;B_.compositionstart=B_.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$to;if(t.selection instanceof Q&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(e=>e.type.spec.inclusive===!1)))e.markCursor=e.state.storedMarks||n.marks(),hv(e,!0),e.markCursor=null;else if(hv(e,!t.selection.empty),wh&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,r=t.focusOffset;n&&n.nodeType==1&&r!=0;){let t=r<0?n.lastChild:n.childNodes[r-1];if(!t)break;if(t.nodeType==3){let n=e.domSelection();n&&n.collapse(t,t.nodeValue.length);break}else n=t,r=-1}}e.input.composing=!0}dv(e,uv)},B_.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then(()=>e.domObserver.flush()),e.input.compositionID++,dv(e,20))};function dv(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout(()=>hv(e),t))}function fv(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=mv());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function pv(e){let t=e.domSelectionRange();if(!t.focusNode)return null;let n=ch(t.focusNode,t.focusOffset),r=lh(t.focusNode,t.focusOffset);if(n&&r&&n!=r){let t=r.pmViewDesc,i=e.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!t||!t.isText(r.nodeValue))return r;if(e.input.compositionNode==r){let e=n.pmViewDesc;if(!(!e||!e.isText(n.nodeValue)))return r}}return n||r}function mv(){let e=document.createEvent(`Event`);return e.initEvent(`event`,!0,!0),e.timeStamp}function hv(e,t=!1){if(!(Mh&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),fv(e),t||e.docView&&e.docView.dirty){let n=Hg(e),r=e.state.selection;return n&&!n.eq(r)?e.dispatch(e.state.tr.setSelection(n)):(e.markCursor||t)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?e.dispatch(e.state.tr.deleteSelection()):e.updateState(e.state),!0}return!1}}function gv(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement(`div`));n.appendChild(t),n.style.cssText=`position: fixed; left: -10000px; top: 10px`;let r=getSelection(),i=document.createRange();i.selectNodeContents(t),e.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()},50)}var _v=Sh&&Ch<15||kh&&Ph<604;z_.copy=B_.cut=(e,t)=>{let n=t,r=e.state.selection,i=n.type==`cut`;if(r.empty)return;let a=_v?null:n.clipboardData,o=r.content(),{dom:s,text:c}=S_(e,o);a?(n.preventDefault(),a.clearData(),a.setData(`text/html`,s.innerHTML),a.setData(`text/plain`,c)):gv(e,s),i&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta(`uiEvent`,`cut`))};function vv(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function yv(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,r=e.dom.parentNode.appendChild(document.createElement(n?`textarea`:`div`));n||(r.contentEditable=`true`),r.style.cssText=`position: fixed; left: -10000px; top: 10px`,r.focus();let i=e.input.shiftKey&&e.input.lastKeyCode!=45;setTimeout(()=>{e.focus(),r.parentNode&&r.parentNode.removeChild(r),n?bv(e,r.value,null,i,t):bv(e,r.textContent,r.innerHTML,i,t)},50)}function bv(e,t,n,r,i){let a=C_(e,t,n,r,e.state.selection.$from);if(e.someProp(`handlePaste`,t=>t(e,i,a||X.empty)))return!0;if(!a)return!1;let o=vv(a),s=o?e.state.tr.replaceSelectionWith(o,r):e.state.tr.replaceSelection(a);return e.dispatch(s.scrollIntoView().setMeta(`paste`,!0).setMeta(`uiEvent`,`paste`)),!0}function xv(e){let t=e.getData(`text/plain`)||e.getData(`Text`);if(t)return t;let n=e.getData(`text/uri-list`);return n?n.replace(/\r?\n/g,` `):``}B_.paste=(e,t)=>{let n=t;if(e.composing&&!Mh)return;let r=_v?null:n.clipboardData,i=e.input.shiftKey&&e.input.lastKeyCode!=45;r&&bv(e,xv(r),r.getData(`text/html`),i,n)?n.preventDefault():yv(e,n)};var Sv=class{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}},Cv=Ah?`altKey`:`ctrlKey`;function wv(e,t){return e.someProp(`dragCopies`,e=>!e(t))??!t[Cv]}for(let e in z_.dragstart=(e,t)=>{let n=t,r=e.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=e.state.selection,a=i.empty?null:e.posAtCoords(X_(n)),o;if(!(a&&a.pos>=i.from&&a.pos<=(i instanceof $?i.to-1:i.to))){if(r&&r.mightDrag)o=$.create(e.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&(o=$.create(e.state.doc,t.posBefore))}}let s=(o||e.state.selection).content(),{dom:c,text:l,slice:u}=S_(e,s);(!n.dataTransfer.files.length||!Eh||Dh>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(_v?`Text`:`text/html`,c.innerHTML),n.dataTransfer.effectAllowed=`copyMove`,_v||n.dataTransfer.setData(`text/plain`,l),e.dragging=new Sv(u,wv(e,n),o)},z_.dragend=e=>{let t=e.dragging;window.setTimeout(()=>{e.dragging==t&&(e.dragging=null)},50)},B_.dragover=B_.dragenter=(e,t)=>t.preventDefault(),B_.drop=(e,t)=>{let n=t,r=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let i=e.posAtCoords(X_(n));if(!i)return;let a=e.state.doc.resolve(i.pos),o=r&&r.slice;o?e.someProp(`transformPasted`,t=>{o=t(o,e,!1)}):o=C_(e,xv(n.dataTransfer),_v?null:n.dataTransfer.getData(`text/html`),!1,a);let s=!!(r&&wv(e,n));if(e.someProp(`handleDrop`,t=>t(e,n,o||X.empty,s))){n.preventDefault();return}if(!o)return;n.preventDefault();let c=o?lm(e.state.doc,a.pos,o):a.pos;c??=a.pos;let l=e.state.tr;if(s){let{node:e}=r;e?e.replace(l):l.deleteSelection()}let u=l.mapping.map(c),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=l.doc;if(d?l.replaceRangeWith(u,u,o.content.firstChild):l.replaceRange(u,u,o),l.doc.eq(f))return;let p=l.doc.resolve(u);if(d&&$.isSelectable(o.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(o.content.firstChild))l.setSelection(new $(p));else{let t=l.mapping.map(c);l.mapping.maps[l.mapping.maps.length-1].forEach((e,n,r,i)=>t=i),l.setSelection($g(e,p,l.doc.resolve(t)))}e.focus(),e.dispatch(l.setMeta(`uiEvent`,`drop`))},z_.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add(`ProseMirror-focused`),e.domObserver.start(),e.focused=!0,setTimeout(()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&Wg(e)},20))},z_.blur=(e,t)=>{let n=t;e.focused&&=(e.domObserver.stop(),e.dom.classList.remove(`ProseMirror-focused`),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),!1)},z_.beforeinput=(e,t)=>{if(Eh&&Mh&&t.inputType==`deleteContentBackward`){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout(()=>{if(e.input.domChangeCount!=t||(e.dom.blur(),e.focus(),e.someProp(`handleKeyDown`,t=>t(e,ph(8,`Backspace`)))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())},50)}},B_)z_[e]=B_[e];function Tv(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}var Ev=class e{constructor(e,t){this.toDOM=e,this.spec=t||jv,this.side=this.spec.side||0}map(e,t,n,r){let{pos:i,deleted:a}=e.mapResult(t.from+r,this.side<0?-1:1);return a?null:new kv(i-n,i-n,this)}valid(){return!0}eq(t){return this==t||t instanceof e&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Tv(this.spec,t.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}},Dv=class e{constructor(e,t){this.attrs=e,this.spec=t||jv}map(e,t,n,r){let i=e.map(t.from+r,this.spec.inclusiveStart?-1:1)-n,a=e.map(t.to+r,this.spec.inclusiveEnd?1:-1)-n;return i>=a?null:new kv(i,a,this)}valid(e,t){return t.from<t.to}eq(t){return this==t||t instanceof e&&Tv(this.attrs,t.attrs)&&Tv(this.spec,t.spec)}static is(t){return t.type instanceof e}destroy(){}},Ov=class e{constructor(e,t){this.attrs=e,this.spec=t||jv}map(e,t,n,r){let i=e.mapResult(t.from+r,1);if(i.deleted)return null;let a=e.mapResult(t.to+r,-1);return a.deleted||a.pos<=i.pos?null:new kv(i.pos-n,a.pos-n,this)}valid(e,t){let{index:n,offset:r}=e.content.findIndex(t.from),i;return r==t.from&&!(i=e.child(n)).isText&&r+i.nodeSize==t.to}eq(t){return this==t||t instanceof e&&Tv(this.attrs,t.attrs)&&Tv(this.spec,t.spec)}destroy(){}},kv=class e{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(t,n){return new e(t,n,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(t,n,r){return new e(t,t,new Ev(n,r))}static inline(t,n,r,i){return new e(t,n,new Dv(r,i))}static node(t,n,r,i){return new e(t,n,new Ov(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Dv}get widget(){return this.type instanceof Ev}},Av=[],jv={},Mv=class e{constructor(e,t){this.local=e.length?e:Av,this.children=t.length?t:Av}static create(e,t){return t.length?Bv(t,e,0,jv):Nv}find(e,t,n){let r=[];return this.findInner(e??0,t??1e9,r,0,n),r}findInner(e,t,n,r,i){for(let a=0;a<this.local.length;a++){let o=this.local[a];o.from<=t&&o.to>=e&&(!i||i(o.spec))&&n.push(o.copy(o.from+r,o.to+r))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<t&&this.children[a+1]>e){let o=this.children[a]+1;this.children[a+2].findInner(e-o,t-o,n,r+o,i)}}map(e,t,n){return this==Nv||e.maps.length==0?this:this.mapInner(e,t,0,0,n||jv)}mapInner(t,n,r,i,a){let o;for(let e=0;e<this.local.length;e++){let s=this.local[e].map(t,r,i);s&&s.type.valid(n,s)?(o||=[]).push(s):a.onRemove&&a.onRemove(this.local[e].spec)}return this.children.length?Fv(this.children,o||[],t,n,r,i,a):o?new e(o.sort(Vv),Av):Nv}add(t,n){return n.length?this==Nv?e.create(t,n):this.addInner(t,n,0):this}addInner(t,n,r){let i,a=0;t.forEach((e,t)=>{let o=t+r,s;if(s=Rv(n,e,o)){for(i||=this.children.slice();a<i.length&&i[a]<t;)a+=3;i[a]==t?i[a+2]=i[a+2].addInner(e,s,o+1):i.splice(a,0,t,t+e.nodeSize,Bv(s,e,o+1,jv)),a+=3}});let o=Iv(a?zv(n):n,-r);for(let e=0;e<o.length;e++)o[e].type.valid(t,o[e])||o.splice(e--,1);return new e(o.length?this.local.concat(o).sort(Vv):this.local,i||this.children)}remove(e){return e.length==0||this==Nv?this:this.removeInner(e,0)}removeInner(t,n){let r=this.children,i=this.local;for(let e=0;e<r.length;e+=3){let i,a=r[e]+n,o=r[e+1]+n;for(let e=0,n;e<t.length;e++)(n=t[e])&&n.from>a&&n.to<o&&(t[e]=null,(i||=[]).push(n));if(!i)continue;r==this.children&&(r=this.children.slice());let s=r[e+2].removeInner(i,a+1);s==Nv?(r.splice(e,3),e-=3):r[e+2]=s}if(i.length){for(let e=0,r;e<t.length;e++)if(r=t[e])for(let e=0;e<i.length;e++)i[e].eq(r,n)&&(i==this.local&&(i=this.local.slice()),i.splice(e--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new e(i,r):Nv}forChild(t,n){if(this==Nv)return this;if(n.isLeaf)return e.empty;let r,i;for(let e=0;e<this.children.length;e+=3)if(this.children[e]>=t){this.children[e]==t&&(r=this.children[e+2]);break}let a=t+1,o=a+n.content.size;for(let e=0;e<this.local.length;e++){let t=this.local[e];if(t.from<o&&t.to>a&&t.type instanceof Dv){let e=Math.max(a,t.from)-a,n=Math.min(o,t.to)-a;e<n&&(i||=[]).push(t.copy(e,n))}}if(i){let t=new e(i.sort(Vv),Av);return r?new Pv([t,r]):t}return r||Nv}eq(t){if(this==t)return!0;if(!(t instanceof e)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(e){return Hv(this.localsInner(e))}localsInner(e){if(this==Nv)return Av;if(e.inlineContent||!this.local.some(Dv.is))return this.local;let t=[];for(let e=0;e<this.local.length;e++)this.local[e].type instanceof Dv||t.push(this.local[e]);return t}forEachSet(e){e(this)}};Mv.empty=new Mv([],[]),Mv.removeOverlap=Hv;var Nv=Mv.empty,Pv=class e{constructor(e){this.members=e}map(t,n){let r=this.members.map(e=>e.map(t,n,jv));return e.from(r)}forChild(t,n){if(n.isLeaf)return Mv.empty;let r=[];for(let i=0;i<this.members.length;i++){let a=this.members[i].forChild(t,n);a!=Nv&&(a instanceof e?r=r.concat(a.members):r.push(a))}return e.from(r)}eq(t){if(!(t instanceof e)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(e){let t,n=!0;for(let r=0;r<this.members.length;r++){let i=this.members[r].localsInner(e);if(i.length)if(!t)t=i;else{n&&=(t=t.slice(),!1);for(let e=0;e<i.length;e++)t.push(i[e])}}return t?Hv(n?t:t.sort(Vv)):Av}static from(t){switch(t.length){case 0:return Nv;case 1:return t[0];default:return new e(t.every(e=>e instanceof Mv)?t:t.reduce((e,t)=>e.concat(t instanceof Mv?t:t.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}};function Fv(e,t,n,r,i,a,o){let s=e.slice();for(let e=0,t=a;e<n.maps.length;e++){let r=0;n.maps[e].forEach((e,n,i,a)=>{let o=a-i-(n-e);for(let i=0;i<s.length;i+=3){let a=s[i+1];if(a<0||e>a+t-r)continue;let c=s[i]+t-r;n>=c?s[i+1]=e<=c?-2:-1:e>=t&&o&&(s[i]+=o,s[i+1]+=o)}r+=o}),t=n.maps[e].map(t,-1)}let c=!1;for(let t=0;t<s.length;t+=3)if(s[t+1]<0){if(s[t+1]==-2){c=!0,s[t+1]=-1;continue}let l=n.map(e[t]+a),u=l-i;if(u<0||u>=r.content.size){c=!0;continue}let d=n.map(e[t+1]+a,-1)-i,{index:f,offset:p}=r.content.findIndex(u),m=r.maybeChild(f);if(m&&p==u&&p+m.nodeSize==d){let r=s[t+2].mapInner(n,m,l+1,e[t]+a+1,o);r==Nv?(s[t+1]=-2,c=!0):(s[t]=u,s[t+1]=d,s[t+2]=r)}else c=!0}if(c){let c=Lv(s,e,t,n,i,a,o),l=Bv(c,r,0,o);t=l.local;for(let e=0;e<s.length;e+=3)s[e+1]<0&&(s.splice(e,3),e-=3);for(let e=0,t=0;e<l.children.length;e+=3){let n=l.children[e];for(;t<s.length&&s[t]<n;)t+=3;s.splice(t,0,l.children[e],l.children[e+1],l.children[e+2])}}return new Mv(t.sort(Vv),s)}function Iv(e,t){if(!t||!e.length)return e;let n=[];for(let r=0;r<e.length;r++){let i=e[r];n.push(new kv(i.from+t,i.to+t,i.type))}return n}function Lv(e,t,n,r,i,a,o){function s(e,t){for(let a=0;a<e.local.length;a++){let s=e.local[a].map(r,i,t);s?n.push(s):o.onRemove&&o.onRemove(e.local[a].spec)}for(let n=0;n<e.children.length;n+=3)s(e.children[n+2],e.children[n]+t+1)}for(let n=0;n<e.length;n+=3)e[n+1]==-1&&s(e[n+2],t[n]+a+1);return n}function Rv(e,t,n){if(t.isLeaf)return null;let r=n+t.nodeSize,i=null;for(let t=0,a;t<e.length;t++)(a=e[t])&&a.from>n&&a.to<r&&((i||=[]).push(a),e[t]=null);return i}function zv(e){let t=[];for(let n=0;n<e.length;n++)e[n]!=null&&t.push(e[n]);return t}function Bv(e,t,n,r){let i=[],a=!1;t.forEach((t,o)=>{let s=Rv(e,t,o+n);if(s){a=!0;let e=Bv(s,t,n+o+1,r);e!=Nv&&i.push(o,o+t.nodeSize,e)}});let o=Iv(a?zv(e):e,-n).sort(Vv);for(let e=0;e<o.length;e++)o[e].type.valid(t,o[e])||(r.onRemove&&r.onRemove(o[e].spec),o.splice(e--,1));return o.length||i.length?new Mv(o,i):Nv}function Vv(e,t){return e.from-t.from||e.to-t.to}function Hv(e){let t=e;for(let n=0;n<t.length-1;n++){let r=t[n];if(r.from!=r.to)for(let i=n+1;i<t.length;i++){let a=t[i];if(a.from==r.from){a.to!=r.to&&(t==e&&(t=e.slice()),t[i]=a.copy(a.from,r.to),Uv(t,i+1,a.copy(r.to,a.to)));continue}else{a.from<r.to&&(t==e&&(t=e.slice()),t[n]=r.copy(r.from,a.from),Uv(t,i,r.copy(a.from,r.to)));break}}}return t}function Uv(e,t,n){for(;t<e.length&&Vv(n,e[t])>0;)t++;e.splice(t,0,n)}function Wv(e){let t=[];return e.someProp(`decorations`,n=>{let r=n(e.state);r&&r!=Nv&&t.push(r)}),e.cursorWrapper&&t.push(Mv.create(e.state.doc,[e.cursorWrapper.deco])),Pv.from(t)}var Gv={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Kv=Sh&&Ch<=11,qv=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}},Jv=class{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new qv,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);Sh&&Ch<=11&&e.some(e=>e.type==`childList`&&e.removedNodes.length||e.type==`characterData`&&e.oldValue.length>e.target.nodeValue.length)?this.flushSoon():this.flush()}),Kv&&(this.onCharData=e=>{this.queue.push({target:e.target,type:`characterData`,oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Gv)),this.onCharData&&this.view.dom.addEventListener(`DOMCharacterDataModified`,this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener(`DOMCharacterDataModified`,this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener(`selectionchange`,this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener(`selectionchange`,this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(e_(this.view)){if(this.suppressingSelectionUpdates)return Wg(this.view);if(Sh&&Ch<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&ih(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,n;for(let n=e.focusNode;n;n=eh(n))t.add(n);for(let r=e.anchorNode;r;r=eh(r))if(t.has(r)){n=r;break}let r=n&&this.view.docView.nearestDesc(n);if(r&&r.ignoreMutation({type:`selection`,target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&e_(e)&&!this.ignoreSelectionChange(n),i=-1,a=-1,o=!1,s=[];if(e.editable)for(let e=0;e<t.length;e++){let n=this.registerMutation(t[e],s);n&&(i=i<0?n.from:Math.min(n.from,i),a=a<0?n.to:Math.max(n.to,a),n.typeOver&&(o=!0))}if(wh&&s.length){let t=s.filter(e=>e.nodeName==`BR`);if(t.length==2){let[e,n]=t;e.parentNode&&e.parentNode.parentNode==n.parentNode?n.remove():e.remove()}else{let{focusNode:n}=this.currentSelection;for(let r of t){let t=r.parentNode;t&&t.nodeName==`LI`&&(!n||ey(e,n)!=t)&&r.remove()}}}let c=null;i<0&&r&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&fh(n)&&(c=Hg(e))&&c.eq(Z.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Wg(e),this.currentSelection.set(n),e.scrollToSelection()):(i>-1||r)&&(i>-1&&(e.docView.markDirty(i,a),Zv(e)),this.handleDOMChange(i,a,o,s),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||Wg(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type==`attributes`&&(n==this.view.docView||e.attributeName==`contenteditable`||e.attributeName==`style`&&!e.oldValue&&!e.target.getAttribute(`style`))||!n||n.ignoreMutation(e))return null;if(e.type==`childList`){for(let n=0;n<e.addedNodes.length;n++){let r=e.addedNodes[n];t.push(r),r.nodeType==3&&(this.lastChangedTextNode=r)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let r=e.previousSibling,i=e.nextSibling;if(Sh&&Ch<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:a}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(r=n),(!a||Array.prototype.indexOf.call(e.addedNodes,a)<0)&&(i=a)}let a=r&&r.parentNode==e.target?$m(r)+1:0,o=n.localPosFromDOM(e.target,a,-1),s=i&&i.parentNode==e.target?$m(i):e.target.childNodes.length,c=n.localPosFromDOM(e.target,s,1);return{from:o,to:c}}else if(e.type==`attributes`)return{from:n.posAtStart-n.border,to:n.posAtEnd+n.border};else return this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}},Yv=new WeakMap,Xv=!1;function Zv(e){if(!Yv.has(e)&&(Yv.set(e,null),[`normal`,`nowrap`,`pre-line`].indexOf(getComputedStyle(e.dom).whiteSpace)!==-1)){if(e.requiresGeckoHackNode=wh,Xv)return;console.warn(`ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package.`),Xv=!0}}function Qv(e,t){let n=t.startContainer,r=t.startOffset,i=t.endContainer,a=t.endOffset,o=e.domAtPos(e.state.selection.anchor);return ih(o.node,o.offset,i,a)&&([n,r,i,a]=[i,a,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a}}function $v(e,t){if(t.getComposedRanges){let n=t.getComposedRanges(e.root)[0];if(n)return Qv(e,n)}let n;function r(e){e.preventDefault(),e.stopImmediatePropagation(),n=e.getTargetRanges()[0]}return e.dom.addEventListener(`beforeinput`,r,!0),document.execCommand(`indent`),e.dom.removeEventListener(`beforeinput`,r,!0),n?Qv(e,n):null}function ey(e,t){for(let n=t.parentNode;n&&n!=e.dom;n=n.parentNode){let t=e.docView.nearestDesc(n,!0);if(t&&t.node.isBlock)return n}return null}function ty(e,t,n){let{node:r,fromOffset:i,toOffset:a,from:o,to:s}=e.docView.parseRange(t,n),c=e.domSelectionRange(),l,u=c.anchorNode;if(u&&e.dom.contains(u.nodeType==1?u:u.parentNode)&&(l=[{node:u,offset:c.anchorOffset}],fh(c)||l.push({node:c.focusNode,offset:c.focusOffset})),Eh&&e.input.lastKeyCode===8)for(let e=a;e>i;e--){let t=r.childNodes[e-1],n=t.pmViewDesc;if(t.nodeName==`BR`&&!n){a=e;break}if(!n||n.size)break}let d=e.state.doc,f=e.someProp(`domParser`)||ep.fromSchema(e.state.schema),p=d.resolve(o),m=null,h=f.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:i,to:a,preserveWhitespace:p.parent.type.whitespace==`pre`?`full`:!0,findPositions:l,ruleFromNode:ny,context:p});if(l&&l[0].pos!=null){let e=l[0].pos,t=l[1]&&l[1].pos;t??=e,m={anchor:e+o,head:t+o}}return{doc:h,sel:m,from:o,to:s}}function ny(e){let t=e.pmViewDesc;if(t)return t.parseRule();if(e.nodeName==`BR`&&e.parentNode){if(Oh&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement(`div`);return e.appendChild(document.createElement(`li`)),{skip:e}}else if(e.parentNode.lastChild==e||Oh&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if(e.nodeName==`IMG`&&e.getAttribute(`mark-placeholder`))return{ignore:!0};return null}var ry=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function iy(e,t,n,r,i){let a=e.input.compositionPendingChanges||(e.composing?e.input.compositionID:0);if(e.input.compositionPendingChanges=0,t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=Hg(e,t);if(n&&!e.state.selection.eq(n)){if(Eh&&Mh&&e.input.lastKeyCode===13&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp(`handleKeyDown`,t=>t(e,ph(13,`Enter`))))return;let r=e.state.tr.setSelection(n);t==`pointer`?r.setMeta(`pointer`,!0):t==`key`&&r.scrollIntoView(),a&&r.setMeta(`composition`,a),e.dispatch(r)}return}let o=e.state.doc.resolve(t),s=o.sharedDepth(n);t=o.before(s+1),n=e.state.doc.resolve(n).after(s+1);let c=e.state.selection,l=ty(e,t,n),u=e.state.doc,d=u.slice(l.from,l.to),f,p;e.input.lastKeyCode===8&&Date.now()-100<e.input.lastKeyCodeTime?(f=e.state.selection.to,p=`end`):(f=e.state.selection.from,p=`start`),e.input.lastKeyCode=null;let m=ly(d.content,l.doc.content,l.from,f,p);if(m&&e.input.domChangeCount++,(kh&&e.input.lastIOSEnter>Date.now()-225||Mh)&&i.some(e=>e.nodeType==1&&!ry.test(e.nodeName))&&(!m||m.endA>=m.endB)&&e.someProp(`handleKeyDown`,t=>t(e,ph(13,`Enter`)))){e.input.lastIOSEnter=0;return}if(!m)if(r&&c instanceof Q&&!c.empty&&c.$head.sameParent(c.$anchor)&&!e.composing&&!(l.sel&&l.sel.anchor!=l.sel.head))m={start:c.from,endA:c.to,endB:c.to};else{if(l.sel){let t=ay(e,e.state.doc,l.sel);if(t&&!t.eq(e.state.selection)){let n=e.state.tr.setSelection(t);a&&n.setMeta(`composition`,a),e.dispatch(n)}}return}e.state.selection.from<e.state.selection.to&&m.start==m.endB&&e.state.selection instanceof Q&&(m.start>e.state.selection.from&&m.start<=e.state.selection.from+2&&e.state.selection.from>=l.from?m.start=e.state.selection.from:m.endA<e.state.selection.to&&m.endA>=e.state.selection.to-2&&e.state.selection.to<=l.to&&(m.endB+=e.state.selection.to-m.endA,m.endA=e.state.selection.to)),Sh&&Ch<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>l.from&&l.doc.textBetween(m.start-l.from-1,m.start-l.from+1)==` \xA0`&&(m.start--,m.endA--,m.endB--);let h=l.doc.resolveNoCache(m.start-l.from),g=l.doc.resolveNoCache(m.endB-l.from),_=u.resolve(m.start),v=h.sameParent(g)&&h.parent.inlineContent&&_.end()>=m.endA;if((kh&&e.input.lastIOSEnter>Date.now()-225&&(!v||i.some(e=>e.nodeName==`DIV`||e.nodeName==`P`))||!v&&h.pos<l.doc.content.size&&(!h.sameParent(g)||!h.parent.inlineContent)&&h.pos<g.pos&&!/\S/.test(l.doc.textBetween(h.pos,g.pos,``,``)))&&e.someProp(`handleKeyDown`,t=>t(e,ph(13,`Enter`)))){e.input.lastIOSEnter=0;return}if(e.state.selection.anchor>m.start&&sy(u,m.start,m.endA,h,g)&&e.someProp(`handleKeyDown`,t=>t(e,ph(8,`Backspace`)))){Mh&&Eh&&e.domObserver.suppressSelectionUpdates();return}Eh&&m.endB==m.start&&(e.input.lastChromeDelete=Date.now()),Mh&&!v&&h.start()!=g.start()&&g.parentOffset==0&&h.depth==g.depth&&l.sel&&l.sel.anchor==l.sel.head&&l.sel.head==m.endA&&(m.endB-=2,g=l.doc.resolveNoCache(m.endB-l.from),setTimeout(()=>{e.someProp(`handleKeyDown`,function(t){return t(e,ph(13,`Enter`))})},20));let y=m.start,b=m.endA,x=t=>{let n=t||e.state.tr.replace(y,b,l.doc.slice(m.start-l.from,m.endB-l.from));if(l.sel){let t=ay(e,n.doc,l.sel);t&&!(Eh&&e.composing&&t.empty&&(m.start!=m.endB||e.input.lastChromeDelete<Date.now()-100)&&(t.head==y||t.head==n.mapping.map(b)-1)||Sh&&t.empty&&t.head==y)&&n.setSelection(t)}return a&&n.setMeta(`composition`,a),n.scrollIntoView()},S;if(v)if(h.pos==g.pos){Sh&&Ch<=11&&h.parentOffset==0&&(e.domObserver.suppressSelectionUpdates(),setTimeout(()=>Wg(e),20));let t=x(e.state.tr.delete(y,b)),n=u.resolve(m.start).marksAcross(u.resolve(m.endA));n&&t.ensureMarks(n),e.dispatch(t)}else if(m.endA==m.endB&&(S=oy(h.parent.content.cut(h.parentOffset,g.parentOffset),_.parent.content.cut(_.parentOffset,m.endA-_.start())))){let t=x(e.state.tr);S.type==`add`?t.addMark(y,b,S.mark):t.removeMark(y,b,S.mark),e.dispatch(t)}else if(h.parent.child(h.index()).isText&&h.index()==g.index()-(g.textOffset?0:1)){let t=h.parent.textBetween(h.parentOffset,g.parentOffset),n=()=>x(e.state.tr.insertText(t,y,b));e.someProp(`handleTextInput`,r=>r(e,y,b,t,n))||e.dispatch(n())}else e.dispatch(x());else e.dispatch(x())}function ay(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:$g(e,t.resolve(n.anchor),t.resolve(n.head))}function oy(e,t){let n=e.firstChild.marks,r=t.firstChild.marks,i=n,a=r,o,s,c;for(let e=0;e<r.length;e++)i=r[e].removeFromSet(i);for(let e=0;e<n.length;e++)a=n[e].removeFromSet(a);if(i.length==1&&a.length==0)s=i[0],o=`add`,c=e=>e.mark(s.addToSet(e.marks));else if(i.length==0&&a.length==1)s=a[0],o=`remove`,c=e=>e.mark(s.removeFromSet(e.marks));else return null;let l=[];for(let e=0;e<t.childCount;e++)l.push(c(t.child(e)));if(J.from(l).eq(e))return{mark:s,type:o}}function sy(e,t,n,r,i){if(n-t<=i.pos-r.pos||cy(r,!0,!1)<i.pos)return!1;let a=e.resolve(t);if(!r.parent.isTextblock){let e=a.nodeAfter;return e!=null&&n==t+e.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let o=e.resolve(cy(a,!0,!0));return!o.parent.isTextblock||o.pos>n||cy(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function cy(e,t,n){let r=e.depth,i=t?e.end():e.pos;for(;r>0&&(t||e.indexAfter(r)==e.node(r).childCount);)r--,i++,t=!1;if(n){let t=e.node(r).maybeChild(e.indexAfter(r));for(;t&&!t.isLeaf;)t=t.firstChild,i++}return i}function ly(e,t,n,r,i){let a=e.findDiffStart(t,n);if(a==null)return null;let{a:o,b:s}=e.findDiffEnd(t,n+e.size,n+t.size);if(i==`end`){let e=Math.max(0,a-Math.min(o,s));r-=o+e-a}if(o<a&&e.size<t.size){let e=r<=a&&r>=o?a-r:0;a-=e,a&&a<t.size&&uy(t.textBetween(a-1,a+1))&&(a+=e?1:-1),s=a+(s-o),o=a}else if(s<a){let t=r<=a&&r>=s?a-r:0;a-=t,a&&a<e.size&&uy(e.textBetween(a-1,a+1))&&(a+=t?1:-1),o=a+(o-s),s=a}return{start:a,endA:o,endB:s}}function uy(e){if(e.length!=2)return!1;let t=e.charCodeAt(0),n=e.charCodeAt(1);return t>=56320&&t<=57343&&n>=55296&&n<=56319}var dy=class{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new H_,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(vy),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement(`div`),e&&(e.appendChild?e.appendChild(this.dom):typeof e==`function`?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=my(this),py(this),this.nodeViews=gy(this),this.docView=Sg(this.state.doc,fy(this),Wv(this),this.dom,this),this.domObserver=new Jv(this,(e,t,n,r)=>iy(this,e,t,n,r)),this.domObserver.start(),U_(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;for(let t in this._props={},e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&K_(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(vy),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let e in this._props)t[e]=this._props[e];for(let n in t.state=this.state,e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){let n=this.state,r=!1,i=!1;e.storedMarks&&this.composing&&(fv(this),i=!0),this.state=e;let a=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=gy(this);_y(e,this.nodeViews)&&(this.nodeViews=e,r=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&K_(this),this.editable=my(this),py(this);let o=Wv(this),s=fy(this),c=n.plugins!=e.plugins&&!n.doc.eq(e.doc)?`reset`:e.scrollToSelection>n.scrollToSelection?`to selection`:`preserve`,l=r||!this.docView.matchesNode(e.doc,s,o);(l||!e.selection.eq(n.selection))&&(i=!0);let u=c==`preserve`&&i&&this.dom.style.overflowAnchor==null&&zh(this);if(i){this.domObserver.stop();let t=l&&(Sh||Eh)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&hy(n.selection,e.selection);if(l){let n=Eh?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=pv(this)),(r||!this.docView.update(e.doc,s,o,this))&&(this.docView.updateOuterDeco(s),this.docView.destroy(),this.docView=Sg(e.doc,s,o,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&n_(this))?Wg(this,t):(Zg(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),this.dragging?.node&&!n.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,n),c==`reset`?this.dom.scrollTop=0:c==`to selection`?this.scrollToSelection():u&&Vh(u)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))&&!this.someProp(`handleScrollToSelection`,e=>e(this)))if(this.state.selection instanceof $){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Rh(this,t.getBoundingClientRect(),e)}else Rh(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}}updateDraggedNode(e,t){let n=e.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{let e=n.from+(this.state.doc.content.size-t.doc.content.size);(e>0&&this.state.doc.nodeAt(e))==n.node&&(r=e)}this.dragging=new Sv(e.slice,e.move,r<0?void 0:$.create(this.state.doc,r))}someProp(e,t){let n=this._props&&this._props[e],r;if(n!=null&&(r=t?t(n):n))return r;for(let n=0;n<this.directPlugins.length;n++){let i=this.directPlugins[n].props[e];if(i!=null&&(r=t?t(i):i))return r}let i=this.state.plugins;if(i)for(let n=0;n<i.length;n++){let a=i[n].props[e];if(a!=null&&(r=t?t(a):a))return r}}hasFocus(){if(Sh){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable==`false`)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Wh(this.dom),Wg(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Qh(this,e)}coordsAtPos(e,t=1){return ng(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let r=this.docView.posFromDOM(e,t,n);if(r==null)throw RangeError(`DOM position not inside the editor`);return r}endOfTextblock(e,t){return fg(this,t||this.state,e)}pasteHTML(e,t){return bv(this,``,e,!1,t||new ClipboardEvent(`paste`))}pasteText(e,t){return bv(this,e,null,!0,t||new ClipboardEvent(`paste`))}serializeForClipboard(e){return S_(this,e)}destroy(){this.docView&&(G_(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Wv(this),this),this.dom.textContent=``):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,rh())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Y_(this,e)}domSelectionRange(){let e=this.domSelection();return e?Oh&&this.root.nodeType===11&&mh(this.dom.ownerDocument)==this.dom&&$v(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}};dy.prototype.dispatch=function(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))};function fy(e){let t=Object.create(null);return t.class=`ProseMirror`,t.contenteditable=String(e.editable),e.someProp(`attributes`,n=>{if(typeof n==`function`&&(n=n(e.state)),n)for(let e in n)e==`class`?t.class+=` `+n[e]:e==`style`?t.style=(t.style?t.style+`;`:``)+n[e]:!t[e]&&e!=`contenteditable`&&e!=`nodeName`&&(t[e]=String(n[e]))}),t.translate||=`no`,[kv.node(0,e.state.doc.content.size,t)]}function py(e){if(e.markCursor){let t=document.createElement(`img`);t.className=`ProseMirror-separator`,t.setAttribute(`mark-placeholder`,`true`),t.setAttribute(`alt`,``),e.cursorWrapper={dom:t,deco:kv.widget(e.state.selection.from,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function my(e){return!e.someProp(`editable`,t=>t(e.state)===!1)}function hy(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}function gy(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp(`nodeViews`,n),e.someProp(`markViews`,n),t}function _y(e,t){let n=0,r=0;for(let r in e){if(e[r]!=t[r])return!0;n++}for(let e in t)r++;return n!=r}function vy(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw RangeError(`Plugins passed directly to the view must not have a state component`)}for(var yy={8:`Backspace`,9:`Tab`,10:`Enter`,12:`NumLock`,13:`Enter`,16:`Shift`,17:`Control`,18:`Alt`,20:`CapsLock`,27:`Escape`,32:` `,33:`PageUp`,34:`PageDown`,35:`End`,36:`Home`,37:`ArrowLeft`,38:`ArrowUp`,39:`ArrowRight`,40:`ArrowDown`,44:`PrintScreen`,45:`Insert`,46:`Delete`,59:`;`,61:`=`,91:`Meta`,92:`Meta`,106:`*`,107:`+`,108:`,`,109:`-`,110:`.`,111:`/`,144:`NumLock`,145:`ScrollLock`,160:`Shift`,161:`Shift`,162:`Control`,163:`Control`,164:`Alt`,165:`Alt`,173:`-`,186:`;`,187:`=`,188:`,`,189:`-`,190:`.`,191:`/`,192:"`",219:`[`,220:`\\`,221:`]`,222:`'`},by={48:`)`,49:`!`,50:`@`,51:`#`,52:`$`,53:`%`,54:`^`,55:`&`,56:`*`,57:`(`,59:`:`,61:`+`,173:`_`,186:`:`,187:`+`,188:`<`,189:`_`,190:`>`,191:`?`,192:`~`,219:`{`,220:`|`,221:`}`,222:`"`},xy=typeof navigator<`u`&&/Mac/.test(navigator.platform),Sy=typeof navigator<`u`&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Cy=0;Cy<10;Cy++)yy[48+Cy]=yy[96+Cy]=String(Cy);for(var Cy=1;Cy<=24;Cy++)yy[Cy+111]=`F`+Cy;for(var Cy=65;Cy<=90;Cy++)yy[Cy]=String.fromCharCode(Cy+32),by[Cy]=String.fromCharCode(Cy);for(var wy in yy)by.hasOwnProperty(wy)||(by[wy]=yy[wy]);function Ty(e){var t=!(xy&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||Sy&&e.shiftKey&&e.key&&e.key.length==1||e.key==`Unidentified`)&&e.key||(e.shiftKey?by:yy)[e.keyCode]||e.key||`Unidentified`;return t==`Esc`&&(t=`Escape`),t==`Del`&&(t=`Delete`),t==`Left`&&(t=`ArrowLeft`),t==`Up`&&(t=`ArrowUp`),t==`Right`&&(t=`ArrowRight`),t==`Down`&&(t=`ArrowDown`),t}var Ey=typeof navigator<`u`&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Dy=typeof navigator<`u`&&/Win/.test(navigator.platform);function Oy(e){let t=e.split(/-(?!$)/),n=t[t.length-1];n==`Space`&&(n=` `);let r,i,a,o;for(let e=0;e<t.length-1;e++){let n=t[e];if(/^(cmd|meta|m)$/i.test(n))o=!0;else if(/^a(lt)?$/i.test(n))r=!0;else if(/^(c|ctrl|control)$/i.test(n))i=!0;else if(/^s(hift)?$/i.test(n))a=!0;else if(/^mod$/i.test(n))Ey?o=!0:i=!0;else throw Error(`Unrecognized modifier name: `+n)}return r&&(n=`Alt-`+n),i&&(n=`Ctrl-`+n),o&&(n=`Meta-`+n),a&&(n=`Shift-`+n),n}function ky(e){let t=Object.create(null);for(let n in e)t[Oy(n)]=e[n];return t}function Ay(e,t,n=!0){return t.altKey&&(e=`Alt-`+e),t.ctrlKey&&(e=`Ctrl-`+e),t.metaKey&&(e=`Meta-`+e),n&&t.shiftKey&&(e=`Shift-`+e),e}function jy(e){return new Ym({props:{handleKeyDown:My(e)}})}function My(e){let t=ky(e);return function(e,n){let r=Ty(n),i,a=t[Ay(r,n)];if(a&&a(e.state,e.dispatch,e))return!0;if(r.length==1&&r!=` `){if(n.shiftKey){let i=t[Ay(r,n,!1)];if(i&&i(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Dy&&n.ctrlKey&&n.altKey)&&(i=yy[n.keyCode])&&i!=r){let r=t[Ay(i,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}var Ny=(e,t)=>e.selection.empty?!1:(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function Py(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock(`backward`,e):n.parentOffset>0)?null:n}var Fy=(e,t,n)=>{let r=Py(e,n);if(!r)return!1;let i=Ry(r);if(!i){let n=r.blockRange(),i=n&&Jp(n);return i==null?!1:(t&&t(e.tr.lift(n,i).scrollIntoView()),!0)}let a=i.nodeBefore;if(Qy(e,i,t,-1))return!0;if(r.parent.content.size==0&&(Iy(a,`end`)||$.isSelectable(a)))for(let n=r.depth;;n--){let o=um(e.doc,r.before(n),r.after(n),X.empty);if(o&&o.slice.size<o.to-o.from){if(t){let n=e.tr.step(o);n.setSelection(Iy(a,`end`)?Z.findFrom(n.doc.resolve(n.mapping.map(i.pos,-1)),-1):$.create(n.doc,i.pos-a.nodeSize)),t(n.scrollIntoView())}return!0}if(n==1||r.node(n-1).childCount>1)break}return a.isAtom&&i.depth==r.depth-1?(t&&t(e.tr.delete(i.pos-a.nodeSize,i.pos).scrollIntoView()),!0):!1};function Iy(e,t,n=!1){for(let r=e;r;r=t==`start`?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}var Ly=(e,t,n)=>{let{$head:r,empty:i}=e.selection,a=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock(`backward`,e):r.parentOffset>0)return!1;a=Ry(r)}let o=a&&a.nodeBefore;return!o||!$.isSelectable(o)?!1:(t&&t(e.tr.setSelection($.create(e.doc,a.pos-o.nodeSize)).scrollIntoView()),!0)};function Ry(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function zy(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock(`forward`,e):n.parentOffset<n.parent.content.size)?null:n}var By=(e,t,n)=>{let r=zy(e,n);if(!r)return!1;let i=Hy(r);if(!i)return!1;let a=i.nodeAfter;if(Qy(e,i,t,1))return!0;if(r.parent.content.size==0&&(Iy(a,`start`)||$.isSelectable(a))){let n=um(e.doc,r.before(),r.after(),X.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(Iy(a,`start`)?Z.findFrom(r.doc.resolve(r.mapping.map(i.pos)),1):$.create(r.doc,r.mapping.map(i.pos))),t(r.scrollIntoView())}return!0}}return a.isAtom&&i.depth==r.depth-1?(t&&t(e.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1},Vy=(e,t,n)=>{let{$head:r,empty:i}=e.selection,a=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock(`forward`,e):r.parentOffset<r.parent.content.size)return!1;a=Hy(r)}let o=a&&a.nodeAfter;return!o||!$.isSelectable(o)?!1:(t&&t(e.tr.setSelection($.create(e.doc,a.pos)).scrollIntoView()),!0)};function Hy(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}var Uy=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(t&&t(e.tr.insertText(`
`).scrollIntoView()),!0)};function Wy(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}var Gy=(e,t)=>{let{$head:n,$anchor:r}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),a=n.indexAfter(-1),o=Wy(i.contentMatchAt(a));if(!o||!i.canReplaceWith(a,a,o))return!1;if(t){let r=n.after(),i=e.tr.replaceWith(r,r,o.createAndFill());i.setSelection(Z.near(i.doc.resolve(r),1)),t(i.scrollIntoView())}return!0},Ky=(e,t)=>{let n=e.selection,{$from:r,$to:i}=n;if(n instanceof Fm||r.parent.inlineContent||i.parent.inlineContent)return!1;let a=Wy(i.parent.contentMatchAt(i.indexAfter()));if(!a||!a.isTextblock)return!1;if(t){let n=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,o=e.tr.insert(n,a.createAndFill());o.setSelection(Q.create(o.doc,n+1)),t(o.scrollIntoView())}return!0},qy=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if(nm(e.doc,r))return t&&t(e.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),i=r&&Jp(r);return i==null?!1:(t&&t(e.tr.lift(r,i).scrollIntoView()),!0)};function Jy(e){return(t,n)=>{let{$from:r,$to:i}=t.selection;if(t.selection instanceof $&&t.selection.node.isBlock)return!r.parentOffset||!nm(t.doc,r.pos)?!1:(n&&n(t.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let a=[],o,s,c=!1,l=!1;for(let t=r.depth;;t--)if(r.node(t).isBlock){c=r.end(t)==r.pos+(r.depth-t),l=r.start(t)==r.pos-(r.depth-t),s=Wy(r.node(t-1).contentMatchAt(r.indexAfter(t-1)));let n=e&&e(i.parent,c,r);a.unshift(n||(c&&s?{type:s}:null)),o=t;break}else{if(t==1)return!1;a.unshift(null)}let u=t.tr;(t.selection instanceof Q||t.selection instanceof Fm)&&u.deleteSelection();let d=u.mapping.map(r.pos),f=nm(u.doc,d,a.length,a);if(f||=(a[0]=s?{type:s}:null,nm(u.doc,d,a.length,a)),!f)return!1;if(u.split(d,a.length,a),!c&&l&&r.node(o).type!=s){let e=u.mapping.map(r.before(o)),t=u.doc.resolve(e);s&&r.node(o-1).canReplaceWith(t.index(),t.index()+1,s)&&u.setNodeMarkup(u.mapping.map(r.before(o)),s)}return n&&n(u.scrollIntoView()),!0}}var Yy=Jy(),Xy=(e,t)=>(t&&t(e.tr.setSelection(new Fm(e.doc))),!0);function Zy(e,t,n){let r=t.nodeBefore,i=t.nodeAfter,a=t.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&t.parent.canReplace(a-1,a)?(n&&n(e.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(a,a+1)||!(i.isTextblock||im(e.doc,t.pos))?!1:(n&&n(e.tr.join(t.pos).scrollIntoView()),!0)}function Qy(e,t,n,r){let i=t.nodeBefore,a=t.nodeAfter,o,s,c=i.type.spec.isolating||a.type.spec.isolating;if(!c&&Zy(e,t,n))return!0;let l=!c&&t.parent.canReplace(t.index(),t.index()+1);if(l&&(o=(s=i.contentMatchAt(i.childCount)).findWrapping(a.type))&&s.matchType(o[0]||a.type).validEnd){if(n){let r=t.pos+a.nodeSize,s=J.empty;for(let e=o.length-1;e>=0;e--)s=J.from(o[e].create(null,s));s=J.from(i.copy(s));let c=e.tr.step(new Hp(t.pos-1,r,t.pos,r,new X(s,1,0),o.length,!0)),l=c.doc.resolve(r+2*o.length);l.nodeAfter&&l.nodeAfter.type==i.type&&im(c.doc,l.pos)&&c.join(l.pos),n(c.scrollIntoView())}return!0}let u=a.type.spec.isolating||r>0&&c?null:Z.findFrom(t,1),d=u&&u.$from.blockRange(u.$to),f=d&&Jp(d);if(f!=null&&f>=t.depth)return n&&n(e.tr.lift(d,f).scrollIntoView()),!0;if(l&&Iy(a,`start`,!0)&&Iy(i,`end`)){let r=i,o=[];for(;o.push(r),!r.isTextblock;)r=r.lastChild;let s=a,c=1;for(;!s.isTextblock;s=s.firstChild)c++;if(r.canReplace(r.childCount,r.childCount,s.content)){if(n){let r=J.empty;for(let e=o.length-1;e>=0;e--)r=J.from(o[e].copy(r));let i=e.tr.step(new Hp(t.pos-o.length,t.pos+a.nodeSize,t.pos+c,t.pos+a.nodeSize-c,new X(r,o.length,0),0,!0));n(i.scrollIntoView())}return!0}}return!1}function $y(e){return function(t,n){let r=t.selection,i=e<0?r.$from:r.$to,a=i.depth;for(;i.node(a).isInline;){if(!a)return!1;a--}return i.node(a).isTextblock?(n&&n(t.tr.setSelection(Q.create(t.doc,e<0?i.start(a):i.end(a)))),!0):!1}}var eb=$y(-1),tb=$y(1);function nb(...e){return function(t,n,r){for(let i=0;i<e.length;i++)if(e[i](t,n,r))return!0;return!1}}var rb=nb(Ny,Fy,Ly),ib=nb(Ny,By,Vy),ab={Enter:nb(Uy,Ky,qy,Yy),"Mod-Enter":Gy,Backspace:rb,"Mod-Backspace":rb,"Shift-Backspace":rb,Delete:ib,"Mod-Delete":ib,"Mod-a":Xy},ob={"Ctrl-h":ab.Backspace,"Alt-Backspace":ab[`Mod-Backspace`],"Ctrl-d":ab.Delete,"Ctrl-Alt-Backspace":ab[`Mod-Delete`],"Alt-Delete":ab[`Mod-Delete`],"Alt-d":ab[`Mod-Delete`],"Ctrl-a":eb,"Ctrl-e":tb};for(let e in ab)ob[e]=ab[e];var sb=(typeof navigator<`u`?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<`u`&&os.platform&&os.platform()==`darwin`)?ob:ab,cb=200,lb=function(){};lb.prototype.append=function(e){return e.length?(e=lb.from(e),!this.length&&e||e.length<cb&&this.leafAppend(e)||this.length<cb&&e.leafPrepend(this)||this.appendInner(e)):this},lb.prototype.prepend=function(e){return e.length?lb.from(e).append(this):this},lb.prototype.appendInner=function(e){return new db(this,e)},lb.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?lb.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},lb.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},lb.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},lb.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var r=[];return this.forEach(function(t,n){return r.push(e(t,n))},t,n),r},lb.from=function(e){return e instanceof lb?e:e&&e.length?new ub(e):lb.empty};var ub=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return e==0&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,r){for(var i=t;i<n;i++)if(e(this.values[i],r+i)===!1)return!1},t.prototype.forEachInvertedInner=function(e,t,n,r){for(var i=t-1;i>=n;i--)if(e(this.values[i],r+i)===!1)return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=cb)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=cb)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(lb);lb.empty=new ub([]);var db=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,r){var i=this.left.length;if(t<i&&this.left.forEachInner(e,t,Math.min(n,i),r)===!1||n>i&&this.right.forEachInner(e,Math.max(t-i,0),Math.min(this.length,n)-i,r+i)===!1)return!1},t.prototype.forEachInvertedInner=function(e,t,n,r){var i=this.left.length;if(t>i&&this.right.forEachInvertedInner(e,t-i,Math.max(n,i)-i,r+i)===!1||n<i&&this.left.forEachInvertedInner(e,Math.min(t,i),n,r)===!1)return!1},t.prototype.sliceInner=function(e,t){if(e==0&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(lb),fb=lb,pb=500,mb=class e{constructor(e,t){this.items=e,this.eventCount=t}popEvent(t,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,a;n&&(i=this.remapping(r,this.items.length),a=i.maps.length);let o=t.tr,s,c,l=[],u=[];return this.items.forEach((t,n)=>{if(!t.step){i||(i=this.remapping(r,n+1),a=i.maps.length),a--,u.push(t);return}if(i){u.push(new gb(t.map));let e=t.step.map(i.slice(a)),n;e&&o.maybeStep(e).doc&&(n=o.mapping.maps[o.mapping.maps.length-1],l.push(new gb(n,void 0,void 0,l.length+u.length))),a--,n&&i.appendMap(n,a)}else o.maybeStep(t.step);if(t.selection)return s=i?t.selection.map(i.slice(a)):t.selection,c=new e(this.items.slice(0,r).append(u.reverse().concat(l)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:o,selection:s}}addTransform(t,n,r,i){let a=[],o=this.eventCount,s=this.items,c=!i&&s.length?s.get(s.length-1):null;for(let e=0;e<t.steps.length;e++){let r=t.steps[e].invert(t.docs[e]),l=new gb(t.mapping.maps[e],r,n),u;(u=c&&c.merge(l))&&(l=u,e?a.pop():s=s.slice(0,s.length-1)),a.push(l),n&&=(o++,void 0),i||(c=l)}let l=o-r.depth;return l>vb&&(s=hb(s,l),o-=l),new e(s.append(a),o)}remapping(e,t){let n=new Mp;return this.items.forEach((t,r)=>{let i=t.mirrorOffset!=null&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,i)},e,t),n}addMaps(t){return this.eventCount==0?this:new e(this.items.append(t.map(e=>new gb(e))),this.eventCount)}rebased(t,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),a=t.mapping,o=t.steps.length,s=this.eventCount;this.items.forEach(e=>{e.selection&&s--},i);let c=n;this.items.forEach(e=>{let n=a.getMirror(--c);if(n==null)return;o=Math.min(o,n);let i=a.maps[n];if(e.step){let o=t.steps[n].invert(t.docs[n]),l=e.selection&&e.selection.map(a.slice(c+1,n));l&&s++,r.push(new gb(i,o,l))}else r.push(new gb(i))},i);let l=[];for(let e=n;e<o;e++)l.push(new gb(a.maps[e]));let u=this.items.slice(0,i).append(l).append(r),d=new e(u,s);return d.emptyItemCount()>pb&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(t=this.items.length){let n=this.remapping(0,t),r=n.maps.length,i=[],a=0;return this.items.forEach((e,o)=>{if(o>=t)i.push(e),e.selection&&a++;else if(e.step){let t=e.step.map(n.slice(r)),o=t&&t.getMap();if(r--,o&&n.appendMap(o,r),t){let s=e.selection&&e.selection.map(n.slice(r));s&&a++;let c=new gb(o.invert(),t,s),l,u=i.length-1;(l=i.length&&i[u].merge(c))?i[u]=l:i.push(c)}}else e.map&&r--},this.items.length,0),new e(fb.from(i.reverse()),a)}};mb.empty=new mb(fb.empty,0);function hb(e,t){let n;return e.forEach((e,r)=>{if(e.selection&&t--==0)return n=r,!1}),e.slice(n)}var gb=class e{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(t){if(this.step&&t.step&&!t.selection){let n=t.step.merge(this.step);if(n)return new e(n.getMap().invert(),n,this.selection)}}},_b=class{constructor(e,t,n,r,i){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r,this.prevComposition=i}},vb=20;function yb(e,t,n,r){let i=n.getMeta(Db),a;if(i)return i.historyState;n.getMeta(Ob)&&(e=new _b(e.done,e.undone,null,0,-1));let o=n.getMeta(`appendedTransaction`);if(n.steps.length==0)return e;if(o&&o.getMeta(Db))return o.getMeta(Db).redo?new _b(e.done.addTransform(n,void 0,r,Eb(t)),e.undone,xb(n.mapping.maps),e.prevTime,e.prevComposition):new _b(e.done,e.undone.addTransform(n,void 0,r,Eb(t)),null,e.prevTime,e.prevComposition);if(n.getMeta(`addToHistory`)!==!1&&!(o&&o.getMeta(`addToHistory`)===!1)){let i=n.getMeta(`composition`),a=e.prevTime==0||!o&&e.prevComposition!=i&&(e.prevTime<(n.time||0)-r.newGroupDelay||!bb(n,e.prevRanges)),s=o?Sb(e.prevRanges,n.mapping):xb(n.mapping.maps);return new _b(e.done.addTransform(n,a?t.selection.getBookmark():void 0,r,Eb(t)),mb.empty,s,n.time,i??e.prevComposition)}else if(a=n.getMeta(`rebased`))return new _b(e.done.rebased(n,a),e.undone.rebased(n,a),Sb(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);else return new _b(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),Sb(e.prevRanges,n.mapping),e.prevTime,e.prevComposition)}function bb(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((e,r)=>{for(let i=0;i<t.length;i+=2)e<=t[i+1]&&r>=t[i]&&(n=!0)}),n}function xb(e){let t=[];for(let n=e.length-1;n>=0&&t.length==0;n--)e[n].forEach((e,n,r,i)=>t.push(r,i));return t}function Sb(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let i=t.map(e[r],1),a=t.map(e[r+1],-1);i<=a&&n.push(i,a)}return n}function Cb(e,t,n){let r=Eb(t),i=Db.get(t).spec.config,a=(n?e.undone:e.done).popEvent(t,r);if(!a)return null;let o=a.selection.resolve(a.transform.doc),s=(n?e.done:e.undone).addTransform(a.transform,t.selection.getBookmark(),i,r),c=new _b(n?s:a.remaining,n?a.remaining:s,null,0,-1);return a.transform.setSelection(o).setMeta(Db,{redo:n,historyState:c})}var wb=!1,Tb=null;function Eb(e){let t=e.plugins;if(Tb!=t){wb=!1,Tb=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){wb=!0;break}}return wb}var Db=new Qm(`history`),Ob=new Qm(`closeHistory`);function kb(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new Ym({key:Db,state:{init(){return new _b(mb.empty,mb.empty,null,0,-1)},apply(t,n,r){return yb(n,r,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r=n==`historyUndo`?jb:n==`historyRedo`?Mb:null;return r?(t.preventDefault(),r(e.state,e.dispatch)):!1}}}})}function Ab(e,t){return(n,r)=>{let i=Db.getState(n);if(!i||(e?i.undone:i.done).eventCount==0)return!1;if(r){let a=Cb(i,n,e);a&&r(t?a.scrollIntoView():a)}return!0}}var jb=Ab(!1,!0),Mb=Ab(!0,!0);function Nb(){return new Xf({nodes:{doc:{content:`inline*`},text:{inline:!0,group:`inline`},hard_break:{inline:!0,group:`inline`,selectable:!1,parseDOM:[{tag:`br`}],toDOM(){return[`br`]}}},marks:{variable:{attrs:{reference:{default:``}},parseDOM:[{tag:`span.variable-token`,getAttrs(e){return{reference:e.getAttribute(`data-reference`)||``}}}],toDOM(){return[`span`,{class:`variable-token`,style:`color: #10b981; background-color: #ecfdf5; padding: 0 2px; border-radius: 2px;`}]}}}})}function Pb(e,t){let n=e.nodes.hard_break,r=t.replace(/\r\n?/g,`
`),i=[];if(r.length>0){let t=r.split(`
`);t.forEach((r,a)=>{r.length>0&&i.push(e.text(r)),a<t.length-1&&n&&i.push(n.create())})}return e.node(`doc`,void 0,i)}function Fb(e){let t=[],n=/\{\{\s*[^{}]+?\s*\}\}/g;return e.nodesBetween(0,e.content.size,(e,r)=>{if(e.isText){let i=e.text||``,a;for(n.lastIndex=0;(a=n.exec(i))!==null;){let e=r+a.index,n=e+a[0].length;t.push(kv.inline(e,n,{class:`variable-token`}))}}}),t}function Ib(){let e=new Qm(`variableHighlight`);return new Ym({key:e,state:{init(e){let t=Fb(e.doc);return Mv.create(e.doc,t)},apply(e,t,n,r){let i=Fb(r.doc);return Mv.create(r.doc,i)}},props:{decorations(e){return this.getState(e)}}})}function Lb(){let e=/\{\{\s*[^{}]+?\s*\}\}/g;function t(t){let n=[];return t.nodesBetween(0,t.content.size,(t,r)=>{if(!t.isText)return;let i=t.text||``,a;for(e.lastIndex=0;(a=e.exec(i))!==null;){let e=r+a.index,t=e+a[0].length;n.push({from:e,to:t})}}),n}return new Ym({key:new Qm(`variableDeletion`),props:{handleKeyDown(e,n){if(n.key!==`Backspace`&&n.key!==`Delete`)return!1;let{state:r,dispatch:i}=e,{from:a,to:o,empty:s}=r.selection,c=r.doc,l=t(c);if(!s){let e=a,t=o;for(let n of l)n.from<t&&n.to>e&&(n.from<e&&(e=n.from),n.to>t&&(t=n.to));return e!==a||t!==o?(n.preventDefault(),i(r.tr.delete(e,t).scrollIntoView()),!0):!1}let u=a,d=null;for(let e of l){let t=n.key===`Backspace`&&u>e.from&&u<=e.to,r=n.key===`Delete`&&u>=e.from&&u<e.to;if(t||r){d=e;break}}return d?(n.preventDefault(),i(r.tr.delete(d.from,d.to).scrollIntoView()),!0):!1}}})}function Rb(e,t=``,n){let r=Pb(e,t),i=e.nodes.hard_break,a={...sb,"Mod-z":jb,"Mod-y":Mb,"Mod-Shift-z":Mb,...n?.multiline?{Enter:(e,t)=>{if(!t||!i)return!1;let n=e.tr.replaceSelectionWith(i.create()).scrollIntoView();return t(n),!0}}:{Enter:()=>!0}};return qm.create({doc:r,plugins:[kb(),Ib(),Lb(),jy(a)]})}function zb(e){let t=``;return e.doc.descendants(e=>{e.isText?t+=e.text||``:e.type.name===`hard_break`&&(t+=`
`)}),t}function Bb(e,t,n){let r=Pb(t,n);return e.apply(e.tr.replaceWith(0,e.doc.content.size,r.content))}var Vb=x({__name:`VariableEditor`,props:{modelValue:{default:``},placeholder:{default:``},multiline:{type:Boolean,default:!1},density:{default:`default`},readonly:{type:Boolean,default:!1}},emits:[`update:modelValue`,`focus`,`blur`,`variable-drop`],setup(t,{expose:n,emit:r}){let i=t,a=r,o=M(null),s=M(!1),c=null,l=Nb(),u=!1;function d(){if(!o.value)return;let e=Rb(l,i.modelValue,{multiline:i.multiline});c=new dy(o.value,{state:e,dispatchTransaction(e){if(!c)return;let t=c.state.apply(e);if(c.updateState(t),!u){let e=zb(t);a(`update:modelValue`,e)}},attributes:{class:`ProseMirror variable-scroll-x`,style:`
        outline: none;
        border: none;
        padding: ${i.density===`compact`?`0.25rem 0.5rem`:`0.5rem`};
        font-family: 'Fira Code', 'Courier New', 'Microsoft YaHei', 'SimHei', monospace;
        font-size: ${i.density===`compact`?`0.75rem`:`0.875rem`};
        line-height: 1.5;
        min-height: ${i.multiline?i.density===`compact`?`3rem`:`4rem`:`auto`};
        max-height: ${i.multiline?`15rem`:`auto`};
        overflow-y: ${i.multiline?`auto`:`hidden`};
        white-space: ${i.multiline?`pre-wrap`:`nowrap`};
        word-wrap: break-word;
      `},editable:()=>!i.readonly}),c.dom.addEventListener(`focus`,p),c.dom.addEventListener(`blur`,m),c.dom.addEventListener(`variable-drop`,h)}function f(){c&&=(c.dom.removeEventListener(`focus`,p),c.dom.removeEventListener(`blur`,m),c.dom.removeEventListener(`variable-drop`,h),c.destroy(),null)}function p(){s.value=!0,a(`focus`)}function m(){s.value=!1,a(`blur`)}function h(e){a(`variable-drop`,e)}return D(()=>i.modelValue,e=>{if(c&&zb(c.state)!==e){u=!0;let t=Bb(c.state,l,e||``);c.updateState(t),u=!1}}),oe(()=>{d()}),e(()=>{f()}),n({focus:()=>c?.focus(),blur:()=>c?.dom.blur(),getContent:()=>c?zb(c.state):``,setContent:e=>{if(c){let t=Bb(c.state,l,e);c.updateState(t)}}}),(e,t)=>(A(),g(`div`,{ref_key:`editorContainer`,ref:o,class:`variable-editor-container`,onFocus:p,onBlur:m},null,544))}}),Hb=P(Vb,[[`__scopeId`,`data-v-9164f948`]]),Ub={class:`pointer-events-none flex items-center justify-center w-7 text-gray-600 rounded-l-md shrink-0 border-r border-gray-200`,style:{"background-color":`#f1f3f9`}},Wb={class:`relative flex-1 min-w-0`},Gb={class:`absolute right-0 bottom-0 w-5 h-8 pt-3`},Kb={class:`flex items-center justify-between border-b border-slate-100 bg-slate-50/90 px-2 py-1.5`},qb={class:`flex items-center gap-1 text-[10px] text-slate-500`},Jb=[`value`,`disabled`],Yb=[`disabled`],Xb=[`disabled`],Zb={class:`max-h-56 overflow-y-auto variable-scroll px-2 py-2`},Qb={key:1,class:`text-xs text-slate-400`},$b={key:0,class:`border-t border-slate-100 bg-slate-50 px-2 py-1.5`},ex={class:`pointer-events-none flex items-center justify-center w-7 text-gray-600 rounded-l-md shrink-0 border-r border-gray-200`,style:{"background-color":`#f1f3f9`}},tx={class:`relative flex-1 min-w-0`},nx={class:`absolute right-0 bottom-0 w-5 h-8 pt-3`},rx={key:4,class:`text-[10px] leading-tight text-slate-400 px-1`},ix=x({inheritAttrs:!1,__name:`VariableTextInput`,props:{modelValue:{default:``},placeholder:{default:``},rows:{default:1},multiline:{type:Boolean,default:!1},previewMode:{default:`bottom`},density:{default:`default`},showBorder:{type:Boolean,default:!1},showTip:{type:Boolean,default:!0}},emits:[`update:modelValue`],setup(e,{emit:t}){let n=e,a=t,l=M(null),u=M(null),f=M(null),p=M(se(n.modelValue)),h=M(!1),_=M(0),v=M(`0`),y=M(!1),x=null,w=gd(),{selectedNodeId:ee}=le(w),{contextMap:T}=Kd(),E=m(()=>!p.value&&n.placeholder);D(()=>n.modelValue,e=>{let t=se(e);t!==p.value&&(p.value=t)}),D(h,e=>{!e&&n.previewMode===`dropdown`?y.value=!1:e&&n.previewMode===`dropdown`&&C(()=>{ue()})});let te=m(()=>{let e=p.value;return!e||typeof e!=`string`?!1:/\{\{\s*[^{}]+?\s*\}\}/.test(e)}),O=m(()=>{let e=p.value;if(!e)return[];if(!te.value||!ee.value||!T.value||T.value.size===0)return[e];try{let t=Lt({preview:e},T.value).preview;return Array.isArray(t)?t:t==null?[]:[t]}catch{return[`è§£æé”™è¯¯`]}}),k=m(()=>O.value.length>1&&_.value>0),j=m(()=>O.value.length>1&&_.value<O.value.length-1);D(O,e=>{if(!e.length){_.value=0,v.value=`0`;return}_.value>e.length-1&&(_.value=e.length-1),v.value=String(_.value+1)},{immediate:!0}),D(_,e=>{if(!O.value.length){v.value=`0`;return}v.value=String(e+1)});function se(e){return e==null?``:String(e)}function ue(){if(u.value&&h.value)try{u.value.syncPosition()}catch{}}function de(){y.value=!0,n.previewMode===`dropdown`&&(_.value=0,h.value=!0,C(()=>{ue()}))}function N(){setTimeout(()=>{y.value=!1,n.previewMode===`dropdown`&&(h.value=!1)},200)}function fe(e){if(n.previewMode!==`dropdown`||!h.value)return;let t=e.target,r=f.value;if(!(r&&r.contains(t))){if(u.value){let e=u.value.$el;if(e){let n=e.querySelector(`.n-popover__content-wrapper`);if(n&&n.contains(t))return}}y.value=!1,h.value=!1}}function P(e){p.value=e,a(`update:modelValue`,e)}function me(){_.value<=0||--_.value}function he(){_.value>=O.value.length-1||(_.value+=1)}function ge(e){if(!O.value.length){v.value=`0`;return}v.value=e.target.value.replace(/[^0-9]/g,``)}function _e(){if(!O.value.length){v.value=`0`;return}let e=v.value.trim();if(!e){v.value=String(_.value+1);return}let t=O.value.length,n=Number(e);if(Number.isNaN(n)){v.value=String(_.value+1);return}let r=Math.min(Math.max(Math.floor(n),1),t);_.value=r-1,v.value=String(r)}function ve(e){e.key===`Enter`&&(e.preventDefault(),_e())}function ye(e){let t=e.detail;if(!t?.reference)return;let n=t.reference.trim();if(!n)return;let r=t.isReplace?n:p.value+n;P(r)}function be(){w.openVariableEditorModal(p.value,e=>{P(e)})}function xe(){h.value&&n.previewMode===`dropdown`&&requestAnimationFrame(()=>{ue()})}function Se(){x&&=(x.disconnect(),null),n.previewMode===`dropdown`&&f.value&&(x=new ResizeObserver(()=>{h.value&&requestAnimationFrame(()=>{ue()})}),x.observe(f.value))}return oe(()=>{C(()=>{Se()}),n.previewMode===`dropdown`&&(window.addEventListener(`scroll`,xe,!0),document.addEventListener(`scroll`,xe,!0),document.addEventListener(`mousedown`,fe,!0))}),D(()=>n.previewMode,(e,t)=>{C(()=>{Se(),e===`dropdown`&&t!==`dropdown`?(window.addEventListener(`scroll`,xe,!0),document.addEventListener(`scroll`,xe,!0),document.addEventListener(`mousedown`,fe,!0)):e!==`dropdown`&&t===`dropdown`&&(window.removeEventListener(`scroll`,xe,!0),document.removeEventListener(`scroll`,xe,!0),document.removeEventListener(`mousedown`,fe,!0))})}),D(f,()=>{n.previewMode===`dropdown`&&C(()=>{Se()})}),ie(()=>{x&&=(x.disconnect(),null),window.removeEventListener(`scroll`,xe,!0),document.removeEventListener(`scroll`,xe,!0),document.removeEventListener(`mousedown`,fe,!0)}),(t,n)=>(A(),g(`div`,S(t.$attrs,{class:`space-y-2`}),[e.previewMode===`top`&&y.value?(A(),s(Xd,{key:0,value:p.value},null,8,[`value`])):c(``,!0),e.previewMode===`dropdown`?(A(),s(re(ce),{key:1,ref_key:`popoverRef`,ref:u,show:h.value,"onUpdate:show":n[1]||=e=>h.value=e,trigger:`manual`,placement:`bottom-start`,width:e.previewMode===`dropdown`?`trigger`:void 0,raw:!0,style:{padding:`0`}},{trigger:ae(()=>[r(`div`,{ref_key:`triggerContainerRef`,ref:f,class:d([`variable-text-input`,`relative flex items-stretch h-full rounded-md border transition-all duration-200`,e.showBorder?`border-dashed border-red-600`:y.value?`border-slate-400 ring-2 ring-slate-200`:`border-slate-200`])},[r(`div`,Ub,[b(Hd,{class:`w-4 h-4`})]),r(`div`,Wb,[E.value?(A(),g(`span`,{key:0,class:d([`pointer-events-none absolute select-none text-slate-400 z-10`,e.density===`compact`?`left-2 top-1 text-xs`:`left-2 top-2 text-sm`])},i(e.placeholder),3)):c(``,!0),b(Hb,{ref_key:`editorRef`,ref:l,"model-value":p.value,multiline:e.multiline,density:e.density,class:`w-full`,"onUpdate:modelValue":P,onFocus:de,onBlur:N,onVariableDrop:ye},null,8,[`model-value`,`multiline`,`density`])]),r(`div`,Gb,[r(`button`,{type:`button`,class:`flex items-center justify-center w-full h-full border-l rounded-tl-md border-t border-slate-200 bg-white text-slate-500 transition-colors hover:border-slate-300 hover:text-slate-700 hover:bg-slate-100 rounded-r-md shrink-0`,onClick:ne(be,[`stop`]),title:`æ‰“å¼€å˜é‡ç¼–è¾‘å™¨`},[b(hd,{class:`h-3 w-3`})])])],2)]),default:ae(()=>[e.previewMode===`dropdown`?(A(),g(`div`,{key:0,class:`overflow-hidden rounded-lg border border-slate-200 bg-white shadow-xl`,onMousedown:n[0]||=ne(()=>{},[`prevent`])},[r(`div`,Kb,[n[3]||=r(`div`,{class:`text-[10px] font-semibold uppercase tracking-wide text-slate-500`},` Result `,-1),r(`div`,qb,[n[2]||=r(`span`,{class:`font-medium`},`Page`,-1),r(`input`,{value:v.value,type:`text`,inputmode:`numeric`,pattern:`[0-9]*`,placeholder:`0`,disabled:!O.value.length,class:`h-5 w-7 rounded bg-white px-1 text-center text-[10px] font-medium text-slate-600 shadow-inner ring-1 ring-inset ring-slate-200 transition focus:outline-none focus:ring-2 focus:ring-slate-300 disabled:bg-slate-100 disabled:text-slate-400`,onInput:ge,onBlur:_e,onKeydown:ve},null,40,Jb),r(`span`,null,`/ `+i(O.value.length||0),1),r(`button`,{type:`button`,class:`flex h-5 w-5 items-center justify-center text-slate-400 transition-colors hover:text-slate-700 disabled:cursor-not-allowed disabled:text-slate-300`,disabled:!k.value,"aria-label":`ä¸Šä¸€é¡µ`,onClick:ne(me,[`stop`])},[b(pe,{class:`h-3 w-3 -rotate-180`})],8,Yb),r(`button`,{type:`button`,class:`flex h-5 w-5 items-center justify-center text-slate-400 transition-colors hover:text-slate-700 disabled:cursor-not-allowed disabled:text-slate-300`,disabled:!j.value,"aria-label":`ä¸‹ä¸€é¡µ`,onClick:ne(he,[`stop`])},[b(pe,{class:`h-3 w-3`})],8,Xb)])]),r(`div`,Zb,[O.value.length?(A(),s(Xd,{key:0,value:p.value,"current-item-index":_.value,inline:``},null,8,[`value`,`current-item-index`])):(A(),g(`p`,Qb,[...n[4]||=[r(`span`,{class:`font-mono bg-gray-100`},`[empty]`,-1)]]))]),e.showTip?(A(),g(`div`,$b,[...n[5]||=[r(`p`,{class:`text-[10px] leading-tight text-slate-400`},[o(` Tip: æ”¯æŒæ‹–æ‹½å˜é‡æ’å…¥ï¼Œå˜é‡ä»¥ `),r(`span`,{class:`font-mono text-emerald-600`},`{{ èŠ‚ç‚¹å.å­—æ®µ }}`),o(` å½¢å¼è¡¨ç¤º `)],-1)]])):c(``,!0)],32)):c(``,!0)]),_:1},8,[`show`,`width`])):(A(),g(`div`,{key:2,class:d([`variable-text-input`,`relative flex items-stretch h-full rounded-md border transition-all duration-200`,e.showBorder?`border-dashed border-red-600`:y.value?`border-slate-400 ring-2 ring-slate-200`:`border-slate-200`])},[r(`div`,ex,[b(Hd,{class:`w-4 h-4`})]),r(`div`,tx,[E.value?(A(),g(`span`,{key:0,class:d([`pointer-events-none absolute select-none text-slate-400 z-10`,e.density===`compact`?`left-2 top-1 text-xs`:`left-2 top-2 text-sm`])},i(e.placeholder),3)):c(``,!0),b(Hb,{ref_key:`editorRef`,ref:l,"model-value":p.value,multiline:e.multiline,density:e.density,class:`w-full`,"onUpdate:modelValue":P,onFocus:de,onBlur:N,onVariableDrop:ye},null,8,[`model-value`,`multiline`,`density`])]),r(`div`,nx,[r(`button`,{type:`button`,class:`flex items-center justify-center w-full h-full border-l rounded-tl-md border-t border-slate-200 bg-white text-slate-500 transition-colors hover:border-slate-300 hover:text-slate-700 hover:bg-slate-100 rounded-r-md shrink-0`,onClick:ne(be,[`stop`]),title:`æ‰“å¼€å˜é‡ç¼–è¾‘å™¨`},[b(hd,{class:`h-3 w-3`})])])],2)),e.previewMode===`bottom`&&y.value?(A(),s(Xd,{key:3,value:p.value},null,8,[`value`])):c(``,!0),e.previewMode!==`dropdown`&&y.value&&e.showTip?(A(),g(`p`,rx,[...n[6]||=[o(` Tip: æ”¯æŒæ‹–æ‹½å˜é‡æ’å…¥ï¼Œå˜é‡ä»¥ `,-1),r(`span`,{class:`font-mono text-emerald-600`},`{{ èŠ‚ç‚¹å.å­—æ®µ }}`,-1),o(` å½¢å¼è¡¨ç¤º `,-1)]])):c(``,!0)],16))}}),ax=P(ix,[[`__scopeId`,`data-v-100b82e7`]]),ox={class:`config-field mb-4`},sx={key:0,class:`mb-2 block text-sm font-medium text-slate-700`},cx={key:0,class:`text-red-500`},lx={key:1,class:`mb-2 text-xs text-slate-500`},ux={class:`field-input`},dx={key:10,class:`text-sm text-red-500`},fx={key:2,class:`mt-1 text-xs text-red-500`},px=x({__name:`ConfigField`,props:{field:{},modelValue:{},isDraggingVariable:{type:Boolean}},emits:[`update:modelValue`],setup(e,{emit:t}){let n=e,a=t,l=M(``),d=m(()=>Bt(n.modelValue)||n.isDraggingVariable);function f(e){let t=y(e);l.value=t,t||a(`update:modelValue`,e)}function p(e){try{let t=JSON.parse(e);l.value=``,a(`update:modelValue`,t)}catch{l.value=`JSON æ ¼å¼é”™è¯¯`}}function h(e){let t=e.file;a(`update:modelValue`,t)}function _(e){if(!e)return``;try{return JSON.stringify(e,null,2)}catch{return String(e)}}function v(e){return n.field.validation?.find(t=>t.type===e)?.value}function y(e){let{field:t}=n;if(t.required&&(e==null||e===``))return`${t.label} ä¸ºå¿…å¡«é¡¹`;if(t.validation)for(let n of t.validation){let t=x(n,e);if(t)return t}return``}function x(e,t){switch(e.type){case`min`:if(typeof t==`number`&&t<e.value)return`æœ€å°å€¼ä¸º ${e.value}`;if(typeof t==`string`&&t.length<e.value)return`æœ€å°‘è¾“å…¥ ${e.value} ä¸ªå­—ç¬¦`;break;case`max`:if(typeof t==`number`&&t>e.value)return`æœ€å¤§å€¼ä¸º ${e.value}`;if(typeof t==`string`&&t.length>e.value)return`æœ€å¤šè¾“å…¥ ${e.value} ä¸ªå­—ç¬¦`;break;case`url`:try{new URL(t)}catch{return`è¯·è¾“å…¥æœ‰æ•ˆçš„ URL`}break;case`email`:if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return`è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€`;break;case`pattern`:if(e.value&&!new RegExp(e.value).test(t))return e.message||`æ ¼å¼ä¸æ­£ç¡®`;break;default:break}return``}return D(()=>n.modelValue,()=>{l.value=``}),(t,n)=>{let a=j(`n-input-number`),m=j(`n-select`),y=j(`n-switch`),x=j(`n-checkbox`),S=j(`n-space`),C=j(`n-checkbox-group`),w=j(`n-radio`),T=j(`n-radio-group`),E=j(`n-color-picker`),D=j(`n-button`),te=j(`n-upload`);return A(),g(`div`,ox,[e.field.label?(A(),g(`label`,sx,[o(i(e.field.label)+` `,1),e.field.required?(A(),g(`span`,cx,`*`)):c(``,!0)])):c(``,!0),e.field.description?(A(),g(`p`,lx,i(e.field.description),1)):c(``,!0),r(`div`,ux,[[`input`,`textarea`].includes(e.field.type)||d.value?(A(),g(u,{key:0},[e.field.type===`textarea`?(A(),s(ax,{key:0,"model-value":e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,multiline:!0,"show-border":e.isDraggingVariable,"preview-mode":`dropdown`,"onUpdate:modelValue":f},null,8,[`model-value`,`placeholder`,`disabled`,`show-border`])):(A(),s(ax,{key:1,"model-value":e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,multiline:!1,"show-border":e.isDraggingVariable,"preview-mode":`dropdown`,"onUpdate:modelValue":f},null,8,[`model-value`,`placeholder`,`disabled`,`show-border`]))],64)):e.field.type===`number`?(A(),s(a,{key:1,value:e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,min:v(`min`),max:v(`max`),step:v(`step`)||1,class:`w-full`,"onUpdate:value":f},null,8,[`value`,`placeholder`,`disabled`,`min`,`max`,`step`])):e.field.type===`select`?(A(),s(m,{key:2,value:e.modelValue,options:e.field.options,placeholder:e.field.placeholder,disabled:e.field.disabled,"onUpdate:value":f},null,8,[`value`,`options`,`placeholder`,`disabled`])):e.field.type===`switch`?(A(),s(y,{key:3,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":f},null,8,[`value`,`disabled`])):e.field.type===`checkbox`?(A(),s(C,{key:4,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":f},{default:ae(()=>[b(S,{vertical:``},{default:ae(()=>[(A(!0),g(u,null,ee(e.field.options,e=>(A(),s(x,{key:e.value,value:e.value,label:e.label},null,8,[`value`,`label`]))),128))]),_:1})]),_:1},8,[`value`,`disabled`])):e.field.type===`radio`?(A(),s(T,{key:5,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":f},{default:ae(()=>[b(S,{vertical:``},{default:ae(()=>[(A(!0),g(u,null,ee(e.field.options,e=>(A(),s(w,{key:e.value,value:e.value,label:e.label},null,8,[`value`,`label`]))),128))]),_:1})]),_:1},8,[`value`,`disabled`])):e.field.type===`color`?(A(),s(E,{key:6,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":f},null,8,[`value`,`disabled`])):e.field.type===`file`?(A(),s(te,{key:7,disabled:e.field.disabled,onChange:h},{default:ae(()=>[b(D,{secondary:``},{default:ae(()=>[...n[0]||=[o(`é€‰æ‹©æ–‡ä»¶`,-1)]]),_:1})]),_:1},8,[`disabled`])):e.field.type===`json-editor`?(A(),s(ax,{key:8,"model-value":_(e.modelValue),placeholder:e.field.placeholder||`è¾“å…¥ JSON æ•°æ®...`,disabled:e.field.disabled,multiline:!0,"preview-mode":`dropdown`,"onUpdate:modelValue":p},null,8,[`model-value`,`placeholder`,`disabled`])):e.field.type===`code-editor`?(A(),s(ax,{key:9,"model-value":e.modelValue,placeholder:e.field.placeholder||`è¾“å…¥ä»£ç ...`,disabled:e.field.disabled,multiline:!0,"preview-mode":`dropdown`,"onUpdate:modelValue":f},null,8,[`model-value`,`placeholder`,`disabled`])):(A(),g(`div`,dx,` ä¸æ”¯æŒçš„å­—æ®µç±»å‹: `+i(e.field.type),1))]),l.value?(A(),g(`div`,fx,i(l.value),1)):c(``,!0)])}}}),mx=P(px,[[`__scopeId`,`data-v-3a142664`]]),hx={},gx={t:`1762602673971`,class:`icon`,viewBox:`0 0 1024 1024`,version:`1.1`,xmlns:`http://www.w3.org/2000/svg`,"p-id":`4550`,width:`200`,height:`200`};function _x(e,t){return A(),g(`svg`,gx,[...t[0]||=[r(`path`,{d:`M219.428571 585.142857c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142858-73.142857-36.571429-73.142857-73.142858-73.142857z m585.142858-146.285714c36.571429 0 73.142857-36.571429 73.142857-73.142857s-36.571429-73.142857-73.142857-73.142857-73.142857 36.571429-73.142858 73.142857 36.571429 73.142857 73.142858 73.142857zM219.428571 292.571429c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142858-73.142857-36.571429-73.142857-73.142858-73.142857z m585.142858 292.571428c-36.571429 0-73.142857 36.571429-73.142858 73.142857s36.571429 73.142857 73.142858 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857zM512 292.571429c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857z m0 292.571428c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857z`,"p-id":`4551`},null,-1)]])}var vx=P(hx,[[`render`,_x]]),yx={},bx={t:`1762602894224`,class:`icon`,viewBox:`0 0 1024 1024`,version:`1.1`,xmlns:`http://www.w3.org/2000/svg`,"p-id":`6340`,stroke:`currentColor`,fill:`currentColor`};function xx(e,t){return A(),g(`svg`,bx,[...t[0]||=[r(`path`,{d:`M457.941333 844.373333a32 32 0 1 0 44.117334-46.293333L235.349333 544H864a32 32 0 0 0 0-64H235.349333l266.709334-254.08a32 32 0 0 0-44.117334-46.336l-316.586666 301.525333a42.453333 42.453333 0 0 0-12.8 24.746667 32.128 32.128 0 0 0 0.042666 12.330667 42.453333 42.453333 0 0 0 12.8 24.704l316.544 301.525333z`,"p-id":`6341`},null,-1)]])}var Sx=P(yx,[[`render`,xx]]),Cx={class:`split-layout fixed inset-0 bg-black/30 backdrop-blur-sm overflow-hidden`},wx={class:`flex h-full px-10 py-6`,style:{"min-width":`0`,"max-width":`100vw`,overflow:`hidden`}},Tx={class:`h-full overflow-auto variable-scroll`},Ex={class:`bg-white rounded-md px-3 py-1 flex items-center justify-center border border-slate-200`},Dx={class:`w-full h-full rounded-lg overflow-hidden bg-white flex flex-col`},Ox={key:0,class:`shrink-0 border-b border-slate-200 bg-white px-6 py-3 rounded-t-lg`},kx={key:0,class:`text-base font-semibold text-slate-900`},Ax={class:`flex-1 h-full overflow-auto variable-scroll`},jx={class:`h-full overflow-auto variable-scroll`},Mx=x({__name:`SplitLayout`,props:{leftWidth:{default:void 0},rightWidth:{default:void 0},centerWidth:{default:400},minLeftWidth:{default:200},minRightWidth:{default:200},centerTitle:{default:void 0},showBackButton:{type:Boolean,default:!0},backText:{default:`Back to canvas`}},emits:[`back`,`resize`],setup(t,{emit:n}){let a=t,o=n,s=M(),l=M(),u=M(),f=M(),p=M(),_=()=>p.value?p.value.clientWidth:window.innerWidth-80,v=e=>e<=1,y=(e,t)=>v(e)?t*e:e,x=()=>{let e=_();return y(a.centerWidth,e)},S=()=>{let e=_(),t=x(),n=e-t;return y(a.minLeftWidth,n)},w=()=>{let e=_(),t=x(),n=e-t;return y(a.minRightWidth,n)},ee=()=>{let e=_(),t=x(),n=e-t;if(a.leftWidth!==void 0&&a.rightWidth!==void 0){let e=y(a.leftWidth,n),t=y(a.rightWidth,n);return{left:e,right:t}}let r=S(),i=Math.max(r,Math.floor(n/2));return{left:i,right:n-i}},T=M(0),E=M(0),D=M(!1),te=M(0),ne=()=>{if(!p.value)return;let e=p.value.clientWidth,t=x(),n=e-t,r=S(),i=w();te.value=Math.max(r,n-i)},re=()=>{let e=ee();T.value=e.left,E.value=e.right,ne()},O=m(()=>{let e=S();return{width:`${Math.max(e,Math.min(T.value,te.value))}px`,minWidth:`${e}px`,maxWidth:`${te.value}px`}}),ie=m(()=>{let e=x();return{width:`${e}px`,minWidth:`${e}px`,maxWidth:`${e}px`}}),ae=m(()=>({minWidth:`${w()}px`})),j=M(!1),se=0,ce=0,le=0,ue=e=>{e.preventDefault(),e.stopPropagation(),ne(),j.value=!0,se=e.clientX,ce=T.value,le=E.value,document.addEventListener(`mousemove`,de),document.addEventListener(`mouseup`,N),document.body.style.cursor=`col-resize`,document.body.style.userSelect=`none`},de=e=>{if(!j.value||(e.preventDefault(),e.stopPropagation(),!p.value))return;let t=e.clientX-se,n=p.value.clientWidth,r=x(),i=n-r,a=ce+t,s=le-t,c=S(),l=w();a=Math.max(c,Math.min(te.value,a));let u=i-c;s=Math.max(l,Math.min(u,s)),a+s>i&&(s=i-a,s<l&&(s=l,a=Math.max(c,i-s))),T.value=Math.round(a),E.value=Math.round(s),o(`resize`,{leftWidth:T.value,rightWidth:E.value})},N=e=>{if(j.value&&(j.value=!1,document.removeEventListener(`mousemove`,de),document.removeEventListener(`mouseup`,N),document.body.style.cursor=``,document.body.style.userSelect=``,e&&u.value)){let t=u.value.getBoundingClientRect(),n=e.clientY;n>=t.top&&n<=t.top+50&&(D.value=!0)}},fe=()=>{o(`back`)},P=null,me=``;return oe(async()=>{if(me=document.body.style.overflow,document.body.style.overflow=`hidden`,await C(),ne(),a.leftWidth!==void 0&&a.rightWidth!==void 0){let e=_(),t=x(),n=e-t;T.value=y(a.leftWidth,n),E.value=y(a.rightWidth,n)}else re();P=()=>{if(ne(),a.leftWidth!==void 0&&a.rightWidth!==void 0){let e=_(),t=x(),n=e-t;if(v(a.leftWidth)||v(a.rightWidth))T.value=y(a.leftWidth,n),E.value=y(a.rightWidth,n);else{let e=S(),t=w(),r=T.value+E.value;if(r>n){let i=n/r;T.value=Math.max(e,Math.min(te.value,Math.round(T.value*i))),E.value=Math.max(t,Math.round(E.value*i))}}}else{let e=_(),t=x(),n=e-t,r=T.value+E.value,i=S(),a=w();if(r>n){let e=n/r;T.value=Math.max(i,Math.min(te.value,Math.round(T.value*e))),E.value=Math.max(a,Math.round(E.value*e))}}},window.addEventListener(`resize`,P)}),e(()=>{N(),P&&window.removeEventListener(`resize`,P),document.body.style.overflow=me}),(e,n)=>(A(),g(`div`,Cx,[t.showBackButton?(A(),g(`button`,{key:0,class:`absolute left-5 top-0 z-50 flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-white/90 hover:text-white`,onClick:fe},[n[2]||=r(`svg`,{class:`h-4 w-4`,fill:`none`,stroke:`currentColor`,"stroke-width":`2`,viewBox:`0 0 24 24`},[r(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,d:`M15 19l-7-7 7-7`})],-1),r(`span`,null,i(t.backText),1)])):c(``,!0),r(`div`,wx,[r(`div`,{ref_key:`containerRef`,ref:p,class:`flex w-full h-full`},[r(`div`,{ref_key:`leftPanelRef`,ref:s,class:`overflow-hidden bg-white border-r border-slate-200 my-6 rounded-l-lg shrink-0`,style:h(O.value)},[r(`div`,Tx,[k(e.$slots,`left`)])],4),r(`div`,{ref_key:`centerPanelRef`,ref:u,class:`relative flex flex-col h-full shrink-0 shadow-lg z-10`,style:h(ie.value),onMouseenter:n[0]||=e=>D.value=!0,onMouseleave:n[1]||=e=>D.value=!1},[r(`div`,{class:d([`absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 -z-5 transition-opacity duration-200`,D.value||j.value?`opacity-100`:`opacity-0`])},[r(`div`,{ref_key:`dragHandleRef`,ref:f,class:`group cursor-col-resize flex items-center gap-2 pointer-events-auto`,onMousedown:ue},[r(`div`,{class:d([`flex items-center transition-opacity duration-200 opacity-0 group-hover:opacity-100 -translate-y-2 scale-75`,j.value&&`opacity-100`])},[b(Sx,{class:`w-4 h-4 text-white`})],2),r(`div`,Ex,[b(vx,{class:`w-14 h-5 scale-110 -translate-y-0.5 text-slate-400`})]),r(`div`,{class:d([`flex items-center transition-opacity duration-200 opacity-0 group-hover:opacity-100 -translate-y-2 scale-75`,j.value&&`opacity-100`])},[b(pe,{class:`w-4 h-4 text-white`})],2)],544)],2),r(`div`,Dx,[t.centerTitle||e.$slots.centerHeader?(A(),g(`div`,Ox,[k(e.$slots,`centerHeader`,{},()=>[t.centerTitle?(A(),g(`h2`,kx,i(t.centerTitle),1)):c(``,!0)])])):c(``,!0),r(`div`,Ax,[k(e.$slots,`center`)])])],36),r(`div`,{ref_key:`rightPanelRef`,ref:l,class:`overflow-hidden bg-white border-l border-slate-200 my-6 rounded-r-lg flex-1 min-w-0`,style:h(ae.value)},[r(`div`,jx,[k(e.$slots,`right`)])],4)],512)])]))}}),Nx=[`onClick`],Px=x({name:`ToggleButtonGroup`,props:{options:{},modelValue:{},size:{}},emits:[`update:modelValue`],setup(e,{emit:t}){let n=e,a=t,l=M(null),f=M(new Map),p=m(()=>{switch(n.size??`md`){case`sm`:return`h-6`;case`lg`:return`h-8`;default:return`h-7`}}),_=m(()=>{switch(n.size??`md`){case`sm`:return`h-5`;case`lg`:return`h-7`;default:return`h-6`}}),v=m(()=>{switch(n.size??`md`){case`sm`:return`px-2 py-0.5`;case`lg`:return`px-3 py-1.5`;default:return`px-2.5 py-1`}}),y=m(()=>{switch(n.size??`md`){case`sm`:return`text-[11px]`;case`lg`:return`text-sm`;default:return`text-xs`}}),b=m(()=>{switch(n.size??`md`){case`sm`:return`h-3 w-3`;case`lg`:return`h-4 w-4`;default:return`h-3.5 w-3.5`}}),x=m(()=>{let e=f.value.get(n.modelValue);if(!e||!l.value)return{width:`0px`,left:`0px`,opacity:0};let t=l.value.getBoundingClientRect(),r=e.getBoundingClientRect();return{width:`${r.width}px`,left:`${r.left-t.left}px`,opacity:1}}),S=e=>{a(`update:modelValue`,e)},w=(e,t)=>{if(Array.isArray(e)){let n=e[0];n?f.value.set(t,n):f.value.delete(t)}else e?f.value.set(t,e):f.value.delete(t)};return D(()=>n.modelValue,async()=>{await C()}),oe(async()=>{await C()}),(t,n)=>(A(),g(`div`,{ref_key:`containerRef`,ref:l,class:d([`relative flex items-center bg-slate-200 rounded-md p-0.5`,p.value])},[r(`div`,{class:d([`absolute bg-white rounded transition-all duration-200 ease-out`,_.value]),style:h(x.value)},null,6),(A(!0),g(u,null,ee(e.options,t=>(A(),g(`button`,{key:t.value,ref_for:!0,ref:e=>w(e,t.value),onClick:e=>S(t.value),class:d([`relative z-10 font-medium rounded transition-all flex items-center gap-1.5`,v.value,y.value,e.modelValue===t.value?`text-slate-900`:`text-slate-500`])},[t.icon?(A(),s(E(t.icon),{key:0,class:d(b.value)},null,8,[`class`])):c(``,!0),o(` `+i(t.label),1)],10,Nx))),128))],2))}});export{je as C,He as D,Be as E,Ee as O,Xe as S,ke as T,Lt as _,Hb as a,xt as b,Rd as c,hd as d,dd as f,Bt as g,Ut as h,ax as i,Dd as l,Gt as m,Mx as n,Xd as o,sd as p,mx as r,Kd as s,Px as t,gd as u,Vt as v,Le as w,nt as x,Ot as y};