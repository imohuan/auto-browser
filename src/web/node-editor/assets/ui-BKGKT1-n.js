import{$ as e,A as t,B as n,Ct as r,E as i,Et as a,F as o,H as s,J as c,M as l,N as u,O as d,Ot as f,P as p,Q as m,S as h,Tt as g,V as _,X as v,_t as y,at as b,b as x,bt as S,ct as C,dt as w,et as T,gt as E,it as D,j as O,jt as k,k as A,kt as j,lt as M,mt as N,nt as P,q as ee,rt as F,st as I,ut as L,v as R,vt as z,wt as B,x as V,xt as H,z as U}from"./index-B7qcHONN.js";import{n as W,r as te}from"./events-DYHBDbVc.js";import{t as G}from"./_plugin-vue_export-helper-DEnkkObV.js";import{t as ne}from"./IconChevronRight-CSVGKrG2.js";function re(e,t){return R(e,t)}var ie=re;function ae(e,t){return N()?(y(e,t),!0):!1}var K=typeof window<`u`&&typeof document<`u`;typeof WorkerGlobalScope<`u`&&globalThis instanceof WorkerGlobalScope;var oe=e=>e!=null,se=Object.prototype.toString,ce=e=>se.call(e)===`[object Object]`,q=()=>{},le=ue();function ue(){var e,t;return K&&((e=window)==null||(e=e.navigator)==null?void 0:e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((t=window)==null||(t=t.navigator)==null?void 0:t.maxTouchPoints)>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function de(e){return Array.isArray(e)?e:[e]}function fe(e,t,n){return C(e,t,{...n,immediate:!0})}function pe(e,t,n){let r=C(e,(e,i,a)=>{e&&(n?.once&&c(()=>r()),t(e,i,a))},{...n,once:!1});return r}var J=K?window:void 0;K&&window.document,K&&window.navigator,K&&window.location;function me(e){let t=B(e);return t?.$el??t}function Y(...e){let t=[],n=()=>{t.forEach(e=>e()),t.length=0},r=(e,t,n,r)=>(e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)),i=O(()=>{let t=de(B(e[0])).filter(e=>e!=null);return t.every(e=>typeof e!=`string`)?t:void 0}),a=fe(()=>[i.value?.map(e=>me(e))??[J].filter(e=>e!=null),de(B(i.value?e[1]:e[0])),de(g(i.value?e[2]:e[1])),B(i.value?e[3]:e[2])],([e,i,a,o])=>{if(n(),!e?.length||!i?.length||!a?.length)return;let s=ce(o)?{...o}:o;t.push(...e.flatMap(e=>i.flatMap(t=>a.map(n=>r(e,t,n,s)))))},{flush:`post`});return ae(n),()=>{a(),n()}}var he=!1;function ge(e,t,n={}){let{window:r=J,ignore:i=[],capture:a=!0,detectIframe:o=!1,controls:s=!1}=n;if(!r)return s?{stop:q,cancel:q,trigger:q}:q;if(le&&!he){he=!0;let e={passive:!0};Array.from(r.document.body.children).forEach(t=>t.addEventListener(`click`,q,e)),r.document.documentElement.addEventListener(`click`,q,e)}let c=!0,l=e=>B(i).some(t=>{if(typeof t==`string`)return Array.from(r.document.querySelectorAll(t)).some(t=>t===e.target||e.composedPath().includes(t));{let n=me(t);return n&&(e.target===n||e.composedPath().includes(n))}});function u(e){let t=B(e);return t&&t.$.subTree.shapeFlag===16}function d(e,t){let n=B(e),r=n.$.subTree&&n.$.subTree.children;return r==null||!Array.isArray(r)?!1:r.some(e=>e.el===t.target||t.composedPath().includes(e.el))}let f=n=>{let r=me(e);if(n.target!=null&&!(!(r instanceof Element)&&u(e)&&d(e,n))&&!(!r||r===n.target||n.composedPath().includes(r))){if(`detail`in n&&n.detail===0&&(c=!l(n)),!c){c=!0;return}t(n)}},p=!1,m=[Y(r,`click`,e=>{p||(p=!0,setTimeout(()=>{p=!1},0),f(e))},{passive:!0,capture:a}),Y(r,`pointerdown`,t=>{let n=me(e);c=!l(t)&&!!(n&&!t.composedPath().includes(n))},{passive:!0}),o&&Y(r,`blur`,n=>{setTimeout(()=>{let i=me(e);r.document.activeElement?.tagName===`IFRAME`&&!i?.contains(r.document.activeElement)&&t(n)},0)},{passive:!0})].filter(Boolean),h=()=>m.forEach(e=>e());return s?{stop:h,cancel:()=>{c=!1},trigger:e=>{c=!0,f(e),c=!1}}:h}function _e(){let e=H(!1),t=s();return t&&m(()=>{e.value=!0},t),e}function ve(e){let t=_e();return O(()=>(t.value,!!e()))}function ye(e,t,n={}){let{window:r=J,...i}=n,a,o=ve(()=>r&&`MutationObserver`in r),s=()=>{a&&=(a.disconnect(),void 0)},c=C(O(()=>{let t=de(B(e)).map(me).filter(oe);return new Set(t)}),e=>{s(),o.value&&e.size&&(a=new MutationObserver(t),e.forEach(e=>a.observe(e,i)))},{immediate:!0,flush:`post`}),l=()=>a?.takeRecords(),u=()=>{c(),s()};return ae(u),{isSupported:o,stop:u,takeRecords:l}}function be(e,t,n={}){let{window:r=J,document:i=r?.document,flush:a=`sync`}=n;if(!r||!i)return q;let o,s=e=>{o?.(),o=e},c=M(()=>{let n=me(e);if(n){let{stop:e}=ye(i,e=>{e.map(e=>[...e.removedNodes]).flat().some(e=>e===n||e.contains(n))&&t(e)},{window:r,childList:!0,subtree:!0});s(e)}},{flush:a}),l=()=>{c(),s()};return ae(l),l}function xe(e){return typeof e==`function`?e:typeof e==`string`?t=>t.key===e:Array.isArray(e)?t=>e.includes(t.key):()=>!0}function Se(...e){let t,n,r={};e.length===3?(t=e[0],n=e[1],r=e[2]):e.length===2?typeof e[1]==`object`?(t=!0,n=e[0],r=e[1]):(t=e[0],n=e[1]):(t=!0,n=e[0]);let{target:i=J,eventName:a=`keydown`,passive:o=!1,dedupe:s=!1}=r,c=xe(t);return Y(i,a,e=>{e.repeat&&B(s)||c(e)&&n(e)},o)}function Ce(e={}){let{window:t=J,deep:n=!0,triggerOnRemoval:r=!1}=e,i=e.document??t?.document,a=()=>{let e=i?.activeElement;if(n)for(var t;e?.shadowRoot;)e=e==null||(t=e.shadowRoot)==null?void 0:t.activeElement;return e},o=H(),s=()=>{o.value=a()};if(t){let e={capture:!0,passive:!0};Y(t,`blur`,e=>{e.relatedTarget===null&&s()},e),Y(t,`focus`,s,e)}return r&&be(o,s,{document:i}),s(),o}var we={ctrl:`control`,command:`meta`,cmd:`meta`,option:`alt`,up:`arrowup`,down:`arrowdown`,left:`arrowleft`,right:`arrowright`};function Te(e={}){let{reactive:t=!1,target:n=J,aliasMap:r=we,passive:i=!0,onEventFired:a=q}=e,o=z(new Set),s={toJSON(){return{}},current:o},c=t?z(s):s,l=new Set,u=new Map([[`Meta`,l],[`Shift`,new Set],[`Alt`,new Set]]),d=new Set;function f(e,n){e in c&&(t?c[e]=n:c[e].value=n)}function p(){o.clear();for(let e of d)f(e,!1)}function m(e,t,n){if(!(!e||typeof t.getModifierState!=`function`)){for(let[e,r]of u)if(t.getModifierState(e)){n.forEach(e=>r.add(e));break}}}function h(e,t){if(e)return;let n=`${t[0].toUpperCase()}${t.slice(1)}`,r=u.get(n);if(![`shift`,`alt`].includes(t)||!r)return;let i=Array.from(r),a=i.indexOf(t);i.forEach((e,t)=>{t>=a&&(o.delete(e),f(e,!1))}),r.clear()}function g(e,t){let n=e.key?.toLowerCase(),r=[e.code?.toLowerCase(),n].filter(Boolean);n&&(t?o.add(n):o.delete(n));for(let e of r)d.add(e),f(e,t);m(t,e,[...o,...r]),h(t,n),n===`meta`&&!t&&(l.forEach(e=>{o.delete(e),f(e,!1)}),l.clear())}Y(n,`keydown`,e=>(g(e,!0),a(e)),{passive:i}),Y(n,`keyup`,e=>(g(e,!1),a(e)),{passive:i}),Y(`blur`,p,{passive:i}),Y(`focus`,p,{passive:i});let _=new Proxy(c,{get(e,n,i){if(typeof n!=`string`)return Reflect.get(e,n,i);if(n=n.toLowerCase(),n in r&&(n=r[n]),!(n in c))if(/[+_-]/.test(n)){let e=n.split(/[+_-]/g).map(e=>e.trim());c[n]=O(()=>e.map(e=>B(_[e])).every(Boolean))}else c[n]=H(!1);let a=Reflect.get(e,n,i);return t?B(a):a}});return _}var X=class e extends Error{constructor(t){super(`ClientResponseError`),this.url=``,this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,e.prototype),typeof t==`object`&&t&&(this.url=typeof t.url==`string`?t.url:``,this.status=typeof t.status==`number`?t.status:0,this.isAbort=!!t.isAbort,this.originalError=t.originalError,t.response!==null&&typeof t.response==`object`?this.response=t.response:t.data!==null&&typeof t.data==`object`?this.response=t.data:this.response={}),this.originalError||t instanceof e||(this.originalError=t),typeof DOMException<`u`&&t instanceof DOMException&&(this.isAbort=!0),this.name=`ClientResponseError `+this.status,this.message=this.response?.message,this.message||(this.isAbort?this.message=`The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.`:this.originalError?.cause?.message?.includes(`ECONNREFUSED ::1`)?this.message=`Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).`:this.message=`Something went wrong.`),this.cause=this.originalError}get data(){return this.response}toJSON(){return{...this}}},Ee=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function De(e,t){let n={};if(typeof e!=`string`)return n;let r=Object.assign({},t||{}).decode||ke,i=0;for(;i<e.length;){let t=e.indexOf(`=`,i);if(t===-1)break;let a=e.indexOf(`;`,i);if(a===-1)a=e.length;else if(a<t){i=e.lastIndexOf(`;`,t-1)+1;continue}let o=e.slice(i,t).trim();if(n[o]===void 0){let i=e.slice(t+1,a).trim();i.charCodeAt(0)===34&&(i=i.slice(1,-1));try{n[o]=r(i)}catch{n[o]=i}}i=a+1}return n}function Oe(e,t,n){let r=Object.assign({},n||{}),i=r.encode||Ae;if(!Ee.test(e))throw TypeError(`argument name is invalid`);let a=i(t);if(a&&!Ee.test(a))throw TypeError(`argument val is invalid`);let o=e+`=`+a;if(r.maxAge!=null){let e=r.maxAge-0;if(isNaN(e)||!isFinite(e))throw TypeError(`option maxAge is invalid`);o+=`; Max-Age=`+Math.floor(e)}if(r.domain){if(!Ee.test(r.domain))throw TypeError(`option domain is invalid`);o+=`; Domain=`+r.domain}if(r.path){if(!Ee.test(r.path))throw TypeError(`option path is invalid`);o+=`; Path=`+r.path}if(r.expires){if(!function(e){return Object.prototype.toString.call(e)===`[object Date]`||e instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw TypeError(`option expires is invalid`);o+=`; Expires=`+r.expires.toUTCString()}if(r.httpOnly&&(o+=`; HttpOnly`),r.secure&&(o+=`; Secure`),r.priority)switch(typeof r.priority==`string`?r.priority.toLowerCase():r.priority){case`low`:o+=`; Priority=Low`;break;case`medium`:o+=`; Priority=Medium`;break;case`high`:o+=`; Priority=High`;break;default:throw TypeError(`option priority is invalid`)}if(r.sameSite)switch(typeof r.sameSite==`string`?r.sameSite.toLowerCase():r.sameSite){case!0:o+=`; SameSite=Strict`;break;case`lax`:o+=`; SameSite=Lax`;break;case`strict`:o+=`; SameSite=Strict`;break;case`none`:o+=`; SameSite=None`;break;default:throw TypeError(`option sameSite is invalid`)}return o}function ke(e){return e.indexOf(`%`)===-1?e:decodeURIComponent(e)}function Ae(e){return encodeURIComponent(e)}var je=typeof navigator<`u`&&navigator.product===`ReactNative`||typeof global<`u`&&global.HermesInternal,Me;function Ne(e){if(e)try{let t=decodeURIComponent(Me(e.split(`.`)[1]).split(``).map((function(e){return`%`+(`00`+e.charCodeAt(0).toString(16)).slice(-2)})).join(``));return JSON.parse(t)||{}}catch{}return{}}function Pe(e,t=0){let n=Ne(e);return!(Object.keys(n).length>0&&(!n.exp||n.exp-t>Date.now()/1e3))}Me=typeof atob!=`function`||je?e=>{let t=String(e).replace(/=+$/,``);if(t.length%4==1)throw Error(`'atob' failed: The string to be decoded is not correctly encoded.`);for(var n,r,i=0,a=0,o=``;r=t.charAt(a++);~r&&(n=i%4?64*n+r:r,i++%4)&&(o+=String.fromCharCode(255&n>>(-2*i&6))))r=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=`.indexOf(r);return o}:atob;var Fe=`pb_auth`,Ie=class{constructor(){this.baseToken=``,this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get record(){return this.baseModel}get model(){return this.baseModel}get isValid(){return!Pe(this.token)}get isSuperuser(){let e=Ne(this.token);return e.type==`auth`&&(this.record?.collectionName==`_superusers`||!this.record?.collectionName&&e.collectionId==`pbc_3142635823`)}get isAdmin(){return console.warn(`Please replace pb.authStore.isAdmin with pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName`),this.isSuperuser}get isAuthRecord(){return console.warn(`Please replace pb.authStore.isAuthRecord with !pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName`),Ne(this.token).type==`auth`&&!this.isSuperuser}save(e,t){this.baseToken=e||``,this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken=``,this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Fe){let n=De(e||``)[t]||``,r={};try{r=JSON.parse(n),(typeof r!=`object`||Array.isArray(r))&&(r={})}catch{}this.save(r.token||``,r.record||r.model||null)}exportToCookie(e,t=Fe){let n={secure:!0,sameSite:!0,httpOnly:!0,path:`/`},r=Ne(this.token);n.expires=r?.exp?new Date(1e3*r.exp):new Date(`1970-01-01`),e=Object.assign({},n,e);let i={token:this.token,record:this.record?JSON.parse(JSON.stringify(this.record)):null},a=Oe(t,JSON.stringify(i),e),o=typeof Blob<`u`?new Blob([a]).size:a.length;if(i.record&&o>4096){i.record={id:i.record?.id,email:i.record?.email};let n=[`collectionId`,`collectionName`,`verified`];for(let e in this.record)n.includes(e)&&(i.record[e]=this.record[e]);a=Oe(t,JSON.stringify(i),e)}return a}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.record),()=>{for(let t=this._onChangeCallbacks.length-1;t>=0;t--)if(this._onChangeCallbacks[t]==e)return delete this._onChangeCallbacks[t],void this._onChangeCallbacks.splice(t,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.record)}},Le=class extends Ie{constructor(e=`pocketbase_auth`){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||``}get record(){let e=this._storageGet(this.storageKey)||{};return e.record||e.model||null}get model(){return this.record}save(e,t){this._storageSet(this.storageKey,{token:e,record:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window<`u`&&window?.localStorage){let t=window.localStorage.getItem(e)||``;try{return JSON.parse(t)}catch{return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window<`u`&&window?.localStorage){let n=t;typeof t!=`string`&&(n=JSON.stringify(t)),window.localStorage.setItem(e,n)}else this.storageFallback[e]=t}_storageRemove(e){typeof window<`u`&&window?.localStorage&&window.localStorage?.removeItem(e),delete this.storageFallback[e]}_bindStorageEvent(){typeof window<`u`&&window?.localStorage&&window.addEventListener&&window.addEventListener(`storage`,(e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||``,t.record||t.model||null)}))}},Z=class{constructor(e){this.client=e}},Re=class extends Z{async getAll(e){return e=Object.assign({method:`GET`},e),this.client.send(`/api/settings`,e)}async update(e,t){return t=Object.assign({method:`PATCH`,body:e},t),this.client.send(`/api/settings`,t)}async testS3(e=`storage`,t){return t=Object.assign({method:`POST`,body:{filesystem:e}},t),this.client.send(`/api/settings/test/s3`,t).then((()=>!0))}async testEmail(e,t,n,r){return r=Object.assign({method:`POST`,body:{email:t,template:n,collection:e}},r),this.client.send(`/api/settings/test/email`,r).then((()=>!0))}async generateAppleClientSecret(e,t,n,r,i,a){return a=Object.assign({method:`POST`,body:{clientId:e,teamId:t,keyId:n,privateKey:r,duration:i}},a),this.client.send(`/api/settings/apple/generate-client-secret`,a)}},ze=[`requestKey`,`$cancelKey`,`$autoCancel`,`fetch`,`headers`,`body`,`query`,`params`,`cache`,`credentials`,`headers`,`integrity`,`keepalive`,`method`,`mode`,`redirect`,`referrer`,`referrerPolicy`,`signal`,`window`];function Be(e){if(e)for(let t in e.query=e.query||{},e)ze.includes(t)||(e.query[t]=e[t],delete e[t])}function Ve(e){let t=[];for(let n in e){let r=encodeURIComponent(n),i=Array.isArray(e[n])?e[n]:[e[n]];for(let e of i)e=He(e),e!==null&&t.push(r+`=`+e)}return t.join(`&`)}function He(e){return e==null?null:e instanceof Date?encodeURIComponent(e.toISOString().replace(`T`,` `)):typeof e==`object`?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(e)}var Ue=class extends Z{constructor(){super(...arguments),this.clientId=``,this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,n){if(!e)throw Error(`topic must be set.`);let r=e;if(n){Be(n=Object.assign({},n));let e=`options=`+encodeURIComponent(JSON.stringify({query:n.query,headers:n.headers}));r+=(r.includes(`?`)?`&`:`?`)+e}let i=function(e){let n=e,r;try{r=JSON.parse(n?.data)}catch{}t(r||{})};return this.subscriptions[r]||(this.subscriptions[r]=[]),this.subscriptions[r].push(i),this.isConnected?this.subscriptions[r].length===1?await this.submitSubscriptions():this.eventSource?.addEventListener(r,i):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,i)}async unsubscribe(e){let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let e in n)if(this.hasSubscriptionListeners(e)){for(let t of this.subscriptions[e])this.eventSource?.removeEventListener(e,t);delete this.subscriptions[e],t||=!0}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){let t=!1;for(let n in this.subscriptions)if((n+`?`).startsWith(e)){t=!0;for(let e of this.subscriptions[n])this.eventSource?.removeEventListener(n,e);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){let n=!1,r=this.getSubscriptionsByTopic(e);for(let e in r){if(!Array.isArray(this.subscriptions[e])||!this.subscriptions[e].length)continue;let r=!1;for(let n=this.subscriptions[e].length-1;n>=0;n--)this.subscriptions[e][n]===t&&(r=!0,delete this.subscriptions[e][n],this.subscriptions[e].splice(n,1),this.eventSource?.removeEventListener(e,t));r&&(this.subscriptions[e].length||delete this.subscriptions[e],n||this.hasSubscriptionListeners(e)||(n=!0))}this.hasSubscriptionListeners()?n&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){if(this.subscriptions=this.subscriptions||{},e)return!!this.subscriptions[e]?.length;for(let e in this.subscriptions)if(this.subscriptions[e]?.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send(`/api/realtime`,{method:`POST`,body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch((e=>{if(!e?.isAbort)throw e}))}getSubscriptionsCancelKey(){return`realtime_`+this.clientId}getSubscriptionsByTopic(e){let t={};for(let n in e=e.includes(`?`)?e:e+`?`,this.subscriptions)(n+`?`).startsWith(e)&&(t[n]=this.subscriptions[n]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource)for(let e in this.removeAllSubscriptionListeners(),this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise(((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()}))}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout((()=>{this.connectErrorHandler(Error(`EventSource connect took too long.`))}),this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildURL(`/api/realtime`)),this.eventSource.onerror=e=>{this.connectErrorHandler(Error(`Failed to establish realtime connection.`))},this.eventSource.addEventListener(`PB_CONNECT`,(e=>{this.clientId=e?.lastEventId,this.submitSubscriptions().then((async()=>{let e=3;for(;this.hasUnsentSubscriptions()&&e>0;)e--,await this.submitSubscriptions()})).then((()=>{for(let e of this.pendingConnects)e.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let t=this.getSubscriptionsByTopic(`PB_CONNECT`);for(let n in t)for(let r of t[n])r(e)})).catch((e=>{this.clientId=``,this.connectErrorHandler(e)}))}))}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let t of this.pendingConnects)t.reject(new X(e));this.pendingConnects=[],this.disconnect();return}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout((()=>{this.initConnect()}),t)}disconnect(e=!1){if(this.clientId&&this.onDisconnect&&this.onDisconnect(Object.keys(this.subscriptions)),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),this.eventSource?.close(),this.eventSource=null,this.clientId=``,!e){this.reconnectAttempts=0;for(let e of this.pendingConnects)e.resolve();this.pendingConnects=[]}}},We=class extends Z{decode(e){return e}async getFullList(e,t){if(typeof e==`number`)return this._getFullList(e,t);let n=500;return(t=Object.assign({},e,t)).batch&&(n=t.batch,delete t.batch),this._getFullList(n,t)}async getList(e=1,t=30,n){return(n=Object.assign({method:`GET`},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send(this.baseCrudPath,n).then((e=>(e.items=e.items?.map((e=>this.decode(e)))||[],e)))}async getFirstListItem(e,t){return(t=Object.assign({requestKey:`one_by_filter_`+this.baseCrudPath+`_`+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then((e=>{if(!e?.items?.length)throw new X({status:404,response:{code:404,message:`The requested resource wasn't found.`,data:{}}});return e.items[0]}))}async getOne(e,t){if(!e)throw new X({url:this.client.buildURL(this.baseCrudPath+`/`),status:404,response:{code:404,message:`Missing required record id.`,data:{}}});return t=Object.assign({method:`GET`},t),this.client.send(this.baseCrudPath+`/`+encodeURIComponent(e),t).then((e=>this.decode(e)))}async create(e,t){return t=Object.assign({method:`POST`,body:e},t),this.client.send(this.baseCrudPath,t).then((e=>this.decode(e)))}async update(e,t,n){return n=Object.assign({method:`PATCH`,body:t},n),this.client.send(this.baseCrudPath+`/`+encodeURIComponent(e),n).then((e=>this.decode(e)))}async delete(e,t){return t=Object.assign({method:`DELETE`},t),this.client.send(this.baseCrudPath+`/`+encodeURIComponent(e),t).then((()=>!0))}_getFullList(e=500,t){(t||={}).query=Object.assign({skipTotal:1},t.query);let n=[],r=async i=>this.getList(i,e||500,t).then((e=>{let t=e.items;return n=n.concat(t),t.length==e.perPage?r(i+1):n}));return r(1)}};function Ge(e,t,n,r){let i=r!==void 0;return i||n!==void 0?i?(console.warn(e),t.body=Object.assign({},t.body,n),t.query=Object.assign({},t.query,r),t):Object.assign(t,n):t}function Ke(e){e._resetAutoRefresh?.()}var qe=class extends We{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+`/records`}get baseCollectionPath(){return`/api/collections/`+encodeURIComponent(this.collectionIdOrName)}get isSuperusers(){return this.collectionIdOrName==`_superusers`||this.collectionIdOrName==`_pbc_2773867675`}async subscribe(e,t,n){if(!e)throw Error(`Missing topic.`);if(!t)throw Error(`Missing subscription callback.`);return this.client.realtime.subscribe(this.collectionIdOrName+`/`+e,t,n)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+`/`+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e==`number`)return super.getFullList(e,t);let n=Object.assign({},e,t);return super.getFullList(n)}async getList(e=1,t=30,n){return super.getList(e,t,n)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,n){return super.update(e,t,n).then((e=>{if(this.client.authStore.record?.id===e?.id&&(this.client.authStore.record?.collectionId===this.collectionIdOrName||this.client.authStore.record?.collectionName===this.collectionIdOrName)){let t=Object.assign({},this.client.authStore.record.expand),n=Object.assign({},this.client.authStore.record,e);t&&(n.expand=Object.assign(t,e.expand)),this.client.authStore.save(this.client.authStore.token,n)}return e}))}async delete(e,t){return super.delete(e,t).then((t=>(!t||this.client.authStore.record?.id!==e||this.client.authStore.record?.collectionId!==this.collectionIdOrName&&this.client.authStore.record?.collectionName!==this.collectionIdOrName||this.client.authStore.clear(),t)))}authResponse(e){let t=this.decode(e?.record||{});return this.client.authStore.save(e?.token,t),Object.assign({},e,{token:e?.token||``,record:t})}async listAuthMethods(e){return e=Object.assign({method:`GET`,fields:`mfa,otp,password,oauth2`},e),this.client.send(this.baseCollectionPath+`/auth-methods`,e)}async authWithPassword(e,t,n){let r;n=Object.assign({method:`POST`,body:{identity:e,password:t}},n),this.isSuperusers&&(r=n.autoRefreshThreshold,delete n.autoRefreshThreshold,n.autoRefresh||Ke(this.client));let i=await this.client.send(this.baseCollectionPath+`/auth-with-password`,n);return i=this.authResponse(i),r&&this.isSuperusers&&function(e,t,n,r){Ke(e);let i=e.beforeSend,a=e.authStore.record,o=e.authStore.onChange(((t,n)=>{(!t||n?.id!=a?.id||(n?.collectionId||a?.collectionId)&&n?.collectionId!=a?.collectionId)&&Ke(e)}));e._resetAutoRefresh=function(){o(),e.beforeSend=i,delete e._resetAutoRefresh},e.beforeSend=async(a,o)=>{let s=e.authStore.token;if(o.query?.autoRefresh)return i?i(a,o):{url:a,sendOptions:o};let c=e.authStore.isValid;if(c&&Pe(e.authStore.token,t))try{await n()}catch{c=!1}c||await r();let l=o.headers||{};for(let t in l)if(t.toLowerCase()==`authorization`&&s==l[t]&&e.authStore.token){l[t]=e.authStore.token;break}return o.headers=l,i?i(a,o):{url:a,sendOptions:o}}}(this.client,r,(()=>this.authRefresh({autoRefresh:!0})),(()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},n)))),i}async authWithOAuth2Code(e,t,n,r,i,a,o){let s={method:`POST`,body:{provider:e,code:t,codeVerifier:n,redirectURL:r,createData:i}};return s=Ge(`This form of authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, options?).`,s,a,o),this.client.send(this.baseCollectionPath+`/auth-with-oauth2`,s).then((e=>this.authResponse(e)))}authWithOAuth2(...e){if(e.length>1||typeof e?.[0]==`string`)return console.warn(`PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration.`),this.authWithOAuth2Code(e?.[0]||``,e?.[1]||``,e?.[2]||``,e?.[3]||``,e?.[4]||{},e?.[5]||{},e?.[6]||{});let t=e?.[0]||{},n=null;t.urlCallback||(n=Je(void 0));let r=new Ue(this.client);function i(){n?.close(),r.unsubscribe()}let a={},o=t.requestKey;return o&&(a.requestKey=o),this.listAuthMethods(a).then((e=>{let a=e.oauth2.providers.find((e=>e.name===t.provider));if(!a)throw new X(Error(`Missing or invalid provider "${t.provider}".`));let s=this.client.buildURL(`/api/oauth2-redirect`),c=o?this.client.cancelControllers?.[o]:void 0;return c&&(c.signal.onabort=()=>{i()}),new Promise((async(e,o)=>{try{await r.subscribe(`@oauth2`,(async n=>{let l=r.clientId;try{if(!n.state||l!==n.state)throw Error(`State parameters don't match.`);if(n.error||!n.code)throw Error(`OAuth2 redirect error or missing code: `+n.error);let r=Object.assign({},t);delete r.provider,delete r.scopes,delete r.createData,delete r.urlCallback,c?.signal?.onabort&&(c.signal.onabort=null);let i=await this.authWithOAuth2Code(a.name,n.code,a.codeVerifier,s,t.createData,r);e(i)}catch(e){o(new X(e))}i()}));let l={state:r.clientId};t.scopes?.length&&(l.scope=t.scopes.join(` `));let u=this._replaceQueryParams(a.authURL+s,l);await(t.urlCallback||function(e){n?n.location.href=e:n=Je(e)})(u)}catch(e){i(),o(new X(e))}}))})).catch((e=>{throw i(),e}))}async authRefresh(e,t){let n={method:`POST`};return n=Ge(`This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).`,n,e,t),this.client.send(this.baseCollectionPath+`/auth-refresh`,n).then((e=>this.authResponse(e)))}async requestPasswordReset(e,t,n){let r={method:`POST`,body:{email:e}};return r=Ge(`This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).`,r,t,n),this.client.send(this.baseCollectionPath+`/request-password-reset`,r).then((()=>!0))}async confirmPasswordReset(e,t,n,r,i){let a={method:`POST`,body:{token:e,password:t,passwordConfirm:n}};return a=Ge(`This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).`,a,r,i),this.client.send(this.baseCollectionPath+`/confirm-password-reset`,a).then((()=>!0))}async requestVerification(e,t,n){let r={method:`POST`,body:{email:e}};return r=Ge(`This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).`,r,t,n),this.client.send(this.baseCollectionPath+`/request-verification`,r).then((()=>!0))}async confirmVerification(e,t,n){let r={method:`POST`,body:{token:e}};return r=Ge(`This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).`,r,t,n),this.client.send(this.baseCollectionPath+`/confirm-verification`,r).then((()=>{let t=Ne(e),n=this.client.authStore.record;return n&&!n.verified&&n.id===t.id&&n.collectionId===t.collectionId&&(n.verified=!0,this.client.authStore.save(this.client.authStore.token,n)),!0}))}async requestEmailChange(e,t,n){let r={method:`POST`,body:{newEmail:e}};return r=Ge(`This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).`,r,t,n),this.client.send(this.baseCollectionPath+`/request-email-change`,r).then((()=>!0))}async confirmEmailChange(e,t,n,r){let i={method:`POST`,body:{token:e,password:t}};return i=Ge(`This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).`,i,n,r),this.client.send(this.baseCollectionPath+`/confirm-email-change`,i).then((()=>{let t=Ne(e),n=this.client.authStore.record;return n&&n.id===t.id&&n.collectionId===t.collectionId&&this.client.authStore.clear(),!0}))}async listExternalAuths(e,t){return this.client.collection(`_externalAuths`).getFullList(Object.assign({},t,{filter:this.client.filter(`recordRef = {:id}`,{id:e})}))}async unlinkExternalAuth(e,t,n){let r=await this.client.collection(`_externalAuths`).getFirstListItem(this.client.filter(`recordRef = {:recordId} && provider = {:provider}`,{recordId:e,provider:t}));return this.client.collection(`_externalAuths`).delete(r.id,n).then((()=>!0))}async requestOTP(e,t){return t=Object.assign({method:`POST`,body:{email:e}},t),this.client.send(this.baseCollectionPath+`/request-otp`,t)}async authWithOTP(e,t,n){return n=Object.assign({method:`POST`,body:{otpId:e,password:t}},n),this.client.send(this.baseCollectionPath+`/auth-with-otp`,n).then((e=>this.authResponse(e)))}async impersonate(e,t,n){(n=Object.assign({method:`POST`,body:{duration:t}},n)).headers=n.headers||{},n.headers.Authorization||(n.headers.Authorization=this.client.authStore.token);let r=new ct(this.client.baseURL,new Ie,this.client.lang),i=await r.send(this.baseCollectionPath+`/impersonate/`+encodeURIComponent(e),n);return r.authStore.save(i?.token,this.decode(i?.record||{})),r}_replaceQueryParams(e,t={}){let n=e,r=``;e.indexOf(`?`)>=0&&(n=e.substring(0,e.indexOf(`?`)),r=e.substring(e.indexOf(`?`)+1));let i={},a=r.split(`&`);for(let e of a){if(e==``)continue;let t=e.split(`=`);i[decodeURIComponent(t[0].replace(/\+/g,` `))]=decodeURIComponent((t[1]||``).replace(/\+/g,` `))}for(let e in t)t.hasOwnProperty(e)&&(t[e]==null?delete i[e]:i[e]=t[e]);for(let e in r=``,i)i.hasOwnProperty(e)&&(r!=``&&(r+=`&`),r+=encodeURIComponent(e.replace(/%20/g,`+`))+`=`+encodeURIComponent(i[e].replace(/%20/g,`+`)));return r==``?n:n+`?`+r}};function Je(e){if(typeof window>`u`||!window?.open)throw new X(Error(`Not in a browser context - please pass a custom urlCallback function.`));let t=1024,n=768,r=window.innerWidth,i=window.innerHeight;t=t>r?r:t,n=n>i?i:n;let a=r/2-t/2,o=i/2-n/2;return window.open(e,`popup_window`,`width=`+t+`,height=`+n+`,top=`+o+`,left=`+a+`,resizable,menubar=no`)}var Ye=class extends We{get baseCrudPath(){return`/api/collections`}async import(e,t=!1,n){return n=Object.assign({method:`PUT`,body:{collections:e,deleteMissing:t}},n),this.client.send(this.baseCrudPath+`/import`,n).then((()=>!0))}async getScaffolds(e){return e=Object.assign({method:`GET`},e),this.client.send(this.baseCrudPath+`/meta/scaffolds`,e)}async truncate(e,t){return t=Object.assign({method:`DELETE`},t),this.client.send(this.baseCrudPath+`/`+encodeURIComponent(e)+`/truncate`,t).then((()=>!0))}},Xe=class extends Z{async getList(e=1,t=30,n){return(n=Object.assign({method:`GET`},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send(`/api/logs`,n)}async getOne(e,t){if(!e)throw new X({url:this.client.buildURL(`/api/logs/`),status:404,response:{code:404,message:`Missing required log id.`,data:{}}});return t=Object.assign({method:`GET`},t),this.client.send(`/api/logs/`+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:`GET`},e),this.client.send(`/api/logs/stats`,e)}},Ze=class extends Z{async check(e){return e=Object.assign({method:`GET`},e),this.client.send(`/api/health`,e)}},Qe=class extends Z{getUrl(e,t,n={}){return console.warn(`Please replace pb.files.getUrl() with pb.files.getURL()`),this.getURL(e,t,n)}getURL(e,t,n={}){if(!t||!e?.id||!e?.collectionId&&!e?.collectionName)return``;let r=[];r.push(`api`),r.push(`files`),r.push(encodeURIComponent(e.collectionId||e.collectionName)),r.push(encodeURIComponent(e.id)),r.push(encodeURIComponent(t));let i=this.client.buildURL(r.join(`/`));if(Object.keys(n).length){!1===n.download&&delete n.download;let e=new URLSearchParams(n);i+=(i.includes(`?`)?`&`:`?`)+e}return i}async getToken(e){return e=Object.assign({method:`POST`},e),this.client.send(`/api/files/token`,e).then((e=>e?.token||``))}},$e=class extends Z{async getFullList(e){return e=Object.assign({method:`GET`},e),this.client.send(`/api/backups`,e)}async create(e,t){return t=Object.assign({method:`POST`,body:{name:e}},t),this.client.send(`/api/backups`,t).then((()=>!0))}async upload(e,t){return t=Object.assign({method:`POST`,body:e},t),this.client.send(`/api/backups/upload`,t).then((()=>!0))}async delete(e,t){return t=Object.assign({method:`DELETE`},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then((()=>!0))}async restore(e,t){return t=Object.assign({method:`POST`},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then((()=>!0))}getDownloadUrl(e,t){return console.warn(`Please replace pb.backups.getDownloadUrl() with pb.backups.getDownloadURL()`),this.getDownloadURL(e,t)}getDownloadURL(e,t){return this.client.buildURL(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},et=class extends Z{async getFullList(e){return e=Object.assign({method:`GET`},e),this.client.send(`/api/crons`,e)}async run(e,t){return t=Object.assign({method:`POST`},t),this.client.send(`/api/crons/${encodeURIComponent(e)}`,t).then((()=>!0))}};function tt(e){return typeof Blob<`u`&&e instanceof Blob||typeof File<`u`&&e instanceof File||typeof e==`object`&&!!e&&e.uri&&(typeof navigator<`u`&&navigator.product===`ReactNative`||typeof global<`u`&&global.HermesInternal)}function nt(e){return e&&(e.constructor?.name===`FormData`||typeof FormData<`u`&&e instanceof FormData)}function rt(e){for(let t in e){let n=Array.isArray(e[t])?e[t]:[e[t]];for(let e of n)if(tt(e))return!0}return!1}var it=/^[\-\.\d]+$/;function at(e){if(typeof e!=`string`)return e;if(e==`true`)return!0;if(e==`false`)return!1;if((e[0]===`-`||e[0]>=`0`&&e[0]<=`9`)&&it.test(e)){let t=+e;if(``+t===e)return t}return e}var ot=class extends Z{constructor(){super(...arguments),this.requests=[],this.subs={}}collection(e){return this.subs[e]||(this.subs[e]=new st(this.requests,e)),this.subs[e]}async send(e){let t=new FormData,n=[];for(let e=0;e<this.requests.length;e++){let r=this.requests[e];if(n.push({method:r.method,url:r.url,headers:r.headers,body:r.json}),r.files)for(let n in r.files){let i=r.files[n]||[];for(let r of i)t.append(`requests.`+e+`.`+n,r)}}return t.append(`@jsonPayload`,JSON.stringify({requests:n})),e=Object.assign({method:`POST`,body:t},e),this.client.send(`/api/batch`,e)}},st=class{constructor(e,t){this.requests=[],this.requests=e,this.collectionIdOrName=t}upsert(e,t){t=Object.assign({body:e||{}},t);let n={method:`PUT`,url:`/api/collections/`+encodeURIComponent(this.collectionIdOrName)+`/records`};this.prepareRequest(n,t),this.requests.push(n)}create(e,t){t=Object.assign({body:e||{}},t);let n={method:`POST`,url:`/api/collections/`+encodeURIComponent(this.collectionIdOrName)+`/records`};this.prepareRequest(n,t),this.requests.push(n)}update(e,t,n){n=Object.assign({body:t||{}},n);let r={method:`PATCH`,url:`/api/collections/`+encodeURIComponent(this.collectionIdOrName)+`/records/`+encodeURIComponent(e)};this.prepareRequest(r,n),this.requests.push(r)}delete(e,t){t=Object.assign({},t);let n={method:`DELETE`,url:`/api/collections/`+encodeURIComponent(this.collectionIdOrName)+`/records/`+encodeURIComponent(e)};this.prepareRequest(n,t),this.requests.push(n)}prepareRequest(e,t){if(Be(t),e.headers=t.headers,e.json={},e.files={},t.query!==void 0){let n=Ve(t.query);n&&(e.url+=(e.url.includes(`?`)?`&`:`?`)+n)}let n=t.body;for(let t in nt(n)&&(n=function(e){let t={};return e.forEach(((e,n)=>{if(n===`@jsonPayload`&&typeof e==`string`)try{let n=JSON.parse(e);Object.assign(t,n)}catch(e){console.warn(`@jsonPayload error:`,e)}else t[n]===void 0?t[n]=at(e):(Array.isArray(t[n])||(t[n]=[t[n]]),t[n].push(at(e)))})),t}(n)),n){let r=n[t];if(tt(r))e.files[t]=e.files[t]||[],e.files[t].push(r);else if(Array.isArray(r)){let n=[],i=[];for(let e of r)tt(e)?n.push(e):i.push(e);if(n.length>0&&n.length==r.length){e.files[t]=e.files[t]||[];for(let r of n)e.files[t].push(r)}else if(e.json[t]=i,n.length>0){let r=t;t.startsWith(`+`)||t.endsWith(`+`)||(r+=`+`),e.files[r]=e.files[r]||[];for(let t of n)e.files[r].push(t)}}else e.json[t]=r}}},ct=class{get baseUrl(){return this.baseURL}set baseUrl(e){this.baseURL=e}constructor(e=`/`,t,n=`en-US`){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseURL=e,this.lang=n,t?this.authStore=t:typeof window<`u`&&window.Deno?this.authStore=new Ie:this.authStore=new Le,this.collections=new Ye(this),this.files=new Qe(this),this.logs=new Xe(this),this.settings=new Re(this),this.realtime=new Ue(this),this.health=new Ze(this),this.backups=new $e(this),this.crons=new et(this)}get admins(){return this.collection(`_superusers`)}createBatch(){return new ot(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new qe(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let n in t){let r=t[n];switch(typeof r){case`boolean`:case`number`:r=``+r;break;case`string`:r=`'`+r.replace(/'/g,`\\'`)+`'`;break;default:r=r===null?`null`:r instanceof Date?`'`+r.toISOString().replace(`T`,` `)+`'`:`'`+JSON.stringify(r).replace(/'/g,`\\'`)+`'`}e=e.replaceAll(`{:`+n+`}`,r)}return e}getFileUrl(e,t,n={}){return console.warn(`Please replace pb.getFileUrl() with pb.files.getURL()`),this.files.getURL(e,t,n)}buildUrl(e){return console.warn(`Please replace pb.buildUrl() with pb.buildURL()`),this.buildURL(e)}buildURL(e){let t=this.baseURL;return typeof window>`u`||!window.location||t.startsWith(`https://`)||t.startsWith(`http://`)||(t=window.location.origin?.endsWith(`/`)?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||``,this.baseURL.startsWith(`/`)||(t+=window.location.pathname||`/`,t+=t.endsWith(`/`)?``:`/`),t+=this.baseURL),e&&(t+=t.endsWith(`/`)?``:`/`,t+=e.startsWith(`/`)?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let n=this.buildURL(e);if(this.beforeSend){let e=Object.assign({},await this.beforeSend(n,t));e.url!==void 0||e.options!==void 0?(n=e.url||n,t=e.options||t):Object.keys(e).length&&(t=e,console?.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let e=Ve(t.query);e&&(n+=(n.includes(`?`)?`&`:`?`)+e),delete t.query}return this.getHeader(t.headers,`Content-Type`)==`application/json`&&t.body&&typeof t.body!=`string`&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(n,t).then((async e=>{let n={};try{n=await e.json()}catch{}if(this.afterSend&&(n=await this.afterSend(e,n,t)),e.status>=400)throw new X({url:e.url,status:e.status,data:n});return n})).catch((e=>{throw new X(e)}))}initSendOptions(e,t){if((t=Object.assign({method:`GET`},t)).body=function(e){if(typeof FormData>`u`||e===void 0||typeof e!=`object`||!e||nt(e)||!rt(e))return e;let t=new FormData;for(let n in e){let r=e[n];if(r!==void 0)if(typeof r!=`object`||rt({data:r})){let e=Array.isArray(r)?r:[r];for(let r of e)t.append(n,r)}else{let e={};e[n]=r,t.append(`@jsonPayload`,JSON.stringify(e))}}return t}(t.body),Be(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(!1===t.$autoCancel||!1===t.query.$autoCancel?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,`Content-Type`)!==null||nt(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":`application/json`})),this.getHeader(t.headers,`Accept-Language`)===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,`Authorization`)===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let n=t.requestKey||(t.method||`GET`)+e;delete t.requestKey,this.cancelRequest(n);let r=new AbortController;this.cancelControllers[n]=r,t.signal=r.signal}return t}getHeader(e,t){for(let n in e||={},t=t.toLowerCase(),e)if(n.toLowerCase()==t)return e[n];return null}},lt=`app`;function ut(e,t){return`ctx:${t||lt}:${e}`}function dt(){window?.pocketbaseAPI?.url&&(globalThis.__CONTEXT__HANDLER__=ft({pbUrl:window.pocketbaseAPI.url}))}function ft(e={}){let t=e.pbUrl||`http://127.0.0.1:8090`,n=e.collectionName||`app_cache`,r=new ct(t);async function i(e){try{let t=await r.collection(n).getFirstListItem(`key = "${e}"`);if(t.expireAt){let e=new Date(t.expireAt).getTime();if(Date.now()>e)return await r.collection(n).delete(t.id),null}return t}catch(e){if(e.status===404)return null;throw e}}return{async get(e,t={}){try{let n=ut(e,t?.namespace),r=await i(n);return r?r.value:void 0}catch(e){console.error(`è¯»å–ç¼“å­˜å¤±è´¥:`,e);return}},async set(e,t,a={}){try{let o=ut(e,a?.namespace),s=a?.ttlMs?new Date(Date.now()+a.ttlMs).toISOString():null,c={key:o,namespace:a?.namespace||lt,value:t,expireAt:s};try{let e=await i(o);e?await r.collection(n).update(e.id,c):await r.collection(n).create(c)}catch(e){if(e.status===404||!e.status)await r.collection(n).create(c);else throw e}}catch(e){throw console.error(`ä¿å­˜ç¼“å­˜å¤±è´¥:`,e),e}},async remove(e,t={}){try{let a=ut(e,t?.namespace),o=await i(a);o&&await r.collection(n).delete(o.id)}catch(e){if(e.status!==404)throw console.error(`åˆ é™¤ç¼“å­˜å¤±è´¥:`,e),e}},async clear(e={}){try{let t=`ctx:${e?.namespace||lt}:`,i=await r.collection(n).getFullList({filter:`key ~ "${t}"`});for(let e of i)e.key.startsWith(t)&&await r.collection(n).delete(e.id)}catch(e){throw console.error(`æ¸…ç©ºç¼“å­˜å¤±è´¥:`,e),e}}}}dt();var pt=`app`;function mt(e,t){return`ctx:${t||pt}:${e}`}var ht={async get(e,t){try{let n=mt(e,t?.namespace),r=globalThis.localStorage?.getItem(n);if(!r)return;let i=JSON.parse(r);if(typeof i?.expireAt==`number`&&Date.now()>i.expireAt){globalThis.localStorage?.removeItem(n);return}return i?.value}catch{return}},async set(e,t,n){let r=mt(e,n?.namespace),i={value:t,expireAt:n?.ttlMs?Date.now()+n.ttlMs:void 0};globalThis.localStorage?.setItem(r,JSON.stringify(i))},async remove(e,t){let n=mt(e,t?.namespace);globalThis.localStorage?.removeItem(n)},async clear(e){let t=`ctx:${e?.namespace||pt}:`,n=globalThis.localStorage;if(!n)return;let r=[];for(let e=0;e<n.length;e++){let i=n.key(e);i&&i.startsWith(t)&&r.push(i)}for(let e of r)n.removeItem(e)}};function gt(){let e=te(),t=ht;return{cache:{get handler(){return t},setHandler(e){t=e},async save(n,r,i){try{await t.set(n,r,i),e.emit(`save`,{key:n,value:r,options:i})}catch(t){throw e.emit(`save`,{key:n,value:r,options:i,error:t}),t}},async read(n,r){try{let i=await t.get(n,r);return e.emit(`read`,{key:n,options:r,result:i}),i}catch(t){throw e.emit(`read`,{key:n,options:r,error:t}),t}},async remove(n,r){try{await t.remove(n,r),e.emit(`remove`,{key:n,options:r})}catch(t){throw e.emit(`remove`,{key:n,options:r,error:t}),t}},async clear(n){try{typeof t.clear==`function`&&await t.clear(n),e.emit(`clear`,{options:n})}catch(t){throw e.emit(`clear`,{options:n,error:t}),t}},subscribe(t,n){return e.on(t,n),()=>e.off(t,n)}}}}globalThis.__CONTEXT__||(globalThis.__CONTEXT__=gt(),globalThis.__CONTEXT__HANDLER__&&(console.log(`ðŸš€ ~ åŠ è½½ä¸Šä¸‹æ–‡å¤„ç†å™¨:`,globalThis.__CONTEXT__HANDLER__),globalThis.__CONTEXT__.cache.setHandler(globalThis.__CONTEXT__HANDLER__)));const Q=()=>globalThis.__CONTEXT__,_t={autoSave:!0,gridSize:20,snapToGrid:!1,executionMode:`worker`,serverUrl:`http://localhost:3000`,maxConcurrent:3,defaultZoom:1,minZoom:.1,maxZoom:4,edgeType:`default`,edgeWidth:2,edgeColor:`#94a3b8`,edgeActiveColor:`#3b82f6`,edgeAnimation:!1,edgeShowArrow:!0,showGrid:!0,gridType:`dots`,gridGap:20,bgColor:`#ffffff`,gridColor:`#e2e8f0`,showMiniMap:!1,autoLayoutDirection:`LR`,autoLayoutNodeSpacing:50,autoLayoutRankSpacing:80,autoLayoutPadding:120,autoLayoutFitView:!0,autoLayoutFitViewPadding:.2,autoLayoutFitViewDuration:400};var vt=`editorConfig`,yt=`v2`;async function bt(){try{let e=await Q().cache.read(vt,{namespace:yt});if(e)return{..._t,...e}}catch(e){console.error(`[EditorConfig Store] åŠ è½½é…ç½®å¤±è´¥:`,e)}return{..._t}}async function xt(e){try{await Q().cache.save(vt,e,{namespace:yt})}catch(e){console.error(`[EditorConfig Store] ä¿å­˜é…ç½®å¤±è´¥:`,e)}}const St=x(`editorConfig`,()=>{let e=S({..._t});(async()=>{e.value=await bt();let t=new URLSearchParams(window.location.href.split(`?`)[1]),n=t.get(`serverUrl`);console.log(t,n),n&&(e.value.executionMode=`server`,e.value.serverUrl=n)})();let t=null;function n(t){e.value={...e.value,...t}}function r(){e.value={..._t}}function i(){return JSON.stringify(e.value,null,2)}function a(t){try{let n=JSON.parse(t);return e.value={..._t,...n},!0}catch(e){return console.error(`[EditorConfig Store] å¯¼å…¥é…ç½®å¤±è´¥:`,e),!1}}return C(e,e=>{t!==null&&clearTimeout(t),t=window.setTimeout(()=>{xt(e),t=null},500)},{deep:!0,flush:`post`}),{config:e,updateConfig:n,resetConfig:r,exportConfig:i,importConfig:a}});var Ct=`workflows`,wt=`current-workflow-id`,Tt=`global-variables`,Et=2,Dt=`v2`;function Ot(e){return`${e}-${Math.random().toString(36).slice(2,8)}-${Date.now()}`}async function kt(){try{return await Q().cache.read(wt,{namespace:Dt})??null}catch(e){return console.error(`åŠ è½½å½“å‰å·¥ä½œæµ ID å¤±è´¥:`,e),null}}async function At(e){try{let t=Q();e?await t.cache.save(wt,e,{namespace:Dt}):await t.cache.remove(wt,{namespace:Dt})}catch(e){console.error(`ä¿å­˜å½“å‰å·¥ä½œæµ ID å¤±è´¥:`,e)}}async function jt(){try{let e=await Q().cache.read(Tt,{namespace:Dt});return Array.isArray(e)?e:[]}catch(e){return console.error(`åŠ è½½å…¨å±€å˜é‡å¤±è´¥:`,e),[]}}async function Mt(e){try{await Q().cache.save(Tt,e,{namespace:Dt})}catch(e){console.error(`ä¿å­˜å…¨å±€å˜é‡å¤±è´¥:`,e)}}function Nt(){let e=Date.now(),t={id:Ot(`folder`),name:`æˆ‘çš„å·¥ä½œæµ`,parentId:null,order:0,createdAt:e,updatedAt:e},n={workflow_id:`workflow-1`,name:`åŸºç¡€æµç¨‹`,description:`åŸºç¡€æµç¨‹ç¤ºä¾‹`,folderId:t.id,order:0,nodes:[],edges:[],createdAt:e,updatedAt:e};return{version:Et,workflows:[n],folders:[t]}}function Pt(e){let t=Date.now(),n=[],r=new Map,i=new Map,a=e=>{let t=i.get(e)??0;return i.set(e,t+1),t},o=e=>{if(!e)return null;if(r.has(e))return r.get(e)||null;let i=e.split(`/`).filter(Boolean),o=null,s=``;for(let e of i){if(s=s?`${s}/${e}`:e,r.has(s)){o=r.get(s)||null;continue}let i={id:Ot(`folder`),name:e,parentId:o,order:a(o),createdAt:t,updatedAt:t};n.push(i),r.set(s,i.id),o=i.id}return r.get(e)??null},s=e.map((e,n)=>{let r=o(e.path);return{...e,folderId:r,order:n,createdAt:e.createdAt??t,updatedAt:e.updatedAt??t}});if(n.length===0){let e=Nt();return{version:Et,workflows:e.workflows,folders:e.folders}}return{version:Et,workflows:s,folders:n}}async function Ft(){try{let e=await Q().cache.read(Ct,{namespace:Dt});if(!e)return Nt();if(Array.isArray(e))return Pt(e);if(!e.version||e.version<Et){let t=e.workflows;return t&&Array.isArray(t)?Pt(t):Nt()}return e}catch(e){return console.error(`åŠ è½½å·¥ä½œæµå¤±è´¥:`,e),Nt()}}async function It(e){try{await Q().cache.save(Ct,e,{namespace:Dt})}catch(e){console.error(`ä¿å­˜å·¥ä½œæµå¤±è´¥:`,e)}}function Lt(e,t,n){if(!t)return``;if(n.has(t))return n.get(t)||``;let r=e.find(e=>e.id===t);if(!r)return``;let i=Lt(e,r.parentId,n),a=i?`${i}/${r.name}`:r.name;return n.set(t,a),a}function Rt(e){let t=[],n=new Map,r=i=>{let a=e.filter(e=>e.parentId===i).sort((e,t)=>e.order-t.order);for(let i of a){let a=Lt(e,i.id,n);a&&t.push(a),r(i.id)}};return r(null),t}function zt(e,t){return t.type===`folder`?e.kind===`folder`&&e.data.id===t.folderId:e.kind===`workflow`&&e.data.workflow_id===t.workflowId}function Bt(e,t){let n=new Map,r=i=>{let a=e.filter(e=>e.parentId===i).map(t=>{let i=r(t.id),a={type:`folder`,folderId:t.id,parentFolderId:t.parentId,order:t.order,path:Lt(e,t.id,n)};return{key:`folder-${t.id}`,label:t.name,isLeaf:!1,children:i,meta:a}}),o=t.filter(e=>e.folderId===i).map(t=>{let r={type:`workflow`,workflowId:t.workflow_id,parentFolderId:t.folderId,order:t.order,path:Lt(e,t.folderId,n),createdAt:t.createdAt,updatedAt:t.updatedAt,nodeCount:t.nodes.length,description:t.description};return{key:t.workflow_id,label:t.name||`æœªå‘½åå·¥ä½œæµ`,isLeaf:!0,meta:r}}),s=[...a,...o];return s.sort((e,t)=>{let n=e.meta,r=t.meta,i=n?.order??0,a=r?.order??0;return i-a}),s};return r(null)}const Vt=x(`workflow`,()=>{let e=Nt(),t=S(e.workflows),n=S(e.folders),r=S(null),i=S([]);(async()=>{let e=await Ft();t.value=e.workflows,n.value=e.folders,r.value=await kt(),i.value=await jt()})();let a=null,o=O(()=>r.value&&t.value.find(e=>e.workflow_id===r.value)||null),s=O(()=>t.value.length),c=O(()=>Bt(n.value,t.value)),l=O(()=>Rt(n.value));async function u(){await It({version:Et,workflows:t.value,folders:n.value})}C([t,n],()=>{a!==null&&clearTimeout(a),a=window.setTimeout(()=>{u(),a=null},500)},{deep:!0,flush:`post`}),C(r,e=>{At(e)}),C(i,()=>{Mt(i.value)},{deep:!0});function d(e){if(e)return n.value.find(t=>t.id===e)}function f(e){return t.value.find(t=>t.workflow_id===e)}function p(e){return Lt(n.value,e,new Map)}function m(e){let r=n.value.filter(t=>t.parentId===e).map(e=>({kind:`folder`,data:e})),i=t.value.filter(t=>t.folderId===e).map(e=>({kind:`workflow`,data:e})),a=[...r,...i];return a.sort((e,t)=>{let n=(e.kind,e.data.order),r=(t.kind,t.data.order);return n-r}),a}function h(e){e.forEach((e,t)=>{e.kind,e.data.order=t,e.data.updatedAt=Date.now()})}function g(e){let t=e.split(`/`).map(e=>e.trim()).filter(Boolean);if(t.length===0)return null;let r=null;for(let e of t){let t=n.value.find(t=>t.parentId===r&&t.name===e);if(!t){let i=Date.now(),a=m(r).length;t={id:Ot(`folder`),name:e,parentId:r,order:a,createdAt:i,updatedAt:i},n.value.push(t)}r=t.id}return r}function _(e,n=`æˆ‘çš„å·¥ä½œæµ`,r){let i=Date.now(),a=n?g(n):null,o=m(a).length,s={workflow_id:Ot(`workflow`),name:e,description:r,folderId:a,order:o,nodes:[],edges:[],createdAt:i,updatedAt:i};return t.value.push(s),s}function v(e){let n=t.value.findIndex(t=>t.workflow_id===e);if(n===-1)return;let i=t.value[n],a=m(i.folderId).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));h(a),t.value.splice(n,1),r.value===e&&(r.value=null)}function y(e,t){let n=f(e);n&&Object.assign(n,t,{updatedAt:Date.now()})}function b(e){r.value=e}function x(e){return f(e)}function w(e,t){y(e,{name:t})}function T(e,t){let n=f(e);if(!n)return;let r=t?g(t):null,i=m(r).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));if(n.folderId!==r){let t=m(n.folderId).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));h(t)}i.push({kind:`workflow`,data:n}),h(i),n.folderId=r,n.updatedAt=Date.now()}function E(e){let n=f(e);if(!n)return null;let r=Date.now(),i=m(n.folderId).length,a={...JSON.parse(JSON.stringify(n)),workflow_id:Ot(`workflow`),name:`${n.name} (å‰¯æœ¬)`,order:i,createdAt:r,updatedAt:r};return t.value.push(a),a}function D(){t.value=[],n.value=[],r.value=null}function k(){let e=Nt();t.value=e.workflows,n.value=e.folders,r.value=null}function A(e){let t=f(e);return t?JSON.stringify(t,null,2):null}function j(e){try{let n=JSON.parse(e),r=Date.now(),i=m(null).length,a={...n,workflow_id:Ot(`workflow`),folderId:null,order:i,createdAt:r,updatedAt:r};return t.value.push(a),a}catch(e){return console.error(`å¯¼å…¥å·¥ä½œæµå¤±è´¥:`,e),null}}function M(e,t=``){let r=e.trim(),i=t.trim(),a=i?g(i):null,o=n.value.find(e=>e.parentId===a&&e.name===r);if(o)return o;let s=Date.now(),c=m(a).length,l={id:Ot(`folder`),name:r,parentId:a,order:c,createdAt:s,updatedAt:s};return n.value.push(l),l}function N(e,i=!1){let a=d(e);if(!a)return{success:!1,message:`æ–‡ä»¶å¤¹ä¸å­˜åœ¨`};let o=m(e);if(o.length>0&&!i)return{success:!1,message:`æ–‡ä»¶å¤¹ä¸ä¸ºç©ºï¼ŒåŒ…å« ${o.length} ä¸ªé¡¹ç›®`};let s=0,c=0;if(i){let i=e=>{let a=m(e);for(let e of a)if(e.kind===`folder`){i(e.data.id);let t=n.value.findIndex(t=>t.id===e.data.id);t>-1&&(n.value.splice(t,1),s++)}else{let n=t.value.findIndex(t=>t.workflow_id===e.data.workflow_id);n>-1&&(t.value.splice(n,1),c++,r.value===e.data.workflow_id&&(r.value=null))}};i(e)}let l=n.value.findIndex(t=>t.id===e);l>-1&&(n.value.splice(l,1),s++);let u=m(a.parentId).filter(t=>!(t.kind===`folder`&&t.data.id===e));return h(u),{success:!0,message:i?`å·²åˆ é™¤æ–‡ä»¶å¤¹åŠå…¶å†…å®¹`:`æ–‡ä»¶å¤¹å·²åˆ é™¤`,deletedCount:{folders:s,workflows:c}}}function P(e,t){let n=e;for(;n;){if(n===t)return!0;n=d(n)?.parentId??null}return!1}function ee(e,t){return t===`inside`?e.type===`folder`?e.folderId:e.parentFolderId:(e.type,e.parentFolderId)}function F(e,t,n){if(n===`inside`)return e.length;let r=e.findIndex(e=>zt(e,t));return r===-1?e.length:n===`before`?r:r+1}function I(e){let{dragMeta:t,targetMeta:n,dropPosition:r}=e;if(t.type===`workflow`&&n.type===`workflow`&&t.workflowId===n.workflowId||t.type===`folder`&&n.type===`folder`&&t.folderId===n.folderId)return;let i=ee(n,r);if(t.type===`workflow`){let e=f(t.workflowId);if(!e)return;let a=e.folderId,o=m(i).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e.workflow_id));if(a!==i){let t=m(a).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e.workflow_id));h(t),e.folderId=i}let s=F(o,n,r);o.splice(s,0,{kind:`workflow`,data:e}),h(o),e.updatedAt=Date.now();return}let a=d(t.type===`folder`?t.folderId:null);if(!a||i===a.id||P(i,a.id))return;let o=a.parentId,s=m(i).filter(e=>!(e.kind===`folder`&&e.data.id===a.id));if(o!==i){let e=m(o).filter(e=>!(e.kind===`folder`&&e.data.id===a.id));h(e),a.parentId=i}let c=F(s,n,r);s.splice(c,0,{kind:`folder`,data:a}),h(s),a.updatedAt=Date.now()}function L(e){i.value.push(e)}function R(e,t){let n=i.value.find(t=>t.key===e);n&&Object.assign(n,t)}function z(e){let t=i.value.findIndex(t=>t.key===e);t>-1&&i.value.splice(t,1)}function B(e){return i.value.find(t=>t.key===e)}function V(e){i.value=e}function H(){return i.value.reduce((e,t)=>(e[t.key]=t.value,e),{})}return{workflows:t,folders:n,currentWorkflowId:r,currentWorkflow:o,workflowCount:s,treeData:c,folderPathList:l,createWorkflow:_,deleteWorkflow:v,updateWorkflow:y,setCurrentWorkflow:b,getWorkflowById:x,renameWorkflow:w,moveWorkflow:T,duplicateWorkflow:E,clearAllWorkflows:D,resetToDefaults:k,exportWorkflow:A,importWorkflow:j,createFolder:M,deleteFolder:N,ensureFolderPath:g,handleTreeDrop:I,buildFolderPath:p,globalVariables:i,addGlobalVariable:L,updateGlobalVariable:R,deleteGlobalVariable:z,getGlobalVariable:B,setGlobalVariables:V,getGlobalVariableJson:H}});function Ht(){let e=S(`idle`),t=S(0),n=S(null),r=S(null),i=S(new Map),a=S(null),o=S(null),s=S(null),c=O(()=>e.value===`running`),l=O(()=>e.value===`paused`),u=O(()=>e.value===`completed`),d=O(()=>e.value===`error`),f=O(()=>o.value?(s.value||Date.now())-o.value:null);function p(t){e.value=t}function m(e){t.value=Math.max(0,Math.min(1,e))}function h(a,c){n.value=a,r.value=c,e.value=`running`,t.value=0,o.value=Date.now(),s.value=null,i.value.clear()}function g(n){a.value=n,e.value=n.success?`completed`:`error`,t.value=1,s.value=Date.now(),n.nodeResults&&(n.nodeResults instanceof Map?i.value=new Map(n.nodeResults):typeof n.nodeResults==`object`&&(i.value=new Map(Object.entries(n.nodeResults))))}function _(e,t){let n={...i.value.get(e)||{nodeId:e,status:`pending`},...t};i.value.set(e,n),i.value=new Map(i.value)}function v(){e.value=`idle`,t.value=0,n.value=null,r.value=null,i.value.clear(),a.value=null,o.value=null,s.value=null}return{state:e,progress:t,executionId:n,workflowId:r,nodeStates:i,lastResult:a,isExecuting:c,isPaused:l,isCompleted:u,hasError:d,startTime:o,endTime:s,duration:f,setState:p,setProgress:m,startExecution:h,completeExecution:g,updateNodeState:_,reset:v}}var Ut=class{constructor(e){this.ws=null,this.reconnectAttempts=0,this.reconnectTimer=null,this.messageHandlers=new Map,this.loggerPrefix=`[WSClient]`,this.initialized=!1,this.pendingCommands=[],this.config={url:e.url,autoReconnect:e.autoReconnect??!0,reconnectInterval:e.reconnectInterval??3e3,maxReconnectAttempts:e.maxReconnectAttempts??5,enableLogging:e.enableLogging??!0}}async connect(){return new Promise((e,t)=>{try{this.log(`æ­£åœ¨è¿žæŽ¥åˆ°æœåŠ¡å™¨:`,this.config.url),this.ws=new WebSocket(this.config.url),this.ws.onopen=()=>{this.log(`å·²è¿žæŽ¥åˆ°æœåŠ¡å™¨`),this.reconnectAttempts=0,this.sendCommand({type:`INIT`}),this.flushPendingCommands(),e()},this.ws.onmessage=e=>{this.handleMessage(e.data)},this.ws.onerror=e=>{this.error(`WebSocket é”™è¯¯:`,e),t(e)},this.ws.onclose=()=>{this.log(`è¿žæŽ¥å·²å…³é—­`),this.initialized=!1,this.config.autoReconnect&&this.attemptReconnect()}}catch(e){t(e)}})}attemptReconnect(){if(this.reconnectAttempts>=this.config.maxReconnectAttempts){this.error(`å·²è¾¾åˆ°æœ€å¤§é‡è¿žæ¬¡æ•°`);return}this.reconnectAttempts++,this.log(`å°è¯•é‡è¿ž (${this.reconnectAttempts}/${this.config.maxReconnectAttempts})`),this.reconnectTimer=window.setTimeout(()=>{this.connect().catch(()=>{})},this.config.reconnectInterval)}disconnect(){this.reconnectTimer&&=(clearTimeout(this.reconnectTimer),null),this.ws&&=(this.ws.close(),null)}sendCommand(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){this.pendingCommands.push(e);return}this.ws.send(JSON.stringify(e))}flushPendingCommands(){for(;this.pendingCommands.length>0;){let e=this.pendingCommands.shift();e&&this.sendCommand(e)}}handleMessage(e){try{let t=JSON.parse(e),n=this.messageHandlers.get(t.type);n&&n(t.payload),t.type===`INITIALIZED`&&(this.initialized=!0,this.log(`æœåŠ¡ç«¯æ‰§è¡Œå™¨å·²åˆå§‹åŒ–`))}catch(e){this.error(`è§£æžæ¶ˆæ¯å¤±è´¥:`,e)}}on(e,t){this.messageHandlers.set(e,t)}off(e){this.messageHandlers.delete(e)}execute(e,t){this.sendCommand({type:`EXECUTE`,payload:{workflow:e,options:t}})}pause(){this.sendCommand({type:`PAUSE`})}resume(){this.sendCommand({type:`RESUME`})}stop(){this.sendCommand({type:`STOP`})}getCacheStats(e,t){this.sendCommand({type:`GET_CACHE_STATS`,payload:{workflowId:e,requestId:t}})}clearCache(e){this.sendCommand({type:`CLEAR_CACHE`,payload:{workflowId:e}})}clearAllCache(){this.sendCommand({type:`CLEAR_ALL_CACHE`})}getNodeList(e){this.sendCommand({type:`GET_NODE_LIST`,payload:{requestId:e}})}getHistory(e,t,n){this.sendCommand({type:`GET_HISTORY`,payload:{requestId:e,workflowId:t,limit:n}})}clearHistory(e){this.sendCommand({type:`CLEAR_HISTORY`,payload:{workflowId:e}})}deleteHistory(e){this.sendCommand({type:`DELETE_HISTORY`,payload:{executionId:e}})}isInitialized(){return this.initialized}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}log(...e){this.config.enableLogging&&console.log(this.loggerPrefix,...e)}error(...e){this.config.enableLogging&&console.error(this.loggerPrefix,...e)}},Wt={mode:`worker`,serverUrl:`ws://localhost:3001`,timeout:6e4,useCache:!0,autoReconnect:!0},Gt=5e3;function Kt(e){let t=null,n=new Set,r=e=>{n.forEach(t=>t(e))};return{async init(){t||(t=e?new Worker(e,{type:`module`}):new Worker(new URL(``+new URL(`worker-C_GAzZvX.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),t.onmessage=e=>{r(e.data)},t.onerror=e=>{console.error(`[VueFlowExecution][Worker] é”™è¯¯:`,e.message)})},terminate(){t&&=(t.terminate(),null)},send(e){if(!t)throw Error(`æ‰§è¡Œé€šé“æœªåˆå§‹åŒ–`);t.postMessage(e)},onMessage(e){n.add(e)},offMessage(e){n.delete(e)}}}function qt(t){let n={...Wt,...t},r=St(),{config:i}=V(r),a=O(()=>i.value.executionMode),o=S(!1),s=Ht(),c=null,l=null,u=null,d=new Map,f=new Map,p=new Map,m=new Map;async function h(){if(c&&o.value)return c;if(c&&te(),a.value===`worker`){let e=Kt(n.workerUrl);l=U,e.onMessage(U),await e.init(),e.send({type:`INIT`}),c=e,o.value=!0,console.log(`[VueFlowExecution] Worker é€šé“å·²å‡†å¤‡`)}else if(a.value===`server`){let e=i.value.serverUrl;e.startsWith(`http://`)?e=e.replace(`http://`,`ws://`):e.startsWith(`https://`)?e=e.replace(`https://`,`wss://`):!e.startsWith(`ws://`)&&!e.startsWith(`wss://`)&&(e=`ws://`+e);let t=new Ut({url:e,autoReconnect:!0,enableLogging:!0});await t.connect();let n={init:async()=>Promise.resolve(),send:e=>{switch(e.type){case`EXECUTE`:t.execute(e.payload.workflow,e.payload.options);break;case`PAUSE`:t.pause();break;case`RESUME`:t.resume();break;case`STOP`:t.stop();break;case`GET_CACHE_STATS`:t.getCacheStats(e.payload.workflowId,e.payload.requestId);break;case`CLEAR_CACHE`:t.clearCache(e.payload.workflowId);break;case`CLEAR_ALL_CACHE`:t.clearAllCache();break;case`GET_NODE_LIST`:t.getNodeList(e.payload.requestId);break;case`GET_HISTORY`:t.getHistory(e.payload.requestId,e.payload.workflowId,e.payload.limit);break;case`CLEAR_HISTORY`:t.clearHistory(e.payload.workflowId);break;case`DELETE_HISTORY`:t.deleteHistory(e.payload.executionId);break;default:console.warn(`[VueFlowExecution] æœªçŸ¥çš„å‘½ä»¤ç±»åž‹:`,e)}},onMessage:e=>{[`INITIALIZED`,`EXECUTION_START`,`EXECUTION_COMPLETE`,`EXECUTION_ERROR`,`NODE_START`,`NODE_COMPLETE`,`NODE_ERROR`,`PROGRESS`,`CACHE_HIT`,`ITERATION_UPDATE`,`STATE_CHANGE`,`CACHE_STATS`,`NODE_LIST`,`HISTORY_DATA`,`ERROR`].forEach(n=>{t.on(n,t=>{e({type:n,payload:t})})})},offMessage:()=>{},terminate:()=>{t.disconnect()}};c=n,l=U,n.onMessage(U),o.value=!0,console.log(`[VueFlowExecution] WebSocket é€šé“å·²å‡†å¤‡`)}else throw Error(`ä¸æ”¯æŒçš„æ‰§è¡Œæ¨¡å¼: ${a.value}`);return c}async function g(e,t){return await h(),u?Promise.reject(Error(`å·²æœ‰æ‰§è¡Œä»»åŠ¡æ­£åœ¨ç­‰å¾…å¼€å§‹`)):new Promise((n,r)=>{u={resolve:n,reject:r},c.send({type:`EXECUTE`,payload:{workflow:e,options:t}})})}function _(){c?.send({type:`PAUSE`})}function v(){c?.send({type:`RESUME`})}function y(){c?.send({type:`STOP`})}async function b(e){await h();let t=G();return new Promise((n,r)=>{let i=setTimeout(()=>{f.delete(t),r(Error(`èŽ·å–ç¼“å­˜ç»Ÿè®¡è¶…æ—¶`))},Gt);f.set(t,{resolve:n,reject:r,timer:i}),c.send({type:`GET_CACHE_STATS`,payload:{workflowId:e,requestId:t}})})}async function x(e){await h(),c.send({type:`CLEAR_CACHE`,payload:{workflowId:e}})}async function C(){await h(),c.send({type:`CLEAR_ALL_CACHE`})}async function w(){await h();let e=G();return new Promise((t,n)=>{let r=setTimeout(()=>{p.delete(e),n(Error(`èŽ·å–èŠ‚ç‚¹åˆ—è¡¨è¶…æ—¶`))},Gt);p.set(e,{resolve:t,reject:n,timer:r}),c.send({type:`GET_NODE_LIST`,payload:{requestId:e}})})}async function T(e,t){await h();let n=G();return new Promise((r,i)=>{let a=setTimeout(()=>{m.delete(n),i(Error(`èŽ·å–åŽ†å²è®°å½•è¶…æ—¶`))},Gt);m.set(n,{resolve:r,reject:i,timer:a}),c.send({type:`GET_HISTORY`,payload:{requestId:n,workflowId:e,limit:t}})})}async function E(e){await h(),c.send({type:`CLEAR_HISTORY`,payload:{workflowId:e}})}async function D(e){await h(),c.send({type:`DELETE_HISTORY`,payload:{executionId:e}})}async function k(e){console.warn(`[VueFlowExecution] switchMode å·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨é…ç½®é¢æ¿åˆ‡æ¢æ‰§è¡Œæ¨¡å¼`),e!==a.value&&(te(),r.updateConfig({executionMode:e}),await h(),console.log(`[VueFlowExecution] å·²åˆ‡æ¢åˆ° ${e} æ¨¡å¼`))}function A(e){s.startExecution(e.executionId,e.workflowId),W.emit(`execution:start`,e),W.emit(`workflow:execution-started`,{workflowId:e.workflowId}),u&&=(d.set(e.executionId,u),null)}function j(e){s.completeExecution(e),W.emit(`execution:complete`,e),W.emit(`workflow:execution-completed`,{workflowId:e.workflowId,success:e.success});let t=d.get(e.executionId);t&&(t.resolve(e),d.delete(e.executionId))}function M(e){s.setState(`error`),W.emit(`execution:error`,e);let t=d.get(e.executionId);if(t){t.reject(Error(e.error)),d.delete(e.executionId);return}u&&=(u.reject(Error(e.error)),null)}function N(e){s.updateNodeState(e.nodeId,{status:`running`,startTime:Date.now()}),W.emit(`execution:node:start`,e)}function P(e){s.updateNodeState(e.nodeId,{status:`success`,outputs:e.result,endTime:Date.now()}),W.emit(`execution:node:complete`,e)}function ee(e){s.updateNodeState(e.nodeId,{status:`error`,error:e.error,endTime:Date.now()}),W.emit(`execution:node:error`,e)}function F(e){s.setProgress(e.progress),W.emit(`execution:progress`,e)}function I(e){s.updateNodeState(e.nodeId,{status:`cached`,outputs:e.cachedResult.outputs,fromCache:!0}),W.emit(`execution:cache-hit`,e)}function L(e){W.emit(`execution:iteration:update`,e)}function R(e){s.setState(e.state),W.emit(`execution:state`,e)}function z(e,t){let n=f.get(e);n&&(clearTimeout(n.timer),n.resolve(t),f.delete(e))}function B(e,t){let n=p.get(e);n&&(clearTimeout(n.timer),n.resolve(t),p.delete(e))}function H(e,t){let n=m.get(e);n&&(clearTimeout(n.timer),n.resolve(t),m.delete(e))}function U(e){switch(e.type){case`INITIALIZED`:console.log(`[VueFlowExecution] Worker åˆå§‹åŒ–å®Œæˆ`);break;case`EXECUTION_START`:A(e.payload);break;case`EXECUTION_COMPLETE`:j(e.payload);break;case`EXECUTION_ERROR`:M(e.payload);break;case`NODE_START`:N(e.payload);break;case`NODE_COMPLETE`:P(e.payload);break;case`NODE_ERROR`:ee(e.payload);break;case`PROGRESS`:F(e.payload);break;case`CACHE_HIT`:I(e.payload);break;case`ITERATION_UPDATE`:L(e.payload);break;case`CACHE_STATS`:z(e.payload.requestId,e.payload.stats);break;case`NODE_LIST`:B(e.payload.requestId,e.payload.nodes);break;case`HISTORY_DATA`:H(e.payload.requestId,e.payload.history);break;case`STATE_CHANGE`:R(e.payload);break;case`ERROR`:console.error(`[VueFlowExecution] é€šé“é”™è¯¯:`,e.payload);break;default:console.warn(`[VueFlowExecution] æœªçŸ¥çš„é€šé“æ¶ˆæ¯:`,e)}}function te(){c&&(l&&c.offMessage(l),c.terminate(),c=null,l=null),u&&=(u.reject(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`)),null),d.forEach(({reject:e})=>e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))),d.clear(),f.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),f.clear(),p.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),p.clear(),m.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),m.clear(),o.value=!1}e(()=>{te()});function G(){return`req_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}return{mode:a,state:s,execute:g,pause:_,resume:v,stop:y,getCacheStats:b,clearCache:x,clearAllCache:C,switchMode:k,getNodeList:w,getHistory:T,clearHistory:E,deleteHistory:D,isInitialized:o,ensureChannel:h,cleanupChannel:te}}const Jt=x(`newCanvas`,()=>{let e=Vt(),t=E(qt()),n=S(!1),r=S([]),i=S(0),a=S([]),o=S(!1),s=S(null),c=S(new Map),l=S(null),u=O(()=>e.currentWorkflow?.nodes||[]),d=O(()=>e.currentWorkflow?.edges||[]),f=O(()=>u.value.length),p=O(()=>d.value.length),m=O(()=>e.currentWorkflowId),h=O(()=>e.currentWorkflow?.name||`æœªå‘½åå·¥ä½œæµ`),g=0,_=performance.now(),v=null;function y(){g++;let e=performance.now(),t=e-_;t>=1e3&&(i.value=Math.round(g*1e3/t),g=0,_=e),v=requestAnimationFrame(y)}y();function b(e){n.value=e}function x(e){let t=new Date().toLocaleTimeString();r.value=[{...e,timestamp:t},...r.value].slice(0,10)}function C(){r.value=[]}function w(e){return u.value.find(t=>t.id===e)}function T(t){if(!e.currentWorkflow){console.warn(`æ²¡æœ‰æ´»åŠ¨çš„å·¥ä½œæµï¼Œæ— æ³•æ·»åŠ èŠ‚ç‚¹`);return}e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:[...u.value,t]})}function D(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:u.value.filter(e=>e.id!==t),edges:d.value.filter(e=>e.source!==t&&e.target!==t)})}function k(t,n){if(!e.currentWorkflow)return;let r=u.value.map(e=>e.id===t?{...e,...n}:e);e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:r})}function A(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:t})}function j(t){if(!e.currentWorkflow){console.warn(`æ²¡æœ‰æ´»åŠ¨çš„å·¥ä½œæµï¼Œæ— æ³•æ·»åŠ è¿žçº¿`);return}e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:[...d.value,t]})}function M(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:d.value.filter(e=>e.id!==t)})}function N(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:t})}function P(t){e.setCurrentWorkflow(t),C()}function ee(){e.currentWorkflow&&(e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:[],edges:[]}),C())}function F(){v!==null&&(cancelAnimationFrame(v),v=null)}function I(e,t){let n=w(e);if(!n)return;let r=n.data?.iterationHistory||{iterations:[],totalIterations:0,currentPage:1};r.iterations.push(t),r.totalIterations=r.iterations.length,k(e,{data:{...n.data,iterationHistory:r}})}function L(e,t){let n=w(e);if(!n?.data?.iterationHistory)return;let r=n.data.iterationHistory;r.currentPage=Math.max(1,Math.min(t,r.totalIterations)),k(e,{data:{...n.data,iterationHistory:r}})}function R(e){let t=w(e);t&&k(e,{data:{...t.data,iterationHistory:void 0}})}async function z(e=!1){if(!o.value&&!(!e&&a.value.length>0)){o.value=!0;try{a.value=await t.getNodeList(),s.value=Date.now()}catch(e){console.error(`[Canvas] åŠ è½½èŠ‚ç‚¹åˆ—è¡¨å¤±è´¥:`,e),a.value=[]}finally{o.value=!1}}}function B(e){return c.value.get(e)}function V(e,t){let n=c.value.get(e),r={nodeId:e,status:`pending`,...n,...t};r.duration===void 0&&r.startTime&&r.endTime&&(r.duration=r.endTime-r.startTime),c.value.set(e,r),c.value=new Map(c.value)}function H(){c.value.clear(),l.value=null}function U(n,r){if(console.log(`[Canvas] åŠ è½½æ‰§è¡ŒçŠ¶æ€:`,n),H(),l.value=n.executionId,t.state.completeExecution(n),r?.nodes&&r?.edges&&(console.log(`[Canvas] æ¢å¤å·¥ä½œæµç»“æž„:`,{nodes:r.nodes.length,edges:r.edges.length}),e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:r.nodes,edges:r.edges})),n.nodeResults){let e=n.nodeResults instanceof Map?n.nodeResults:new Map(Object.entries(n.nodeResults));for(let[t,n]of e.entries())if(n&&typeof n==`object`){let e=n,r=e.status||`success`;r===`success`||r===`completed`?V(t,{status:`success`,result:e.outputs||n,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()}):r===`error`||r===`failed`?V(t,{status:`error`,error:e.error||`æ‰§è¡Œå¤±è´¥`,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()}):r===`cached`&&V(t,{status:`cached`,result:e.outputs||n,duration:e.duration||0,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()})}}console.log(`[Canvas] å·²åŠ è½½æ‰§è¡ŒçŠ¶æ€ï¼ŒèŠ‚ç‚¹æ•°é‡:`,c.value.size)}return{nodes:u,edges:d,nodeCount:f,edgeCount:p,currentWorkflowId:m,currentWorkflowName:h,isExecuting:n,lastNodeResults:r,fps:i,setExecuting:b,pushNodeResult:x,clearResults:C,getNodeById:w,addNode:T,removeNode:D,updateNode:k,updateNodes:A,addEdge:j,removeEdge:M,updateEdges:N,loadWorkflowById:P,clearCanvas:ee,appendNodeIterationHistory:I,setNodeIterationPage:L,clearNodeIterationHistory:R,availableNodes:a,isLoadingNodeList:o,nodeListLoadedAt:s,loadNodeList:z,nodeExecutionStatuses:c,currentExecutionId:l,getNodeExecutionStatus:B,setNodeExecutionStatus:V,clearNodeExecutionStatuses:H,loadExecutionStatus:U,vueFlowExecution:t,stopFPSCalculation:F}});var $=class{getStyleConfig(){return{}}getInputs(){return this.defineInputs()}getOutputs(){return this.defineOutputs()}getStyle(){return this.getStyleConfig()}getInput(e,t,n){if(e&&Object.prototype.hasOwnProperty.call(e,t))return e[t];let r=this.defineInputs().find(e=>e.name===t);return r&&r.defaultValue!==void 0?r.defaultValue:n}createOutput(e,t,n){let r=this.defineOutputs();if(r.length===1&&!this.isPlainObject(e)){let[i]=r;return{outputs:{[i.name]:e},raw:t??e,summary:n,success:!0}}return{outputs:this.isPlainObject(e)?e:{},raw:t??e,summary:n,success:!0}}createError(e){return{success:!1,error:e instanceof Error?e.message:e,outputs:{}}}validateInputs(e){let t=[],n=this.defineInputs();for(let r of n)if(r.required){let n=e[r.name];(n==null||n===``)&&t.push(`"${r.name}" æ˜¯å¿…å¡«é¡¹`)}return{valid:t.length===0,errors:t}}getMetadata(){return{type:this.type,label:this.label,description:this.description,category:this.category,inputs:this.defineInputs(),outputs:this.defineOutputs(),style:this.getStyleConfig()}}shouldUseCache(e,t){return!0}getCacheableInputs(e){return e}computeConfigHash(e,t={}){let n=this.getCacheableInputs(e),r={type:this.type,inputs:n};return this.hashObject(r)}hashObject(e){let t=this.stableStringify(e),n=5381;for(let e=0;e<t.length;e++)n=n*33^t.charCodeAt(e);return(n>>>0).toString(16)}stableStringify(e){return e==null?String(e):typeof e==`object`?Array.isArray(e)?`[`+e.map(e=>this.stableStringify(e)).join(`,`)+`]`:`{`+Object.keys(e).sort().map(t=>JSON.stringify(t)+`:`+this.stableStringify(e[t])).join(`,`)+`}`:JSON.stringify(e)}isPlainObject(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}},Yt=class{extractOutputs(e){let t=e.data;if(!t)return null;if(t.executionResult)return typeof t.executionResult==`object`&&!Array.isArray(t.executionResult)?t.executionResult:{default:t.executionResult};if(t.result?.data?.outputs){let e=t.result.data.outputs,n={};return Object.entries(e).forEach(([e,t])=>{t&&typeof t==`object`&&`value`in t?n[e]=t.value:n[e]=t}),n}return t.result?.data?.raw===void 0?null:{default:t.result.data.raw}}};function Xt(e,t,n){let r=new Set,i=[],a=new Map(n.map(e=>[e.id,e])),o=e=>{let n=t.filter(t=>t.target===e);for(let e of n){if(!e.source||r.has(e.source))continue;let t=a.get(e.source);if(!t)continue;let n=t.data?.config?.forNodeId;if(n){if(!a.get(n))continue;r.add(n),i.push(n),o(n);continue}r.add(e.source),i.push(e.source),o(e.source)}};return o(e),i}function Zt(e,t,n){return e==null?[]:Array.isArray(e)?e.map((e,r)=>{let i=`${t}[${r}]`;n.set(i,e);let a=e!=null&&(Array.isArray(e)||typeof e==`object`);return{id:i,label:`[${r}]`,valueType:$t(e),reference:en(i),value:e,children:a?Zt(e,i,n):[]}}):typeof e==`object`?Object.entries(e).filter(([e])=>e!==`type`).map(([e,r])=>{let i=`${t}.${e}`;n.set(i,r);let a=r!=null&&(Array.isArray(r)||typeof r==`object`);return{id:i,label:e,valueType:$t(r),reference:en(i),value:r,children:a?Zt(r,i,n):[]}}):[]}function Qt(e,t,n,r){if(t==null)return[];let i=n&&e?`${n}.${e}`:n||e;if(Array.isArray(t))return t.map((e,t)=>{let n=`${i}[${t}]`;r.set(n,e);let a=e!=null&&(Array.isArray(e)||typeof e==`object`);return{id:n,label:`[${t}]`,valueType:$t(e),reference:en(n),value:e,children:a?Zt(e,n,r):[]}});if(typeof t==`object`){let a=Object.entries(t).filter(([e])=>e!==`type`),o=(e,t)=>e.map(([e,n])=>{let i=`${t}.${e}`;r.set(i,n);let a=n!=null&&(Array.isArray(n)||typeof n==`object`);return{id:i,label:e,valueType:$t(n),reference:en(i),value:n,children:a?Zt(n,i,r):[]}});if(!e)return o(a,i);r.set(i,t);let s=o(a,i);return[{id:i,label:e,valueType:`object`,reference:en(i),value:t,children:s,nodeId:n,outputId:e}]}return r.set(i,t),[{id:i,label:e,valueType:$t(t),reference:en(i),value:t,children:[],nodeId:n,outputId:e}]}function $t(e){return e===null?`null`:e===void 0?`undefined`:Array.isArray(e)?`array`:typeof e}function en(e){return`{{ ${e} }}`}function tn(e,t,n,r,i,a){let o=new Map(t.map(e=>[e.id,e])),s=new Map,c=[],l=o.get(e),u=l?.parentNode||l?.data?.parentNode,d=Xt(e,n,t).reverse(),f=null;if(u){let e=o.get(u);if(e?.type===`forLoopContainer`&&(f=e.data?.config?.forNodeId,!f)){for(let e of t)if(e.type===`for`&&e.data?.config?.containerId===u){f=e.id;break}}}let p=r||new Yt;if(i&&Object.keys(i).length>0){let e=`å…¨å±€å˜é‡`,t={id:`global-variables`,label:`å…¨å±€å˜é‡`,valueType:`object`,reference:e,value:{},children:[]};Object.entries(i).forEach(([n,r])=>{s.set(`${e}.${n}`,r);let i=Qt(n,r,e,s);t.children?.push(...i)}),c.push(t)}return d.forEach(e=>{let t=o.get(e);if(!t)return;let n=t.label||t.data?.label||e,r=t.type,i=p.extractOutputs(t);if(r===`for`){let r=t.data?.config||{},i=r.containerId;if(u&&i&&u===i&&f===e){let i={id:e,label:n,valueType:`node`,value:null,children:[],nodeId:e},o=r.itemName||`item`,l=r.indexName||`index`,u,d,f=[],p=!1,m=t.data?.params?.items;if(m!=null){let e=sn(m,s);Array.isArray(e)&&(f=e)}a?(u=a[o],d=a[l],p=!0):(u=f.length>0?f[0]:null,d=0);let h=Qt(o,u,n,s);!p&&h[0]&&(h[0].label=h[0].label+` [ç¤ºä¾‹]`),h[0]&&i.children?.push(h[0]);let g=Qt(l,d,n,s);!p&&g[0]&&(g[0].label=g[0].label+` [ç¤ºä¾‹]`),g[0]&&i.children?.push(g[0]);let _=`${n}.list`;s.set(_,f);let v={id:_,label:`list`,valueType:`array`,reference:en(_),value:f,children:f.length>0?Zt(f,_,s):[],nodeId:e,outputId:`list`};i.children?.push(v),c.push(i);return}}if(!i||Object.keys(i).length===0)return;let l={id:e,label:n,valueType:`node`,value:null,children:[],nodeId:e};Object.entries(i).forEach(([e,t])=>{if(t===void 0)return;let r=t;if(r&&typeof r==`object`&&!Array.isArray(r)&&`data`in r){let e=r.data,t=r.isError;e&&typeof e==`object`&&(r={...e,...t===void 0?{}:{isError:t}})}let a=Object.keys(i);a.length===1&&a[0]===`default`?s.set(n,r):(s.set(n,r),s.set(`${n}.${e}`,r));let o=Qt(e,r,n,s);l.children?.push(...o)}),c.push(l)}),{tree:c.reverse(),map:s}}function nn(e,t){let n=JSON.parse(JSON.stringify(e));return rn(n,t)}function rn(e,t){if(typeof e==`string`)return sn(e,t);if(Array.isArray(e))return e.map(e=>rn(e,t));if(e&&typeof e==`object`){let n={};return Object.entries(e).forEach(([e,r])=>{n[e]=rn(r,t)}),n}return e}const an=/\{\{\s*\$?([^{}]+?)\s*\}\}/g;function on(e){return an.test(e)}function sn(e,t){let n=[...e.matchAll(an)];if(n.length===0)return e;let r=n[0];if(!r)return e;if(n.length===1&&e.trim()===r[0]){let n=r[1];if(!n)return e;let i=n.trim(),a=t.get(i);return a===void 0?e:a}let i=e;return n.forEach(([e,n])=>{if(!n)return;let r=n.trim();if(!t.has(r))return;let a=t.get(r),o=typeof a==`string`?a:JSON.stringify(a,null,2);i=i.replace(e,o)}),i}var cn=k({DATA_TYPE_LABELS:()=>un,IfNode:()=>fn,OPERATORS_BY_TYPE:()=>dn,OPERATOR_LABELS:()=>ln});const ln={"is equal to":`ç­‰äºŽ`,"is not equal to":`ä¸ç­‰äºŽ`,exists:`å­˜åœ¨`,"does not exist":`ä¸å­˜åœ¨`,"is empty":`ä¸ºç©º`,"is not empty":`ä¸ä¸ºç©º`,contains:`åŒ…å«`,"does not contain":`ä¸åŒ…å«`,"starts with":`å¼€å¤´ä¸º`,"ends with":`ç»“å°¾ä¸º`,"is greater than":`å¤§äºŽ`,"is less than":`å°äºŽ`,"is greater than or equal to":`å¤§äºŽç­‰äºŽ`,"is less than or equal to":`å°äºŽç­‰äºŽ`,"is true":`ä¸ºçœŸ`,"is false":`ä¸ºå‡`,"is before":`æ—©äºŽ`,"is after":`æ™šäºŽ`,"is before or equal to":`æ—©äºŽæˆ–ç­‰äºŽ`,"is after or equal to":`æ™šäºŽæˆ–ç­‰äºŽ`,"length equal to":`é•¿åº¦ç­‰äºŽ`,"length not equal to":`é•¿åº¦ä¸ç­‰äºŽ`,"length greater than":`é•¿åº¦å¤§äºŽ`,"length less than":`é•¿åº¦å°äºŽ`,"length greater than or equal to":`é•¿åº¦å¤§äºŽç­‰äºŽ`,"length less than or equal to":`é•¿åº¦å°äºŽç­‰äºŽ`},un={string:`å­—ç¬¦ä¸²`,number:`æ•°å­—`,date:`æ—¥æœŸ`,boolean:`å¸ƒå°”å€¼`,array:`æ•°ç»„`,object:`å¯¹è±¡`},dn={string:[`is equal to`,`is not equal to`,`contains`,`does not contain`,`starts with`,`ends with`,`exists`,`does not exist`,`is empty`,`is not empty`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],number:[`is equal to`,`is not equal to`,`is greater than`,`is less than`,`is greater than or equal to`,`is less than or equal to`,`exists`,`does not exist`],date:[`is equal to`,`is not equal to`,`is before`,`is after`,`is before or equal to`,`is after or equal to`,`exists`,`does not exist`],boolean:[`is equal to`,`is not equal to`,`is true`,`is false`,`exists`,`does not exist`],array:[`exists`,`does not exist`,`is empty`,`is not empty`,`contains`,`does not contain`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],object:[`exists`,`does not exist`,`is empty`,`is not empty`]};var fn=class extends ${constructor(...e){super(...e),this.type=`if`,this.label=`æ¡ä»¶åˆ¤æ–­`,this.description=`æ ¹æ®æ¡ä»¶åˆ¤æ–­æ‰§è¡Œä¸åŒçš„åˆ†æ”¯`,this.category=`æµç¨‹æŽ§åˆ¶`,this.currentConfig=null}defineInputs(){return[{name:`config`,type:`object`,description:`æ¡ä»¶é…ç½®`,defaultValue:this.getDefaultConfig(),required:!1}]}defineOutputs(){return this.currentConfig?this.getOutputsForConfig(this.currentConfig):this.getOutputsForConfig(this.getDefaultConfig())}getOutputsForConfig(e){let t=e.conditions||[],n=Math.max(t.length,1),r=[];for(let e=0;e<n;e++){let n=t[e];r.push({name:this.getConditionOutputId(e),type:`any`,description:n?this.describeCondition(n):`æœªé…ç½®æ¡ä»¶`})}return r.push({name:`else`,type:`any`,description:`æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³æ—¶æ‰§è¡Œ`}),r}updateConfig(e){this.currentConfig=e}getDefaultConfig(){return{conditions:[{logic:`and`,subConditions:[{field:``,dataType:`string`,operator:`is equal to`,value:``}]}]}}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`â“`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`config`,this.getDefaultConfig());this.updateConfig(t);let n=Array.isArray(t.conditions)?t.conditions:[];console.log(`[IfNode] å¼€å§‹è¯„ä¼°æ¡ä»¶ï¼Œæ¡ä»¶æ•°é‡:`,n.length),console.log(`[IfNode] åŽŸå§‹æ¡ä»¶é…ç½®:`,JSON.stringify(n,null,2));let r=n.map((e,t)=>{console.log(`\n[IfNode] è¯„ä¼°æ¡ä»¶ ${t+1}:`,{logic:e.logic,subConditionsCount:e.subConditions.length});let n=e.subConditions.map((e,t)=>{console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - åŽŸå§‹å€¼:`,{field:e.field,value:e.value,operator:e.operator,dataType:e.dataType});let n=this.resolveOperandValue(e.field,e.dataType),r=this.resolveOperandValue(e.value,e.dataType);if(console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - è§£æžåŽçš„å€¼:`,{actualValue:n,targetValue:r,actualType:typeof n,targetType:typeof r}),this.isEmptyCondition(e.field,e.value,e.operator))return console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - æœªé…ç½®ï¼ˆå·¦å³å€¼éƒ½ä¸ºç©ºï¼‰ï¼Œè¿”å›ž false`),{...e,actualValue:n,targetValue:r,result:!1};let i=this.compareValues(n,r,e.operator,e.dataType);return console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - æ¯”è¾ƒç»“æžœ:`,i),{...e,actualValue:n,targetValue:r,result:i}}),r=e.logic===`or`?n.some(e=>e.result):n.every(e=>e.result);return console.log(`[IfNode] æ¡ä»¶ ${t+1} æœ€ç»ˆç»“æžœ:`,{logic:e.logic,subResults:n.map(e=>e.result),conditionResult:r}),{index:t,outputId:this.getConditionOutputId(t),logic:e.logic,subResults:n,result:r}}),i=r.findIndex(e=>e.result),a=i!==-1;console.log(`
[IfNode] æ¡ä»¶è¯„ä¼°æ±‡æ€»:`,{totalConditions:r.length,firstPassedIndex:i,anyPassed:a,allResults:r.map((e,t)=>({index:t,outputId:e.outputId,result:e.result}))});let o={};r.forEach((e,t)=>{o[e.outputId]=t===i?{branch:e.outputId,passed:!0,evaluation:e,allEvaluations:r}:void 0}),o.else=a?void 0:{branch:`else`,passed:!1,allEvaluations:r};let s=i===-1?null:r[i];return console.log(`[IfNode] æœ€ç»ˆè¾“å‡ºç«¯å£:`,{selectedBranch:s?s.outputId:`else`,outputKeys:Object.keys(o),outputsWithData:Object.entries(o).filter(([e,t])=>t!==void 0).map(([e])=>e)}),this.createOutput(o,{branch:s?s.outputId:`else`,passed:a,evaluations:r},s?`æ¡ä»¶${i+1}æ»¡è¶³`:`æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæ‰§è¡Œ else`)}catch(e){return this.createError(e)}}getConditionOutputId(e){return`condition-${e}`}describeCondition(e){let{logic:t,subConditions:n}=e;if(!n||n.length===0)return`æœªé…ç½®å­æ¡ä»¶`;if(n.length===1)return this.describeSubCondition(n[0]);let r=t===`and`?` ä¸” `:` æˆ– `,i=n.map(e=>this.describeSubCondition(e)).join(r);return i.length>60?i.slice(0,57)+`...`:i}describeSubCondition(e){if(!e)return`æœªé…ç½®`;let t=this.formatOperand(e.field,`è¾“å…¥å€¼`),n=ln[e.operator]||e.operator;if([`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(e.operator))return`${t} ${n}`;let r=this.truncateValue(e.value,20,`''`);return`${t} ${n} ${r}`}truncateValue(e,t=48,n=``){let r=this.formatOperand(e,n);return r?r.length<=t?r:`${r.slice(0,t-1)}â€¦`:n}formatOperand(e,t=``){if(e==null)return t;if(typeof e==`string`){let n=e.trim();return n.length>0?n:t}if(typeof e==`number`||typeof e==`boolean`)return String(e);if(e instanceof Date)return e.toISOString();try{return JSON.stringify(e)}catch{return String(e)}}isEmptyCondition(e,t,n){return[`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(n)?this.isOperandEmpty(e):this.isOperandEmpty(e)&&this.isOperandEmpty(t)}isOperandEmpty(e){return e==null?!0:typeof e==`string`?e.trim()===``:!1}resolveOperandValue(e,t){return e==null?e:this.coerceValueByType(e,t)}coerceValueByType(e,t){if(e==null)return e;switch(t){case`number`:{if(typeof e==`number`)return e;if(typeof e==`boolean`)return e?1:0;if(typeof e==`string`){let t=Number(e);return Number.isNaN(t)?e:t}let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`number`)return e!==0;if(typeof e==`string`){let t=e.toLowerCase();if([`true`,`1`,`yes`].includes(t))return!0;if([`false`,`0`,`no`].includes(t))return!1}return!!e;case`date`:if(e instanceof Date)return e;if(typeof e==`number`)return new Date(e);if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?e:t}return e;case`array`:if(Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return[];try{let n=JSON.parse(t);return Array.isArray(n)?n:e}catch{return e}}return e;case`object`:if(e&&typeof e==`object`&&!Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return{};try{let n=JSON.parse(t);return n&&typeof n==`object`?n:e}catch{return e}}return e;default:return typeof e==`string`?e:String(e)}}compareValues(e,t,n,r){console.log(`    [IfNode.compareValues] æ¯”è¾ƒå‚æ•°:`,{actual:e,target:t,operator:n,dataType:r,actualType:typeof e,targetType:typeof t});let i;switch(n){case`is equal to`:return i=this.compareEquality(e,t,r),console.log(`    [IfNode.compareValues] is equal to ç»“æžœ:`,i),i;case`is not equal to`:return!this.compareEquality(e,t,r);case`exists`:return e!=null;case`does not exist`:return e==null;case`is empty`:return e==null?!0:typeof e==`string`?e.trim().length===0:Array.isArray(e)?e.length===0:typeof e==`object`?Object.keys(e).length===0:!1;case`is not empty`:return e==null?!1:typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:typeof e==`object`?Object.keys(e).length>0:!0;case`contains`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?e.includes(t):!1;case`does not contain`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?!e.includes(t):!0;case`starts with`:return typeof e==`string`&&typeof t==`string`?e.startsWith(t):!1;case`ends with`:return typeof e==`string`&&typeof t==`string`?e.endsWith(t):!1;case`is greater than`:return Number(e)>Number(t);case`is less than`:return Number(e)<Number(t);case`is greater than or equal to`:return Number(e)>=Number(t);case`is less than or equal to`:return Number(e)<=Number(t);case`is true`:return e===!0;case`is false`:return e===!1;case`is before`:return new Date(e)<new Date(t);case`is after`:return new Date(e)>new Date(t);case`is before or equal to`:return new Date(e)<=new Date(t);case`is after or equal to`:return new Date(e)>=new Date(t);case`length equal to`:return this.getLength(e)===Number(t);case`length not equal to`:return this.getLength(e)!==Number(t);case`length greater than`:return this.getLength(e)>Number(t);case`length less than`:return this.getLength(e)<Number(t);case`length greater than or equal to`:return this.getLength(e)>=Number(t);case`length less than or equal to`:return this.getLength(e)<=Number(t);default:return!1}}getLength(e){return typeof e==`string`||Array.isArray(e)?e.length:typeof e==`object`&&e?Object.keys(e).length:0}compareEquality(e,t,n){let r=this.normalizeEqualityValue(e,n),i=this.normalizeEqualityValue(t,n);return n===`array`||n===`object`?ie(r,i):r===i}normalizeEqualityValue(e,t){if(e==null)return e;switch(t){case`number`:{let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`string`){let t=e.trim().toLowerCase();if(t===`true`||t===`1`)return!0;if(t===`false`||t===`0`)return!1}return typeof e==`number`?e===1:!!e;case`date`:{let t=e instanceof Date?e.getTime():new Date(e).getTime();return Number.isNaN(t)?e:t}case`string`:return String(e);default:return e}}},pn=k({CodeNode:()=>gn}),mn=`export async function main(params) {
  return {
    receivedKeys: Object.keys(params),
    example: params,
  };
}`,hn=/^[A-Za-z][A-Za-z0-9_]*$/,gn=class extends ${constructor(...e){super(...e),this.type=`code`,this.label=`ä»£ç æ‰§è¡Œ`,this.description=`æ‰§è¡Œè‡ªå®šä¹‰ TypeScript/JavaScript ä»£ç `,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`dataItems`,type:`array`,description:`å‚æ•°å¯¹è±¡ï¼ˆå¦‚æä¾›åˆ™è¦†ç›–ç”± dataItems æž„å»ºçš„å‚æ•°ï¼‰`,required:!1},{name:`code`,type:`string`,description:`åŠ¨æ€ä»£ç ï¼ˆå¦‚æä¾›åˆ™è¦†ç›–é…ç½®ä¸­çš„ codeï¼‰`,required:!1}]}defineOutputs(){return[{name:`result`,type:`any`,description:`æ‰§è¡Œç»“æžœ`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],showIcon:!0}}getDefaultConfig(){return{code:mn,dataItems:[]}}shouldUseCache(e,t){return!1}async execute(e,t){try{let t=this.getDefaultConfig(),n=this.getInput(e,`code`,``),r=typeof n==`string`&&n.trim()?n:void 0,i=this.getInput(e,`dataItems`,null),a=Array.isArray(i),o=i&&typeof i==`object`&&!a?i:void 0,s=r??t.code,c=o??this.buildParams(a?i:t.dataItems),l=this.prepareRuntime(s);try{let e=Function(`params`,l)(c),t=e instanceof Promise?await e:e,n={result:t};return this.createOutput(n,t,this.buildSummary(t,Object.keys(c)))}catch(e){throw Error(`ä»£ç æ‰§è¡Œé”™è¯¯: ${e?.message??e}`)}}catch(e){return this.createError(e)}}buildParams(e){let t={},n=new Set;return e.forEach((e,r)=>{let i=(e?.key??``).trim();if(!i){console.error(`ç¬¬ ${r+1} é¡¹çš„é”®åä¸èƒ½ä¸ºç©º`);return}if(!hn.test(i)){console.error(`ç¬¬ ${r+1} é¡¹çš„é”®å "${i}" æ— æ•ˆï¼šä»…æ”¯æŒä»¥å­—æ¯å¼€å¤´ï¼Œç”±å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ç»„æˆ`);return}if(n.has(i)){console.error(`æ£€æµ‹åˆ°é‡å¤çš„é”®å "${i}"ï¼Œè¯·ç¡®ä¿å”¯ä¸€`);return}n.add(i),t[i]=e?.value}),t}prepareRuntime(e){return`"use strict";
${this.normalizeExports(e)}

if (typeof main !== "function") {
  throw new Error("main å‡½æ•°æœªå®šä¹‰ï¼Œè¯·ç¡®ä¿å¯¼å‡º export function main(params) {}");
}

const result = main(params);
return result;`}normalizeExports(e){let t=e;return[[/export\s+default\s+async\s+function\s+main/g,`async function main`],[/export\s+default\s+function\s+main/g,`function main`],[/export\s+async\s+function\s+main/g,`async function main`],[/export\s+function\s+main/g,`function main`],[/export\s+default\s+main\s*;?/g,``],[/export\s+{\s*main\s+as\s+default\s*};?/g,``],[/export\s+const\s+main\s*=\s*/g,`const main = `],[/export\s+let\s+main\s*=\s*/g,`let main = `],[/export\s+var\s+main\s*=\s*/g,`var main = `]].forEach(([e,n])=>{t=t.replace(e,n)}),t}buildSummary(e,t){let n=t.length>0?t.join(`, `):`æ— `,r=this.formatValue(e);return`main(params) æ‰§è¡Œå®Œæˆ | å‚æ•°é”®: [${n}] | ç»“æžœ: ${r}`}formatValue(e){if(e===null)return`null`;if(e===void 0)return`undefined`;if(typeof e==`string`)return e.length>40?`"${e.slice(0,37)}..."`:`"${e}"`;if(typeof e==`number`||typeof e==`boolean`)return String(e);if(Array.isArray(e))return`Array(${e.length})`;if(typeof e==`object`){let t=Object.keys(e);if(t.length===0)return`{}`;let n=t.slice(0,3).join(`, `),r=t.length>3?`, ...`:``;return`{ ${n}${r} }`}return String(e)}},_n=k({ConnectorNode:()=>vn}),vn=class extends ${constructor(...e){super(...e),this.type=`connector`,this.label=`è¿žæŽ¥`,this.description=`ç”¨äºŽä¼˜åŒ–è¿žæŽ¥çº¿å¸ƒå±€ï¼Œæ‰§è¡Œæ—¶è¿”å›ž undefined`,this.category=`å·¥å…·`}defineInputs(){return[]}defineOutputs(){return[{name:`output`,type:`any`,description:`è¾“å‡ºæ•°æ®ï¼ˆundefinedï¼‰`}]}getStyleConfig(){return{}}async execute(e,t){return this.createOutput({output:void 0},void 0,`è¿žæŽ¥èŠ‚ç‚¹ï¼šå·²è¿”å›ž undefined`)}},yn=k({ArrayFilterNode:()=>xn,DataMergeNode:()=>bn}),bn=class extends ${constructor(...e){super(...e),this.type=`data-merge`,this.label=`æ•°æ®åˆå¹¶`,this.description=`å°†å¤šä¸ªè¾“å…¥åˆå¹¶ä¸ºä¸€ä¸ªå¯¹è±¡`,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`input1`,type:`any`,description:`è¾“å…¥æ•°æ®1`,multiple:!0},{name:`input2`,type:`any`,description:`è¾“å…¥æ•°æ®2`,multiple:!0},{name:`input3`,type:`any`,description:`è¾“å…¥æ•°æ®3`}]}defineOutputs(){return[{name:`merged`,type:`object`,description:`åˆå¹¶åŽçš„å¯¹è±¡`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#ec4899`],icon:`ðŸ”—`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`input1`),n=this.getInput(e,`input2`),r=this.getInput(e,`input3`),i={data1:t,data2:n,data3:r,mergedAt:new Date().toISOString()};return this.createOutput(i)}catch(e){return this.createError(e)}}},xn=class extends ${constructor(...e){super(...e),this.type=`array-filter`,this.label=`æ•°ç»„è¿‡æ»¤`,this.description=`æ ¹æ®æ¡ä»¶è¿‡æ»¤æ•°ç»„å…ƒç´ `,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`array`,type:`array`,description:`è¾“å…¥æ•°ç»„`,required:!0},{name:`condition`,type:`string`,description:`è¿‡æ»¤æ¡ä»¶ï¼ˆJavaScript è¡¨è¾¾å¼ï¼Œä½¿ç”¨ item è¡¨ç¤ºå½“å‰å…ƒç´ ï¼‰`,required:!0,defaultValue:`item > 0`}]}defineOutputs(){return[{name:`filtered`,type:`array`,description:`è¿‡æ»¤åŽçš„æ•°ç»„`},{name:`count`,type:`number`,description:`è¿‡æ»¤åŽçš„å…ƒç´ æ•°é‡`}]}getStyleConfig(){return{headerColor:`#10b981`,icon:`ðŸ”`,showIcon:!0,headerStyle:{fontWeight:`600`}}}async execute(e,t){try{let t=this.getInput(e,`array`,[]),n=this.getInput(e,`condition`,`true`);if(!Array.isArray(t))return this.createError(`è¾“å…¥å¿…é¡»æ˜¯æ•°ç»„ç±»åž‹`);let r=Function(`item`,`return ${n}`),i=t.filter(r);return this.createOutput({filtered:i,count:i.length},i,`è¿‡æ»¤å®Œæˆï¼š${t.length} -> ${i.length} é¡¹`)}catch(e){return this.createError(e)}}},Sn=k({DelayNode:()=>Cn}),Cn=class extends ${constructor(...e){super(...e),this.type=`delay`,this.label=`å»¶è¿Ÿ`,this.description=`æš‚åœå·¥ä½œæµæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´`,this.category=`æŽ§åˆ¶æµ`}defineInputs(){return[{name:`delay`,type:`number`,description:`å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰`,required:!0,defaultValue:1e3}]}defineOutputs(){return[{name:`output`,type:`any`,description:`å»¶è¿ŸåŽè¾“å‡ºçš„æ•°æ®`}]}getStyleConfig(){return{headerColor:[`#f59e0b`,`#d97706`],icon:`â±ï¸`,showIcon:!0}}shouldUseCache(e,t){return!1}async execute(e,t){try{let n=this.getInput(e,`delay`,1e3);return console.log(`DelayNode execute`,n),typeof n!=`number`||n<0?this.createError(`å»¶è¿Ÿæ—¶é—´å¿…é¡»æ˜¯éžè´Ÿæ•°`):n===0?this.createOutput({output:void 0}):(await this.sleep(n,t.signal),this.createOutput({output:void 0},void 0,`å»¶è¿Ÿ ${n}ms å®Œæˆ`))}catch(e){return e instanceof Error&&e.name===`AbortError`?this.createError(`å»¶è¿Ÿè¢«å–æ¶ˆ`):this.createError(e)}}sleep(e,t){return new Promise((n,r)=>{if(t?.aborted){let e=Error(`å»¶è¿Ÿè¢«å–æ¶ˆ`);e.name=`AbortError`,r(e);return}let i=setTimeout(()=>{o(),n()},e),a=()=>{o();let e=Error(`å»¶è¿Ÿè¢«å–æ¶ˆ`);e.name=`AbortError`,r(e)},o=()=>{clearTimeout(i),t?.removeEventListener(`abort`,a)};t?.addEventListener(`abort`,a)})}},wn=k({EndNode:()=>Tn}),Tn=class extends ${constructor(...e){super(...e),this.type=`end`,this.label=`ç»“æŸ`,this.description=`å·¥ä½œæµç¨‹çš„ç»“æŸèŠ‚ç‚¹`,this.category=`æŽ§åˆ¶æµ`}defineInputs(){return[{name:`input`,type:`any`,description:`æŽ¥æ”¶ä»»æ„è¾“å…¥`,required:!1}]}defineOutputs(){return[]}getStyleConfig(){return{headerColor:[`#ef4444`,`#dc2626`],icon:`â¹ï¸`,showIcon:!0}}async execute(e,t){let n=this.getInput(e,`input`,null);return{success:!0,summary:`å·¥ä½œæµç»“æŸ`,outputs:{},raw:{completed:!0,timestamp:Date.now(),finalInput:n}}}},En=k({ForNode:()=>Dn}),Dn=class extends ${constructor(...e){super(...e),this.type=`for`,this.label=`æ‰¹å¤„ç†`,this.description=`éåŽ†é›†åˆå¹¶è¿è¡Œå¾ªçŽ¯ä½“`,this.category=`æµç¨‹æŽ§åˆ¶`}defineInputs(){return[{name:`items`,type:`array`,description:`è¾“å…¥é›†åˆ`,required:!1}]}defineOutputs(){return[{name:`loop`,type:`any`,description:`å¾ªçŽ¯ä½“`},{name:`next`,type:`any`,description:`å¾ªçŽ¯ç»“æŸ`}]}getStyleConfig(){return{headerColor:[`#f97316`,`#ea580c`],showIcon:!0}}async execute(e,t){try{let n=this.getInput(e,`items`,[]);if(!Array.isArray(n))throw Error(`å¾ªçŽ¯æºæ•°æ®å¿…é¡»æ˜¯æ•°ç»„`);let r=t.nodeData||{},i={...this.getDefaultConfig(),...r.config||{}};if(!i.containerId)throw Error(`For èŠ‚ç‚¹æœªé…ç½®å¾ªçŽ¯ä½“å®¹å™¨`);if(!t.executeContainer)throw Error(`æ‰§è¡Œä¸Šä¸‹æ–‡ç¼ºå°‘ executeContainer æ–¹æ³•`);let a=n.map((e,t)=>({[i.itemName]:e,[i.indexName]:t,list:n}));if(a.length===0)return this.createOutput({next:{totalCount:0,executedCount:0,successCount:0,errorCount:0,results:[],summary:`æ— è¿­ä»£æ•°æ®`}},{count:0},`æ— è¿­ä»£æ•°æ®`);let o=i.pagination,s=o?.enabled??!1,c=o?.pageSize??10,l=o?.currentPage??1,u=a,d=0,f=a.length;s&&c>0?(d=(l-1)*c,f=Math.min(d+c,a.length),u=a.slice(d,f),console.log(`[ForNode] å¯ç”¨åˆ†é¡µï¼šç¬¬ ${l} é¡µï¼Œæ¯é¡µ ${c} æ¡ï¼Œæ‰§è¡Œ ${u.length} æ¬¡è¿­ä»£ï¼ˆæ€»å…± ${a.length} æ¬¡ï¼‰`)):console.log(`[ForNode] å¼€å§‹æ‰§è¡Œå¾ªçŽ¯ï¼Œå…± ${a.length} æ¬¡è¿­ä»£`);let p=[];for(let e=0;e<u.length;e++){let n=d+e,r=u[e]||{};console.log(`[ForNode] æ‰§è¡Œç¬¬ ${n+1}/${a.length} æ¬¡è¿­ä»£`,r);try{let e=await t.executeContainer(i.containerId,r);p.push({index:n,variables:r,result:e,status:`success`})}catch(e){let t=e instanceof Error?e.message:String(e);if(console.error(`[ForNode] ç¬¬ ${n+1} æ¬¡è¿­ä»£å¤±è´¥:`,t),p.push({index:n,variables:r,error:t,status:`error`}),!i.errorHandling?.continueOnError)throw e}}let m=a.length,h=u.length,g=p.filter(e=>e.status===`success`).length,_=p.filter(e=>e.status===`error`).length,v={next:{totalCount:m,executedCount:h,successCount:g,errorCount:_,results:p,pagination:s?{enabled:!0,currentPage:l,pageSize:c,totalPages:Math.ceil(m/c),startIndex:d,endIndex:f-1}:void 0,summary:s?`ç¬¬ ${l} é¡µï¼šæ‰§è¡Œ ${h} æ¬¡ï¼ŒæˆåŠŸ ${g} æ¬¡ï¼Œå¤±è´¥ ${_} æ¬¡`:`å¾ªçŽ¯æ‰§è¡Œ ${h} æ¬¡ï¼ŒæˆåŠŸ ${g} æ¬¡ï¼Œå¤±è´¥ ${_} æ¬¡`}};return this.createOutput(v,{totalCount:m,executedCount:h,successCount:g,errorCount:_},v.next.summary)}catch(e){return this.createError(e)}}getDefaultConfig(){return{mode:`variable`,variable:``,range:{start:0,end:10,step:1},itemName:`item`,indexName:`index`,containerId:null,errorHandling:{continueOnError:!1}}}},On=k({HttpRequestNode:()=>kn,JsonParseNode:()=>An,ObjectGetNode:()=>jn}),kn=class extends ${constructor(...e){super(...e),this.type=`http-request`,this.label=`HTTP è¯·æ±‚`,this.description=`å‘é€ HTTP è¯·æ±‚å¹¶è¿”å›žå“åº”`,this.category=`ç½‘ç»œ`}defineInputs(){return[{name:`url`,type:`string`,description:`è¯·æ±‚ URL`,required:!0},{name:`method`,type:`string`,description:`è¯·æ±‚æ–¹æ³•ï¼ˆGET/POST/PUT/DELETE/PATCHï¼‰`,defaultValue:`GET`},{name:`headers`,type:`object`,description:`è¯·æ±‚å¤´ï¼ˆJSON å¯¹è±¡ï¼‰`,defaultValue:{}},{name:`body`,type:`any`,description:`è¯·æ±‚ä½“ï¼ˆPOST/PUT/PATCH æ—¶ä½¿ç”¨ï¼‰`},{name:`timeout`,type:`number`,description:`è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰`,defaultValue:3e4}]}defineOutputs(){return[{name:`data`,type:`any`,description:`å“åº”æ•°æ®`},{name:`status`,type:`number`,description:`HTTP çŠ¶æ€ç `},{name:`headers`,type:`object`,description:`å“åº”å¤´`},{name:`success`,type:`boolean`,description:`è¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆçŠ¶æ€ç  2xxï¼‰`}]}getStyleConfig(){return{headerColor:[`#3b82f6`,`#06b6d4`],icon:`ðŸŒ`,showIcon:!0,bodyStyle:{minWidth:`240px`}}}async execute(e,t){try{let n=this.getInput(e,`url`),r=this.getInput(e,`method`,`GET`),i=this.getInput(e,`headers`,{}),a=this.getInput(e,`body`),o=this.getInput(e,`timeout`,3e4),s=this.validateInputs(e);if(!s.valid)return this.createError(s.errors.join(`; `));if(t.signal?.aborted)return this.createError(`è¯·æ±‚å·²ä¸­æ­¢`);let c={method:r,headers:{"Content-Type":`application/json`,...i},signal:t.signal};[`POST`,`PUT`,`PATCH`].includes(r)&&a!==void 0&&(c.body=typeof a==`string`?a:JSON.stringify(a));let l=new AbortController,u=setTimeout(()=>l.abort(),o);try{let e=await fetch(n,{...c,signal:l.signal});clearTimeout(u);let t,i=e.headers.get(`content-type`);t=i?.includes(`application/json`)?await e.json():i?.includes(`text/`)?await e.text():await e.blob();let a={};e.headers.forEach((e,t)=>{a[t]=e});let o=e.ok;return this.createOutput({data:t,status:e.status,headers:a,success:o},t,`${r} ${n} - ${e.status} ${e.statusText}`)}catch(e){if(clearTimeout(u),e.name===`AbortError`)return this.createError(`è¯·æ±‚è¶…æ—¶`);throw e}}catch(e){return this.createError(e)}}},An=class extends ${constructor(...e){super(...e),this.type=`json-parse`,this.label=`JSON è§£æž`,this.description=`å°† JSON å­—ç¬¦ä¸²è§£æžä¸ºå¯¹è±¡`,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`json`,type:`string`,description:`JSON å­—ç¬¦ä¸²`,required:!0}]}defineOutputs(){return[{name:`data`,type:`object`,description:`è§£æžåŽçš„å¯¹è±¡`}]}getStyleConfig(){return{headerColor:`#8b5cf6`,icon:`ðŸ“‹`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`json`,``),n=this.validateInputs(e);if(!n.valid)return this.createError(n.errors.join(`; `));let r=JSON.parse(t);return this.createOutput(r,r,`è§£æžæˆåŠŸ`)}catch(e){return this.createError(`JSON è§£æžå¤±è´¥: ${e.message}`)}}},jn=class extends ${constructor(...e){super(...e),this.type=`object-get`,this.label=`å¯¹è±¡å–å€¼`,this.description=`ä»Žå¯¹è±¡ä¸­æå–æŒ‡å®šè·¯å¾„çš„å€¼`,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`object`,type:`object`,description:`è¾“å…¥å¯¹è±¡`,required:!0},{name:`path`,type:`string`,description:`å¯¹è±¡è·¯å¾„ï¼ˆå¦‚ "user.name" æˆ– "items[0].id"ï¼‰`,required:!0},{name:`defaultValue`,type:`any`,description:`é»˜è®¤å€¼ï¼ˆè·¯å¾„ä¸å­˜åœ¨æ—¶è¿”å›žï¼‰`}]}defineOutputs(){return[{name:`value`,type:`any`,description:`æå–çš„å€¼`}]}getStyleConfig(){return{headerColor:`#f59e0b`,icon:`ðŸ”‘`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`object`),n=this.getInput(e,`path`,``),r=this.getInput(e,`defaultValue`),i=this.validateInputs(e);if(!i.valid)return this.createError(i.errors.join(`; `));let a=this.getValueByPath(t,n,r);return this.createOutput(a,a,`æå–è·¯å¾„: ${n}`)}catch(e){return this.createError(e)}}getValueByPath(e,t,n){if(!e||!t)return n;let r=t.replace(/\[(\w+)\]/g,`.$1`).split(`.`).filter(e=>e.length>0),i=e;for(let e of r){if(i==null)return n;i=i[e]}return i===void 0?n:i}},Mn=k({NoteNode:()=>Nn}),Nn=class extends ${constructor(...e){super(...e),this.type=`note`,this.label=`ç¬”è®°`,this.description=`åœ¨å·¥ä½œæµä¸­æ·»åŠ æ³¨é‡Šå’Œè¯´æ˜Ž`,this.category=`å·¥å…·`}defineInputs(){return[]}defineOutputs(){return[]}getStyleConfig(){return{headerColor:`#fbbf24`,icon:`ðŸ“`,showIcon:!0}}async execute(e,t){return{success:!0,summary:`ç¬”è®°èŠ‚ç‚¹ï¼ˆè·³è¿‡æ‰§è¡Œï¼‰`,outputs:{}}}},Pn=k({StartNode:()=>Fn}),Fn=class extends ${constructor(...e){super(...e),this.type=`start`,this.label=`å¼€å§‹`,this.description=`å·¥ä½œæµç¨‹çš„èµ·å§‹èŠ‚ç‚¹`,this.category=`æŽ§åˆ¶æµ`}defineInputs(){return[]}defineOutputs(){return[{name:`output`,type:`any`,description:`å¼€å§‹ä¿¡å·`}]}getStyleConfig(){return{headerColor:[`#10b981`,`#059669`],showIcon:!0}}async execute(e,t){return console.log(`[StartNode execute]`,t),this.createOutput({output:{started:!0,timestamp:Date.now(),workflowId:t.workflow?.workflowId,datas:{name:`John Doe`,age:30,address:{street:`123 Main St`,city:`Anytown`}},lists:[{name:`John Doe`,age:30},{name:`IXOA Doe`,age:10},{name:`UN NJH Doe`,age:25}],maps:{name:`John Doe`,age:30}}})}},In=k({TextProcessNode:()=>Ln}),Ln=class extends ${constructor(...e){super(...e),this.type=`text-process`,this.label=`æ–‡æœ¬å¤„ç†`,this.description=`å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œè½¬æ¢å¤„ç†`,this.category=`æ–‡æœ¬å·¥å…·`}defineInputs(){return[{name:`text`,type:`string`,description:`è¾“å…¥æ–‡æœ¬`,required:!0},{name:`mode`,type:`string`,description:`å¤„ç†æ¨¡å¼`,defaultValue:`uppercase`,options:[{label:`å¤§å†™`,value:`uppercase`},{label:`å°å†™`,value:`lowercase`},{label:`åè½¬`,value:`reverse`}]},{name:`prefix`,type:`string`,description:`æ·»åŠ å‰ç¼€`,defaultValue:``}]}defineOutputs(){return[{name:`result`,type:`string`,description:`å¤„ç†åŽçš„æ–‡æœ¬`},{name:`length`,type:`number`,description:`æ–‡æœ¬é•¿åº¦`}]}getStyleConfig(){return{headerColor:`#3b82f6`,icon:`ðŸ“`,showIcon:!0,bodyStyle:{minWidth:`200px`}}}async execute(e,t){try{let t=this.getInput(e,`text`,``).toString(),n=this.getInput(e,`mode`,`uppercase`),r=this.getInput(e,`prefix`,``),i=this.validateInputs(e);if(!i.valid)return this.createError(i.errors.join(`; `));let a=t;switch(n){case`uppercase`:a=t.toUpperCase();break;case`lowercase`:a=t.toLowerCase();break;case`reverse`:a=t.split(``).reverse().join(``);break}return r&&(a=r+a),this.createOutput({result:a,length:a.length})}catch(e){return this.createError(e)}}};const Rn={};var zn={"./nodes/CodeNode.ts":pn,"./nodes/ConnectorNode.ts":_n,"./nodes/DataTransformNode.ts":yn,"./nodes/DelayNode.ts":Sn,"./nodes/EndNode.ts":wn,"./nodes/ForNode.ts":En,"./nodes/HttpRequestNode.ts":On,"./nodes/IfNode.ts":cn,"./nodes/NoteNode.ts":Mn,"./nodes/StartNode.ts":Pn,"./nodes/TextProcessNode.ts":In};for(let e in zn){let t=zn[e];for(let e in t){let n=t[e];if(typeof n==`function`&&n.prototype)try{let e=new n;e&&typeof e.type==`string`&&(Rn[e.type]=n)}catch{}}}function Bn(e){let t=Rn[e];if(!t)throw Error(`æœªçŸ¥çš„èŠ‚ç‚¹ç±»åž‹: ${e}`);return new t}var Vn={},Hn={class:`w-4 h-4`,viewBox:`0 0 24 24`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function Un(e,t){return T(),o(`svg`,Hn,[...t[0]||=[l(`path`,{d:`M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1),l(`path`,{d:`M15 12a3 3 0 11-6 0 3 3 0 016 0z`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1)]])}var Wn=G(Vn,[[`render`,Un]]),Gn={},Kn={viewBox:`0 0 24 24`,class:`n8n-icon`,"aria-hidden":`true`,focusable:`false`,role:`img`,"data-icon":`external-link`};function qn(e,t){return T(),o(`svg`,Kn,[...t[0]||=[l(`path`,{fill:`none`,stroke:`currentColor`,"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M15 3h6v6m-11 5L21 3m-3 10v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6`},null,-1)]])}var Jn=G(Gn,[[`render`,qn]]);const Yn=x(`ui`,()=>{let e=S(!1),t=S(null),n=S(`medium`),r=S(null),i=S({x:0,y:0}),a={small:280,medium:360,large:480},o=O(()=>r.value??a[n.value]),s=S(!1),c=S({title:``,content:``,type:`info`}),l=S(!1),u=S({title:``,content:``,language:`javascript`}),d=S(!1),f=S(!1),p=S({value:``,onSave:null}),m=S(!1),h=S({title:``,content:``,language:`javascript`,onSave:null}),g=S(null),_=S(null),v=S(null),y=Ce(),b=O(()=>y.value?.tagName!==`INPUT`&&y.value?.tagName!==`TEXTAREA`&&!y.value?.isContentEditable),x=O(()=>s.value||l.value||d.value||f.value||m.value),C=O(()=>x.value?!1:b.value);function w(n){t.value===n&&e.value?e.value=!1:(t.value=n,e.value=!0)}function T(){e.value=!1}function E(){t.value||=`workflows`,e.value=!0}function D(){e.value=!e.value}function k(e){n.value=e,r.value=null}function A(e){r.value=e}function j(){n.value=`medium`,r.value=null,i.value={x:0,y:0}}function M(e,t,n=`info`){c.value={title:e,content:t,type:n},s.value=!0}function N(){s.value=!1}function P(e,t,n=`javascript`){u.value={title:e,content:t,language:n},l.value=!0}function ee(){l.value=!1}function F(e){g.value=e,e&&(d.value=!0)}function I(){g.value=null,d.value=!1,t.value===`node-config`&&(e.value=!1)}function L(){g.value&&(d.value=!0)}function R(){d.value=!1}function z(e,t){p.value={value:e,onSave:t},f.value=!0}function B(){f.value=!1,setTimeout(()=>{p.value={value:``,onSave:null}},300)}function V(n,r){_.value=n,v.value=r,t.value=`node-result-preview`,e.value=!0}function H(){_.value=null,v.value=null,t.value===`node-result-preview`&&(e.value=!1)}function U(e,t,n=`javascript`,r){h.value={title:e,content:t,language:n,onSave:r||null},m.value=!0}function W(){m.value=!1,setTimeout(()=>{h.value={title:``,content:``,language:`javascript`,onSave:null}},300)}return{hasModalOpen:x,hasFoucsInput:b,enableShortcut:C,floatingPanelVisible:e,activeTab:t,panelSize:n,customPanelWidth:r,panelPosition:i,panelWidth:o,infoModalVisible:s,infoModalContent:c,editorModalVisible:l,editorModalContent:u,nodeConfigModalVisible:d,variableEditorModalVisible:f,variableEditorModalContent:p,editorPanelModalVisible:m,editorPanelContent:h,selectedNodeId:g,previewNodeId:_,previewNodeData:v,setActiveTab:w,closeFloatingPanel:T,openFloatingPanel:E,toggleFloatingPanel:D,setPanelSize:k,setCustomPanelWidth:A,resetPanel:j,showInfoModal:M,closeInfoModal:N,showEditorModal:P,closeEditorModal:ee,selectNode:F,clearNodeSelection:I,openNodeConfigModal:L,closeNodeConfigModal:R,openVariableEditorModal:z,closeVariableEditorModal:B,openEditorPanelModal:U,closeEditorPanelModal:W,showNodePreview:V,clearNodePreview:H}});var Xn={},Zn={class:`w-4 h-4`,viewBox:`0 0 24 24`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function Qn(e,t){return T(),o(`svg`,Zn,[...t[0]||=[l(`path`,{d:`M6 18L18 6M6 6l12 12`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1)]])}var $n=G(Xn,[[`render`,Qn]]),er={key:0,class:`shrink-0 text-slate-500`},tr={class:`flex-1 min-w-0`},nr={key:0,class:`text-sm font-semibold leading-6 text-slate-900`},rr={key:1,class:`mt-1 text-xs leading-5 text-slate-500`},ir={class:`flex items-center gap-2 shrink-0`},ar=_({__name:`PanelShell`,props:{title:{default:void 0},description:{default:void 0},closable:{type:Boolean,default:!1},size:{default:`md`},padding:{default:`md`},elevated:{type:Boolean,default:!1},headerSticky:{type:Boolean,default:!1},footerSticky:{type:Boolean,default:!1}},emits:[`close`],setup(e,{emit:t}){let i=e,s=t,c=I(),d=O(()=>({sm:`w-72`,md:`w-80`,lg:`w-96`,xl:`w-[28rem]`,full:`w-full`})[i.size]),f=O(()=>({none:`p-0`,xs:`px-4 py-3`,sm:`px-4 py-4`,md:`px-5 py-5`,lg:`px-6 py-6`})[i.padding]),m=O(()=>!!(i.title||i.description||c.header||c.icon||c.actions||i.closable)),{headerSticky:h,footerSticky:_,elevated:v}=r(i);return(t,r)=>{let i=D(`n-button`);return T(),o(`section`,{class:a([`panel-shell flex flex-col rounded-xl border border-slate-200 bg-white text-slate-900 shadow-sm transition-shadow duration-200`,g(v)?`shadow-lg`:`shadow-sm`,d.value])},[m.value?(T(),o(`header`,{key:0,class:a([`flex items-center gap-3 border-b border-slate-200 px-4`,e.description?`items-start py-3`:`items-center py-2`,g(h)?`sticky top-0 z-10 bg-white/95 backdrop-blur supports-backdrop-filter:bg-white/80`:``])},[t.$slots.icon?(T(),o(`div`,er,[F(t.$slots,`icon`,{},void 0,!0)])):p(``,!0),l(`div`,tr,[e.title?(T(),o(`h2`,nr,j(e.title),1)):p(``,!0),e.description?(T(),o(`p`,rr,j(e.description),1)):p(``,!0),F(t.$slots,`header`,{},void 0,!0)]),l(`div`,ir,[F(t.$slots,`actions`,{},void 0,!0),e.closable?(T(),u(i,{key:0,text:``,class:`h-9! w-9! min-w-0! p-0!`,onClick:r[0]||=e=>s(`close`)},{default:L(()=>[n($n,{class:`h-4 w-4`})]),_:1})):p(``,!0)])],2)):p(``,!0),l(`div`,{class:a([`flex-1 overflow-auto variable-scroll`,f.value])},[F(t.$slots,`default`,{},void 0,!0)],2),t.$slots.footer?(T(),o(`footer`,{key:1,class:a([`border-t border-slate-200 px-5 py-3`,g(_)?`sticky bottom-0 z-10 bg-white/95 backdrop-blur supports-backdrop-filter:bg-white/80`:``])},[F(t.$slots,`footer`,{},void 0,!0)],2)):p(``,!0)],2)}}}),or=G(ar,[[`__scopeId`,`data-v-5b177938`]]),sr={key:0,class:`flex items-center justify-between px-5 py-3 bg-white border-b border-slate-200 shrink-0`},cr={class:`flex items-center gap-3`},lr={key:0,class:`flex items-center justify-center w-7 h-7 rounded-lg bg-linear-to-br from-purple-500 to-purple-700 text-white transition-transform duration-200 hover:scale-105`},ur={key:1,class:`flex items-center justify-center w-7 h-7 rounded-lg bg-linear-to-br from-purple-500 to-purple-700 text-white transition-transform duration-200 hover:scale-105`},dr={class:`flex-1 min-w-0`},fr={key:0,class:`text-[15px] font-medium text-[#1a1a1a] tracking-tight`},pr={key:1,class:`mt-1 text-sm text-slate-500`},mr={class:`flex items-center gap-2`},hr={key:1,class:`border-t border-slate-200 px-6 py-4`},gr=_({__name:`ModalShell`,props:{modelValue:{type:Boolean},title:{default:void 0},description:{default:void 0},width:{default:`lg`},padding:{default:`md`},closable:{type:Boolean,default:!0},closeOnOverlay:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},verticalAlign:{default:`center`},zIndex:{default:60}},emits:[`update:modelValue`,`close`],setup(e,{emit:i}){let s=e,c=i,_=I(),{modelValue:y,closeOnEsc:b,verticalAlign:x}=r(s),S=O(()=>!!(s.title||s.description||_.header||_.icon||_.actions||s.closable)),w=O(()=>({sm:`max-w-md`,md:`max-w-lg`,lg:`max-w-3xl`,xl:`max-w-4xl`,"2xl":`max-w-5xl`,full:`w-[95vw] h-[95vh]`})[s.width]),E=O(()=>({none:`p-0`,sm:`px-5 py-5`,md:`px-6 py-6`,lg:`px-8 py-8`})[s.padding]),D=()=>{c(`update:modelValue`,!1),c(`close`)},k=()=>{s.closeOnOverlay&&D()};m(()=>{y.value&&document.body.classList.add(`overflow-hidden`)}),v(()=>{document.body.classList.remove(`overflow-hidden`)}),C(()=>y.value,e=>{if(e){document.body.classList.add(`overflow-hidden`);return}document.body.classList.remove(`overflow-hidden`)});let{zIndex:A,closable:M}=r(s);return(r,i)=>(T(),u(t,{to:`body`},[n(h,{name:g(x)===`top`?`slide-up`:`fade`},{default:L(()=>[g(y)?(T(),o(`div`,{key:0,style:f({zIndex:g(A).toString()}),class:a([`fixed inset-0 flex justify-center bg-black/10 backdrop-blur-sm transition`,g(x)===`center`?`items-center`:`items-end`]),onClick:d(k,[`self`])},[l(`div`,{class:a([`modal-shell relative mx-auto flex w-10/12 flex-col overflow-hidden bg-[#fafafa] text-slate-900 shadow-[0_8px_40px_rgba(0,0,0,0.08)]`,w.value,g(x)===`center`?s.width===`full`?`rounded-md border border-slate-200`:`my-auto max-h-[calc(100vh-4rem)] rounded-md border border-slate-200`:`max-h-[85vh] rounded-t-2xl`]),role:`dialog`,"aria-modal":`true`},[S.value?(T(),o(`header`,sr,[l(`div`,cr,[r.$slots.icon?(T(),o(`div`,lr,[F(r.$slots,`icon`,{},void 0,!0)])):e.title?(T(),o(`div`,ur,[n(Wn,{class:`w-4 h-4`})])):p(``,!0),l(`div`,dr,[e.title?(T(),o(`h2`,fr,j(e.title),1)):p(``,!0),e.description?(T(),o(`p`,pr,j(e.description),1)):p(``,!0),F(r.$slots,`header`,{},void 0,!0)])]),l(`div`,mr,[F(r.$slots,`actions`,{},void 0,!0),g(M)?(T(),o(`button`,{key:0,class:`flex items-center justify-center w-7 h-7 rounded-lg text-slate-400 transition-colors duration-200 hover:bg-slate-100 hover:text-slate-700`,onClick:i[0]||=e=>D()},[n($n,{class:`w-4 h-4`})])):p(``,!0)])])):p(``,!0),l(`div`,{class:a([`flex-1 overflow-auto variable-scroll`,E.value])},[F(r.$slots,`default`,{},void 0,!0)],2),r.$slots.footer?(T(),o(`footer`,hr,[F(r.$slots,`footer`,{},void 0,!0)])):p(``,!0)],2)],6)):p(``,!0)]),_:3},8,[`name`])]))}}),_r=G(gr,[[`__scopeId`,`data-v-bfb4b045`]]),vr={},yr={width:`14`,height:`14`,viewBox:`0 0 14 14`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function br(e,t){return T(),o(`svg`,yr,[...t[0]||=[l(`path`,{d:`M3.69653 4.35645L3.29907 4.80566L3.33813 4.97559H4.36157C4.15258 6.18457 3.99633 7.27441 3.69653 8.9541C3.33813 11.0967 3.13207 11.623 3.01 11.8154C2.90258 12.0059 2.74829 12.1045 2.5393 12.1045C2.30981 12.1045 1.89477 11.9229 1.67211 11.7168C1.59204 11.6621 1.49731 11.6758 1.39672 11.7422C1.19555 11.9121 1.00024 12.1738 1.00024 12.4082C0.988519 12.7246 1.41137 13 1.81469 13C2.17016 13 2.6936 12.7773 3.24438 12.2539C3.99731 11.54 4.56079 10.5605 5.03149 8.44336C5.33422 7.0918 5.4768 6.21289 5.68969 4.97656L6.96118 4.86133L7.23657 4.35645H5.80493C6.17504 2.02832 6.46411 1.68359 6.81957 1.68359C7.0559 1.68359 7.33129 1.86523 7.6477 2.22266C7.74145 2.35156 7.88207 2.33789 7.9895 2.25C8.17016 2.14258 8.39282 1.86719 8.40747 1.61719C8.41821 1.3418 8.09008 1 7.52563 1C7.01391 1 6.22973 1.3418 5.57055 2.01367C4.99243 2.62598 4.68969 3.39062 4.48071 4.35645H3.69653ZM7.76489 5.91504C8.15942 5.38965 8.39575 5.21484 8.51782 5.21484C8.64379 5.21484 8.74438 5.33887 8.9602 6.03613L9.32934 7.22656C8.61547 8.31836 8.09301 8.92676 7.77563 8.92676C7.67016 8.92676 7.56372 8.89355 7.48852 8.81934C7.4143 8.74512 7.33227 8.68359 7.25219 8.68359C6.99047 8.68359 6.66625 9.00098 6.66039 9.39453C6.65454 9.7959 6.93579 10.083 7.30493 10.083C7.93872 10.083 8.47485 9.46094 9.51 7.81152L9.81274 8.83203C10.0725 9.70898 10.3772 10.083 10.7581 10.083C11.2288 10.083 11.8616 9.68164 12.552 8.59668L12.2629 8.2666C11.8479 8.7666 11.5725 9.00098 11.4094 9.00098C11.2278 9.00098 11.0686 8.72363 10.8586 8.04199L10.4163 6.60352C10.678 6.21777 10.9358 5.89355 11.1623 5.63477C11.4319 5.32715 11.6399 5.19629 11.7815 5.19629C11.9006 5.19629 12.0041 5.24707 12.0686 5.31836C12.1536 5.41211 12.2043 5.45605 12.3049 5.45605C12.5325 5.45605 12.884 5.16699 12.8967 4.78418C12.9084 4.42871 12.6877 4.12598 12.3049 4.12598C11.7268 4.12598 11.217 4.62402 10.2356 6.08301L10.0334 5.45703C9.75024 4.57812 9.56274 4.12598 9.16821 4.12598C8.70922 4.12598 8.07836 4.69043 7.46118 5.58496L7.76489 5.91504Z`,fill:`#7D838F`},null,-1)]])}var xr=G(vr,[[`render`,br],[`__scopeId`,`data-v-6c4a700e`]]),Sr=_({__name:`Dropdown`,props:{modelValue:{type:Boolean,default:!1},dropdownClass:{default:``},offset:{default:4},placement:{default:`bottom-start`},widthMode:{default:`trigger`}},emits:[`update:modelValue`],setup(r,{expose:s,emit:c}){let p=r,g=c,_=S(null),v=S(null),y=S(p.modelValue),b=S({top:0,left:0,width:0}),x=O(()=>{let e={position:`fixed`,top:`${b.value.top}px`,left:`${b.value.left}px`,zIndex:9999};return p.widthMode===`trigger`&&b.value.width&&(e.width=`${b.value.width}px`),e});C(()=>p.modelValue,e=>{y.value=e,e&&k()}),C(y,e=>{g(`update:modelValue`,e),e&&k()});function E(){y.value=!y.value}function D(){y.value=!1}function k(){if(!_.value)return;let e=_.value.getBoundingClientRect(),t=v.value,n=t?.offsetHeight||0,r=0,i=0;p.placement.startsWith(`bottom`)?r=e.bottom+p.offset:p.placement.startsWith(`top`)&&(r=e.top-n-p.offset),p.placement.endsWith(`start`)?i=e.left:p.placement.endsWith(`end`)&&(i=e.right-(t?.offsetWidth||0));let a=window.innerWidth,o=window.innerHeight,s=t?.offsetWidth||0;i+s>a-10&&(i=a-s-10),i<10&&(i=10),r+n>o-10&&p.placement.startsWith(`bottom`)&&(r=e.top-n-p.offset),r<10&&(r=10),b.value={top:r,left:i,width:e.width}}function A(){y.value&&k()}function j(){y.value&&k()}function M(e){if(!y.value)return;let t=e.target,n=_.value,r=v.value;n&&!n.contains(t)&&r&&!r.contains(t)&&D()}return m(()=>{window.addEventListener(`scroll`,A,!0),window.addEventListener(`resize`,j),document.addEventListener(`mousedown`,M)}),e(()=>{window.removeEventListener(`scroll`,A,!0),window.removeEventListener(`resize`,j),document.removeEventListener(`mousedown`,M)}),s({toggle:E,close:D,updatePosition:k}),(e,s)=>(T(),o(`div`,{ref_key:`triggerRef`,ref:_,class:`relative`},[F(e.$slots,`trigger`,{toggle:E,show:y.value}),(T(),u(t,{to:`body`},[n(h,{"enter-active-class":`transition duration-150 ease-out`,"enter-from-class":`opacity-0 scale-95`,"enter-to-class":`opacity-100 scale-100`,"leave-active-class":`transition duration-100 ease-in`,"leave-from-class":`opacity-100 scale-100`,"leave-to-class":`opacity-0 scale-95`},{default:L(()=>[w(l(`div`,{ref_key:`dropdownRef`,ref:v,class:a([`absolute rounded-lg border border-slate-200 bg-white shadow-xl`,r.dropdownClass]),style:f(x.value),onMousedown:s[0]||=d(()=>{},[`prevent`])},[F(e.$slots,`default`,{close:D})],38),[[i,y.value]])]),_:3})]))],512))}});function Cr(e){return{id:e.id,type:e.type||`custom`,label:e.data?.label||e.label,position:e.position,data:e.data||{},parentNode:e.parentNode}}function wr(e){return{id:e.id,source:e.source,sourceHandle:e.sourceHandle||void 0,target:e.target,targetHandle:e.targetHandle||void 0,data:e.data||{}}}function Tr(e,t,n,r){let i=t.map(Cr),a=n.map(wr);return tn(e,i,a,void 0,r)}function Er(){let e=Yn(),t=Jt(),n=Vt(),{selectedNodeId:r}=V(e),i=O(()=>{if(!r.value)return null;try{let e=t.nodes||[],i=t.edges||[],a=n.getGlobalVariableJson();return console.log(`[useVariableContext] æå–å˜é‡`,e,i),Tr(r.value,e,i,a)}catch(e){return console.error(`[useVariableContext] æå–å˜é‡ä¸Šä¸‹æ–‡å¤±è´¥:`,e),null}}),a=O(()=>i.value?.tree||[]),o=O(()=>i.value?.map||new Map);return{variableContext:i,variableTree:a,contextMap:o}}var Dr=[`innerHTML`],Or={key:1,class:`p-3 bg-white/90 border border-slate-200 rounded-md shadow-sm`},kr=[`innerHTML`],Ar=_({__name:`VariablePreview`,props:{value:{},currentItemIndex:{default:void 0},inline:{type:Boolean,default:!1}},setup(e){let t=e,{contextMap:n}=Er(),r=O(()=>{let e=t.value;if(!e||typeof e!=`string`||!/\{\{\s*\$?[^{}]+?\s*\}\}/.test(e)||!n.value||n.value.size===0)return``;try{let r=nn({preview:e},n.value).preview;return r===e?``:t.currentItemIndex!==void 0&&Array.isArray(r)&&r[t.currentItemIndex]!==void 0?s(r[t.currentItemIndex]):s(r)}catch(e){return`è§£æžé”™è¯¯: ${e}`}}),i=O(()=>{let e=t.value;if(!e||typeof e!=`string`||!/\{\{\s*\$?[^{}]+?\s*\}\}/.test(e)||!n.value||n.value.size===0)return``;try{return a(e,n.value,t.currentItemIndex)}catch(e){return c(`è§£æžé”™è¯¯: ${e}`)}});function a(e,t,n){let r=/\{\{\s*\$?[^{}]+?\s*\}\}/g,i=0,a=``,o;for(;(o=r.exec(e))!==null;){let r=o[0],l=o.index;a+=c(e.slice(i,l));let u=nn({temp:r},t),d;d=n!==void 0&&Array.isArray(u.temp)?s(u.temp[n]):s(u.temp),a+=`<span class="inline-flex items-baseline mx-[1px] bg-indigo-100/80 text-[12px] font-medium text-indigo-700 shadow-sm" title="${c(r)}">${c(d)}</span>`,i=l+r.length}return a+=c(e.slice(i)),a}function s(e){if(e==null)return``;if(typeof e==`object`)try{return JSON.stringify(e,null,2)}catch{return String(e)}return String(e)}function c(e){return e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/"/g,`&quot;`).replace(/'/g,`&#39;`)}return(t,n)=>e.inline&&r.value?(T(),o(`div`,{key:0,class:`text-xs text-slate-700 font-mono whitespace-pre-wrap wrap-break-word`,innerHTML:i.value},null,8,Dr)):!e.inline&&r.value?(T(),o(`div`,Or,[n[0]||=l(`div`,{class:`flex items-center justify-between mb-2`},[l(`span`,{class:`text-[10px] font-semibold tracking-wide text-slate-500`},`å®žæ—¶é¢„è§ˆ`),l(`span`,{class:`text-[9px] text-slate-400`},`å·²è§£æžå˜é‡`)],-1),l(`div`,{class:`text-xs text-slate-700 font-mono whitespace-pre-wrap wrap-break-word max-h-32 overflow-y-auto variable-scroll`,innerHTML:i.value},null,8,kr)])):p(``,!0)}}),jr={class:`pointer-events-none flex items-center justify-center w-7 text-gray-600 rounded-l-md shrink-0 border-r border-gray-200`,style:{"background-color":`#f1f3f9`}},Mr={class:`relative flex-1 min-w-0`},Nr={class:`w-5 h-8 pt-3`},Pr={key:0,class:`overflow-hidden`},Fr={class:`flex items-center justify-between border-b border-slate-100 bg-slate-50/90 px-2 py-1.5`},Ir={class:`flex items-center gap-1 text-[10px] text-slate-500`},Lr=[`value`,`disabled`],Rr=[`disabled`],zr=[`disabled`],Br={class:`max-h-56 overflow-y-auto variable-scroll px-2 py-2`},Vr={key:1,class:`text-xs text-slate-400`},Hr={key:0,class:`border-t border-slate-100 bg-slate-50 px-2 py-1.5`},Ur={key:2,class:`text-[10px] leading-tight text-slate-400 px-1`},Wr=`â€‹`,Gr=`\\{\\{\\s*[^{}]+?\\s*\\}\\}`,Kr=`<span data-cursor-anchor="true" style="display:inline-block;width:1px;">&#8203;</span>`,qr=_({inheritAttrs:!1,__name:`VariableTextInput`,props:{modelValue:{default:``},placeholder:{default:``},rows:{default:1},multiline:{type:Boolean,default:!1},previewMode:{default:`bottom`},density:{default:`default`},showBorder:{type:Boolean,default:!1},showTip:{type:Boolean,default:!0}},emits:[`update:modelValue`],setup(e,{emit:t}){let r=e,i=t,s=S(null),c=S(F(r.modelValue)),f=S(!1),m=S(0),h=S(`0`),g=S(!1),_=!1,v=S(!1),y=new RegExp(Wr,`g`),b=RegExp(`^${Gr}`),x=RegExp(`${Gr}$`),w=Yn(),{selectedNodeId:E}=V(w),{contextMap:D}=Er(),k=O(()=>!c.value&&r.placeholder);C(()=>r.modelValue,e=>{let t=F(e);t!==c.value&&(c.value=t,ie(t,!1))}),C(s,e=>{e&&ie(c.value,!1)},{flush:`post`});let A=O(()=>{let e=c.value;return!e||typeof e!=`string`?!1:/\{\{\s*[^{}]+?\s*\}\}/.test(e)}),M=O(()=>{let e=c.value;if(!e)return[];if(!A.value||!E.value||!D.value||D.value.size===0)return[e];try{let t=nn({preview:e},D.value).preview;return Array.isArray(t)?t:t==null?[]:[t]}catch{return[`è§£æžé”™è¯¯`]}}),N=O(()=>M.value.length>1&&m.value>0),P=O(()=>M.value.length>1&&m.value<M.value.length-1);C(M,e=>{if(!e.length){m.value=0,h.value=`0`;return}m.value>e.length-1&&(m.value=e.length-1),h.value=String(m.value+1)},{immediate:!0}),C(m,e=>{if(!M.value.length){h.value=`0`;return}h.value=String(e+1)});function F(e){return e==null?``:String(e)}function I(){g.value=!0,r.previewMode===`dropdown`&&(m.value=0,f.value=!0)}function R(){g.value=!1}function z(e){if(!s.value)return;let t=e.target;v.value=t===s.value||t?.dataset.cursorAnchor===`true`}function B(){s.value&&(v.value&&=(K()===0&&c.value&&oe(c.value.length),!1))}function H(){m.value<=0||--m.value}function W(){m.value>=M.value.length-1||(m.value+=1)}function te(e){if(!M.value.length){h.value=`0`;return}h.value=e.target.value.replace(/[^0-9]/g,``)}function G(){if(!M.value.length){h.value=`0`;return}let e=h.value.trim();if(!e){h.value=String(m.value+1);return}let t=M.value.length,n=Number(e);if(Number.isNaN(n)){h.value=String(m.value+1);return}let r=Math.min(Math.max(Math.floor(n),1),t);m.value=r-1,h.value=String(r)}function re(e){e.key===`Enter`&&(e.preventDefault(),G())}function ie(e,t=!1){let n=s.value;if(!n)return;let r=null;t&&(r=K());let i=me(e)||``;n.innerHTML!==i&&(n.innerHTML=i),t&&r!==null&&oe(r)}function ae(e){return e.textContent?.replace(/\u00a0/g,` `).replace(/\u200B/g,``)??``}function K(){let e=s.value;if(!e)return null;let t=window.getSelection();if(!t||t.rangeCount===0)return null;let n=t.getRangeAt(0);if(!e.contains(n.endContainer))return null;let r=n.cloneRange();return r.selectNodeContents(e),r.setEnd(n.endContainer,n.endOffset),r.toString().replace(y,``).length}function oe(e){let t=s.value;if(!t)return;let n=window.getSelection();if(!n)return;let r=ae(t),i=Math.max(0,Math.min(e,r.length)),a=document.createTreeWalker(t,NodeFilter.SHOW_TEXT),o=a.nextNode(),c=0;for(;o;){let e=o.textContent?.length??0;if(c+e>=i){let e=i-c,t=document.createRange();t.setStart(o,e),t.collapse(!0),n.removeAllRanges(),n.addRange(t);return}c+=e,o=a.nextNode()}let l=document.createRange();l.selectNodeContents(t),l.collapse(!1),n.removeAllRanges(),n.addRange(l)}function se(){if(!s.value||_)return;let e=ae(s.value);e!==c.value&&(c.value=e,i(`update:modelValue`,e),_=!0,ie(e,!0),_=!1)}function ce(e){e.preventDefault();let t=e.clipboardData?.getData(`text/plain`)||``;J(t),se()}function q(e){if(e.key===`Enter`){if(e.preventDefault(),!r.multiline)return;J(`
`),se();return}e.key===`Backspace`&&le(e,`backward`)||e.key===`Delete`&&le(e,`forward`)}function le(e,t){if(!s.value)return!1;let n=window.getSelection();if(!n||n.rangeCount===0)return!1;let r=n.getRangeAt(0),i=c.value;if(!r.collapsed){let t=de(r,`start`),n=de(r,`end`);if(t===null||n===null)return!1;let{start:a,end:o}=fe(i,t,n);return a===o?!1:(e.preventDefault(),ue(i.slice(0,a)+i.slice(o),a),!0)}let a=K();if(a===null)return!1;if(t===`backward`){if(a===0)return!1;let t=i.slice(0,a).match(x);if(t){let n=t[0],r=a-n.length;return e.preventDefault(),ue(i.slice(0,r)+i.slice(a),r),!0}}else{let t=i.slice(a).match(b);if(t){let n=t[0],r=a+n.length;return e.preventDefault(),ue(i.slice(0,a)+i.slice(r),a),!0}}let o=new RegExp(Gr,`g`),l;for(;(l=o.exec(i))!==null;){let n=l.index,r=n+l[0].length;if(t===`backward`&&a>n&&a<=r||t===`forward`&&a>=n&&a<r)return e.preventDefault(),ue(i.slice(0,n)+i.slice(r),n),!0}return!1}function ue(e,t){c.value=e,i(`update:modelValue`,e),ie(e,!1),oe(t)}function de(e,t){let n=s.value;if(!n)return null;let r=e.cloneRange();return r.selectNodeContents(n),t===`start`?r.setEnd(e.startContainer,e.startOffset):r.setEnd(e.endContainer,e.endOffset),r.toString().replace(y,``).length}function fe(e,t,n){if(t===n)return{start:t,end:n};let r=new RegExp(Gr,`g`),i,a=t,o=n;for(;(i=r.exec(e))!==null;){let e=i.index,t=e+i[0].length;e<a&&t>a&&(a=e),e<o&&t>o&&(o=t)}return{start:a,end:o}}function pe(e){if(!s.value)return;let t=e.detail;if(!t?.reference)return;let n=t.reference.trim();n&&(J(n),se())}function J(e){let t=s.value;if(!t)return;let n=window.getSelection();if(!n)return;if(n.rangeCount===0){t.appendChild(document.createTextNode(e));return}let r=n.getRangeAt(0);t.contains(r.startContainer)||(r.selectNodeContents(t),r.collapse(!1)),r.deleteContents();let i=document.createTextNode(e);r.insertNode(i);let a=document.createRange();a.setStart(i,i.length),a.collapse(!0),n.removeAllRanges(),n.addRange(a)}function me(e){if(!e)return Wr;let t=new RegExp(Gr,`g`);t.lastIndex=0;let n=0,r=``,i;for(;(i=t.exec(e))!==null;){let t=i[0],a=i.index;r+=Y(e.slice(n,a)),r+=`<span class="variable-token">${Y(t)}</span>`,n=a+t.length}return r+=Y(e.slice(n)),r+Kr}function Y(e){return e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/"/g,`&quot;`).replace(/'/g,`&#39;`)}function he(){w.openVariableEditorModal(c.value,e=>{c.value=e,i(`update:modelValue`,e),ie(e,!1)})}return(t,r)=>(T(),o(`div`,ee(t.$attrs,{class:`space-y-2`}),[e.previewMode===`top`&&g.value?(T(),u(Ar,{key:0,value:c.value},null,8,[`value`])):p(``,!0),n(Sr,{modelValue:f.value,"onUpdate:modelValue":r[0]||=e=>f.value=e,"width-mode":e.previewMode===`dropdown`?`trigger`:`auto`,placement:`bottom-start`,offset:4},{trigger:L(()=>[l(`div`,{class:a([`variable-text-input`,`relative flex items-stretch h-full rounded-md border transition-all duration-200`,e.showBorder?`border-dashed border-red-600`:g.value?`border-slate-400 ring-2 ring-slate-200`:`border-slate-200`])},[l(`div`,jr,[n(xr,{class:`w-4 h-4`})]),l(`div`,Mr,[k.value?(T(),o(`span`,{key:0,class:a([`pointer-events-none absolute select-none text-slate-400`,e.density===`compact`?`left-2 top-1 text-xs`:`left-2 top-2 text-sm`])},j(e.placeholder),3)):p(``,!0),l(`div`,{ref_key:`editorRef`,ref:s,contenteditable:`true`,class:a([`w-full cursor-text font-mono text-slate-700 bg-white outline-none wrap-break-word`,e.density===`compact`?`text-xs`:`text-sm`,`px-2`,e.multiline?e.density===`compact`?`py-1 min-h-12 max-h-52 overflow-y-auto variable-scroll whitespace-pre-wrap resize-y`:`py-2 min-h-16 max-h-60 overflow-y-auto variable-scroll whitespace-pre-wrap resize-y`:e.density===`compact`?`h-7 flex items-center overflow-hidden whitespace-nowrap resize-none`:`h-8 flex items-center overflow-hidden whitespace-nowrap resize-none`]),onInput:se,onVariableDrop:pe,onPaste:ce,onKeydown:q,onFocus:I,onBlur:R,onMousedown:z,onMouseup:B},null,34)]),l(`div`,Nr,[l(`button`,{type:`button`,class:`flex items-center justify-center w-full h-full border-l rounded-tl-md border-t border-slate-200 bg-white text-slate-500 transition-colors hover:border-slate-300 hover:text-slate-700 hover:bg-slate-100 rounded-r-md shrink-0`,onClick:d(he,[`stop`]),title:`æ‰“å¼€å˜é‡ç¼–è¾‘å™¨`},[n(Jn,{class:`h-3 w-3`})])])],2)]),default:L(()=>[e.previewMode===`dropdown`?(T(),o(`div`,Pr,[l(`div`,Fr,[r[2]||=l(`div`,{class:`text-[10px] font-semibold uppercase tracking-wide text-slate-500`},` Result `,-1),l(`div`,Ir,[r[1]||=l(`span`,{class:`font-medium`},`Page`,-1),l(`input`,{value:h.value,type:`text`,inputmode:`numeric`,pattern:`[0-9]*`,placeholder:`0`,disabled:!M.value.length,class:`h-5 w-7 rounded bg-white px-1 text-center text-[10px] font-medium text-slate-600 shadow-inner ring-1 ring-inset ring-slate-200 transition focus:outline-none focus:ring-2 focus:ring-slate-300 disabled:bg-slate-100 disabled:text-slate-400`,onInput:te,onBlur:G,onKeydown:re},null,40,Lr),l(`span`,null,`/ `+j(M.value.length||0),1),l(`button`,{type:`button`,class:`flex h-5 w-5 items-center justify-center text-slate-400 transition-colors hover:text-slate-700 disabled:cursor-not-allowed disabled:text-slate-300`,disabled:!N.value,"aria-label":`ä¸Šä¸€é¡µ`,onClick:d(H,[`stop`])},[n(ne,{class:`h-3 w-3 -rotate-180`})],8,Rr),l(`button`,{type:`button`,class:`flex h-5 w-5 items-center justify-center text-slate-400 transition-colors hover:text-slate-700 disabled:cursor-not-allowed disabled:text-slate-300`,disabled:!P.value,"aria-label":`ä¸‹ä¸€é¡µ`,onClick:d(W,[`stop`])},[n(ne,{class:`h-3 w-3`})],8,zr)])]),l(`div`,Br,[M.value.length?(T(),u(Ar,{key:0,value:c.value,"current-item-index":m.value,inline:``},null,8,[`value`,`current-item-index`])):(T(),o(`p`,Vr,[...r[3]||=[l(`span`,{class:`font-mono bg-gray-100`},`[empty]`,-1)]]))]),e.showTip?(T(),o(`div`,Hr,[...r[4]||=[l(`p`,{class:`text-[10px] leading-tight text-slate-400`},[U(` Tip: æ”¯æŒæ‹–æ‹½å˜é‡æ’å…¥ï¼Œå˜é‡ä»¥ `),l(`span`,{class:`font-mono text-emerald-600`},`{{ èŠ‚ç‚¹å.å­—æ®µ }}`),U(` å½¢å¼è¡¨ç¤º `)],-1)]])):p(``,!0)])):p(``,!0)]),_:1},8,[`modelValue`,`width-mode`]),e.previewMode===`bottom`&&g.value?(T(),u(Ar,{key:1,value:c.value},null,8,[`value`])):p(``,!0),e.previewMode!==`dropdown`&&g.value&&e.showTip?(T(),o(`p`,Ur,[...r[5]||=[U(` Tip: æ”¯æŒæ‹–æ‹½å˜é‡æ’å…¥ï¼Œå˜é‡ä»¥ `,-1),l(`span`,{class:`font-mono text-emerald-600`},`{{ èŠ‚ç‚¹å.å­—æ®µ }}`,-1),U(` å½¢å¼è¡¨ç¤º `,-1)]])):p(``,!0)],16))}}),Jr={class:`config-field mb-4`},Yr={key:0,class:`mb-2 block text-sm font-medium text-slate-700`},Xr={key:0,class:`text-red-500`},Zr={key:1,class:`mb-2 text-xs text-slate-500`},Qr={class:`field-input`},$r={key:10,class:`text-sm text-red-500`},ei={key:2,class:`mt-1 text-xs text-red-500`},ti=_({__name:`ConfigField`,props:{field:{},modelValue:{},isDraggingVariable:{type:Boolean}},emits:[`update:modelValue`],setup(e,{emit:t}){let r=e,i=t,a=S(``),s=O(()=>on(r.modelValue)||r.isDraggingVariable);function c(e){let t=g(e);a.value=t,t||i(`update:modelValue`,e)}function d(e){try{let t=JSON.parse(e);a.value=``,i(`update:modelValue`,t)}catch{a.value=`JSON æ ¼å¼é”™è¯¯`}}function f(e){let t=e.file;i(`update:modelValue`,t)}function m(e){if(!e)return``;try{return JSON.stringify(e,null,2)}catch{return String(e)}}function h(e){return r.field.validation?.find(t=>t.type===e)?.value}function g(e){let{field:t}=r;if(t.required&&(e==null||e===``))return`${t.label} ä¸ºå¿…å¡«é¡¹`;if(t.validation)for(let n of t.validation){let t=_(n,e);if(t)return t}return``}function _(e,t){switch(e.type){case`min`:if(typeof t==`number`&&t<e.value)return`æœ€å°å€¼ä¸º ${e.value}`;if(typeof t==`string`&&t.length<e.value)return`æœ€å°‘è¾“å…¥ ${e.value} ä¸ªå­—ç¬¦`;break;case`max`:if(typeof t==`number`&&t>e.value)return`æœ€å¤§å€¼ä¸º ${e.value}`;if(typeof t==`string`&&t.length>e.value)return`æœ€å¤šè¾“å…¥ ${e.value} ä¸ªå­—ç¬¦`;break;case`url`:try{new URL(t)}catch{return`è¯·è¾“å…¥æœ‰æ•ˆçš„ URL`}break;case`email`:if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return`è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€`;break;case`pattern`:if(e.value&&!new RegExp(e.value).test(t))return e.message||`æ ¼å¼ä¸æ­£ç¡®`;break;default:break}return``}return C(()=>r.modelValue,()=>{a.value=``}),(t,r)=>{let i=D(`n-input-number`),g=D(`n-select`),_=D(`n-switch`),v=D(`n-checkbox`),y=D(`n-space`),b=D(`n-checkbox-group`),x=D(`n-radio`),S=D(`n-radio-group`),C=D(`n-color-picker`),w=D(`n-button`),E=D(`n-upload`);return T(),o(`div`,Jr,[e.field.label?(T(),o(`label`,Yr,[U(j(e.field.label)+` `,1),e.field.required?(T(),o(`span`,Xr,`*`)):p(``,!0)])):p(``,!0),e.field.description?(T(),o(`p`,Zr,j(e.field.description),1)):p(``,!0),l(`div`,Qr,[[`input`,`textarea`].includes(e.field.type)||s.value?(T(),o(A,{key:0},[e.field.type===`textarea`?(T(),u(qr,{key:0,"model-value":e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,multiline:!0,"show-border":e.isDraggingVariable,"preview-mode":`bottom`,"onUpdate:modelValue":c},null,8,[`model-value`,`placeholder`,`disabled`,`show-border`])):(T(),u(qr,{key:1,"model-value":e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,multiline:!1,"show-border":e.isDraggingVariable,"preview-mode":`bottom`,"onUpdate:modelValue":c},null,8,[`model-value`,`placeholder`,`disabled`,`show-border`]))],64)):e.field.type===`number`?(T(),u(i,{key:1,value:e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,min:h(`min`),max:h(`max`),step:h(`step`)||1,class:`w-full`,"onUpdate:value":c},null,8,[`value`,`placeholder`,`disabled`,`min`,`max`,`step`])):e.field.type===`select`?(T(),u(g,{key:2,value:e.modelValue,options:e.field.options,placeholder:e.field.placeholder,disabled:e.field.disabled,"onUpdate:value":c},null,8,[`value`,`options`,`placeholder`,`disabled`])):e.field.type===`switch`?(T(),u(_,{key:3,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":c},null,8,[`value`,`disabled`])):e.field.type===`checkbox`?(T(),u(b,{key:4,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":c},{default:L(()=>[n(y,{vertical:``},{default:L(()=>[(T(!0),o(A,null,P(e.field.options,e=>(T(),u(v,{key:e.value,value:e.value,label:e.label},null,8,[`value`,`label`]))),128))]),_:1})]),_:1},8,[`value`,`disabled`])):e.field.type===`radio`?(T(),u(S,{key:5,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":c},{default:L(()=>[n(y,{vertical:``},{default:L(()=>[(T(!0),o(A,null,P(e.field.options,e=>(T(),u(x,{key:e.value,value:e.value,label:e.label},null,8,[`value`,`label`]))),128))]),_:1})]),_:1},8,[`value`,`disabled`])):e.field.type===`color`?(T(),u(C,{key:6,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":c},null,8,[`value`,`disabled`])):e.field.type===`file`?(T(),u(E,{key:7,disabled:e.field.disabled,onChange:f},{default:L(()=>[n(w,{secondary:``},{default:L(()=>[...r[0]||=[U(`é€‰æ‹©æ–‡ä»¶`,-1)]]),_:1})]),_:1},8,[`disabled`])):e.field.type===`json-editor`?(T(),u(qr,{key:8,"model-value":m(e.modelValue),placeholder:e.field.placeholder||`è¾“å…¥ JSON æ•°æ®...`,disabled:e.field.disabled,multiline:!0,"preview-mode":`bottom`,"onUpdate:modelValue":d},null,8,[`model-value`,`placeholder`,`disabled`])):e.field.type===`code-editor`?(T(),u(qr,{key:9,"model-value":e.modelValue,placeholder:e.field.placeholder||`è¾“å…¥ä»£ç ...`,disabled:e.field.disabled,multiline:!0,"preview-mode":`bottom`,"onUpdate:modelValue":c},null,8,[`model-value`,`placeholder`,`disabled`])):(T(),o(`div`,$r,` ä¸æ”¯æŒçš„å­—æ®µç±»åž‹: `+j(e.field.type),1))]),a.value?(T(),o(`div`,ei,j(a.value),1)):p(``,!0)])}}}),ni=G(ti,[[`__scopeId`,`data-v-35e9b26e`]]),ri={},ii={t:`1762602673971`,class:`icon`,viewBox:`0 0 1024 1024`,version:`1.1`,xmlns:`http://www.w3.org/2000/svg`,"p-id":`4550`,width:`200`,height:`200`};function ai(e,t){return T(),o(`svg`,ii,[...t[0]||=[l(`path`,{d:`M219.428571 585.142857c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142858-73.142857-36.571429-73.142857-73.142858-73.142857z m585.142858-146.285714c36.571429 0 73.142857-36.571429 73.142857-73.142857s-36.571429-73.142857-73.142857-73.142857-73.142857 36.571429-73.142858 73.142857 36.571429 73.142857 73.142858 73.142857zM219.428571 292.571429c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142858-73.142857-36.571429-73.142857-73.142858-73.142857z m585.142858 292.571428c-36.571429 0-73.142857 36.571429-73.142858 73.142857s36.571429 73.142857 73.142858 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857zM512 292.571429c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857z m0 292.571428c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857z`,"p-id":`4551`},null,-1)]])}var oi=G(ri,[[`render`,ai]]),si={},ci={t:`1762602894224`,class:`icon`,viewBox:`0 0 1024 1024`,version:`1.1`,xmlns:`http://www.w3.org/2000/svg`,"p-id":`6340`,stroke:`currentColor`,fill:`currentColor`};function li(e,t){return T(),o(`svg`,ci,[...t[0]||=[l(`path`,{d:`M457.941333 844.373333a32 32 0 1 0 44.117334-46.293333L235.349333 544H864a32 32 0 0 0 0-64H235.349333l266.709334-254.08a32 32 0 0 0-44.117334-46.336l-316.586666 301.525333a42.453333 42.453333 0 0 0-12.8 24.746667 32.128 32.128 0 0 0 0.042666 12.330667 42.453333 42.453333 0 0 0 12.8 24.704l316.544 301.525333z`,"p-id":`6341`},null,-1)]])}var ui=G(si,[[`render`,li]]),di={class:`split-layout fixed inset-0 bg-black/30 backdrop-blur-sm overflow-hidden`},fi={class:`flex h-full px-10 py-6`,style:{"min-width":`0`,"max-width":`100vw`,overflow:`hidden`}},pi={class:`h-full overflow-auto variable-scroll`},mi={class:`bg-white rounded-md px-3 py-1 flex items-center justify-center border border-slate-200`},hi={class:`w-full h-full rounded-lg overflow-hidden bg-white flex flex-col`},gi={key:0,class:`shrink-0 border-b border-slate-200 bg-white px-6 py-3 rounded-t-lg`},_i={key:0,class:`text-base font-semibold text-slate-900`},vi={class:`flex-1 h-full overflow-auto variable-scroll`},yi={class:`h-full overflow-auto variable-scroll`},bi=_({__name:`SplitLayout`,props:{leftWidth:{default:void 0},rightWidth:{default:void 0},centerWidth:{default:400},minLeftWidth:{default:200},minRightWidth:{default:200},centerTitle:{default:void 0},showBackButton:{type:Boolean,default:!0},backText:{default:`Back to canvas`}},emits:[`back`,`resize`],setup(e,{emit:t}){let r=e,i=t,s=S(),u=S(),d=S(),h=S(),g=S(),_=()=>g.value?g.value.clientWidth:window.innerWidth-80,y=e=>e<=1,b=(e,t)=>y(e)?t*e:e,x=()=>{let e=_();return b(r.centerWidth,e)},C=()=>{let e=_(),t=x(),n=e-t;return b(r.minLeftWidth,n)},w=()=>{let e=_(),t=x(),n=e-t;return b(r.minRightWidth,n)},E=()=>{let e=_(),t=x(),n=e-t;if(r.leftWidth!==void 0&&r.rightWidth!==void 0){let e=b(r.leftWidth,n),t=b(r.rightWidth,n);return{left:e,right:t}}let i=C(),a=Math.max(i,Math.floor(n/2));return{left:a,right:n-a}},D=S(0),k=S(0),A=S(!1),M=S(0),N=()=>{if(!g.value)return;let e=g.value.clientWidth,t=x(),n=e-t,r=C(),i=w();M.value=Math.max(r,n-i)},P=()=>{let e=E();D.value=e.left,k.value=e.right,N()},ee=O(()=>{let e=C();return{width:`${Math.max(e,Math.min(D.value,M.value))}px`,minWidth:`${e}px`,maxWidth:`${M.value}px`}}),I=O(()=>{let e=x();return{width:`${e}px`,minWidth:`${e}px`,maxWidth:`${e}px`}}),L=O(()=>({minWidth:`${w()}px`})),R=S(!1),z=0,B=0,V=0,H=e=>{e.preventDefault(),e.stopPropagation(),N(),R.value=!0,z=e.clientX,B=D.value,V=k.value,document.addEventListener(`mousemove`,U),document.addEventListener(`mouseup`,W),document.body.style.cursor=`col-resize`,document.body.style.userSelect=`none`},U=e=>{if(!R.value||(e.preventDefault(),e.stopPropagation(),!g.value))return;let t=e.clientX-z,n=g.value.clientWidth,r=x(),a=n-r,o=B+t,s=V-t,c=C(),l=w();o=Math.max(c,Math.min(M.value,o));let u=a-c;s=Math.max(l,Math.min(u,s)),o+s>a&&(s=a-o,s<l&&(s=l,o=Math.max(c,a-s))),D.value=Math.round(o),k.value=Math.round(s),i(`resize`,{leftWidth:D.value,rightWidth:k.value})},W=e=>{if(R.value&&(R.value=!1,document.removeEventListener(`mousemove`,U),document.removeEventListener(`mouseup`,W),document.body.style.cursor=``,document.body.style.userSelect=``,e&&d.value)){let t=d.value.getBoundingClientRect(),n=e.clientY;n>=t.top&&n<=t.top+50&&(A.value=!0)}},te=()=>{i(`back`)},G=null,re=``;return m(async()=>{if(re=document.body.style.overflow,document.body.style.overflow=`hidden`,await c(),N(),r.leftWidth!==void 0&&r.rightWidth!==void 0){let e=_(),t=x(),n=e-t;D.value=b(r.leftWidth,n),k.value=b(r.rightWidth,n)}else P();G=()=>{if(N(),r.leftWidth!==void 0&&r.rightWidth!==void 0){let e=_(),t=x(),n=e-t;if(y(r.leftWidth)||y(r.rightWidth))D.value=b(r.leftWidth,n),k.value=b(r.rightWidth,n);else{let e=C(),t=w(),r=D.value+k.value;if(r>n){let i=n/r;D.value=Math.max(e,Math.min(M.value,Math.round(D.value*i))),k.value=Math.max(t,Math.round(k.value*i))}}}else{let e=_(),t=x(),n=e-t,r=D.value+k.value,i=C(),a=w();if(r>n){let e=n/r;D.value=Math.max(i,Math.min(M.value,Math.round(D.value*e))),k.value=Math.max(a,Math.round(k.value*e))}}},window.addEventListener(`resize`,G)}),v(()=>{W(),G&&window.removeEventListener(`resize`,G),document.body.style.overflow=re}),(t,r)=>(T(),o(`div`,di,[e.showBackButton?(T(),o(`button`,{key:0,class:`absolute left-5 top-0 z-50 flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-white/90 hover:text-white`,onClick:te},[r[2]||=l(`svg`,{class:`h-4 w-4`,fill:`none`,stroke:`currentColor`,"stroke-width":`2`,viewBox:`0 0 24 24`},[l(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,d:`M15 19l-7-7 7-7`})],-1),l(`span`,null,j(e.backText),1)])):p(``,!0),l(`div`,fi,[l(`div`,{ref_key:`containerRef`,ref:g,class:`flex w-full h-full`},[l(`div`,{ref_key:`leftPanelRef`,ref:s,class:`overflow-hidden bg-white border-r border-slate-200 my-6 rounded-l-lg shrink-0`,style:f(ee.value)},[l(`div`,pi,[F(t.$slots,`left`)])],4),l(`div`,{ref_key:`centerPanelRef`,ref:d,class:`relative flex flex-col h-full shrink-0 shadow-lg z-10`,style:f(I.value),onMouseenter:r[0]||=e=>A.value=!0,onMouseleave:r[1]||=e=>A.value=!1},[l(`div`,{class:a([`absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 -z-5 transition-opacity duration-200`,A.value||R.value?`opacity-100`:`opacity-0`])},[l(`div`,{ref_key:`dragHandleRef`,ref:h,class:`group cursor-col-resize flex items-center gap-2 pointer-events-auto`,onMousedown:H},[l(`div`,{class:a([`flex items-center transition-opacity duration-200 opacity-0 group-hover:opacity-100 -translate-y-2 scale-75`,R.value&&`opacity-100`])},[n(ui,{class:`w-4 h-4 text-white`})],2),l(`div`,mi,[n(oi,{class:`w-14 h-5 scale-110 -translate-y-0.5 text-slate-400`})]),l(`div`,{class:a([`flex items-center transition-opacity duration-200 opacity-0 group-hover:opacity-100 -translate-y-2 scale-75`,R.value&&`opacity-100`])},[n(ne,{class:`w-4 h-4 text-white`})],2)],544)],2),l(`div`,hi,[e.centerTitle||t.$slots.centerHeader?(T(),o(`div`,gi,[F(t.$slots,`centerHeader`,{},()=>[e.centerTitle?(T(),o(`h2`,_i,j(e.centerTitle),1)):p(``,!0)])])):p(``,!0),l(`div`,vi,[F(t.$slots,`center`)])])],36),l(`div`,{ref_key:`rightPanelRef`,ref:u,class:`overflow-hidden bg-white border-l border-slate-200 my-6 rounded-r-lg flex-1 min-w-0`,style:f(L.value)},[l(`div`,yi,[F(t.$slots,`right`)])],4)],512)])]))}}),xi=[`onClick`],Si=_({name:`ToggleButtonGroup`,props:{options:{},modelValue:{},size:{}},emits:[`update:modelValue`],setup(e,{emit:t}){let n=e,r=t,i=S(null),s=S(new Map),d=O(()=>{switch(n.size??`md`){case`sm`:return`h-6`;case`lg`:return`h-8`;default:return`h-7`}}),h=O(()=>{switch(n.size??`md`){case`sm`:return`h-5`;case`lg`:return`h-7`;default:return`h-6`}}),g=O(()=>{switch(n.size??`md`){case`sm`:return`px-2 py-0.5`;case`lg`:return`px-3 py-1.5`;default:return`px-2.5 py-1`}}),_=O(()=>{switch(n.size??`md`){case`sm`:return`text-[11px]`;case`lg`:return`text-sm`;default:return`text-xs`}}),v=O(()=>{switch(n.size??`md`){case`sm`:return`h-3 w-3`;case`lg`:return`h-4 w-4`;default:return`h-3.5 w-3.5`}}),y=O(()=>{let e=s.value.get(n.modelValue);if(!e||!i.value)return{width:`0px`,left:`0px`,opacity:0};let t=i.value.getBoundingClientRect(),r=e.getBoundingClientRect();return{width:`${r.width}px`,left:`${r.left-t.left}px`,opacity:1}}),x=e=>{r(`update:modelValue`,e)},w=(e,t)=>{if(Array.isArray(e)){let n=e[0];n?s.value.set(t,n):s.value.delete(t)}else e?s.value.set(t,e):s.value.delete(t)};return C(()=>n.modelValue,async()=>{await c()}),m(async()=>{await c()}),(t,n)=>(T(),o(`div`,{ref_key:`containerRef`,ref:i,class:a([`relative flex items-center bg-slate-200 rounded-md p-0.5`,d.value])},[l(`div`,{class:a([`absolute bg-white rounded transition-all duration-200 ease-out`,h.value]),style:f(y.value)},null,6),(T(!0),o(A,null,P(e.options,t=>(T(),o(`button`,{key:t.value,ref_for:!0,ref:e=>w(e,t.value),onClick:e=>x(t.value),class:a([`relative z-10 font-medium rounded transition-all flex items-center gap-1.5`,g.value,_.value,e.modelValue===t.value?`text-slate-900`:`text-slate-500`])},[t.icon?(T(),u(b(t.icon),{key:0,class:a(v.value)},null,8,[`class`])):p(``,!0),U(` `+j(t.label),1)],10,xi))),128))],2))}});export{Y as C,Se as S,pe as T,Jt as _,Ar as a,Q as b,_r as c,Jn as d,Wn as f,nn as g,ln as h,qr as i,or as l,dn as m,bi as n,Er as o,Bn as p,ni as r,Sr as s,Si as t,Yn as u,Vt as v,Te as w,ge as x,St as y};