const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./freemarker2-DWNK8h2Y.js","./editor.api-C3--bZyW.js","./index-B7qcHONN.js","./index-Dh8fhQx0.css","./editor-g4bPbUPc.css","./handlebars-DaiFdHQQ.js","./html-L6-wg7Wu.js","./javascript-Z6-NWV1A.js","./typescript-Dl4lmS0p.js","./liquid-kssafRJQ.js","./mdx-D_bsT8UI.js","./python-BkvP4oVx.js","./razor-Jg-R2qWX.js","./typescript-FbkqV4Jg.js","./xml-x1REfXKD.js","./yaml-B4nWhTtk.js","./cssMode-DIF0dc_9.js","./htmlMode-B1hD6-oV.js","./jsonMode-C4XadRpH.js"])))=>i.map(i=>d[i]);
import{$ as e,F as t,J as n,Q as r,V as i,W as a,X as o,bt as s,ct as c,et as l,j as u,jt as d,t as f,xt as p}from"./index-B7qcHONN.js";import{$ as m,$a as h,$c as g,$i as _,$l as ee,$n as v,$o as te,$r as y,$s as b,$t as ne,$u as re,A as ie,Aa as ae,Ac as oe,Ad as se,Ai as ce,Al as le,An as ue,Ao as de,Ar as fe,As as pe,At as me,Au as he,B as ge,Ba as _e,Bc as ve,Bd as ye,Bi as be,Bl as xe,Bn as Se,Bo as Ce,Br as we,Bs as Te,Bt as Ee,Bu as x,C as De,Ca as Oe,Cc as ke,Cd as Ae,Ci as je,Cl as Me,Cn as Ne,Co as Pe,Cr as Fe,Cs as Ie,Ct as Le,Cu as Re,D as ze,Da as Be,Dc as Ve,Dd as He,Di as Ue,Dl as We,Dn as Ge,Do as Ke,Dr as qe,Ds as S,Dt as Je,Du as C,E as Ye,Ea as Xe,Ec as w,Ed as Ze,Ei as Qe,El as $e,En as et,Eo as tt,Er as nt,Es as rt,Et as it,Eu as T,F as at,Fa as ot,Fc as st,Fd as ct,Fi as lt,Fl as ut,Fn as dt,Fo as ft,Fr as pt,Fs as mt,Ft as ht,Fu as gt,G as _t,Ga as vt,Gc as yt,Gd as bt,Gi as xt,Gl as St,Gn as Ct,Go as wt,Gr as Tt,Gs as Et,Gt as Dt,Gu as Ot,H as kt,Ha as At,Hc as jt,Hd as Mt,Hi as Nt,Hl as Pt,Hn as Ft,Ho as It,Hr as Lt,Hs as Rt,Ht as zt,Hu as Bt,I as Vt,Ia as Ht,Ic as Ut,Id as Wt,Ii as Gt,Il as Kt,In as qt,Io as Jt,Ir as Yt,Is as E,It as Xt,Iu as D,J as Zt,Ja as Qt,Jc as O,Jd as $t,Ji as en,Jl as tn,Jn as nn,Jo as rn,Jr as an,Js as k,Jt as on,Ju as sn,K as cn,Ka as ln,Kc as un,Kd as dn,Ki as fn,Kl as pn,Kn as mn,Ko as hn,Kr as gn,Ks as _n,Kt as vn,Ku as yn,L as bn,La as A,Lc as xn,Ld as Sn,Li as Cn,Ll as wn,Ln as Tn,Lo as En,Lr as Dn,Ls as On,Lt as kn,Lu as An,M as jn,Ma as Mn,Mc as Nn,Md as Pn,Mi as Fn,Ml as In,Mn as Ln,Mo as Rn,Mr as zn,Ms as j,Mt as Bn,Mu as Vn,N as Hn,Na as Un,Nc as Wn,Nd as Gn,Ni as Kn,Nl as qn,Nn as Jn,No as Yn,Nr as Xn,Ns as Zn,Nt as Qn,Nu as M,O as $n,Oa as er,Oc as tr,Od as nr,Oi as rr,Ol as ir,On as ar,Oo as or,Or as sr,Os as cr,Ot as lr,Ou as ur,P as dr,Pa as fr,Pc as pr,Pd as mr,Pi as hr,Pl as gr,Pn as _r,Po as vr,Pr as yr,Ps as br,Pt as xr,Pu as Sr,Q as Cr,Qa as wr,Qc as Tr,Qd as Er,Qi as Dr,Ql as Or,Qn as kr,Qo as Ar,Qr as jr,Qs as Mr,Qt as Nr,Qu as Pr,R as Fr,Ra as Ir,Rc as Lr,Rd as Rr,Ri as zr,Rl as Br,Rn as Vr,Ro as Hr,Rr as Ur,Rs as N,Rt as Wr,Ru as Gr,S as Kr,Sa as qr,Sc as Jr,Sd as Yr,Si as Xr,Sl as Zr,Sn as Qr,So as $r,Sr as ei,Ss as ti,St as ni,Su as ri,T as ii,Ta as ai,Tc as oi,Td as si,Ti as ci,Tl as li,Tn as ui,To as di,Tr as fi,Ts as pi,Tt as mi,Tu as P,U as hi,Ua as gi,Uc as _i,Ud as vi,Ui as yi,Ul as bi,Un as xi,Uo as Si,Ur as Ci,Us as wi,Ut as Ti,Uu as Ei,V as Di,Va as F,Vc as Oi,Vd as ki,Vi as Ai,Vl as ji,Vn as Mi,Vo as Ni,Vr as Pi,Vs as I,Vt as Fi,Vu as L,W as Ii,Wa as Li,Wc as Ri,Wd as zi,Wi as Bi,Wl as Vi,Wn as Hi,Wo as Ui,Wr as Wi,Ws as Gi,Wt as Ki,Wu as qi,X as Ji,Xa as Yi,Xc as Xi,Xd as Zi,Xi as Qi,Xl as $i,Xn as ea,Xo as R,Xr as ta,Xs as na,Xt as ra,Xu as ia,Y as aa,Ya as oa,Yc as sa,Yd as ca,Yi as la,Yl as ua,Yn as da,Yo as fa,Yr as pa,Ys as ma,Yt as ha,Yu as ga,Z as _a,Za as va,Zc as ya,Zd as ba,Zi as xa,Zl as Sa,Zn as Ca,Zo as wa,Zr as Ta,Zs as Ea,Zt as Da,Zu as Oa,_ as ka,_a as Aa,_c as ja,_d as Ma,_i as Na,_l as Pa,_n as Fa,_o as Ia,_r as La,_s as Ra,_t as za,_u as Ba,a as Va,aa as Ha,ac as z,ad as Ua,ai as Wa,al as Ga,an as Ka,ao as qa,ar as Ja,as as Ya,at as Xa,au as Za,b as Qa,ba as $a,bc as eo,bd as to,bi as no,bl as ro,bn as io,bo as ao,br as oo,bs as so,bt as co,bu as lo,c as uo,ca as fo,cc as B,cd as po,ci as mo,cl as ho,cn as go,co as _o,cr as vo,cs as yo,ct as bo,cu as xo,d as So,da as Co,dc as wo,dd as To,di as Eo,dl as Do,dn as Oo,do as V,dr as ko,ds as Ao,dt as jo,du as Mo,ea as No,ec as Po,ed as Fo,ei as Io,el as Lo,en as Ro,eo as zo,er as Bo,es as Vo,et as Ho,eu as Uo,f as Wo,fa as Go,fc as Ko,fd as qo,fi as Jo,fl as Yo,fn as Xo,fo as Zo,fr as Qo,fs as $o,ft as es,fu as ts,g as ns,ga as rs,gc as os,gd as ss,gi as cs,gl as ls,gn as us,go as ds,gr as fs,gs as ps,gt as ms,gu as hs,h as gs,ha as _s,hc as vs,hd as ys,hi as bs,hl as xs,hn as Ss,ho as Cs,hr as ws,hs as Ts,ht as Es,hu as Ds,i as Os,ia as ks,ic as As,id as js,ii as Ms,il as Ns,in as Ps,io as Fs,ir as Is,is as Ls,it as Rs,iu as zs,j as Bs,ja as Vs,jc as Hs,jd as Us,ji as Ws,jl as Gs,jn as Ks,jo as qs,jr as Js,js as Ys,jt as Xs,ju as Zs,k as Qs,ka as $s,kc as ec,kd as tc,ki as nc,kl as rc,kn as ic,ko as ac,kr as oc,ks as sc,kt as cc,ku as lc,l as uc,la as dc,lc as fc,ld as pc,li as mc,ll as hc,ln as gc,lo as H,lr as _c,ls as vc,lt as yc,lu as bc,m as xc,ma as Sc,mc as Cc,md as U,mi as wc,ml as Tc,mn as Ec,mo as Dc,mr as Oc,ms as kc,mt as Ac,mu as jc,n as Mc,na as Nc,nc as Pc,nd as Fc,ni as Ic,nl as Lc,nn as Rc,no as zc,nr as Bc,ns as W,nt as Vc,nu as Hc,o as Uc,oa as Wc,oc as Gc,od as Kc,oi as qc,ol as Jc,on as Yc,oo as Xc,or as Zc,os as Qc,ot as $c,ou as el,p as tl,pa as nl,pc as rl,pd as G,pi as il,pl as al,pn as ol,po as sl,pr as cl,ps as ll,pt as ul,pu as dl,q as fl,qa as pl,qc as ml,qd as hl,qi as gl,ql as _l,qn as vl,qo as yl,qr as bl,qs as xl,qt as Sl,qu as Cl,r as wl,ra as Tl,rc as El,rd as Dl,ri as Ol,rl as kl,rn as Al,ro as jl,rr as Ml,rs as K,rt as Nl,ru as Pl,s as Fl,sa as Il,sc as Ll,sd as Rl,si as zl,sl as Bl,sn as Vl,so as Hl,sr as Ul,ss as Wl,st as Gl,su as Kl,t as ql,ta as Jl,tc as Yl,td as Xl,ti as Zl,tl as Ql,tn as $l,to as eu,tr as tu,ts as q,tt as nu,tu as ru,u as iu,ua as au,uc as ou,ud as su,ui as cu,ul as lu,un as uu,uo as du,ur as fu,us as pu,ut as mu,uu as hu,v as gu,va as _u,vc as vu,vd as J,vi as yu,vl as bu,vn as xu,vo as Su,vr as Y,vs as Cu,vt as wu,vu as Tu,w as Eu,wa as Du,wc as Ou,wd as ku,wi as Au,wl as ju,wn as Mu,wo as Nu,wr as Pu,ws as Fu,wt as Iu,wu as X,x as Lu,xa as Ru,xc as zu,xd as Bu,xi as Vu,xl as Hu,xn as Uu,xo as Wu,xr as Gu,xs as Ku,xt as qu,xu as Ju,y as Yu,ya as Xu,yc as Zu,yd as Qu,yi as $u,yl as ed,yn as td,yo as nd,yr as rd,ys as id,yt as ad,yu as od,z as sd,za as cd,zc as ld,zd as ud,zi as dd,zl as fd,zn as pd,zo as md,zr as hd,zs as gd,zt as _d,zu as vd}from"./editor.api-C3--bZyW.js";import{t as yd}from"./_plugin-vue_export-helper-DEnkkObV.js";function bd(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function xd(e){if(Array.isArray(e))return e}function Sd(e,t,n){return(t=jd(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cd(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t!==0)for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function wd(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Td(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ed(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?Td(Object(n),!0).forEach(function(t){Sd(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Td(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Dd(e,t){if(e==null)return{};var n,r,i=Od(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Od(e,t){if(e==null)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;n[r]=e[r]}return n}function kd(e,t){return xd(e)||Cd(e,t)||Md(e,t)||wd()}function Ad(e,t){if(typeof e!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}function jd(e){var t=Ad(e,`string`);return typeof t==`symbol`?t:t+``}function Md(e,t){if(e){if(typeof e==`string`)return bd(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bd(e,t):void 0}}function Nd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Fd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?Pd(Object(n),!0).forEach(function(t){Nd(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pd(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Id(){var e=[...arguments];return function(t){return e.reduceRight(function(e,t){return t(e)},t)}}function Ld(e){return function t(){var n=this,r=[...arguments];return r.length>=e.length?e.apply(this,r):function(){var e=[...arguments];return t.apply(n,[].concat(r,e))}}}function Rd(e){return{}.toString.call(e).includes(`Object`)}function zd(e){return!Object.keys(e).length}function Bd(e){return typeof e==`function`}function Vd(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Hd(e,t){return Rd(t)||qd(`changeType`),Object.keys(t).some(function(t){return!Vd(e,t)})&&qd(`changeField`),t}function Ud(e){Bd(e)||qd(`selectorType`)}function Wd(e){Bd(e)||Rd(e)||qd(`handlerType`),Rd(e)&&Object.values(e).some(function(e){return!Bd(e)})&&qd(`handlersType`)}function Gd(e){e||qd(`initialIsRequired`),Rd(e)||qd(`initialType`),zd(e)&&qd(`initialContent`)}function Kd(e,t){throw Error(e[t]||e.default)}var qd=Ld(Kd)({initialIsRequired:`initial state is required`,initialType:`initial state should be an object`,initialContent:`initial state shouldn't be an empty object`,handlerType:`handler should be an object or a function`,handlersType:`all handlers should be a functions`,selectorType:`selector should be a function`,changeType:`provided value of changes should be an object`,changeField:`it seams you want to change a field in the state which is not specified in the "initial" state`,default:"an unknown error accured in `state-local` package"}),Jd={changes:Hd,selector:Ud,handler:Wd,initial:Gd};function Yd(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Jd.initial(e),Jd.handler(t);var n={current:e},r=Ld(Qd)(n,t),i=Ld(Zd)(n),a=Ld(Jd.changes)(e),o=Ld(Xd)(n);function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(e){return e};return Jd.selector(e),e(n.current)}function c(e){Id(r,i,a,o)(e)}return[s,c]}function Xd(e,t){return Bd(t)?t(e.current):t}function Zd(e,t){return e.current=Fd(Fd({},e.current),t),t}function Qd(e,t,n){return Bd(t)?t(e.current):Object.keys(n).forEach(function(n){return t[n]?.call(t,e.current[n])}),n}var $d={create:Yd},ef={paths:{vs:`https://cdn.jsdelivr.net/npm/monaco-editor@0.54.0/min/vs`}};function tf(e){return function t(){var n=this,r=[...arguments];return r.length>=e.length?e.apply(this,r):function(){var e=[...arguments];return t.apply(n,[].concat(r,e))}}}function nf(e){return{}.toString.call(e).includes(`Object`)}function rf(e){return e||lf(`configIsRequired`),nf(e)||lf(`configType`),e.urls?(af(),{paths:{vs:e.urls.monacoBase}}):e}function af(){console.warn(cf.deprecation)}function sf(e,t){throw Error(e[t]||e.default)}var cf={configIsRequired:`the configuration object is required`,configType:`the configuration object should be an object`,default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},lf=tf(sf)(cf),uf={config:rf},df=function(){var e=[...arguments];return function(t){return e.reduceRight(function(e,t){return t(e)},t)}};function ff(e,t){return Object.keys(t).forEach(function(n){t[n]instanceof Object&&e[n]&&Object.assign(t[n],ff(e[n],t[n]))}),Ed(Ed({},e),t)}var pf={type:`cancelation`,msg:`operation is manually canceled`};function mf(e){var t=!1,n=new Promise(function(n,r){e.then(function(e){return t?r(pf):n(e)}),e.catch(r)});return n.cancel=function(){return t=!0},n}var hf=[`monaco`],gf=$d.create({config:ef,isInitialized:!1,resolve:null,reject:null,monaco:null}),_f=kd(gf,2),vf=_f[0],yf=_f[1];function bf(e){var t=uf.config(e),n=t.monaco,r=Dd(t,hf);yf(function(e){return{config:ff(e.config,r),monaco:n}})}function xf(){var e=vf(function(e){var t=e.monaco,n=e.isInitialized,r=e.resolve;return{monaco:t,isInitialized:n,resolve:r}});if(!e.isInitialized){if(yf({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),mf(Of);if(window.monaco&&window.monaco.editor)return Ef(window.monaco),e.resolve(window.monaco),mf(Of);df(Sf,wf)(Tf)}return mf(Of)}function Sf(e){return document.body.appendChild(e)}function Cf(e){var t=document.createElement(`script`);return e&&(t.src=e),t}function wf(e){var t=vf(function(e){var t=e.config,n=e.reject;return{config:t,reject:n}}),n=Cf(`${t.config.paths.vs}/loader.js`);return n.onload=function(){return e()},n.onerror=t.reject,n}function Tf(){var e=vf(function(e){var t=e.config,n=e.resolve,r=e.reject;return{config:t,resolve:n,reject:r}}),t=window.require;t.config(e.config),t([`vs/editor/editor.main`],function(t){var n=t.m;Ef(n),e.resolve(n)},function(t){e.reject(t)})}function Ef(e){vf().monaco||yf({monaco:e})}function Df(){return vf(function(e){return e.monaco})}var Of=new Promise(function(e,t){return yf({resolve:e,reject:t})}),kf={config:bf,init:xf,__getMonacoInstance:Df},Af=Object.defineProperty,jf=Object.defineProperties,Mf=Object.getOwnPropertyDescriptors,Nf=Object.getOwnPropertySymbols,Pf=Object.prototype.hasOwnProperty,Ff=Object.prototype.propertyIsEnumerable,If=(e,t,n)=>t in e?Af(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Lf=(e,t)=>{for(var n in t||={})Pf.call(t,n)&&If(e,n,t[n]);if(Nf)for(var n of Nf(t))Ff.call(t,n)&&If(e,n,t[n]);return e},Rf=(e,t)=>jf(e,Mf(t)),zf={wrapper:{display:`flex`,position:`relative`,textAlign:`initial`},fullWidth:{width:`100%`},hide:{display:`none`}};function Bf(e,t){let n=u(()=>{let{width:t,height:n}=e;return Rf(Lf({},zf.wrapper),{width:t,height:n})}),r=u(()=>Lf(Lf({},zf.fullWidth),!t.value&&zf.hide));return{wrapperStyle:n,containerStyle:r}}function Vf(){let e=p(kf.__getMonacoInstance()),t=s(!1),n;return r(()=>{e.value||(n=kf.init(),n.then(t=>e.value=t).catch(e=>{e?.type!==`cancelation`&&(t.value=!0,console.error(`Monaco initialization error:`,e))}))}),{monacoRef:e,unload:()=>n?.cancel(),isLoadFailed:t}}function Hf(e){return typeof e==`function`?e():e}function Uf(e){return e===void 0}function Wf(e,t,n,r){return Gf(e,r)||Kf(e,t,n,r)}function Gf(e,t){return e.editor.getModel(qf(e,t))}function Kf(e,t,n,r){return e.editor.createModel(t,n,r?qf(e,r):void 0)}function qf(e,t){return e.Uri.parse(t)}var Jf=Object.defineProperty,Yf=Object.getOwnPropertySymbols,Xf=Object.prototype.hasOwnProperty,Zf=Object.prototype.propertyIsEnumerable,Qf=(e,t,n)=>t in e?Jf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$f=(e,t)=>{for(var n in t||={})Xf.call(t,n)&&Qf(e,n,t[n]);if(Yf)for(var n of Yf(t))Zf.call(t,n)&&Qf(e,n,t[n]);return e},ep={display:`flex`,height:`100%`,width:`100%`,justifyContent:`center`,alignItems:`center`};i({name:`VueMonacoEditor`,model:{prop:`value`,event:`update:value`},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:`vs`},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:`100%`},height:{type:[Number,String],default:`100%`},className:String},emits:[`update:value`,`beforeMount`,`mount`,`change`,`validate`],setup(t,n){let r=new Map,i=p(null),{monacoRef:a,unload:o,isLoadFailed:s}=Vf(),{editorRef:l}=tp(n,t,a,i),{disposeValidator:d}=np(n,t,a,l),f=u(()=>!!a.value&&!!l.value),{wrapperStyle:m,containerStyle:h}=Bf(t,f);return e(()=>{var e,t;(e=d.value)==null||e.call(d),l.value?((t=l.value.getModel())==null||t.dispose(),l.value.dispose()):o()}),c([()=>t.path,()=>t.value,()=>t.language,()=>t.line],([e,n,i,o],[s,c,u,d])=>{if(f.value){if(e!==s){let c=Wf(a.value,n||t.defaultValue||``,i||t.defaultLanguage||``,e||t.defaultPath||``);t.saveViewState&&r.set(s,l.value.saveViewState()),l.value.setModel(c),t.saveViewState&&l.value.restoreViewState(r.get(e)),Uf(o)||l.value.revealLine(o);return}l.value.getValue()!==n&&l.value.setValue(n),i!==u&&a.value.editor.setModelLanguage(l.value.getModel(),i),!Uf(o)&&o!==d&&l.value.revealLine(o)}}),c(()=>t.options,e=>l.value&&l.value.updateOptions(e),{deep:!0}),c(()=>t.theme,e=>a.value&&a.value.editor.setTheme(e)),{containerRef:i,isEditorReady:f,isLoadFailed:s,wrapperStyle:m,containerStyle:h}},render(){let{$slots:e,isEditorReady:t,isLoadFailed:n,wrapperStyle:r,containerStyle:i,className:o}=this;return a(`div`,{style:r},[!t&&a(`div`,{style:ep},n?e.failure?Hf(e.failure):`load failed`:e.default?Hf(e.default):`loading...`),a(`div`,{ref:`containerRef`,key:`monaco_editor_container`,style:i,class:o})])}});function tp({emit:e},t,i,a){let o=p(null);r(()=>{let e=c(i,()=>{a.value&&i.value&&(n(()=>e()),s())},{immediate:!0})});function s(){var n;if(!a.value||!i.value||o.value)return;e(`beforeMount`,i.value);let r=t.path||t.defaultPath,s=Wf(i.value,t.value||t.defaultValue||``,t.language||t.defaultLanguage||``,r||``);o.value=i.value.editor.create(a.value,$f({model:s,theme:t.theme,automaticLayout:!0,autoIndent:`brackets`,formatOnPaste:!0,formatOnType:!0},t.options),t.overrideServices),(n=o.value)==null||n.onDidChangeModelContent(n=>{let r=o.value.getValue();r!==t.value&&(e(`update:value`,r),e(`change`,r,n))}),o.value&&!Uf(t.line)&&o.value.revealLine(t.line),e(`mount`,o.value,i.value)}return{editorRef:o}}function np({emit:e},t,r,i){let a=s(null),o=c([r,i],()=>{if(r.value&&i.value){n(()=>o());let t=r.value.editor.onDidChangeMarkers(t=>{let n=i.value?.getModel()?.uri;if(n&&t.find(e=>e.path===n.path)){let t=r.value.editor.getModelMarkers({resource:n});e(`validate`,t)}});a.value=()=>t?.dispose()}});return{disposeValidator:a}}var rp=Object.defineProperty,ip=Object.getOwnPropertySymbols,ap=Object.prototype.hasOwnProperty,op=Object.prototype.propertyIsEnumerable,sp=(e,t,n)=>t in e?rp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,cp=(e,t)=>{for(var n in t||={})ap.call(t,n)&&sp(e,n,t[n]);if(ip)for(var n of ip(t))op.call(t,n)&&sp(e,n,t[n]);return e},lp={display:`flex`,height:`100%`,width:`100%`,justifyContent:`center`,alignItems:`center`};i({name:`VueMonacoDiffEditor`,props:{original:String,modified:String,language:String,originalLanguage:String,modifiedLanguage:String,originalModelPath:String,modifiedModelPath:String,theme:{type:String,default:`vs`},options:{type:Object,default:()=>({})},width:{type:[Number,String],default:`100%`},height:{type:[Number,String],default:`100%`},className:String},setup(t,n){let r=p(null),{monacoRef:i,unload:a,isLoadFailed:o}=Vf(),{diffEditorRef:s}=up(n,t,i,r),l=u(()=>!!i.value&&!!s.value),{wrapperStyle:d,containerStyle:f}=Bf(t,l);return e(()=>{var e,t,n,r,o,c,l;!i.value&&a();let u=((e=s.value)?.getModel)?.call(e);(n=(t=u?.original)?.dispose)==null||n.call(t),(o=(r=u?.modified)?.dispose)==null||o.call(r),(l=(c=s.value)?.dispose)==null||l.call(c)}),c([()=>t.originalModelPath,()=>t.original,()=>t.originalLanguage,()=>t.language],([e,t,n,r],[a,o,c,u])=>{if(!l.value)return;let d=s.value.getOriginalEditor();if(e!==a){let a=Wf(i.value,t||``,n||r||`text`,e||``);d.setModel(a);return}t!==d.getValue()&&d.setValue(t||``),(n!==c||r!==u)&&i.value.editor.setModelLanguage(s.value.getModel().original,n||r||`text`)}),c([()=>t.modifiedModelPath,()=>t.modified,()=>t.modifiedLanguage,()=>t.language],([e,t,n,r],[a,o,c,u])=>{if(!l.value)return;let d=s.value.getModifiedEditor();if(a!==e){let a=Wf(i.value,t||``,n||r||`text`,e||``);d.setModel(a);return}if(t!==d.getValue()){let e=i.value.editor.EditorOption.readOnly;d.getOption(e)?d.setValue(t||``):(d.executeEdits(``,[{range:d.getModel().getFullModelRange(),text:t||``,forceMoveMarkers:!0}]),d.pushUndoStop())}(n!==c||r!==u)&&i.value.editor.setModelLanguage(s.value.getModel().modified,n||r||`text`)}),c(()=>t.theme,()=>i.value?.editor.setTheme(t.theme)),c(()=>t.options,()=>s.value?.updateOptions(t.options),{deep:!0}),{containerRef:r,isDiffEditorReady:l,isLoadFailed:o,wrapperStyle:d,containerStyle:f}},render(){let{$slots:e,isDiffEditorReady:t,isLoadFailed:n,wrapperStyle:r,containerStyle:i,className:o}=this;return a(`div`,{style:r},[!t&&a(`div`,{style:lp},n?e.failure?Hf(e.failure):`load failed`:e.default?Hf(e.default):`loading...`),a(`div`,{ref:`containerRef`,key:`monaco_diff_editor_container`,style:i,class:o})])}});function up({emit:e},t,i,a){let o=p(null);r(()=>{let e=c(i,()=>{a.value&&i.value&&(n(()=>e()),s())},{immediate:!0})});function s(){var n;if(!a.value||!i.value||o.value)return;e(`beforeMount`,i.value),o.value=i.value.editor.createDiffEditor(a.value,cp({automaticLayout:!0,autoIndent:`brackets`,theme:t.theme,formatOnPaste:!0,formatOnType:!0},t.options));let r=Wf(i.value,t.original||``,t.originalLanguage||t.language||`text`,t.originalModelPath||``),s=Wf(i.value,t.modified||``,t.modifiedLanguage||t.language||`text`,t.modifiedModelPath||``);(n=o.value)==null||n.setModel({original:r,modified:s}),e(`mount`,o.value,i.value)}return{diffEditorRef:o}}var dp=class extends pi{constructor(){super({id:`diffEditor.toggleCollapseUnchangedRegions`,title:U(82,`Toggle Collapse Unchanged Regions`),icon:X.map,toggled:E.has(`config.diffEditor.hideUnchangedRegions.enabled`),precondition:E.has(`isInDiffEditor`),menu:{when:E.has(`isInDiffEditor`),id:S.EditorTitle,order:22,group:`navigation`}})}run(e,...t){let n=e.get(hn),r=!n.getValue(`diffEditor.hideUnchangedRegions.enabled`);n.updateValue(`diffEditor.hideUnchangedRegions.enabled`,r)}},fp=class extends pi{constructor(){super({id:`diffEditor.toggleShowMovedCodeBlocks`,title:U(83,`Toggle Show Moved Code Blocks`),precondition:E.has(`isInDiffEditor`)})}run(e,...t){let n=e.get(hn),r=!n.getValue(`diffEditor.experimental.showMoves`);n.updateValue(`diffEditor.experimental.showMoves`,r)}},pp=class extends pi{constructor(){super({id:`diffEditor.toggleUseInlineViewWhenSpaceIsLimited`,title:U(84,`Toggle Use Inline View When Space Is Limited`),precondition:E.has(`isInDiffEditor`)})}run(e,...t){let n=e.get(hn),r=!n.getValue(`diffEditor.useInlineViewWhenSpaceIsLimited`);n.updateValue(`diffEditor.useInlineViewWhenSpaceIsLimited`,r)}},mp=U(85,`Diff Editor`),hp=class extends wa{constructor(){super({id:`diffEditor.switchSide`,title:U(86,`Switch Side`),icon:X.arrowSwap,precondition:E.has(`isInDiffEditor`),f1:!0,category:mp})}runEditorCommand(e,t,n){let r=wp(e);if(r instanceof Ye){if(n&&n.dryRun)return{destinationSelection:r.mapToOtherSide().destinationSelection};r.switchSide()}}},gp=class extends wa{constructor(){super({id:`diffEditor.exitCompareMove`,title:U(87,`Exit Compare Move`),icon:X.close,precondition:y.comparingMovedCode,f1:!1,category:mp,keybinding:{weight:1e4,primary:9}})}runEditorCommand(e,t,...n){let r=wp(e);r instanceof Ye&&r.exitCompareMove()}},_p=class extends wa{constructor(){super({id:`diffEditor.collapseAllUnchangedRegions`,title:U(88,`Collapse All Unchanged Regions`),icon:X.fold,precondition:E.has(`isInDiffEditor`),f1:!0,category:mp})}runEditorCommand(e,t,...n){let r=wp(e);r instanceof Ye&&r.collapseAllUnchangedRegions()}},vp=class extends wa{constructor(){super({id:`diffEditor.showAllUnchangedRegions`,title:U(89,`Show All Unchanged Regions`),icon:X.unfold,precondition:E.has(`isInDiffEditor`),f1:!0,category:mp})}runEditorCommand(e,t,...n){let r=wp(e);r instanceof Ye&&r.showAllUnchangedRegions()}},yp=class extends pi{constructor(){super({id:`diffEditor.revert`,title:U(90,`Revert`),f1:!0,category:mp,precondition:E.has(`isInDiffEditor`)})}run(e,t){return t?this.runViaToolbarContext(e,t):this.runViaCursorOrSelection(e)}runViaCursorOrSelection(e){let t=wp(e);t instanceof Ye&&t.revertFocusedRangeMappings()}runViaToolbarContext(e,t){let n=Cp(e,t.originalUri,t.modifiedUri);n instanceof Ye&&n.revertRangeMappings(t.mapping.innerChanges??[])}},bp=U(91,`Accessible Diff Viewer`),xp=class e extends pi{static{this.id=`editor.action.accessibleDiffViewer.next`}constructor(){super({id:e.id,title:U(92,`Go to Next Difference`),category:bp,precondition:E.has(`isInDiffEditor`),keybinding:{primary:65,weight:100},f1:!0})}run(e){wp(e)?.accessibleDiffViewerNext()}},Sp=class e extends pi{static{this.id=`editor.action.accessibleDiffViewer.prev`}constructor(){super({id:e.id,title:U(93,`Go to Previous Difference`),category:bp,precondition:E.has(`isInDiffEditor`),keybinding:{primary:1089,weight:100},f1:!0})}run(e){wp(e)?.accessibleDiffViewerPrev()}};function Cp(e,t,n){return e.get(xl).listDiffEditors().find(e=>{let r=e.getModifiedEditor(),i=e.getOriginalEditor();return r&&r.getModel()?.uri.toString()===n.toString()&&i&&i.getModel()?.uri.toString()===t.toString()})||null}function wp(e){let t=e.get(xl).listDiffEditors(),n=wo();if(n){for(let e of t)if(e.getContainerDomNode().contains(n))return e}return null}j(dp),j(fp),j(pp),sc.appendMenuItem(S.EditorTitle,{command:{id:new pp().desc.id,title:G(116,`Use Inline View When Space Is Limited`),toggled:E.has(`config.diffEditor.useInlineViewWhenSpaceIsLimited`),precondition:E.has(`isInDiffEditor`)},order:11,group:`1_diff`,when:E.and(y.diffEditorRenderSideBySideInlineBreakpointReached,E.has(`isInDiffEditor`))}),sc.appendMenuItem(S.EditorTitle,{command:{id:new fp().desc.id,title:G(117,`Show Moved Code Blocks`),icon:X.move,toggled:mt.create(`config.diffEditor.experimental.showMoves`,!0),precondition:E.has(`isInDiffEditor`)},order:10,group:`1_diff`,when:E.has(`isInDiffEditor`)}),j(yp);for(let e of[{icon:X.arrowRight,key:y.diffEditorInlineMode.toNegated()},{icon:X.discard,key:y.diffEditorInlineMode}])sc.appendMenuItem(S.DiffEditorHunkToolbar,{command:{id:new yp().desc.id,title:G(118,`Revert Block`),icon:e.icon},when:E.and(y.diffEditorModifiedWritable,e.key),order:5,group:`primary`}),sc.appendMenuItem(S.DiffEditorSelectionToolbar,{command:{id:new yp().desc.id,title:G(119,`Revert Selection`),icon:e.icon},when:E.and(y.diffEditorModifiedWritable,e.key),order:5,group:`primary`});j(hp),j(gp),j(_p),j(vp),sc.appendMenuItem(S.EditorTitle,{command:{id:xp.id,title:G(120,`Open Accessible Diff Viewer`),precondition:E.has(`isInDiffEditor`)},order:10,group:`2_diff`,when:E.and(y.accessibleDiffViewerVisible.negate(),E.has(`isInDiffEditor`))}),gd.registerCommandAlias(`editor.action.diffReview.next`,xp.id),j(xp),gd.registerCommandAlias(`editor.action.diffReview.prev`,Sp.id),j(Sp);var Tp=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ep=function(e,t){return function(n,r){t(n,r,e)}},Dp;const Op=new N(`selectionAnchorSet`,!1);var kp=class{static{Dp=this}static{this.ID=`editor.contrib.selectionAnchorController`}static get(e){return e.getContribution(Dp.ID)}constructor(e,t){this.editor=e,this.selectionAnchorSetContextKey=Op.bindTo(t),this.modelChangeListener=e.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}setSelectionAnchor(){if(this.editor.hasModel()){let e=this.editor.getPosition();this.editor.changeDecorations(t=>{this.decorationId&&t.removeDecoration(this.decorationId),this.decorationId=t.addDecoration(P.fromPositions(e,e),{description:`selection-anchor`,stickiness:1,hoverMessage:new Jn().appendText(G(794,`Selection Anchor`)),className:`selection-anchor`})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),va(G(795,`Anchor set at {0}:{1}`,e.lineNumber,e.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){let e=this.editor.getModel().getDecorationRange(this.decorationId);e&&this.editor.setPosition(e.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){let e=this.editor.getModel().getDecorationRange(this.decorationId);if(e){let t=this.editor.getPosition();this.editor.setSelection(P.fromPositions(e.getStartPosition(),t)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){let e=this.decorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}};kp=Dp=Tp([Ep(1,On)],kp);var Ap=class extends R{constructor(){super({id:`editor.action.setSelectionAnchor`,label:U(796,`Set Selection Anchor`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2080),weight:100}})}async run(e,t){kp.get(t)?.setSelectionAnchor()}},jp=class extends R{constructor(){super({id:`editor.action.goToSelectionAnchor`,label:U(797,`Go to Selection Anchor`),precondition:Op})}async run(e,t){kp.get(t)?.goToSelectionAnchor()}},Mp=class extends R{constructor(){super({id:`editor.action.selectFromAnchorToCursor`,label:U(798,`Select from Anchor to Cursor`),precondition:Op,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2089),weight:100}})}async run(e,t){kp.get(t)?.selectFromAnchorToCursor()}},Np=class extends R{constructor(){super({id:`editor.action.cancelSelectionAnchor`,label:U(799,`Cancel Selection Anchor`),precondition:Op,kbOpts:{kbExpr:y.editorTextFocus,primary:9,weight:100}})}async run(e,t){kp.get(t)?.cancelSelectionAnchor()}};K(kp.ID,kp,4),q(Ap),q(jp),q(Mp),q(Np);var Pp=F(`editorOverviewRuler.bracketMatchForeground`,`#A0A0A0`,G(800,`Overview ruler marker color for matching brackets.`)),Fp=class extends R{constructor(){super({id:`editor.action.jumpToBracket`,label:U(802,`Go to Bracket`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:3165,weight:100}})}run(e,t){zp.get(t)?.jumpToBracket()}},Ip=class extends R{constructor(){super({id:`editor.action.selectToBracket`,label:U(803,`Select to Bracket`),precondition:void 0,metadata:{description:U(804,`Select the text inside and including the brackets or curly braces`),args:[{name:`args`,schema:{type:`object`,properties:{selectBrackets:{type:`boolean`,default:!0}}}}]}})}run(e,t,n){let r=!0;n&&n.selectBrackets===!1&&(r=!1),zp.get(t)?.selectToBracket(r)}},Lp=class extends R{constructor(){super({id:`editor.action.removeBrackets`,label:U(805,`Remove Brackets`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:2561,weight:100}})}run(e,t){zp.get(t)?.removeBrackets(this.id)}},Rp=class{constructor(e,t,n){this.position=e,this.brackets=t,this.options=n}},zp=class e extends x{static{this.ID=`editor.contrib.bracketMatchingController`}static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._editor=e,this._lastBracketsData=[],this._lastVersionId=0,this._decorations=this._editor.createDecorationsCollection(),this._updateBracketsSoon=this._register(new Zr(()=>this._updateBrackets(),50)),this._matchBrackets=this._editor.getOption(80),this._updateBracketsSoon.schedule(),this._register(e.onDidChangeCursorPosition(e=>{this._matchBrackets!==`never`&&this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelContent(e=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModel(e=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelLanguageConfiguration(e=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeConfiguration(e=>{e.hasChanged(80)&&(this._matchBrackets=this._editor.getOption(80),this._decorations.clear(),this._lastBracketsData=[],this._lastVersionId=0,this._updateBracketsSoon.schedule())})),this._register(e.onDidBlurEditorWidget(()=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidFocusEditorWidget(()=>{this._updateBracketsSoon.schedule()}))}jumpToBracket(){if(!this._editor.hasModel())return;let e=this._editor.getModel(),t=this._editor.getSelections().map(t=>{let n=t.getStartPosition(),r=e.bracketPairs.matchBracket(n),i=null;if(r)r[0].containsPosition(n)&&!r[1].containsPosition(n)?i=r[1].getStartPosition():r[1].containsPosition(n)&&(i=r[0].getStartPosition());else{let t=e.bracketPairs.findEnclosingBrackets(n);if(t)i=t[1].getStartPosition();else{let t=e.bracketPairs.findNextBracket(n);t&&t.range&&(i=t.range.getStartPosition())}}return i?new P(i.lineNumber,i.column,i.lineNumber,i.column):new P(n.lineNumber,n.column,n.lineNumber,n.column)});this._editor.setSelections(t),this._editor.revealRange(t[0])}selectToBracket(e){if(!this._editor.hasModel())return;let t=this._editor.getModel(),n=[];this._editor.getSelections().forEach(r=>{let i=r.getStartPosition(),a=t.bracketPairs.matchBracket(i);if(!a&&(a=t.bracketPairs.findEnclosingBrackets(i),!a)){let e=t.bracketPairs.findNextBracket(i);e&&e.range&&(a=t.bracketPairs.matchBracket(e.range.getStartPosition()))}let o=null,s=null;if(a){a.sort(T.compareRangesUsingStarts);let[t,n]=a;if(o=e?t.getStartPosition():t.getEndPosition(),s=e?n.getEndPosition():n.getStartPosition(),n.containsPosition(i)){let e=o;o=s,s=e}}o&&s&&n.push(new P(o.lineNumber,o.column,s.lineNumber,s.column))}),n.length>0&&(this._editor.setSelections(n),this._editor.revealRange(n[0]))}removeBrackets(e){if(!this._editor.hasModel())return;let t=this._editor.getModel();this._editor.getSelections().forEach(n=>{let r=n.getPosition(),i=t.bracketPairs.matchBracket(r);i||=t.bracketPairs.findEnclosingBrackets(r),i&&(this._editor.pushUndoStop(),this._editor.executeEdits(e,[{range:i[0],text:``},{range:i[1],text:``}]),this._editor.pushUndoStop())})}static{this._DECORATION_OPTIONS_WITH_OVERVIEW_RULER=Y.register({description:`bracket-match-overview`,stickiness:1,className:`bracket-match`,overviewRuler:{color:Ta(Pp),position:vr.Center}})}static{this._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER=Y.register({description:`bracket-match-no-overview`,stickiness:1,className:`bracket-match`})}_updateBrackets(){if(this._matchBrackets===`never`)return;this._recomputeBrackets();let e=[],t=0;for(let n of this._lastBracketsData){let r=n.brackets;r&&(e[t++]={range:r[0],options:n.options},e[t++]={range:r[1],options:n.options})}this._decorations.set(e)}_recomputeBrackets(){if(!this._editor.hasModel()||!this._editor.hasWidgetFocus()){this._lastBracketsData=[],this._lastVersionId=0;return}let t=this._editor.getSelections();if(t.length>100){this._lastBracketsData=[],this._lastVersionId=0;return}let n=this._editor.getModel(),r=n.getVersionId(),i=[];this._lastVersionId===r&&(i=this._lastBracketsData);let a=[],o=0;for(let e=0,n=t.length;e<n;e++){let n=t[e];n.isEmpty()&&(a[o++]=n.getStartPosition())}a.length>1&&a.sort(C.compare);let s=[],c=0,l=0,u=i.length;for(let t=0,r=a.length;t<r;t++){let r=a[t];for(;l<u&&i[l].position.isBefore(r);)l++;if(l<u&&i[l].position.equals(r))s[c++]=i[l];else{let t=n.bracketPairs.matchBracket(r,20),i=e._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;!t&&this._matchBrackets===`always`&&(t=n.bracketPairs.findEnclosingBrackets(r,20),i=e._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER),s[c++]=new Rp(r,t,i)}}this._lastBracketsData=s,this._lastVersionId=r}};K(zp.ID,zp,1),q(Ip),q(Fp),q(Lp),sc.appendMenuItem(S.MenubarGoMenu,{group:`5_infile_nav`,command:{id:`editor.action.jumpToBracket`,title:G(801,`Go to &&Bracket`)},order:2});var Bp=class{constructor(e,t){this._selection=e,this._isMovingLeft=t}getEditOperations(e,t){if(this._selection.startLineNumber!==this._selection.endLineNumber||this._selection.isEmpty())return;let n=this._selection.startLineNumber,r=this._selection.startColumn,i=this._selection.endColumn;if(!(this._isMovingLeft&&r===1)&&!(!this._isMovingLeft&&i===e.getLineMaxColumn(n)))if(this._isMovingLeft){let a=new T(n,r-1,n,r),o=e.getValueInRange(a);t.addEditOperation(a,null),t.addEditOperation(new T(n,i,n,i),o)}else{let a=new T(n,i,n,i+1),o=e.getValueInRange(a);t.addEditOperation(a,null),t.addEditOperation(new T(n,r,n,r),o)}}computeCursorState(e,t){return this._isMovingLeft?new P(this._selection.startLineNumber,this._selection.startColumn-1,this._selection.endLineNumber,this._selection.endColumn-1):new P(this._selection.startLineNumber,this._selection.startColumn+1,this._selection.endLineNumber,this._selection.endColumn+1)}},Vp=class extends R{constructor(e,t){super(t),this.left=e}run(e,t){if(!t.hasModel())return;let n=[],r=t.getSelections();for(let e of r)n.push(new Bp(e,this.left));t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop()}},Hp=class extends Vp{constructor(){super(!0,{id:`editor.action.moveCarretLeftAction`,label:U(806,`Move Selected Text Left`),precondition:y.writable})}},Up=class extends Vp{constructor(){super(!1,{id:`editor.action.moveCarretRightAction`,label:U(807,`Move Selected Text Right`),precondition:y.writable})}};q(Hp),q(Up),q(class extends R{constructor(){super({id:`editor.action.transposeLetters`,label:U(808,`Transpose Letters`),precondition:y.writable,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:306},weight:100}})}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=[],i=t.getSelections();for(let e of i){if(!e.isEmpty())continue;let t=e.startLineNumber,i=e.startColumn,a=n.getLineMaxColumn(t);if(t===1&&(i===1||i===2&&a===2))continue;let o=i===a?e.getPosition():cu.rightPosition(n,e.getPosition().lineNumber,e.getPosition().column),s=cu.leftPosition(n,o),c=cu.leftPosition(n,s),l=n.getValueInRange(T.fromPositions(c,s)),u=n.getValueInRange(T.fromPositions(s,o)),d=T.fromPositions(c,o);r.push(new Eo(d,u+l))}r.length>0&&(t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop())}});const Wp=ma(`productService`);function Gp(e,t){return{id:t,asString:async()=>e,asFile:()=>void 0,value:typeof e==`string`?e:void 0}}function Kp(e,t,n,r){let i={id:cs(),name:e,uri:t,data:n};return{id:r,asString:async()=>``,asFile:()=>i,value:void 0}}var qp=class{constructor(){this._entries=new Map}get size(){let e=0;for(let t of this._entries)e++;return e}has(e){return this._entries.has(this.toKey(e))}matches(e){let t=[...this._entries.keys()];return Dl.some(this,([e,t])=>t.asFile())&&t.push(`files`),Xp(Jp(e),t)}get(e){return this._entries.get(this.toKey(e))?.[0]}append(e,t){let n=this._entries.get(e);n?n.push(t):this._entries.set(this.toKey(e),[t])}replace(e,t){this._entries.set(this.toKey(e),[t])}delete(e){this._entries.delete(this.toKey(e))}*[Symbol.iterator](){for(let[e,t]of this._entries)for(let n of t)yield[e,n]}toKey(e){return Jp(e)}};function Jp(e){return e.toLowerCase()}function Yp(e,t){return Xp(Jp(e),t.map(Jp))}function Xp(e,t){if(e===`*/*`)return t.length>0;if(t.includes(e))return!0;let n=e.match(/^([a-z]+)\/([a-z]+|\*)$/i);if(!n)return!1;let[r,i,a]=n;return a===`*`?t.some(e=>e.startsWith(i+`/`)):!1}const Zp=Object.freeze({create:e=>zi(e.map(e=>e.toString())).join(`\r
`),split:e=>e.split(`\r
`),parse:e=>Zp.split(e).filter(e=>!e.startsWith(`#`))});var Qp=class e{static{this.sep=`.`}static{this.None=new e(`@@none@@`)}static{this.Empty=new e(``)}constructor(e){this.value=e}equals(e){return this.value===e.value}contains(t){return this.equals(t)||this.value===``||t.value.startsWith(this.value+e.sep)}intersects(e){return this.contains(e)||e.contains(this)}append(...t){return new e((this.value?[this.value,...t]:t).join(e.sep))}};const $p={EDITORS:`CodeEditors`,FILES:`CodeFiles`,SYMBOLS:`application/vnd.code.symbols`,MARKERS:`application/vnd.code.diagnostics`,NOTEBOOK_CELL_OUTPUT:`notebook-cell-output`,SCM_HISTORY_ITEM:`scm-history-item`};var em=class{};br.add({DragAndDropContribution:`workbench.contributions.dragAndDrop`}.DragAndDropContribution,new em);var tm=class e{static{this.INSTANCE=new e}constructor(){}static getInstance(){return e.INSTANCE}hasData(e){return e&&e===this.proto}getData(e){if(this.hasData(e))return this.data}};function nm(e){if(pc&&typeof globalThis.vscode?.webUtils?.getPathForFile==`function`)return globalThis.vscode.webUtils.getPathForFile(e)}function rm(e){let t=new qp;for(let n of e.items){let e=n.type;if(n.kind===`string`){let r=new Promise(e=>n.getAsString(e));t.append(e,Gp(r))}else if(n.kind===`file`){let r=n.getAsFile();r&&t.append(e,im(r))}}return t}function im(e){let t=nm(e),n=t?ur.parse(t):void 0;return Kp(e.name,n,async()=>new Uint8Array(await e.arrayBuffer()))}var am=Object.freeze([$p.EDITORS,$p.FILES,ra.RESOURCES,ra.INTERNAL_URI_LIST]);function om(e,t=!1){let n=rm(e),r=n.get(ra.INTERNAL_URI_LIST);if(r)n.replace(Si.uriList,r);else if(t||!n.has(Si.uriList)){let t=[];for(let n of e.items){let e=n.getAsFile();if(e){let n=nm(e);try{n?t.push(ur.file(n).toString()):t.push(ur.parse(e.name,!0).toString())}catch{}}}t.length&&n.replace(Si.uriList,Gp(Zp.create(t)))}for(let e of am)n.delete(e);return n}var sm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},cm=function(e,t){return function(n,r){t(n,r,e)}},lm=Y.register({description:`inline-progress-widget`,stickiness:1,showIfCollapsed:!0,after:{content:`\xA0`,inlineClassName:`inline-editor-progress-decoration`,inlineClassNameAffectsLetterSpacing:!0}}),um=class e extends x{static{this.baseId=`editor.widget.inlineProgressWidget`}constructor(e,t,n,r,i){super(),this.typeId=e,this.editor=t,this.range=n,this.delegate=i,this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this.create(r),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this)}create(e){this.domNode=b(`.inline-progress-widget`),this.domNode.role=`button`,this.domNode.title=e;let t=b(`span.icon`);this.domNode.append(t),t.classList.add(...I.asClassNameArray(X.loading),`codicon-modifier-spin`);let n=()=>{let e=this.editor.getOption(75);this.domNode.style.height=`${e}px`,this.domNode.style.width=`${Math.ceil(.8*e)}px`};n(),this._register(this.editor.onDidChangeConfiguration(e=>{(e.hasChanged(61)||e.hasChanged(75))&&n()})),this._register(z(this.domNode,Pc.CLICK,e=>{this.delegate.cancel()}))}getId(){return e.baseId+`.`+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:{lineNumber:this.range.startLineNumber,column:this.range.startColumn},preference:[0]}}dispose(){super.dispose(),this.editor.removeContentWidget(this)}},dm=class extends x{constructor(e,t,n){super(),this.id=e,this._editor=t,this._instantiationService=n,this._showDelay=500,this._showPromise=this._register(new Bt),this._currentWidget=this._register(new Bt),this._operationIdPool=0,this._currentDecorations=t.createDecorationsCollection()}dispose(){super.dispose(),this._currentDecorations.clear()}async showWhile(e,t,n,r,i){let a=this._operationIdPool++;this._currentOperation=a,this.clear(),this._showPromise.value=$e(()=>{let n=T.fromPositions(e);this._currentDecorations.set([{range:n,options:lm}]).length>0&&(this._currentWidget.value=this._instantiationService.createInstance(um,this.id,this._editor,n,t,r))},i??this._showDelay);try{return await n}finally{this._currentOperation===a&&(this.clear(),this._currentOperation=void 0)}}clear(){this._showPromise.clear(),this._currentDecorations.clear(),this._currentWidget.clear()}};dm=sm([cm(2,k)],dm);var fm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},pm=function(e,t){return function(n,r){t(n,r,e)}},mm,hm=class{static{mm=this}static{this.ID=`editor.contrib.messageController`}static{this.MESSAGE_VISIBLE=new N(`messageVisible`,!1,G(1277,`Whether the editor is currently showing an inline message`))}static get(e){return e.getContribution(mm.ID)}constructor(e,t,n){this._openerService=n,this._messageWidget=new Bt,this._messageListeners=new L,this._mouseOverMessage=!1,this._editor=e,this._visible=mm.MESSAGE_VISIBLE.bindTo(t)}dispose(){this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}showMessage(e,t){if(va(qt(e)?e.value:e),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),qt(e)){let n=this._messageListeners.add(ar(e,{actionHandler:(e,t)=>{this.closeMessage(),Ge(this._openerService,e,t.isTrusted)}}));this._messageWidget.value=new _m(this._editor,t,n.element)}else this._messageWidget.value=new _m(this._editor,t,e);this._messageListeners.add(An.debounce(this._editor.onDidBlurEditorText,(e,t)=>t,0)(()=>{this._mouseOverMessage||this._messageWidget.value&&Ou(wo(),this._messageWidget.value.getDomNode())||this.closeMessage()})),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add(z(this._messageWidget.value.getDomNode(),Pc.MOUSE_ENTER,()=>this._mouseOverMessage=!0,!0)),this._messageListeners.add(z(this._messageWidget.value.getDomNode(),Pc.MOUSE_LEAVE,()=>this._mouseOverMessage=!1,!0));let n;this._messageListeners.add(this._editor.onMouseMove(e=>{e.target.position&&(n?n.containsPosition(e.target.position)||this.closeMessage():n=new T(t.lineNumber-3,1,e.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(_m.fadeOut(this._messageWidget.value))}};hm=mm=fm([pm(1,On),pm(2,da)],hm);var gm=Ar.bindToContribution(hm.get);W(new gm({id:`leaveEditorMessage`,precondition:hm.MESSAGE_VISIBLE,handler:e=>e.closeMessage(),kbOpts:{weight:130,primary:9}}));var _m=class{static fadeOut(e){let t=()=>{e.dispose(),clearTimeout(n),e.getDomNode().removeEventListener(`animationend`,t)},n=setTimeout(t,110);return e.getDomNode().addEventListener(`animationend`,t),e.getDomNode().classList.add(`fadeOut`),{dispose:t}}constructor(e,{lineNumber:t,column:n},r){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=e,this._editor.revealLinesInCenterIfOutsideViewport(t,t,0),this._position={lineNumber:t,column:n},this._domNode=document.createElement(`div`),this._domNode.classList.add(`monaco-editor-overlaymessage`),this._domNode.style.marginLeft=`-6px`;let i=document.createElement(`div`);i.classList.add(`anchor`,`top`),this._domNode.appendChild(i);let a=document.createElement(`div`);typeof r==`string`?(a.classList.add(`message`),a.textContent=r):(r.classList.add(`message`),a.appendChild(r)),this._domNode.appendChild(a);let o=document.createElement(`div`);o.classList.add(`anchor`,`below`),this._domNode.appendChild(o),this._editor.addContentWidget(this),this._domNode.classList.add(`fadeIn`)}dispose(){this._editor.removeContentWidget(this)}getId(){return`messageoverlay`}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[1,2],positionAffinity:1}}afterRender(e){this._domNode.classList.toggle(`below`,e===2)}};K(hm.ID,hm,4);var vm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ym=function(e,t){return function(n,r){t(n,r,e)}},bm=class{constructor(e){this.copyMimeTypes=[],this.kind=e,this.providedDropEditKinds=[this.kind],this.providedPasteEditKinds=[this.kind]}async provideDocumentPasteEdits(e,t,n,r,i){let a=await this.getEdit(n,i);if(a)return{edits:[{insertText:a.insertText,title:a.title,kind:a.kind,handledMimeType:a.handledMimeType,yieldTo:a.yieldTo}],dispose(){}}}async provideDocumentDropEdits(e,t,n,r){let i=await this.getEdit(n,r);if(i)return{edits:[{insertText:i.insertText,title:i.title,kind:i.kind,handledMimeType:i.handledMimeType,yieldTo:i.yieldTo}],dispose(){}}}},xm=class e extends bm{static{this.id=`text`}constructor(){super(Qp.Empty.append(`text`,`plain`)),this.id=e.id,this.dropMimeTypes=[Si.text],this.pasteMimeTypes=[Si.text]}async getEdit(e,t){let n=e.get(Si.text);if(!n||e.has(Si.uriList))return;let r=await n.asString();return{handledMimeType:Si.text,title:G(921,`Insert Plain Text`),insertText:r,kind:this.kind}}},Sm=class extends bm{constructor(){super(Qp.Empty.append(`uri`,`path`,`absolute`)),this.dropMimeTypes=[Si.uriList],this.pasteMimeTypes=[Si.uriList]}async getEdit(e,t){let n=await Tm(e);if(!n.length||t.isCancellationRequested)return;let r=0,i=n.map(({uri:e,originalText:t})=>e.scheme===ls.file?e.fsPath:(r++,t)).join(` `),a;return a=r>0?n.length>1?G(922,`Insert Uris`):G(923,`Insert Uri`):n.length>1?G(924,`Insert Paths`):G(925,`Insert Path`),{handledMimeType:Si.uriList,insertText:i,title:a,kind:this.kind}}},Cm=class extends bm{constructor(e){super(Qp.Empty.append(`uri`,`path`,`relative`)),this._workspaceContextService=e,this.dropMimeTypes=[Si.uriList],this.pasteMimeTypes=[Si.uriList]}async getEdit(e,t){let n=await Tm(e);if(!n.length||t.isCancellationRequested)return;let r=ki(n.map(({uri:e})=>{let t=this._workspaceContextService.getWorkspaceFolder(e);return t?so(t.uri,e):void 0}));if(r.length)return{handledMimeType:Si.uriList,insertText:r.join(` `),title:n.length>1?G(926,`Insert Relative Paths`):G(927,`Insert Relative Path`),kind:this.kind}}};Cm=vm([ym(0,Ps)],Cm);var wm=class{constructor(){this.kind=new Qp(`html`),this.providedPasteEditKinds=[this.kind],this.copyMimeTypes=[],this.pasteMimeTypes=[`text/html`],this._yieldTo=[{mimeType:Si.text}]}async provideDocumentPasteEdits(e,t,n,r,i){if(r.triggerKind!==xo.PasteAs&&!r.only?.contains(this.kind))return;let a=await n.get(`text/html`)?.asString();if(!(!a||i.isCancellationRequested))return{dispose(){},edits:[{insertText:a,yieldTo:this._yieldTo,title:G(928,`Insert HTML`),kind:this.kind}]}}};async function Tm(e){let t=e.get(Si.uriList);if(!t)return[];let n=await t.asString(),r=[];for(let e of Zp.parse(n))try{r.push({uri:ur.parse(e),originalText:e})}catch{}return r}var Em={scheme:`*`,hasAccessToAllModels:!0},Dm=class extends x{constructor(e,t){super(),this._register(e.documentDropEditProvider.register(Em,new xm)),this._register(e.documentDropEditProvider.register(Em,new Sm)),this._register(e.documentDropEditProvider.register(Em,new Cm(t)))}};Dm=vm([ym(0,H),ym(1,Ps)],Dm);var Om=class extends x{constructor(e,t){super(),this._register(e.documentPasteEditProvider.register(Em,new xm)),this._register(e.documentPasteEditProvider.register(Em,new Sm)),this._register(e.documentPasteEditProvider.register(Em,new Cm(t))),this._register(e.documentPasteEditProvider.register(Em,new wm))}};Om=vm([ym(0,H),ym(1,Ps)],Om);var km=class e{constructor(){this.value=``,this.pos=0}static{this._table={36:0,58:1,44:2,123:3,125:4,92:5,47:6,124:7,43:11,45:12,63:13}}static isDigitCharacter(e){return e>=48&&e<=57}static isVariableCharacter(e){return e===95||e>=97&&e<=122||e>=65&&e<=90}text(e){this.value=e,this.pos=0}tokenText(e){return this.value.substr(e.pos,e.len)}next(){if(this.pos>=this.value.length)return{type:14,pos:this.pos,len:0};let t=this.pos,n=0,r=this.value.charCodeAt(t),i;if(i=e._table[r],typeof i==`number`)return this.pos+=1,{type:i,pos:t,len:1};if(e.isDigitCharacter(r)){i=8;do n+=1,r=this.value.charCodeAt(t+n);while(e.isDigitCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}if(e.isVariableCharacter(r)){i=9;do r=this.value.charCodeAt(t+ ++n);while(e.isVariableCharacter(r)||e.isDigitCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}i=10;do n+=1,r=this.value.charCodeAt(t+n);while(!isNaN(r)&&e._table[r]===void 0&&!e.isDigitCharacter(r)&&!e.isVariableCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}},Am=class{constructor(){this._children=[]}appendChild(e){return e instanceof jm&&this._children[this._children.length-1]instanceof jm?this._children[this._children.length-1].value+=e.value:(e.parent=this,this._children.push(e)),this}replace(e,t){let{parent:n}=e,r=n.children.indexOf(e),i=n.children.slice(0);i.splice(r,1,...t),n._children=i,(function e(t,n){for(let r of t)r.parent=n,e(r.children,r)})(t,n)}get children(){return this._children}get rightMostDescendant(){return this._children.length>0?this._children[this._children.length-1].rightMostDescendant:this}get snippet(){let e=this;for(;;){if(!e)return;if(e instanceof zm)return e;e=e.parent}}toString(){return this.children.reduce((e,t)=>e+t.toString(),``)}len(){return 0}},jm=class e extends Am{constructor(e){super(),this.value=e}toString(){return this.value}len(){return this.value.length}clone(){return new e(this.value)}},Mm=class extends Am{},Nm=class e extends Mm{static compareByIndex(e,t){return e.index===t.index?0:e.isFinalTabstop?1:t.isFinalTabstop||e.index<t.index?-1:e.index>t.index?1:0}constructor(e){super(),this.index=e}get isFinalTabstop(){return this.index===0}get choice(){return this._children.length===1&&this._children[0]instanceof Pm?this._children[0]:void 0}clone(){let t=new e(this.index);return this.transform&&(t.transform=this.transform.clone()),t._children=this.children.map(e=>e.clone()),t}},Pm=class e extends Am{constructor(){super(...arguments),this.options=[]}appendChild(e){return e instanceof jm&&(e.parent=this,this.options.push(e)),this}toString(){return this.options[0].value}len(){return this.options[0].len()}clone(){let t=new e;return this.options.forEach(t.appendChild,t),t}},Fm=class e extends Am{constructor(){super(...arguments),this.regexp=RegExp(``)}resolve(e){let t=this,n=!1,r=e.replace(this.regexp,function(){return n=!0,t._replace(Array.prototype.slice.call(arguments,0,-2))});return!n&&this._children.some(e=>e instanceof Im&&!!e.elseValue)&&(r=this._replace([])),r}_replace(e){let t=``;for(let n of this._children)if(n instanceof Im){let r=e[n.index]||``;r=n.resolve(r),t+=r}else t+=n.toString();return t}toString(){return``}clone(){let t=new e;return t.regexp=new RegExp(this.regexp.source,(this.regexp.ignoreCase?`i`:``)+(this.regexp.global?`g`:``)),t._children=this.children.map(e=>e.clone()),t}},Im=class e extends Am{constructor(e,t,n,r){super(),this.index=e,this.shorthandName=t,this.ifValue=n,this.elseValue=r}resolve(e){return this.shorthandName===`upcase`?e?e.toLocaleUpperCase():``:this.shorthandName===`downcase`?e?e.toLocaleLowerCase():``:this.shorthandName===`capitalize`?e?e[0].toLocaleUpperCase()+e.substr(1):``:this.shorthandName===`pascalcase`?e?this._toPascalCase(e):``:this.shorthandName===`camelcase`?e?this._toCamelCase(e):``:e&&typeof this.ifValue==`string`?this.ifValue:!e&&typeof this.elseValue==`string`?this.elseValue:e||``}_toPascalCase(e){let t=e.match(/[a-z0-9]+/gi);return t?t.map(e=>e.charAt(0).toUpperCase()+e.substr(1)).join(``):e}_toCamelCase(e){let t=e.match(/[a-z0-9]+/gi);return t?t.map((e,t)=>t===0?e.charAt(0).toLowerCase()+e.substr(1):e.charAt(0).toUpperCase()+e.substr(1)).join(``):e}clone(){return new e(this.index,this.shorthandName,this.ifValue,this.elseValue)}},Lm=class e extends Mm{constructor(e){super(),this.name=e}resolve(e){let t=e.resolve(this);return this.transform&&(t=this.transform.resolve(t||``)),t===void 0?!1:(this._children=[new jm(t)],!0)}clone(){let t=new e(this.name);return this.transform&&(t.transform=this.transform.clone()),t._children=this.children.map(e=>e.clone()),t}};function Rm(e,t){let n=[...e];for(;n.length>0;){let e=n.shift();if(!t(e))break;n.unshift(...e.children)}}var zm=class e extends Am{get placeholderInfo(){if(!this._placeholders){let e=[],t;this.walk(function(n){return n instanceof Nm&&(e.push(n),t=!t||t.index<n.index?n:t),!0}),this._placeholders={all:e,last:t}}return this._placeholders}get placeholders(){let{all:e}=this.placeholderInfo;return e}offset(e){let t=0,n=!1;return this.walk(r=>r===e?(n=!0,!1):(t+=r.len(),!0)),n?t:-1}fullLen(e){let t=0;return Rm([e],e=>(t+=e.len(),!0)),t}enclosingPlaceholders(e){let t=[],{parent:n}=e;for(;n;)n instanceof Nm&&t.push(n),n=n.parent;return t}resolveVariables(e){return this.walk(t=>(t instanceof Lm&&t.resolve(e)&&(this._placeholders=void 0),!0)),this}appendChild(e){return this._placeholders=void 0,super.appendChild(e)}replace(e,t){return this._placeholders=void 0,super.replace(e,t)}clone(){let t=new e;return this._children=this.children.map(e=>e.clone()),t}walk(e){Rm(this.children,e)}},Bm=class{constructor(){this._scanner=new km,this._token={type:14,pos:0,len:0}}static escape(e){return e.replace(/\$|}|\\/g,`\\$&`)}static guessNeedsClipboard(e){return/\${?CLIPBOARD/.test(e)}parse(e,t,n){let r=new zm;return this.parseFragment(e,r),this.ensureFinalTabstop(r,n??!1,t??!1),r}parseFragment(e,t){let n=t.children.length;for(this._scanner.text(e),this._token=this._scanner.next();this._parse(t););let r=new Map,i=[];t.walk(e=>(e instanceof Nm&&(e.isFinalTabstop?r.set(0,void 0):!r.has(e.index)&&e.children.length>0?r.set(e.index,e.children):i.push(e)),!0));let a=(e,n)=>{let i=r.get(e.index);if(!i)return;let o=new Nm(e.index);o.transform=e.transform;for(let e of i){let t=e.clone();o.appendChild(t),t instanceof Nm&&r.has(t.index)&&!n.has(t.index)&&(n.add(t.index),a(t,n),n.delete(t.index))}t.replace(e,[o])},o=new Set;for(let e of i)a(e,o);return t.children.slice(n)}ensureFinalTabstop(e,t,n){(t||n&&e.placeholders.length>0)&&(e.placeholders.find(e=>e.index===0)||e.appendChild(new Nm(0)))}_accept(e,t){if(e===void 0||this._token.type===e){let e=t?this._scanner.tokenText(this._token):!0;return this._token=this._scanner.next(),e}return!1}_backTo(e){return this._scanner.pos=e.pos+e.len,this._token=e,!1}_until(e){let t=this._token;for(;this._token.type!==e;){if(this._token.type===14)return!1;if(this._token.type===5){let e=this._scanner.next();if(e.type!==0&&e.type!==4&&e.type!==5)return!1}this._token=this._scanner.next()}let n=this._scanner.value.substring(t.pos,this._token.pos).replace(/\\(\$|}|\\)/g,`$1`);return this._token=this._scanner.next(),n}_parse(e){return this._parseEscaped(e)||this._parseTabstopOrVariableName(e)||this._parseComplexPlaceholder(e)||this._parseComplexVariable(e)||this._parseAnything(e)}_parseEscaped(e){let t;return(t=this._accept(5,!0))?(t=this._accept(0,!0)||this._accept(4,!0)||this._accept(5,!0)||t,e.appendChild(new jm(t)),!0):!1}_parseTabstopOrVariableName(e){let t,n=this._token;return this._accept(0)&&(t=this._accept(9,!0)||this._accept(8,!0))?(e.appendChild(/^\d+$/.test(t)?new Nm(Number(t)):new Lm(t)),!0):this._backTo(n)}_parseComplexPlaceholder(e){let t,n=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(8,!0))))return this._backTo(n);let r=new Nm(Number(t));if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(r),!0;if(!this._parse(r))return e.appendChild(new jm("${"+t+`:`)),r.children.forEach(e.appendChild,e),!0}else if(r.index>0&&this._accept(7)){let t=new Pm;for(;;){if(this._parseChoiceElement(t)){if(this._accept(2))continue;if(this._accept(7)&&(r.appendChild(t),this._accept(4)))return e.appendChild(r),!0}return this._backTo(n),!1}}else if(this._accept(6))return this._parseTransform(r)?(e.appendChild(r),!0):(this._backTo(n),!1);else if(this._accept(4))return e.appendChild(r),!0;else return this._backTo(n)}_parseChoiceElement(e){let t=this._token,n=[];for(;!(this._token.type===2||this._token.type===7);){let e;if(e=(e=this._accept(5,!0))?this._accept(2,!0)||this._accept(7,!0)||this._accept(5,!0)||e:this._accept(void 0,!0),!e)return this._backTo(t),!1;n.push(e)}return n.length===0?(this._backTo(t),!1):(e.appendChild(new jm(n.join(``))),!0)}_parseComplexVariable(e){let t,n=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(9,!0))))return this._backTo(n);let r=new Lm(t);if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(r),!0;if(!this._parse(r))return e.appendChild(new jm("${"+t+`:`)),r.children.forEach(e.appendChild,e),!0}else if(this._accept(6))return this._parseTransform(r)?(e.appendChild(r),!0):(this._backTo(n),!1);else if(this._accept(4))return e.appendChild(r),!0;else return this._backTo(n)}_parseTransform(e){let t=new Fm,n=``,r=``;for(;!this._accept(6);){let e;if(e=this._accept(5,!0)){e=this._accept(6,!0)||e,n+=e;continue}if(this._token.type!==14){n+=this._accept(void 0,!0);continue}return!1}for(;!this._accept(6);){let e;if(e=this._accept(5,!0)){e=this._accept(5,!0)||this._accept(6,!0)||e,t.appendChild(new jm(e));continue}if(!(this._parseFormatString(t)||this._parseAnything(t)))return!1}for(;!this._accept(4);){if(this._token.type!==14){r+=this._accept(void 0,!0);continue}return!1}try{t.regexp=new RegExp(n,r)}catch{return!1}return e.transform=t,!0}_parseFormatString(e){let t=this._token;if(!this._accept(0))return!1;let n=!1;this._accept(3)&&(n=!0);let r=this._accept(8,!0);if(r)if(n){if(this._accept(4))return e.appendChild(new Im(Number(r))),!0;if(!this._accept(1))return this._backTo(t),!1}else return e.appendChild(new Im(Number(r))),!0;else return this._backTo(t),!1;if(this._accept(6)){let n=this._accept(9,!0);return!n||!this._accept(4)?(this._backTo(t),!1):(e.appendChild(new Im(Number(r),n)),!0)}else if(this._accept(11)){let t=this._until(4);if(t)return e.appendChild(new Im(Number(r),void 0,t,void 0)),!0}else if(this._accept(12)){let t=this._until(4);if(t)return e.appendChild(new Im(Number(r),void 0,void 0,t)),!0}else if(this._accept(13)){let t=this._until(1);if(t){let n=this._until(4);if(n)return e.appendChild(new Im(Number(r),void 0,t,n)),!0}}else{let t=this._until(4);if(t)return e.appendChild(new Im(Number(r),void 0,void 0,t)),!0}return this._backTo(t),!1}_parseAnything(e){return this._token.type===14?!1:(e.appendChild(new jm(this._scanner.tokenText(this._token))),this._accept(void 0),!0)}};function Vm(e,t,n){return(typeof n.insertText==`string`?n.insertText===``:n.insertText.snippet===``)?{edits:n.additionalEdit?.edits??[]}:{edits:[...t.map(t=>new xu(e,{range:t,text:typeof n.insertText==`string`?Bm.escape(n.insertText)+`$0`:n.insertText.snippet,insertAsSnippet:!0})),...n.additionalEdit?.edits??[]]}}function Hm(e){function t(e,t){return`mimeType`in e?e.mimeType===t.handledMimeType:!!t.kind&&e.kind.contains(t.kind)}let n=new Map;for(let r of e)for(let i of r.yieldTo??[])for(let a of e)if(a!==r&&t(i,a)){let e=n.get(r);e||(e=[],n.set(r,e)),e.push(a)}if(!n.size)return Array.from(e);let r=new Set,i=[];function a(e){if(!e.length)return[];let t=e[0];if(i.includes(t))return console.warn(`Yield to cycle detected`,t),e;if(r.has(t))return a(e.slice(1));let o=[],s=n.get(t);return s&&(i.push(t),o=a(s),i.pop()),r.add(t),[...o,t,...a(e.slice(1))]}return a(Array.from(e))}function Um(e,t){return t&&(e.stack||e.stacktrace)?G(29,`{0}: {1}`,Gm(e),Wm(e.stack)||Wm(e.stacktrace)):Gm(e)}function Wm(e){return Array.isArray(e)?e.join(`
`):e}function Gm(e){return e.code===`ERR_UNC_HOST_NOT_ALLOWED`?`${e.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof e.code==`string`&&typeof e.errno==`number`&&typeof e.syscall==`string`?G(30,`A system error occurred ({0})`,e.message):e.message||G(31,`An unknown error occurred. Please consult the log for more details.`)}function Km(e=null,t=!1){if(!e)return G(32,`An unknown error occurred. Please consult the log for more details.`);if(Array.isArray(e)){let n=ki(e),r=Km(n[0],t);return n.length>1?G(33,`{0} ({1} errors in total)`,r,n.length):r}if(Ae(e))return e;if(e.detail){let n=e.detail;if(n.error)return Um(n.error,t);if(n.exception)return Um(n.exception,t)}return e.stack?Um(e,t):e.message?e.message:G(34,`An unknown error occurred. Please consult the log for more details.`)}var qm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Jm=function(e,t){return function(n,r){t(n,r,e)}};const Ym=`acceptSelectedCodeAction`,Xm=`previewSelectedCodeAction`;var Zm=class{get templateId(){return`header`}renderTemplate(e){e.classList.add(`group-header`);let t=document.createElement(`span`);return e.append(t),{container:e,text:t}}renderElement(e,t,n){n.text.textContent=e.group?.title??e.label??``}disposeTemplate(e){}},Qm=class{get templateId(){return`separator`}renderTemplate(e){e.classList.add(`separator`);let t=document.createElement(`span`);return e.append(t),{container:e,text:t}}renderElement(e,t,n){n.text.textContent=e.label??``}disposeTemplate(e){}},$m=class{get templateId(){return`action`}constructor(e,t){this._supportsPreview=e,this._keybindingService=t}renderTemplate(e){e.classList.add(this.templateId);let t=document.createElement(`div`);t.className=`icon`,e.append(t);let n=document.createElement(`span`);n.className=`title`,e.append(n);let r=document.createElement(`span`);r.className=`description`,e.append(r);let i=new Es(e,js);return{container:e,icon:t,text:n,description:r,keybinding:i}}renderElement(e,t,n){if(e.group?.icon?(n.icon.className=I.asClassName(e.group.icon),e.group.icon.color&&(n.icon.style.color=A(e.group.icon.color.id))):(n.icon.className=I.asClassName(X.lightBulb),n.icon.style.color=`var(--vscode-editorLightBulb-foreground)`),!e.item||!e.label)return;oe(!e.hideIcon,n.icon),n.text.textContent=ih(e.label),e.keybinding?(n.description.textContent=e.keybinding.getLabel(),n.description.style.display=`inline`,n.description.style.letterSpacing=`0.5px`):e.description?(n.description.textContent=ih(e.description),n.description.style.display=`inline`):(n.description.textContent=``,n.description.style.display=`none`);let r=this._keybindingService.lookupKeybinding(Ym)?.getLabel(),i=this._keybindingService.lookupKeybinding(Xm)?.getLabel();n.container.classList.toggle(`option-disabled`,e.disabled),e.tooltip?n.container.title=e.tooltip:e.disabled?n.container.title=e.label:r&&i?this._supportsPreview&&e.canPreview?n.container.title=G(1638,`{0} to Apply, {1} to Preview`,r,i):n.container.title=G(1639,`{0} to Apply`,r):n.container.title=``}disposeTemplate(e){e.keybinding.dispose()}};$m=qm([Jm(1,Yt)],$m);var eh=class extends UIEvent{constructor(){super(`acceptSelectedAction`)}},th=class extends UIEvent{constructor(){super(`previewSelectedAction`)}};function nh(e){if(e.kind===`action`)return e.label}var rh=class extends x{constructor(e,t,n,r,i,a,o,s){super(),this._delegate=r,this._contextViewService=a,this._keybindingService=o,this._layoutService=s,this._actionLineHeight=28,this._headerLineHeight=28,this._separatorLineHeight=8,this.cts=this._register(new Sr),this.domNode=document.createElement(`div`),this.domNode.classList.add(`actionList`),this._list=this._register(new vn(e,this.domNode,{getHeight:e=>{switch(e.kind){case`header`:return this._headerLineHeight;case`separator`:return this._separatorLineHeight;default:return this._actionLineHeight}},getTemplateId:e=>e.kind},[new $m(t,this._keybindingService),new Zm,new Qm],{keyboardSupport:!1,typeNavigationEnabled:!0,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:nh},accessibilityProvider:{getAriaLabel:e=>{if(e.kind===`action`){let t=e.label?ih(e?.label):``;return e.description&&(t=t+`, `+ih(e.description)),e.disabled&&(t=G(1640,`{0}, Disabled Reason: {1}`,t,e.disabled)),t}return null},getWidgetAriaLabel:()=>G(1641,`Action Widget`),getRole:e=>{switch(e.kind){case`action`:return`option`;case`separator`:return`separator`;default:return`separator`}},getWidgetRole:()=>`listbox`,...i}})),this._list.style(Fi),this._register(this._list.onMouseClick(e=>this.onListClick(e))),this._register(this._list.onMouseOver(e=>this.onListHover(e))),this._register(this._list.onDidChangeFocus(()=>this.onFocus())),this._register(this._list.onDidChangeSelection(e=>this.onListSelection(e))),this._allMenuItems=n,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(e){return!e.disabled&&e.kind===`action`}hide(e){this._delegate.onHide(e),this.cts.cancel(),this._contextViewService.hideContextView()}layout(e){let t=this._allMenuItems.filter(e=>e.kind===`header`).length,n=this._allMenuItems.filter(e=>e.kind===`separator`).length,r=this._allMenuItems.length*this._actionLineHeight+t*this._headerLineHeight-t*this._actionLineHeight+n*this._separatorLineHeight-n*this._actionLineHeight;this._list.layout(r);let i=e;if(this._allMenuItems.length>=50)i=380;else{let t=this._allMenuItems.map((e,t)=>{let n=this.domNode.ownerDocument.getElementById(this._list.getElementID(t));if(n){n.style.width=`auto`;let e=n.getBoundingClientRect().width;return n.style.width=``,e}return 0});i=Math.max(...t,e)}let a=Math.min(r,this._layoutService.getContainer(eo(this.domNode)).clientHeight*.7);return this._list.layout(a,i),this.domNode.style.height=`${a}px`,this._list.domFocus(),i}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(e){let t=this._list.getFocus();if(t.length===0)return;let n=t[0],r=this._list.element(n);if(!this.focusCondition(r))return;let i=e?new th:new eh;this._list.setSelection([n],i)}onListSelection(e){if(!e.elements.length)return;let t=e.elements[0];t.item&&this.focusCondition(t)?this._delegate.onSelect(t.item,e.browserEvent instanceof th):this._list.setSelection([])}onFocus(){let e=this._list.getFocus();if(e.length===0)return;let t=e[0],n=this._list.element(t);this._delegate.onFocus?.(n.item)}async onListHover(e){let t=e.element;if(t&&t.item&&this.focusCondition(t)){if(this._delegate.onHover&&!t.disabled&&t.kind===`action`){let e=await this._delegate.onHover(t.item,this.cts.token);t.canPreview=e?e.canPreview:void 0}e.index&&this._list.splice(e.index,1,[t])}this._list.setFocus(typeof e.index==`number`?[e.index]:[])}onListClick(e){e.element&&this.focusCondition(e.element)&&this._list.setFocus([])}};rh=qm([Jm(5,Ml),Jm(6,Yt),Jm(7,Oc)],rh);function ih(e){return e.replace(/\r\n|\r|\n/g,` `)}var ah=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},oh=function(e,t){return function(n,r){t(n,r,e)}};F(`actionBar.toggledBackground`,yi,G(1642,`Background color for toggled action items in action bar.`));var sh={Visible:new N(`codeActionMenuVisible`,!1,G(1643,`Whether the action widget list is visible`))};const ch=ma(`actionWidgetService`);var lh=class extends x{get isVisible(){return sh.Visible.getValue(this._contextKeyService)||!1}constructor(e,t,n){super(),this._contextViewService=e,this._contextKeyService=t,this._instantiationService=n,this._list=this._register(new Bt)}show(e,t,n,r,i,a,o,s){let c=sh.Visible.bindTo(this._contextKeyService),l=this._instantiationService.createInstance(rh,e,t,n,r,s);this._contextViewService.showContextView({getAnchor:()=>i,render:e=>(c.set(!0),this._renderWidget(e,l,o??[])),onHide:e=>{c.reset(),this._onWidgetClosed(e)}},a,!1)}acceptSelected(e){this._list.value?.acceptSelected(e)}focusPrevious(){this._list?.value?.focusPrevious()}focusNext(){this._list?.value?.focusNext()}hide(e){this._list.value?.hide(e),this._list.clear()}_renderWidget(e,t,n){let r=document.createElement(`div`);if(r.classList.add(`action-widget`),e.appendChild(r),this._list.value=t,this._list.value)r.appendChild(this._list.value.domNode);else throw Error(`List has no value`);let i=new L,a=document.createElement(`div`),o=e.appendChild(a);o.classList.add(`context-view-block`),i.add(z(o,Pc.MOUSE_DOWN,e=>e.stopPropagation()));let s=document.createElement(`div`),c=e.appendChild(s);c.classList.add(`context-view-pointerBlock`),i.add(z(c,Pc.POINTER_MOVE,()=>c.remove())),i.add(z(c,Pc.MOUSE_DOWN,()=>c.remove()));let l=0;if(n.length){let e=this._createActionBar(`.action-widget-action-bar`,n);e&&(r.appendChild(e.getContainer().parentElement),i.add(e),l=e.getContainer().offsetWidth)}let u=this._list.value?.layout(l);r.style.width=`${u}px`;let d=i.add(Wn(e));return i.add(d.onDidBlur(()=>this.hide(!0))),i}_createActionBar(e,t){if(!t.length)return;let n=b(e),r=new Bn(n);return r.push(t,{icon:!1,label:!0}),r}_onWidgetClosed(e){this._list.value?.hide(e)}};lh=ah([oh(0,Ml),oh(1,On),oh(2,k)],lh),Ui(ch,lh,1);var uh=1100;j(class extends pi{constructor(){super({id:`hideCodeActionWidget`,title:U(1644,`Hide action widget`),precondition:sh.Visible,keybinding:{weight:uh,primary:9,secondary:[1033]}})}run(e){e.get(ch).hide(!0)}}),j(class extends pi{constructor(){super({id:`selectPrevCodeAction`,title:U(1645,`Select previous action`),precondition:sh.Visible,keybinding:{weight:uh,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})}run(e){let t=e.get(ch);t instanceof lh&&t.focusPrevious()}}),j(class extends pi{constructor(){super({id:`selectNextCodeAction`,title:U(1646,`Select next action`),precondition:sh.Visible,keybinding:{weight:uh,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})}run(e){let t=e.get(ch);t instanceof lh&&t.focusNext()}}),j(class extends pi{constructor(){super({id:Ym,title:U(1647,`Accept selected action`),precondition:sh.Visible,keybinding:{weight:uh,primary:3,secondary:[2137]}})}run(e){let t=e.get(ch);t instanceof lh&&t.acceptSelected()}}),j(class extends pi{constructor(){super({id:Xm,title:U(1648,`Preview selected action`),precondition:sh.Visible,keybinding:{weight:uh,primary:2051}})}run(e){let t=e.get(ch);t instanceof lh&&t.acceptSelected(!0)}});var dh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fh=function(e,t){return function(n,r){t(n,r,e)}},ph,mh=class extends x{static{ph=this}static{this.baseId=`editor.widget.postEditWidget`}constructor(e,t,n,r,i,a,o,s,c,l,u){super(),this.typeId=e,this.editor=t,this.showCommand=r,this.range=i,this.edits=a,this.onSelectNewEdit=o,this.additionalActions=s,this._keybindingService=l,this._actionWidgetService=u,this.allowEditorOverflow=!0,this.suppressMouseDown=!0,this.create(),this.visibleContext=n.bindTo(c),this.visibleContext.set(!0),this._register(Cl(()=>this.visibleContext.reset())),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this),this._register(Cl((()=>this.editor.removeContentWidget(this)))),this._register(this.editor.onDidChangeCursorPosition(e=>{this.dispose()})),this._register(An.runAndSubscribe(l.onDidUpdateKeybindings,()=>{this._updateButtonTitle()}))}_updateButtonTitle(){let e=this._keybindingService.lookupKeybinding(this.showCommand.id)?.getLabel();this.button.element.title=this.showCommand.label+(e?` (${e})`:``)}create(){this.domNode=b(`.post-edit-widget`),this.button=this._register(new mi(this.domNode,{supportIcons:!0})),this.button.label=`$(insert)`,this._register(z(this.domNode,Pc.CLICK,()=>this.showSelector()))}getId(){return ph.baseId+`.`+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:this.range.getEndPosition(),preference:[2]}}showSelector(){let e=vs(this.button.element),t={x:e.left+e.width,y:e.top+e.height};this._actionWidgetService.show(`postEditWidget`,!1,this.edits.allEdits.map((e,t)=>({kind:`action`,item:e,label:e.title,disabled:!1,canPreview:!1,group:{title:``,icon:I.fromId(t===this.edits.activeEditIndex?X.check.id:X.blank.id)}})),{onHide:()=>{this.editor.focus()},onSelect:e=>{this._actionWidgetService.hide(!1);let t=this.edits.allEdits.findIndex(t=>t===e);if(t!==this.edits.activeEditIndex)return this.onSelectNewEdit(t)}},t,this.editor.getDomNode()??void 0,this.additionalActions)}};mh=ph=dh([fh(8,On),fh(9,Yt),fh(10,ch)],mh);var hh=class extends x{constructor(e,t,n,r,i,a,o,s){super(),this._id=e,this._editor=t,this._visibleContext=n,this._showCommand=r,this._getAdditionalActions=i,this._instantiationService=a,this._bulkEditService=o,this._notificationService=s,this._currentWidget=this._register(new Bt),this._register(An.any(t.onDidChangeModel,t.onDidChangeModelContent)(()=>this.clear()))}async applyEditAndShowIfNeeded(e,t,n,r,i){if(!e.length||!this._editor.hasModel())return;let a=this._editor.getModel(),o=t.allEdits.at(t.activeEditIndex);if(!o)return;let s=async a=>{let o=this._editor.getModel();o&&(await o.undo(),this.applyEditAndShowIfNeeded(e,{activeEditIndex:a,allEdits:t.allEdits},n,r,i))},c=(r,i)=>{Gn(r)||(this._notificationService.error(i),n&&this.show(e[0],t,s))},l=new Eu(this._editor,3,void 0,i),u;try{u=await rc(r(o,l.token),l.token)}catch(e){return c(e,G(932,`Error resolving edit '{0}':
{1}`,o.title,Km(e)))}finally{l.dispose()}if(i.isCancellationRequested)return;let d=Vm(a.uri,e,u),f=e[0],p=a.deltaDecorations([],[{range:f,options:{description:`paste-line-suffix`,stickiness:0}}]);this._editor.focus();let m,h;try{m=await this._bulkEditService.apply(d,{editor:this._editor,token:i}),h=a.getDecorationRange(p[0])}catch(e){return c(e,G(933,`Error applying edit '{0}':
{1}`,o.title,Km(e)))}finally{a.deltaDecorations(p,[])}i.isCancellationRequested||n&&m.isApplied&&t.allEdits.length>1&&this.show(h??f,t,s)}show(e,t,n){this.clear(),this._editor.hasModel()&&(this._currentWidget.value=this._instantiationService.createInstance(mh,this._id,this._editor,this._visibleContext,this._showCommand,e,t,n,this._getAdditionalActions()))}clear(){this._currentWidget.clear()}tryShowSelector(){this._currentWidget.value?.showSelector()}};hh=dh([fh(5,k),fh(6,Fa),fh(7,Ur)],hh);var gh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_h=function(e,t){return function(n,r){t(n,r,e)}},vh;const yh=`editor.changePasteType`,bh=new N(`pasteWidgetVisible`,!1,G(912,`Whether the paste widget is showing`));var xh=`application/vnd.code.copymetadata`,Sh=class extends x{static{vh=this}static{this.ID=`editor.contrib.copyPasteActionController`}static get(e){return e.getContribution(vh.ID)}constructor(e,t,n,r,i,a,o,s,c,l){super(),this._logService=n,this._bulkEditService=r,this._clipboardService=i,this._commandService=a,this._configService=o,this._languageFeaturesService=s,this._quickInputService=c,this._progressService=l,this._editor=e;let u=e.getContainerDomNode();this._register(z(u,`copy`,e=>this.handleCopy(e))),this._register(z(u,`cut`,e=>this.handleCopy(e))),this._register(z(u,`paste`,e=>this.handlePaste(e),!0)),this._pasteProgressManager=this._register(new dm(`pasteIntoEditor`,e,t)),this._postPasteWidgetManager=this._register(t.createInstance(hh,`pasteIntoEditor`,e,bh,{id:yh,label:G(913,`Show paste options...`)},()=>vh._configureDefaultAction?[vh._configureDefaultAction]:[]))}changePasteType(){this._postPasteWidgetManager.tryShowSelector()}async pasteAs(e){this._logService.trace(`CopyPasteController.pasteAs`),this._editor.focus();try{this._logService.trace(`Before calling editor.action.clipboardPasteAction`),this._pasteAsActionContext={preferred:e},await this._commandService.executeCommand(`editor.action.clipboardPasteAction`)}finally{this._pasteAsActionContext=void 0}}clearWidgets(){this._postPasteWidgetManager.clear()}isPasteAsEnabled(){return this._editor.getOption(97).enabled}async finishedPaste(){await this._currentPasteOperation}handleCopy(e){let t=null;if(e.clipboardData){let[n,r]=yu.getTextData(e.clipboardData);t=(r||no.INSTANCE.get(n))?.id||null,this._logService.trace(`CopyPasteController#handleCopy for id : `,t,` with text.length : `,n.length)}else this._logService.trace(`CopyPasteController#handleCopy`);if(!this._editor.hasTextFocus()||(this._clipboardService.clearInternalState?.(),!e.clipboardData||!this.isPasteAsEnabled()))return;let n=this._editor.getModel(),r=this._editor.getSelections();if(!n||!r?.length)return;let i=this._editor.getOption(45),a=r,o=r.length===1&&r[0].isEmpty();if(o){if(!i)return;a=[new T(a[0].startLineNumber,1,a[0].startLineNumber,1+n.getLineLength(a[0].startLineNumber))]}let s=this._editor._getViewModel()?.getPlainTextToCopy(r,i,To),c={multicursorText:Array.isArray(s)?s:null,pasteOnNewLine:o,mode:null},l=this._languageFeaturesService.documentPasteEditProvider.ordered(n).filter(e=>!!e.prepareDocumentPaste);if(!l.length){this.setCopyMetadata(e.clipboardData,{defaultPastePayload:c});return}let u=rm(e.clipboardData),d=l.flatMap(e=>e.copyMimeTypes??[]),f=t??cs();this.setCopyMetadata(e.clipboardData,{id:f,providerCopyMimeTypes:d,defaultPastePayload:c});let p=l.map(e=>({providerMimeTypes:e.copyMimeTypes,operation:li(t=>e.prepareDocumentPaste(n,a,u,t).catch(e=>{console.error(e)}))}));vh._currentCopyOperation?.operations.forEach(e=>e.operation.cancel()),vh._currentCopyOperation={handle:f,operations:p}}async handlePaste(e){if(e.clipboardData){let[t,n]=yu.getTextData(e.clipboardData),r=n||no.INSTANCE.get(t);this._logService.trace(`CopyPasteController#handlePaste for id : `,r?.id)}else this._logService.trace(`CopyPasteController#handlePaste`);if(!e.clipboardData||!this._editor.hasTextFocus())return;hm.get(this._editor)?.closeMessage(),this._currentPasteOperation?.cancel(),this._currentPasteOperation=void 0;let t=this._editor.getModel(),n=this._editor.getSelections();if(!n?.length||!t||this._editor.getOption(104)||!this.isPasteAsEnabled()&&!this._pasteAsActionContext)return;let r=this.fetchCopyMetadata(e);this._logService.trace(`CopyPasteController#handlePaste with metadata : `,r?.id,` and text.length : `,e.clipboardData.getData(`text/plain`).length);let i=om(e.clipboardData);i.delete(xh);let a=Array.from(e.clipboardData.files).map(e=>e.type),o=[...e.clipboardData.types,...a,...r?.providerCopyMimeTypes??[],Si.uriList],s=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(e=>{let t=this._pasteAsActionContext?.preferred;return t&&!this.providerMatchesPreference(e,t)?!1:e.pasteMimeTypes?.some(e=>Yp(e,o))});if(!s.length){this._pasteAsActionContext?.preferred&&(this.showPasteAsNoEditMessage(n,this._pasteAsActionContext.preferred),e.preventDefault(),e.stopImmediatePropagation());return}e.preventDefault(),e.stopImmediatePropagation(),this._pasteAsActionContext?this.showPasteAsPick(this._pasteAsActionContext.preferred,s,n,i,r):this.doPasteInline(s,n,i,r,e)}showPasteAsNoEditMessage(e,t){let n=`only`in t?t.only.value:`preferences`in t?t.preferences.length?t.preferences.map(e=>e.value).join(`, `):G(914,`empty`):t.providerId;hm.get(this._editor)?.showMessage(G(915,`No paste edits for '{0}' found`,n),e[0].getStartPosition())}doPasteInline(e,t,n,r,i){this._logService.trace(`CopyPasteController#doPasteInline`);let a=this._editor;if(!a.hasModel())return;let o=new Eu(a,3,void 0),s=li(async a=>{let c=this._editor;if(!c.hasModel())return;let l=c.getModel(),u=new L,d=u.add(new Sr(a));u.add(o.token.onCancellationRequested(()=>d.cancel()));let f=d.token;try{if(await this.mergeInDataFromCopy(e,n,r,f),f.isCancellationRequested)return;let a=e.filter(e=>this.isSupportedPasteProvider(e,n));if(!a.length||a.length===1&&a[0]instanceof xm)return this.applyDefaultPasteHandler(n,r,f,i);let o={triggerKind:xo.Automatic},s=await this.getPasteEdits(a,n,l,t,o,f);if(u.add(s),f.isCancellationRequested)return;if(s.edits.length===1&&s.edits[0].provider instanceof xm)return this.applyDefaultPasteHandler(n,r,f,i);if(s.edits.length){let e=c.getOption(97).showPasteSelector===`afterPaste`;return this._postPasteWidgetManager.applyEditAndShowIfNeeded(t,{activeEditIndex:this.getInitialActiveEditIndex(l,s.edits),allEdits:s.edits},e,async(e,n)=>{if(!e.provider.resolveDocumentPasteEdit)return e;let r=e.provider.resolveDocumentPasteEdit(e,n),i=new ro,a=await this._pasteProgressManager.showWhile(t[0].getEndPosition(),G(916,`Resolving paste edit for '{0}'. Click to cancel`,e.title),ir(Promise.race([i.p,r]),n),{cancel:()=>i.cancel()},0);return a&&(e.insertText=a.insertText,e.additionalEdit=a.additionalEdit),e},f)}await this.applyDefaultPasteHandler(n,r,f,i)}finally{u.dispose(),this._currentPasteOperation===s&&(this._currentPasteOperation=void 0)}});this._pasteProgressManager.showWhile(t[0].getEndPosition(),G(917,`Running paste handlers. Click to cancel and do basic paste`),s,{cancel:async()=>{s.cancel(),!o.token.isCancellationRequested&&await this.applyDefaultPasteHandler(n,r,o.token,i)}}).finally(()=>{o.dispose()}),this._currentPasteOperation=s}showPasteAsPick(e,t,n,r,i){this._logService.trace(`CopyPasteController#showPasteAsPick`);let a=li(async o=>{let s=this._editor;if(!s.hasModel())return;let c=s.getModel(),l=new L,u=l.add(new Eu(s,3,void 0,o));try{if(await this.mergeInDataFromCopy(t,r,i,u.token),u.token.isCancellationRequested)return;let a=t.filter(t=>this.isSupportedPasteProvider(t,r,e));e&&(a=a.filter(t=>this.providerMatchesPreference(t,e)));let o={triggerKind:xo.PasteAs,only:e&&`only`in e?e.only:void 0},s=l.add(await this.getPasteEdits(a,r,c,n,o,u.token));if(u.token.isCancellationRequested)return;if(e&&(s={edits:s.edits.filter(t=>`only`in e?e.only.contains(t.kind):`preferences`in e?e.preferences.some(e=>e.contains(t.kind)):e.providerId===t.provider.id),dispose:s.dispose}),!s.edits.length){e&&this.showPasteAsNoEditMessage(n,e);return}let d;if(e)d=s.edits.at(0);else{let e={id:`editor.pasteAs.default`,label:G(918,`Configure default paste action`),edit:void 0},t=await this._quickInputService.pick([...s.edits.map(e=>({label:e.title,description:e.kind?.value,edit:e})),...vh._configureDefaultAction?[si({type:`separator`}),{label:vh._configureDefaultAction.label,edit:void 0}]:[]],{placeHolder:G(919,`Select Paste Action`)});if(t===e){vh._configureDefaultAction?.run();return}d=t?.edit}if(!d)return;let f=Vm(c.uri,n,d);await this._bulkEditService.apply(f,{editor:this._editor})}finally{l.dispose(),this._currentPasteOperation===a&&(this._currentPasteOperation=void 0)}});this._progressService.withProgress({location:10,title:G(920,`Running paste handlers`)},()=>a)}setCopyMetadata(e,t){this._logService.trace(`CopyPasteController#setCopyMetadata new id : `,t.id),e.setData(xh,JSON.stringify(t))}fetchCopyMetadata(e){if(this._logService.trace(`CopyPasteController#fetchCopyMetadata`),!e.clipboardData)return;let t=e.clipboardData.getData(xh);if(t)try{return JSON.parse(t)}catch{return}let[n,r]=yu.getTextData(e.clipboardData);if(r)return{defaultPastePayload:{mode:r.mode,multicursorText:r.multicursorText??null,pasteOnNewLine:!!r.isFromEmptySelection}}}async mergeInDataFromCopy(e,t,n,r){if(this._logService.trace(`CopyPasteController#mergeInDataFromCopy with metadata : `,n?.id),n?.id&&vh._currentCopyOperation?.handle===n.id){let n=vh._currentCopyOperation.operations.filter(t=>e.some(e=>e.pasteMimeTypes.some(e=>Yp(e,t.providerMimeTypes)))).map(e=>e.operation),i=await Promise.all(n);if(r.isCancellationRequested)return;for(let e of i.reverse())if(e)for(let[n,r]of e)t.replace(n,r)}if(!t.has(Si.uriList)){let e=await this._clipboardService.readResources();if(r.isCancellationRequested)return;e.length&&t.append(Si.uriList,Gp(Zp.create(e)))}}async getPasteEdits(e,t,n,r,i,a){let o=new L,s=await ir(Promise.all(e.map(async e=>{try{let s=await e.provideDocumentPasteEdits?.(n,r,t,i,a);return s&&o.add(s),s?.edits?.map(t=>({...t,provider:e}))}catch(e){Gn(e)||console.error(e);return}})),a),c=ki(s??[]).flat().filter(e=>!i.only||i.only.contains(e.kind));return{edits:Hm(c),dispose:()=>o.dispose()}}async applyDefaultPasteHandler(e,t,n,r){let i=await(e.get(Si.text)??e.get(`text`))?.asString()??``;if(n.isCancellationRequested)return;let a={clipboardEvent:r,text:i,pasteOnNewLine:t?.defaultPastePayload.pasteOnNewLine??!1,multicursorText:t?.defaultPastePayload.multicursorText??null,mode:null};this._logService.trace(`CopyPasteController#applyDefaultPasteHandler for id : `,t?.id),this._editor.trigger(`keyboard`,`paste`,a)}isSupportedPasteProvider(e,t,n){return e.pasteMimeTypes?.some(e=>t.matches(e))?!n||this.providerMatchesPreference(e,n):!1}providerMatchesPreference(e,t){return`only`in t?e.providedPasteEditKinds.some(e=>t.only.contains(e)):`preferences`in t?t.preferences.some(e=>t.preferences.some(t=>t.contains(e))):e.id===t.providerId}getInitialActiveEditIndex(e,t){let n=this._configService.getValue(`editor.pasteAs.preferences`,{resource:e.uri});for(let e of Array.isArray(n)?n:[]){let n=new Qp(e),r=t.findIndex(e=>n.contains(e.kind));if(r>=0)return r}return 0}};Sh=vh=gh([_h(1,k),_h(2,Wl),_h(3,Fa),_h(4,aa),_h(5,Te),_h(6,hn),_h(7,H),_h(8,Mu),_h(9,Xo)],Sh);var Ch=`9_cutcopypaste`,wh=pc||document.queryCommandSupported(`cut`),Th=pc||document.queryCommandSupported(`copy`),Eh=navigator.clipboard===void 0||gr?document.queryCommandSupported(`paste`):!0;function Dh(e){return e.register(),e}const Oh=wh?Dh(new te({id:`editor.action.clipboardCutAction`,precondition:void 0,kbOpts:pc?{primary:2102,win:{primary:2102,secondary:[1044]},weight:100}:void 0,menuOpts:[{menuId:S.MenubarEditMenu,group:`2_ccp`,title:G(809,`Cu&&t`),order:1},{menuId:S.EditorContext,group:Ch,title:G(810,`Cut`),when:y.writable,order:1},{menuId:S.CommandPalette,group:``,title:G(811,`Cut`),order:1},{menuId:S.SimpleEditorContext,group:Ch,title:G(812,`Cut`),when:y.writable,order:1}]})):void 0,kh=Th?Dh(new te({id:`editor.action.clipboardCopyAction`,precondition:void 0,kbOpts:pc?{primary:2081,win:{primary:2081,secondary:[2067]},weight:100}:void 0,menuOpts:[{menuId:S.MenubarEditMenu,group:`2_ccp`,title:G(813,`&&Copy`),order:2},{menuId:S.EditorContext,group:Ch,title:G(814,`Copy`),order:2},{menuId:S.CommandPalette,group:``,title:G(815,`Copy`),order:1},{menuId:S.SimpleEditorContext,group:Ch,title:G(816,`Copy`),order:2}]})):void 0;sc.appendMenuItem(S.MenubarEditMenu,{submenu:S.MenubarCopy,title:U(821,`Copy As`),group:`2_ccp`,order:3}),sc.appendMenuItem(S.EditorContext,{submenu:S.EditorContextCopy,title:U(822,`Copy As`),group:Ch,order:3}),sc.appendMenuItem(S.EditorContext,{submenu:S.EditorContextShare,title:U(823,`Share`),group:`11_share`,order:-1,when:E.and(E.notEquals(`resourceScheme`,`output`),y.editorTextFocus)}),sc.appendMenuItem(S.ExplorerContext,{submenu:S.ExplorerContextShare,title:U(824,`Share`),group:`11_share`,order:-1});const Ah=Eh?Dh(new te({id:`editor.action.clipboardPasteAction`,precondition:void 0,kbOpts:pc?{primary:2100,win:{primary:2100,secondary:[1043]},linux:{primary:2100,secondary:[1043]},weight:100}:void 0,menuOpts:[{menuId:S.MenubarEditMenu,group:`2_ccp`,title:G(817,`&&Paste`),order:4},{menuId:S.EditorContext,group:Ch,title:G(818,`Paste`),when:y.writable,order:4},{menuId:S.CommandPalette,group:``,title:G(819,`Paste`),order:1},{menuId:S.SimpleEditorContext,group:Ch,title:G(820,`Paste`),when:y.writable,order:4}]})):void 0;var jh=class extends R{constructor(){super({id:`editor.action.clipboardCopyWithSyntaxHighlightingAction`,label:U(825,`Copy with Syntax Highlighting`),precondition:void 0,kbOpts:{kbExpr:y.textInputFocus,primary:0,weight:100}})}run(e,t){let n=e.get(Wl);n.trace(`ExecCommandCopyWithSyntaxHighlightingAction#run`),t.hasModel()&&(!t.getOption(45)&&t.getSelection().isEmpty()||($u.forceCopyWithSyntaxHighlighting=!0,t.focus(),n.trace(`ExecCommandCopyWithSyntaxHighlightingAction (before execCommand copy)`),t.getContainerDomNode().ownerDocument.execCommand(`copy`),n.trace(`ExecCommandCopyWithSyntaxHighlightingAction (after execCommand copy)`),$u.forceCopyWithSyntaxHighlighting=!1))}};function Mh(e,t){e&&(e.addImplementation(1e4,`code-editor`,(e,n)=>{let r=e.get(Wl);r.trace(`registerExecCommandImpl (addImplementation code-editor for : `,t,`)`);let i=e.get(xl).getFocusedCodeEditor();if(i&&i.hasTextFocus()){let e=i.getOption(45),n=i.getSelection();return n&&n.isEmpty()&&!e||(i.getOption(170)&&t===`cut`?(Nh(i),r.trace(`registerExecCommandImpl (before execCommand copy)`),i.getContainerDomNode().ownerDocument.execCommand(`copy`),i.trigger(void 0,`cut`,void 0),r.trace(`registerExecCommandImpl (after execCommand copy)`)):(Nh(i),r.trace(`registerExecCommandImpl (before execCommand `+t+`)`),i.getContainerDomNode().ownerDocument.execCommand(t),r.trace(`registerExecCommandImpl (after execCommand `+t+`)`))),!0}return!1}),e.addImplementation(0,`generic-dom`,(e,n)=>{let r=e.get(Wl);return r.trace(`registerExecCommandImpl (addImplementation generic-dom for : `,t,`)`),r.trace(`registerExecCommandImpl (before execCommand `+t+`)`),ou().execCommand(t),r.trace(`registerExecCommandImpl (after execCommand `+t+`)`),!0}))}function Nh(e){if(e.getOption(170)){let t=zn.get(e.getId());t&&t.onWillCopy()}}Mh(Oh,`cut`),Mh(kh,`copy`),Ah&&(Ah.addImplementation(1e4,`code-editor`,(e,t)=>{let n=e.get(Wl);n.trace(`registerExecCommandImpl (addImplementation code-editor for : paste)`);let r=e.get(xl),i=e.get(aa),a=e.get(Fu),o=e.get(Wp),s=r.getFocusedCodeEditor();if(s&&s.hasModel()&&s.hasTextFocus()){if(s.getOption(170)){let e=zn.get(s.getId());e&&e.onWillPaste()}let e=vd.create(!0);n.trace(`registerExecCommandImpl (before triggerPaste)`);let t=i.triggerPaste(Ko().vscodeWindowId);return t?(n.trace(`registerExecCommandImpl (triggerPaste defined)`),t.then(async()=>{if(n.trace(`registerExecCommandImpl (after triggerPaste)`),o.quality!==`stable`){let t=e.elapsed();a.publicLog2(`editorAsyncPaste`,{duration:t})}return Sh.get(s)?.finishedPaste()??Promise.resolve()})):(n.trace(`registerExecCommandImpl (triggerPaste undefined)`),su?(n.trace(`registerExecCommandImpl (Paste handling on web)`),(async()=>{let e=await i.readText();if(e!==``){let t=no.INSTANCE.get(e),r=!1,i=null,a=null;t&&(r=s.getOption(45)&&!!t.isFromEmptySelection,i=t.multicursorText===void 0?null:t.multicursorText,a=t.mode),n.trace(`registerExecCommandImpl (clipboardText.length : `,e.length,` id : `,t?.id,`)`),s.trigger(`keyboard`,`paste`,{text:e,pasteOnNewLine:r,multicursorText:i,mode:a})}})()):!0)}return!1}),Ah.addImplementation(0,`generic-dom`,(e,t)=>(e.get(Wl).trace(`registerExecCommandImpl (addImplementation generic-dom for : paste)`),e.get(aa).triggerPaste(Ko().vscodeWindowId)??!1))),Th&&q(jh);const Ph=new class{constructor(){this.QuickFix=new Qp(`quickfix`),this.Refactor=new Qp(`refactor`),this.RefactorExtract=this.Refactor.append(`extract`),this.RefactorInline=this.Refactor.append(`inline`),this.RefactorMove=this.Refactor.append(`move`),this.RefactorRewrite=this.Refactor.append(`rewrite`),this.Notebook=new Qp(`notebook`),this.Source=new Qp(`source`),this.SourceOrganizeImports=this.Source.append(`organizeImports`),this.SourceFixAll=this.Source.append(`fixAll`),this.SurroundWith=this.Refactor.append(`surround`)}};var Fh;(function(e){e.Refactor=`refactor`,e.RefactorPreview=`refactor preview`,e.Lightbulb=`lightbulb`,e.Default=`other (default)`,e.SourceAction=`source action`,e.QuickFix=`quick fix action`,e.FixAll=`fix all`,e.OrganizeImports=`organize imports`,e.AutoFix=`auto fix`,e.QuickFixHover=`quick fix hover window`,e.OnSave=`save participants`,e.ProblemsView=`problems view`})(Fh||={});function Ih(e,t){return!(e.include&&!e.include.intersects(t)||e.excludes&&e.excludes.some(n=>Rh(t,n,e.include))||!e.includeSourceActions&&Ph.Source.contains(t))}function Lh(e,t){let n=t.kind?new Qp(t.kind):void 0;return!(e.include&&(!n||!e.include.contains(n))||e.excludes&&n&&e.excludes.some(t=>Rh(n,t,e.include))||!e.includeSourceActions&&n&&Ph.Source.contains(n)||e.onlyIncludePreferredActions&&!t.isPreferred)}function Rh(e,t,n){return!(!t.contains(e)||n&&t.contains(n))}var zh=class e{static fromUser(t,n){return!t||typeof t!=`object`?new e(n.kind,n.apply,!1):new e(e.getKindFromUser(t,n.kind),e.getApplyFromUser(t,n.apply),e.getPreferredUser(t))}static getApplyFromUser(e,t){switch(typeof e.apply==`string`?e.apply.toLowerCase():``){case`first`:return`first`;case`never`:return`never`;case`ifsingle`:return`ifSingle`;default:return t}}static getKindFromUser(e,t){return typeof e.kind==`string`?new Qp(e.kind):t}static getPreferredUser(e){return typeof e.preferred==`boolean`?e.preferred:!1}constructor(e,t,n){this.kind=e,this.apply=t,this.preferred=n}},Bh=class{constructor(e,t,n){this.action=e,this.provider=t,this.highlightRange=n}async resolve(e){if(this.provider?.resolveCodeAction&&!this.action.edit){let t;try{t=await this.provider.resolveCodeAction(this.action,e)}catch(e){ct(e)}t&&(this.action.edit=t.edit)}return this}};const Vh=`editor.action.codeAction`,Hh=`editor.action.quickFix`,Uh=`editor.action.refactor`,Wh=`editor.action.sourceAction`,Gh=`editor.action.organizeImports`,Kh=`editor.action.fixAll`;var qh=1e3,Jh=class e extends x{static codeActionsPreferredComparator(e,t){return e.isPreferred&&!t.isPreferred?-1:!e.isPreferred&&t.isPreferred?1:0}static codeActionsComparator({action:t},{action:n}){return t.isAI&&!n.isAI?1:!t.isAI&&n.isAI?-1:$t(t.diagnostics)?$t(n.diagnostics)?e.codeActionsPreferredComparator(t,n):-1:$t(n.diagnostics)?1:e.codeActionsPreferredComparator(t,n)}constructor(t,n,r){super(),this.documentation=n,this._register(r),this.allActions=[...t].sort(e.codeActionsComparator),this.validActions=this.allActions.filter(({action:e})=>!e.disabled)}get hasAutoFix(){return this.validActions.some(({action:e})=>!!e.kind&&Ph.QuickFix.contains(new Qp(e.kind))&&!!e.isPreferred)}get hasAIFix(){return this.validActions.some(({action:e})=>!!e.isAI)}get allAIFixes(){return this.validActions.every(({action:e})=>!!e.isAI)}},Yh={actions:[],documentation:void 0};async function Xh(e,t,n,r,i,a){let o=r.filter||{},s={...o,excludes:[...o.excludes||[],Ph.Notebook]},c={only:o.include?.value,trigger:r.type},l=new ii(t,a),u=r.type===2,d=Zh(e,t,u?s:o),f=new L,p=d.map(async e=>{let r=setTimeout(()=>i.report(e),1250);try{let r=await e.provideCodeActions(t,n,c,l.token);if(l.token.isCancellationRequested)return r?.dispose(),Yh;r&&f.add(r);let i=(r?.actions||[]).filter(e=>e&&Lh(o,e)),a=$h(e,i,o.include);return{actions:i.map(t=>new Bh(t,e)),documentation:a}}catch(e){if(Gn(e))throw e;return ct(e),Yh}finally{clearTimeout(r)}}),m=e.onDidChange(()=>{let n=e.all(t);bt(n,d)||l.cancel()});try{let n=await Promise.all(p),i=n.map(e=>e.actions).flat(),a=[...ki(n.map(e=>e.documentation)),...Qh(e,t,r,i)],o=new Jh(i,a,f);return f.add(o),o}catch(e){throw f.dispose(),e}finally{m.dispose(),l.dispose()}}function Zh(e,t,n){return e.all(t).filter(e=>e.providedCodeActionKinds?e.providedCodeActionKinds.some(e=>Ih(n,new Qp(e))):!0)}function*Qh(e,t,n,r){if(t&&r.length)for(let i of e.all(t))i._getAdditionalMenuItems&&(yield*i._getAdditionalMenuItems?.({trigger:n.type,only:n.filter?.include?.value},r.map(e=>e.action)))}function $h(e,t,n){if(!e.documentation)return;let r=e.documentation.map(e=>({kind:new Qp(e.kind),command:e.command}));if(n){let e;for(let t of r)t.kind.contains(n)&&(e?e.kind.contains(t.kind)&&(e=t):e=t);if(e)return e?.command}for(let e of t)if(e.kind){for(let t of r)if(t.kind.contains(new Qp(e.kind)))return t.command}}var eg;(function(e){e.OnSave=`onSave`,e.FromProblemsView=`fromProblemsView`,e.FromCodeActions=`fromCodeActions`,e.FromAILightbulb=`fromAILightbulb`,e.FromProblemsHover=`fromProblemsHover`})(eg||={});async function tg(e,t,n,r,i=M.None){let a=e.get(Fa),o=e.get(Te),s=e.get(Fu),c=e.get(Ur),l=e.get(Zt);if(s.publicLog2(`codeAction.applyCodeAction`,{codeActionTitle:t.action.title,codeActionKind:t.action.kind,codeActionIsPreferred:!!t.action.isPreferred,reason:n}),l.playSignal(fl.codeActionTriggered),await t.resolve(i),!i.isCancellationRequested&&!(t.action.edit?.edits.length&&!(await a.apply(t.action.edit,{editor:r?.editor,label:t.action.title,quotableLabel:t.action.title,code:`undoredo.codeAction`,respectAutoSaveConfig:n!==eg.OnSave,showPreview:r?.preview,reason:Fe.codeAction({kind:t.action.kind,providerId:Ba.fromExtensionId(t.provider?.extensionId)})})).isApplied)){if(t.action.command)try{await o.executeCommand(t.action.command.id,...t.action.command.arguments||[])}catch(e){let t=ng(e);c.error(typeof t==`string`?t:G(826,`An unknown error occurred while applying the code action`))}setTimeout(()=>l.playSignal(fl.codeActionApplied),qh)}}function ng(e){if(typeof e==`string`)return e;if(e instanceof Error&&typeof e.message==`string`)return e.message}gd.registerCommand(`_executeCodeActionProvider`,async function(e,t,n,r,i){if(!(t instanceof ur))throw Pn();let{codeActionProvider:a}=e.get(H),o=e.get(_n).getModel(t);if(!o)throw Pn();let s=P.isISelection(n)?P.liftSelection(n):T.isIRange(n)?o.validateRange(n):void 0;if(!s)throw Pn();let c=typeof r==`string`?new Qp(r):void 0,l=await Xh(a,o,s,{type:1,triggerAction:Fh.Default,filter:{includeSourceActions:!0,include:c}},ol.None,M.None),u=[],d=Math.min(l.validActions.length,typeof i==`number`?i:0);for(let e=0;e<d;e++)u.push(l.validActions[e].resolve(M.None));try{return await Promise.all(u),l.validActions.map(e=>e.action)}finally{setTimeout(()=>l.dispose(),100)}});var rg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ig=function(e,t){return function(n,r){t(n,r,e)}},ag,og=class{static{ag=this}static{this.codeActionCommands=[Uh,Vh,Wh,Gh,Kh]}constructor(e){this.keybindingService=e}getResolver(){let e=new Hc(()=>this.keybindingService.getKeybindings().filter(e=>ag.codeActionCommands.indexOf(e.command)>=0).filter(e=>e.resolvedKeybinding).map(e=>{let t=e.commandArgs;return e.command===`editor.action.organizeImports`?t={kind:Ph.SourceOrganizeImports.value}:e.command===`editor.action.fixAll`&&(t={kind:Ph.SourceFixAll.value}),{resolvedKeybinding:e.resolvedKeybinding,...zh.fromUser(t,{kind:Qp.None,apply:`never`})}}));return t=>{if(t.kind)return this.bestKeybindingForCodeAction(t,e.value)?.resolvedKeybinding}}bestKeybindingForCodeAction(e,t){if(!e.kind)return;let n=new Qp(e.kind);return t.filter(e=>e.kind.contains(n)).filter(t=>t.preferred?e.isPreferred:!0).reduceRight((e,t)=>e?e.kind.contains(t.kind)?t:e:t,void 0)}};og=ag=rg([ig(0,Yt)],og),F(`symbolIcon.arrayForeground`,ot,G(1480,`The foreground color for array symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.booleanForeground`,ot,G(1481,`The foreground color for boolean symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.classForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},G(1482,`The foreground color for class symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.colorForeground`,ot,G(1483,`The foreground color for color symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.constantForeground`,ot,G(1484,`The foreground color for constant symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.constructorForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},G(1485,`The foreground color for constructor symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.enumeratorForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},G(1486,`The foreground color for enumerator symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.enumeratorMemberForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},G(1487,`The foreground color for enumerator member symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.eventForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},G(1488,`The foreground color for event symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.fieldForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},G(1489,`The foreground color for field symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.fileForeground`,ot,G(1490,`The foreground color for file symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.folderForeground`,ot,G(1491,`The foreground color for folder symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.functionForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},G(1492,`The foreground color for function symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.interfaceForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},G(1493,`The foreground color for interface symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.keyForeground`,ot,G(1494,`The foreground color for key symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.keywordForeground`,ot,G(1495,`The foreground color for keyword symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.methodForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},G(1496,`The foreground color for method symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.moduleForeground`,ot,G(1497,`The foreground color for module symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.namespaceForeground`,ot,G(1498,`The foreground color for namespace symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.nullForeground`,ot,G(1499,`The foreground color for null symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.numberForeground`,ot,G(1500,`The foreground color for number symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.objectForeground`,ot,G(1501,`The foreground color for object symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.operatorForeground`,ot,G(1502,`The foreground color for operator symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.packageForeground`,ot,G(1503,`The foreground color for package symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.propertyForeground`,ot,G(1504,`The foreground color for property symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.referenceForeground`,ot,G(1505,`The foreground color for reference symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.snippetForeground`,ot,G(1506,`The foreground color for snippet symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.stringForeground`,ot,G(1507,`The foreground color for string symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.structForeground`,ot,G(1508,`The foreground color for struct symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.textForeground`,ot,G(1509,`The foreground color for text symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.typeParameterForeground`,ot,G(1510,`The foreground color for type parameter symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.unitForeground`,ot,G(1511,`The foreground color for unit symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),F(`symbolIcon.variableForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},G(1512,`The foreground color for variable symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`));var sg=Object.freeze({kind:Qp.Empty,title:G(862,`More Actions...`)}),cg=Object.freeze([{kind:Ph.QuickFix,title:G(863,`Quick Fix`)},{kind:Ph.RefactorExtract,title:G(864,`Extract`),icon:X.wrench},{kind:Ph.RefactorInline,title:G(865,`Inline`),icon:X.wrench},{kind:Ph.RefactorRewrite,title:G(866,`Rewrite`),icon:X.wrench},{kind:Ph.RefactorMove,title:G(867,`Move`),icon:X.wrench},{kind:Ph.SurroundWith,title:G(868,`Surround With`),icon:X.surroundWith},{kind:Ph.Source,title:G(869,`Source Action`),icon:X.symbolFile},sg]);function lg(e,t,n){if(!t)return e.map(e=>({kind:`action`,item:e,group:sg,disabled:!!e.action.disabled,label:e.action.disabled||e.action.title,canPreview:!!e.action.edit?.edits.length}));let r=cg.map(e=>({group:e,actions:[]}));for(let t of e){let e=t.action.kind?new Qp(t.action.kind):Qp.None;for(let n of r)if(n.group.kind.contains(e)){n.actions.push(t);break}}let i=[];for(let e of r)if(e.actions.length){i.push({kind:`header`,group:e.group});for(let t of e.actions){let r=e.group;i.push({kind:`action`,item:t,group:t.action.isAI?{title:r.title,kind:r.kind,icon:X.sparkle}:r,label:t.action.title,disabled:!!t.action.disabled,keybinding:n(t.action)})}}return i}const ug=new N(`supportedCodeAction`,``);var dg=class extends x{constructor(e,t,n,r=250){super(),this._editor=e,this._markerService=t,this._signalChange=n,this._delay=r,this._autoTriggerTimer=this._register(new Me),this._register(this._markerService.onMarkerChanged(e=>this._onMarkerChanges(e))),this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()))}trigger(e){let t=this._getRangeOfSelectionUnlessWhitespaceEnclosed(e);this._signalChange(t?{trigger:e,selection:t}:void 0)}_onMarkerChanges(e){let t=this._editor.getModel();t&&e.some(e=>Ra(e,t.uri))&&this._tryAutoTrigger()}_tryAutoTrigger(){this._autoTriggerTimer.cancelAndSet(()=>{this.trigger({type:2,triggerAction:Fh.Default})},this._delay)}_getRangeOfSelectionUnlessWhitespaceEnclosed(e){if(!this._editor.hasModel())return;let t=this._editor.getSelection();if(e.type===1)return t;let n=this._editor.getOption(73).enabled;if(n!==Pr.Off){if(n===Pr.On)return t;if(n===Pr.OnCode){if(!t.isEmpty())return t;let e=this._editor.getModel(),{lineNumber:n,column:r}=t.getPosition(),i=e.getLineContent(n);if(i.length===0)return;if(r===1){if(/\s/.test(i[0]))return}else if(r===e.getLineMaxColumn(n)){if(/\s/.test(i[i.length-1]))return}else if(/\s/.test(i[r-2])&&/\s/.test(i[r-1]))return}return t}}},fg;(function(e){e.Empty={type:0};class t{constructor(e,t,n){this.trigger=e,this.position=t,this._cancellablePromise=n,this.type=1,this.actions=n.catch(e=>{if(Gn(e))return pg;throw e})}cancel(){this._cancellablePromise.cancel()}}e.Triggered=t})(fg||={});var pg=Object.freeze({allActions:[],validActions:[],dispose:()=>{},documentation:[],hasAutoFix:!1,hasAIFix:!1,allAIFixes:!1}),mg=class extends x{constructor(e,t,n,r,i,a){super(),this._editor=e,this._registry=t,this._markerService=n,this._progressService=i,this._configurationService=a,this._codeActionOracle=this._register(new Bt),this._state=fg.Empty,this._onDidChangeState=this._register(new D),this.onDidChangeState=this._onDidChangeState.event,this.codeActionsDisposable=this._register(new Bt),this._disposed=!1,this._supportedCodeActions=ug.bindTo(r),this._register(this._editor.onDidChangeModel(()=>this._update())),this._register(this._editor.onDidChangeModelLanguage(()=>this._update())),this._register(this._registry.onDidChange(()=>this._update())),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(73)&&this._update()})),this._update()}dispose(){this._disposed||(this._disposed=!0,super.dispose(),this.setState(fg.Empty,!0))}_settingEnabledNearbyQuickfixes(){let e=this._editor?.getModel();return this._configurationService?this._configurationService.getValue(`editor.codeActionWidget.includeNearbyQuickFixes`,{resource:e?.uri}):!1}_update(){if(this._disposed)return;this._codeActionOracle.value=void 0,this.setState(fg.Empty);let e=this._editor.getModel();if(e&&this._registry.has(e)&&!this._editor.getOption(104)){let t=this._registry.all(e).flatMap(e=>e.providedCodeActionKinds??[]);this._supportedCodeActions.set(t.join(` `)),this._codeActionOracle.value=new dg(this._editor,this._markerService,t=>{if(!t){this.setState(fg.Empty);return}let n=t.selection.getStartPosition(),r=li(async n=>{if(this._settingEnabledNearbyQuickfixes()&&t.trigger.type===1&&(t.trigger.triggerAction===Fh.QuickFix||t.trigger.filter?.include?.contains(Ph.QuickFix))){let r=await Xh(this._registry,e,t.selection,t.trigger,ol.None,n);this.codeActionsDisposable.value=r;let i=[...r.allActions];if(n.isCancellationRequested)return r.dispose(),pg;let a=r.validActions?.some(e=>e.action.kind&&Ph.QuickFix.contains(new Qp(e.action.kind))&&!e.action.isAI),o=this._markerService.read({resource:e.uri});if(a){for(let e of r.validActions)e.action.command?.arguments?.some(e=>typeof e==`string`&&e.includes(`_typescript.applyFixAllCodeAction`))&&(e.action.diagnostics=[...o.filter(e=>e.relatedInformation)]);return{validActions:r.validActions,allActions:i,documentation:r.documentation,hasAutoFix:r.hasAutoFix,hasAIFix:r.hasAIFix,allAIFixes:r.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=r}}}else if(!a&&o.length>0){let a=t.selection.getPosition(),s=a,c=Number.MAX_VALUE,l=[...r.validActions];for(let u of o){let d=u.endColumn,f=u.endLineNumber,p=u.startLineNumber;if(f===a.lineNumber||p===a.lineNumber){s=new C(f,d);let u={type:t.trigger.type,triggerAction:t.trigger.triggerAction,filter:{include:t.trigger.filter?.include?t.trigger.filter?.include:Ph.QuickFix},autoApply:t.trigger.autoApply,context:{notAvailableMessage:t.trigger.context?.notAvailableMessage||``,position:s}},p=new P(s.lineNumber,s.column,s.lineNumber,s.column),m=await Xh(this._registry,e,p,u,ol.None,n);if(n.isCancellationRequested)return m.dispose(),pg;if(m.validActions.length!==0){for(let e of m.validActions)e.action.command?.arguments?.some(e=>typeof e==`string`&&e.includes(`_typescript.applyFixAllCodeAction`))&&(e.action.diagnostics=[...o.filter(e=>e.relatedInformation)]);r.allActions.length===0&&i.push(...m.allActions),Math.abs(a.column-d)<c?l.unshift(...m.validActions):l.push(...m.validActions)}c=Math.abs(a.column-d)}}let u=l.filter((e,t,n)=>n.findIndex(t=>t.action.title===e.action.title)===t);return u.sort((e,t)=>e.action.isPreferred&&!t.action.isPreferred?-1:!e.action.isPreferred&&t.action.isPreferred||e.action.isAI&&!t.action.isAI?1:!e.action.isAI&&t.action.isAI?-1:0),{validActions:u,allActions:i,documentation:r.documentation,hasAutoFix:r.hasAutoFix,hasAIFix:r.hasAIFix,allAIFixes:r.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=r}}}}if(t.trigger.type===1){let r=await Xh(this._registry,e,t.selection,t.trigger,ol.None,n);return this.codeActionsDisposable.value=r,r}let r=await Xh(this._registry,e,t.selection,t.trigger,ol.None,n);return this.codeActionsDisposable.value=r,r});t.trigger.type===1&&this._progressService?.showWhile(r,250);let i=new fg.Triggered(t.trigger,n,r),a=!1;this._state.type===1&&(a=this._state.trigger.type===1&&i.type===1&&i.trigger.type===2&&this._state.position!==i.position),a?setTimeout(()=>{this.setState(i)},500):this.setState(i)},void 0),this._codeActionOracle.value.trigger({type:2,triggerAction:Fh.Default})}else this._supportedCodeActions.reset()}trigger(e){this._codeActionOracle.value?.trigger(e),this.codeActionsDisposable.dispose()}setState(e,t){e!==this._state&&(this._state.type===1&&this._state.cancel(),this._state=e,!t&&!this._disposed&&this._onDidChangeState.fire(e))}},hg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gg=function(e,t){return function(n,r){t(n,r,e)}},_g,vg=nu(`gutter-lightbulb`,X.lightBulb,G(870,`Icon which spawns code actions menu from the gutter when there is no space in the editor.`)),yg=nu(`gutter-lightbulb-auto-fix`,X.lightbulbAutofix,G(871,`Icon which spawns code actions menu from the gutter when there is no space in the editor and a quick fix is available.`)),bg=nu(`gutter-lightbulb-sparkle`,X.lightbulbSparkle,G(872,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix is available.`)),xg=nu(`gutter-lightbulb-aifix-auto-fix`,X.lightbulbSparkleAutofix,G(873,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.`)),Sg=nu(`gutter-lightbulb-sparkle-filled`,X.sparkleFilled,G(874,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.`)),Cg;(function(e){e.Hidden={type:0};class t{constructor(e,t,n,r){this.actions=e,this.trigger=t,this.editorPosition=n,this.widgetPosition=r,this.type=1}}e.Showing=t})(Cg||={});var wg=class extends x{static{_g=this}static{this.GUTTER_DECORATION=Y.register({description:`codicon-gutter-lightbulb-decoration`,glyphMarginClassName:I.asClassName(X.lightBulb),glyphMargin:{position:Rn.Left},stickiness:1})}static{this.ID=`editor.contrib.lightbulbWidget`}static{this._posPref=[0]}constructor(e,t){super(),this._editor=e,this._keybindingService=t,this._onClick=this._register(new D),this.onClick=this._onClick.event,this._state=Cg.Hidden,this._gutterState=Cg.Hidden,this._iconClasses=[],this.lightbulbClasses=[`codicon-`+vg.id,`codicon-`+xg.id,`codicon-`+yg.id,`codicon-`+bg.id,`codicon-`+Sg.id],this.gutterDecoration=_g.GUTTER_DECORATION,this._domNode=b(`div.lightBulbWidget`),this._domNode.role=`listbox`,this._register(Qe.ignoreTarget(this._domNode)),this._editor.addContentWidget(this),this._register(this._editor.onDidChangeModelContent(e=>{let t=this._editor.getModel();(this.state.type!==1||!t||this.state.editorPosition.lineNumber>=t.getLineCount())&&this.hide(),(this.gutterState.type!==1||!t||this.gutterState.editorPosition.lineNumber>=t.getLineCount())&&this.gutterHide()})),this._register(Gc(this._domNode,e=>{if(this.state.type!==1)return;this._editor.focus(),e.preventDefault();let{top:t,height:n}=vs(this._domNode),r=this._editor.getOption(75),i=Math.floor(r/3);this.state.widgetPosition.position!==null&&this.state.widgetPosition.position.lineNumber<this.state.editorPosition.lineNumber&&(i+=r),this._onClick.fire({x:e.posx,y:t+n+i,actions:this.state.actions,trigger:this.state.trigger})})),this._register(z(this._domNode,`mouseenter`,e=>{(e.buttons&1)==1&&this.hide()})),this._register(An.runAndSubscribe(this._keybindingService.onDidUpdateKeybindings,()=>{this._preferredKbLabel=this._keybindingService.lookupKeybinding(`editor.action.autoFix`)?.getLabel()??void 0,this._quickFixKbLabel=this._keybindingService.lookupKeybinding(`editor.action.quickFix`)?.getLabel()??void 0,this._updateLightBulbTitleAndIcon()})),this._register(this._editor.onMouseDown(async e=>{if(!e.target.element||!this.lightbulbClasses.some(t=>e.target.element&&e.target.element.classList.contains(t))||this.gutterState.type!==1)return;this._editor.focus();let{top:t,height:n}=vs(e.target.element),r=this._editor.getOption(75),i=Math.floor(r/3);this.gutterState.widgetPosition.position!==null&&this.gutterState.widgetPosition.position.lineNumber<this.gutterState.editorPosition.lineNumber&&(i+=r),this._onClick.fire({x:e.event.posx,y:t+n+i,actions:this.gutterState.actions,trigger:this.gutterState.trigger})}))}dispose(){super.dispose(),this._editor.removeContentWidget(this),this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID)}getId(){return`LightBulbWidget`}getDomNode(){return this._domNode}getPosition(){return this._state.type===1?this._state.widgetPosition:null}update(e,t,n){if(e.validActions.length<=0||!this._editor.hasTextFocus()||!this._editor.getOptions().get(73).enabled)return this.gutterHide(),this.hide();let r=this._editor.getModel();if(!r)return this.gutterHide(),this.hide();let{lineNumber:i,column:a}=r.validatePosition(n),o=r.getOptions().tabSize,s=this._editor.getOptions().get(59),c=r.getLineContent(i),l=gn(c,o),u=s.spaceWidth*l>22,d=e=>e>2&&this._editor.getTopForLineNumber(e)===this._editor.getTopForLineNumber(e-1),f=this._editor.getLineDecorations(i),p=!1;if(f)for(let e of f){let t=e.options.glyphMarginClassName;if(t&&!this.lightbulbClasses.some(e=>t.includes(e))){p=!0;break}}let m=i,h=1;if(!u){let o=e=>{let t=r.getLineContent(e);return/^\s*$|^\s+/.test(t)||t.length<=h};if(i>1&&!d(i-1)){let a=r.getLineCount(),s=i===a,c=i>1&&o(i-1),l=!s&&o(i+1),u=o(i),d=!l&&!c;if(!l&&!c&&!p)return this.gutterState=new Cg.Showing(e,t,n,{position:{lineNumber:m,column:h},preference:_g._posPref}),this.renderGutterLightbub(),this.hide();c||s||c&&!u?--m:(l||d&&u)&&(m+=1)}else if(i===1&&(i===r.getLineCount()||!o(i+1)&&!o(i)))if(this.gutterState=new Cg.Showing(e,t,n,{position:{lineNumber:m,column:h},preference:_g._posPref}),p)this.gutterHide();else return this.renderGutterLightbub(),this.hide();else if(i<r.getLineCount()&&!d(i+1))m+=1;else if(a*s.spaceWidth<22)return this.hide();h=/^\S\s*$/.test(r.getLineContent(m))?2:1}this.state=new Cg.Showing(e,t,n,{position:{lineNumber:m,column:h},preference:_g._posPref}),this._gutterDecorationID&&(this._removeGutterDecoration(this._gutterDecorationID),this.gutterHide());let g=e.validActions,_=e.validActions[0].action.kind;if(g.length!==1||!_){this._editor.layoutContentWidget(this);return}this._editor.layoutContentWidget(this)}hide(){this.state!==Cg.Hidden&&(this.state=Cg.Hidden,this._editor.layoutContentWidget(this))}gutterHide(){this.gutterState!==Cg.Hidden&&(this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID),this.gutterState=Cg.Hidden)}get state(){return this._state}set state(e){this._state=e,this._updateLightBulbTitleAndIcon()}get gutterState(){return this._gutterState}set gutterState(e){this._gutterState=e,this._updateGutterLightBulbTitleAndIcon()}_updateLightBulbTitleAndIcon(){if(this._domNode.classList.remove(...this._iconClasses),this._iconClasses=[],this.state.type!==1)return;let e,t=!1;this.state.actions.allAIFixes?(e=X.sparkleFilled,this.state.actions.validActions.length===1&&(t=!0)):e=this.state.actions.hasAutoFix?this.state.actions.hasAIFix?X.lightbulbSparkleAutofix:X.lightbulbAutofix:this.state.actions.hasAIFix?X.lightbulbSparkle:X.lightBulb,this._updateLightbulbTitle(this.state.actions.hasAutoFix,t),this._iconClasses=I.asClassNameArray(e),this._domNode.classList.add(...this._iconClasses)}_updateGutterLightBulbTitleAndIcon(){if(this.gutterState.type!==1)return;let e,t=!1;this.gutterState.actions.allAIFixes?(e=Sg,this.gutterState.actions.validActions.length===1&&(t=!0)):e=this.gutterState.actions.hasAutoFix?this.gutterState.actions.hasAIFix?xg:yg:this.gutterState.actions.hasAIFix?bg:vg,this._updateLightbulbTitle(this.gutterState.actions.hasAutoFix,t),this.gutterDecoration=Y.register({description:`codicon-gutter-lightbulb-decoration`,glyphMarginClassName:I.asClassName(e),glyphMargin:{position:Rn.Left},stickiness:1})}renderGutterLightbub(){let e=this._editor.getSelection();e&&(this._gutterDecorationID===void 0?this._addGutterDecoration(e.startLineNumber):this._updateGutterDecoration(this._gutterDecorationID,e.startLineNumber))}_addGutterDecoration(e){this._editor.changeDecorations(t=>{this._gutterDecorationID=t.addDecoration(new T(e,0,e,0),this.gutterDecoration)})}_removeGutterDecoration(e){this._editor.changeDecorations(t=>{t.removeDecoration(e),this._gutterDecorationID=void 0})}_updateGutterDecoration(e,t){this._editor.changeDecorations(n=>{n.changeDecoration(e,new T(t,0,t,0)),n.changeDecorationOptions(e,this.gutterDecoration)})}_updateLightbulbTitle(e,t){this.state.type===1&&(t?this.title=G(875,`Run: {0}`,this.state.actions.validActions[0].action.title):e&&this._preferredKbLabel?this.title=G(876,`Show Code Actions. Preferred Quick Fix Available ({0})`,this._preferredKbLabel):!e&&this._quickFixKbLabel?this.title=G(877,`Show Code Actions ({0})`,this._quickFixKbLabel):e||(this.title=G(878,`Show Code Actions`)))}set title(e){this._domNode.title=e}};wg=_g=hg([gg(1,Yt)],wg);var Tg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Eg=function(e,t){return function(n,r){t(n,r,e)}},Dg,Og=`quickfix-edit-highlight`,kg=class extends x{static{Dg=this}static{this.ID=`editor.contrib.codeActionController`}static get(e){return e.getContribution(Dg.ID)}constructor(e,t,n,r,i,a,o,s,c,l,u){super(),this._commandService=o,this._configurationService=s,this._actionWidgetService=c,this._instantiationService=l,this._progressService=u,this._activeCodeActions=this._register(new Bt),this._showDisabled=!1,this._disposed=!1,this._editor=e,this._model=this._register(new mg(this._editor,i.codeActionProvider,t,n,a,s)),this._register(this._model.onDidChangeState(e=>this.update(e))),this._lightBulbWidget=new Hc(()=>{let e=this._editor.getContribution(wg.ID);return e&&this._register(e.onClick(e=>this.showCodeActionsFromLightbulb(e.actions,e))),e}),this._resolver=r.createInstance(og),this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()))}dispose(){this._disposed=!0,super.dispose()}async showCodeActionsFromLightbulb(e,t){if(e.allAIFixes&&e.validActions.length===1){let t=e.validActions[0],n=t.action.command;n&&n.id===`inlineChat.start`&&n.arguments&&n.arguments.length>=1&&(n.arguments[0]={...n.arguments[0],autoSend:!1}),await this.applyCodeAction(t,!1,!1,eg.FromAILightbulb);return}await this.showCodeActionList(e,t,{includeDisabledActions:!1,fromLightbulb:!0})}showCodeActions(e,t,n){return this.showCodeActionList(t,n,{includeDisabledActions:!1,fromLightbulb:!1})}manualTriggerAtCurrentPosition(e,t,n,r){if(!this._editor.hasModel())return;hm.get(this._editor)?.closeMessage();let i=this._editor.getPosition();this._trigger({type:1,triggerAction:t,filter:n,autoApply:r,context:{notAvailableMessage:e,position:i}})}_trigger(e){return this._model.trigger(e)}async applyCodeAction(e,t,n,r){let i=this._progressService.show(!0,500);try{await this._instantiationService.invokeFunction(tg,e,r,{preview:n,editor:this._editor})}finally{t&&this._trigger({type:2,triggerAction:Fh.QuickFix,filter:{}}),i.done()}}hideLightBulbWidget(){this._lightBulbWidget.rawValue?.hide(),this._lightBulbWidget.rawValue?.gutterHide()}async update(e){if(e.type!==1){this.hideLightBulbWidget();return}let t;try{t=await e.actions}catch(e){mr(e);return}if(!this._disposed&&this._editor.getSelection()?.startLineNumber===e.position.lineNumber)if(this._lightBulbWidget.value?.update(t,e.trigger,e.position),e.trigger.type===1){if(e.trigger.filter?.include){let n=this.tryGetValidActionToApply(e.trigger,t);if(n){try{this.hideLightBulbWidget(),await this.applyCodeAction(n,!1,!1,eg.FromCodeActions)}finally{t.dispose()}return}if(e.trigger.context){let n=this.getInvalidActionThatWouldHaveBeenApplied(e.trigger,t);if(n&&n.action.disabled){hm.get(this._editor)?.showMessage(n.action.disabled,e.trigger.context.position),t.dispose();return}}}let n=!!e.trigger.filter?.include;if(e.trigger.context&&(!t.allActions.length||!n&&!t.validActions.length)){hm.get(this._editor)?.showMessage(e.trigger.context.notAvailableMessage,e.trigger.context.position),this._activeCodeActions.value=t,t.dispose();return}this._activeCodeActions.value=t,this.showCodeActionList(t,this.toCoords(e.position),{includeDisabledActions:n,fromLightbulb:!1})}else this._actionWidgetService.isVisible?t.dispose():this._activeCodeActions.value=t}getInvalidActionThatWouldHaveBeenApplied(e,t){if(t.allActions.length&&(e.autoApply===`first`&&t.validActions.length===0||e.autoApply===`ifSingle`&&t.allActions.length===1))return t.allActions.find(({action:e})=>e.disabled)}tryGetValidActionToApply(e,t){if(t.validActions.length&&(e.autoApply===`first`&&t.validActions.length>0||e.autoApply===`ifSingle`&&t.validActions.length===1))return t.validActions[0]}static{this.DECORATION=Y.register({description:`quickfix-highlight`,className:Og})}async showCodeActionList(e,t,n){let r=this._editor.createDecorationsCollection(),i=this._editor.getDomNode();if(!i)return;let a=n.includeDisabledActions&&(this._showDisabled||e.validActions.length===0)?e.allActions:e.validActions;if(!a.length)return;let o=C.isIPosition(t)?this.toCoords(t):t;this._actionWidgetService.show(`codeActionWidget`,!0,lg(a,this._shouldShowHeaders(),this._resolver.getResolver()),{onSelect:async(e,t)=>{this.applyCodeAction(e,!0,!!t,n.fromLightbulb?eg.FromAILightbulb:eg.FromCodeActions),this._actionWidgetService.hide(!1),r.clear()},onHide:e=>{this._editor?.focus(),r.clear()},onHover:async(e,t)=>{if(t.isCancellationRequested)return;let n=!1,r=e.action.kind;if(r){let e=new Qp(r);n=[Ph.RefactorExtract,Ph.RefactorInline,Ph.RefactorRewrite,Ph.RefactorMove,Ph.Source].some(t=>t.contains(e))}return{canPreview:n||!!e.action.edit?.edits.length}},onFocus:e=>{if(e&&e.action){let t=e.action.ranges,n=e.action.diagnostics;if(r.clear(),t&&t.length>0){let e=n&&n?.length>1?n.map(e=>({range:e,options:Dg.DECORATION})):t.map(e=>({range:e,options:Dg.DECORATION}));r.set(e)}else if(n&&n.length>0){let e=n.map(e=>({range:e,options:Dg.DECORATION}));r.set(e);let t=n[0];if(t.startLineNumber&&t.startColumn){let e=this._editor.getModel()?.getWordAtPosition({lineNumber:t.startLineNumber,column:t.startColumn})?.word;wr(G(859,`Context: {0} at line {1} and column {2}.`,e,t.startLineNumber,t.startColumn))}}}else r.clear()}},o,i,this._getActionBarActions(e,t,n))}toCoords(e){if(!this._editor.hasModel())return{x:0,y:0};this._editor.revealPosition(e,1),this._editor.render();let t=this._editor.getScrolledVisiblePosition(e),n=vs(this._editor.getDomNode()),r=n.left+t.left,i=n.top+t.top+t.height;return{x:r,y:i}}_shouldShowHeaders(){let e=this._editor?.getModel();return this._configurationService.getValue(`editor.codeActionWidget.showHeaders`,{resource:e?.uri})}_getActionBarActions(e,t,n){if(n.fromLightbulb)return[];let r=e.documentation.map(e=>({id:e.id,label:e.title,tooltip:e.tooltip??``,class:void 0,enabled:!0,run:()=>this._commandService.executeCommand(e.id,...e.arguments??[])}));return n.includeDisabledActions&&e.validActions.length>0&&e.allActions.length!==e.validActions.length&&r.push(this._showDisabled?{id:`hideMoreActions`,label:G(860,`Hide Disabled`),enabled:!0,tooltip:``,class:void 0,run:()=>(this._showDisabled=!1,this.showCodeActionList(e,t,n))}:{id:`showMoreActions`,label:G(861,`Show Disabled`),enabled:!0,tooltip:``,class:void 0,run:()=>(this._showDisabled=!0,this.showCodeActionList(e,t,n))}),r}};kg=Dg=Tg([Eg(1,cc),Eg(2,On),Eg(3,k),Eg(4,H),Eg(5,Oo),Eg(6,Te),Eg(7,hn),Eg(8,ch),Eg(9,k),Eg(10,Oo)],kg),ta((e,t)=>{((e,n)=>{n&&t.addRule(`.monaco-editor ${e} { background-color: ${n}; }`)})(`.quickfix-edit-highlight`,e.getColor(Ha));let n=e.getColor(Wc);n&&t.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${ce(e.type)?`dotted`:`solid`} ${n}; box-sizing: border-box; }`)});function Ag(e){return E.regex(ug.keys()[0],RegExp(`(\\s|^)`+Pt(e.value)+`\\b`))}var jg={type:`object`,defaultSnippets:[{body:{kind:``}}],properties:{kind:{type:`string`,description:G(827,`Kind of the code action to run.`)},apply:{type:`string`,description:G(828,`Controls when the returned actions are applied.`),default:`ifSingle`,enum:[`first`,`ifSingle`,`never`],enumDescriptions:[G(829,`Always apply the first returned code action.`),G(830,`Apply the first returned code action if it is the only one.`),G(831,`Do not apply the returned code actions.`)]},preferred:{type:`boolean`,default:!1,description:G(832,`Controls if only preferred code actions should be returned.`)}}};function Mg(e,t,n,r,i=Fh.Default){e.hasModel()&&kg.get(e)?.manualTriggerAtCurrentPosition(t,i,n,r)}var Ng=class extends R{constructor(){super({id:Hh,label:U(849,`Quick Fix...`),precondition:E.and(y.writable,y.hasCodeActionsProvider),kbOpts:{kbExpr:y.textInputFocus,primary:2137,weight:100}})}run(e,t){return Mg(t,G(833,`No code actions available`),void 0,void 0,Fh.QuickFix)}},Pg=class extends Ar{constructor(){super({id:Vh,precondition:E.and(y.writable,y.hasCodeActionsProvider),metadata:{description:`Trigger a code action`,args:[{name:`args`,schema:jg}]}})}runEditorCommand(e,t,n){let r=zh.fromUser(n,{kind:Qp.Empty,apply:`ifSingle`});return Mg(t,typeof n?.kind==`string`?r.preferred?G(834,`No preferred code actions for '{0}' available`,n.kind):G(835,`No code actions for '{0}' available`,n.kind):r.preferred?G(836,`No preferred code actions available`):G(837,`No code actions available`),{include:r.kind,includeSourceActions:!0,onlyIncludePreferredActions:r.preferred},r.apply)}},Fg=class extends R{constructor(){super({id:Uh,label:U(850,`Refactor...`),precondition:E.and(y.writable,y.hasCodeActionsProvider),kbOpts:{kbExpr:y.textInputFocus,primary:3120,mac:{primary:1328},weight:100},contextMenuOpts:{group:`1_modification`,order:2,when:E.and(y.writable,Ag(Ph.Refactor))},metadata:{description:`Refactor...`,args:[{name:`args`,schema:jg}]}})}run(e,t,n){let r=zh.fromUser(n,{kind:Ph.Refactor,apply:`never`});return Mg(t,typeof n?.kind==`string`?r.preferred?G(838,`No preferred refactorings for '{0}' available`,n.kind):G(839,`No refactorings for '{0}' available`,n.kind):r.preferred?G(840,`No preferred refactorings available`):G(841,`No refactorings available`),{include:Ph.Refactor.contains(r.kind)?r.kind:Qp.None,onlyIncludePreferredActions:r.preferred},r.apply,Fh.Refactor)}},Ig=class extends R{constructor(){super({id:Wh,label:U(851,`Source Action...`),precondition:E.and(y.writable,y.hasCodeActionsProvider),contextMenuOpts:{group:`1_modification`,order:2.1,when:E.and(y.writable,Ag(Ph.Source))},metadata:{description:`Source Action...`,args:[{name:`args`,schema:jg}]}})}run(e,t,n){let r=zh.fromUser(n,{kind:Ph.Source,apply:`never`});return Mg(t,typeof n?.kind==`string`?r.preferred?G(842,`No preferred source actions for '{0}' available`,n.kind):G(843,`No source actions for '{0}' available`,n.kind):r.preferred?G(844,`No preferred source actions available`):G(845,`No source actions available`),{include:Ph.Source.contains(r.kind)?r.kind:Qp.None,includeSourceActions:!0,onlyIncludePreferredActions:r.preferred},r.apply,Fh.SourceAction)}},Lg=class extends R{constructor(){super({id:Gh,label:U(852,`Organize Imports`),precondition:E.and(y.writable,Ag(Ph.SourceOrganizeImports)),kbOpts:{kbExpr:y.textInputFocus,primary:1581,weight:100},metadata:{description:U(853,`Organize imports in the current file. Also called 'Optimize Imports' by some tools`)}})}run(e,t){return Mg(t,G(846,`No organize imports action available`),{include:Ph.SourceOrganizeImports,includeSourceActions:!0},`ifSingle`,Fh.OrganizeImports)}},Rg=class extends R{constructor(){super({id:Kh,label:U(854,`Fix All`),precondition:E.and(y.writable,Ag(Ph.SourceFixAll))})}run(e,t){return Mg(t,G(847,`No fix all action available`),{include:Ph.SourceFixAll,includeSourceActions:!0},`ifSingle`,Fh.FixAll)}},zg=class extends R{constructor(){super({id:`editor.action.autoFix`,label:U(855,`Auto Fix...`),precondition:E.and(y.writable,Ag(Ph.QuickFix)),kbOpts:{kbExpr:y.textInputFocus,primary:1625,mac:{primary:2649},weight:100}})}run(e,t){return Mg(t,G(848,`No auto fixes available`),{include:Ph.QuickFix,onlyIncludePreferredActions:!0},`ifSingle`,Fh.AutoFix)}};K(kg.ID,kg,3),K(wg.ID,wg,4),q(Ng),q(Fg),q(Ig),q(Lg),q(zg),q(Rg),W(new Pg),br.as(It.Configuration).registerConfiguration({...us,properties:{"editor.codeActionWidget.showHeaders":{type:`boolean`,scope:6,description:G(856,`Enable/disable showing group headers in the Code Action menu.`),default:!0}}}),br.as(It.Configuration).registerConfiguration({...us,properties:{"editor.codeActionWidget.includeNearbyQuickFixes":{type:`boolean`,scope:6,description:G(857,`Enable/disable showing nearest Quick Fix within a line when not currently on a diagnostic.`),default:!0}}}),br.as(It.Configuration).registerConfiguration({...us,properties:{"editor.codeActions.triggerOnFocusChange":{type:`boolean`,scope:6,markdownDescription:G(858,`Enable triggering {0} when {1} is set to {2}. Code Actions must be set to {3} to be triggered for window and focus changes.`,"`#editor.codeActionsOnSave#`","`#files.autoSave#`","`afterDelay`","`always`"),default:!1}}});var Bg=class e{constructor(){this.lenses=[]}static{this.Empty=new e}dispose(){this._store?.dispose()}get isDisposed(){return this._store?.isDisposed??!1}add(e,t){yn(e)&&(this._store??=new L,this._store.add(e));for(let n of e.lenses)this.lenses.push({symbol:n,provider:t})}};async function Vg(e,t,n){let r=e.ordered(t),i=new Map,a=new Bg,o=r.map(async(e,r)=>{i.set(e,r);try{let r=await Promise.resolve(e.provideCodeLenses(t,n));r&&a.add(r,e)}catch(e){ct(e)}});return await Promise.all(o),n.isCancellationRequested?(a.dispose(),Bg.Empty):(a.lenses=a.lenses.sort((e,t)=>e.symbol.range.startLineNumber<t.symbol.range.startLineNumber?-1:e.symbol.range.startLineNumber>t.symbol.range.startLineNumber?1:i.get(e.provider)<i.get(t.provider)?-1:i.get(e.provider)>i.get(t.provider)?1:e.symbol.range.startColumn<t.symbol.range.startColumn?-1:e.symbol.range.startColumn>t.symbol.range.startColumn?1:0),a)}gd.registerCommand(`_executeCodeLensProvider`,function(e,...t){let[n,r]=t;J(ur.isUri(n)),J(typeof r==`number`||!r);let{codeLensProvider:i}=e.get(H),a=e.get(_n).getModel(n);if(!a)throw Pn();let o=[],s=new L;return Vg(i,a,M.None).then(e=>{s.add(e);let t=[];for(let n of e.lenses)r==null||n.symbol.command?o.push(n.symbol):r-- >0&&n.provider.resolveCodeLens&&t.push(Promise.resolve(n.provider.resolveCodeLens(a,n.symbol,M.None)).then(e=>o.push(e||n.symbol)));return Promise.all(t)}).then(()=>o).finally(()=>{setTimeout(()=>s.dispose(),100)})});var Hg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ug=function(e,t){return function(n,r){t(n,r,e)}};const Wg=ma(`ICodeLensCache`);var Gg=class{constructor(e,t){this.lineCount=e,this.data=t}},Kg=class{constructor(e){this._fakeProvider=new class{provideCodeLenses(){throw Error(`not supported`)}},this._cache=new ti(20,.75),ec(zs,()=>e.remove(`codelens/cache`,1));let t=`codelens/cache2`,n=e.get(t,1,`{}`);this._deserialize(n);let r=An.filter(e.onWillSaveState,e=>e.reason===Ne.SHUTDOWN);An.once(r)(n=>{e.store(t,this._serialize(),1,1)})}put(e,t){let n=t.lenses.map(e=>({range:e.symbol.range,command:e.symbol.command&&{id:``,title:e.symbol.command?.title}})),r=new Bg;r.add({lenses:n},this._fakeProvider);let i=new Gg(e.getLineCount(),r);this._cache.set(e.uri.toString(),i)}get(e){let t=this._cache.get(e.uri.toString());return t&&t.lineCount===e.getLineCount()?t.data:void 0}delete(e){this._cache.delete(e.uri.toString())}_serialize(){let e=Object.create(null);for(let[t,n]of this._cache){let r=new Set;for(let e of n.data.lenses)r.add(e.symbol.range.startLineNumber);e[t]={lineCount:n.lineCount,lines:[...r.values()]}}return JSON.stringify(e)}_deserialize(e){try{let t=JSON.parse(e);for(let e in t){let n=t[e],r=[];for(let e of n.lines)r.push({range:new T(e,1,e,11)});let i=new Bg;i.add({lenses:r},this._fakeProvider),this._cache.set(e,new Gg(n.lineCount,i))}}catch{}}};Kg=Hg([Ug(0,Qr)],Kg),Ui(Wg,Kg,1);var qg=class{constructor(e,t,n){this.afterColumn=1073741824,this.afterLineNumber=e,this.heightInPx=t,this._onHeight=n,this.suppressMouseDown=!0,this.domNode=document.createElement(`div`)}onComputedHeight(e){this._lastHeight===void 0?this._lastHeight=e:this._lastHeight!==e&&(this._lastHeight=e,this._onHeight())}isVisible(){return this._lastHeight!==0&&this.domNode.hasAttribute(`monaco-visible-view-zone`)}},Jg=class e{static{this._idPool=0}constructor(t,n){this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this._commands=new Map,this._isEmpty=!0,this._editor=t,this._id=`codelens.widget-${e._idPool++}`,this.updatePosition(n),this._domNode=document.createElement(`span`),this._domNode.className=`codelens-decoration`}withCommands(t,n){this._commands.clear();let r=[],i=!1;for(let n=0;n<t.length;n++){let a=t[n];if(a&&(i=!0,a.command)){let i=ue(a.command.title.trim());if(a.command.id){let t=`c${e._idPool++}`;r.push(b(`a`,{id:t,title:a.command.tooltip,role:`button`},...i)),this._commands.set(t,a.command)}else r.push(b(`span`,{title:a.command.tooltip},...i));n+1<t.length&&r.push(b(`span`,void 0,`\xA0|\xA0`))}}i?(Ve(this._domNode,...r),this._isEmpty&&n&&this._domNode.classList.add(`fadein`),this._isEmpty=!1):Ve(this._domNode,b(`span`,void 0,`no commands`))}getCommand(e){return e.parentElement===this._domNode?this._commands.get(e.id):void 0}getId(){return this._id}getDomNode(){return this._domNode}updatePosition(e){let t=this._editor.getModel().getLineFirstNonWhitespaceColumn(e);this._widgetPosition={position:{lineNumber:e,column:t},preference:[1]}}getPosition(){return this._widgetPosition||null}},Yg=class{constructor(){this._removeDecorations=[],this._addDecorations=[],this._addDecorationsCallbacks=[]}addDecoration(e,t){this._addDecorations.push(e),this._addDecorationsCallbacks.push(t)}removeDecoration(e){this._removeDecorations.push(e)}commit(e){let t=e.deltaDecorations(this._removeDecorations,this._addDecorations);for(let e=0,n=t.length;e<n;e++)this._addDecorationsCallbacks[e](t[e])}},Xg=Y.register({collapseOnReplaceEdit:!0,description:`codelens`}),Zg=class{constructor(e,t,n,r,i,a){this._isDisposed=!1,this._editor=t,this._data=e,this._decorationIds=[];let o,s=[];this._data.forEach((e,t)=>{e.symbol.command&&s.push(e.symbol),n.addDecoration({range:e.symbol.range,options:Xg},e=>this._decorationIds[t]=e),o=o?T.plusRange(o,e.symbol.range):T.lift(e.symbol.range)}),this._viewZone=new qg(o.startLineNumber-1,i,a),this._viewZoneId=r.addZone(this._viewZone),s.length>0&&(this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(s,!1))}_createContentWidgetIfNecessary(){this._contentWidget?this._editor.layoutContentWidget(this._contentWidget):(this._contentWidget=new Jg(this._editor,this._viewZone.afterLineNumber+1),this._editor.addContentWidget(this._contentWidget))}dispose(e,t){this._decorationIds.forEach(e.removeDecoration,e),this._decorationIds=[],t?.removeZone(this._viewZoneId),this._contentWidget&&=(this._editor.removeContentWidget(this._contentWidget),void 0),this._isDisposed=!0}isDisposed(){return this._isDisposed}isValid(){return this._decorationIds.some((e,t)=>{let n=this._editor.getModel().getDecorationRange(e),r=this._data[t].symbol;return!!(n&&T.isEmpty(r.range)===n.isEmpty())})}updateCodeLensSymbols(e,t){this._decorationIds.forEach(t.removeDecoration,t),this._decorationIds=[],this._data=e,this._data.forEach((e,n)=>{t.addDecoration({range:e.symbol.range,options:Xg},e=>this._decorationIds[n]=e)})}updateHeight(e,t){this._viewZone.heightInPx=e,t.layoutZone(this._viewZoneId),this._contentWidget&&this._editor.layoutContentWidget(this._contentWidget)}computeIfNecessary(e){if(!this._viewZone.isVisible())return null;for(let t=0;t<this._decorationIds.length;t++){let n=e.getDecorationRange(this._decorationIds[t]);n&&(this._data[t].symbol.range=n)}return this._data}updateCommands(e){this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(e,!0);for(let t=0;t<this._data.length;t++){let n=e[t];if(n){let{symbol:e}=this._data[t];e.command=n.command||e.command}}}getCommand(e){return this._contentWidget?.getCommand(e)}getLineNumber(){let e=this._editor.getModel().getDecorationRange(this._decorationIds[0]);return e?e.startLineNumber:-1}update(e){if(this.isValid()){let t=this._editor.getModel().getDecorationRange(this._decorationIds[0]);t&&(this._viewZone.afterLineNumber=t.startLineNumber-1,e.layoutZone(this._viewZoneId),this._contentWidget&&(this._contentWidget.updatePosition(t.startLineNumber),this._editor.layoutContentWidget(this._contentWidget)))}}},Qg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$g=function(e,t){return function(n,r){t(n,r,e)}},e_=class{static{this.ID=`css.editor.codeLens`}constructor(e,t,n,r,i,a){this._editor=e,this._languageFeaturesService=t,this._commandService=r,this._notificationService=i,this._codeLensCache=a,this._disposables=new L,this._localToDispose=new L,this._lenses=[],this._oldCodeLensModels=new L,this._provideCodeLensDebounce=n.for(t.codeLensProvider,`CodeLensProvide`,{min:250}),this._resolveCodeLensesDebounce=n.for(t.codeLensProvider,`CodeLensResolve`,{min:250,salt:`resolve`}),this._resolveCodeLensesScheduler=new Zr(()=>this._resolveCodeLensesInViewport(),this._resolveCodeLensesDebounce.default()),this._disposables.add(this._editor.onDidChangeModel(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{(e.hasChanged(59)||e.hasChanged(25)||e.hasChanged(24))&&this._updateLensStyle(),e.hasChanged(23)&&this._onModelChange()})),this._disposables.add(t.codeLensProvider.onDidChange(this._onModelChange,this)),this._onModelChange(),this._updateLensStyle()}dispose(){this._localDispose(),this._localToDispose.dispose(),this._disposables.dispose(),this._oldCodeLensModels.dispose(),this._currentCodeLensModel?.dispose()}_getLayoutInfo(){let e=Math.max(1.3,this._editor.getOption(75)/this._editor.getOption(61)),t=this._editor.getOption(25);return(!t||t<5)&&(t=this._editor.getOption(61)*.9|0),{fontSize:t,codeLensHeight:t*e|0}}_updateLensStyle(){let{codeLensHeight:e,fontSize:t}=this._getLayoutInfo(),n=this._editor.getOption(24),r=this._editor.getOption(59),{style:i}=this._editor.getContainerDomNode();i.setProperty(`--vscode-editorCodeLens-lineHeight`,`${e}px`),i.setProperty(`--vscode-editorCodeLens-fontSize`,`${t}px`),i.setProperty(`--vscode-editorCodeLens-fontFeatureSettings`,r.fontFeatureSettings),n&&(i.setProperty(`--vscode-editorCodeLens-fontFamily`,n),i.setProperty(`--vscode-editorCodeLens-fontFamilyDefault`,ga.fontFamily)),this._editor.changeViewZones(t=>{for(let n of this._lenses)n.updateHeight(e,t)})}_localDispose(){this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=void 0,this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0,this._localToDispose.clear(),this._oldCodeLensModels.clear(),this._currentCodeLensModel?.dispose()}_onModelChange(){this._localDispose();let e=this._editor.getModel();if(!e||!this._editor.getOption(23)||e.isTooLargeForTokenization())return;let t=this._codeLensCache.get(e);if(t&&this._renderCodeLensSymbols(t),!this._languageFeaturesService.codeLensProvider.has(e)){t&&$e(()=>{let n=this._codeLensCache.get(e);t===n&&(this._codeLensCache.delete(e),this._onModelChange())},30*1e3,this._localToDispose);return}for(let t of this._languageFeaturesService.codeLensProvider.all(e))if(typeof t.onDidChange==`function`){let e=t.onDidChange(()=>n.schedule());this._localToDispose.add(e)}let n=new Zr(()=>{let t=Date.now();this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=li(t=>Vg(this._languageFeaturesService.codeLensProvider,e,t)),this._getCodeLensModelPromise.then(r=>{this._currentCodeLensModel&&this._oldCodeLensModels.add(this._currentCodeLensModel),this._currentCodeLensModel=r,this._codeLensCache.put(e,r),n.delay=this._provideCodeLensDebounce.update(e,Date.now()-t),this._renderCodeLensSymbols(r),this._resolveCodeLensesInViewportSoon()},mr)},this._provideCodeLensDebounce.get(e));this._localToDispose.add(n),this._localToDispose.add(Cl(()=>this._resolveCodeLensesScheduler.cancel())),this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{let n=[],r=-1;this._lenses.forEach(e=>{!e.isValid()||r===e.getLineNumber()?n.push(e):(e.update(t),r=e.getLineNumber())});let i=new Yg;n.forEach(e=>{e.dispose(i,t),this._lenses.splice(this._lenses.indexOf(e),1)}),i.commit(e)})}),n.schedule(),this._resolveCodeLensesScheduler.cancel(),this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0})),this._localToDispose.add(this._editor.onDidFocusEditorText(()=>{n.schedule()})),this._localToDispose.add(this._editor.onDidBlurEditorText(()=>{n.cancel()})),this._localToDispose.add(this._editor.onDidScrollChange(e=>{e.scrollTopChanged&&this._lenses.length>0&&this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(this._editor.onDidLayoutChange(()=>{this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(Cl(()=>{if(this._editor.getModel()){let e=sd.capture(this._editor);this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{this._disposeAllLenses(e,t)})}),e.restore(this._editor)}else this._disposeAllLenses(void 0,void 0)})),this._localToDispose.add(this._editor.onMouseDown(e=>{if(e.target.type!==9)return;let t=e.target.element;if(t?.tagName===`SPAN`&&(t=t.parentElement),t?.tagName===`A`)for(let e of this._lenses){let n=e.getCommand(t);if(n){this._commandService.executeCommand(n.id,...n.arguments||[]).catch(e=>this._notificationService.error(e));break}}})),n.schedule()}_disposeAllLenses(e,t){let n=new Yg;for(let e of this._lenses)e.dispose(n,t);e&&n.commit(e),this._lenses.length=0}_renderCodeLensSymbols(e){if(!this._editor.hasModel())return;let t=this._editor.getModel().getLineCount(),n=[],r;for(let i of e.lenses){let e=i.symbol.range.startLineNumber;e<1||e>t||(r&&r[r.length-1].symbol.range.startLineNumber===e?r.push(i):(r=[i],n.push(r)))}if(!n.length&&!this._lenses.length)return;let i=sd.capture(this._editor),a=this._getLayoutInfo();this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{let r=new Yg,i=0,o=0;for(;o<n.length&&i<this._lenses.length;){let e=n[o][0].symbol.range.startLineNumber,s=this._lenses[i].getLineNumber();s<e?(this._lenses[i].dispose(r,t),this._lenses.splice(i,1)):s===e?(this._lenses[i].updateCodeLensSymbols(n[o],r),o++,i++):(this._lenses.splice(i,0,new Zg(n[o],this._editor,r,t,a.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),i++,o++)}for(;i<this._lenses.length;)this._lenses[i].dispose(r,t),this._lenses.splice(i,1);for(;o<n.length;)this._lenses.push(new Zg(n[o],this._editor,r,t,a.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),o++;r.commit(e)})}),i.restore(this._editor)}_resolveCodeLensesInViewportSoon(){this._editor.getModel()&&this._resolveCodeLensesScheduler.schedule()}_resolveCodeLensesInViewport(){this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0;let e=this._editor.getModel();if(!e)return;let t=[],n=[];if(this._lenses.forEach(r=>{let i=r.computeIfNecessary(e);i&&(t.push(i),n.push(r))}),t.length===0){this._oldCodeLensModels.clear();return}let r=Date.now(),i=li(r=>{let i=t.map((t,i)=>{let a=Array(t.length),o=t.map((t,n)=>!t.symbol.command&&typeof t.provider.resolveCodeLens==`function`?Promise.resolve(t.provider.resolveCodeLens(e,t.symbol,r)).then(e=>{a[n]=e},ct):(a[n]=t.symbol,Promise.resolve(void 0)));return Promise.all(o).then(()=>{!r.isCancellationRequested&&!n[i].isDisposed()&&n[i].updateCommands(a)})});return Promise.all(i)});this._resolveCodeLensesPromise=i,this._resolveCodeLensesPromise.then(()=>{let t=this._resolveCodeLensesDebounce.update(e,Date.now()-r);this._resolveCodeLensesScheduler.delay=t,this._currentCodeLensModel&&this._codeLensCache.put(e,this._currentCodeLensModel),this._oldCodeLensModels.clear(),i===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)},e=>{mr(e),i===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)})}async getModel(){return await this._getCodeLensModelPromise,await this._resolveCodeLensesPromise,this._currentCodeLensModel?.isDisposed?void 0:this._currentCodeLensModel}};e_=Qg([$g(1,H),$g(2,fu),$g(3,Te),$g(4,Ur),$g(5,Wg)],e_),K(e_.ID,e_,1),q(class extends R{constructor(){super({id:`codelens.showLensesInCurrentLine`,precondition:y.hasCodeLensProvider,label:U(880,`Show CodeLens Commands for Current Line`)})}async run(e,t){if(!t.hasModel())return;let n=e.get(Mu),r=e.get(Te),i=e.get(Ur),a=t.getSelection().positionLineNumber,o=t.getContribution(e_.ID);if(!o)return;let s=await o.getModel();if(!s)return;let c=[];for(let e of s.lenses)e.symbol.command&&e.symbol.range.startLineNumber===a&&c.push({label:e.symbol.command.title,command:e.symbol.command});if(c.length===0)return;let l=await n.pick(c,{canPickMany:!1,placeHolder:G(879,`Select a command`)});if(!l)return;let u=l.command;if(s.isDisposed){let e=(await o.getModel())?.lenses.find(e=>e.symbol.range.startLineNumber===a&&e.symbol.command?.title===u.title);if(!e||!e.symbol.command)return;u=e.symbol.command}try{await r.executeCommand(u.id,...u.arguments||[])}catch(e){i.error(e)}}});var t_=class{constructor(e,t,n,r){this.priority=e,this.range=t,this.initialMousePosX=n,this.initialMousePosY=r,this.type=1}equals(e){return e.type===1&&this.range.equalsRange(e.range)}canAdoptVisibleHover(e,t){return e.type===1&&t.lineNumber===this.range.startLineNumber}},n_=class{constructor(e,t,n,r,i,a){this.priority=e,this.owner=t,this.range=n,this.initialMousePosX=r,this.initialMousePosY=i,this.supportsMarkerHover=a,this.type=2}equals(e){return e.type===2&&this.owner===e.owner}canAdoptVisibleHover(e,t){return e.type===2&&this.owner===e.owner}},r_=class{constructor(e,t){this.renderedHoverParts=e,this.disposables=t}dispose(){for(let e of this.renderedHoverParts)e.dispose();this.disposables?.dispose()}};const i_=new class{constructor(){this._participants=[]}register(e){this._participants.push(e)}getAll(){return this._participants}};var a_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o_=function(e,t){return function(n,r){t(n,r,e)}},s_=class{constructor(e){this._editorWorkerService=e}async provideDocumentColors(e,t){return this._editorWorkerService.computeDefaultDocumentColors(e.uri)}provideColorPresentations(e,t,n){let r=t.range,i=t.color,a=i.alpha,o=new V(new sl(Math.round(255*i.red),Math.round(255*i.green),Math.round(255*i.blue),a)),s=a?V.Format.CSS.formatRGBA(o):V.Format.CSS.formatRGB(o),c=a?V.Format.CSS.formatHSLA(o):V.Format.CSS.formatHSL(o),l=a?V.Format.CSS.formatHexA(o):V.Format.CSS.formatHex(o),u=[];return u.push({label:s,textEdit:{range:r,text:s}}),u.push({label:c,textEdit:{range:r,text:c}}),u.push({label:l,textEdit:{range:r,text:l}}),u}};s_=a_([o_(0,Xs)],s_);var c_=class extends x{constructor(e,t){super(),this._register(e.colorProvider.register(`*`,new s_(t)))}};c_=a_([o_(0,H),o_(1,Xs)],c_);async function l_(e,t,n,r=`auto`){return m_(new d_,e,t,n,r)}function u_(e,t,n,r){return Promise.resolve(n.provideColorPresentations(e,t,r))}var d_=class{constructor(){}async compute(e,t,n,r){let i=await e.provideDocumentColors(t,n);if(Array.isArray(i))for(let t of i)r.push({colorInfo:t,provider:e});return Array.isArray(i)}},f_=class{constructor(){}async compute(e,t,n,r){let i=await e.provideDocumentColors(t,n);if(Array.isArray(i))for(let e of i)r.push({range:e.range,color:[e.color.red,e.color.green,e.color.blue,e.color.alpha]});return Array.isArray(i)}},p_=class{constructor(e){this.colorInfo=e}async compute(e,t,n,r){let i=await e.provideColorPresentations(t,this.colorInfo,M.None);return Array.isArray(i)&&r.push(...i),Array.isArray(i)}};async function m_(e,t,n,r,i){let a=!1,o,s=[],c=t.ordered(n);for(let t=c.length-1;t>=0;t--){let l=c[t];if(i!==`always`&&l instanceof s_)o=l;else try{await e.compute(l,n,r,s)&&(a=!0)}catch(e){ct(e)}}return a?s:o&&i!==`never`?(await e.compute(o,n,r,s),s):[]}function h_(e,t){let{colorProvider:n}=e.get(H),r=e.get(_n).getModel(t);if(!r)throw Pn();let i=e.get(hn).getValue(`editor.defaultColorDecorators`,{resource:t});return{model:r,colorProviderRegistry:n,defaultColorDecoratorsEnablement:i}}var g_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},__=function(e,t){return function(n,r){t(n,r,e)}},v_;const y_=Object.create({});var b_=class extends x{static{v_=this}static{this.ID=`editor.contrib.colorDetector`}static{this.RECOMPUTE_TIME=1e3}constructor(e,t,n,r){super(),this._editor=e,this._configurationService=t,this._languageFeaturesService=n,this._localToDispose=this._register(new L),this._decorationsIds=[],this._colorDatas=new Map,this._decoratorLimitReporter=this._register(new x_),this._colorDecorationClassRefs=this._register(new L),this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=this._register(new Ws(this._editor)),this._debounceInformation=r.for(n.colorProvider,`Document Colors`,{min:v_.RECOMPUTE_TIME}),this._register(e.onDidChangeModel(()=>{this._isColorDecoratorsEnabled=this.isEnabled(),this.updateColors()})),this._register(e.onDidChangeModelLanguage(()=>this.updateColors())),this._register(n.colorProvider.onDidChange(()=>this.updateColors())),this._register(e.onDidChangeConfiguration(e=>{let t=this._isColorDecoratorsEnabled;this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(167);let n=t!==this._isColorDecoratorsEnabled||e.hasChanged(27),r=e.hasChanged(167);(n||r)&&(this._isColorDecoratorsEnabled?this.updateColors():this.removeAllDecorations())})),this._timeoutTimer=null,this._computePromise=null,this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(167),this.updateColors()}isEnabled(){let e=this._editor.getModel();if(!e)return!1;let t=e.getLanguageId(),n=this._configurationService.getValue(t);if(n&&typeof n==`object`){let e=n.colorDecorators;if(e&&e.enable!==void 0&&!e.enable)return e.enable}return this._editor.getOption(26)}static get(e){return e.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}updateColors(){if(this.stop(),!this._isColorDecoratorsEnabled)return;let e=this._editor.getModel();!e||!this._languageFeaturesService.colorProvider.has(e)||(this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._timeoutTimer||(this._timeoutTimer=new Me,this._timeoutTimer.cancelAndSet(()=>{this._timeoutTimer=null,this.beginCompute()},this._debounceInformation.get(e)))})),this.beginCompute())}async beginCompute(){this._computePromise=li(async e=>{let t=this._editor.getModel();if(!t)return[];let n=new vd(!1),r=await l_(this._languageFeaturesService.colorProvider,t,e,this._defaultColorDecoratorsEnablement);return this._debounceInformation.update(t,n.elapsed()),r});try{let e=await this._computePromise;this.updateDecorations(e),this.updateColorDecorators(e),this._computePromise=null}catch(e){mr(e)}}stop(){this._timeoutTimer&&=(this._timeoutTimer.cancel(),null),this._computePromise&&=(this._computePromise.cancel(),null),this._localToDispose.clear()}updateDecorations(e){let t=e.map(e=>({range:{startLineNumber:e.colorInfo.range.startLineNumber,startColumn:e.colorInfo.range.startColumn,endLineNumber:e.colorInfo.range.endLineNumber,endColumn:e.colorInfo.range.endColumn},options:Y.EMPTY}));this._editor.changeDecorations(n=>{this._decorationsIds=n.deltaDecorations(this._decorationsIds,t),this._colorDatas=new Map,this._decorationsIds.forEach((t,n)=>this._colorDatas.set(t,e[n]))})}updateColorDecorators(e){this._colorDecorationClassRefs.clear();let t=[],n=this._editor.getOption(27);for(let r=0;r<e.length&&t.length<n;r++){let{red:n,green:i,blue:a,alpha:o}=e[r].colorInfo.color,s=new sl(Math.round(n*255),Math.round(i*255),Math.round(a*255),o),c=`rgba(${s.r}, ${s.g}, ${s.b}, ${s.a})`,l=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:c}));t.push({range:{startLineNumber:e[r].colorInfo.range.startLineNumber,startColumn:e[r].colorInfo.range.startColumn,endLineNumber:e[r].colorInfo.range.endLineNumber,endColumn:e[r].colorInfo.range.endColumn},options:{description:`colorDetector`,before:{content:`\xA0`,inlineClassName:`${l.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:y_}}})}let r=n<e.length?n:!1;this._decoratorLimitReporter.update(e.length,r),this._colorDecoratorIds.set(t)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(e){let t=this._editor.getModel();if(!t)return null;let n=t.getDecorationsInRange(T.fromPositions(e,e)).filter(e=>this._colorDatas.has(e.id));return n.length===0?null:this._colorDatas.get(n[0].id)}isColorDecoration(e){return this._colorDecoratorIds.has(e)}};b_=v_=g_([__(1,hn),__(2,H),__(3,fu)],b_);var x_=class extends x{constructor(){super(...arguments),this._onDidChange=this._register(new D),this._computed=0,this._limited=!1}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}};const S_=`editor.action.increaseHoverVerbosityLevel`,C_=G(1097,`Increase Hover Verbosity Level`),w_=`editor.action.decreaseHoverVerbosityLevel`,T_=G(1098,`Decrease Hover Verbosity Level`),E_=`editor.action.inlineSuggest.commit`,D_=`editor.action.inlineSuggest.showPrevious`,O_=`editor.action.inlineSuggest.showNext`,k_=`editor.action.inlineSuggest.hide`,A_=`editor.action.inlineSuggest.toggleShowCollapsed`;var j_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},M_=function(e,t){return function(n,r){t(n,r,e)}},N_,P_=class extends x{constructor(e,t,n){super(),this.editor=e,this.model=t,this.instantiationService=n,this.alwaysShowToolbar=yt(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(71).showToolbar===`always`),this.sessionPosition=void 0,this.position=O(this,e=>{let t=this.model.read(e)?.primaryGhostText.read(e);if(!this.alwaysShowToolbar.read(e)||!t||t.parts.length===0)return this.sessionPosition=void 0,null;let n=t.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==t.lineNumber&&(this.sessionPosition=void 0);let r=new C(t.lineNumber,Math.min(n,this.sessionPosition?.column??2**53-1));return this.sessionPosition=r,r}),this._register(Ql((t,n)=>{let r=this.model.read(t);if(!r||!this.alwaysShowToolbar.read(t))return;let i=O(t=>{let n=t.store.add(this.instantiationService.createInstance(L_.hot.read(t),this.editor,!0,this.position,r.selectedInlineCompletionIndex,r.inlineCompletionsCount,r.activeCommands,r.warning,()=>{}));return e.addContentWidget(n),t.store.add(Cl(()=>e.removeContentWidget(n))),t.store.add(g(e=>{this.position.read(e)&&r.lastTriggerKind.read(e)!==jc.Explicit&&r.triggerExplicitly()})),n}),a=Oi(this,(e,t)=>!!this.position.read(e)||!!t);n.add(g(e=>{a.read(e)&&i.read(e)}))}))}};P_=j_([M_(2,k)],P_);var F_=nu(`inline-suggestion-hints-next`,X.chevronRight,G(1198,`Icon for show next parameter hint.`)),I_=nu(`inline-suggestion-hints-previous`,X.chevronLeft,G(1199,`Icon for show previous parameter hint.`)),L_=class extends x{static{N_=this}static{this.hot=kt(N_)}static{this._dropDownVisible=!1}static get dropDownVisible(){return this._dropDownVisible}static{this.id=0}createCommandAction(e,t,n){let r=new Rt(e,t,n,!0,()=>this._commandService.executeCommand(e)),i=this.keybindingService.lookupKeybinding(e,this._contextKeyService),a=t;return i&&(a=G(1200,`{0} ({1})`,t,i.getLabel())),r.tooltip=a,r}constructor(e,t,n,r,i,a,o,s,c,l,u,d,f){super(),this.editor=e,this.withBorder=t,this._position=n,this._currentSuggestionIdx=r,this._suggestionCount=i,this._extraCommands=a,this._warning=o,this._relayout=s,this._commandService=c,this.keybindingService=u,this._contextKeyService=d,this._menuService=f,this.id=`InlineSuggestionHintsContentWidget${N_.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._warningMessageContentNode=O(e=>{let t=this._warning.read(e);if(t)return typeof t.message==`string`?t.message:e.store.add(ar(t.message)).element}),this._warningMessageNode=w.div({class:`warningMessage`,style:{maxWidth:400,margin:4,marginBottom:4,display:O(e=>this._warning.read(e)?`block`:`none`)}},[this._warningMessageContentNode]).keepUpdated(this._store),this.nodes=zu(`div.inlineSuggestionsHints`,{className:this.withBorder?`monaco-hover monaco-hover-content`:``},[this._warningMessageNode.element,zu(`div@toolBar`)]),this.previousAction=this._register(this.createCommandAction(D_,G(1201,`Previous`),I.asClassName(I_))),this.availableSuggestionCountAction=this._register(new Rt(`inlineSuggestionHints.availableSuggestionCount`,``,void 0,!1)),this.nextAction=this._register(this.createCommandAction(O_,G(1202,`Next`),I.asClassName(F_))),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(S.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new Zr(()=>{this.availableSuggestionCountAction.label=``},100)),this.disableButtonsDebounced=this._register(new Zr(()=>{this.previousAction.enabled=this.nextAction.enabled=!1},100)),this._register(g(e=>{this._warningMessageContentNode.read(e),this._warningMessageNode.readEffect(e),this._relayout()})),this.toolBar=this._register(l.createInstance(B_,this.nodes.toolBar,S.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:e=>e.startsWith(`primary`)},actionViewItemProvider:(e,t)=>{if(e instanceof cr)return l.createInstance(z_,e,void 0);if(e===this.availableSuggestionCountAction){let t=new R_(void 0,e,{label:!0,icon:!1});return t.setClass(`availableSuggestionCount`),t}},telemetrySource:`InlineSuggestionToolbar`})),this.toolBar.setPrependedPrimaryActions([this.previousAction,this.availableSuggestionCountAction,this.nextAction]),this._register(this.toolBar.onDidChangeDropdownVisibility(e=>{N_._dropDownVisible=e})),this._register(g(e=>{this._position.read(e),this.editor.layoutContentWidget(this)})),this._register(g(e=>{let t=this._suggestionCount.read(e),n=this._currentSuggestionIdx.read(e);t===void 0?this.clearAvailableSuggestionCountLabelDebounced.schedule():(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${n+1}/${t}`),t!==void 0&&t>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule()})),this._register(g(e=>{let t=this._extraCommands.read(e).map(e=>({class:void 0,id:e.command.id,enabled:!0,tooltip:e.command.tooltip||``,label:e.command.title,run:t=>this._commandService.executeCommand(e.command.id)}));for(let[e,n]of this.inlineCompletionsActionsMenus.getActions())for(let e of n)e instanceof cr&&t.push(e);t.length>0&&t.unshift(new wi),this.toolBar.setAdditionalSecondaryActions(t)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[1,2],positionAffinity:3}}};L_=N_=j_([M_(8,Te),M_(9,k),M_(10,Yt),M_(11,On),M_(12,rt)],L_);var R_=class extends Dt{constructor(){super(...arguments),this._className=void 0}setClass(e){this._className=e}render(e){super.render(e),this._className&&e.classList.add(this._className)}updateTooltip(){}},z_=class extends Qn{updateLabel(){let e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService,!0);if(!e)return super.updateLabel();if(this.label){let t=zu(`div.keybinding`).root;this._register(new Es(t,js,{disableTitle:!0,...ms})).set(e),this.label.textContent=this._action.label,this.label.appendChild(t),this.label.classList.add(`inlineSuggestionStatusBarItemLabel`)}}updateTooltip(){}},B_=class extends ie{constructor(e,t,n,r,i,a,o,s,c){super(e,{resetMenu:t,...n},r,i,a,o,s,c),this.menuId=t,this.options2=n,this.menuService=r,this.contextKeyService=i,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this.additionalPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){let{primary:e,secondary:t}=Xt(this.menu.getActions(this.options2?.menuOptions),this.options2?.toolbarOptions?.primaryGroup,this.options2?.toolbarOptions?.shouldInlineSubmenu,this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions);t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),e.push(...this.additionalPrimaryActions),this.setActions(e,t)}setPrependedPrimaryActions(e){bt(this.prependedPrimaryActions,e,(e,t)=>e===t)||(this.prependedPrimaryActions=e,this.updateToolbar())}setAdditionalSecondaryActions(e){bt(this.additionalActions,e,(e,t)=>e===t)||(this.additionalActions=e,this.updateToolbar())}};B_=j_([M_(3,rt),M_(4,On),M_(5,Bc),M_(6,Yt),M_(7,Te),M_(8,Fu)],B_);function V_(e,t,n){let r=vs(e);return!(t<r.left||t>r.left+r.width||n<r.top||n>r.top+r.height)}var H_=class{constructor(e,t,n,r){this.value=e,this.isComplete=t,this.hasLoadingMessage=n,this.options=r}},U_=class extends x{constructor(e,t){super(),this._editor=e,this._computer=t,this._onResult=this._register(new D),this.onResult=this._onResult.event,this._asyncComputationScheduler=this._register(new W_(e=>this._triggerAsyncComputation(e),0)),this._syncComputationScheduler=this._register(new W_(e=>this._triggerSyncComputation(e),0)),this._loadingMessageScheduler=this._register(new W_(e=>this._triggerLoadingMessage(e),0)),this._state=0,this._asyncIterable=null,this._asyncIterableDone=!1,this._result=[]}dispose(){this._asyncIterable&&=(this._asyncIterable.cancel(),null),this._options=void 0,super.dispose()}get _hoverTime(){return this._editor.getOption(69).delay}get _firstWaitTime(){return this._hoverTime/2}get _secondWaitTime(){return this._hoverTime-this._firstWaitTime}get _loadingMessageTime(){return 3*this._hoverTime}_setState(e,t){this._options=t,this._state=e,this._fireResult(t)}_triggerAsyncComputation(e){this._setState(2,e),this._syncComputationScheduler.schedule(e,this._secondWaitTime),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=ju(t=>this._computer.computeAsync(e,t)),(async()=>{try{for await(let t of this._asyncIterable)t&&(this._result.push(t),this._fireResult(e));this._asyncIterableDone=!0,(this._state===3||this._state===4)&&this._setState(0,e)}catch(e){mr(e)}})()):this._asyncIterableDone=!0}_triggerSyncComputation(e){this._computer.computeSync&&(this._result=this._result.concat(this._computer.computeSync(e))),this._setState(this._asyncIterableDone?0:3,e)}_triggerLoadingMessage(e){this._state===3&&this._setState(4,e)}_fireResult(e){if(this._state===1||this._state===2)return;let t=this._state===0,n=this._state===4;this._onResult.fire(new H_(this._result.slice(0),t,n,e))}start(e,t){if(e===0)this._state===0&&(this._setState(1,t),this._asyncComputationScheduler.schedule(t,this._firstWaitTime),this._loadingMessageScheduler.schedule(t,this._loadingMessageTime));else switch(this._state){case 0:this._triggerAsyncComputation(t),this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break;case 2:this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break}}cancel(){this._asyncComputationScheduler.cancel(),this._syncComputationScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&=(this._asyncIterable.cancel(),null),this._result=[],this._options=void 0,this._state=0}get options(){return this._options}},W_=class extends x{constructor(e,t){super(),this._scheduler=this._register(new Zr(()=>e(this._options),t))}schedule(e,t){this._options=e,this._scheduler.schedule(t)}cancel(){this._scheduler.cancel()}},G_=class{get onDidWillResize(){return this._onDidWillResize.event}get onDidResize(){return this._onDidResize.event}constructor(){this._onDidWillResize=new D,this._onDidResize=new D,this._sashListener=new L,this._size=new Po(0,0),this._minSize=new Po(0,0),this._maxSize=new Po(2**53-1,2**53-1),this.domNode=document.createElement(`div`),this._eastSash=new Ac(this.domNode,{getVerticalSashLeft:()=>this._size.width},{orientation:0}),this._westSash=new Ac(this.domNode,{getVerticalSashLeft:()=>0},{orientation:0}),this._northSash=new Ac(this.domNode,{getHorizontalSashTop:()=>0},{orientation:1,orthogonalEdge:ul.North}),this._southSash=new Ac(this.domNode,{getHorizontalSashTop:()=>this._size.height},{orientation:1,orthogonalEdge:ul.South}),this._northSash.orthogonalStartSash=this._westSash,this._northSash.orthogonalEndSash=this._eastSash,this._southSash.orthogonalStartSash=this._westSash,this._southSash.orthogonalEndSash=this._eastSash;let e,t=0,n=0;this._sashListener.add(An.any(this._northSash.onDidStart,this._eastSash.onDidStart,this._southSash.onDidStart,this._westSash.onDidStart)(()=>{e===void 0&&(this._onDidWillResize.fire(),e=this._size,t=0,n=0)})),this._sashListener.add(An.any(this._northSash.onDidEnd,this._eastSash.onDidEnd,this._southSash.onDidEnd,this._westSash.onDidEnd)(()=>{e!==void 0&&(e=void 0,t=0,n=0,this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(this._eastSash.onDidChange(r=>{e&&(n=r.currentX-r.startX,this.layout(e.height+t,e.width+n),this._onDidResize.fire({dimension:this._size,done:!1,east:!0}))})),this._sashListener.add(this._westSash.onDidChange(r=>{e&&(n=-(r.currentX-r.startX),this.layout(e.height+t,e.width+n),this._onDidResize.fire({dimension:this._size,done:!1,west:!0}))})),this._sashListener.add(this._northSash.onDidChange(r=>{e&&(t=-(r.currentY-r.startY),this.layout(e.height+t,e.width+n),this._onDidResize.fire({dimension:this._size,done:!1,north:!0}))})),this._sashListener.add(this._southSash.onDidChange(r=>{e&&(t=r.currentY-r.startY,this.layout(e.height+t,e.width+n),this._onDidResize.fire({dimension:this._size,done:!1,south:!0}))})),this._sashListener.add(An.any(this._eastSash.onDidReset,this._westSash.onDidReset)(e=>{this._preferredSize&&(this.layout(this._size.height,this._preferredSize.width),this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(An.any(this._northSash.onDidReset,this._southSash.onDidReset)(e=>{this._preferredSize&&(this.layout(this._preferredSize.height,this._size.width),this._onDidResize.fire({dimension:this._size,done:!0}))}))}dispose(){this._northSash.dispose(),this._southSash.dispose(),this._eastSash.dispose(),this._westSash.dispose(),this._sashListener.dispose(),this._onDidResize.dispose(),this._onDidWillResize.dispose(),this.domNode.remove()}enableSashes(e,t,n,r){this._northSash.state=e?3:0,this._eastSash.state=t?3:0,this._southSash.state=n?3:0,this._westSash.state=r?3:0}layout(e=this.size.height,t=this.size.width){let{height:n,width:r}=this._minSize,{height:i,width:a}=this._maxSize;e=Math.max(n,Math.min(i,e)),t=Math.max(r,Math.min(a,t));let o=new Po(t,e);Po.equals(o,this._size)||(this.domNode.style.height=e+`px`,this.domNode.style.width=t+`px`,this._size=o,this._northSash.layout(),this._eastSash.layout(),this._southSash.layout(),this._westSash.layout())}clearSashHoverState(){this._eastSash.clearSashHoverState(),this._westSash.clearSashHoverState(),this._northSash.clearSashHoverState(),this._southSash.clearSashHoverState()}get size(){return this._size}set maxSize(e){this._maxSize=e}get maxSize(){return this._maxSize}set minSize(e){this._minSize=e}get minSize(){return this._minSize}set preferredSize(e){this._preferredSize=e}get preferredSize(){return this._preferredSize}},K_=30,q_=24,J_=class extends x{constructor(e,t=new Po(10,10)){super(),this._editor=e,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._resizableNode=this._register(new G_),this._contentPosition=null,this._isResizing=!1,this._resizableNode.domNode.style.position=`absolute`,this._resizableNode.minSize=Po.lift(t),this._resizableNode.layout(t.height,t.width),this._resizableNode.enableSashes(!0,!0,!0,!0),this._register(this._resizableNode.onDidResize(e=>{this._resize(new Po(e.dimension.width,e.dimension.height)),e.done&&(this._isResizing=!1)})),this._register(this._resizableNode.onDidWillResize(()=>{this._isResizing=!0}))}get isResizing(){return this._isResizing}getDomNode(){return this._resizableNode.domNode}getPosition(){return this._contentPosition}get position(){return this._contentPosition?.position?C.lift(this._contentPosition.position):void 0}_availableVerticalSpaceAbove(e){let t=this._editor.getDomNode(),n=this._editor.getScrolledVisiblePosition(e);if(!(!t||!n))return vs(t).top+n.top-K_}_availableVerticalSpaceBelow(e){let t=this._editor.getDomNode(),n=this._editor.getScrolledVisiblePosition(e);if(!t||!n)return;let r=vs(t),i=rl(t.ownerDocument.body),a=r.top+n.top+n.height;return i.height-a-q_}_findPositionPreference(e,t){let n=Math.min(this._availableVerticalSpaceBelow(t)??1/0,e),r=Math.min(this._availableVerticalSpaceAbove(t)??1/0,e),i=Math.min(Math.max(r,n),e),a=Math.min(e,i),o;return o=this._editor.getOption(69).above?a<=r?1:2:a<=n?2:1,o===1?this._resizableNode.enableSashes(!0,!0,!1,!1):this._resizableNode.enableSashes(!1,!0,!0,!1),o}_resize(e){this._resizableNode.layout(e.height,e.width)}},Y_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},X_=function(e,t){return function(n,r){t(n,r,e)}},Z_,Q_=30,$_=class extends J_{static{Z_=this}static{this.ID=`editor.contrib.resizableContentHoverWidget`}static{this._lastDimensions=new Po(0,0)}get isVisibleFromKeyboard(){return this._renderedHover?.source===2}get isVisible(){return this._hoverVisibleKey.get()??!1}get isFocused(){return this._hoverFocusedKey.get()??!1}constructor(e,t,n,r,i){let a=e.getOption(75)+8,o=new Po(150,a);super(e,o),this._configurationService=n,this._accessibilityService=r,this._keybindingService=i,this._hover=this._register(new v(!0)),this._onDidResize=this._register(new D),this.onDidResize=this._onDidResize.event,this._onDidScroll=this._register(new D),this.onDidScroll=this._onDidScroll.event,this._onContentsChanged=this._register(new D),this.onContentsChanged=this._onContentsChanged.event,this._minimumSize=o,this._hoverVisibleKey=y.hoverVisible.bindTo(t),this._hoverFocusedKey=y.hoverFocused.bindTo(t),B(this._resizableNode.domNode,this._hover.containerDomNode),this._resizableNode.domNode.style.zIndex=`50`,this._resizableNode.domNode.className=`monaco-resizable-hover`,this._register(this._editor.onDidLayoutChange(()=>{this.isVisible&&this._updateMaxDimensions()})),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(59)&&this._updateFont()}));let s=this._register(Wn(this._resizableNode.domNode));this._register(s.onDidFocus(()=>{this._hoverFocusedKey.set(!0)})),this._register(s.onDidBlur(()=>{this._hoverFocusedKey.set(!1)})),this._register(this._hover.scrollbar.onScroll(e=>{this._onDidScroll.fire(e)})),this._setRenderedHover(void 0),this._editor.addContentWidget(this)}dispose(){super.dispose(),this._renderedHover?.dispose(),this._editor.removeContentWidget(this)}getId(){return Z_.ID}static _applyDimensions(e,t,n){let r=typeof t==`number`?`${t}px`:t,i=typeof n==`number`?`${n}px`:n;e.style.width=r,e.style.height=i}_setContentsDomNodeDimensions(e,t){let n=this._hover.contentsDomNode;return Z_._applyDimensions(n,e,t)}_setContainerDomNodeDimensions(e,t){let n=this._hover.containerDomNode;return Z_._applyDimensions(n,e,t)}_setScrollableElementDimensions(e,t){let n=this._hover.scrollbar.getDomNode();return Z_._applyDimensions(n,e,t)}_setHoverWidgetDimensions(e,t){this._setContainerDomNodeDimensions(e,t),this._setScrollableElementDimensions(e,t),this._setContentsDomNodeDimensions(e,t),this._layoutContentWidget()}static _applyMaxDimensions(e,t,n){let r=typeof t==`number`?`${t}px`:t,i=typeof n==`number`?`${n}px`:n;e.style.maxWidth=r,e.style.maxHeight=i}_setHoverWidgetMaxDimensions(e,t){Z_._applyMaxDimensions(this._hover.contentsDomNode,e,t),Z_._applyMaxDimensions(this._hover.scrollbar.getDomNode(),e,t),Z_._applyMaxDimensions(this._hover.containerDomNode,e,t),this._hover.containerDomNode.style.setProperty(`--vscode-hover-maxWidth`,typeof e==`number`?`${e}px`:e),this._layoutContentWidget()}_setAdjustedHoverWidgetDimensions(e){this._setHoverWidgetMaxDimensions(`none`,`none`),this._setHoverWidgetDimensions(e.width,e.height)}_updateResizableNodeMaxDimensions(){let e=this._findMaximumRenderingWidth()??1/0,t=this._findMaximumRenderingHeight()??1/0;this._resizableNode.maxSize=new Po(e,t),this._setHoverWidgetMaxDimensions(e,t)}_resize(e){Z_._lastDimensions=new Po(e.width,e.height),this._setAdjustedHoverWidgetDimensions(e),this._resizableNode.layout(e.height,e.width),this._updateResizableNodeMaxDimensions(),this._hover.scrollbar.scanDomNode(),this._editor.layoutContentWidget(this),this._onDidResize.fire()}_findAvailableSpaceVertically(){let e=this._renderedHover?.showAtPosition;if(e)return this._positionPreference===1?this._availableVerticalSpaceAbove(e):this._availableVerticalSpaceBelow(e)}_findMaximumRenderingHeight(){let e=this._findAvailableSpaceVertically();if(!e)return;let t=this._hover.contentsDomNode.children.length-1;return Array.from(this._hover.contentsDomNode.children).forEach(e=>{t+=e.clientHeight}),Math.min(e,t)}_isHoverTextOverflowing(){this._hover.containerDomNode.style.setProperty(`--vscode-hover-whiteSpace`,`nowrap`),this._hover.containerDomNode.style.setProperty(`--vscode-hover-sourceWhiteSpace`,`nowrap`);let e=Array.from(this._hover.contentsDomNode.children).some(e=>e.scrollWidth>e.clientWidth);return this._hover.containerDomNode.style.removeProperty(`--vscode-hover-whiteSpace`),this._hover.containerDomNode.style.removeProperty(`--vscode-hover-sourceWhiteSpace`),e}_findMaximumRenderingWidth(){if(!this._editor||!this._editor.hasModel())return;let e=this._isHoverTextOverflowing(),t=this._contentWidth===void 0?0:this._contentWidth;return e||this._hover.containerDomNode.clientWidth<t?rl(this._hover.containerDomNode.ownerDocument.body).width-14:this._hover.containerDomNode.clientWidth}isMouseGettingCloser(e,t){if(!this._renderedHover)return!1;if(this._renderedHover.initialMousePosX===void 0||this._renderedHover.initialMousePosY===void 0)return this._renderedHover.initialMousePosX=e,this._renderedHover.initialMousePosY=t,!1;let n=vs(this.getDomNode());this._renderedHover.closestMouseDistance===void 0&&(this._renderedHover.closestMouseDistance=ev(this._renderedHover.initialMousePosX,this._renderedHover.initialMousePosY,n.left,n.top,n.width,n.height));let r=ev(e,t,n.left,n.top,n.width,n.height);return r>this._renderedHover.closestMouseDistance+4?!1:(this._renderedHover.closestMouseDistance=Math.min(this._renderedHover.closestMouseDistance,r),!0)}_setRenderedHover(e){this._renderedHover?.dispose(),this._renderedHover=e,this._hoverVisibleKey.set(!!e),this._hover.containerDomNode.classList.toggle(`hidden`,!e)}_updateFont(){let{fontSize:e,lineHeight:t}=this._editor.getOption(59),n=this._hover.contentsDomNode;n.style.fontSize=`${e}px`,n.style.lineHeight=`${t/e}`,Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName(`code`)).forEach(e=>this._editor.applyFontInfo(e))}_updateContent(e){let t=this._hover.contentsDomNode;t.style.paddingBottom=``,t.textContent=``,t.appendChild(e)}_layoutContentWidget(){this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}_updateMaxDimensions(){let e=Math.max(this._editor.getLayoutInfo().height/4,250,Z_._lastDimensions.height),t=Math.max(this._editor.getLayoutInfo().width*.66,750,Z_._lastDimensions.width);this._resizableNode.maxSize=new Po(t,e),this._setHoverWidgetMaxDimensions(t,e)}_render(e){this._setRenderedHover(e),this._updateFont(),this._updateContent(e.domNode),this.handleContentsChanged(),this._editor.render()}getPosition(){return this._renderedHover?{position:this._renderedHover.showAtPosition,secondaryPosition:this._renderedHover.showAtSecondaryPosition,positionAffinity:this._renderedHover.shouldAppearBeforeContent?3:void 0,preference:[this._positionPreference??1]}:null}show(e){if(!this._editor||!this._editor.hasModel())return;this._render(e);let t=vu(this._hover.containerDomNode),n=e.showAtPosition;this._positionPreference=this._findPositionPreference(t,n)??1,this.handleContentsChanged(),e.shouldFocus&&this._hover.containerDomNode.focus(),this._onDidResize.fire();let r=this._hover.containerDomNode.ownerDocument.activeElement===this._hover.containerDomNode&&tu(this._configurationService.getValue(`accessibility.verbosity.hover`)===!0&&this._accessibilityService.isScreenReaderOptimized(),this._keybindingService.lookupKeybinding(`editor.action.accessibleView`)?.getAriaLabel()??``);r&&(this._hover.contentsDomNode.ariaLabel=this._hover.contentsDomNode.textContent+`, `+r)}hide(){if(!this._renderedHover)return;let e=this._renderedHover.shouldFocus||this._hoverFocusedKey.get();this._setRenderedHover(void 0),this._resizableNode.maxSize=new Po(1/0,1/0),this._resizableNode.clearSashHoverState(),this._hoverFocusedKey.set(!1),this._editor.layoutContentWidget(this),e&&this._editor.focus()}_removeConstraintsRenderNormally(){let e=this._editor.getLayoutInfo();this._resizableNode.layout(e.height,e.width),this._setHoverWidgetDimensions(`auto`,`auto`),this._updateMaxDimensions()}setMinimumDimensions(e){this._minimumSize=new Po(Math.max(this._minimumSize.width,e.width),Math.max(this._minimumSize.height,e.height)),this._updateMinimumWidth()}_updateMinimumWidth(){let e=this._contentWidth===void 0?this._minimumSize.width:Math.min(this._contentWidth,this._minimumSize.width);this._resizableNode.minSize=new Po(e,this._minimumSize.height)}handleContentsChanged(){this._removeConstraintsRenderNormally();let e=this._hover.contentsDomNode,t=vu(e),n=Zu(e)+2;if(this._resizableNode.layout(t,n),this._setHoverWidgetDimensions(n,t),t=vu(e),n=Zu(e),this._contentWidth=n,this._updateMinimumWidth(),this._resizableNode.layout(t,n),this._renderedHover?.showAtPosition){let e=vu(this._hover.containerDomNode);this._positionPreference=this._findPositionPreference(e,this._renderedHover.showAtPosition)}this._layoutContentWidget(),this._onContentsChanged.fire()}focus(){this._hover.containerDomNode.focus()}scrollUp(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(59);this._hover.scrollbar.setScrollPosition({scrollTop:e-t.lineHeight})}scrollDown(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(59);this._hover.scrollbar.setScrollPosition({scrollTop:e+t.lineHeight})}scrollLeft(){let e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e-Q_})}scrollRight(){let e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e+Q_})}pageUp(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e-t})}pageDown(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e+t})}goToTop(){this._hover.scrollbar.setScrollPosition({scrollTop:0})}goToBottom(){this._hover.scrollbar.setScrollPosition({scrollTop:this._hover.scrollbar.getScrollDimensions().scrollHeight})}};$_=Z_=Y_([X_(1,On),X_(2,hn),X_(3,Qt),X_(4,Yt)],$_);function ev(e,t,n,r,i,a){let o=n+i/2,s=r+a/2,c=Math.max(Math.abs(e-o)-i/2,0),l=Math.max(Math.abs(t-s)-a/2,0);return Math.sqrt(c*c+l*l)}var tv=class e{constructor(e,t){this._editor=e,this._participants=t}static _getLineDecorations(e,t){if(t.type!==1&&!t.supportsMarkerHover)return[];let n=e.getModel(),r=t.range.startLineNumber;if(r>n.getLineCount())return[];let i=n.getLineMaxColumn(r);return e.getLineDecorations(r).filter(e=>{if(e.options.isWholeLine)return!0;let n=e.range.startLineNumber===r?e.range.startColumn:1,a=e.range.endLineNumber===r?e.range.endColumn:i;if(e.options.showIfCollapsed){if(n>t.range.startColumn+1||t.range.endColumn-1>a)return!1}else if(n>t.range.startColumn||t.range.endColumn>a)return!1;return!0})}computeAsync(t,n){let r=t.anchor;if(!this._editor.hasModel()||!r)return ed.EMPTY;let i=e._getLineDecorations(this._editor,r);return ed.merge(this._participants.map(e=>e.computeAsync?e.computeAsync(r,i,t.source,n):ed.EMPTY))}computeSync(t){if(!this._editor.hasModel())return[];let n=t.anchor,r=e._getLineDecorations(this._editor,n),i=[];for(let e of this._participants)i=i.concat(e.computeSync(n,r,t.source));return ki(i)}},nv=class{constructor(e,t,n){this.hoverParts=e,this.isComplete=t,this.options=n}filter(e){let t=this.hoverParts.filter(t=>t.isValidForHoverAnchor(e));return t.length===this.hoverParts.length?this:new rv(this,t,this.isComplete,this.options)}},rv=class extends nv{constructor(e,t,n,r){super(t,n,r),this.original=e}filter(e){return this.original.filter(e)}},iv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},av=function(e,t){return function(n,r){t(n,r,e)}},ov=b,sv=class extends x{get hasContent(){return this._hasContent}constructor(e,t){super(),this._keybindingService=e,this._hoverService=t,this.actions=[],this._hasContent=!1,this.hoverElement=ov(`div.hover-row.status-bar`),this.hoverElement.tabIndex=0,this.actionsElement=B(this.hoverElement,ov(`div.actions`))}addAction(e){let t=this._keybindingService.lookupKeybinding(e.commandId),n=t?t.getLabel():null;this._hasContent=!0;let r=this._register(kr.render(this.actionsElement,e,n));return this._register(this._hoverService.setupManagedHover(ha(`element`),r.actionContainer,r.actionRenderedLabel)),this.actions.push(r),r}append(e){let t=B(this.actionsElement,e);return this._hasContent=!0,t}};sv=iv([av(0,Yt),av(1,Is)],sv);var cv=class{constructor(e,t,n){this.provider=e,this.hover=t,this.ordinal=n}};async function lv(e,t,n,r,i){let a=await Promise.resolve(e.provideHover(n,r,i)).catch(ct);if(!(!a||!fv(a)))return new cv(e,a,t)}function uv(e,t,n,r,i=!1){let a=e.ordered(t,i).map((e,i)=>lv(e,i,t,n,r));return ed.fromPromisesResolveOrder(a).coalesce()}async function dv(e,t,n,r,i=!1){let a=[];for await(let o of uv(e,t,n,r,i))a.push(o.hover);return a}Ya(`_executeHoverProvider`,(e,t,n)=>{let r=e.get(H);return dv(r.hoverProvider,t,n,M.None)}),Ya(`_executeHoverProvider_recursive`,(e,t,n)=>{let r=e.get(H);return dv(r.hoverProvider,t,n,M.None,!0)});function fv(e){let t=e.range!==void 0,n=e.contents!==void 0&&e.contents&&e.contents.length>0;return t&&n}var pv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mv=function(e,t){return function(n,r){t(n,r,e)}},hv=b,gv=nu(`hover-increase-verbosity`,X.add,G(1123,`Icon for increaseing hover verbosity.`)),_v=nu(`hover-decrease-verbosity`,X.remove,G(1124,`Icon for decreasing hover verbosity.`)),vv=class{constructor(e,t,n,r,i,a=void 0){this.owner=e,this.range=t,this.contents=n,this.isBeforeContent=r,this.ordinal=i,this.source=a}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},yv=class{constructor(e,t,n){this.hover=e,this.hoverProvider=t,this.hoverPosition=n}supportsVerbosityAction(e){switch(e){case hu.Increase:return this.hover.canIncreaseVerbosity??!1;case hu.Decrease:return this.hover.canDecreaseVerbosity??!1}}},bv=class{constructor(e,t,n,r,i,a,o,s){this._editor=e,this._languageService=t,this._openerService=n,this._configurationService=r,this._languageFeaturesService=i,this._keybindingService=a,this._hoverService=o,this._commandService=s,this.hoverOrdinal=3}createLoadingMessage(e){return new vv(this,e.range,[new Jn().appendText(G(1125,`Loading...`))],!1,2e3)}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];let n=this._editor.getModel(),r=e.range.startLineNumber,i=n.getLineMaxColumn(r),a=[],o=1e3,s=n.getLineLength(r),c=n.getLanguageIdAtPosition(e.range.startLineNumber,e.range.startColumn),l=this._editor.getOption(133),u=this._configurationService.getValue(`editor.maxTokenizationLineLength`,{overrideIdentifier:c}),d=!1;l>=0&&s>l&&e.range.startColumn>=l&&(d=!0,a.push(new vv(this,e.range,[{value:G(1126,"Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")}],!1,o++))),!d&&typeof u==`number`&&s>=u&&a.push(new vv(this,e.range,[{value:G(1127,"Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],!1,o++));let f=!1;for(let n of t){let t=n.range.startLineNumber===r?n.range.startColumn:1,s=n.range.endLineNumber===r?n.range.endColumn:i,c=n.options.hoverMessage;if(!c||dt(c))continue;n.options.beforeContentClassName&&(f=!0);let l=new T(e.range.startLineNumber,t,e.range.startLineNumber,s);a.push(new vv(this,l,Sn(c),f,o++))}return a}computeAsync(e,t,n,r){if(!this._editor.hasModel()||e.type!==1)return ed.EMPTY;let i=this._editor.getModel(),a=this._languageFeaturesService.hoverProvider;return a.has(i)?this._getMarkdownHovers(a,i,e,r):ed.EMPTY}async*_getMarkdownHovers(e,t,n,r){let i=n.range.getStartPosition(),a=uv(e,t,i,r);for await(let e of a)if(!dt(e.hover.contents)){let t=e.hover.range?T.lift(e.hover.range):n.range,r=new yv(e.hover,e.provider,i);yield new vv(this,t,e.hover.contents,!1,e.ordinal,r)}}renderHoverParts(e,t){return this._renderedHoverParts=new Sv(t,e.fragment,this,this._editor,this._languageService,this._openerService,this._commandService,this._keybindingService,this._hoverService,this._configurationService,e.onContentsChanged),this._renderedHoverParts}handleScroll(e){this._renderedHoverParts?.handleScroll(e)}updateMarkdownHoverVerbosityLevel(e,t){return Promise.resolve(this._renderedHoverParts?.updateMarkdownHoverPartVerbosityLevel(e,t))}};bv=pv([mv(1,wt),mv(2,da),mv(3,hn),mv(4,H),mv(5,Yt),mv(6,Is),mv(7,Te)],bv);var xv=class{constructor(e,t,n,r){this.hoverPart=e,this.hoverElement=t,this.disposables=n,this.actionsContainer=r}dispose(){this.disposables.dispose()}},Sv=class{constructor(e,t,n,r,i,a,o,s,c,l,u){this._hoverParticipant=n,this._editor=r,this._languageService=i,this._openerService=a,this._commandService=o,this._keybindingService=s,this._hoverService=c,this._configurationService=l,this._onFinishedRendering=u,this._ongoingHoverOperations=new Map,this._disposables=new L,this.renderedHoverParts=this._renderHoverParts(e,t,this._onFinishedRendering),this._disposables.add(Cl(()=>{this.renderedHoverParts.forEach(e=>{e.dispose()}),this._ongoingHoverOperations.forEach(e=>{e.tokenSource.dispose(!0)})}))}_renderHoverParts(e,t,n){return e.sort(Mt(e=>e.ordinal,ca)),e.map(e=>{let r=this._renderHoverPart(e,n);return t.appendChild(r.hoverElement),r})}_renderHoverPart(e,t){let n=this._renderMarkdownHover(e,t),r=n.hoverElement,i=e.source,a=new L;if(a.add(n),!i)return new xv(e,r,a);let o=i.supportsVerbosityAction(hu.Increase),s=i.supportsVerbosityAction(hu.Decrease);if(!o&&!s)return new xv(e,r,a);let c=hv(`div.verbosity-actions`);r.prepend(c);let l=hv(`div.verbosity-actions-inner`);return c.append(l),a.add(this._renderHoverExpansionAction(l,hu.Increase,o)),a.add(this._renderHoverExpansionAction(l,hu.Decrease,s)),new xv(e,r,a,l)}_renderMarkdownHover(e,t){return wv(this._editor,e,this._languageService,this._openerService,t)}_renderHoverExpansionAction(e,t,n){let r=new L,i=t===hu.Increase,a=B(e,hv(I.asCSSSelector(i?gv:_v)));a.tabIndex=0;let o=new Ja(`mouse`,void 0,{target:e,position:{hoverPosition:0}},this._configurationService,this._hoverService);if(r.add(this._hoverService.setupManagedHover(o,a,Tv(this._keybindingService,t))),!n)return a.classList.add(`disabled`),r;a.classList.add(`enabled`);let s=()=>this._commandService.executeCommand(t===hu.Increase?S_:w_,{focus:!0});return r.add(new Ca(a,s)),r.add(new Bo(a,s,[3,10])),r}handleScroll(e){this.renderedHoverParts.forEach(t=>{let n=t.actionsContainer;if(!n)return;let r=t.hoverElement,i=e.scrollTop+e.height,a=r.offsetTop,o=r.clientHeight,s=a+o,c;c=s<=i||a>=i?o-22:i-a-22,n.style.top=`${c}px`})}async updateMarkdownHoverPartVerbosityLevel(e,t){let n=this._editor.getModel();if(!n)return;let r=this._getRenderedHoverPartAtIndex(t),i=r?.hoverPart.source;if(!r||!i?.supportsVerbosityAction(e))return;let a=await this._fetchHover(i,n,e);if(!a)return;let o=new yv(a,i.hoverProvider,i.hoverPosition),s=r.hoverPart,c=new vv(this._hoverParticipant,s.range,a.contents,s.isBeforeContent,s.ordinal,o),l=this._updateRenderedHoverPart(t,c);if(l)return{hoverPart:c,hoverElement:l.hoverElement}}async _fetchHover(e,t,n){let r=n===hu.Increase?1:-1,i=e.hoverProvider,a=this._ongoingHoverOperations.get(i);a&&(a.tokenSource.cancel(),r+=a.verbosityDelta);let o=new Sr;this._ongoingHoverOperations.set(i,{verbosityDelta:r,tokenSource:o});let s={verbosityRequest:{verbosityDelta:r,previousHover:e.hover}},c;try{c=await Promise.resolve(i.provideHover(t,e.hoverPosition,o.token,s))}catch(e){ct(e)}return o.dispose(),this._ongoingHoverOperations.delete(i),c}_updateRenderedHoverPart(e,t){if(e>=this.renderedHoverParts.length||e<0)return;let n=this._renderHoverPart(t,this._onFinishedRendering),r=this.renderedHoverParts[e],i=r.hoverElement,a=n.hoverElement,o=Array.from(a.children);i.replaceChildren(...o);let s=new xv(t,i,n.disposables,n.actionsContainer);return r.dispose(),this.renderedHoverParts[e]=s,s}_getRenderedHoverPartAtIndex(e){return this.renderedHoverParts[e]}dispose(){this._disposables.dispose()}};function Cv(e,t,n,r,i){t.sort(Mt(e=>e.ordinal,ca));let a=[];for(let o of t){let t=wv(n,o,r,i,e.onContentsChanged);e.fragment.appendChild(t.hoverElement),a.push(t)}return new r_(a)}function wv(e,t,n,r,i){let a=new L,o=hv(`div.hover-row`),s=hv(`div.hover-row-contents`);o.appendChild(s);let c=t.contents;for(let t of c){if(dt(t))continue;let o=hv(`div.markdown-hover`),c=B(o,hv(`div.hover-contents`)),l=new et({editor:e},n,r),u=a.add(l.render(t,{asyncRenderCallback:()=>{c.className=`hover-contents code-hover-contents`,i()}}));c.appendChild(u.element),s.appendChild(o)}return{hoverPart:t,hoverElement:o,dispose(){a.dispose()}}}function Tv(e,t){switch(t){case hu.Increase:{let t=e.lookupKeybinding(S_);return t?G(1128,`Increase Hover Verbosity ({0})`,t.getLabel()):G(1129,`Increase Hover Verbosity`)}case hu.Decrease:{let t=e.lookupKeybinding(w_);return t?G(1130,`Decrease Hover Verbosity ({0})`,t.getLabel()):G(1131,`Decrease Hover Verbosity`)}}}var Ev=b,Dv=class extends x{constructor(e,t,n){super(),this.model=t,this.pixelRatio=n,this._onDidChange=new D,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new D,this.onColorFlushed=this._onColorFlushed.event,this._domNode=Ev(`.saturation-wrap`),B(e,this._domNode),this._canvas=document.createElement(`canvas`),this._canvas.className=`saturation-box`,B(this._domNode,this._canvas),this.selection=Ev(`.saturation-selection`),B(this._domNode,this.selection),this.layout(),this._register(z(this._domNode,Pc.POINTER_DOWN,e=>this.onPointerDown(e))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}get domNode(){return this._domNode}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;this.monitor=this._register(new gi);let t=vs(this._domNode);e.target!==this.selection&&this.onDidChangePosition(e.offsetX,e.offsetY),this.monitor.startMonitoring(e.target,e.pointerId,e.buttons,e=>this.onDidChangePosition(e.pageX-t.left,e.pageY-t.top),()=>null);let n=z(e.target.ownerDocument,Pc.POINTER_UP,()=>{this._onColorFlushed.fire(),n.dispose(),this.monitor&&=(this.monitor.stopMonitoring(!0),null)},!0)}onDidChangePosition(e,t){let n=Math.max(0,Math.min(1,e/this.width)),r=Math.max(0,Math.min(1,1-t/this.height));this.paintSelection(n,r),this._onDidChange.fire({s:n,v:r})}layout(){this.width=this._domNode.offsetWidth,this.height=this._domNode.offsetHeight,this._canvas.width=this.width*this.pixelRatio,this._canvas.height=this.height*this.pixelRatio,this.paint();let e=this.model.color.hsva;this.paintSelection(e.s,e.v)}paint(){let e=this.model.color.hsva,t=new V(new Zo(e.h,1,1,1)),n=this._canvas.getContext(`2d`),r=n.createLinearGradient(0,0,this._canvas.width,0);r.addColorStop(0,`rgba(255, 255, 255, 1)`),r.addColorStop(.5,`rgba(255, 255, 255, 0.5)`),r.addColorStop(1,`rgba(255, 255, 255, 0)`);let i=n.createLinearGradient(0,0,0,this._canvas.height);i.addColorStop(0,`rgba(0, 0, 0, 0)`),i.addColorStop(1,`rgba(0, 0, 0, 1)`),n.rect(0,0,this._canvas.width,this._canvas.height),n.fillStyle=V.Format.CSS.format(t),n.fill(),n.fillStyle=r,n.fill(),n.fillStyle=i,n.fill()}paintSelection(e,t){this.selection.style.left=`${e*this.width}px`,this.selection.style.top=`${this.height-t*this.height}px`}onDidChangeColor(e){if(this.monitor&&this.monitor.isMonitoring())return;this.paint();let t=e.hsva;this.paintSelection(t.s,t.v)}},Ov=class extends x{constructor(e){super(),this._onClicked=this._register(new D),this.onClicked=this._onClicked.event,this._button=B(e,document.createElement(`button`)),this._button.classList.add(`insert-button`),this._button.textContent=`Insert`,this._register(z(this._button,Pc.CLICK,()=>{this._onClicked.fire()}))}get button(){return this._button}},kv=b,Av=class extends x{constructor(e,t,n){super(),this.model=t,this._onDidChange=new D,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new D,this.onColorFlushed=this._onColorFlushed.event,n===`standalone`?(this.domNode=B(e,kv(`.standalone-strip`)),this.overlay=B(this.domNode,kv(`.standalone-overlay`))):(this.domNode=B(e,kv(`.strip`)),this.overlay=B(this.domNode,kv(`.overlay`))),this.slider=B(this.domNode,kv(`.slider`)),this.slider.style.top=`0px`,this._register(z(this.domNode,Pc.POINTER_DOWN,e=>this.onPointerDown(e))),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;let e=this.getValue(this.model.color);this.updateSliderPosition(e)}onDidChangeColor(e){let t=this.getValue(e);this.updateSliderPosition(t)}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._register(new gi),n=vs(this.domNode);this.domNode.classList.add(`grabbing`),e.target!==this.slider&&this.onDidChangeTop(e.offsetY),t.startMonitoring(e.target,e.pointerId,e.buttons,e=>this.onDidChangeTop(e.pageY-n.top),()=>null);let r=z(e.target.ownerDocument,Pc.POINTER_UP,()=>{this._onColorFlushed.fire(),r.dispose(),t.stopMonitoring(!0),this.domNode.classList.remove(`grabbing`)},!0)}onDidChangeTop(e){let t=Math.max(0,Math.min(1,1-e/this.height));this.updateSliderPosition(t),this._onDidChange.fire(t)}updateSliderPosition(e){this.slider.style.top=`${(1-e)*this.height}px`}},jv=class extends Av{constructor(e,t,n){super(e,t,n),this.domNode.classList.add(`opacity-strip`),this.onDidChangeColor(this.model.color)}onDidChangeColor(e){super.onDidChangeColor(e);let{r:t,g:n,b:r}=e.rgba,i=new V(new sl(t,n,r,1)),a=new V(new sl(t,n,r,0));this.overlay.style.background=`linear-gradient(to bottom, ${i} 0%, ${a} 100%)`}getValue(e){return e.hsva.a}},Mv=class extends Av{constructor(e,t,n){super(e,t,n),this.domNode.classList.add(`hue-strip`)}getValue(e){return 1-e.hsva.h/360}},Nv=b,Pv=class extends x{constructor(e,t,n,r){super(),this.model=t,this.pixelRatio=n,this._insertButton=null,this._domNode=Nv(`.colorpicker-body`),B(e,this._domNode),this._saturationBox=new Dv(this._domNode,this.model,this.pixelRatio),this._register(this._saturationBox),this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this._saturationBox.onColorFlushed(this.flushColor,this)),this._opacityStrip=new jv(this._domNode,this.model,r),this._register(this._opacityStrip),this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this._opacityStrip.onColorFlushed(this.flushColor,this)),this._hueStrip=new Mv(this._domNode,this.model,r),this._register(this._hueStrip),this._register(this._hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this._hueStrip.onColorFlushed(this.flushColor,this)),r===`standalone`&&(this._insertButton=this._register(new Ov(this._domNode)),this._domNode.classList.add(`standalone-colorpicker`))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:e,v:t}){let n=this.model.color.hsva;this.model.color=new V(new Zo(n.h,e,t,n.a))}onDidOpacityChange(e){let t=this.model.color.hsva;this.model.color=new V(new Zo(t.h,t.s,t.v,e))}onDidHueChange(e){let t=this.model.color.hsva,n=(1-e)*360;this.model.color=new V(new Zo(n===360?0:n,t.s,t.v,t.a))}get domNode(){return this._domNode}get saturationBox(){return this._saturationBox}get enterButton(){return this._insertButton}layout(){this._saturationBox.layout(),this._opacityStrip.layout(),this._hueStrip.layout()}},Fv=b,Iv=class extends x{constructor(e){super(),this._onClicked=this._register(new D),this.onClicked=this._onClicked.event,this._button=document.createElement(`div`),this._button.classList.add(`close-button`),B(e,this._button);let t=document.createElement(`div`);t.classList.add(`close-button-inner-div`),B(this._button,t),B(t,Fv(`.button`+I.asCSSSelector(nu(`color-picker-close`,X.close,G(881,`Icon to close the color picker`))))).classList.add(`close-icon`),this._register(z(this._button,Pc.CLICK,()=>{this._onClicked.fire()}))}},Lv=b,Rv=class extends x{constructor(e,t,n,r){super(),this.model=t,this.type=r,this._closeButton=null,this._domNode=Lv(`.colorpicker-header`),B(e,this._domNode),this._pickedColorNode=B(this._domNode,Lv(`.picked-color`)),B(this._pickedColorNode,Lv(`span.codicon.codicon-color-mode`)),this._pickedColorPresentation=B(this._pickedColorNode,document.createElement(`span`)),this._pickedColorPresentation.classList.add(`picked-color-presentation`);let i=G(882,`Click to toggle color options (rgb/hsl/hex)`);this._pickedColorNode.setAttribute(`title`,i),this._originalColorNode=B(this._domNode,Lv(`.original-color`)),this._originalColorNode.style.backgroundColor=V.Format.CSS.format(this.model.originalColor)||``,this.backgroundColor=n.getColorTheme().getColor(au)||V.white,this._register(n.onDidColorThemeChange(e=>{this.backgroundColor=e.getColor(au)||V.white})),this._register(z(this._pickedColorNode,Pc.CLICK,()=>this.model.selectNextColorPresentation())),this._register(z(this._originalColorNode,Pc.CLICK,()=>{this.model.color=this.model.originalColor,this.model.flushColor()})),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this._register(t.onDidChangePresentation(this.onDidChangePresentation,this)),this._pickedColorNode.style.backgroundColor=V.Format.CSS.format(t.color)||``,this._pickedColorNode.classList.toggle(`light`,t.color.rgba.a<.5?this.backgroundColor.isLighter():t.color.isLighter()),this.onDidChangeColor(this.model.color),this.type===`standalone`&&(this._domNode.classList.add(`standalone-colorpicker`),this._closeButton=this._register(new Iv(this._domNode)))}get closeButton(){return this._closeButton}get pickedColorNode(){return this._pickedColorNode}get originalColorNode(){return this._originalColorNode}onDidChangeColor(e){this._pickedColorNode.style.backgroundColor=V.Format.CSS.format(e)||``,this._pickedColorNode.classList.toggle(`light`,e.rgba.a<.5?this.backgroundColor.isLighter():e.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this._pickedColorPresentation.textContent=this.model.presentation?this.model.presentation.label:``}},zv=b,Bv=class extends Au{constructor(e,t,n,r,i){super(),this.model=t,this.pixelRatio=n,this._register(Mr.getInstance(eo(e)).onDidChange(()=>this.layout())),this._domNode=zv(`.colorpicker-widget`),e.appendChild(this._domNode),this.header=this._register(new Rv(this._domNode,this.model,r,i)),this.body=this._register(new Pv(this._domNode,this.model,this.pixelRatio,i))}layout(){this.body.layout()}get domNode(){return this._domNode}},Vv=class{get color(){return this._color}set color(e){this._color.equals(e)||(this._color=e,this._onDidChangeColor.fire(e))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(e){this._colorPresentations=e,this.presentationIndex>e.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}constructor(e,t,n){this.presentationIndex=n,this._onColorFlushed=new D,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new D,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new D,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=e,this._color=e,this._colorPresentations=t}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(e,t){let n=-1;for(let e=0;e<this.colorPresentations.length;e++)if(t.toLowerCase()===this.colorPresentations[e].label){n=e;break}if(n===-1){let e=t.split(`(`)[0].toLowerCase();for(let t=0;t<this.colorPresentations.length;t++)if(this.colorPresentations[t].label.toLowerCase().startsWith(e)){n=t;break}}n!==-1&&n!==this.presentationIndex&&(this.presentationIndex=n,this._onDidChangePresentation.fire(this.presentation))}flushColor(){this._onColorFlushed.fire(this._color)}};async function Hv(e,t,n){let r=e.getValueInRange(t.range),{red:i,green:a,blue:o,alpha:s}=t.color,c=new sl(Math.round(i*255),Math.round(a*255),Math.round(o*255),s),l=new V(c),u=await u_(e,t,n,M.None),d=new Vv(l,[],0);return d.colorPresentations=u||[],d.guessColorPresentation(l,r),{range:T.lift(t.range),model:d,provider:n}}function Uv(e,t,n){let r=[],i=n.presentation.textEdit??{range:t,text:n.presentation.label,forceMoveMarkers:!1};r.push(i),n.presentation.additionalTextEdits&&r.push(...n.presentation.additionalTextEdits);let a=T.lift(i.range),o=e.getModel()._setTrackedRange(null,a,3);return e.executeEdits(`colorpicker`,r),e.pushUndoStop(),e.getModel()._getTrackedRange(o)??a}async function Wv(e,t,n,r,i){t.colorPresentations=await u_(e,{range:r,color:{red:n.rgba.r/255,green:n.rgba.g/255,blue:n.rgba.b/255,alpha:n.rgba.a}},i.provider,M.None)||[]}var Gv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Kv=function(e,t){return function(n,r){t(n,r,e)}},qv=class e{constructor(e,t,n,r){this.owner=e,this.range=t,this.model=n,this.provider=r,this.forceShowAtRange=!0}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}static fromBaseColor(t,n){return new e(t,n.range,n.model,n.provider)}},Jv=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}computeSync(e,t,n){return[]}computeAsync(e,t,n,r){return ed.fromPromise(this._computeAsync(e,t,n))}async _computeAsync(e,t,n){if(!this._editor.hasModel()||!this._isValidRequest(n))return[];let r=b_.get(this._editor);if(!r)return[];for(let e of t){if(!r.isColorDecoration(e))continue;let t=r.getColorData(e.range.getStartPosition());if(t)return[qv.fromBaseColor(this,await Hv(this._editor.getModel(),t.colorInfo,t.provider))]}return[]}_isValidRequest(e){let t=this._editor.getOption(168);switch(e){case 0:return t===`hover`||t===`clickAndHover`;case 1:return t===`click`||t===`clickAndHover`;case 2:return!0}}renderHoverParts(e,t){let n=this._editor;if(t.length===0||!n.hasModel())return new r_([]);let r=n.getOption(75)+8;e.setMinimumDimensions(new Po(302,r));let i=new L,a=t[0],o=n.getModel(),s=a.model;this._colorPicker=i.add(new Bv(e.fragment,s,n.getOption(163),this._themeService,`hover`));let c=!1,l=new T(a.range.startLineNumber,a.range.startColumn,a.range.endLineNumber,a.range.endColumn);i.add(s.onColorFlushed(async e=>{await Wv(o,s,e,l,a),c=!0,l=Uv(n,l,s)})),i.add(s.onDidChangeColor(e=>{Wv(o,s,e,l,a)})),i.add(n.onDidChangeModelContent(t=>{c?c=!1:(e.hide(),n.focus())}));let u={hoverPart:qv.fromBaseColor(this,a),hoverElement:this._colorPicker.domNode,dispose(){i.dispose()}};return new r_([u])}handleResize(){this._colorPicker?.layout()}handleContentsChanged(){this._colorPicker?.layout()}handleHide(){this._colorPicker?.dispose(),this._colorPicker=void 0}isColorPickerVisible(){return!!this._colorPicker}};Jv=Gv([Kv(1,pa)],Jv);function Yv(e,t){return!!e[t]}var Xv=class{constructor(e,t){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.mouseMiddleClickAction=t.mouseMiddleClickAction,this.hasTriggerModifier=Yv(e.event,t.triggerModifier),this.isMiddleClick&&t.mouseMiddleClickAction===`ctrlLeftClick`&&(this.isMiddleClick=!1,this.isLeftClick=!0,this.hasTriggerModifier=!0),this.hasSideBySideModifier=Yv(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}},Zv=class{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=Yv(e,t.triggerModifier)}},Qv=class{constructor(e,t,n,r,i){this.mouseMiddleClickAction=i,this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=n,this.triggerSideBySideModifier=r}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier&&this.mouseMiddleClickAction===e.mouseMiddleClickAction}};function $v(e,t){return e===`altKey`?po?new Qv(57,`metaKey`,6,`altKey`,t):new Qv(5,`ctrlKey`,6,`altKey`,t):po?new Qv(6,`altKey`,57,`metaKey`,t):new Qv(6,`altKey`,5,`ctrlKey`,t)}var ey=class extends x{constructor(e,t){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new D),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new D),this.onExecute=this._onExecute.event,this._onCancel=this._register(new D),this.onCancel=this._onCancel.event,this._editor=e,this._extractLineNumberFromMouseEvent=t?.extractLineNumberFromMouseEvent??(e=>e.target.position?e.target.position.lineNumber:0),this._opts=$v(this._editor.getOption(86),this._editor.getOption(87)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(e=>{if(e.hasChanged(86)||e.hasChanged(87)){let e=$v(this._editor.getOption(86),this._editor.getOption(87));if(this._opts.equals(e))return;this._opts=e,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(e=>this._onEditorMouseMove(new Xv(e,this._opts)))),this._register(this._editor.onMouseDown(e=>this._onEditorMouseDown(new Xv(e,this._opts)))),this._register(this._editor.onMouseUp(e=>this._onEditorMouseUp(new Xv(e,this._opts)))),this._register(this._editor.onKeyDown(e=>this._onEditorKeyDown(new Zv(e,this._opts)))),this._register(this._editor.onKeyUp(e=>this._onEditorKeyUp(new Zv(e,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(e=>this._onDidChangeCursorSelection(e))),this._register(this._editor.onDidChangeModel(e=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(e=>{(e.scrollTopChanged||e.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(e)}_onEditorMouseUp(e){let t=this._extractLineNumberFromMouseEvent(e);this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&(this._hasTriggerKeyOnMouseDown||e.isMiddleClick&&e.mouseMiddleClickAction===`openLink`)&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}},ty=class{constructor(e,t){this.range=e,this.direction=t}},ny=class e{constructor(e,t,n){this.hint=e,this.anchor=t,this.provider=n,this._isResolved=!1}with(t){let n=new e(this.hint,t.anchor,this.provider);return n._isResolved=this._isResolved,n._currentResolve=this._currentResolve,n}async resolve(e){if(typeof this.provider.resolveInlayHint==`function`){if(this._currentResolve)return await this._currentResolve,e.isCancellationRequested?void 0:this.resolve(e);this._isResolved||(this._currentResolve=this._doResolve(e).finally(()=>this._currentResolve=void 0)),await this._currentResolve}}async _doResolve(e){try{let t=await Promise.resolve(this.provider.resolveInlayHint(this.hint,e));this.hint.tooltip=t?.tooltip??this.hint.tooltip,this.hint.label=t?.label??this.hint.label,this.hint.textEdits=t?.textEdits??this.hint.textEdits,this._isResolved=!0}catch(e){ct(e),this._isResolved=!1}}},ry=class e{static{this._emptyInlayHintList=Object.freeze({dispose(){},hints:[]})}static async create(t,n,r,i){let a=[],o=t.ordered(n).reverse().map(t=>r.map(async r=>{try{let o=await t.provideInlayHints(n,r,i);(o?.hints.length||t.onDidChangeInlayHints)&&a.push([o??e._emptyInlayHintList,t])}catch(e){ct(e)}}));if(await Promise.all(o.flat()),i.isCancellationRequested||n.isDisposed())throw new Us;return new e(r,a,n)}constructor(t,n,r){this._disposables=new L,this.ranges=t,this.provider=new Set;let i=[];for(let[t,a]of n){this._disposables.add(t),this.provider.add(a);for(let n of t.hints){let t=r.validatePosition(n.position),o=`before`,s=e._getRangeAtPosition(r,t),c;s.getStartPosition().isBefore(t)?(c=T.fromPositions(s.getStartPosition(),t),o=`after`):(c=T.fromPositions(t,s.getEndPosition()),o=`before`),i.push(new ny(n,new ty(c,o),a))}}this.items=i.sort((e,t)=>C.compare(e.hint.position,t.hint.position))}dispose(){this._disposables.dispose()}static _getRangeAtPosition(e,t){let n=t.lineNumber,r=e.getWordAtPosition(t);if(r)return new T(n,r.startColumn,n,r.endColumn);e.tokenization.tokenizeIfCheap(n);let i=e.tokenization.getLineTokens(n),a=t.column-1,o=i.findTokenIndexAtOffset(a),s=i.getStartOffset(o),c=i.getEndOffset(o);return c-s===1&&(s===a&&o>1?(s=i.getStartOffset(o-1),c=i.getEndOffset(o-1)):c===a&&o<i.getCount()-1&&(s=i.getStartOffset(o+1),c=i.getEndOffset(o+1))),new T(n,s+1,n,c+1)}};function iy(e){return _r(e.id,...e.arguments??[]).toString()}var ay=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},oy=function(e,t){return function(n,r){t(n,r,e)}},sy=class extends ws{constructor(e,t,n,r,i,a,o,s,c,l,u,d,f){super(e,{...r.getRawOptions(),overflowWidgetsDomNode:r.getOverflowWidgetsDomNode()},n,i,a,o,s,c,l,u,d,f),this._parentEditor=r,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(r.onDidChangeConfiguration(e=>this._onParentConfigurationChanged(e)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){ss(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};sy=ay([oy(4,k),oy(5,xl),oy(6,Te),oy(7,On),oy(8,pa),oy(9,Ur),oy(10,Qt),oy(11,Ce),oy(12,H)],sy);function cy(e){let t=e.get(xl).getFocusedCodeEditor();return t instanceof sy?t.getParentEditor():t}var ly=new V(new sl(0,122,204)),uy={showArrow:!0,showFrame:!0,className:``,frameColor:ly,arrowColor:ly,keepEditorSelection:!1},dy=`vs.editor.contrib.zoneWidget`,fy=class{constructor(e,t,n,r,i,a,o,s){this.id=``,this.domNode=e,this.afterLineNumber=t,this.afterColumn=n,this.heightInLines=r,this.showInHiddenAreas=o,this.ordinal=s,this._onDomNodeTop=i,this._onComputedHeight=a}onDomNodeTop(e){this._onDomNodeTop(e)}onComputedHeight(e){this._onComputedHeight(e)}},py=class{constructor(e,t){this._id=e,this._domNode=t}getId(){return this._id}getDomNode(){return this._domNode}getPosition(){return null}},my=class e{static{this._IdGenerator=new Ks(`.arrow-decoration-`)}constructor(t){this._editor=t,this._ruleName=e._IdGenerator.nextId(),this._color=null,this._height=-1,this._decorations=this._editor.createDecorationsCollection()}dispose(){this.hide(),ln(this._ruleName)}set color(e){this._color!==e&&(this._color=e,this._updateStyle())}set height(e){this._height!==e&&(this._height=e,this._updateStyle())}_updateStyle(){ln(this._ruleName),Li(`.monaco-editor ${this._ruleName}`,`border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px !important; margin-left: -${this._height}px; `)}show(e){e.column===1&&(e={lineNumber:e.lineNumber,column:2}),this._decorations.set([{range:T.fromPositions(e),options:{description:`zone-widget-arrow`,className:this._ruleName,stickiness:1}}])}hide(){this._decorations.clear()}},hy=class{constructor(e,t={}){this._arrow=null,this._overlayWidget=null,this._resizeSash=null,this._isSashResizeHeight=!1,this._viewZone=null,this._disposables=new L,this.container=null,this._isShowing=!1,this.editor=e,this._positionMarkerId=this.editor.createDecorationsCollection(),this.options=ys(t),ss(this.options,uy,!1),this.domNode=document.createElement(`div`),this.options.isAccessible||(this.domNode.setAttribute(`aria-hidden`,`true`),this.domNode.setAttribute(`role`,`presentation`)),this._disposables.add(this.editor.onDidLayoutChange(e=>{let t=this._getWidth(e);this.domNode.style.width=t+`px`,this.domNode.style.left=this._getLeft(e)+`px`,this._onWidth(t)}))}dispose(){this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this._viewZone&&this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._viewZone=null}),this._positionMarkerId.clear(),this._disposables.dispose()}create(){this.domNode.classList.add(`zone-widget`),this.options.className&&this.domNode.classList.add(this.options.className),this.container=document.createElement(`div`),this.container.classList.add(`zone-widget-container`),this.domNode.appendChild(this.container),this.options.showArrow&&(this._arrow=new my(this.editor),this._disposables.add(this._arrow)),this._fillContainer(this.container),this._initSash(),this._applyStyles()}style(e){e.frameColor&&(this.options.frameColor=e.frameColor),e.arrowColor&&(this.options.arrowColor=e.arrowColor),this._applyStyles()}_applyStyles(){if(this.container&&this.options.frameColor){let e=this.options.frameColor.toString();this.container.style.borderTopColor=e,this.container.style.borderBottomColor=e}if(this._arrow&&this.options.arrowColor){let e=this.options.arrowColor.toString();this._arrow.color=e}}_getWidth(e){return e.width-e.minimap.minimapWidth-e.verticalScrollbarWidth}_getLeft(e){return e.minimap.minimapWidth>0&&e.minimap.minimapLeft===0?e.minimap.minimapWidth:0}_onViewZoneTop(e){this.domNode.style.top=e+`px`}_onViewZoneHeight(e){if(this.domNode.style.height=`${e}px`,this.container){let t=e-this._decoratingElementsHeight();this.container.style.height=`${t}px`;let n=this.editor.getLayoutInfo();this._doLayout(t,this._getWidth(n))}this._resizeSash?.layout()}get position(){let e=this._positionMarkerId.getRange(0);if(e)return e.getStartPosition()}show(e,t){let n=T.isIRange(e)?T.lift(e):T.fromPositions(e);this._isShowing=!0,this._showImpl(n,t),this._isShowing=!1,this._positionMarkerId.set([{range:n,options:Y.EMPTY}])}hide(){this._viewZone&&=(this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id)}),null),this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this._arrow?.hide(),this._positionMarkerId.clear(),this._isSashResizeHeight=!1}_decoratingElementsHeight(){let e=this.editor.getOption(75),t=0;if(this.options.showArrow){let n=Math.round(e/3);t+=2*n}if(this.options.showFrame){let n=this.options.frameWidth??Math.round(e/9);t+=2*n}return t}_getMaximumHeightInLines(){return Math.max(12,this.editor.getLayoutInfo().height/this.editor.getOption(75)*.8)}_showImpl(e,t){let n=e.getStartPosition(),r=this.editor.getLayoutInfo(),i=this._getWidth(r);this.domNode.style.width=`${i}px`,this.domNode.style.left=this._getLeft(r)+`px`;let a=document.createElement(`div`);a.style.overflow=`hidden`;let o=this.editor.getOption(75),s=this._getMaximumHeightInLines();s!==void 0&&(t=Math.min(t,s));let c=0,l=0;if(this._arrow&&this.options.showArrow&&(c=Math.round(o/3),this._arrow.height=c,this._arrow.show(n)),this.options.showFrame&&(l=Math.round(o/9)),this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this.domNode.style.top=`-1000px`,this._viewZone=new fy(a,n.lineNumber,n.column,t,e=>this._onViewZoneTop(e),e=>this._onViewZoneHeight(e),this.options.showInHiddenAreas,this.options.ordinal),this._viewZone.id=e.addZone(this._viewZone),this._overlayWidget=new py(dy+this._viewZone.id,this.domNode),this.editor.addOverlayWidget(this._overlayWidget)}),this._updateSashEnablement(),this.container&&this.options.showFrame){let e=this.options.frameWidth?this.options.frameWidth:l;this.container.style.borderTopWidth=e+`px`,this.container.style.borderBottomWidth=e+`px`}let u=t*o-this._decoratingElementsHeight();this.container&&(this.container.style.top=c+`px`,this.container.style.height=u+`px`,this.container.style.overflow=`hidden`),this._doLayout(u,i),this.options.keepEditorSelection||this.editor.setSelection(e);let d=this.editor.getModel();if(d){let t=d.validateRange(new T(e.startLineNumber,1,e.endLineNumber+1,1));this.revealRange(t,t.startLineNumber===d.getLineCount())}}revealRange(e,t){t?this.editor.revealLineNearTop(e.endLineNumber,0):this.editor.revealRange(e,0)}setCssClass(e,t){this.container&&(t&&this.container.classList.remove(t),this.container.classList.add(e))}_onWidth(e){}_doLayout(e,t){}_relayout(e,t){let n=this._getMaximumHeightInLines(),r=t&&n!==void 0?Math.min(n,e):e;this._viewZone&&this._viewZone.heightInLines!==r&&(this.editor.changeViewZones(e=>{this._viewZone&&(this._viewZone.heightInLines=r,e.layoutZone(this._viewZone.id))}),this._updateSashEnablement())}_initSash(){if(this._resizeSash)return;this._resizeSash=this._disposables.add(new Ac(this.domNode,this,{orientation:1})),this.options.isResizeable||(this._resizeSash.state=0);let e;this._disposables.add(this._resizeSash.onDidStart(t=>{this._viewZone&&(e={startY:t.startY,heightInLines:this._viewZone.heightInLines,...this._getResizeBounds()})})),this._disposables.add(this._resizeSash.onDidEnd(()=>{e=void 0})),this._disposables.add(this._resizeSash.onDidChange(t=>{if(e){let n=(t.currentY-e.startY)/this.editor.getOption(75),r=n<0?Math.ceil(n):Math.floor(n),i=e.heightInLines+r;i>e.minLines&&i<e.maxLines&&(this._isSashResizeHeight=!0,this._relayout(i))}}))}_updateSashEnablement(){if(this._resizeSash){let{minLines:e,maxLines:t}=this._getResizeBounds();this._resizeSash.state=e===t?0:3}}_getResizeBounds(){return{minLines:5,maxLines:35}}getHorizontalSashLeft(){return 0}getHorizontalSashTop(){return(this.domNode.style.height===null?0:parseInt(this.domNode.style.height))-this._decoratingElementsHeight()/2}getHorizontalSashWidth(){let e=this.editor.getLayoutInfo();return e.width-e.minimap.minimapWidth}},gy=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_y=function(e,t){return function(n,r){t(n,r,e)}};const vy=ma(`IPeekViewService`);Ui(vy,class{constructor(){this._widgets=new Map}addExclusiveWidget(e,t){let n=this._widgets.get(e);n&&(n.listener.dispose(),n.widget.dispose()),this._widgets.set(e,{widget:t,listener:t.onDidClose(()=>{let n=this._widgets.get(e);n&&n.widget===t&&(n.listener.dispose(),this._widgets.delete(e))})})}},1);var yy;(function(e){e.inPeekEditor=new N(`inReferenceSearchEditor`,!0,G(1306,`Whether the current code editor is embedded inside peek`)),e.notInPeekEditor=e.inPeekEditor.toNegated()})(yy||={});var by=class{static{this.ID=`editor.contrib.referenceController`}constructor(e,t){e instanceof sy&&yy.inPeekEditor.bindTo(t)}dispose(){}};by=gy([_y(1,On)],by),K(by.ID,by,0);var xy={headerBackgroundColor:V.white,primaryHeadingColor:V.fromHex(`#333333`),secondaryHeadingColor:V.fromHex(`#6c6c6cb3`)},Sy=class extends hy{constructor(e,t,n){super(e,t),this.instantiationService=n,this._onDidClose=new D,this.onDidClose=this._onDidClose.event,ss(this.options,xy,!1);let r=Bs(this.editor);r.openedPeekWidgets.set(r.openedPeekWidgets.get()+1,void 0)}dispose(){if(!this.disposed){this.disposed=!0,super.dispose(),this._onDidClose.fire(this);let e=Bs(this.editor);e.openedPeekWidgets.set(e.openedPeekWidgets.get()-1,void 0)}}style(e){let t=this.options;e.headerBackgroundColor&&(t.headerBackgroundColor=e.headerBackgroundColor),e.primaryHeadingColor&&(t.primaryHeadingColor=e.primaryHeadingColor),e.secondaryHeadingColor&&(t.secondaryHeadingColor=e.secondaryHeadingColor),super.style(e)}_applyStyles(){super._applyStyles();let e=this.options;this._headElement&&e.headerBackgroundColor&&(this._headElement.style.backgroundColor=e.headerBackgroundColor.toString()),this._primaryHeading&&e.primaryHeadingColor&&(this._primaryHeading.style.color=e.primaryHeadingColor.toString()),this._secondaryHeading&&e.secondaryHeadingColor&&(this._secondaryHeading.style.color=e.secondaryHeadingColor.toString()),this._bodyElement&&e.frameColor&&(this._bodyElement.style.borderColor=e.frameColor.toString())}_fillContainer(e){this.setCssClass(`peekview-widget`),this._headElement=b(`.head`),this._bodyElement=b(`.body`),this._fillHead(this._headElement),this._fillBody(this._bodyElement),e.appendChild(this._headElement),e.appendChild(this._bodyElement)}_fillHead(e,t){this._titleElement=b(`.peekview-title`),this.options.supportOnTitleClick&&(this._titleElement.classList.add(`clickable`),Ll(this._titleElement,`click`,e=>this._onTitleClick(e))),B(this._headElement,this._titleElement),this._fillTitleIcon(this._titleElement),this._primaryHeading=b(`span.filename`),this._secondaryHeading=b(`span.dirname`),this._metaHeading=b(`span.meta`),B(this._titleElement,this._primaryHeading,this._secondaryHeading,this._metaHeading);let n=b(`.peekview-actions`);B(this._headElement,n);let r=this._getActionBarOptions();this._actionbarWidget=new Bn(n,r),this._disposables.add(this._actionbarWidget),t||this._actionbarWidget.push(this._disposables.add(new Rt(`peekview.close`,G(1307,`Close`),I.asClassName(X.close),!0,()=>(this.dispose(),Promise.resolve()))),{label:!1,icon:!0})}_fillTitleIcon(e){}_getActionBarOptions(){return{actionViewItemProvider:ht.bind(void 0,this.instantiationService),orientation:0}}_onTitleClick(e){}setTitle(e,t){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=e,this._primaryHeading.setAttribute(`title`,e),t?this._secondaryHeading.innerText=t:fc(this._secondaryHeading))}setMetaTitle(e){this._metaHeading&&(e?(this._metaHeading.innerText=e,Hs(this._metaHeading)):Jr(this._metaHeading))}_doLayout(e,t){if(!this._isShowing&&e<0){this.dispose();return}let n=Math.ceil(this.editor.getOption(75)*1.2),r=Math.round(e-(n+1));this._doLayoutHead(n,t),this._doLayoutBody(r,t)}_doLayoutHead(e,t){this._headElement&&(this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(e,t){this._bodyElement&&(this._bodyElement.style.height=`${e}px`)}};Sy=gy([_y(2,k)],Sy);const Cy=F(`peekViewTitle.background`,{dark:`#252526`,light:`#F3F3F3`,hcDark:V.black,hcLight:V.white},G(1308,`Background color of the peek view title area.`)),wy=F(`peekViewTitleLabel.foreground`,{dark:V.white,light:V.black,hcDark:V.white,hcLight:dc},G(1309,`Color of the peek view title.`)),Ty=F(`peekViewTitleDescription.foreground`,{dark:`#ccccccb3`,light:`#616161`,hcDark:`#FFFFFF99`,hcLight:`#292929`},G(1310,`Color of the peek view title info.`)),Ey=F(`peekView.border`,{dark:Sc,light:Sc,hcDark:Un,hcLight:Un},G(1311,`Color of the peek view borders and arrow.`)),Dy=F(`peekViewResult.background`,{dark:`#252526`,light:`#F3F3F3`,hcDark:V.black,hcLight:V.white},G(1312,`Background color of the peek view result list.`));F(`peekViewResult.lineForeground`,{dark:`#bbbbbb`,light:`#646465`,hcDark:V.white,hcLight:dc},G(1313,`Foreground color for line nodes in the peek view result list.`)),F(`peekViewResult.fileForeground`,{dark:V.white,light:`#1E1E1E`,hcDark:V.white,hcLight:dc},G(1314,`Foreground color for file nodes in the peek view result list.`)),F(`peekViewResult.selectionBackground`,{dark:`#3399ff33`,light:`#3399ff33`,hcDark:null,hcLight:null},G(1315,`Background color of the selected entry in the peek view result list.`)),F(`peekViewResult.selectionForeground`,{dark:V.white,light:`#6C6C6C`,hcDark:V.white,hcLight:dc},G(1316,`Foreground color of the selected entry in the peek view result list.`));const Oy=F(`peekViewEditor.background`,{dark:`#001F33`,light:`#F2F8FC`,hcDark:V.black,hcLight:V.white},G(1317,`Background color of the peek view editor.`));F(`peekViewEditorGutter.background`,Oy,G(1318,`Background color of the gutter in the peek view editor.`)),F(`peekViewEditorStickyScroll.background`,Oy,G(1319,`Background color of sticky scroll in the peek view editor.`)),F(`peekViewEditorStickyScrollGutter.background`,Oy,G(1320,`Background color of the gutter part of sticky scroll in the peek view editor.`)),F(`peekViewResult.matchHighlightBackground`,{dark:`#ea5c004d`,light:`#ea5c004d`,hcDark:null,hcLight:null},G(1321,`Match highlight color in the peek view result list.`)),F(`peekViewEditor.matchHighlightBackground`,{dark:`#ff8f0099`,light:`#f5d802de`,hcDark:null,hcLight:null},G(1322,`Match highlight color in the peek view editor.`)),F(`peekViewEditor.matchHighlightBorder`,{dark:null,light:null,hcDark:Mn,hcLight:Mn},G(1323,`Match highlight border in the peek view editor.`));var ky=class{constructor(e,t,n,r){this.isProviderFirst=e,this.parent=t,this.link=n,this._rangeCallback=r,this.id=Ln.nextId()}get uri(){return this.link.uri}get range(){return this._range??this.link.targetSelectionRange??this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){let e=this.parent.getPreview(this)?.preview(this.range);return e?G(1083,`{0} in {1} on line {2} at column {3}`,e.value,$o(this.uri),this.range.startLineNumber,this.range.startColumn):G(1082,`in {0} on line {1} at column {2}`,$o(this.uri),this.range.startLineNumber,this.range.startColumn)}},Ay=class{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){let n=this._modelReference.object.textEditorModel;if(!n)return;let{startLineNumber:r,startColumn:i,endLineNumber:a,endColumn:o}=e,s=n.getWordUntilPosition({lineNumber:r,column:i-t}),c=new T(r,s.startColumn,r,i),l=new T(a,o,a,1073741824),u=n.getValueInRange(c).replace(/^\s+/,``),d=n.getValueInRange(e),f=n.getValueInRange(l).replace(/\s+$/,``);return{value:u+d+f,highlight:{start:u.length,end:u.length+d.length}}}},jy=class{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new Ie}dispose(){Ot(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){let e=this.children.length;return e===1?G(1084,`1 symbol in {0}, full path {1}`,$o(this.uri),this.uri.fsPath):G(1085,`{0} symbols in {1}, full path {2}`,e,$o(this.uri),this.uri.fsPath)}async resolve(e){if(this._previews.size!==0)return this;for(let t of this.children)if(!this._previews.has(t.uri))try{let n=await e.createModelReference(t.uri);this._previews.set(t.uri,new Ay(n))}catch(e){mr(e)}return this}},My=class e{constructor(t,n){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new D,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=t,this._title=n;let[r]=t;t.sort(e._compareReferences);let i;for(let n of t)if((!i||!Ts.isEqual(i.uri,n.uri,!0))&&(i=new jy(this,n.uri),this.groups.push(i)),i.children.length===0||e._compareReferences(n,i.children[i.children.length-1])!==0){let e=new ky(r===n,i,n,e=>this._onDidChangeReferenceRange.fire(e));this.references.push(e),i.children.push(e)}}dispose(){Ot(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new e(this._links,this._title)}get title(){return this._title}get isEmpty(){return this.groups.length===0}get ariaMessage(){return this.isEmpty?G(1086,`No results found`):this.references.length===1?G(1087,`Found 1 symbol in {0}`,this.references[0].uri.fsPath):this.groups.length===1?G(1088,`Found {0} symbols in {1}`,this.references.length,this.groups[0].uri.fsPath):G(1089,`Found {0} symbols in {1} files`,this.references.length,this.groups.length)}nextOrPreviousReference(e,t){let{parent:n}=e,r=n.children.indexOf(e),i=n.children.length,a=n.parent.groups.length;return a===1||t&&r+1<i||!t&&r>0?(r=t?(r+1)%i:(r+i-1)%i,n.children[r]):(r=n.parent.groups.indexOf(n),t?(r=(r+1)%a,n.parent.groups[r].children[0]):(r=(r+a-1)%a,n.parent.groups[r].children[n.parent.groups[r].children.length-1]))}nearestReference(e,t){let n=this.references.map((n,r)=>({idx:r,prefixLen:Kt(n.uri.toString(),e.toString()),offsetDist:Math.abs(n.range.startLineNumber-t.lineNumber)*100+Math.abs(n.range.startColumn-t.column)})).sort((e,t)=>e.prefixLen>t.prefixLen?-1:e.prefixLen<t.prefixLen?1:e.offsetDist<t.offsetDist?-1:e.offsetDist>t.offsetDist?1:0)[0];if(n)return this.references[n.idx]}referenceAt(e,t){for(let n of this.references)if(n.uri.toString()===e.toString()&&T.containsPosition(n.range,t))return n}firstReference(){for(let e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return Ts.compare(e.uri,t.uri)||T.compareRangesUsingStarts(e.range,t.range)}},Ny=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Py=function(e,t){return function(n,r){t(n,r,e)}},Fy,Iy=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof My||e instanceof jy}getChildren(e){if(e instanceof My)return e.groups;if(e instanceof jy)return e.resolve(this._resolverService).then(e=>e.children);throw Error(`bad tree`)}};Iy=Ny([Py(0,Et)],Iy);var Ly=class{getHeight(){return 23}getTemplateId(e){return e instanceof jy?Vy.id:Uy.id}},Ry=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){if(e instanceof ky){let t=e.parent.getPreview(e)?.preview(e.range);if(t)return t.value}return $o(e.uri)}};Ry=Ny([Py(0,Yt)],Ry);var zy=class{getId(e){return e instanceof ky?e.id:e.uri}},By=class extends x{constructor(e,t){super(),this._labelService=t;let n=document.createElement(`div`);n.classList.add(`reference-file`),this.file=this._register(new za(n,{supportHighlights:!0})),this.badge=this._register(new Iu(B(n,b(`.count`)),{},Wr)),e.appendChild(n)}set(e,t){let n=kc(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(n,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});let r=e.children.length;this.badge.setCount(r),r>1?this.badge.setTitleFormat(G(1076,`{0} references`,r)):this.badge.setTitleFormat(G(1077,`{0} reference`,r))}};By=Ny([Py(1,Ec)],By);var Vy=class{static{Fy=this}static{this.id=`FileReferencesRenderer`}constructor(e){this._instantiationService=e,this.templateId=Fy.id}renderTemplate(e){return this._instantiationService.createInstance(By,e)}renderElement(e,t,n){n.set(e.element,Mi(e.filterData))}disposeTemplate(e){e.dispose()}};Vy=Fy=Ny([Py(0,k)],Vy);var Hy=class extends x{constructor(e){super(),this.label=this._register(new wu(e))}set(e,t){let n=e.parent.getPreview(e)?.preview(e.range);if(!n||!n.value)this.label.set(`${$o(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`);else{let{value:e,highlight:r}=n;t&&!Vr.isDefault(t)?(this.label.element.classList.toggle(`referenceMatch`,!1),this.label.set(e,Mi(t))):(this.label.element.classList.toggle(`referenceMatch`,!0),this.label.set(e,[r]))}}},Uy=class e{constructor(){this.templateId=e.id}static{this.id=`OneReferenceRenderer`}renderTemplate(e){return new Hy(e)}renderElement(e,t,n){n.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}},Wy=class{getWidgetAriaLabel(){return G(1078,`References`)}getAriaLabel(e){return e.ariaMessage}},Gy=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ky=function(e,t){return function(n,r){t(n,r,e)}},qy=class e{static{this.DecorationOptions=Y.register({description:`reference-decoration`,stickiness:1,className:`reference-decoration`})}constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new L,this._callOnModelChange=new L,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();let e=this._editor.getModel();if(e){for(let t of this._model.references)if(t.uri.toString()===e.uri.toString()){this._addDecorations(t.parent);return}}}_addDecorations(t){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));let n=[],r=[];for(let i=0,a=t.children.length;i<a;i++){let a=t.children[i];this._decorationIgnoreSet.has(a.id)||a.uri.toString()===this._editor.getModel().uri.toString()&&(n.push({range:a.range,options:e.DecorationOptions}),r.push(i))}this._editor.changeDecorations(e=>{let i=e.deltaDecorations([],n);for(let e=0;e<i.length;e++)this._decorations.set(i[e],t.children[r[e]])})}_onDecorationChanged(){let e=[],t=this._editor.getModel();if(t){for(let[n,r]of this._decorations){let i=t.getDecorationRange(n);if(!i)continue;let a=!1;if(!T.equalsRange(i,r.range)){if(T.spansMultipleLines(i))a=!0;else{let e=r.range.endColumn-r.range.startColumn,t=i.endColumn-i.startColumn;e!==t&&(a=!0)}a?(this._decorationIgnoreSet.add(r.id),e.push(n)):r.range=i}}for(let t=0,n=e.length;t<n;t++)this._decorations.delete(e[t]);this._editor.removeDecorations(e)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}},Jy=class{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,n;try{let r=JSON.parse(e);t=r.ratio,n=r.heightInLines}catch{}return{ratio:t||.7,heightInLines:n||18}}},Yy=class extends Rs{},Xy=class{constructor(e){this.labelService=e,this.disposables=new L}getDragURI(e){return e instanceof jy?e.uri.toString():e instanceof ky?ea(e.uri,e.range).toString():null}getDragLabel(e){if(e.length!==0)return e.map(e=>this.labelService.getUriBasenameLabel(e.uri)).join(`, `)}onDragStart(e,t){if(!t.dataTransfer)return;let n=e.elements.map(e=>this.getDragURI(e)).filter(Boolean);n.length&&(t.dataTransfer.setData(ra.RESOURCES,JSON.stringify(n)),t.dataTransfer.setData(ra.TEXT,n.join(`
`)))}onDragOver(){return!1}drop(){}dispose(){this.disposables.dispose()}};Xy=Gy([Ky(0,Ec)],Xy);var Zy=class extends Sy{constructor(e,t,n,r,i,a,o,s,c){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},a),this._defaultTreeKeyboardSupport=t,this.layoutData=n,this._textModelResolverService=i,this._instantiationService=a,this._peekViewService=o,this._uriLabel=s,this._keybindingService=c,this._disposeOnNewModel=new L,this._callOnDispose=new L,this._onDidSelectReference=new D,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new Po(0,0),this._isClosing=!1,this._applyTheme(r.getColorTheme()),this._callOnDispose.add(r.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}get isClosing(){return this._isClosing}dispose(){this._isClosing=!0,this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),Ot(this._preview),Ot(this._previewNotAvailableMessage),Ot(this._tree),Ot(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){let t=e.getColor(Ey)||V.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(Cy)||V.transparent,primaryHeadingColor:e.getColor(wy),secondaryHeadingColor:e.getColor(Ty)})}show(e){super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?`side`:`open`,source:`title`})}_fillBody(e){this.setCssClass(`reference-zone-widget`),this._messageContainer=B(e,b(`div.messages`)),Jr(this._messageContainer),this._splitView=new es(e,{orientation:1}),this._previewContainer=B(e,b(`div.preview.inline`)),this._preview=this._instantiationService.createInstance(sy,this._previewContainer,{scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:`auto`,useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}},{},this.editor),Jr(this._previewContainer),this._previewNotAvailableMessage=this._instantiationService.createInstance(rd,G(1079,`no preview available`),Ni,rd.DEFAULT_CREATION_OPTIONS,null),this._treeContainer=B(e,b(`div.ref-tree.inline`));let t={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new Wy,keyboardNavigationLabelProvider:this._instantiationService.createInstance(Ry),identityProvider:new zy,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:Dy},dnd:this._instantiationService.createInstance(Xy)};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(Ll(this._treeContainer,`keydown`,e=>{e.equals(9)&&(this._keybindingService.dispatchEvent(e,e.target),e.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(Yy,`ReferencesWidget`,this._treeContainer,new Ly,[this._instantiationService.createInstance(Vy),this._instantiationService.createInstance(Uy)],this._instantiationService.createInstance(Iy),t),this._splitView.addView({onDidChange:An.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:e=>{this._preview.layout({height:this._dim.height,width:e})}},jo.Distribute),this._splitView.addView({onDidChange:An.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:e=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${e}px`,this._tree.layout(this._dim.height,e)}},jo.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));let n=(e,t)=>{e instanceof ky&&(t===`show`&&this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:t,source:`tree`}))};this._disposables.add(this._tree.onDidOpen(e=>{e.sideBySide?n(e.element,`side`):e.editorOptions.pinned?n(e.element,`goto`):n(e.element,`show`)})),Jr(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new Po(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then(()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))})}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(``),this._messageContainer.innerText=G(1080,`No results`),Hs(this._messageContainer),Promise.resolve(void 0)):(Jr(this._messageContainer),this._decorationsManager=new qy(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(e=>this._tree.rerender(e))),this._disposeOnNewModel.add(this._preview.onMouseDown(e=>{let{event:t,target:n}=e;if(t.detail!==2)return;let r=this._getFocusedReference();r&&this._onDidSelectReference.fire({element:{uri:r.uri,range:n.range},kind:t.ctrlKey||t.metaKey||t.altKey?`side`:`open`,source:`editor`})})),this.container.classList.add(`results-loaded`),Hs(this._treeContainer),Hs(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(this._model.groups.length===1?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){let[e]=this._tree.getFocus();if(e instanceof ky)return e;if(e instanceof jy&&e.children.length>0)return e.children[0]}async revealReference(e){await this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:`goto`,source:`tree`})}async _revealReference(e,t){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme===ls.inMemory?this.setTitle(G(1081,`References`)):this.setTitle(ll(e.uri),this._uriLabel.getUriLabel(kc(e.uri)));let n=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent?this._tree.reveal(e):(t&&this._tree.reveal(e.parent),await this._tree.expand(e.parent),this._tree.reveal(e));let r=await n;if(!this._model){r.dispose();return}Ot(this._previewModelReference);let i=r.object;if(i){let t=this._preview.getModel()===i.textEditorModel?0:1,n=T.lift(e.range).collapseToStart();this._previewModelReference=r,this._preview.setModel(i.textEditorModel),this._preview.setSelection(n),this._preview.revealRangeInCenter(n,t)}else this._preview.setModel(this._previewNotAvailableMessage),r.dispose()}};Zy=Gy([Ky(3,pa),Ky(4,Et),Ky(5,k),Ky(6,vy),Ky(7,Ec),Ky(8,Yt)],Zy);var Qy=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$y=function(e,t){return function(n,r){t(n,r,e)}},eb;const tb=new N(`referenceSearchVisible`,!1,G(1073,`Whether reference peek is visible, like 'Peek References' or 'Peek Definition'`));var nb=class{static{eb=this}static{this.ID=`editor.contrib.referencesController`}static get(e){return e.getContribution(eb.ID)}constructor(e,t,n,r,i,a,o,s){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=r,this._notificationService=i,this._instantiationService=a,this._storageService=o,this._configurationService=s,this._disposables=new L,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=tb.bindTo(n)}dispose(){this._referenceSearchVisible.reset(),this._disposables.dispose(),this._widget?.dispose(),this._model?.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,n){let r;if(this._widget&&(r=this._widget.position),this.closeWidget(),r&&e.containsPosition(r))return;this._peekMode=n,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));let i=`peekViewLayout`,a=Jy.fromJSON(this._storageService.get(i,0,`{}`));this._widget=this._instantiationService.createInstance(Zy,this._editor,this._defaultTreeKeyboardSupport,a),this._widget.setTitle(G(1074,`Loading...`)),this._widget.show(e),this._disposables.add(this._widget.onDidClose(()=>{t.cancel(),this._widget?(this._storageService.store(i,JSON.stringify(this._widget.layoutData),0,1),this._widget.isClosing||this.closeWidget(),this._widget=void 0):this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(e=>{let{element:t,kind:r}=e;if(t)switch(r){case`open`:(e.source!==`editor`||!this._configurationService.getValue(`editor.stablePeek`))&&this.openReference(t,!1,!1);break;case`side`:this.openReference(t,!0,!1);break;case`goto`:n?this._gotoReference(t,!0):this.openReference(t,!1,!0);break}}));let o=++this._requestIdPool;t.then(t=>{if(o!==this._requestIdPool||!this._widget){t.dispose();return}return this._model?.dispose(),this._model=t,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(``):this._widget.setMetaTitle(G(1075,`{0} ({1})`,this._model.title,this._model.references.length));let t=this._editor.getModel().uri,n=new C(e.startLineNumber,e.startColumn),r=this._model.nearestReference(t,n);if(r)return this._widget.setSelection(r).then(()=>{this._widget&&this._editor.getOption(99)===`editor`&&this._widget.focusOnPreviewEditor()})}})},e=>{this._notificationService.error(e)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}async goToNextOrPreviousReference(e){if(!this._editor.hasModel()||!this._model||!this._widget)return;let t=this._widget.position;if(!t)return;let n=this._model.nearestReference(this._editor.getModel().uri,t);if(!n)return;let r=this._model.nextOrPreviousReference(n,e),i=this._editor.hasTextFocus(),a=this._widget.isPreviewEditorFocused();await this._widget.setSelection(r),await this._gotoReference(r,!1),i?this._editor.focus():this._widget&&a&&this._widget.focusOnPreviewEditor()}async revealReference(e){!this._editor.hasModel()||!this._model||!this._widget||await this._widget.revealReference(e)}closeWidget(e=!0){this._widget?.dispose(),this._model?.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(e,t){this._widget?.hide(),this._ignoreModelChangeEvent=!0;let n=T.lift(e.range).collapseToStart();return this._editorService.openCodeEditor({resource:e.uri,options:{selection:n,selectionSource:`code.jump`,pinned:t}},this._editor).then(e=>{if(this._ignoreModelChangeEvent=!1,!e||!this._widget){this.closeWidget();return}if(this._editor===e)this._widget.show(n),this._widget.focusOnReferenceTree();else{let t=eb.get(e),r=this._model.clone();this.closeWidget(),e.focus(),t?.toggleWidget(n,li(e=>Promise.resolve(r)),this._peekMode??!1)}},e=>{this._ignoreModelChangeEvent=!1,mr(e)})}openReference(e,t,n){t||this.closeWidget();let{uri:r,range:i}=e;this._editorService.openCodeEditor({resource:r,options:{selection:i,selectionSource:`code.jump`,pinned:n}},this._editor,t)}};nb=eb=Qy([$y(2,On),$y(3,xl),$y(4,Ur),$y(5,k),$y(6,Qr),$y(7,hn)],nb);function rb(e,t){let n=cy(e);if(!n)return;let r=nb.get(n);r&&t(r)}Zn.registerCommandAndKeybindingRule({id:`togglePeekWidgetFocus`,weight:100,primary:Vn(2089,60),when:E.or(tb,yy.inPeekEditor),handler(e){rb(e,e=>{e.changeFocusBetweenPreviewAndReferences()})}}),Zn.registerCommandAndKeybindingRule({id:`goToNextReference`,weight:90,primary:62,secondary:[70],when:E.or(tb,yy.inPeekEditor),handler(e){rb(e,e=>{e.goToNextOrPreviousReference(!0)})}}),Zn.registerCommandAndKeybindingRule({id:`goToPreviousReference`,weight:90,primary:1086,secondary:[1094],when:E.or(tb,yy.inPeekEditor),handler(e){rb(e,e=>{e.goToNextOrPreviousReference(!1)})}}),gd.registerCommandAlias(`goToNextReferenceFromEmbeddedEditor`,`goToNextReference`),gd.registerCommandAlias(`goToPreviousReferenceFromEmbeddedEditor`,`goToPreviousReference`),gd.registerCommandAlias(`closeReferenceSearchEditor`,`closeReferenceSearch`),gd.registerCommand(`closeReferenceSearch`,e=>rb(e,e=>e.closeWidget())),Zn.registerKeybindingRule({id:`closeReferenceSearch`,weight:-1,primary:9,secondary:[1033],when:E.and(yy.inPeekEditor,E.not(`config.editor.stablePeek`))}),Zn.registerKeybindingRule({id:`closeReferenceSearch`,weight:250,primary:9,secondary:[1033],when:E.and(tb,E.not(`config.editor.stablePeek`),E.or(y.editorTextFocus,bo.negate()))}),Zn.registerCommandAndKeybindingRule({id:`revealReference`,weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:E.and(tb,Xa,$c.negate(),Gl.negate()),handler(e){let t=e.get(Nl).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ky&&rb(e,e=>e.revealReference(t[0]))}}),Zn.registerCommandAndKeybindingRule({id:`openReferenceToSide`,weight:100,primary:2051,mac:{primary:259},when:E.and(tb,Xa,$c.negate(),Gl.negate()),handler(e){let t=e.get(Nl).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ky&&rb(e,e=>e.openReference(t[0],!0,!0))}}),gd.registerCommand(`openReference`,e=>{let t=e.get(Nl).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ky&&rb(e,e=>e.openReference(t[0],!1,!0))});var ib=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ab=function(e,t){return function(n,r){t(n,r,e)}};const ob=new N(`hasSymbols`,!1,G(1090,`Whether there are symbol locations that can be navigated via keyboard-only.`)),sb=ma(`ISymbolNavigationService`);var cb=class{constructor(e,t,n,r){this._editorService=t,this._notificationService=n,this._keybindingService=r,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=ob.bindTo(e)}reset(){this._ctxHasSymbols.reset(),this._currentState?.dispose(),this._currentMessage?.close(),this._currentModel=void 0,this._currentIdx=-1}put(e){let t=e.parent.parent;if(t.references.length<=1){this.reset();return}this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();let n=new lb(this._editorService),r=n.onDidChange(e=>{if(this._ignoreEditorChange)return;let n=this._editorService.getActiveCodeEditor();if(!n)return;let r=n.getModel(),i=n.getPosition();if(!r||!i)return;let a=!1,o=!1;for(let e of t.references)if(Ra(e.uri,r.uri))a=!0,o||=T.containsPosition(e.range,i);else if(a)break;(!a||!o)&&this.reset()});this._currentState=qi(n,r)}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;let t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:T.collapseToStart(t.range),selectionRevealType:3}},e).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){this._currentMessage?.close();let e=this._keybindingService.lookupKeybinding(`editor.gotoNextSymbolFromResult`),t=e?G(1091,`Symbol {0} of {1}, {2} for next`,this._currentIdx+1,this._currentModel.references.length,e.getLabel()):G(1092,`Symbol {0} of {1}`,this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(t)}};cb=ib([ab(0,On),ab(1,xl),ab(2,Ur),ab(3,Yt)],cb),Ui(sb,cb,1),W(new class extends Ar{constructor(){super({id:`editor.gotoNextSymbolFromResult`,precondition:ob,kbOpts:{weight:100,primary:70}})}runEditorCommand(e,t){return e.get(sb).revealNext(t)}}),Zn.registerCommandAndKeybindingRule({id:`editor.gotoNextSymbolFromResult.cancel`,weight:100,when:ob,primary:9,handler(e){e.get(sb).reset()}});var lb=class{constructor(e){this._listener=new Map,this._disposables=new L,this._onDidChange=new D,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),Ot(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,qi(e.onDidChangeCursorPosition(t=>this._onDidChange.fire({editor:e})),e.onDidChangeModelContent(t=>this._onDidChange.fire({editor:e}))))}_onDidRemoveEditor(e){this._listener.get(e)?.dispose(),this._listener.delete(e)}};lb=ib([ab(0,xl)],lb);function ub(e,t){return t.uri.scheme===e.uri.scheme?!0:!bu(t.uri,ls.walkThroughSnippet,ls.vscodeChatCodeBlock,ls.vscodeChatCodeCompareBlock)}async function db(e,t,n,r,i){let a=n.ordered(e,r).map(n=>Promise.resolve(i(n,e,t)).then(void 0,e=>{ct(e)})),o=await Promise.all(a);return ki(o.flat()).filter(t=>ub(e,t))}function fb(e,t,n,r,i){return db(t,n,e,r,(e,t,n)=>e.provideDefinition(t,n,i))}function pb(e,t,n,r,i){return db(t,n,e,r,(e,t,n)=>e.provideDeclaration(t,n,i))}function mb(e,t,n,r,i){return db(t,n,e,r,(e,t,n)=>e.provideImplementation(t,n,i))}function hb(e,t,n,r,i){return db(t,n,e,r,(e,t,n)=>e.provideTypeDefinition(t,n,i))}function gb(e,t,n,r,i,a){return db(t,n,e,i,async(e,t,n)=>{let i=(await e.provideReferences(t,n,{includeDeclaration:!0},a))?.filter(e=>ub(t,e));if(!r||!i||i.length!==2)return i;let o=(await e.provideReferences(t,n,{includeDeclaration:!1},a))?.filter(e=>ub(t,e));return o&&o.length===1?o:i})}async function _b(e){let t=await e(),n=new My(t,``),r=n.references.map(e=>e.link);return n.dispose(),r}Ya(`_executeDefinitionProvider`,(e,t,n)=>{let r=e.get(H),i=fb(r.definitionProvider,t,n,!1,M.None);return _b(()=>i)}),Ya(`_executeDefinitionProvider_recursive`,(e,t,n)=>{let r=e.get(H),i=fb(r.definitionProvider,t,n,!0,M.None);return _b(()=>i)}),Ya(`_executeTypeDefinitionProvider`,(e,t,n)=>{let r=e.get(H),i=hb(r.typeDefinitionProvider,t,n,!1,M.None);return _b(()=>i)}),Ya(`_executeTypeDefinitionProvider_recursive`,(e,t,n)=>{let r=e.get(H),i=hb(r.typeDefinitionProvider,t,n,!0,M.None);return _b(()=>i)}),Ya(`_executeDeclarationProvider`,(e,t,n)=>{let r=e.get(H),i=pb(r.declarationProvider,t,n,!1,M.None);return _b(()=>i)}),Ya(`_executeDeclarationProvider_recursive`,(e,t,n)=>{let r=e.get(H),i=pb(r.declarationProvider,t,n,!0,M.None);return _b(()=>i)}),Ya(`_executeReferenceProvider`,(e,t,n)=>{let r=e.get(H),i=gb(r.referenceProvider,t,n,!1,!1,M.None);return _b(()=>i)}),Ya(`_executeReferenceProvider_recursive`,(e,t,n)=>{let r=e.get(H),i=gb(r.referenceProvider,t,n,!1,!0,M.None);return _b(()=>i)}),Ya(`_executeImplementationProvider`,(e,t,n)=>{let r=e.get(H),i=mb(r.implementationProvider,t,n,!1,M.None);return _b(()=>i)}),Ya(`_executeImplementationProvider_recursive`,(e,t,n)=>{let r=e.get(H),i=mb(r.implementationProvider,t,n,!0,M.None);return _b(()=>i)}),sc.appendMenuItem(S.EditorContext,{submenu:S.EditorContextPeek,title:G(1033,`Peek`),group:`navigation`,order:100});var vb=class e{static is(t){return!t||typeof t!=`object`?!1:!!(t instanceof e||C.isIPosition(t.position)&&t.model)}constructor(e,t){this.model=e,this.position=t}},yb=class e extends wa{static{this._allSymbolNavigationCommands=new Map}static{this._activeAlternativeCommands=new Set}static all(){return e._allSymbolNavigationCommands.values()}static _patchConfig(e){let t={...e,f1:!0};if(t.menu)for(let n of Dl.wrap(t.menu))(n.id===S.EditorContext||n.id===S.EditorContextPeek)&&(n.when=E.and(e.precondition,n.when));return t}constructor(t,n){super(e._patchConfig(n)),this.configuration=t,e._allSymbolNavigationCommands.set(n.id,this)}runEditorCommand(t,n,r,i){if(!n.hasModel())return Promise.resolve(void 0);let a=t.get(Ur),o=t.get(xl),s=t.get(Oo),c=t.get(sb),l=t.get(H),u=t.get(k),d=n.getModel(),f=n.getPosition(),p=vb.is(r)?r:new vb(d,f),m=new Eu(n,5),h=ir(this._getLocationModel(l,p.model,p.position,m.token),m.token).then(async t=>{if(!t||m.token.isCancellationRequested)return;va(t.ariaMessage);let a;if(t.referenceAt(d.uri,f)){let t=this._getAlternativeCommand(n);t!==void 0&&!e._activeAlternativeCommands.has(t)&&e._allSymbolNavigationCommands.has(t)&&(a=e._allSymbolNavigationCommands.get(t))}let s=t.references.length;if(s===0){if(!this.configuration.muteMessage){let e=d.getWordAtPosition(f);hm.get(n)?.showMessage(this._getNoResultFoundMessage(e),f)}}else if(s===1&&a)e._activeAlternativeCommands.add(this.desc.id),u.invokeFunction(t=>a.runEditorCommand(t,n,r,i).finally(()=>{e._activeAlternativeCommands.delete(this.desc.id)}));else return this._onResult(o,c,n,t,i)},e=>{a.error(e)}).finally(()=>{m.dispose()});return s.showWhile(h,250),h}async _onResult(e,t,n,r,i){let a=this._getGoToPreference(n);if(!(n instanceof sy)&&(this.configuration.openInPeek||a===`peek`&&r.references.length>1))this._openInPeek(n,r,i);else{let o=r.firstReference(),s=r.references.length>1&&a===`gotoAndPeek`,c=await this._openReference(n,e,o,this.configuration.openToSide,!s);s&&c?this._openInPeek(c,r,i):r.dispose(),a===`goto`&&t.put(o)}}async _openReference(e,t,n,r,i){let a;if(Re(n)&&(a=n.targetSelectionRange),a||=n.range,!a)return;let o=await t.openCodeEditor({resource:n.uri,options:{selection:T.collapseToStart(a),selectionRevealType:3,selectionSource:`code.jump`}},e,r);if(o){if(i){let e=o.getModel(),t=o.createDecorationsCollection([{range:a,options:{description:`symbol-navigate-action-highlight`,className:`symbolHighlight`}}]);setTimeout(()=>{o.getModel()===e&&t.clear()},350)}return o}}_openInPeek(e,t,n){let r=nb.get(e);r&&e.hasModel()?r.toggleWidget(n??e.getSelection(),li(e=>Promise.resolve(t)),this.configuration.openInPeek):t.dispose()}},bb=class extends yb{async _getLocationModel(e,t,n,r){return new My(await fb(e.definitionProvider,t,n,!1,r),G(1034,`Definitions`))}_getNoResultFoundMessage(e){return e&&e.word?G(1035,`No definition found for '{0}'`,e.word):G(1036,`No definition found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(67).multipleDefinitions}};j(class e extends bb{static{this.id=`editor.action.revealDefinition`}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.id,title:{...U(1060,`Go to Definition`),mnemonicTitle:G(1037,`Go to &&Definition`)},precondition:y.hasDefinitionProvider,keybinding:[{when:y.editorTextFocus,primary:70,weight:100},{when:E.and(y.editorTextFocus,yc),primary:2118,weight:100}],menu:[{id:S.EditorContext,group:`navigation`,order:1.1},{id:S.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:2}]}),gd.registerCommandAlias(`editor.action.goToDeclaration`,e.id)}}),j(class e extends bb{static{this.id=`editor.action.revealDefinitionAside`}constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:e.id,title:U(1061,`Open Definition to the Side`),precondition:E.and(y.hasDefinitionProvider,y.isInEmbeddedEditor.toNegated()),keybinding:[{when:y.editorTextFocus,primary:Vn(2089,70),weight:100},{when:E.and(y.editorTextFocus,yc),primary:Vn(2089,2118),weight:100}]}),gd.registerCommandAlias(`editor.action.openDeclarationToTheSide`,e.id)}}),j(class e extends bb{static{this.id=`editor.action.peekDefinition`}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.id,title:U(1062,`Peek Definition`),precondition:E.and(y.hasDefinitionProvider,yy.notInPeekEditor,y.isInEmbeddedEditor.toNegated()),keybinding:{when:y.editorTextFocus,primary:582,linux:{primary:3140},weight:100},menu:{id:S.EditorContextPeek,group:`peek`,order:2}}),gd.registerCommandAlias(`editor.action.previewDeclaration`,e.id)}});var xb=class extends yb{async _getLocationModel(e,t,n,r){return new My(await pb(e.declarationProvider,t,n,!1,r),G(1038,`Declarations`))}_getNoResultFoundMessage(e){return e&&e.word?G(1039,`No declaration found for '{0}'`,e.word):G(1040,`No declaration found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(67).multipleDeclarations}};j(class e extends xb{static{this.id=`editor.action.revealDeclaration`}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.id,title:{...U(1063,`Go to Declaration`),mnemonicTitle:G(1041,`Go to &&Declaration`)},precondition:E.and(y.hasDeclarationProvider,y.isInEmbeddedEditor.toNegated()),menu:[{id:S.EditorContext,group:`navigation`,order:1.3},{id:S.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:3}]})}_getNoResultFoundMessage(e){return e&&e.word?G(1042,`No declaration found for '{0}'`,e.word):G(1043,`No declaration found`)}}),j(class extends xb{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:`editor.action.peekDeclaration`,title:U(1064,`Peek Declaration`),precondition:E.and(y.hasDeclarationProvider,yy.notInPeekEditor,y.isInEmbeddedEditor.toNegated()),menu:{id:S.EditorContextPeek,group:`peek`,order:3}})}});var Sb=class extends yb{async _getLocationModel(e,t,n,r){return new My(await hb(e.typeDefinitionProvider,t,n,!1,r),G(1044,`Type Definitions`))}_getNoResultFoundMessage(e){return e&&e.word?G(1045,`No type definition found for '{0}'`,e.word):G(1046,`No type definition found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(67).multipleTypeDefinitions}};j(class e extends Sb{static{this.ID=`editor.action.goToTypeDefinition`}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.ID,title:{...U(1065,`Go to Type Definition`),mnemonicTitle:G(1047,`Go to &&Type Definition`)},precondition:y.hasTypeDefinitionProvider,keybinding:{when:y.editorTextFocus,primary:0,weight:100},menu:[{id:S.EditorContext,group:`navigation`,order:1.4},{id:S.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:3}]})}}),j(class e extends Sb{static{this.ID=`editor.action.peekTypeDefinition`}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.ID,title:U(1066,`Peek Type Definition`),precondition:E.and(y.hasTypeDefinitionProvider,yy.notInPeekEditor,y.isInEmbeddedEditor.toNegated()),menu:{id:S.EditorContextPeek,group:`peek`,order:4}})}});var Cb=class extends yb{async _getLocationModel(e,t,n,r){return new My(await mb(e.implementationProvider,t,n,!1,r),G(1048,`Implementations`))}_getNoResultFoundMessage(e){return e&&e.word?G(1049,`No implementation found for '{0}'`,e.word):G(1050,`No implementation found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(67).multipleImplementations}};j(class e extends Cb{static{this.ID=`editor.action.goToImplementation`}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.ID,title:{...U(1067,`Go to Implementations`),mnemonicTitle:G(1051,`Go to &&Implementations`)},precondition:y.hasImplementationProvider,keybinding:{when:y.editorTextFocus,primary:2118,weight:100},menu:[{id:S.EditorContext,group:`navigation`,order:1.45},{id:S.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:4}]})}}),j(class e extends Cb{static{this.ID=`editor.action.peekImplementation`}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.ID,title:U(1068,`Peek Implementations`),precondition:E.and(y.hasImplementationProvider,yy.notInPeekEditor,y.isInEmbeddedEditor.toNegated()),keybinding:{when:y.editorTextFocus,primary:3142,weight:100},menu:{id:S.EditorContextPeek,group:`peek`,order:5}})}});var wb=class extends yb{_getNoResultFoundMessage(e){return e?G(1052,`No references found for '{0}'`,e.word):G(1053,`No references found`)}_getAlternativeCommand(e){return e.getOption(67).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(67).multipleReferences}};j(class extends wb{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:`editor.action.goToReferences`,title:{...U(1069,`Go to References`),mnemonicTitle:G(1054,`Go to &&References`)},precondition:E.and(y.hasReferenceProvider,yy.notInPeekEditor,y.isInEmbeddedEditor.toNegated()),keybinding:{when:y.editorTextFocus,primary:1094,weight:100},menu:[{id:S.EditorContext,group:`navigation`,order:1.45},{id:S.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:5}]})}async _getLocationModel(e,t,n,r){return new My(await gb(e.referenceProvider,t,n,!0,!1,r),G(1055,`References`))}}),j(class extends wb{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:`editor.action.referenceSearch.trigger`,title:U(1070,`Peek References`),precondition:E.and(y.hasReferenceProvider,yy.notInPeekEditor,y.isInEmbeddedEditor.toNegated()),menu:{id:S.EditorContextPeek,group:`peek`,order:6}})}async _getLocationModel(e,t,n,r){return new My(await gb(e.referenceProvider,t,n,!1,!1,r),G(1056,`References`))}});var Tb=class extends yb{constructor(e,t,n){super(e,{id:`editor.action.goToLocation`,title:U(1071,`Go to Any Symbol`),precondition:E.and(yy.notInPeekEditor,y.isInEmbeddedEditor.toNegated())}),this._references=t,this._gotoMultipleBehaviour=n}async _getLocationModel(e,t,n,r){return new My(this._references,G(1057,`Locations`))}_getNoResultFoundMessage(e){return e&&G(1058,`No results for '{0}'`,e.word)||``}_getGoToPreference(e){return this._gotoMultipleBehaviour??e.getOption(67).multipleReferences}_getAlternativeCommand(){}};gd.registerCommand({id:`editor.action.goToLocations`,metadata:{description:`Go to locations from a position in a file`,args:[{name:`uri`,description:`The text document in which to start`,constraint:ur},{name:`position`,description:`The position at which to start`,constraint:C.isIPosition},{name:`locations`,description:`An array of locations.`,constraint:Array},{name:`multiple`,description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"},{name:`noResultsMessage`,description:`Human readable message that shows when locations is empty.`}]},handler:async(e,t,n,r,i,a,o)=>{J(ur.isUri(t)),J(C.isIPosition(n)),J(Array.isArray(r)),J(i===void 0||typeof i==`string`),J(o===void 0||typeof o==`boolean`);let s=e.get(xl),c=await s.openCodeEditor({resource:t},s.getFocusedCodeEditor());if(Lu(c))return c.setPosition(n),c.revealPositionInCenterIfOutsideViewport(n,0),c.invokeWithinContext(e=>{let t=new class extends Tb{_getNoResultFoundMessage(e){return a||super._getNoResultFoundMessage(e)}}({muteMessage:!a,openInPeek:!!o,openToSide:!1},r,i);e.get(k).invokeFunction(t.run.bind(t),c)})}}),gd.registerCommand({id:`editor.action.peekLocations`,metadata:{description:`Peek locations from a position in a file`,args:[{name:`uri`,description:`The text document in which to start`,constraint:ur},{name:`position`,description:`The position at which to start`,constraint:C.isIPosition},{name:`locations`,description:`An array of locations.`,constraint:Array},{name:`multiple`,description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"}]},handler:async(e,t,n,r,i)=>{e.get(Te).executeCommand(`editor.action.goToLocations`,t,n,r,i,void 0,!0)}}),gd.registerCommand({id:`editor.action.findReferences`,handler:(e,t,n)=>{J(ur.isUri(t)),J(C.isIPosition(n));let r=e.get(H),i=e.get(xl);return i.openCodeEditor({resource:t},i.getFocusedCodeEditor()).then(e=>{if(!Lu(e)||!e.hasModel())return;let t=nb.get(e);if(!t)return;let i=li(t=>gb(r.referenceProvider,e.getModel(),C.lift(n),!1,!1,t).then(e=>new My(e,G(1059,`References`)))),a=new T(n.lineNumber,n.column,n.lineNumber,n.column);return Promise.resolve(t.toggleWidget(a,i,!1))})}}),gd.registerCommandAlias(`editor.action.showReferences`,`editor.action.peekLocations`);async function Eb(e,t,n,r){let i=e.get(Et),a=e.get(Bc),o=e.get(Te),s=e.get(k),c=e.get(Ur);if(await r.item.resolve(M.None),!r.part.location)return;let l=r.part.location,u=[],d=new Set(sc.getMenuItems(S.EditorContext).map(e=>Ys(e)?e.command.id:cs()));for(let e of yb.all())d.has(e.desc.id)&&u.push(new Rt(e.desc.id,cr.label(e.desc,{renderShortTitle:!0}),void 0,!0,async()=>{let n=await i.createModelReference(l.uri);try{let i=new vb(n.object.textEditorModel,T.getStartPosition(l.range)),a=r.item.anchor.range;await s.invokeFunction(e.runEditorCommand.bind(e),t,i,a)}finally{n.dispose()}}));if(r.part.command){let{command:e}=r.part;u.push(new wi),u.push(new Rt(e.id,e.title,void 0,!0,async()=>{try{await o.executeCommand(e.id,...e.arguments??[])}catch(e){c.notify({severity:hd.Error,source:r.item.provider.displayName,message:e})}}))}let f=t.getOption(144);a.showContextMenu({domForShadowRoot:f?t.getDomNode()??void 0:void 0,getAnchor:()=>{let e=vs(n);return{x:e.left,y:e.top+e.height+8}},getActions:()=>u,onHide:()=>{t.focus()},autoSelectFirstItem:!0})}async function Db(e,t,n,r){let i=await e.get(Et).createModelReference(r.uri);await n.invokeWithinContext(async e=>{let a=t.hasSideBySideModifier,o=e.get(On),s=yy.inPeekEditor.getValue(o),c=!a&&n.getOption(101)&&!s;return new bb({openToSide:a,openInPeek:c,muteMessage:!0},{title:{value:``,original:``},id:``,precondition:void 0}).run(e,new vb(i.object.textEditorModel,T.getStartPosition(r.range)),T.lift(r.range))}),i.dispose()}var Ob=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},kb=function(e,t){return function(n,r){t(n,r,e)}},Ab,jb=class e{constructor(){this._entries=new ti(50)}get(t){let n=e._key(t);return this._entries.get(n)}set(t,n){let r=e._key(t);this._entries.set(r,n)}static _key(e){return`${e.uri.toString()}/${e.getVersionId()}`}},Mb=ma(`IInlayHintsCache`);Ui(Mb,jb,1);var Nb=class{constructor(e,t){this.item=e,this.index=t}get part(){let e=this.item.hint.label;return typeof e==`string`?{label:e}:e[this.index]}},Pb=class{constructor(e,t){this.part=e,this.hasTriggerModifier=t}},Fb=class{static{Ab=this}static{this.ID=`editor.contrib.InlayHints`}static{this._MAX_DECORATORS=1500}static{this._whitespaceData={}}static get(e){return e.getContribution(Ab.ID)??void 0}constructor(e,t,n,r,i,a,o){this._editor=e,this._languageFeaturesService=t,this._inlayHintsCache=r,this._commandService=i,this._notificationService=a,this._instaService=o,this._disposables=new L,this._sessionDisposables=new L,this._decorationsMetadata=new Map,this._activeRenderMode=0,this._ruleFactory=this._disposables.add(new Ws(this._editor)),this._debounceInfo=n.for(t.inlayHintsProvider,`InlayHint`,{min:25}),this._disposables.add(t.inlayHintsProvider.onDidChange(()=>this._update())),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(e=>{e.hasChanged(159)&&this._update()})),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){this._sessionDisposables.clear(),this._removeAllDecorations();let e=this._editor.getOption(159);if(e.enabled===`off`)return;let t=this._editor.getModel();if(!t||!this._languageFeaturesService.inlayHintsProvider.has(t))return;if(e.enabled===`on`)this._activeRenderMode=0;else{let t,n;e.enabled===`onUnlessPressed`?(t=0,n=1):(t=1,n=0),this._activeRenderMode=t,this._sessionDisposables.add(El.getInstance().event(e=>{if(!this._editor.hasModel())return;let r=e.altKey&&e.ctrlKey&&!(e.shiftKey||e.metaKey)?n:t;if(r!==this._activeRenderMode){this._activeRenderMode=r;let e=this._editor.getModel(),t=this._copyInlayHintsWithCurrentAnchor(e);this._updateHintsDecorators([e.getFullModelRange()],t),a.schedule(0)}}))}let n=this._inlayHintsCache.get(t);n&&this._updateHintsDecorators([t.getFullModelRange()],n),this._sessionDisposables.add(Cl(()=>{t.isDisposed()||this._cacheHintsForFastRestore(t)}));let r,i=new Set,a=new Zr(async()=>{let e=Date.now();r?.dispose(!0),r=new Sr;let n=t.onWillDispose(()=>r?.cancel());try{let n=r.token,o=await ry.create(this._languageFeaturesService.inlayHintsProvider,t,this._getHintsRanges(),n);if(a.delay=this._debounceInfo.update(t,Date.now()-e),n.isCancellationRequested){o.dispose();return}for(let e of o.provider)typeof e.onDidChangeInlayHints==`function`&&!i.has(e)&&(i.add(e),this._sessionDisposables.add(e.onDidChangeInlayHints(()=>{a.isScheduled()||a.schedule()})));this._sessionDisposables.add(o),this._updateHintsDecorators(o.ranges,o.items),this._cacheHintsForFastRestore(t)}catch(e){mr(e)}finally{r.dispose(),n.dispose()}},this._debounceInfo.get(t));this._sessionDisposables.add(a),this._sessionDisposables.add(Cl(()=>r?.dispose(!0))),a.schedule(0),this._sessionDisposables.add(this._editor.onDidScrollChange(e=>{(e.scrollTopChanged||!a.isScheduled())&&a.schedule()}));let o=this._sessionDisposables.add(new Bt);this._sessionDisposables.add(this._editor.onDidChangeModelContent(e=>{r?.cancel();let t=Math.max(a.delay,800);this._cursorInfo={position:this._editor.getPosition(),notEarlierThan:Date.now()+t},o.value=$e(()=>a.schedule(0),t),a.schedule()})),this._sessionDisposables.add(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(159)&&a.schedule()})),this._sessionDisposables.add(this._installDblClickGesture(()=>a.schedule(0))),this._sessionDisposables.add(this._installLinkGesture()),this._sessionDisposables.add(this._installContextMenu())}_installLinkGesture(){let e=new L,t=e.add(new ey(this._editor)),n=new L;return e.add(n),e.add(t.onMouseMoveOrRelevantKeyDown(e=>{let[t]=e,r=this._getInlayHintLabelPart(t),i=this._editor.getModel();if(!r||!i){n.clear();return}let a=new Sr;n.add(Cl(()=>a.dispose(!0))),r.item.resolve(a.token),this._activeInlayHintPart=r.part.command||r.part.location?new Pb(r,t.hasTriggerModifier):void 0;let o=i.validatePosition(r.item.hint.position).lineNumber,s=new T(o,1,o,i.getLineMaxColumn(o)),c=this._getInlineHintsForRange(s);this._updateHintsDecorators([s],c),n.add(Cl(()=>{this._activeInlayHintPart=void 0,this._updateHintsDecorators([s],c)}))})),e.add(t.onCancel(()=>n.clear())),e.add(t.onExecute(async e=>{let t=this._getInlayHintLabelPart(e);if(t){let n=t.part;n.location?this._instaService.invokeFunction(Db,e,this._editor,n.location):Za.is(n.command)&&await this._invokeCommand(n.command,t.item)}})),e}_getInlineHintsForRange(e){let t=new Set;for(let n of this._decorationsMetadata.values())e.containsRange(n.item.anchor.range)&&t.add(n.item);return Array.from(t)}_installDblClickGesture(e){return this._editor.onMouseUp(async t=>{if(t.event.detail!==2)return;let n=this._getInlayHintLabelPart(t);if(n&&(t.event.preventDefault(),await n.item.resolve(M.None),$t(n.item.hint.textEdits))){let t=n.item.hint.textEdits.map(e=>Ss.replace(T.lift(e.range),e.text));this._editor.executeEdits(`inlayHint.default`,t),e()}})}_installContextMenu(){return this._editor.onContextMenu(async e=>{if(!oi(e.event.target))return;let t=this._getInlayHintLabelPart(e);t&&await this._instaService.invokeFunction(Eb,this._editor,e.event.target,t)})}_getInlayHintLabelPart(e){if(e.target.type!==6)return;let t=e.target.detail.injectedText?.options;if(t instanceof La&&t?.attachedData instanceof Nb)return t.attachedData}async _invokeCommand(e,t){try{await this._commandService.executeCommand(e.id,...e.arguments??[])}catch(e){this._notificationService.notify({severity:hd.Error,source:t.provider.displayName,message:e})}}_cacheHintsForFastRestore(e){let t=this._copyInlayHintsWithCurrentAnchor(e);this._inlayHintsCache.set(e,t)}_copyInlayHintsWithCurrentAnchor(e){let t=new Map;for(let[n,r]of this._decorationsMetadata){if(t.has(r.item))continue;let i=e.getDecorationRange(n);if(i){let e=new ty(i,r.item.anchor.direction),n=r.item.with({anchor:e});t.set(r.item,n)}}return Array.from(t.values())}_getHintsRanges(){let e=this._editor.getModel(),t=this._editor.getVisibleRangesPlusViewportAboveBelow(),n=[];for(let r of t.sort(T.compareRangesUsingStarts)){let t=e.validateRange(new T(r.startLineNumber-30,r.startColumn,r.endLineNumber+30,r.endColumn));n.length===0||!T.areIntersectingOrTouching(n[n.length-1],t)?n.push(t):n[n.length-1]=T.plusRange(n[n.length-1],t)}return n}_updateHintsDecorators(e,t){let n=new Map;if(this._cursorInfo&&this._cursorInfo.notEarlierThan>Date.now()&&e.some(e=>e.containsPosition(this._cursorInfo.position))){let{position:e}=this._cursorInfo;this._cursorInfo=void 0;let r=new Map;for(let t of this._editor.getLineDecorations(e.lineNumber)??[]){let n=this._decorationsMetadata.get(t.id);if(t.range.startColumn>e.column)continue;let i=n?.decoration.options[n.item.anchor.direction];if(i&&i.attachedData!==Ab._whitespaceData){let e=r.get(n.item)??0;r.set(n.item,e+i.content.length)}}let i=t.filter(t=>t.anchor.range.startLineNumber===e.lineNumber&&t.anchor.range.endColumn<=e.column),a=Array.from(r.values()),o;for(;;){let e=i.shift(),t=a.shift();if(!t&&!e)break;if(e)n.set(e,t??0),o=e;else if(o&&t){let e=n.get(o);e+=t,e+=a.reduce((e,t)=>e+t,0),a.length=0;break}}}let r=[],i=(e,t,n,i,a)=>{let o={content:n,inlineClassNameAffectsLetterSpacing:!0,inlineClassName:t.className,cursorStops:i,attachedData:a};r.push({item:e,classNameRef:t,decoration:{range:e.anchor.range,options:{description:`InlayHint`,showIfCollapsed:e.anchor.range.isEmpty(),collapseOnReplaceEdit:!e.anchor.range.isEmpty(),stickiness:0,[e.anchor.direction]:this._activeRenderMode===0?o:void 0}}})},a=(e,t)=>{let n=this._ruleFactory.createClassNameRef({width:`${o/3|0}px`,display:`inline-block`});i(e,n,``,t?Yn.Right:Yn.None,Ab._whitespaceData)},{fontSize:o,fontFamily:s,padding:c,isUniform:l}=this._getLayoutInfo(),u=this._editor.getOption(159).maximumLength,d=`--code-editorInlayHintsFontFamily`;this._editor.getContainerDomNode().style.setProperty(d,s);let f={line:0,totalLen:0};for(let e=0;e<t.length;e++){let s=t[e];if(f.line!==s.anchor.range.startLineNumber&&(f={line:s.anchor.range.startLineNumber,totalLen:0}),u&&f.totalLen>u)continue;s.hint.paddingLeft&&a(s,!1);let p=typeof s.hint.label==`string`?[{label:s.hint.label}]:s.hint.label,m=n.get(s),h=0;for(let e=0;e<p.length;e++){let t=p[e],n=e===0,r=e===p.length-1,a={fontSize:`${o}px`,fontFamily:`var(${d}), ${ga.fontFamily}`,verticalAlign:l?`baseline`:`middle`,unicodeBidi:`isolate`};$t(s.hint.textEdits)&&(a.cursor=`default`),this._fillInColors(a,s.hint),(t.command||t.location)&&this._activeInlayHintPart?.part.item===s&&this._activeInlayHintPart.part.index===e&&(a.textDecoration=`underline`,this._activeInlayHintPart.hasTriggerModifier&&(a.color=Ta(No),a.cursor=`pointer`));let g=t.label;f.totalLen+=g.length;let _=!1,ee=u===0?0:f.totalLen-u;if(ee>0&&(g=g.slice(0,-ee)+``,_=!0),h+=g.length,m!==void 0){let e=h-m;e>=0&&(h-=e,g=g.slice(0,-(1+e))+``,_=!0)}if(c&&(n&&(r||_)?(a.padding=`1px ${Math.max(1,o/4)|0}px`,a.borderRadius=`${o/4|0}px`):n?(a.padding=`1px 0 1px ${Math.max(1,o/4)|0}px`,a.borderRadius=`${o/4|0}px 0 0 ${o/4|0}px`):r||_?(a.padding=`1px ${Math.max(1,o/4)|0}px 1px 0`,a.borderRadius=`0 ${o/4|0}px ${o/4|0}px 0`):a.padding=`1px 0 1px 0`),i(s,this._ruleFactory.createClassNameRef(a),Ib(g),r&&!s.hint.paddingRight?Yn.Right:Yn.None,new Nb(s,e)),_)break}if(m!==void 0&&h<m){let e=m-h;i(s,this._ruleFactory.createClassNameRef({}),``.repeat(e),Yn.None)}if(s.hint.paddingRight&&a(s,!0),r.length>Ab._MAX_DECORATORS)break}let p=[];for(let[t,n]of this._decorationsMetadata){let r=this._editor.getModel()?.getDecorationRange(t);r&&e.some(e=>e.containsRange(r))&&(p.push(t),n.classNameRef.dispose(),this._decorationsMetadata.delete(t))}let m=sd.capture(this._editor);this._editor.changeDecorations(e=>{let t=e.deltaDecorations(p,r.map(e=>e.decoration));for(let e=0;e<t.length;e++){let n=r[e];this._decorationsMetadata.set(t[e],n)}}),m.restore(this._editor)}_fillInColors(e,t){t.kind===Mo.Parameter?(e.backgroundColor=Ta(Aa),e.color=Ta(_u)):t.kind===Mo.Type?(e.backgroundColor=Ta(Xu),e.color=Ta($a)):(e.backgroundColor=Ta(_s),e.color=Ta(rs))}_getLayoutInfo(){let e=this._editor.getOption(159),t=e.padding,n=this._editor.getOption(61),r=this._editor.getOption(58),i=e.fontSize;(!i||i<5||i>n)&&(i=n);let a=e.fontFamily||r;return{fontSize:i,fontFamily:a,padding:t,isUniform:!t&&a===r&&i===n}}_removeAllDecorations(){this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));for(let e of this._decorationsMetadata.values())e.classNameRef.dispose();this._decorationsMetadata.clear()}};Fb=Ab=Ob([kb(1,H),kb(2,fu),kb(3,Mb),kb(4,Te),kb(5,Ur),kb(6,k)],Fb);function Ib(e){return e.replace(/[ \t]/g,`\xA0`)}gd.registerCommand(`_executeInlayHintProvider`,async(e,...t)=>{let[n,r]=t;J(ur.isUri(n)),J(T.isIRange(r));let{inlayHintsProvider:i}=e.get(H),a=await e.get(Et).createModelReference(n);try{let e=await ry.create(i,a.object.textEditorModel,[T.lift(r)],M.None),t=e.items.map(e=>e.hint);return setTimeout(()=>e.dispose(),0),t}finally{a.dispose()}});var Lb=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Rb=function(e,t){return function(n,r){t(n,r,e)}},zb=class extends n_{constructor(e,t,n,r){super(10,t,e.item.anchor.range,n,r,!0),this.part=e}},Bb=class extends bv{constructor(e,t,n,r,i,a,o,s,c){super(e,t,n,a,s,r,i,c),this._resolverService=o,this.hoverOrdinal=6}suggestHoverAnchor(e){if(!Fb.get(this._editor)||e.target.type!==6)return null;let t=e.target.detail.injectedText?.options;return t instanceof La&&t.attachedData instanceof Nb?new zb(t.attachedData,this,e.event.posx,e.event.posy):null}computeSync(){return[]}computeAsync(e,t,n,r){return e instanceof zb?new ed(async t=>{let{part:n}=e;if(await n.item.resolve(r),r.isCancellationRequested)return;let i;typeof n.item.hint.tooltip==`string`?i=new Jn().appendText(n.item.hint.tooltip):n.item.hint.tooltip&&(i=n.item.hint.tooltip),i&&t.emitOne(new vv(this,e.range,[i],!1,0)),$t(n.item.hint.textEdits)&&t.emitOne(new vv(this,e.range,[new Jn().appendText(G(1157,`Double-click to insert`))],!1,10001));let a;if(typeof n.part.tooltip==`string`?a=new Jn().appendText(n.part.tooltip):n.part.tooltip&&(a=n.part.tooltip),a&&t.emitOne(new vv(this,e.range,[a],!1,1)),n.part.location||n.part.command){let r,i=this._editor.getOption(86)===`altKey`?po?G(1158,`cmd + click`):G(1159,`ctrl + click`):po?G(1160,`option + click`):G(1161,`alt + click`);n.part.location&&n.part.command?r=new Jn().appendText(G(1162,`Go to Definition ({0}), right click for more`,i)):n.part.location?r=new Jn().appendText(G(1163,`Go to Definition ({0})`,i)):n.part.command&&(r=new Jn(`[${G(1164,`Execute Command`)}](${iy(n.part.command)} "${n.part.command.title}") (${i})`,{isTrusted:!0})),r&&t.emitOne(new vv(this,e.range,[r],!1,1e4))}let o=this._resolveInlayHintLabelPartHover(n,r);for await(let e of o)t.emitOne(e)}):ed.EMPTY}async*_resolveInlayHintLabelPartHover(e,t){if(!e.part.location)return;let{uri:n,range:r}=e.part.location,i=await this._resolverService.createModelReference(n);try{let n=i.object.textEditorModel;if(!this._languageFeaturesService.hoverProvider.has(n))return;for await(let i of uv(this._languageFeaturesService.hoverProvider,n,new C(r.startLineNumber,r.startColumn),t))dt(i.hover.contents)||(yield new vv(this,e.item.anchor.range,i.hover.contents,!1,2+i.ordinal))}finally{i.dispose()}}};Bb=Lb([Rb(1,wt),Rb(2,da),Rb(3,Yt),Rb(4,Is),Rb(5,hn),Rb(6,Et),Rb(7,H),Rb(8,Te)],Bb);var Vb=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Hb=function(e,t){return function(n,r){t(n,r,e)}},Ub,Wb,Gb=Ub=class extends x{constructor(e,t,n,r,i,a){super();let o=t.hoverParts;this._renderedHoverParts=this._register(new qb(e,n,o,r,i,a));let s=t.options,c=s.anchor,{showAtPosition:l,showAtSecondaryPosition:u}=Ub.computeHoverPositions(e,c.range,o);this.shouldAppearBeforeContent=o.some(e=>e.isBeforeContent),this.showAtPosition=l,this.showAtSecondaryPosition=u,this.initialMousePosX=c.initialMousePosX,this.initialMousePosY=c.initialMousePosY,this.shouldFocus=s.shouldFocus,this.source=s.source}get domNode(){return this._renderedHoverParts.domNode}get domNodeHasChildren(){return this._renderedHoverParts.domNodeHasChildren}get focusedHoverPartIndex(){return this._renderedHoverParts.focusedHoverPartIndex}get hoverPartsCount(){return this._renderedHoverParts.hoverPartsCount}focusHoverPartWithIndex(e){this._renderedHoverParts.focusHoverPartWithIndex(e)}async updateHoverVerbosityLevel(e,t,n){this._renderedHoverParts.updateHoverVerbosityLevel(e,t,n)}isColorPickerVisible(){return this._renderedHoverParts.isColorPickerVisible()}static computeHoverPositions(e,t,n){let r=1;if(e.hasModel()){let n=e._getViewModel(),i=n.coordinatesConverter,a=i.convertModelRangeToViewRange(t),o=n.getLineMinColumn(a.startLineNumber),s=new C(a.startLineNumber,o);r=i.convertViewPositionToModelPosition(s).column}let i=t.startLineNumber,a=t.startColumn,o;for(let e of n){let t=e.range,n=t.startLineNumber===i,s=t.endLineNumber===i;if(n&&s){let e=t.startColumn,n=Math.min(a,e);a=Math.max(n,r)}e.forceShowAtRange&&(o=t)}let s,c;if(o){let e=o.getStartPosition();s=e,c=e}else s=t.getStartPosition(),c=new C(i,a);return{showAtPosition:s,showAtSecondaryPosition:c}}};Gb=Ub=Vb([Hb(4,Yt),Hb(5,Is)],Gb);var Kb=class{constructor(e,t){this._statusBar=t,e.appendChild(this._statusBar.hoverElement)}get hoverElement(){return this._statusBar.hoverElement}get actions(){return this._statusBar.actions}dispose(){this._statusBar.dispose()}},qb=class extends x{static{Wb=this}static{this._DECORATION_OPTIONS=Y.register({description:`content-hover-highlight`,className:`hoverHighlight`})}constructor(e,t,n,r,i,a){super(),this._renderedParts=[],this._focusedHoverPartIndex=-1,this._context=r,this._fragment=document.createDocumentFragment(),this._register(this._renderParts(t,n,r,i,a)),this._register(this._registerListenersOnRenderedParts()),this._register(this._createEditorDecorations(e,n)),this._updateMarkdownAndColorParticipantInfo(t)}_createEditorDecorations(e,t){if(t.length===0)return x.None;let n=t[0].range;for(let e of t){let t=e.range;n=T.plusRange(n,t)}let r=e.createDecorationsCollection();return r.set([{range:n,options:Wb._DECORATION_OPTIONS}]),Cl(()=>{r.clear()})}_renderParts(e,t,n,r,i){let a=new sv(r,i),o={fragment:this._fragment,statusBar:a,...n},s=new L;s.add(a);for(let n of e){let e=this._renderHoverPartsForParticipant(t,n,o);s.add(e);for(let t of e.renderedHoverParts)this._renderedParts.push({type:`hoverPart`,participant:n,hoverPart:t.hoverPart,hoverElement:t.hoverElement})}let c=this._renderStatusBar(this._fragment,a);return c&&(s.add(c),this._renderedParts.push({type:`statusBar`,hoverElement:c.hoverElement,actions:c.actions})),s}_renderHoverPartsForParticipant(e,t,n){let r=e.filter(e=>e.owner===t);return r.length>0?t.renderHoverParts(n,r):new r_([])}_renderStatusBar(e,t){if(t.hasContent)return new Kb(e,t)}_registerListenersOnRenderedParts(){let e=new L;return this._renderedParts.forEach((t,n)=>{let r=t.hoverElement;r.tabIndex=0,e.add(z(r,Pc.FOCUS_IN,e=>{e.stopPropagation(),this._focusedHoverPartIndex=n})),e.add(z(r,Pc.FOCUS_OUT,e=>{e.stopPropagation(),this._focusedHoverPartIndex=-1}))}),e}_updateMarkdownAndColorParticipantInfo(e){let t=e.find(e=>e instanceof bv&&!(e instanceof Bb));t&&(this._markdownHoverParticipant=t),this._colorHoverParticipant=e.find(e=>e instanceof Jv)}focusHoverPartWithIndex(e){e<0||e>=this._renderedParts.length||this._renderedParts[e].hoverElement.focus()}async updateHoverVerbosityLevel(e,t,n){if(!this._markdownHoverParticipant)return;let r;r=t>=0?{start:t,endExclusive:t+1}:this._findRangeOfMarkdownHoverParts(this._markdownHoverParticipant);for(let t=r.start;t<r.endExclusive;t++){let n=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,t);if(n===void 0)continue;let r=await this._markdownHoverParticipant.updateMarkdownHoverVerbosityLevel(e,n);r&&(this._renderedParts[t]={type:`hoverPart`,participant:this._markdownHoverParticipant,hoverPart:r.hoverPart,hoverElement:r.hoverElement})}n&&(t>=0?this.focusHoverPartWithIndex(t):this._context.focus()),this._context.onContentsChanged()}isColorPickerVisible(){return this._colorHoverParticipant?.isColorPickerVisible()??!1}_normalizedIndexToMarkdownHoverIndexRange(e,t){let n=this._renderedParts[t];if(!n||n.type!==`hoverPart`||n.participant!==e)return;let r=this._renderedParts.findIndex(t=>t.type===`hoverPart`&&t.participant===e);if(r===-1)throw new se;return t-r}_findRangeOfMarkdownHoverParts(e){let t=this._renderedParts.slice(),n=t.findIndex(t=>t.type===`hoverPart`&&t.participant===e),r=t.reverse().findIndex(t=>t.type===`hoverPart`&&t.participant===e),i=r>=0?t.length-r:r;return{start:n,endExclusive:i+1}}get domNode(){return this._fragment}get domNodeHasChildren(){return this._fragment.hasChildNodes()}get focusedHoverPartIndex(){return this._focusedHoverPartIndex}get hoverPartsCount(){return this._renderedParts.length}};qb=Wb=Vb([Hb(4,Yt),Hb(5,Is)],qb);var Jb=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Yb=function(e,t){return function(n,r){t(n,r,e)}},Xb=class extends x{constructor(e,t,n,r){super(),this._editor=e,this._instantiationService=t,this._keybindingService=n,this._hoverService=r,this._currentResult=null,this._renderedContentHover=this._register(new Bt),this._onContentsChanged=this._register(new D),this.onContentsChanged=this._onContentsChanged.event,this._contentHoverWidget=this._register(this._instantiationService.createInstance($_,this._editor)),this._participants=this._initializeHoverParticipants(),this._hoverOperation=this._register(new U_(this._editor,new tv(this._editor,this._participants))),this._registerListeners()}_initializeHoverParticipants(){let e=[];for(let t of i_.getAll()){let n=this._instantiationService.createInstance(t,this._editor);e.push(n)}return e.sort((e,t)=>e.hoverOrdinal-t.hoverOrdinal),this._register(this._contentHoverWidget.onDidResize(()=>{this._participants.forEach(e=>e.handleResize?.())})),this._register(this._contentHoverWidget.onDidScroll(e=>{this._participants.forEach(t=>t.handleScroll?.(e))})),this._register(this._contentHoverWidget.onContentsChanged(()=>{this._participants.forEach(e=>e.handleContentsChanged?.())})),e}_registerListeners(){this._register(this._hoverOperation.onResult(e=>{let t=e.hasLoadingMessage?this._addLoadingMessage(e):e.value;this._withResult(new nv(t,e.isComplete,e.options))}));let e=this._contentHoverWidget.getDomNode();this._register(Ll(e,`keydown`,e=>{e.equals(9)&&this.hide()})),this._register(Ll(e,`mouseleave`,e=>{this._onMouseLeave(e)})),this._register(Ju.onDidChange(()=>{this._contentHoverWidget.position&&this._currentResult&&this._setCurrentResult(this._currentResult)})),this._register(this._contentHoverWidget.onContentsChanged(()=>{this._onContentsChanged.fire()}))}_startShowingOrUpdateHover(e,t,n,r,i){if(!(this._contentHoverWidget.position&&this._currentResult))return e?(this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):!1;let a=this._editor.getOption(69).sticky,o=i&&this._contentHoverWidget.isMouseGettingCloser(i.event.posx,i.event.posy);return a&&o?(e&&this._startHoverOperationIfNecessary(e,t,n,r,!0),!0):e?this._currentResult&&this._currentResult.options.anchor.equals(e)?!0:this._currentResult&&e.canAdoptVisibleHover(this._currentResult.options.anchor,this._contentHoverWidget.position)?(this._currentResult&&this._setCurrentResult(this._currentResult.filter(e)),this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):(this._setCurrentResult(null),this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):(this._setCurrentResult(null),!1)}_startHoverOperationIfNecessary(e,t,n,r,i){if(this._hoverOperation.options&&this._hoverOperation.options.anchor.equals(e))return;this._hoverOperation.cancel();let a={anchor:e,source:n,shouldFocus:r,insistOnKeepingHoverVisible:i};this._hoverOperation.start(t,a)}_setCurrentResult(e){let t=e;this._currentResult!==t&&(t&&t.hoverParts.length===0&&(t=null),this._currentResult=t,this._currentResult?this._showHover(this._currentResult):this._hideHover())}_addLoadingMessage(e){for(let t of this._participants){if(!t.createLoadingMessage)continue;let n=t.createLoadingMessage(e.options.anchor);if(n)return e.value.slice(0).concat([n])}return e.value}_withResult(e){if(this._contentHoverWidget.position&&this._currentResult&&this._currentResult.isComplete||this._setCurrentResult(e),!e.isComplete)return;let t=e.hoverParts.length===0,n=e.options.insistOnKeepingHoverVisible;t&&n||this._setCurrentResult(e)}_showHover(e){let t=this._getHoverContext();this._renderedContentHover.value=new Gb(this._editor,e,this._participants,t,this._keybindingService,this._hoverService),this._renderedContentHover.value.domNodeHasChildren?this._contentHoverWidget.show(this._renderedContentHover.value):this._renderedContentHover.clear()}_hideHover(){this._contentHoverWidget.hide(),this._participants.forEach(e=>e.handleHide?.())}_getHoverContext(){return{hide:()=>{this.hide()},onContentsChanged:()=>{this._contentHoverWidget.handleContentsChanged()},setMinimumDimensions:e=>{this._contentHoverWidget.setMinimumDimensions(e)},focus:()=>this.focus()}}showsOrWillShow(e){if(this._contentHoverWidget.isResizing)return!0;let t=this._findHoverAnchorCandidates(e);if(!(t.length>0))return this._startShowingOrUpdateHover(null,0,0,!1,e);let n=t[0];return this._startShowingOrUpdateHover(n,0,0,!1,e)}_findHoverAnchorCandidates(e){let t=[];for(let n of this._participants){if(!n.suggestHoverAnchor)continue;let r=n.suggestHoverAnchor(e);r&&t.push(r)}let n=e.target;switch(n.type){case 6:t.push(new t_(0,n.range,e.event.posx,e.event.posy));break;case 7:{let r=this._editor.getOption(59).typicalHalfwidthCharacterWidth/2;if(!(!n.detail.isAfterLines&&typeof n.detail.horizontalDistanceToText==`number`&&n.detail.horizontalDistanceToText<r))break;t.push(new t_(0,n.range,e.event.posx,e.event.posy));break}}return t.sort((e,t)=>t.priority-e.priority),t}_onMouseLeave(e){let t=this._editor.getDomNode();(!t||!V_(t,e.x,e.y))&&this.hide()}startShowingAtRange(e,t,n,r){this._startShowingOrUpdateHover(new t_(0,e,void 0,void 0),t,n,r,null)}async updateHoverVerbosityLevel(e,t,n){this._renderedContentHover.value?.updateHoverVerbosityLevel(e,t,n)}focusedHoverPartIndex(){return this._renderedContentHover.value?.focusedHoverPartIndex??-1}containsNode(e){return e?this._contentHoverWidget.getDomNode().contains(e):!1}focus(){if(this._renderedContentHover.value?.hoverPartsCount===1){this.focusHoverPartWithIndex(0);return}this._contentHoverWidget.focus()}focusHoverPartWithIndex(e){this._renderedContentHover.value?.focusHoverPartWithIndex(e)}scrollUp(){this._contentHoverWidget.scrollUp()}scrollDown(){this._contentHoverWidget.scrollDown()}scrollLeft(){this._contentHoverWidget.scrollLeft()}scrollRight(){this._contentHoverWidget.scrollRight()}pageUp(){this._contentHoverWidget.pageUp()}pageDown(){this._contentHoverWidget.pageDown()}goToTop(){this._contentHoverWidget.goToTop()}goToBottom(){this._contentHoverWidget.goToBottom()}hide(){this._hoverOperation.cancel(),this._setCurrentResult(null)}getDomNode(){return this._contentHoverWidget.getDomNode()}get isColorPickerVisible(){return this._renderedContentHover.value?.isColorPickerVisible()??!1}get isVisibleFromKeyboard(){return this._contentHoverWidget.isVisibleFromKeyboard}get isVisible(){return this._contentHoverWidget.isVisible}get isFocused(){return this._contentHoverWidget.isFocused}get isResizing(){return this._contentHoverWidget.isResizing}get widget(){return this._contentHoverWidget}};Xb=Jb([Yb(1,k),Yb(2,Yt),Yb(3,Is)],Xb);function Zb(e){let t=e.target;return!!t&&t.type===6&&t.detail.injectedText?.options.attachedData===y_}var Qb=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$b=function(e,t){return function(n,r){t(n,r,e)}},ex,tx=class extends x{static{ex=this}static{this.ID=`editor.contrib.contentHover`}constructor(e,t,n,r){super(),this._editor=e,this._instantiationService=n,this._keybindingService=r,this._onHoverContentsChanged=this._register(new D),this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new L,this._isMouseDown=!1,this._ignoreMouseEvents=!1,this._reactToEditorMouseMoveRunner=this._register(new Zr(()=>{this._mouseMoveEvent&&this._reactToEditorMouseMove(this._mouseMoveEvent)},0)),this._register(t.onDidShowContextMenu(()=>{this.hideContentHover(),this._ignoreMouseEvents=!0})),this._register(t.onDidHideContextMenu(()=>{this._ignoreMouseEvents=!1})),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(69)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(ex.ID)}_hookListeners(){let e=this._editor.getOption(69);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled||this._cancelSchedulerAndHide(),this._listenersStore.add(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e))),this._listenersStore.add(this._editor.onMouseLeave(e=>this._onEditorMouseLeave(e))),this._listenersStore.add(this._editor.onDidChangeModel(()=>this._cancelSchedulerAndHide())),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(e=>this._onEditorScrollChanged(e)))}_unhookListeners(){this._listenersStore.clear()}_cancelSchedulerAndHide(){this._cancelScheduler(),this.hideContentHover()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){this._ignoreMouseEvents||(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideContentHover()}_onEditorMouseDown(e){this._ignoreMouseEvents||(this._isMouseDown=!0,!this._shouldKeepHoverWidgetVisible(e)&&this.hideContentHover())}_shouldKeepHoverWidgetVisible(e){return this._isMouseOnContentHoverWidget(e)||this._isContentWidgetResizing()||Zb(e)}_isMouseOnContentHoverWidget(e){return this._contentWidget?V_(this._contentWidget.getDomNode(),e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._ignoreMouseEvents||(this._isMouseDown=!1)}_onEditorMouseLeave(e){this._ignoreMouseEvents||this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),!this._shouldKeepHoverWidgetVisible(e)&&this.hideContentHover())}_shouldKeepCurrentHover(e){let t=this._contentWidget;if(!t)return!1;let n=this._hoverSettings.sticky,r=(e,t)=>{let n=this._isMouseOnContentHoverWidget(e);return t&&n},i=e=>{let n=t.isColorPickerVisible,r=this._isMouseOnContentHoverWidget(e),i=n&&r,a=n&&this._isMouseDown;return i||a},a=(e,n)=>{let r=e.event.browserEvent.view;return r?n&&t.containsNode(r.document.activeElement)&&!r.getSelection()?.isCollapsed:!1},o=t.isFocused,s=t.isResizing,c=this._hoverSettings.sticky&&t.isVisibleFromKeyboard;return this.shouldKeepOpenOnEditorMouseMoveOrLeave||o||s||c||r(e,n)||i(e)||a(e,n)}_onEditorMouseMove(e){if(!this._ignoreMouseEvents){if(this._mouseMoveEvent=e,this._shouldKeepCurrentHover(e)){this._reactToEditorMouseMoveRunner.cancel();return}if(this._shouldRescheduleHoverComputation()){this._reactToEditorMouseMoveRunner.isScheduled()||this._reactToEditorMouseMoveRunner.schedule(this._hoverSettings.hidingDelay);return}this._reactToEditorMouseMove(e)}}_shouldRescheduleHoverComputation(){let e=this._hoverSettings.hidingDelay;return(this._contentWidget?.isVisible??!1)&&this._hoverSettings.sticky&&e>0}_reactToEditorMouseMove(e){this._hoverSettings.enabled&&this._getOrCreateContentWidget().showsOrWillShow(e)||this.hideContentHover()}_onKeyDown(e){if(this._ignoreMouseEvents||!this._contentWidget)return;let t=this._isPotentialKeyboardShortcut(e),n=this._isModifierKeyPressed(e);t||n||this._contentWidget.isFocused&&e.keyCode===2||this.hideContentHover()}_isPotentialKeyboardShortcut(e){if(!this._editor.hasModel()||!this._contentWidget)return!1;let t=this._keybindingService.softDispatch(e,this._editor.getDomNode()),n=t.kind===1,r=t.kind===2&&(t.commandId===`editor.action.showHover`||t.commandId===`editor.action.increaseHoverVerbosityLevel`||t.commandId===`editor.action.decreaseHoverVerbosityLevel`)&&this._contentWidget.isVisible;return n||r}_isModifierKeyPressed(e){return e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4}hideContentHover(){L_.dropDownVisible||this._contentWidget?.hide()}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(Xb,this._editor),this._listenersStore.add(this._contentWidget.onContentsChanged(()=>this._onHoverContentsChanged.fire()))),this._contentWidget}showContentHover(e,t,n,r){this._getOrCreateContentWidget().startShowingAtRange(e,t,n,r)}_isContentWidgetResizing(){return this._contentWidget?.widget.isResizing||!1}focusedHoverPartIndex(){return this._getOrCreateContentWidget().focusedHoverPartIndex()}updateHoverVerbosityLevel(e,t,n){this._getOrCreateContentWidget().updateHoverVerbosityLevel(e,t,n)}focus(){this._contentWidget?.focus()}scrollUp(){this._contentWidget?.scrollUp()}scrollDown(){this._contentWidget?.scrollDown()}scrollLeft(){this._contentWidget?.scrollLeft()}scrollRight(){this._contentWidget?.scrollRight()}pageUp(){this._contentWidget?.pageUp()}pageDown(){this._contentWidget?.pageDown()}goToTop(){this._contentWidget?.goToTop()}goToBottom(){this._contentWidget?.goToBottom()}get isColorPickerVisible(){return this._contentWidget?.isColorPickerVisible}get isHoverVisible(){return this._contentWidget?.isVisible}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._contentWidget?.dispose()}};tx=ex=Qb([$b(1,Bc),$b(2,k),$b(3,Yt)],tx);var nx=class extends x{static{this.ID=`editor.contrib.colorContribution`}constructor(e){super(),this._editor=e,this._register(e.onMouseDown(e=>this.onMouseDown(e)))}dispose(){super.dispose()}onMouseDown(e){let t=this._editor.getOption(168);if(t!==`click`&&t!==`clickAndHover`||!Zb(e))return;let n=this._editor.getContribution(tx.ID);if(!n||n.isColorPickerVisible)return;let r=e.target.range;if(!r)return;let i=new T(r.startLineNumber,r.startColumn+1,r.endLineNumber,r.endColumn+1);n.showContentHover(i,1,1,!1)}},rx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ix=function(e,t){return function(n,r){t(n,r,e)}},ax=class e{constructor(e,t,n,r){this.owner=e,this.range=t,this.model=n,this.provider=r}static fromBaseColor(t,n){return new e(t,n.range,n.model,n.provider)}},ox=class extends x{constructor(e,t,n,r){super();let i=e.getModel(),a=n.model;this.color=n.model.color,this.colorPicker=this._register(new Bv(t.fragment,a,e.getOption(163),r,`standalone`)),this._register(a.onColorFlushed(e=>{this.color=e})),this._register(a.onDidChangeColor(e=>{Wv(i,a,e,n.range,n)}));let o=!1;this._register(e.onDidChangeModelContent(n=>{o?o=!1:(t.hide(),e.focus())})),Wv(i,a,this.color,n.range,n)}},sx=class{constructor(e,t){this._editor=e,this._themeService=t}async createColorHover(e,t,n){if(!this._editor.hasModel()||!b_.get(this._editor))return null;let r=await l_(n,this._editor.getModel(),M.None),i=null,a=null;for(let t of r){let n=t.colorInfo;T.containsRange(n.range,e.range)&&(i=n,a=t.provider)}let o=i??e,s=a??t,c=!!i;return{colorHover:ax.fromBaseColor(this,await Hv(this._editor.getModel(),o,s)),foundInEditor:c}}async updateEditorModel(e){if(!this._editor.hasModel())return;let t=e.model,n=new T(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn);this._color&&(await Wv(this._editor.getModel(),t,this._color,n,e),n=Uv(this._editor,n,t))}renderHoverParts(e,t){if(!(t.length===0||!this._editor.hasModel()))return this._setMinimumDimensions(e),this._renderedParts=new ox(this._editor,e,t[0],this._themeService),this._renderedParts}_setMinimumDimensions(e){let t=this._editor.getOption(75)+8;e.setMinimumDimensions(new Po(302,t))}get _color(){return this._renderedParts?.color}};sx=rx([ix(1,pa)],sx);var cx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lx=function(e,t){return function(n,r){t(n,r,e)}},ux,dx=class{constructor(e,t){this.value=e,this.foundInEditor=t}},fx=8,px=22,mx=class extends x{static{ux=this}static{this.ID=`editor.contrib.standaloneColorPickerWidget`}constructor(e,t,n,r,i,a,o,s){super(),this._editor=e,this._standaloneColorPickerVisible=t,this._standaloneColorPickerFocused=n,this._keybindingService=i,this._languageFeaturesService=a,this._editorWorkerService=o,this._hoverService=s,this.allowEditorOverflow=!0,this._position=void 0,this._body=document.createElement(`div`),this._colorHover=null,this._selectionSetInEditor=!1,this._onResult=this._register(new D),this.onResult=this._onResult.event,this._renderedHoverParts=this._register(new Bt),this._renderedStatusBar=this._register(new Bt),this._standaloneColorPickerVisible.set(!0),this._standaloneColorPickerParticipant=r.createInstance(sx,this._editor),this._position=this._editor._getViewModel()?.getPrimaryCursorState().modelState.position;let c=this._editor.getSelection(),l=c?{startLineNumber:c.startLineNumber,startColumn:c.startColumn,endLineNumber:c.endLineNumber,endColumn:c.endColumn}:{startLineNumber:0,endLineNumber:0,endColumn:0,startColumn:0},u=this._register(Wn(this._body));this._register(u.onDidBlur(e=>{this.hide()})),this._register(u.onDidFocus(e=>{this.focus()})),this._register(this._editor.onDidChangeCursorPosition(()=>{this._selectionSetInEditor?this._selectionSetInEditor=!1:this.hide()})),this._register(this._editor.onMouseMove(e=>{let t=e.target.element?.classList;t&&t.contains(`colorpicker-color-decoration`)&&this.hide()})),this._register(this.onResult(e=>{this._render(e.value,e.foundInEditor)})),this._start(l),this._body.style.zIndex=`50`,this._editor.addContentWidget(this)}updateEditor(){this._colorHover&&this._standaloneColorPickerParticipant.updateEditorModel(this._colorHover)}getId(){return ux.ID}getDomNode(){return this._body}getPosition(){if(!this._position)return null;let e=this._editor.getOption(69).above;return{position:this._position,secondaryPosition:this._position,preference:e?[1,2]:[2,1],positionAffinity:2}}hide(){this.dispose(),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerFocused.set(!1),this._editor.removeContentWidget(this),this._editor.focus()}focus(){this._standaloneColorPickerFocused.set(!0),this._body.focus()}async _start(e){let t=await this._computeAsync(e);t&&this._onResult.fire(new dx(t.result,t.foundInEditor))}async _computeAsync(e){if(!this._editor.hasModel())return null;let t={range:e,color:{red:0,green:0,blue:0,alpha:1}},n=await this._standaloneColorPickerParticipant.createColorHover(t,new s_(this._editorWorkerService),this._languageFeaturesService.colorProvider);return n?{result:n.colorHover,foundInEditor:n.foundInEditor}:null}_render(e,t){let n=document.createDocumentFragment();this._renderedStatusBar.value=this._register(new sv(this._keybindingService,this._hoverService));let r={fragment:n,statusBar:this._renderedStatusBar.value,onContentsChanged:()=>{},setMinimumDimensions:()=>{},hide:()=>this.hide(),focus:()=>this.focus()};if(this._colorHover=e,this._renderedHoverParts.value=this._standaloneColorPickerParticipant.renderHoverParts(r,[e]),!this._renderedHoverParts.value){this._renderedStatusBar.clear(),this._renderedHoverParts.clear();return}let i=this._renderedHoverParts.value.colorPicker;this._body.classList.add(`standalone-colorpicker-body`),this._body.style.maxHeight=Math.max(this._editor.getLayoutInfo().height/4,250)+`px`,this._body.style.maxWidth=Math.max(this._editor.getLayoutInfo().width*.66,500)+`px`,this._body.tabIndex=0,this._body.appendChild(n),i.layout();let a=i.body,o=a.saturationBox.domNode.clientWidth,s=a.domNode.clientWidth-o-px-fx,c=i.body.enterButton;c?.onClicked(()=>{this.updateEditor(),this.hide()});let l=i.header,u=l.pickedColorNode;u.style.width=o+fx+`px`;let d=l.originalColorNode;d.style.width=s+`px`,i.header.closeButton?.onClicked(()=>{this.hide()}),t&&(c&&(c.button.textContent=`Replace`),this._selectionSetInEditor=!0,this._editor.setSelection(e.range)),this._editor.layoutContentWidget(this)}};mx=ux=cx([lx(3,k),lx(4,Yt),lx(5,H),lx(6,Xs),lx(7,Is)],mx);var hx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gx=function(e,t){return function(n,r){t(n,r,e)}},_x,vx=class extends x{static{_x=this}static{this.ID=`editor.contrib.standaloneColorPickerController`}constructor(e,t,n){super(),this._editor=e,this._instantiationService=n,this._standaloneColorPickerWidget=null,this._standaloneColorPickerVisible=y.standaloneColorPickerVisible.bindTo(t),this._standaloneColorPickerFocused=y.standaloneColorPickerFocused.bindTo(t)}showOrFocus(){this._editor.hasModel()&&(this._standaloneColorPickerVisible.get()?this._standaloneColorPickerFocused.get()||this._standaloneColorPickerWidget?.focus():this._standaloneColorPickerWidget=this._instantiationService.createInstance(mx,this._editor,this._standaloneColorPickerVisible,this._standaloneColorPickerFocused))}hide(){this._standaloneColorPickerFocused.set(!1),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerWidget?.hide(),this._editor.focus()}insertColor(){this._standaloneColorPickerWidget?.updateEditor(),this.hide()}static get(e){return e.getContribution(_x.ID)}};vx=_x=hx([gx(1,On),gx(2,k)],vx);var yx=class extends wa{constructor(){super({id:`editor.action.showOrFocusStandaloneColorPicker`,title:{...U(884,`Show or Focus Standalone Color Picker`),mnemonicTitle:G(883,`&&Show or Focus Standalone Color Picker`)},precondition:void 0,menu:[{id:S.CommandPalette}],metadata:{description:U(885,`Show or focus a standalone color picker which uses the default color provider. It displays hex/rgb/hsl colors.`)}})}runEditorCommand(e,t){vx.get(t)?.showOrFocus()}},bx=class extends R{constructor(){super({id:`editor.action.hideColorPicker`,label:U(886,`Hide the Color Picker`),precondition:y.standaloneColorPickerVisible.isEqualTo(!0),kbOpts:{primary:9,weight:100},metadata:{description:U(887,`Hide the standalone color picker.`)}})}run(e,t){vx.get(t)?.hide()}},xx=class extends R{constructor(){super({id:`editor.action.insertColorWithStandaloneColorPicker`,label:U(888,`Insert Color with Standalone Color Picker`),precondition:y.standaloneColorPickerFocused.isEqualTo(!0),kbOpts:{primary:3,weight:100},metadata:{description:U(889,`Insert hex/rgb/hsl colors with the focused standalone color picker.`)}})}run(e,t){vx.get(t)?.insertColor()}};q(bx),q(xx),j(yx),K(nx.ID,nx,2),K(vx.ID,vx,1),K(b_.ID,b_,1),cn(c_),i_.register(Jv),gd.registerCommand(`_executeDocumentColorProvider`,function(e,...t){let[n]=t;if(!(n instanceof ur))throw Pn();let{model:r,colorProviderRegistry:i,defaultColorDecoratorsEnablement:a}=h_(e,n);return m_(new f_,i,r,M.None,a)}),gd.registerCommand(`_executeColorPresentationProvider`,function(e,...t){let[n,r]=t,{uri:i,range:a}=r;if(!(i instanceof ur)||!Array.isArray(n)||n.length!==4||!T.isIRange(a))throw Pn();let{model:o,colorProviderRegistry:s,defaultColorDecoratorsEnablement:c}=h_(e,i),[l,u,d,f]=n;return m_(new p_({range:a,color:{red:l,green:u,blue:d,alpha:f}}),s,o,M.None,c)});var Sx=class e{constructor(e,t,n){this.languageConfigurationService=n,this._selection=e,this._insertSpace=t,this._usedEndToken=null}static _haystackHasNeedleAtOffset(e,t,n){if(n<0)return!1;let r=t.length,i=e.length;if(n+r>i)return!1;for(let i=0;i<r;i++){let r=e.charCodeAt(n+i),a=t.charCodeAt(i);if(r!==a&&!(r>=65&&r<=90&&r+32===a)&&!(a>=65&&a<=90&&a+32===r))return!1}return!0}_createOperationsForBlockComment(t,n,r,i,a,o){let s=t.startLineNumber,c=t.startColumn,l=t.endLineNumber,u=t.endColumn,d=a.getLineContent(s),f=a.getLineContent(l),p=d.lastIndexOf(n,c-1+n.length),m=f.indexOf(r,u-1-r.length);if(p!==-1&&m!==-1)if(s===l)d.substring(p+n.length,m).indexOf(r)>=0&&(p=-1,m=-1);else{let e=d.substring(p+n.length),t=f.substring(0,m);(e.indexOf(r)>=0||t.indexOf(r)>=0)&&(p=-1,m=-1)}let h;p!==-1&&m!==-1?(i&&p+n.length<d.length&&d.charCodeAt(p+n.length)===32&&(n+=` `),i&&m>0&&f.charCodeAt(m-1)===32&&(r=` `+r,--m),h=e._createRemoveBlockCommentOperations(new T(s,p+n.length+1,l,m+1),n,r)):(h=e._createAddBlockCommentOperations(t,n,r,this._insertSpace),this._usedEndToken=h.length===1?r:null);for(let e of h)o.addTrackedEditOperation(e.range,e.text)}static _createRemoveBlockCommentOperations(e,t,n){let r=[];return T.isEmpty(e)?r.push(Ss.delete(new T(e.startLineNumber,e.startColumn-t.length,e.endLineNumber,e.endColumn+n.length))):(r.push(Ss.delete(new T(e.startLineNumber,e.startColumn-t.length,e.startLineNumber,e.startColumn))),r.push(Ss.delete(new T(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn+n.length)))),r}static _createAddBlockCommentOperations(e,t,n,r){let i=[];return T.isEmpty(e)?i.push(Ss.replace(new T(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),t+`  `+n)):(i.push(Ss.insert(new C(e.startLineNumber,e.startColumn),t+(r?` `:``))),i.push(Ss.insert(new C(e.endLineNumber,e.endColumn),(r?` `:``)+n))),i}getEditOperations(e,t){let n=this._selection.startLineNumber,r=this._selection.startColumn;e.tokenization.tokenizeIfCheap(n);let i=e.getLanguageIdAtPosition(n,r),a=this.languageConfigurationService.getLanguageConfiguration(i).comments;!a||!a.blockCommentStartToken||!a.blockCommentEndToken||this._createOperationsForBlockComment(this._selection,a.blockCommentStartToken,a.blockCommentEndToken,this._insertSpace,e,t)}computeCursorState(e,t){let n=t.getInverseEditOperations();if(n.length===2){let e=n[0],t=n[1];return new P(e.range.endLineNumber,e.range.endColumn,t.range.startLineNumber,t.range.startColumn)}else{let e=n[0].range,t=this._usedEndToken?-this._usedEndToken.length-1:0;return new P(e.endLineNumber,e.endColumn+t,e.endLineNumber,e.endColumn+t)}}},Cx=class e{constructor(e,t,n,r,i,a,o){this.languageConfigurationService=e,this._selection=t,this._indentSize=n,this._type=r,this._insertSpace=i,this._selectionId=null,this._deltaColumn=0,this._moveEndPositionDown=!1,this._ignoreEmptyLines=a,this._ignoreFirstLine=o||!1}static _gatherPreflightCommentStrings(e,t,n,r){e.tokenization.tokenizeIfCheap(t);let i=e.getLanguageIdAtPosition(t,1),a=r.getLanguageConfiguration(i).comments,o=a?a.lineCommentToken:null;if(!o)return null;let s=[];for(let e=0,r=n-t+1;e<r;e++)s[e]={ignore:!1,commentStr:o,commentStrOffset:0,commentStrLength:o.length};return s}static _analyzeLines(e,t,n,r,i,a,o,s,c){let l=!0,u=s.getLanguageConfiguration(c).comments?.lineCommentNoIndent??!1,d;d=e===0?!0:e!==1;for(let s=0,c=r.length;s<c;s++){let c=r[s],f=i+s;if(f===i&&o){c.ignore=!0;continue}let p=n.getLineContent(f),m=bi(p);if(m===-1){c.ignore=a,c.commentStrOffset=u?0:p.length;continue}l=!1;let h=u?0:m;if(c.ignore=!1,c.commentStrOffset=h,d&&!Sx._haystackHasNeedleAtOffset(p,c.commentStr,h)&&(e===0?d=!1:e===1||(c.ignore=!0)),d&&t){let e=m+c.commentStrLength;e<p.length&&p.charCodeAt(e)===32&&(c.commentStrLength+=1)}}if(e===0&&l){d=!1;for(let e=0,t=r.length;e<t;e++)r[e].ignore=!1}return{supported:!0,shouldRemoveComments:d,lines:r}}static _gatherPreflightData(t,n,r,i,a,o,s,c){let l=e._gatherPreflightCommentStrings(r,i,a,c),u=r.getLanguageIdAtPosition(i,1);return l===null?{supported:!1}:e._analyzeLines(t,n,r,l,i,o,s,c,u)}_executeLineComments(t,n,r,i){let a;r.shouldRemoveComments?a=e._createRemoveLineCommentsOperations(r.lines,i.startLineNumber):(e._normalizeInsertionPoint(t,r.lines,i.startLineNumber,this._indentSize),a=this._createAddLineCommentsOperations(r.lines,i.startLineNumber));let o=new C(i.positionLineNumber,i.positionColumn);for(let e=0,r=a.length;e<r;e++)n.addEditOperation(a[e].range,a[e].text),T.isEmpty(a[e].range)&&T.getStartPosition(a[e].range).equals(o)&&t.getLineContent(o.lineNumber).length+1===o.column&&(this._deltaColumn=(a[e].text||``).length);this._selectionId=n.trackSelection(i)}_attemptRemoveBlockComment(e,t,n,r){let i=t.startLineNumber,a=t.endLineNumber,o=r.length+Math.max(e.getLineFirstNonWhitespaceColumn(t.startLineNumber),t.startColumn),s=e.getLineContent(i).lastIndexOf(n,o-1),c=e.getLineContent(a).indexOf(r,t.endColumn-1-n.length);return s!==-1&&c===-1&&(c=e.getLineContent(i).indexOf(r,s+n.length),a=i),s===-1&&c!==-1&&(s=e.getLineContent(a).lastIndexOf(n,c),i=a),t.isEmpty()&&(s===-1||c===-1)&&(s=e.getLineContent(i).indexOf(n),s!==-1&&(c=e.getLineContent(i).indexOf(r,s+n.length))),s!==-1&&e.getLineContent(i).charCodeAt(s+n.length)===32&&(n+=` `),c!==-1&&e.getLineContent(a).charCodeAt(c-1)===32&&(r=` `+r,--c),s!==-1&&c!==-1?Sx._createRemoveBlockCommentOperations(new T(i,s+n.length+1,a,c+1),n,r):null}_executeBlockComment(e,t,n){e.tokenization.tokenizeIfCheap(n.startLineNumber);let r=e.getLanguageIdAtPosition(n.startLineNumber,1),i=this.languageConfigurationService.getLanguageConfiguration(r).comments;if(!i||!i.blockCommentStartToken||!i.blockCommentEndToken)return;let a=i.blockCommentStartToken,o=i.blockCommentEndToken,s=this._attemptRemoveBlockComment(e,n,a,o);if(!s){if(n.isEmpty()){let t=e.getLineContent(n.startLineNumber),r=bi(t);r===-1&&(r=t.length),s=Sx._createAddBlockCommentOperations(new T(n.startLineNumber,r+1,n.startLineNumber,t.length+1),a,o,this._insertSpace)}else s=Sx._createAddBlockCommentOperations(new T(n.startLineNumber,e.getLineFirstNonWhitespaceColumn(n.startLineNumber),n.endLineNumber,e.getLineMaxColumn(n.endLineNumber)),a,o,this._insertSpace);s.length===1&&(this._deltaColumn=a.length+1)}this._selectionId=t.trackSelection(n);for(let e of s)t.addEditOperation(e.range,e.text)}getEditOperations(t,n){let r=this._selection;if(this._moveEndPositionDown=!1,r.startLineNumber===r.endLineNumber&&this._ignoreFirstLine){n.addEditOperation(new T(r.startLineNumber,t.getLineMaxColumn(r.startLineNumber),r.startLineNumber+1,1),r.startLineNumber===t.getLineCount()?``:`
`),this._selectionId=n.trackSelection(r);return}r.startLineNumber<r.endLineNumber&&r.endColumn===1&&(this._moveEndPositionDown=!0,r=r.setEndPosition(r.endLineNumber-1,t.getLineMaxColumn(r.endLineNumber-1)));let i=e._gatherPreflightData(this._type,this._insertSpace,t,r.startLineNumber,r.endLineNumber,this._ignoreEmptyLines,this._ignoreFirstLine,this.languageConfigurationService);return i.supported?this._executeLineComments(t,n,i,r):this._executeBlockComment(t,n,r)}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(n=n.setEndPosition(n.endLineNumber+1,1)),new P(n.selectionStartLineNumber,n.selectionStartColumn+this._deltaColumn,n.positionLineNumber,n.positionColumn+this._deltaColumn)}static _createRemoveLineCommentsOperations(e,t){let n=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];i.ignore||n.push(Ss.delete(new T(t+r,i.commentStrOffset+1,t+r,i.commentStrOffset+i.commentStrLength+1)))}return n}_createAddLineCommentsOperations(e,t){let n=[],r=this._insertSpace?` `:``;for(let i=0,a=e.length;i<a;i++){let a=e[i];a.ignore||n.push(Ss.insert(new C(t+i,a.commentStrOffset+1),a.commentStr+r))}return n}static nextVisibleColumn(e,t,n,r){return n?e+(t-e%t):e+r}static _normalizeInsertionPoint(t,n,r,i){let a=1073741824,o,s;for(let o=0,s=n.length;o<s;o++){if(n[o].ignore)continue;let s=t.getLineContent(r+o),c=0;for(let t=0,r=n[o].commentStrOffset;c<a&&t<r;t++)c=e.nextVisibleColumn(c,i,s.charCodeAt(t)===9,1);c<a&&(a=c)}a=Math.floor(a/i)*i;for(let c=0,l=n.length;c<l;c++){if(n[c].ignore)continue;let l=t.getLineContent(r+c),u=0;for(o=0,s=n[c].commentStrOffset;u<a&&o<s;o++)u=e.nextVisibleColumn(u,i,l.charCodeAt(o)===9,1);u>a?n[c].commentStrOffset=o-1:n[c].commentStrOffset=o}}},wx=class extends R{constructor(e,t){super(t),this._type=e}run(e,t){let n=e.get(Ce);if(!t.hasModel())return;let r=t.getModel(),i=[],a=r.getOptions(),o=t.getOption(29),s=t.getSelections().map((e,t)=>({selection:e,index:t,ignoreFirstLine:!1}));s.sort((e,t)=>T.compareRangesUsingStarts(e.selection,t.selection));let c=s[0];for(let e=1;e<s.length;e++){let t=s[e];c.selection.endLineNumber===t.selection.startLineNumber&&(c.index<t.index?t.ignoreFirstLine=!0:(c.ignoreFirstLine=!0,c=t))}for(let e of s)i.push(new Cx(n,e.selection,a.indentSize,this._type,o.insertSpace,o.ignoreEmptyLines,e.ignoreFirstLine));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},Tx=class extends wx{constructor(){super(0,{id:`editor.action.commentLine`,label:U(892,`Toggle Line Comment`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:2138,weight:100},menuOpts:{menuId:S.MenubarEditMenu,group:`5_insert`,title:G(890,`&&Toggle Line Comment`),order:1}})}},Ex=class extends wx{constructor(){super(1,{id:`editor.action.addCommentLine`,label:U(893,`Add Line Comment`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2081),weight:100}})}},Dx=class extends wx{constructor(){super(2,{id:`editor.action.removeCommentLine`,label:U(894,`Remove Line Comment`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2099),weight:100}})}},Ox=class extends R{constructor(){super({id:`editor.action.blockComment`,label:U(895,`Toggle Block Comment`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:1567,linux:{primary:3103},weight:100},menuOpts:{menuId:S.MenubarEditMenu,group:`5_insert`,title:G(891,`Toggle &&Block Comment`),order:2}})}run(e,t){let n=e.get(Ce);if(!t.hasModel())return;let r=t.getOption(29),i=[],a=t.getSelections();for(let e of a)i.push(new Sx(e,r.insertSpace,n));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}};q(Tx),q(Ex),q(Dx),q(Ox);var kx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ax=function(e,t){return function(n,r){t(n,r,e)}},jx,Mx=class{static{jx=this}static{this.ID=`editor.contrib.contextmenu`}static get(e){return e.getContribution(jx.ID)}constructor(e,t,n,r,i,a,o,s){this._contextMenuService=t,this._contextViewService=n,this._contextKeyService=r,this._keybindingService=i,this._menuService=a,this._configurationService=o,this._workspaceContextService=s,this._toDispose=new L,this._contextMenuIsBeingShownCount=0,this._editor=e,this._toDispose.add(this._editor.onContextMenu(e=>this._onContextMenu(e))),this._toDispose.add(this._editor.onMouseWheel(e=>{if(this._contextMenuIsBeingShownCount>0){let t=this._contextViewService.getContextViewElement(),n=e.srcElement;n.shadowRoot&&os(t)===n.shadowRoot||this._contextViewService.hideContextView()}})),this._toDispose.add(this._editor.onKeyDown(e=>{this._editor.getOption(30)&&e.keyCode===58&&(e.preventDefault(),e.stopPropagation(),this.showContextMenu())}))}_onContextMenu(e){if(!this._editor.hasModel())return;if(!this._editor.getOption(30)){this._editor.focus(),e.target.position&&!this._editor.getSelection().containsPosition(e.target.position)&&this._editor.setPosition(e.target.position);return}if(e.target.type===12||e.target.type===6&&e.target.detail.injectedText)return;if(e.event.preventDefault(),e.event.stopPropagation(),e.target.type===11)return this._showScrollbarContextMenu(e.event);if(e.target.type!==6&&e.target.type!==7&&e.target.type!==1)return;if(this._editor.focus(),e.target.position){let t=!1;for(let n of this._editor.getSelections())if(n.containsPosition(e.target.position)){t=!0;break}t||this._editor.setPosition(e.target.position)}let t=null;e.target.type!==1&&(t=e.event),this.showContextMenu(t)}showContextMenu(e){if(!this._editor.getOption(30)||!this._editor.hasModel())return;let t=this._getMenuActions(this._editor.getModel(),this._editor.contextMenuId);t.length>0&&this._doShowContextMenu(t,e)}_getMenuActions(e,t){let n=[],r=this._menuService.getMenuActions(t,this._contextKeyService,{arg:e.uri});for(let t of r){let[,r]=t,i=0;for(let t of r)if(t instanceof pe){let r=this._getMenuActions(e,t.item.submenu);r.length>0&&(n.push(new Gi(t.id,t.label,r)),i++)}else n.push(t),i++;i&&n.push(new wi)}return n.length&&n.pop(),n}_doShowContextMenu(e,t=null){if(!this._editor.hasModel())return;let n=t;if(!n){this._editor.revealPosition(this._editor.getPosition(),1),this._editor.render();let e=this._editor.getScrolledVisiblePosition(this._editor.getPosition()),t=vs(this._editor.getDomNode()),r=t.left+e.left,i=t.top+e.top+e.height;n={x:r,y:i}}let r=this._editor.getOption(144)&&!Ua;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:r?this._editor.getOverflowWidgetsDomNode()??this._editor.getDomNode():void 0,getAnchor:()=>n,getActions:()=>e,getActionViewItem:e=>{let t=this._keybindingFor(e);if(t)return new Dt(e,e,{label:!0,keybinding:t.getLabel(),isMenu:!0});let n=e;return typeof n.getActionViewItem==`function`?n.getActionViewItem():new Dt(e,e,{icon:!0,label:!0,isMenu:!0})},getKeyBinding:e=>this._keybindingFor(e),onHide:e=>{this._contextMenuIsBeingShownCount--}})}_showScrollbarContextMenu(e){if(!this._editor.hasModel()||go(this._workspaceContextService.getWorkspace()))return;let t=this._editor.getOption(81),n=0,r=e=>({id:`menu-action-${++n}`,label:e.label,tooltip:``,class:void 0,enabled:e.enabled===void 0?!0:e.enabled,checked:e.checked,run:e.run}),i=(e,t)=>new Gi(`menu-action-${++n}`,e,t,void 0),a=(e,t,n,a,o)=>{if(!t)return r({label:e,enabled:t,run:()=>{}});let s=e=>()=>{this._configurationService.updateValue(n,e)},c=[];for(let e of o)c.push(r({label:e.label,checked:a===e.value,run:s(e.value)}));return i(e,c)},o=[];o.push(r({label:G(896,`Minimap`),checked:t.enabled,run:()=>{this._configurationService.updateValue(`editor.minimap.enabled`,!t.enabled)}})),o.push(new wi),o.push(r({label:G(897,`Render Characters`),enabled:t.enabled,checked:t.renderCharacters,run:()=>{this._configurationService.updateValue(`editor.minimap.renderCharacters`,!t.renderCharacters)}})),o.push(a(G(898,`Vertical size`),t.enabled,`editor.minimap.size`,t.size,[{label:G(899,`Proportional`),value:`proportional`},{label:G(900,`Fill`),value:`fill`},{label:G(901,`Fit`),value:`fit`}])),o.push(a(G(902,`Slider`),t.enabled,`editor.minimap.showSlider`,t.showSlider,[{label:G(903,`Mouse Over`),value:`mouseover`},{label:G(904,`Always`),value:`always`}]));let s=this._editor.getOption(144)&&!Ua;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:s?this._editor.getDomNode():void 0,getAnchor:()=>e,getActions:()=>o,onHide:e=>{this._contextMenuIsBeingShownCount--,this._editor.focus()}})}_keybindingFor(e){return this._keybindingService.lookupKeybinding(e.id)}dispose(){this._contextMenuIsBeingShownCount>0&&this._contextViewService.hideContextView(),this._toDispose.dispose()}};Mx=jx=kx([Ax(1,Bc),Ax(2,Ml),Ax(3,On),Ax(4,Yt),Ax(5,rt),Ax(6,hn),Ax(7,Ps)],Mx);var Nx=class extends R{constructor(){super({id:`editor.action.showContextMenu`,label:U(905,`Show Editor Context Menu`),precondition:void 0,kbOpts:{kbExpr:y.textInputFocus,primary:1092,weight:100}})}run(e,t){Mx.get(t)?.showContextMenu()}};K(Mx.ID,Mx,2),q(Nx);var Px=class{constructor(e){this.selections=e}equals(e){let t=this.selections.length,n=e.selections.length;if(t!==n)return!1;for(let n=0;n<t;n++)if(!this.selections[n].equalsSelection(e.selections[n]))return!1;return!0}},Fx=class{constructor(e,t,n){this.cursorState=e,this.scrollTop=t,this.scrollLeft=n}},Ix=class e extends x{static{this.ID=`editor.contrib.cursorUndoRedoController`}static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._editor=e,this._isCursorUndoRedo=!1,this._undoStack=[],this._redoStack=[],this._register(e.onDidChangeModel(e=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeModelContent(e=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeCursorSelection(t=>{if(this._isCursorUndoRedo||!t.oldSelections||t.oldModelVersionId!==t.modelVersionId)return;let n=new Px(t.oldSelections);this._undoStack.length>0&&this._undoStack[this._undoStack.length-1].cursorState.equals(n)||(this._undoStack.push(new Fx(n,e.getScrollTop(),e.getScrollLeft())),this._redoStack=[],this._undoStack.length>50&&this._undoStack.shift())}))}cursorUndo(){!this._editor.hasModel()||this._undoStack.length===0||(this._redoStack.push(new Fx(new Px(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._undoStack.pop()))}cursorRedo(){!this._editor.hasModel()||this._redoStack.length===0||(this._undoStack.push(new Fx(new Px(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._redoStack.pop()))}_applyState(e){this._isCursorUndoRedo=!0,this._editor.setSelections(e.cursorState.selections),this._editor.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),this._isCursorUndoRedo=!1}},Lx=class extends R{constructor(){super({id:`cursorUndo`,label:U(906,`Cursor Undo`),precondition:void 0,kbOpts:{kbExpr:y.textInputFocus,primary:2099,weight:100}})}run(e,t,n){Ix.get(t)?.cursorUndo()}},Rx=class extends R{constructor(){super({id:`cursorRedo`,label:U(907,`Cursor Redo`),precondition:void 0})}run(e,t,n){Ix.get(t)?.cursorRedo()}};K(Ix.ID,Ix,0),q(Lx),q(Rx);var zx=class{constructor(e,t,n){this.selection=e,this.targetPosition=t,this.copy=n,this.targetSelection=null}getEditOperations(e,t){let n=e.getValueInRange(this.selection);if(this.copy||t.addEditOperation(this.selection,null),t.addEditOperation(new T(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column),n),this.selection.containsPosition(this.targetPosition)&&!(this.copy&&(this.selection.getEndPosition().equals(this.targetPosition)||this.selection.getStartPosition().equals(this.targetPosition)))){this.targetSelection=this.selection;return}if(this.copy){this.targetSelection=new P(this.targetPosition.lineNumber,this.targetPosition.column,this.selection.endLineNumber-this.selection.startLineNumber+this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber>this.selection.endLineNumber){this.targetSelection=new P(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber<this.selection.endLineNumber){this.targetSelection=new P(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber+this.selection.endLineNumber-this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}this.selection.endColumn<=this.targetPosition.column?this.targetSelection=new P(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,(this.selection.startLineNumber,this.selection.endLineNumber,this.targetPosition.column-this.selection.endColumn+this.selection.startColumn),this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column:this.selection.endColumn):this.targetSelection=new P(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column+this.selection.endColumn-this.selection.startColumn)}computeCursorState(e,t){return this.targetSelection}};function Bx(e){return po?e.altKey:e.ctrlKey}var Vx=class e extends x{static{this.ID=`editor.contrib.dragAndDrop`}static{this.TRIGGER_KEY_VALUE=po?6:5}constructor(e){super(),this._editor=e,this._dndDecorationIds=this._editor.createDecorationsCollection(),this._register(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._register(this._editor.onMouseUp(e=>this._onEditorMouseUp(e))),this._register(this._editor.onMouseDrag(e=>this._onEditorMouseDrag(e))),this._register(this._editor.onMouseDrop(e=>this._onEditorMouseDrop(e))),this._register(this._editor.onMouseDropCanceled(()=>this._onEditorMouseDropCanceled())),this._register(this._editor.onKeyDown(e=>this.onEditorKeyDown(e))),this._register(this._editor.onKeyUp(e=>this.onEditorKeyUp(e))),this._register(this._editor.onDidBlurEditorWidget(()=>this.onEditorBlur())),this._register(this._editor.onDidBlurEditorText(()=>this.onEditorBlur())),this._mouseDown=!1,this._modifierPressed=!1,this._dragSelection=null}onEditorBlur(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1}onEditorKeyDown(e){!this._editor.getOption(42)||this._editor.getOption(28)||(Bx(e)&&(this._modifierPressed=!0),this._mouseDown&&Bx(e)&&this._editor.updateOptions({mouseStyle:`copy`}))}onEditorKeyUp(t){!this._editor.getOption(42)||this._editor.getOption(28)||(Bx(t)&&(this._modifierPressed=!1),this._mouseDown&&t.keyCode===e.TRIGGER_KEY_VALUE&&this._editor.updateOptions({mouseStyle:`default`}))}_onEditorMouseDown(e){this._mouseDown=!0}_onEditorMouseUp(e){this._mouseDown=!1,this._editor.updateOptions({mouseStyle:`text`})}_onEditorMouseDrag(e){let t=e.target;if(this._dragSelection===null){let e=(this._editor.getSelections()||[]).filter(e=>t.position&&e.containsPosition(t.position));if(e.length===1)this._dragSelection=e[0];else return}Bx(e.event)?this._editor.updateOptions({mouseStyle:`copy`}):this._editor.updateOptions({mouseStyle:`default`}),t.position&&(this._dragSelection.containsPosition(t.position)?this._removeDecoration():this.showAt(t.position))}_onEditorMouseDropCanceled(){this._editor.updateOptions({mouseStyle:`text`}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}_onEditorMouseDrop(t){if(t.target&&(this._hitContent(t.target)||this._hitMargin(t.target))&&t.target.position){let n=new C(t.target.position.lineNumber,t.target.position.column);if(this._dragSelection===null){let e=null;if(t.event.shiftKey){let t=this._editor.getSelection();if(t){let{selectionStartLineNumber:r,selectionStartColumn:i}=t;e=[new P(r,i,n.lineNumber,n.column)]}}else e=(this._editor.getSelections()||[]).map(e=>e.containsPosition(n)?new P(n.lineNumber,n.column,n.lineNumber,n.column):e);this._editor.setSelections(e||[],`mouse`,3)}else (!this._dragSelection.containsPosition(n)||(Bx(t.event)||this._modifierPressed)&&(this._dragSelection.getEndPosition().equals(n)||this._dragSelection.getStartPosition().equals(n)))&&(this._editor.pushUndoStop(),this._editor.executeCommand(e.ID,new zx(this._dragSelection,n,Bx(t.event)||this._modifierPressed)),this._editor.pushUndoStop())}this._editor.updateOptions({mouseStyle:`text`}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}static{this._DECORATION_OPTIONS=Y.register({description:`dnd-target`,className:`dnd-target`})}showAt(t){this._dndDecorationIds.set([{range:new T(t.lineNumber,t.column,t.lineNumber,t.column),options:e._DECORATION_OPTIONS}]),this._editor.revealPosition(t,1)}_removeDecoration(){this._dndDecorationIds.clear()}_hitContent(e){return e.type===6||e.type===7}_hitMargin(e){return e.type===2||e.type===3||e.type===4}dispose(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1,super.dispose()}};K(Vx.ID,Vx,2),K(Sh.ID,Sh,0),cn(Om),W(new class extends Ar{constructor(){super({id:yh,precondition:bh,kbOpts:{weight:100,primary:2137}})}runEditorCommand(e,t){return Sh.get(t)?.changePasteType()}}),W(new class extends Ar{constructor(){super({id:`editor.hidePasteWidget`,precondition:bh,kbOpts:{weight:100,primary:9}})}runEditorCommand(e,t){Sh.get(t)?.clearWidgets()}}),q(class e extends R{static{this.argsSchema={oneOf:[{type:`object`,required:[`kind`],properties:{kind:{type:`string`,description:G(908,`The kind of the paste edit to try pasting with.
If there are multiple edits for this kind, the editor will show a picker. If there are no edits of this kind, the editor will show an error message.`)}}},{type:`object`,required:[`preferences`],properties:{preferences:{type:`array`,description:G(909,`List of preferred paste edit kind to try applying.
The first edit matching the preferences will be applied.`),items:{type:`string`}}}}]}}constructor(){super({id:`editor.action.pasteAs`,label:U(910,`Paste As...`),precondition:y.writable,metadata:{description:`Paste as`,args:[{name:`args`,schema:e.argsSchema}]}})}run(e,t,n){let r;return n&&(`kind`in n?r={only:new Qp(n.kind)}:`preferences`in n&&(r={preferences:n.preferences.map(e=>new Qp(e))})),Sh.get(t)?.pasteAs(r)}}),q(class extends R{constructor(){super({id:`editor.action.pasteAsText`,label:U(911,`Paste as Text`),precondition:y.writable})}run(e,t){return Sh.get(t)?.pasteAs({providerId:xm.id})}});var Hx=class{constructor(){this._dragOperations=new Map}removeDragOperationTransfer(e){if(e&&this._dragOperations.has(e)){let t=this._dragOperations.get(e);return this._dragOperations.delete(e),t}}},Ux=class{constructor(e){this.identifier=e}};const Wx=ma(`treeViewsDndService`);Ui(Wx,Hx,1);var Gx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Kx=function(e,t){return function(n,r){t(n,r,e)}},qx;const Jx=`editor.changeDropType`,Yx=new N(`dropWidgetVisible`,!1,G(929,`Whether the drop widget is showing`));var Xx=class extends x{static{qx=this}static{this.ID=`editor.contrib.dropIntoEditorController`}static get(e){return e.getContribution(qx.ID)}constructor(e,t,n,r,i){super(),this._configService=n,this._languageFeaturesService=r,this._treeViewsDragAndDropService=i,this.treeItemsTransfer=tm.getInstance(),this._dropProgressManager=this._register(t.createInstance(dm,`dropIntoEditor`,e)),this._postDropWidgetManager=this._register(t.createInstance(hh,`dropIntoEditor`,e,Yx,{id:Jx,label:G(930,`Show drop options...`)},()=>qx._configureDefaultAction?[qx._configureDefaultAction]:[])),this._register(e.onDropIntoEditor(t=>this.onDropIntoEditor(e,t.position,t.event)))}clearWidgets(){this._postDropWidgetManager.clear()}changeDropType(){this._postDropWidgetManager.tryShowSelector()}async onDropIntoEditor(e,t,n){if(!n.dataTransfer||!e.hasModel())return;qx._currentDropOperation?.cancel(),e.focus(),e.setPosition(t);let r=li(async i=>{let a=new L,o=a.add(new Eu(e,1,void 0,i));try{let r=await this.extractDataTransferData(n);if(r.size===0||o.token.isCancellationRequested)return;let s=e.getModel();if(!s)return;let c=this._languageFeaturesService.documentDropEditProvider.ordered(s).filter(e=>e.dropMimeTypes?e.dropMimeTypes.some(e=>r.matches(e)):!0),l=a.add(await this.getDropEdits(c,s,t,r,o.token));if(o.token.isCancellationRequested)return;if(l.edits.length){let n=this.getInitialActiveEditIndex(s,l.edits),r=e.getOption(43).showDropSelector===`afterDrop`;await this._postDropWidgetManager.applyEditAndShowIfNeeded([T.fromPositions(t)],{activeEditIndex:n,allEdits:l.edits},r,async e=>e,i)}}finally{a.dispose(),qx._currentDropOperation===r&&(qx._currentDropOperation=void 0)}});this._dropProgressManager.showWhile(t,G(931,`Running drop handlers. Click to cancel`),r,{cancel:()=>r.cancel()}),qx._currentDropOperation=r}async getDropEdits(e,t,n,r,i){let a=new L,o=await ir(Promise.all(e.map(async e=>{try{let o=await e.provideDocumentDropEdits(t,n,r,i);return o&&a.add(o),o?.edits.map(t=>({...t,providerId:e.id}))}catch(e){Gn(e)||console.error(e),console.error(e)}})),i),s=ki(o??[]).flat();return{edits:Hm(s),dispose:()=>a.dispose()}}getInitialActiveEditIndex(e,t){let n=this._configService.getValue(`editor.dropIntoEditor.preferences`,{resource:e.uri});for(let e of Array.isArray(n)?n:[]){let n=new Qp(e),r=t.findIndex(e=>e.kind&&n.contains(e.kind));if(r>=0)return r}return 0}async extractDataTransferData(e){if(!e.dataTransfer)return new qp;let t=om(e.dataTransfer);if(this.treeItemsTransfer.hasData(Ux.prototype)){let e=this.treeItemsTransfer.getData(Ux.prototype);if(Array.isArray(e))for(let n of e){let e=await this._treeViewsDragAndDropService.removeDragOperationTransfer(n.identifier);if(e)for(let[n,r]of e)t.replace(n,r)}}return t}};Xx=qx=Gx([Kx(1,k),Kx(2,hn),Kx(3,H),Kx(4,Wx)],Xx),K(Xx.ID,Xx,2),cn(Dm),W(new class extends Ar{constructor(){super({id:Jx,precondition:Yx,kbOpts:{weight:100,primary:2137}})}runEditorCommand(e,t,n){Xx.get(t)?.changeDropType()}}),W(new class extends Ar{constructor(){super({id:`editor.hideDropWidget`,precondition:Yx,kbOpts:{weight:100,primary:9}})}runEditorCommand(e,t,n){Xx.get(t)?.clearWidgets()}});var Zx=class e{constructor(e){this._editor=e,this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null,this._startPosition=this._editor.getPosition()}dispose(){this._editor.removeDecorations(this._allDecorations()),this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}reset(){this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}getCount(){return this._decorations.length}getFindScope(){return this._findScopeDecorationIds[0]?this._editor.getModel().getDecorationRange(this._findScopeDecorationIds[0]):null}getFindScopes(){if(this._findScopeDecorationIds.length){let e=this._findScopeDecorationIds.map(e=>this._editor.getModel().getDecorationRange(e)).filter(e=>!!e);if(e.length)return e}return null}getStartPosition(){return this._startPosition}setStartPosition(e){this._startPosition=e,this.setCurrentFindMatch(null)}_getDecorationIndex(e){let t=this._decorations.indexOf(e);return t>=0?t+1:1}getDecorationRangeAt(e){let t=e<this._decorations.length?this._decorations[e]:null;return t?this._editor.getModel().getDecorationRange(t):null}getCurrentMatchesPosition(t){let n=this._editor.getModel().getDecorationsInRange(t);for(let t of n){let n=t.options;if(n===e._FIND_MATCH_DECORATION||n===e._CURRENT_FIND_MATCH_DECORATION)return this._getDecorationIndex(t.id)}return 0}setCurrentFindMatch(t){let n=null,r=0;if(t)for(let e=0,i=this._decorations.length;e<i;e++){let i=this._editor.getModel().getDecorationRange(this._decorations[e]);if(t.equalsRange(i)){n=this._decorations[e],r=e+1;break}}return(this._highlightedDecorationId!==null||n!==null)&&this._editor.changeDecorations(t=>{if(this._highlightedDecorationId!==null&&(t.changeDecorationOptions(this._highlightedDecorationId,e._FIND_MATCH_DECORATION),this._highlightedDecorationId=null),n!==null&&(this._highlightedDecorationId=n,t.changeDecorationOptions(this._highlightedDecorationId,e._CURRENT_FIND_MATCH_DECORATION)),this._rangeHighlightDecorationId!==null&&(t.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),n!==null){let r=this._editor.getModel().getDecorationRange(n);if(r.startLineNumber!==r.endLineNumber&&r.endColumn===1){let e=r.endLineNumber-1,t=this._editor.getModel().getLineMaxColumn(e);r=new T(r.startLineNumber,r.startColumn,e,t)}this._rangeHighlightDecorationId=t.addDecoration(r,e._RANGE_HIGHLIGHT_DECORATION)}}),r}set(t,n){this._editor.changeDecorations(r=>{let i=e._FIND_MATCH_DECORATION,a=[];if(t.length>1e3){i=e._FIND_MATCH_NO_OVERVIEW_DECORATION;let n=this._editor.getModel().getLineCount(),r=this._editor.getLayoutInfo().height/n,o=Math.max(2,Math.ceil(3/r)),s=t[0].range.startLineNumber,c=t[0].range.endLineNumber;for(let n=1,r=t.length;n<r;n++){let r=t[n].range;c+o>=r.startLineNumber?r.endLineNumber>c&&(c=r.endLineNumber):(a.push({range:new T(s,1,c,1),options:e._FIND_MATCH_ONLY_OVERVIEW_DECORATION}),s=r.startLineNumber,c=r.endLineNumber)}a.push({range:new T(s,1,c,1),options:e._FIND_MATCH_ONLY_OVERVIEW_DECORATION})}let o=Array(t.length);for(let e=0,n=t.length;e<n;e++)o[e]={range:t[e].range,options:i};this._decorations=r.deltaDecorations(this._decorations,o),this._overviewRulerApproximateDecorations=r.deltaDecorations(this._overviewRulerApproximateDecorations,a),this._rangeHighlightDecorationId&&=(r.removeDecoration(this._rangeHighlightDecorationId),null),this._findScopeDecorationIds.length&&(this._findScopeDecorationIds.forEach(e=>r.removeDecoration(e)),this._findScopeDecorationIds=[]),n?.length&&(this._findScopeDecorationIds=n.map(t=>r.addDecoration(t,e._FIND_SCOPE_DECORATION)))})}matchBeforePosition(e){if(this._decorations.length===0)return null;for(let t=this._decorations.length-1;t>=0;t--){let n=this._decorations[t],r=this._editor.getModel().getDecorationRange(n);if(!(!r||r.endLineNumber>e.lineNumber)&&(r.endLineNumber<e.lineNumber||!(r.endColumn>e.column)))return r}return this._editor.getModel().getDecorationRange(this._decorations[this._decorations.length-1])}matchAfterPosition(e){if(this._decorations.length===0)return null;for(let t=0,n=this._decorations.length;t<n;t++){let n=this._decorations[t],r=this._editor.getModel().getDecorationRange(n);if(!(!r||r.startLineNumber<e.lineNumber)&&(r.startLineNumber>e.lineNumber||!(r.startColumn<e.column)))return r}return this._editor.getModel().getDecorationRange(this._decorations[0])}_allDecorations(){let e=[];return e=e.concat(this._decorations),e=e.concat(this._overviewRulerApproximateDecorations),this._findScopeDecorationIds.length&&e.push(...this._findScopeDecorationIds),this._rangeHighlightDecorationId&&e.push(this._rangeHighlightDecorationId),e}static{this._CURRENT_FIND_MATCH_DECORATION=Y.register({description:`current-find-match`,stickiness:1,zIndex:13,className:`currentFindMatch`,inlineClassName:`currentFindMatchInline`,showIfCollapsed:!0,overviewRuler:{color:Ta(Be),position:vr.Center},minimap:{color:Ta(la),position:1}})}static{this._FIND_MATCH_DECORATION=Y.register({description:`find-match`,stickiness:1,zIndex:10,className:`findMatch`,inlineClassName:`findMatchInline`,showIfCollapsed:!0,overviewRuler:{color:Ta(Be),position:vr.Center},minimap:{color:Ta(la),position:1}})}static{this._FIND_MATCH_NO_OVERVIEW_DECORATION=Y.register({description:`find-match-no-overview`,stickiness:1,className:`findMatch`,showIfCollapsed:!0})}static{this._FIND_MATCH_ONLY_OVERVIEW_DECORATION=Y.register({description:`find-match-only-overview`,stickiness:1,overviewRuler:{color:Ta(Be),position:vr.Center}})}static{this._RANGE_HIGHLIGHT_DECORATION=Y.register({description:`find-range-highlight`,stickiness:1,className:`rangeHighlight`,isWholeLine:!0})}static{this._FIND_SCOPE_DECORATION=Y.register({description:`find-scope`,className:`findScope`,isWholeLine:!0})}},Qx=class{constructor(e,t,n){this._editorSelection=e,this._ranges=t,this._replaceStrings=n,this._trackedEditorSelectionId=null}getEditOperations(e,t){if(this._ranges.length>0){let e=[];for(let t=0;t<this._ranges.length;t++)e.push({range:this._ranges[t],text:this._replaceStrings[t]});e.sort((e,t)=>T.compareRangesUsingStarts(e.range,t.range));let n=[],r=e[0];for(let t=1;t<e.length;t++)r.range.endLineNumber===e[t].range.startLineNumber&&r.range.endColumn===e[t].range.startColumn?(r.range=r.range.plusRange(e[t].range),r.text+=e[t].text):(n.push(r),r=e[t]);n.push(r);for(let e of n)t.addEditOperation(e.range,e.text)}this._trackedEditorSelectionId=t.trackSelection(this._editorSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._trackedEditorSelectionId)}};function $x(e,t){if(e&&e[0]!==``){let n=eS(e,t,`-`),r=eS(e,t,`_`);return n&&!r?tS(e,t,`-`):!n&&r?tS(e,t,`_`):e[0].toUpperCase()===e[0]?t.toUpperCase():e[0].toLowerCase()===e[0]?t.toLowerCase():ji(e[0][0])&&t.length>0?t[0].toUpperCase()+t.substr(1):e[0][0].toUpperCase()!==e[0][0]&&t.length>0?t[0].toLowerCase()+t.substr(1):t}else return t}function eS(e,t,n){return e[0].indexOf(n)!==-1&&t.indexOf(n)!==-1&&e[0].split(n).length===t.split(n).length}function tS(e,t,n){let r=t.split(n),i=e[0].split(n),a=``;return r.forEach((e,t)=>{a+=$x([i[t]],e)+n}),a.slice(0,-1)}var nS=class{constructor(e){this.staticValue=e,this.kind=0}},rS=class{constructor(e){this.pieces=e,this.kind=1}},iS=class e{static fromStaticValue(t){return new e([aS.staticValue(t)])}get hasReplacementPatterns(){return this._state.kind===1}constructor(e){!e||e.length===0?this._state=new nS(``):e.length===1&&e[0].staticValue!==null?this._state=new nS(e[0].staticValue):this._state=new rS(e)}buildReplaceString(t,n){if(this._state.kind===0)return n?$x(t,this._state.staticValue):this._state.staticValue;let r=``;for(let n=0,i=this._state.pieces.length;n<i;n++){let i=this._state.pieces[n];if(i.staticValue!==null){r+=i.staticValue;continue}let a=e._substitute(i.matchIndex,t);if(i.caseOps!==null&&i.caseOps.length>0){let e=[],t=i.caseOps.length,n=0;for(let r=0,o=a.length;r<o;r++){if(n>=t){e.push(a.slice(r));break}switch(i.caseOps[n]){case`U`:e.push(a[r].toUpperCase());break;case`u`:e.push(a[r].toUpperCase()),n++;break;case`L`:e.push(a[r].toLowerCase());break;case`l`:e.push(a[r].toLowerCase()),n++;break;default:e.push(a[r])}}a=e.join(``)}r+=a}return r}static _substitute(e,t){if(t===null)return``;if(e===0)return t[0];let n=``;for(;e>0;){if(e<t.length)return(t[e]||``)+n;n=String(e%10)+n,e=Math.floor(e/10)}return`$`+n}},aS=class e{static staticValue(t){return new e(t,-1,null)}static caseOps(t,n){return new e(null,t,n)}constructor(e,t,n){this.staticValue=e,this.matchIndex=t,!n||n.length===0?this.caseOps=null:this.caseOps=n.slice(0)}},oS=class{constructor(e){this._source=e,this._lastCharIndex=0,this._result=[],this._resultLen=0,this._currentStaticPiece=``}emitUnchanged(e){this._emitStatic(this._source.substring(this._lastCharIndex,e)),this._lastCharIndex=e}emitStatic(e,t){this._emitStatic(e),this._lastCharIndex=t}_emitStatic(e){e.length!==0&&(this._currentStaticPiece+=e)}emitMatchIndex(e,t,n){this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=aS.staticValue(this._currentStaticPiece),this._currentStaticPiece=``),this._result[this._resultLen++]=aS.caseOps(e,n),this._lastCharIndex=t}finalize(){return this.emitUnchanged(this._source.length),this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=aS.staticValue(this._currentStaticPiece),this._currentStaticPiece=``),new iS(this._result)}};function sS(e){if(!e||e.length===0)return new iS(null);let t=[],n=new oS(e);for(let r=0,i=e.length;r<i;r++){let a=e.charCodeAt(r);if(a===92){if(r++,r>=i)break;let a=e.charCodeAt(r);switch(a){case 92:n.emitUnchanged(r-1),n.emitStatic(`\\`,r+1);break;case 110:n.emitUnchanged(r-1),n.emitStatic(`
`,r+1);break;case 116:n.emitUnchanged(r-1),n.emitStatic(`	`,r+1);break;case 117:case 85:case 108:case 76:n.emitUnchanged(r-1),n.emitStatic(``,r+1),t.push(String.fromCharCode(a));break}continue}if(a===36){if(r++,r>=i)break;let a=e.charCodeAt(r);if(a===36){n.emitUnchanged(r-1),n.emitStatic(`$`,r+1);continue}if(a===48||a===38){n.emitUnchanged(r-1),n.emitMatchIndex(0,r+1,t),t.length=0;continue}if(49<=a&&a<=57){let o=a-48;if(r+1<i){let i=e.charCodeAt(r+1);if(48<=i&&i<=57){r++,o=o*10+(i-48),n.emitUnchanged(r-2),n.emitMatchIndex(o,r+1,t),t.length=0;continue}}n.emitUnchanged(r-1),n.emitMatchIndex(o,r+1,t),t.length=0;continue}}}return n.finalize()}const cS=new N(`findWidgetVisible`,!1);cS.toNegated();const lS=new N(`findInputFocussed`,!1),uS=new N(`replaceInputFocussed`,!1),dS={primary:545,mac:{primary:2593}},fS={primary:565,mac:{primary:2613}},pS={primary:560,mac:{primary:2608}},mS={primary:554,mac:{primary:2602}},hS={primary:558,mac:{primary:2606}},gS={StartFindAction:`actions.find`,StartFindWithSelection:`actions.findWithSelection`,StartFindWithArgs:`editor.actions.findWithArgs`,NextMatchFindAction:`editor.action.nextMatchFindAction`,PreviousMatchFindAction:`editor.action.previousMatchFindAction`,GoToMatchFindAction:`editor.action.goToMatchFindAction`,NextSelectionMatchFindAction:`editor.action.nextSelectionMatchFindAction`,PreviousSelectionMatchFindAction:`editor.action.previousSelectionMatchFindAction`,StartFindReplaceAction:`editor.action.startFindReplaceAction`,CloseFindWidgetCommand:`closeFindWidget`,ToggleCaseSensitiveCommand:`toggleFindCaseSensitive`,ToggleWholeWordCommand:`toggleFindWholeWord`,ToggleRegexCommand:`toggleFindRegex`,ToggleSearchScopeCommand:`toggleFindInSelection`,TogglePreserveCaseCommand:`togglePreserveCase`,ReplaceOneAction:`editor.action.replaceOne`,ReplaceAllAction:`editor.action.replaceAll`,SelectAllMatchesAction:`editor.action.selectAllMatches`},_S=19999;var vS=240,yS=class e{constructor(e,t){this._toDispose=new L,this._editor=e,this._state=t,this._isDisposed=!1,this._startSearchingTimer=new Me,this._decorations=new Zx(e),this._toDispose.add(this._decorations),this._updateDecorationsScheduler=new Zr(()=>{if(this._editor.hasModel())return this.research(!1)},100),this._toDispose.add(this._updateDecorationsScheduler),this._toDispose.add(this._editor.onDidChangeCursorPosition(e=>{(e.reason===3||e.reason===5||e.reason===6)&&this._decorations.setStartPosition(this._editor.getPosition())})),this._ignoreModelContentChanged=!1,this._toDispose.add(this._editor.onDidChangeModelContent(e=>{this._ignoreModelContentChanged||(e.isFlush&&this._decorations.reset(),this._decorations.setStartPosition(this._editor.getPosition()),this._updateDecorationsScheduler.schedule())})),this._toDispose.add(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this.research(!1,this._state.searchScope)}dispose(){this._isDisposed=!0,Ot(this._startSearchingTimer),this._toDispose.dispose()}_onStateChanged(e){this._isDisposed||this._editor.hasModel()&&(e.searchString||e.isReplaceRevealed||e.isRegex||e.wholeWord||e.matchCase||e.searchScope)&&(this._editor.getModel().isTooLargeForSyncing()?(this._startSearchingTimer.cancel(),this._startSearchingTimer.setIfNotSet(()=>{e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor)},vS)):e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor))}static _getSearchRange(e,t){return t||e.getFullModelRange()}research(e,t){let n=null;t===void 0?n=this._decorations.getFindScopes():t!==null&&(n=Array.isArray(t)?t:[t]),n!==null&&(n=n.map(e=>{if(e.startLineNumber!==e.endLineNumber){let t=e.endLineNumber;return e.endColumn===1&&--t,new T(e.startLineNumber,1,t,this._editor.getModel().getLineMaxColumn(t))}return e}));let r=this._findMatches(n,!1,_S);this._decorations.set(r,n);let i=this._editor.getSelection(),a=this._decorations.getCurrentMatchesPosition(i);if(a===0&&r.length>0){let e=Pe(r.map(e=>e.range),e=>T.compareRangesUsingStarts(e,i)>=0);a=e>0?e-1+1:a}this._state.changeMatchInfo(a,this._decorations.getCount(),void 0),e&&this._editor.getOption(50).cursorMoveOnType&&this._moveToNextMatch(this._decorations.getStartPosition())}_hasMatches(){return this._state.matchesCount>0}_cannotFind(){if(!this._hasMatches()){let e=this._decorations.getFindScope();return e&&this._editor.revealRangeInCenterIfOutsideViewport(e,0),!0}return!1}_setCurrentFindMatch(e){let t=this._decorations.setCurrentFindMatch(e);this._state.changeMatchInfo(t,this._decorations.getCount(),e),this._editor.setSelection(e),this._editor.revealRangeInCenterIfOutsideViewport(e,0)}_prevSearchPosition(e){let t=this._state.isRegex&&(this._state.searchString.indexOf(`^`)>=0||this._state.searchString.indexOf(`$`)>=0),{lineNumber:n,column:r}=e,i=this._editor.getModel();return t||r===1?(n===1?n=i.getLineCount():n--,r=i.getLineMaxColumn(n)):r--,new C(n,r)}_moveToPrevMatch(t,n=!1){if(!this._state.canNavigateBack()){let e=this._decorations.matchAfterPosition(t);e&&this._setCurrentFindMatch(e);return}if(this._decorations.getCount()<19999){let e=this._decorations.matchBeforePosition(t);e&&e.isEmpty()&&e.getStartPosition().equals(t)&&(t=this._prevSearchPosition(t),e=this._decorations.matchBeforePosition(t)),e&&this._setCurrentFindMatch(e);return}if(this._cannotFind())return;let r=this._decorations.getFindScope(),i=e._getSearchRange(this._editor.getModel(),r);i.getEndPosition().isBefore(t)&&(t=i.getEndPosition()),t.isBefore(i.getStartPosition())&&(t=i.getEndPosition());let{lineNumber:a,column:o}=t,s=this._editor.getModel(),c=new C(a,o),l=s.findPreviousMatch(this._state.searchString,c,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,!1);if(l&&l.range.isEmpty()&&l.range.getStartPosition().equals(c)&&(c=this._prevSearchPosition(c),l=s.findPreviousMatch(this._state.searchString,c,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,!1)),l){if(!n&&!i.containsRange(l.range))return this._moveToPrevMatch(l.range.getStartPosition(),!0);this._setCurrentFindMatch(l.range)}}moveToPrevMatch(){this._moveToPrevMatch(this._editor.getSelection().getStartPosition())}_nextSearchPosition(e){let t=this._state.isRegex&&(this._state.searchString.indexOf(`^`)>=0||this._state.searchString.indexOf(`$`)>=0),{lineNumber:n,column:r}=e,i=this._editor.getModel();return t||r===i.getLineMaxColumn(n)?(n===i.getLineCount()?n=1:n++,r=1):r++,new C(n,r)}_moveToNextMatch(e){if(!this._state.canNavigateForward()){let t=this._decorations.matchBeforePosition(e);t&&this._setCurrentFindMatch(t);return}if(this._decorations.getCount()<19999){let t=this._decorations.matchAfterPosition(e);t&&t.isEmpty()&&t.getStartPosition().equals(e)&&(e=this._nextSearchPosition(e),t=this._decorations.matchAfterPosition(e)),t&&this._setCurrentFindMatch(t);return}let t=this._getNextMatch(e,!1,!0);t&&this._setCurrentFindMatch(t.range)}_getNextMatch(t,n,r,i=!1){if(this._cannotFind())return null;let a=this._decorations.getFindScope(),o=e._getSearchRange(this._editor.getModel(),a);o.getEndPosition().isBefore(t)&&(t=o.getStartPosition()),t.isBefore(o.getStartPosition())&&(t=o.getStartPosition());let{lineNumber:s,column:c}=t,l=this._editor.getModel(),u=new C(s,c),d=l.findNextMatch(this._state.searchString,u,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,n);return r&&d&&d.range.isEmpty()&&d.range.getStartPosition().equals(u)&&(u=this._nextSearchPosition(u),d=l.findNextMatch(this._state.searchString,u,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,n)),d?!i&&!o.containsRange(d.range)?this._getNextMatch(d.range.getEndPosition(),n,r,!0):d:null}moveToNextMatch(){this._moveToNextMatch(this._editor.getSelection().getEndPosition())}_moveToMatch(e){let t=this._decorations.getDecorationRangeAt(e);t&&this._setCurrentFindMatch(t)}moveToMatch(e){this._moveToMatch(e)}_getReplacePattern(){return this._state.isRegex?sS(this._state.replaceString):iS.fromStaticValue(this._state.replaceString)}replace(){if(!this._hasMatches())return;let e=this._getReplacePattern(),t=this._editor.getSelection(),n=this._getNextMatch(t.getStartPosition(),!0,!1);if(n)if(t.equalsRange(n.range)){let r=e.buildReplaceString(n.matches,this._state.preserveCase),i=new Eo(t,r);this._executeEditorCommand(`replace`,i),this._decorations.setStartPosition(new C(t.startLineNumber,t.startColumn+r.length)),this.research(!0)}else this._decorations.setStartPosition(this._editor.getPosition()),this._setCurrentFindMatch(n.range)}_findMatches(t,n,r){let i=(t||[null]).map(t=>e._getSearchRange(this._editor.getModel(),t));return this._editor.getModel().findMatches(this._state.searchString,i,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null,n,r)}replaceAll(){if(!this._hasMatches())return;let e=this._decorations.getFindScopes();e===null&&this._state.matchesCount>=19999?this._largeReplaceAll():this._regularReplaceAll(e),this.research(!1)}_largeReplaceAll(){let e=new qs(this._state.searchString,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(148):null).parseSearchRequest();if(!e)return;let t=e.regex;if(!t.multiline){let e=`mu`;t.ignoreCase&&(e+=`i`),t.global&&(e+=`g`),t=new RegExp(t.source,e)}let n=this._editor.getModel(),r=n.getValue(1),i=n.getFullModelRange(),a=this._getReplacePattern(),o,s=this._state.preserveCase;o=a.hasReplacementPatterns||s?r.replace(t,function(){return a.buildReplaceString(arguments,s)}):r.replace(t,a.buildReplaceString(null,s));let c=new Jo(i,o,this._editor.getSelection());this._executeEditorCommand(`replaceAll`,c)}_regularReplaceAll(e){let t=this._getReplacePattern(),n=this._findMatches(e,t.hasReplacementPatterns||this._state.preserveCase,1073741824),r=[];for(let e=0,i=n.length;e<i;e++)r[e]=t.buildReplaceString(n[e].matches,this._state.preserveCase);let i=new Qx(this._editor.getSelection(),n.map(e=>e.range),r);this._executeEditorCommand(`replaceAll`,i)}selectAllMatches(){if(!this._hasMatches())return;let e=this._decorations.getFindScopes(),t=this._findMatches(e,!1,1073741824).map(e=>new P(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn)),n=this._editor.getSelection();for(let e=0,r=t.length;e<r;e++)if(t[e].equalsRange(n)){t=[n].concat(t.slice(0,e),t.slice(e+1));break}this._editor.setSelections(t)}_executeEditorCommand(e,t){try{this._ignoreModelContentChanged=!0,this._editor.pushUndoStop(),this._editor.executeCommand(e,t),this._editor.pushUndoStop()}finally{this._ignoreModelContentChanged=!1}}},bS=class e extends Au{static{this.ID=`editor.contrib.findOptionsWidget`}constructor(e,t,n){super(),this._hideSoon=this._register(new Zr(()=>this._hide(),2e3)),this._isVisible=!1,this._editor=e,this._state=t,this._keybindingService=n,this._domNode=document.createElement(`div`),this._domNode.className=`findOptionsWidget`,this._domNode.style.display=`none`,this._domNode.style.top=`10px`,this._domNode.style.zIndex=`12`,this._domNode.setAttribute(`role`,`presentation`),this._domNode.setAttribute(`aria-hidden`,`true`);let r={inputActiveOptionBorder:A(Bi),inputActiveOptionForeground:A(xt),inputActiveOptionBackground:A(yi)},i=this._register(on());this.caseSensitive=this._register(new qu({appendTitle:this._keybindingLabelFor(gS.ToggleCaseSensitiveCommand),isChecked:this._state.matchCase,hoverDelegate:i,...r})),this._domNode.appendChild(this.caseSensitive.domNode),this._register(this.caseSensitive.onChange(()=>{this._state.change({matchCase:this.caseSensitive.checked},!1)})),this.wholeWords=this._register(new Le({appendTitle:this._keybindingLabelFor(gS.ToggleWholeWordCommand),isChecked:this._state.wholeWord,hoverDelegate:i,...r})),this._domNode.appendChild(this.wholeWords.domNode),this._register(this.wholeWords.onChange(()=>{this._state.change({wholeWord:this.wholeWords.checked},!1)})),this.regex=this._register(new ni({appendTitle:this._keybindingLabelFor(gS.ToggleRegexCommand),isChecked:this._state.isRegex,hoverDelegate:i,...r})),this._domNode.appendChild(this.regex.domNode),this._register(this.regex.onChange(()=>{this._state.change({isRegex:this.regex.checked},!1)})),this._editor.addOverlayWidget(this),this._register(this._state.onFindReplaceStateChange(e=>{let t=!1;e.isRegex&&(this.regex.checked=this._state.isRegex,t=!0),e.wholeWord&&(this.wholeWords.checked=this._state.wholeWord,t=!0),e.matchCase&&(this.caseSensitive.checked=this._state.matchCase,t=!0),!this._state.isRevealed&&t&&this._revealTemporarily()})),this._register(z(this._domNode,Pc.MOUSE_LEAVE,e=>this._onMouseLeave())),this._register(z(this._domNode,`mouseover`,e=>this._onMouseOver()))}_keybindingLabelFor(e){let t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:``}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return{preference:0}}highlightFindOptions(){this._revealTemporarily()}_revealTemporarily(){this._show(),this._hideSoon.schedule()}_onMouseLeave(){this._hideSoon.schedule()}_onMouseOver(){this._hideSoon.cancel()}_show(){this._isVisible||(this._isVisible=!0,this._domNode.style.display=`block`)}_hide(){this._isVisible&&(this._isVisible=!1,this._domNode.style.display=`none`)}};function xS(e,t){return e===1?!0:e===2?!1:t}var SS=class extends x{get searchString(){return this._searchString}get replaceString(){return this._replaceString}get isRevealed(){return this._isRevealed}get isReplaceRevealed(){return this._isReplaceRevealed}get isRegex(){return xS(this._isRegexOverride,this._isRegex)}get wholeWord(){return xS(this._wholeWordOverride,this._wholeWord)}get matchCase(){return xS(this._matchCaseOverride,this._matchCase)}get preserveCase(){return xS(this._preserveCaseOverride,this._preserveCase)}get actualIsRegex(){return this._isRegex}get actualWholeWord(){return this._wholeWord}get actualMatchCase(){return this._matchCase}get actualPreserveCase(){return this._preserveCase}get searchScope(){return this._searchScope}get matchesPosition(){return this._matchesPosition}get matchesCount(){return this._matchesCount}get currentMatch(){return this._currentMatch}constructor(){super(),this._onFindReplaceStateChange=this._register(new D),this.onFindReplaceStateChange=this._onFindReplaceStateChange.event,this._searchString=``,this._replaceString=``,this._isRevealed=!1,this._isReplaceRevealed=!1,this._isRegex=!1,this._isRegexOverride=0,this._wholeWord=!1,this._wholeWordOverride=0,this._matchCase=!1,this._matchCaseOverride=0,this._preserveCase=!1,this._preserveCaseOverride=0,this._searchScope=null,this._matchesPosition=0,this._matchesCount=0,this._currentMatch=null,this._loop=!0,this._isSearching=!1,this._filters=null}changeMatchInfo(e,t,n){let r={moveCursor:!1,updateHistory:!1,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1},i=!1;t===0&&(e=0),e>t&&(e=t),this._matchesPosition!==e&&(this._matchesPosition=e,r.matchesPosition=!0,i=!0),this._matchesCount!==t&&(this._matchesCount=t,r.matchesCount=!0,i=!0),n!==void 0&&(T.equalsRange(this._currentMatch,n)||(this._currentMatch=n,r.currentMatch=!0,i=!0)),i&&this._onFindReplaceStateChange.fire(r)}change(e,t,n=!0){let r={moveCursor:t,updateHistory:n,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1},i=!1,a=this.isRegex,o=this.wholeWord,s=this.matchCase,c=this.preserveCase;e.searchString!==void 0&&this._searchString!==e.searchString&&(this._searchString=e.searchString,r.searchString=!0,i=!0),e.replaceString!==void 0&&this._replaceString!==e.replaceString&&(this._replaceString=e.replaceString,r.replaceString=!0,i=!0),e.isRevealed!==void 0&&this._isRevealed!==e.isRevealed&&(this._isRevealed=e.isRevealed,r.isRevealed=!0,i=!0),e.isReplaceRevealed!==void 0&&this._isReplaceRevealed!==e.isReplaceRevealed&&(this._isReplaceRevealed=e.isReplaceRevealed,r.isReplaceRevealed=!0,i=!0),e.isRegex!==void 0&&(this._isRegex=e.isRegex),e.wholeWord!==void 0&&(this._wholeWord=e.wholeWord),e.matchCase!==void 0&&(this._matchCase=e.matchCase),e.preserveCase!==void 0&&(this._preserveCase=e.preserveCase),e.searchScope!==void 0&&(e.searchScope?.every(e=>this._searchScope?.some(t=>!T.equalsRange(t,e)))||(this._searchScope=e.searchScope,r.searchScope=!0,i=!0)),e.loop!==void 0&&this._loop!==e.loop&&(this._loop=e.loop,r.loop=!0,i=!0),e.isSearching!==void 0&&this._isSearching!==e.isSearching&&(this._isSearching=e.isSearching,r.isSearching=!0,i=!0),e.filters!==void 0&&(this._filters?this._filters.update(e.filters):this._filters=e.filters,r.filters=!0,i=!0),this._isRegexOverride=e.isRegexOverride===void 0?0:e.isRegexOverride,this._wholeWordOverride=e.wholeWordOverride===void 0?0:e.wholeWordOverride,this._matchCaseOverride=e.matchCaseOverride===void 0?0:e.matchCaseOverride,this._preserveCaseOverride=e.preserveCaseOverride===void 0?0:e.preserveCaseOverride,a!==this.isRegex&&(i=!0,r.isRegex=!0),o!==this.wholeWord&&(i=!0,r.wholeWord=!0),s!==this.matchCase&&(i=!0,r.matchCase=!0),c!==this.preserveCase&&(i=!0,r.preserveCase=!0),i&&this._onFindReplaceStateChange.fire(r)}canNavigateBack(){return this.canNavigateInLoop()||this.matchesPosition!==1}canNavigateForward(){return this.canNavigateInLoop()||this.matchesPosition<this.matchesCount}canNavigateInLoop(){return this._loop||this.matchesCount>=19999}},CS=G(5,`input`),wS=G(6,`Preserve Case`),TS=class extends it{constructor(e){super({icon:X.preserveCase,title:wS+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??ha(`element`),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}},ES=class extends Au{get onDidOptionChange(){return this._onDidOptionChange.event}get onKeyDown(){return this._onKeyDown.event}get onPreserveCaseKeyDown(){return this._onPreserveCaseKeyDown.event}constructor(e,t,n,r){super(),this._showOptionButtons=n,this.fixFocusOnOptionClickEnabled=!0,this.cachedOptionsWidth=0,this._onDidOptionChange=this._register(new D),this._onKeyDown=this._register(new D),this._onMouseDown=this._register(new D),this._onInput=this._register(new D),this._onKeyUp=this._register(new D),this._onPreserveCaseKeyDown=this._register(new D),this.contextViewProvider=t,this.placeholder=r.placeholder||``,this.validation=r.validation,this.label=r.label||CS;let i=r.appendPreserveCaseLabel||``,a=r.history||new Set([]),o=!!r.flexibleHeight,s=!!r.flexibleWidth,c=r.flexibleMaxHeight;this.domNode=document.createElement(`div`),this.domNode.classList.add(`monaco-findInput`),this.inputBox=this._register(new co(this.domNode,this.contextViewProvider,{ariaLabel:this.label||``,placeholder:this.placeholder||``,validationOptions:{validation:this.validation},history:a,showHistoryHint:r.showHistoryHint,flexibleHeight:o,flexibleWidth:s,flexibleMaxHeight:c,inputBoxStyles:r.inputBoxStyles})),this.preserveCase=this._register(new TS({appendTitle:i,isChecked:!1,...r.toggleStyles})),this._register(this.preserveCase.onChange(e=>{this._onDidOptionChange.fire(e),!e&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.preserveCase.onKeyDown(e=>{this._onPreserveCaseKeyDown.fire(e)})),this._showOptionButtons?this.cachedOptionsWidth=this.preserveCase.width():this.cachedOptionsWidth=0;let l=[this.preserveCase.domNode];this.onkeydown(this.domNode,e=>{if(e.equals(15)||e.equals(17)||e.equals(9)){let t=l.indexOf(this.domNode.ownerDocument.activeElement);if(t>=0){let n=-1;e.equals(17)?n=(t+1)%l.length:e.equals(15)&&(n=t===0?l.length-1:t-1),e.equals(9)?(l[t].blur(),this.inputBox.focus()):n>=0&&l[n].focus(),Yl.stop(e,!0)}}});let u=document.createElement(`div`);u.className=`controls`,u.style.display=this._showOptionButtons?`block`:`none`,u.appendChild(this.preserveCase.domNode),this.domNode.appendChild(u),e?.appendChild(this.domNode),this.onkeydown(this.inputBox.inputElement,e=>this._onKeyDown.fire(e)),this.onkeyup(this.inputBox.inputElement,e=>this._onKeyUp.fire(e)),this.oninput(this.inputBox.inputElement,e=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,e=>this._onMouseDown.fire(e))}enable(){this.domNode.classList.remove(`disabled`),this.inputBox.enable(),this.preserveCase.enable()}disable(){this.domNode.classList.add(`disabled`),this.inputBox.disable(),this.preserveCase.disable()}setEnabled(e){e?this.enable():this.disable()}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getPreserveCase(){return this.preserveCase.checked}setPreserveCase(e){this.preserveCase.checked=e}focusOnPreserve(){this.preserveCase.focus()}validate(){this.inputBox?.validate()}set width(e){this.inputBox.paddingRight=this.cachedOptionsWidth,this.domNode.style.width=e+`px`}dispose(){super.dispose()}},DS=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},OS=function(e,t){return function(n,r){t(n,r,e)}};const kS=new N(`suggestWidgetVisible`,!1,G(1683,`Whether suggestion are visible`));var AS=`historyNavigationWidgetFocus`,jS=`historyNavigationForwardsEnabled`,MS=`historyNavigationBackwardsEnabled`,NS=void 0,PS=[];function FS(e,t){if(PS.includes(t))throw Error(`Cannot register the same widget multiple times`);PS.push(t);let n=new L,r=new N(AS,!1).bindTo(e),i=new N(jS,!0).bindTo(e),a=new N(MS,!0).bindTo(e),o=()=>{r.set(!0),NS=t},s=()=>{r.set(!1),NS===t&&(NS=void 0)};return ke(t.element)&&o(),n.add(t.onDidFocus(()=>o())),n.add(t.onDidBlur(()=>s())),n.add(Cl(()=>{PS.splice(PS.indexOf(t),1),s()})),{historyNavigationForwardsEnablement:i,historyNavigationBackwardsEnablement:a,dispose(){n.dispose()}}}var IS=class extends ad{constructor(e,t,n,r){super(e,t,n);let i=this._register(r.createScoped(this.inputBox.element));this._register(FS(i,this.inputBox))}};IS=DS([OS(3,On)],IS);var LS=class extends ES{constructor(e,t,n,r,i=!1){super(e,t,i,n);let a=this._register(r.createScoped(this.inputBox.element));this._register(FS(a,this.inputBox))}};LS=DS([OS(3,On)],LS),Zn.registerCommandAndKeybindingRule({id:`history.showPrevious`,weight:200,when:E.and(E.has(AS),E.equals(MS,!0),E.not(`isComposing`),kS.isEqualTo(!1)),primary:16,secondary:[528],handler:e=>{NS?.showPreviousValue()}}),Zn.registerCommandAndKeybindingRule({id:`history.showNext`,weight:200,when:E.and(E.has(AS),E.equals(jS,!0),E.not(`isComposing`),kS.isEqualTo(!1)),primary:18,secondary:[530],handler:e=>{NS?.showNextValue()}});function RS(e){return e.lookupKeybinding(`history.showPrevious`)?.getElectronAccelerator()===`Up`&&e.lookupKeybinding(`history.showNext`)?.getElectronAccelerator()===`Down`}var zS=nu(`find-collapsed`,X.chevronRight,G(951,`Icon to indicate that the editor find widget is collapsed.`)),BS=nu(`find-expanded`,X.chevronDown,G(952,`Icon to indicate that the editor find widget is expanded.`));const VS=nu(`find-selection`,X.selection,G(953,`Icon for 'Find in Selection' in the editor find widget.`)),HS=nu(`find-replace`,X.replace,G(954,`Icon for 'Replace' in the editor find widget.`)),US=nu(`find-replace-all`,X.replaceAll,G(955,`Icon for 'Replace All' in the editor find widget.`)),WS=nu(`find-previous-match`,X.arrowUp,G(956,`Icon for 'Find Previous' in the editor find widget.`)),GS=nu(`find-next-match`,X.arrowDown,G(957,`Icon for 'Find Next' in the editor find widget.`));var KS=G(958,`Find / Replace`),qS=G(959,`Find`),JS=G(960,`Find`),YS=G(961,`Previous Match`),XS=G(962,`Next Match`),ZS=G(963,`Find in Selection`),QS=G(964,`Close`),$S=G(965,`Replace`),eC=G(966,`Replace`),tC=G(967,`Replace`),nC=G(968,`Replace All`),rC=G(969,`Toggle Replace`),iC=G(970,`Only the first {0} results are highlighted, but all find operations work on the entire text.`,_S);const aC=G(971,`{0} of {1}`),oC=G(972,`No results`);var sC=419,cC=221,lC=69,uC=33,dC=po?256:2048,fC=class{constructor(e){this.afterLineNumber=e,this.heightInPx=uC,this.suppressMouseDown=!1,this.domNode=document.createElement(`div`),this.domNode.className=`dock-find-viewzone`}};function pC(e,t,n){let r=!!t.match(/\n/);if(n&&r&&n.selectionStart>0){e.stopPropagation();return}}function mC(e,t,n){let r=!!t.match(/\n/);if(n&&r&&n.selectionEnd<n.value.length){e.stopPropagation();return}}var hC=class e extends Au{static{this.ID=`editor.contrib.findWidget`}constructor(e,t,n,r,i,a,o,s,c){super(),this._hoverService=o,this._findWidgetSearchHistory=s,this._replaceWidgetHistory=c,this._cachedHeight=null,this._revealTimeouts=[],this._codeEditor=e,this._controller=t,this._state=n,this._contextViewProvider=r,this._keybindingService=i,this._contextKeyService=a,this._isVisible=!1,this._isReplaceVisible=!1,this._ignoreChangeEvent=!1,this._updateHistoryDelayer=new Hu(500),this._register(Cl(()=>this._updateHistoryDelayer.cancel())),this._register(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this._buildDomNode(),this._updateButtons(),this._tryUpdateWidgetWidth(),this._findInput.inputBox.layout(),this._register(this._codeEditor.onDidChangeConfiguration(e=>{if(e.hasChanged(104)&&(this._codeEditor.getOption(104)&&this._state.change({isReplaceRevealed:!1},!1),this._updateButtons()),e.hasChanged(165)&&this._tryUpdateWidgetWidth(),e.hasChanged(2)&&this.updateAccessibilitySupport(),e.hasChanged(50)){let e=this._codeEditor.getOption(50).loop;this._state.change({loop:e},!1);let t=this._codeEditor.getOption(50).addExtraSpaceOnTop;t&&!this._viewZone&&(this._viewZone=new fC(0),this._showViewZone()),!t&&this._viewZone&&this._removeViewZone()}})),this.updateAccessibilitySupport(),this._register(this._codeEditor.onDidChangeCursorSelection(()=>{this._isVisible&&this._updateToggleSelectionFindButton()})),this._register(this._codeEditor.onDidFocusEditorWidget(async()=>{if(this._isVisible){let e=await this._controller.getGlobalBufferTerm();e&&e!==this._state.searchString&&(this._state.change({searchString:e},!1),this._findInput.select())}})),this._findInputFocused=lS.bindTo(a),this._findFocusTracker=this._register(Wn(this._findInput.inputBox.inputElement)),this._register(this._findFocusTracker.onDidFocus(()=>{this._findInputFocused.set(!0),this._updateSearchScope()})),this._register(this._findFocusTracker.onDidBlur(()=>{this._findInputFocused.set(!1)})),this._replaceInputFocused=uS.bindTo(a),this._replaceFocusTracker=this._register(Wn(this._replaceInput.inputBox.inputElement)),this._register(this._replaceFocusTracker.onDidFocus(()=>{this._replaceInputFocused.set(!0),this._updateSearchScope()})),this._register(this._replaceFocusTracker.onDidBlur(()=>{this._replaceInputFocused.set(!1)})),this._codeEditor.addOverlayWidget(this),this._codeEditor.getOption(50).addExtraSpaceOnTop&&(this._viewZone=new fC(0)),this._register(this._codeEditor.onDidChangeModel(()=>{this._isVisible&&(this._viewZoneId=void 0)})),this._register(this._codeEditor.onDidScrollChange(e=>{if(e.scrollTopChanged){this._layoutViewZone();return}setTimeout(()=>{this._layoutViewZone()},0)}))}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return this._isVisible?{preference:0}:null}_onStateChanged(e){if(e.searchString){try{this._ignoreChangeEvent=!0,this._findInput.setValue(this._state.searchString)}finally{this._ignoreChangeEvent=!1}this._updateButtons()}if(e.replaceString&&(this._replaceInput.inputBox.value=this._state.replaceString),e.isRevealed&&(this._state.isRevealed?this._reveal():this._hide(!0)),e.isReplaceRevealed&&(this._state.isReplaceRevealed?!this._codeEditor.getOption(104)&&!this._isReplaceVisible&&(this._isReplaceVisible=!0,this._replaceInput.width=Zu(this._findInput.domNode),this._updateButtons(),this._replaceInput.inputBox.layout()):this._isReplaceVisible&&(this._isReplaceVisible=!1,this._updateButtons())),(e.isRevealed||e.isReplaceRevealed)&&(this._state.isRevealed||this._state.isReplaceRevealed)&&this._tryUpdateHeight()&&this._showViewZone(),e.isRegex&&this._findInput.setRegex(this._state.isRegex),e.wholeWord&&this._findInput.setWholeWords(this._state.wholeWord),e.matchCase&&this._findInput.setCaseSensitive(this._state.matchCase),e.preserveCase&&this._replaceInput.setPreserveCase(this._state.preserveCase),e.searchScope&&(this._state.searchScope?this._toggleSelectionFind.checked=!0:this._toggleSelectionFind.checked=!1,this._updateToggleSelectionFindButton()),e.searchString||e.matchesCount||e.matchesPosition){let e=this._state.searchString.length>0&&this._state.matchesCount===0;this._domNode.classList.toggle(`no-results`,e),this._updateMatchesCount(),this._updateButtons()}(e.searchString||e.currentMatch)&&this._layoutViewZone(),e.updateHistory&&this._delayedUpdateHistory(),e.loop&&this._updateButtons()}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this)).then(void 0,mr)}_updateHistory(){this._state.searchString&&this._findInput.inputBox.addToHistory(),this._state.replaceString&&this._replaceInput.inputBox.addToHistory()}_updateMatchesCount(){this._matchesCount.style.minWidth=lC+`px`,this._state.matchesCount>=19999?this._matchesCount.title=iC:this._matchesCount.title=``,this._matchesCount.firstChild?.remove();let e;if(this._state.matchesCount>0){let t=String(this._state.matchesCount);this._state.matchesCount>=19999&&(t+=`+`);let n=String(this._state.matchesPosition);n===`0`&&(n=`?`),e=Vi(aC,n,t)}else e=oC;this._matchesCount.appendChild(document.createTextNode(e)),va(this._getAriaLabel(e,this._state.currentMatch,this._state.searchString)),lC=Math.max(lC,this._matchesCount.clientWidth)}_getAriaLabel(e,t,n){if(e===oC)return n===``?G(973,`{0} found`,e):G(974,`{0} found for '{1}'`,e,n);if(t){let r=G(975,`{0} found for '{1}', at {2}`,e,n,t.startLineNumber+`:`+t.startColumn),i=this._codeEditor.getModel();return i&&t.startLineNumber<=i.getLineCount()&&t.startLineNumber>=1?`${i.getLineContent(t.startLineNumber)}, ${r}`:r}return G(976,`{0} found for '{1}'`,e,n)}_updateToggleSelectionFindButton(){let e=this._codeEditor.getSelection(),t=e?e.startLineNumber!==e.endLineNumber||e.startColumn!==e.endColumn:!1,n=this._toggleSelectionFind.checked;this._isVisible&&(n||t)?this._toggleSelectionFind.enable():this._toggleSelectionFind.disable()}_updateButtons(){this._findInput.setEnabled(this._isVisible),this._replaceInput.setEnabled(this._isVisible&&this._isReplaceVisible),this._updateToggleSelectionFindButton(),this._closeBtn.setEnabled(this._isVisible);let e=this._state.searchString.length>0,t=!!this._state.matchesCount;this._prevBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateBack()),this._nextBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateForward()),this._replaceBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._replaceAllBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._domNode.classList.toggle(`replaceToggled`,this._isReplaceVisible),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);let n=!this._codeEditor.getOption(104);this._toggleReplaceBtn.setEnabled(this._isVisible&&n)}_reveal(){if(this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],!this._isVisible){this._isVisible=!0;let e=this._codeEditor.getSelection();switch(this._codeEditor.getOption(50).autoFindInSelection){case`always`:this._toggleSelectionFind.checked=!0;break;case`never`:this._toggleSelectionFind.checked=!1;break;case`multiline`:{let t=!!e&&e.startLineNumber!==e.endLineNumber;this._toggleSelectionFind.checked=t;break}default:break}this._tryUpdateWidgetWidth(),this._updateButtons(),this._revealTimeouts.push(setTimeout(()=>{this._domNode.classList.add(`visible`),this._domNode.setAttribute(`aria-hidden`,`false`)},0)),this._revealTimeouts.push(setTimeout(()=>{this._findInput.validate()},200)),this._codeEditor.layoutOverlayWidget(this);let t=!0;if(this._codeEditor.getOption(50).seedSearchStringFromSelection&&e){let n=this._codeEditor.getDomNode();if(n){let r=vs(n),i=this._codeEditor.getScrolledVisiblePosition(e.getStartPosition()),a=r.left+(i?i.left:0),o=i?i.top:0;if(this._viewZone&&o<this._viewZone.heightInPx){e.endLineNumber>e.startLineNumber&&(t=!1);let n=ja(this._domNode).left;a>n&&(t=!1);let i=this._codeEditor.getScrolledVisiblePosition(e.getEndPosition());r.left+(i?i.left:0)>n&&(t=!1)}}}this._showViewZone(t)}}_hide(e){this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],this._isVisible&&(this._isVisible=!1,this._updateButtons(),this._domNode.classList.remove(`visible`),this._domNode.setAttribute(`aria-hidden`,`true`),this._findInput.clearMessage(),e&&this._codeEditor.focus(),this._codeEditor.layoutOverlayWidget(this),this._removeViewZone())}_layoutViewZone(e){if(!this._codeEditor.getOption(50).addExtraSpaceOnTop){this._removeViewZone();return}if(!this._isVisible)return;let t=this._viewZone;this._viewZoneId!==void 0||!t||this._codeEditor.changeViewZones(n=>{t.heightInPx=this._getHeight(),this._viewZoneId=n.addZone(t),this._codeEditor.setScrollTop(e||this._codeEditor.getScrollTop()+t.heightInPx)})}_showViewZone(e=!0){if(!this._isVisible||!this._codeEditor.getOption(50).addExtraSpaceOnTop)return;this._viewZone===void 0&&(this._viewZone=new fC(0));let t=this._viewZone;this._codeEditor.changeViewZones(n=>{if(this._viewZoneId!==void 0){let r=this._getHeight();if(r===t.heightInPx)return;let i=r-t.heightInPx;t.heightInPx=r,n.layoutZone(this._viewZoneId),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+i);return}else{let r=this._getHeight();if(r-=this._codeEditor.getOption(96).top,r<=0)return;t.heightInPx=r,this._viewZoneId=n.addZone(t),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+r)}})}_removeViewZone(){this._codeEditor.changeViewZones(e=>{this._viewZoneId!==void 0&&(e.removeZone(this._viewZoneId),this._viewZoneId=void 0,this._viewZone&&=(this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()-this._viewZone.heightInPx),void 0))})}_tryUpdateWidgetWidth(){if(!this._isVisible||!this._domNode.isConnected)return;let e=this._codeEditor.getLayoutInfo();if(e.contentWidth<=0){this._domNode.classList.add(`hiddenEditor`);return}else this._domNode.classList.contains(`hiddenEditor`)&&this._domNode.classList.remove(`hiddenEditor`);let t=e.width,n=e.minimap.minimapWidth,r=!1,i=!1,a=!1;if(this._resized&&Zu(this._domNode)>sC){this._domNode.style.maxWidth=`${t-28-n-15}px`,this._replaceInput.width=Zu(this._findInput.domNode);return}if(sC+28+n>=t&&(i=!0),sC+28+n-lC>=t&&(a=!0),sC+28+n-lC>=t+50&&(r=!0),this._domNode.classList.toggle(`collapsed-find-widget`,r),this._domNode.classList.toggle(`narrow-find-widget`,a),this._domNode.classList.toggle(`reduced-find-widget`,i),!a&&!r&&(this._domNode.style.maxWidth=`${t-28-n-15}px`),this._findInput.layout({collapsedFindWidget:r,narrowFindWidget:a,reducedFindWidget:i}),this._resized){let e=this._findInput.inputBox.element.clientWidth;e>0&&(this._replaceInput.width=e)}else this._isReplaceVisible&&(this._replaceInput.width=Zu(this._findInput.domNode))}_getHeight(){let e=0;return e+=4,e+=this._findInput.inputBox.height+2,this._isReplaceVisible&&(e+=4,e+=this._replaceInput.inputBox.height+2),e+=4,e}_tryUpdateHeight(){let e=this._getHeight();return this._cachedHeight!==null&&this._cachedHeight===e?!1:(this._cachedHeight=e,this._domNode.style.height=`${e}px`,!0)}focusFindInput(){this._findInput.select(),this._findInput.focus()}focusReplaceInput(){this._replaceInput.select(),this._replaceInput.focus()}highlightFindOptions(){this._findInput.highlightFindOptions()}_updateSearchScope(){if(this._codeEditor.hasModel()&&this._toggleSelectionFind.checked){let e=this._codeEditor.getSelections();e.map(e=>{e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(e.endLineNumber-1)));let t=this._state.currentMatch;return e.startLineNumber!==e.endLineNumber&&!T.equalsRange(e,t)?e:null}).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}_onFindInputMouseDown(e){e.middleButton&&e.stopPropagation()}_onFindInputKeyDown(e){if(e.equals(dC|3))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._findInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(2)){this._isReplaceVisible?this._replaceInput.focus():this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(2066)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(16))return pC(e,this._findInput.getValue(),this._findInput.domNode.querySelector(`textarea`));if(e.equals(18))return mC(e,this._findInput.getValue(),this._findInput.domNode.querySelector(`textarea`))}_onReplaceInputKeyDown(e){if(e.equals(dC|3))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._replaceInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(2)){this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(1026)){this._findInput.focus(),e.preventDefault();return}if(e.equals(2066)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(16))return pC(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector(`textarea`));if(e.equals(18))return mC(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector(`textarea`))}getVerticalSashLeft(e){return 0}_keybindingLabelFor(e){let t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:``}_buildDomNode(){let e=this._codeEditor.getOption(50).history,t=this._codeEditor.getOption(50).replaceHistory;this._findInput=this._register(new IS(null,this._contextViewProvider,{width:cC,label:qS,placeholder:JS,appendCaseSensitiveLabel:this._keybindingLabelFor(gS.ToggleCaseSensitiveCommand),appendWholeWordsLabel:this._keybindingLabelFor(gS.ToggleWholeWordCommand),appendRegexLabel:this._keybindingLabelFor(gS.ToggleRegexCommand),validation:e=>{if(e.length===0||!this._findInput.getRegex())return null;try{return new RegExp(e,`gu`),null}catch(e){return{content:e.message}}},flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showCommonFindToggles:!0,showHistoryHint:()=>RS(this._keybindingService),inputBoxStyles:_d,toggleStyles:zt,history:e===`workspace`?this._findWidgetSearchHistory:new Set([])},this._contextKeyService)),this._findInput.setRegex(!!this._state.isRegex),this._findInput.setCaseSensitive(!!this._state.matchCase),this._findInput.setWholeWords(!!this._state.wholeWord),this._register(this._findInput.onKeyDown(e=>{e.equals(3)&&!this._codeEditor.getOption(50).findOnType&&this._state.change({searchString:this._findInput.getValue()},!0),this._onFindInputKeyDown(e)})),this._register(this._findInput.inputBox.onDidChange(()=>{this._ignoreChangeEvent||!this._codeEditor.getOption(50).findOnType||this._state.change({searchString:this._findInput.getValue()},!0)})),this._register(this._findInput.onDidOptionChange(()=>{this._state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},!0)})),this._register(this._findInput.onCaseSensitiveKeyDown(e=>{e.equals(1026)&&this._isReplaceVisible&&(this._replaceInput.focus(),e.preventDefault())})),this._register(this._findInput.onRegexKeyDown(e=>{e.equals(2)&&this._isReplaceVisible&&(this._replaceInput.focusOnPreserve(),e.preventDefault())})),this._register(this._findInput.inputBox.onDidHeightChange(e=>{this._tryUpdateHeight()&&this._showViewZone()})),Kc&&this._register(this._findInput.onMouseDown(e=>this._onFindInputMouseDown(e))),this._matchesCount=document.createElement(`div`),this._matchesCount.className=`matchesCount`,this._updateMatchesCount();let n=this._register(on());this._prevBtn=this._register(new gC({label:YS+this._keybindingLabelFor(gS.PreviousMatchFindAction),icon:WS,hoverDelegate:n,onTrigger:()=>{Ma(this._codeEditor.getAction(gS.PreviousMatchFindAction)).run().then(void 0,mr)}},this._hoverService)),this._nextBtn=this._register(new gC({label:XS+this._keybindingLabelFor(gS.NextMatchFindAction),icon:GS,hoverDelegate:n,onTrigger:()=>{Ma(this._codeEditor.getAction(gS.NextMatchFindAction)).run().then(void 0,mr)}},this._hoverService));let r=document.createElement(`div`);r.className=`find-part`,r.appendChild(this._findInput.domNode);let i=document.createElement(`div`);i.className=`find-actions`,r.appendChild(i),i.appendChild(this._matchesCount),i.appendChild(this._prevBtn.domNode),i.appendChild(this._nextBtn.domNode),this._toggleSelectionFind=this._register(new it({icon:VS,title:ZS+this._keybindingLabelFor(gS.ToggleSearchScopeCommand),isChecked:!1,hoverDelegate:n,inputActiveOptionBackground:A(yi),inputActiveOptionBorder:A(Bi),inputActiveOptionForeground:A(xt)})),this._register(this._toggleSelectionFind.onChange(()=>{if(this._toggleSelectionFind.checked){if(this._codeEditor.hasModel()){let e=this._codeEditor.getSelections();e=e.map(e=>(e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(e.endLineNumber-1))),e.isEmpty()?null:e)).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}else this._state.change({searchScope:null},!0)})),i.appendChild(this._toggleSelectionFind.domNode),this._closeBtn=this._register(new gC({label:QS+this._keybindingLabelFor(gS.CloseFindWidgetCommand),icon:Vc,hoverDelegate:n,onTrigger:()=>{this._state.change({isRevealed:!1,searchScope:null},!1)},onKeyDown:e=>{e.equals(2)&&this._isReplaceVisible&&(this._replaceBtn.isEnabled()?this._replaceBtn.focus():this._codeEditor.focus(),e.preventDefault())}},this._hoverService)),this._replaceInput=this._register(new LS(null,void 0,{label:$S,placeholder:eC,appendPreserveCaseLabel:this._keybindingLabelFor(gS.TogglePreserveCaseCommand),history:t===`workspace`?this._replaceWidgetHistory:new Set([]),flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showHistoryHint:()=>RS(this._keybindingService),inputBoxStyles:_d,toggleStyles:zt},this._contextKeyService,!0)),this._replaceInput.setPreserveCase(!!this._state.preserveCase),this._register(this._replaceInput.onKeyDown(e=>this._onReplaceInputKeyDown(e))),this._register(this._replaceInput.inputBox.onDidChange(()=>{this._state.change({replaceString:this._replaceInput.inputBox.value},!1)})),this._register(this._replaceInput.inputBox.onDidHeightChange(e=>{this._isReplaceVisible&&this._tryUpdateHeight()&&this._showViewZone()})),this._register(this._replaceInput.onDidOptionChange(()=>{this._state.change({preserveCase:this._replaceInput.getPreserveCase()},!0)})),this._register(this._replaceInput.onPreserveCaseKeyDown(e=>{e.equals(2)&&(this._prevBtn.isEnabled()?this._prevBtn.focus():this._nextBtn.isEnabled()?this._nextBtn.focus():this._toggleSelectionFind.enabled?this._toggleSelectionFind.focus():this._closeBtn.isEnabled()&&this._closeBtn.focus(),e.preventDefault())}));let a=this._register(on());this._replaceBtn=this._register(new gC({label:tC+this._keybindingLabelFor(gS.ReplaceOneAction),icon:HS,hoverDelegate:a,onTrigger:()=>{this._controller.replace()},onKeyDown:e=>{e.equals(1026)&&(this._closeBtn.focus(),e.preventDefault())}},this._hoverService)),this._replaceAllBtn=this._register(new gC({label:nC+this._keybindingLabelFor(gS.ReplaceAllAction),icon:US,hoverDelegate:a,onTrigger:()=>{this._controller.replaceAll()}},this._hoverService));let o=document.createElement(`div`);o.className=`replace-part`,o.appendChild(this._replaceInput.domNode);let s=document.createElement(`div`);s.className=`replace-actions`,o.appendChild(s),s.appendChild(this._replaceBtn.domNode),s.appendChild(this._replaceAllBtn.domNode),this._toggleReplaceBtn=this._register(new gC({label:rC,className:`codicon toggle left`,onTrigger:()=>{this._state.change({isReplaceRevealed:!this._isReplaceVisible},!1),this._isReplaceVisible&&(this._replaceInput.width=Zu(this._findInput.domNode),this._replaceInput.inputBox.layout()),this._showViewZone()}},this._hoverService)),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible),this._domNode=document.createElement(`div`),this._domNode.className=`editor-widget find-widget`,this._domNode.setAttribute(`aria-hidden`,`true`),this._domNode.ariaLabel=KS,this._domNode.role=`dialog`,this._domNode.style.width=`${sC}px`,this._domNode.appendChild(this._toggleReplaceBtn.domNode),this._domNode.appendChild(r),this._domNode.appendChild(this._closeBtn.domNode),this._domNode.appendChild(o),this._resizeSash=this._register(new Ac(this._domNode,this,{orientation:0,size:2})),this._resized=!1;let c=sC;this._register(this._resizeSash.onDidStart(()=>{c=Zu(this._domNode)})),this._register(this._resizeSash.onDidChange(e=>{this._resized=!0;let t=c+e.startX-e.currentX;if(t<sC)return;let n=parseFloat(Cc(this._domNode).maxWidth)||0;t>n||(this._domNode.style.width=`${t}px`,this._isReplaceVisible&&(this._replaceInput.width=Zu(this._findInput.domNode)),this._findInput.inputBox.layout(),this._tryUpdateHeight())})),this._register(this._resizeSash.onDidReset(()=>{let e=Zu(this._domNode);if(e<sC)return;let t=sC;if(!this._resized||e===sC){let e=this._codeEditor.getLayoutInfo();t=e.width-28-e.minimap.minimapWidth-15,this._resized=!0}this._domNode.style.width=`${t}px`,this._isReplaceVisible&&(this._replaceInput.width=Zu(this._findInput.domNode)),this._findInput.inputBox.layout()}))}updateAccessibilitySupport(){let e=this._codeEditor.getOption(2);this._findInput.setFocusInputOnOptionClick(e!==2)}getViewState(){let e=!1;return this._viewZone&&this._viewZoneId&&(e=this._viewZone.heightInPx>this._codeEditor.getScrollTop()),{widgetViewZoneVisible:e,scrollTop:this._codeEditor.getScrollTop()}}setViewState(e){e&&e.widgetViewZoneVisible&&this._layoutViewZone(e.scrollTop)}},gC=class extends Au{constructor(e,t){super(),this._opts=e;let n=`button`;this._opts.className&&(n=n+` `+this._opts.className),this._opts.icon&&(n=n+` `+I.asClassName(this._opts.icon)),this._domNode=document.createElement(`div`),this._domNode.tabIndex=0,this._domNode.className=n,this._domNode.setAttribute(`role`,`button`),this._domNode.setAttribute(`aria-label`,this._opts.label),this._register(t.setupManagedHover(e.hoverDelegate??ha(`element`),this._domNode,this._opts.label)),this.onclick(this._domNode,e=>{this._opts.onTrigger(),e.preventDefault()}),this.onkeydown(this._domNode,e=>{if(e.equals(10)||e.equals(3)){this._opts.onTrigger(),e.preventDefault();return}this._opts.onKeyDown?.(e)})}get domNode(){return this._domNode}isEnabled(){return this._domNode.tabIndex>=0}focus(){this._domNode.focus()}setEnabled(e){this._domNode.classList.toggle(`disabled`,!e),this._domNode.setAttribute(`aria-disabled`,String(!e)),this._domNode.tabIndex=e?0:-1}setExpanded(e){this._domNode.setAttribute(`aria-expanded`,String(!!e)),e?(this._domNode.classList.remove(...I.asClassNameArray(zS)),this._domNode.classList.add(...I.asClassNameArray(BS))):(this._domNode.classList.remove(...I.asClassNameArray(BS)),this._domNode.classList.add(...I.asClassNameArray(zS)))}};ta((e,t)=>{let n=e.getColor(Wc);n&&t.addRule(`.monaco-editor .findMatch { border: 1px ${ce(e.type)?`dotted`:`solid`} ${n}; box-sizing: border-box; }`);let r=e.getColor(fo);r&&t.addRule(`.monaco-editor .findScope { border: 1px ${ce(e.type)?`dashed`:`solid`} ${r}; }`);let i=e.getColor(Un);i&&t.addRule(`.monaco-editor .find-widget { border: 1px solid ${i}; }`);let a=e.getColor(ks);a&&t.addRule(`.monaco-editor .findMatchInline { color: ${a}; }`);let o=e.getColor(Il);o&&t.addRule(`.monaco-editor .currentFindMatchInline { color: ${o}; }`)});var _C=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vC=function(e,t){return function(n,r){t(n,r,e)}},yC,bC=class{static{yC=this}static{this.FIND_HISTORY_KEY=`workbench.find.history`}static{this._instance=null}static getOrCreate(e){return yC._instance||=new yC(e),yC._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new D,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){let t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e,t=this.storageService.get(yC.FIND_HISTORY_KEY,1);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){let e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(yC.FIND_HISTORY_KEY,JSON.stringify(e),1,0),this._onDidChangeEmitter.fire(e),t()})}};bC=yC=_C([vC(0,Qr)],bC);var xC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},SC=function(e,t){return function(n,r){t(n,r,e)}},CC,wC=class{static{CC=this}static{this.FIND_HISTORY_KEY=`workbench.replace.history`}static{this._instance=null}static getOrCreate(e){return CC._instance||=new CC(e),CC._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new D,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){let t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e,t=this.storageService.get(CC.FIND_HISTORY_KEY,1);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){let e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(CC.FIND_HISTORY_KEY,JSON.stringify(e),1,0),this._onDidChangeEmitter.fire(e),t()})}};wC=CC=xC([SC(0,Qr)],wC);var TC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},EC=function(e,t){return function(n,r){t(n,r,e)}},DC,OC=524288;function kC(e,t=`single`,n=!1){if(!e.hasModel())return null;let r=e.getSelection();if(t===`single`&&r.startLineNumber===r.endLineNumber||t===`multiple`){if(r.isEmpty()){let t=e.getConfiguredWordAtPosition(r.getStartPosition());if(t&&!1===n)return t.word}else if(e.getModel().getValueLengthInRange(r)<OC)return e.getModel().getValueInRange(r)}return null}var AC=class extends x{static{DC=this}static{this.ID=`editor.contrib.findController`}get editor(){return this._editor}static get(e){return e.getContribution(DC.ID)}constructor(e,t,n,r,i,a){super(),this._editor=e,this._findWidgetVisible=cS.bindTo(t),this._contextKeyService=t,this._storageService=n,this._clipboardService=r,this._notificationService=i,this._hoverService=a,this._updateHistoryDelayer=new Hu(500),this._state=this._register(new SS),this.loadQueryState(),this._register(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this._model=null,this._register(this._editor.onDidChangeModel(()=>{let e=this._editor.getModel()&&this._state.isRevealed;this.disposeModel(),this._state.change({searchScope:null,matchCase:this._storageService.getBoolean(`editor.matchCase`,1,!1),wholeWord:this._storageService.getBoolean(`editor.wholeWord`,1,!1),isRegex:this._storageService.getBoolean(`editor.isRegex`,1,!1),preserveCase:this._storageService.getBoolean(`editor.preserveCase`,1,!1)},!1),e&&this._start({forceRevealReplace:!1,seedSearchStringFromSelection:`none`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!1,updateSearchScope:!1,loop:this._editor.getOption(50).loop})}))}dispose(){this.disposeModel(),super.dispose()}disposeModel(){this._model&&=(this._model.dispose(),null)}_onStateChanged(e){this.saveQueryState(e),e.isRevealed&&(this._state.isRevealed?this._findWidgetVisible.set(!0):(this._findWidgetVisible.reset(),this.disposeModel())),e.searchString&&this.setGlobalBufferTerm(this._state.searchString)}saveQueryState(e){e.isRegex&&this._storageService.store(`editor.isRegex`,this._state.actualIsRegex,1,1),e.wholeWord&&this._storageService.store(`editor.wholeWord`,this._state.actualWholeWord,1,1),e.matchCase&&this._storageService.store(`editor.matchCase`,this._state.actualMatchCase,1,1),e.preserveCase&&this._storageService.store(`editor.preserveCase`,this._state.actualPreserveCase,1,1)}loadQueryState(){this._state.change({matchCase:this._storageService.getBoolean(`editor.matchCase`,1,this._state.matchCase),wholeWord:this._storageService.getBoolean(`editor.wholeWord`,1,this._state.wholeWord),isRegex:this._storageService.getBoolean(`editor.isRegex`,1,this._state.isRegex),preserveCase:this._storageService.getBoolean(`editor.preserveCase`,1,this._state.preserveCase)},!1)}isFindInputFocused(){return!!lS.getValue(this._contextKeyService)}getState(){return this._state}closeFindWidget(){this._state.change({isRevealed:!1,searchScope:null},!1),this._editor.focus()}toggleCaseSensitive(){this._state.change({matchCase:!this._state.matchCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleWholeWords(){this._state.change({wholeWord:!this._state.wholeWord},!1),this._state.isRevealed||this.highlightFindOptions()}toggleRegex(){this._state.change({isRegex:!this._state.isRegex},!1),this._state.isRevealed||this.highlightFindOptions()}togglePreserveCase(){this._state.change({preserveCase:!this._state.preserveCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleSearchScope(){if(this._state.searchScope)this._state.change({searchScope:null},!0);else if(this._editor.hasModel()){let e=this._editor.getSelections();e=e.map(e=>(e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._editor.getModel().getLineMaxColumn(e.endLineNumber-1))),e.isEmpty()?null:e)).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}setSearchString(e){this._state.isRegex&&(e=Pt(e)),this._state.change({searchString:e},!1)}highlightFindOptions(e=!1){}async _start(e,t){if(this.disposeModel(),!this._editor.hasModel())return;let n={...t,isRevealed:!0};if(e.seedSearchStringFromSelection===`single`){let t=kC(this._editor,e.seedSearchStringFromSelection,e.seedSearchStringFromNonEmptySelection);t&&(this._state.isRegex?n.searchString=Pt(t):n.searchString=t)}else if(e.seedSearchStringFromSelection===`multiple`&&!e.updateSearchScope){let t=kC(this._editor,e.seedSearchStringFromSelection);t&&(n.searchString=t)}if(!n.searchString&&e.seedSearchStringFromGlobalClipboard){let e=await this.getGlobalBufferTerm();if(!this._editor.hasModel())return;e&&(n.searchString=e)}if(e.forceRevealReplace||n.isReplaceRevealed?n.isReplaceRevealed=!0:this._findWidgetVisible.get()||(n.isReplaceRevealed=!1),e.updateSearchScope){let e=this._editor.getSelections();e.some(e=>!e.isEmpty())&&(n.searchScope=e)}n.loop=e.loop,this._state.change(n,!1),this._model||=new yS(this._editor,this._state)}start(e,t){return this._start(e,t)}moveToNextMatch(){return this._model?(this._model.moveToNextMatch(),!0):!1}moveToPrevMatch(){return this._model?(this._model.moveToPrevMatch(),!0):!1}goToMatch(e){return this._model?(this._model.moveToMatch(e),!0):!1}replace(){return this._model?(this._model.replace(),!0):!1}replaceAll(){return this._model?this._editor.getModel()?.isTooLargeForHeapOperation()?(this._notificationService.warn(G(935,`The file is too large to perform a replace all operation.`)),!1):(this._model.replaceAll(),!0):!1}selectAllMatches(){return this._model?(this._model.selectAllMatches(),this._editor.focus(),!0):!1}async getGlobalBufferTerm(){return this._editor.getOption(50).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()?this._clipboardService.readFindText():``}setGlobalBufferTerm(e){this._editor.getOption(50).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()&&this._clipboardService.writeFindText(e)}};AC=DC=TC([EC(1,On),EC(2,Qr),EC(3,aa),EC(4,Ur),EC(5,Is)],AC);var jC=class extends AC{constructor(e,t,n,r,i,a,o,s){super(e,n,a,o,i,s),this._contextViewService=t,this._keybindingService=r,this._widget=null,this._findOptionsWidget=null,this._findWidgetSearchHistory=bC.getOrCreate(a),this._replaceWidgetHistory=wC.getOrCreate(a)}async _start(e,t){this._widget||this._createFindWidget();let n=this._editor.getSelection(),r=!1;switch(this._editor.getOption(50).autoFindInSelection){case`always`:r=!0;break;case`never`:r=!1;break;case`multiline`:r=!!n&&n.startLineNumber!==n.endLineNumber;break;default:break}e.updateSearchScope=e.updateSearchScope||r,await super._start(e,t),this._widget&&(e.shouldFocus===2?this._widget.focusReplaceInput():e.shouldFocus===1&&this._widget.focusFindInput())}highlightFindOptions(e=!1){this._widget||this._createFindWidget(),this._state.isRevealed&&!e?this._widget.highlightFindOptions():this._findOptionsWidget.highlightFindOptions()}_createFindWidget(){this._widget=this._register(new hC(this._editor,this,this._state,this._contextViewService,this._keybindingService,this._contextKeyService,this._hoverService,this._findWidgetSearchHistory,this._replaceWidgetHistory)),this._findOptionsWidget=this._register(new bS(this._editor,this._state,this._keybindingService))}saveViewState(){return this._widget?.getViewState()}restoreViewState(e){this._widget?.setViewState(e)}};jC=TC([EC(1,Ml),EC(2,On),EC(3,Yt),EC(4,Ur),EC(5,Qr),EC(6,aa),EC(7,Is)],jC),Qc(new Vo({id:gS.StartFindAction,label:U(942,`Find`),precondition:E.or(y.focus,E.has(`editorIsOpen`)),kbOpts:{kbExpr:null,primary:2084,weight:100},menuOpts:{menuId:S.MenubarEditMenu,group:`3_find`,title:G(936,`&&Find`),order:1}})).addImplementation(0,(e,t,n)=>{let r=AC.get(t);return r?r.start({forceRevealReplace:!1,seedSearchStringFromSelection:t.getOption(50).seedSearchStringFromSelection===`never`?`none`:`single`,seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:t.getOption(50).globalFindClipboard,shouldFocus:1,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}):!1});var MC={description:`Open a new In-Editor Find Widget.`,args:[{name:`Open a new In-Editor Find Widget args`,schema:{properties:{searchString:{type:`string`},replaceString:{type:`string`},isRegex:{type:`boolean`},matchWholeWord:{type:`boolean`},isCaseSensitive:{type:`boolean`},preserveCase:{type:`boolean`},findInSelection:{type:`boolean`}}}}]},NC=class extends R{constructor(){super({id:gS.StartFindWithArgs,label:U(943,`Find with Arguments`),precondition:void 0,kbOpts:{kbExpr:null,primary:0,weight:100},metadata:MC})}async run(e,t,n){let r=AC.get(t);if(r){let e=n?{searchString:n.searchString,replaceString:n.replaceString,isReplaceRevealed:n.replaceString!==void 0,isRegex:n.isRegex,wholeWord:n.matchWholeWord,matchCase:n.isCaseSensitive,preserveCase:n.preserveCase}:{};await r.start({forceRevealReplace:!1,seedSearchStringFromSelection:r.getState().searchString.length===0&&t.getOption(50).seedSearchStringFromSelection!==`never`?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:!0,shouldFocus:1,shouldAnimate:!0,updateSearchScope:n?.findInSelection||!1,loop:t.getOption(50).loop},e),r.setGlobalBufferTerm(r.getState().searchString)}}},PC=class extends R{constructor(){super({id:gS.StartFindWithSelection,label:U(944,`Find with Selection`),precondition:void 0,kbOpts:{kbExpr:null,primary:0,mac:{primary:2083},weight:100}})}async run(e,t){let n=AC.get(t);n&&(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:`multiple`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),n.setGlobalBufferTerm(n.getState().searchString))}},FC=class extends R{async run(e,t){let n=AC.get(t);n&&!this._run(n)&&(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:n.getState().searchString.length===0&&t.getOption(50).seedSearchStringFromSelection!==`never`?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:!0,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),this._run(n))}},IC=class extends FC{constructor(){super({id:gS.NextMatchFindAction,label:U(945,`Find Next`),precondition:void 0,kbOpts:[{kbExpr:y.focus,primary:61,mac:{primary:2085,secondary:[61]},weight:100},{kbExpr:E.and(y.focus,lS),primary:3,weight:100}]})}_run(e){return e.moveToNextMatch()?(e.editor.pushUndoStop(),!0):!1}},LC=class extends FC{constructor(){super({id:gS.PreviousMatchFindAction,label:U(946,`Find Previous`),precondition:void 0,kbOpts:[{kbExpr:y.focus,primary:1085,mac:{primary:3109,secondary:[1085]},weight:100},{kbExpr:E.and(y.focus,lS),primary:1027,weight:100}]})}_run(e){return e.moveToPrevMatch()}},RC=class extends R{constructor(){super({id:gS.GoToMatchFindAction,label:U(947,`Go to Match...`),precondition:cS}),this._highlightDecorations=[]}run(e,t,n){let r=AC.get(t);if(!r)return;let i=r.getState().matchesCount;if(i<1){e.get(Ur).notify({severity:hd.Warning,message:G(937,`No matches. Try searching for something else.`)});return}let a=e.get(Mu),o=new L,s=o.add(a.createInputBox());s.placeholder=G(938,`Type a number to go to a specific match (between 1 and {0})`,i);let c=e=>{let t=parseInt(e);if(isNaN(t))return;let n=r.getState().matchesCount;if(t>0&&t<=n)return t-1;if(t<0&&t>=-n)return n+t},l=e=>{let n=c(e);if(typeof n==`number`){s.validationMessage=void 0,r.goToMatch(n);let e=r.getState().currentMatch;e&&this.addDecorations(t,e)}else s.validationMessage=G(939,`Please type a number between 1 and {0}`,r.getState().matchesCount),this.clearDecorations(t)};o.add(s.onDidChangeValue(e=>{l(e)})),o.add(s.onDidAccept(()=>{let e=c(s.value);typeof e==`number`?(r.goToMatch(e),s.hide()):s.validationMessage=G(940,`Please type a number between 1 and {0}`,r.getState().matchesCount)})),o.add(s.onDidHide(()=>{this.clearDecorations(t),o.dispose()})),s.show()}clearDecorations(e){e.changeDecorations(e=>{this._highlightDecorations=e.deltaDecorations(this._highlightDecorations,[])})}addDecorations(e,t){e.changeDecorations(e=>{this._highlightDecorations=e.deltaDecorations(this._highlightDecorations,[{range:t,options:{description:`find-match-quick-access-range-highlight`,className:`rangeHighlight`,isWholeLine:!0}},{range:t,options:{description:`find-match-quick-access-range-highlight-overview`,overviewRuler:{color:Ta(an),position:vr.Full}}}])})}},zC=class extends R{async run(e,t){let n=AC.get(t);if(!n)return;let r=kC(t,`single`,!1);r&&n.setSearchString(r),this._run(n)||(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:`none`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop}),this._run(n))}},BC=class extends zC{constructor(){super({id:gS.NextSelectionMatchFindAction,label:U(948,`Find Next Selection`),precondition:void 0,kbOpts:{kbExpr:y.focus,primary:2109,weight:100}})}_run(e){return e.moveToNextMatch()}},VC=class extends zC{constructor(){super({id:gS.PreviousSelectionMatchFindAction,label:U(949,`Find Previous Selection`),precondition:void 0,kbOpts:{kbExpr:y.focus,primary:3133,weight:100}})}_run(e){return e.moveToPrevMatch()}};Qc(new Vo({id:gS.StartFindReplaceAction,label:U(950,`Replace`),precondition:E.or(y.focus,E.has(`editorIsOpen`)),kbOpts:{kbExpr:null,primary:2086,mac:{primary:2596},weight:100},menuOpts:{menuId:S.MenubarEditMenu,group:`3_find`,title:G(941,`&&Replace`),order:2}})).addImplementation(0,(e,t,n)=>{if(!t.hasModel()||t.getOption(104))return!1;let r=AC.get(t);if(!r)return!1;let i=t.getSelection(),a=r.isFindInputFocused(),o=!i.isEmpty()&&i.startLineNumber===i.endLineNumber&&t.getOption(50).seedSearchStringFromSelection!==`never`&&!a,s=a||o?2:1;return r.start({forceRevealReplace:!0,seedSearchStringFromSelection:o?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(50).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:t.getOption(50).seedSearchStringFromSelection!==`never`,shouldFocus:s,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(50).loop})}),K(AC.ID,jC,0),q(NC),q(PC),q(IC),q(LC),q(RC),q(BC),q(VC);var HC=Ar.bindToContribution(AC.get);W(new HC({id:gS.CloseFindWidgetCommand,precondition:cS,handler:e=>e.closeFindWidget(),kbOpts:{weight:105,kbExpr:E.and(y.focus,E.not(`isComposing`)),primary:9,secondary:[1033]}})),W(new HC({id:gS.ToggleCaseSensitiveCommand,precondition:void 0,handler:e=>e.toggleCaseSensitive(),kbOpts:{weight:105,kbExpr:y.focus,primary:dS.primary,mac:dS.mac,win:dS.win,linux:dS.linux}})),W(new HC({id:gS.ToggleWholeWordCommand,precondition:void 0,handler:e=>e.toggleWholeWords(),kbOpts:{weight:105,kbExpr:y.focus,primary:fS.primary,mac:fS.mac,win:fS.win,linux:fS.linux}})),W(new HC({id:gS.ToggleRegexCommand,precondition:void 0,handler:e=>e.toggleRegex(),kbOpts:{weight:105,kbExpr:y.focus,primary:pS.primary,mac:pS.mac,win:pS.win,linux:pS.linux}})),W(new HC({id:gS.ToggleSearchScopeCommand,precondition:void 0,handler:e=>e.toggleSearchScope(),kbOpts:{weight:105,kbExpr:y.focus,primary:mS.primary,mac:mS.mac,win:mS.win,linux:mS.linux}})),W(new HC({id:gS.TogglePreserveCaseCommand,precondition:void 0,handler:e=>e.togglePreserveCase(),kbOpts:{weight:105,kbExpr:y.focus,primary:hS.primary,mac:hS.mac,win:hS.win,linux:hS.linux}})),W(new HC({id:gS.ReplaceOneAction,precondition:cS,handler:e=>e.replace(),kbOpts:{weight:105,kbExpr:y.focus,primary:3094}})),W(new HC({id:gS.ReplaceOneAction,precondition:cS,handler:e=>e.replace(),kbOpts:{weight:105,kbExpr:E.and(y.focus,uS),primary:3}})),W(new HC({id:gS.ReplaceAllAction,precondition:cS,handler:e=>e.replaceAll(),kbOpts:{weight:105,kbExpr:y.focus,primary:2563}})),W(new HC({id:gS.ReplaceAllAction,precondition:cS,handler:e=>e.replaceAll(),kbOpts:{weight:105,kbExpr:E.and(y.focus,uS),primary:void 0,mac:{primary:2051}}})),W(new HC({id:gS.SelectAllMatchesAction,precondition:cS,handler:e=>e.selectAllMatches(),kbOpts:{weight:105,kbExpr:y.focus,primary:515}}));const UC={0:` `,1:`u`,2:`r`},WC=16777215;var GC=4278190080,KC=class{constructor(e){let t=Math.ceil(e/32);this._states=new Uint32Array(t)}get(e){let t=e/32|0,n=e%32;return(this._states[t]&1<<n)!=0}set(e,t){let n=e/32|0,r=e%32,i=this._states[n];t?this._states[n]=i|1<<r:this._states[n]=i&~(1<<r)}},qC=class e{constructor(e,t,n){if(e.length!==t.length||e.length>65535)throw Error(`invalid startIndexes or endIndexes size`);this._startIndexes=e,this._endIndexes=t,this._collapseStates=new KC(e.length),this._userDefinedStates=new KC(e.length),this._recoveredStates=new KC(e.length),this._types=n,this._parentsComputed=!1}ensureParentIndices(){if(!this._parentsComputed){this._parentsComputed=!0;let e=[],t=(t,n)=>{let r=e[e.length-1];return this.getStartLineNumber(r)<=t&&this.getEndLineNumber(r)>=n};for(let n=0,r=this._startIndexes.length;n<r;n++){let r=this._startIndexes[n],i=this._endIndexes[n];if(r>16777215||i>16777215)throw Error(`startLineNumber or endLineNumber must not exceed `+WC);for(;e.length>0&&!t(r,i);)e.pop();let a=e.length>0?e[e.length-1]:-1;e.push(n),this._startIndexes[n]=r+((a&255)<<24),this._endIndexes[n]=i+((a&65280)<<16)}}}get length(){return this._startIndexes.length}getStartLineNumber(e){return this._startIndexes[e]&WC}getEndLineNumber(e){return this._endIndexes[e]&WC}getType(e){return this._types?this._types[e]:void 0}hasTypes(){return!!this._types}isCollapsed(e){return this._collapseStates.get(e)}setCollapsed(e,t){this._collapseStates.set(e,t)}isUserDefined(e){return this._userDefinedStates.get(e)}setUserDefined(e,t){return this._userDefinedStates.set(e,t)}isRecovered(e){return this._recoveredStates.get(e)}setRecovered(e,t){return this._recoveredStates.set(e,t)}getSource(e){return this.isUserDefined(e)?1:this.isRecovered(e)?2:0}setSource(e,t){t===1?(this.setUserDefined(e,!0),this.setRecovered(e,!1)):t===2?(this.setUserDefined(e,!1),this.setRecovered(e,!0)):(this.setUserDefined(e,!1),this.setRecovered(e,!1))}setCollapsedAllOfType(e,t){let n=!1;if(this._types)for(let r=0;r<this._types.length;r++)this._types[r]===e&&(this.setCollapsed(r,t),n=!0);return n}toRegion(e){return new JC(this,e)}getParentIndex(e){this.ensureParentIndices();let t=((this._startIndexes[e]&GC)>>>24)+((this._endIndexes[e]&GC)>>>16);return t===65535?-1:t}contains(e,t){return this.getStartLineNumber(e)<=t&&this.getEndLineNumber(e)>=t}findIndex(e){let t=0,n=this._startIndexes.length;if(n===0)return-1;for(;t<n;){let r=Math.floor((t+n)/2);e<this.getStartLineNumber(r)?n=r:t=r+1}return t-1}findRange(e){let t=this.findIndex(e);if(t>=0){if(this.getEndLineNumber(t)>=e)return t;for(t=this.getParentIndex(t);t!==-1;){if(this.contains(t,e))return t;t=this.getParentIndex(t)}}return-1}toString(){let e=[];for(let t=0;t<this.length;t++)e[t]=`[${UC[this.getSource(t)]}${this.isCollapsed(t)?`+`:`-`}] ${this.getStartLineNumber(t)}/${this.getEndLineNumber(t)}`;return e.join(`, `)}toFoldRange(e){return{startLineNumber:this._startIndexes[e]&WC,endLineNumber:this._endIndexes[e]&WC,type:this._types?this._types[e]:void 0,isCollapsed:this.isCollapsed(e),source:this.getSource(e)}}static fromFoldRanges(t){let n=t.length,r=new Uint32Array(n),i=new Uint32Array(n),a=[],o=!1;for(let e=0;e<n;e++){let n=t[e];r[e]=n.startLineNumber,i[e]=n.endLineNumber,a.push(n.type),n.type&&(o=!0)}o||(a=void 0);let s=new e(r,i,a);for(let e=0;e<n;e++)t[e].isCollapsed&&s.setCollapsed(e,!0),s.setSource(e,t[e].source);return s}static sanitizeAndMerge(e,t,n,r){n??=Number.MAX_VALUE;let i=(e,t)=>Array.isArray(e)?(n=>n<t?e[n]:void 0):(n=>n<t?e.toFoldRange(n):void 0),a=i(e,e.length),o=i(t,t.length),s=0,c=0,l=a(0),u=o(0),d=[],f,p=0,m=[];for(;l||u;){let e;if(u&&(!l||l.startLineNumber>=u.startLineNumber))l&&l.startLineNumber===u.startLineNumber?(u.source===1?e=u:(e=l,e.isCollapsed=u.isCollapsed&&(l.endLineNumber===u.endLineNumber||!r?.startsInside(l.startLineNumber+1,l.endLineNumber+1)),e.source=0),l=a(++s)):(e=u,u.isCollapsed&&u.source===0&&(e.source=2)),u=o(++c);else{let t=c,n=u;for(;;){if(!n||n.startLineNumber>l.endLineNumber){e=l;break}if(n.source===1&&n.endLineNumber>l.endLineNumber)break;n=o(++t)}l=a(++s)}if(e){for(;f&&f.endLineNumber<e.startLineNumber;)f=d.pop();e.endLineNumber>e.startLineNumber&&e.startLineNumber>p&&e.endLineNumber<=n&&(!f||f.endLineNumber>=e.endLineNumber)&&(m.push(e),p=e.startLineNumber,f&&d.push(f),f=e)}}return m}},JC=class{constructor(e,t){this.ranges=e,this.index=t}get startLineNumber(){return this.ranges.getStartLineNumber(this.index)}get endLineNumber(){return this.ranges.getEndLineNumber(this.index)}get regionIndex(){return this.index}get parentIndex(){return this.ranges.getParentIndex(this.index)}get isCollapsed(){return this.ranges.isCollapsed(this.index)}containedBy(e){return e.startLineNumber<=this.startLineNumber&&e.endLineNumber>=this.endLineNumber}containsLine(e){return this.startLineNumber<=e&&e<=this.endLineNumber}},YC=class{get regions(){return this._regions}get textModel(){return this._textModel}constructor(e,t){this._updateEventEmitter=new D,this.onDidChange=this._updateEventEmitter.event,this._textModel=e,this._decorationProvider=t,this._regions=new qC(new Uint32Array,new Uint32Array),this._editorDecorationIds=[]}toggleCollapseState(e){if(!e.length)return;e=e.sort((e,t)=>e.regionIndex-t.regionIndex);let t={};this._decorationProvider.changeDecorations(n=>{let r=0,i=-1,a=-1,o=e=>{for(;r<e;){let e=this._regions.getEndLineNumber(r),t=this._regions.isCollapsed(r);if(e<=i){let i=this.regions.getSource(r)!==0;n.changeDecorationOptions(this._editorDecorationIds[r],this._decorationProvider.getDecorationOption(t,e<=a,i))}t&&e>a&&(a=e),r++}};for(let n of e){let e=n.regionIndex,r=this._editorDecorationIds[e];if(r&&!t[r]){t[r]=!0,o(e);let n=!this._regions.isCollapsed(e);this._regions.setCollapsed(e,n),i=Math.max(i,this._regions.getEndLineNumber(e))}}o(this._regions.length)}),this._updateEventEmitter.fire({model:this,collapseStateChanged:e})}removeManualRanges(e){let t=[],n=t=>{for(let n of e)if(!(n.startLineNumber>t.endLineNumber||t.startLineNumber>n.endLineNumber))return!0;return!1};for(let e=0;e<this._regions.length;e++){let r=this._regions.toFoldRange(e);(r.source===0||!n(r))&&t.push(r)}this.updatePost(qC.fromFoldRanges(t))}update(e,t){let n=this._currentFoldedOrManualRanges(t),r=qC.sanitizeAndMerge(e,n,this._textModel.getLineCount(),t);this.updatePost(qC.fromFoldRanges(r))}updatePost(e){let t=[],n=-1;for(let r=0,i=e.length;r<i;r++){let i=e.getStartLineNumber(r),a=e.getEndLineNumber(r),o=e.isCollapsed(r),s=e.getSource(r)!==0,c={startLineNumber:i,startColumn:this._textModel.getLineMaxColumn(i),endLineNumber:a,endColumn:this._textModel.getLineMaxColumn(a)+1};t.push({range:c,options:this._decorationProvider.getDecorationOption(o,a<=n,s)}),o&&a>n&&(n=a)}this._decorationProvider.changeDecorations(e=>this._editorDecorationIds=e.deltaDecorations(this._editorDecorationIds,t)),this._regions=e,this._updateEventEmitter.fire({model:this})}_currentFoldedOrManualRanges(e){let t=[];for(let n=0,r=this._regions.length;n<r;n++){let r=this.regions.isCollapsed(n),i=this.regions.getSource(n);if(r||i!==0){let a=this._regions.toFoldRange(n),o=this._textModel.getDecorationRange(this._editorDecorationIds[n]);o&&(r&&e?.startsInside(o.startLineNumber+1,o.endLineNumber)&&(r=!1),t.push({startLineNumber:o.startLineNumber,endLineNumber:o.endLineNumber,type:a.type,isCollapsed:r,source:i}))}}return t}getMemento(){let e=this._currentFoldedOrManualRanges(),t=[],n=this._textModel.getLineCount();for(let r=0,i=e.length;r<i;r++){let i=e[r];if(i.startLineNumber>=i.endLineNumber||i.startLineNumber<1||i.endLineNumber>n)continue;let a=this._getLinesChecksum(i.startLineNumber+1,i.endLineNumber);t.push({startLineNumber:i.startLineNumber,endLineNumber:i.endLineNumber,isCollapsed:i.isCollapsed,source:i.source,checksum:a})}return t.length>0?t:void 0}applyMemento(e){if(!Array.isArray(e))return;let t=[],n=this._textModel.getLineCount();for(let r of e){if(r.startLineNumber>=r.endLineNumber||r.startLineNumber<1||r.endLineNumber>n)continue;let e=this._getLinesChecksum(r.startLineNumber+1,r.endLineNumber);(!r.checksum||e===r.checksum)&&t.push({startLineNumber:r.startLineNumber,endLineNumber:r.endLineNumber,type:void 0,isCollapsed:r.isCollapsed??!0,source:r.source??0})}let r=qC.sanitizeAndMerge(this._regions,t,n);this.updatePost(qC.fromFoldRanges(r))}_getLinesChecksum(e,t){return Tc(this._textModel.getLineContent(e)+this._textModel.getLineContent(t))%1e6}dispose(){this._decorationProvider.removeDecorations(this._editorDecorationIds)}getAllRegionsAtLine(e,t){let n=[];if(this._regions){let r=this._regions.findRange(e),i=1;for(;r>=0;){let e=this._regions.toRegion(r);(!t||t(e,i))&&n.push(e),i++,r=e.parentIndex}}return n}getRegionAtLine(e){if(this._regions){let t=this._regions.findRange(e);if(t>=0)return this._regions.toRegion(t)}return null}getRegionsInside(e,t){let n=[],r=e?e.regionIndex+1:0,i=e?e.endLineNumber:Number.MAX_VALUE;if(t&&t.length===2){let e=[];for(let a=r,o=this._regions.length;a<o;a++){let r=this._regions.toRegion(a);if(this._regions.getStartLineNumber(a)<i){for(;e.length>0&&!r.containedBy(e[e.length-1]);)e.pop();e.push(r),t(r,e.length)&&n.push(r)}else break}}else for(let e=r,a=this._regions.length;e<a;e++){let r=this._regions.toRegion(e);if(this._regions.getStartLineNumber(e)<i)(!t||t(r))&&n.push(r);else break}return n}};function XC(e,t,n){let r=[];for(let i of n){let n=e.getRegionAtLine(i);if(n){let i=!n.isCollapsed;if(r.push(n),t>1){let a=e.getRegionsInside(n,(e,n)=>e.isCollapsed!==i&&n<t);r.push(...a)}}}e.toggleCollapseState(r)}function ZC(e,t,n=Number.MAX_VALUE,r){let i=[];if(r&&r.length>0)for(let a of r){let r=e.getRegionAtLine(a);if(r&&(r.isCollapsed!==t&&i.push(r),n>1)){let a=e.getRegionsInside(r,(e,r)=>e.isCollapsed!==t&&r<n);i.push(...a)}}else{let r=e.getRegionsInside(null,(e,r)=>e.isCollapsed!==t&&r<n);i.push(...r)}e.toggleCollapseState(i)}function QC(e,t,n,r){let i=[];for(let a of r){let r=e.getAllRegionsAtLine(a,(e,r)=>e.isCollapsed!==t&&r<=n);i.push(...r)}e.toggleCollapseState(i)}function $C(e,t,n){let r=[];for(let i of n){let n=e.getAllRegionsAtLine(i,e=>e.isCollapsed!==t);n.length>0&&r.push(n[0])}e.toggleCollapseState(r)}function ew(e,t,n,r){let i=e.getRegionsInside(null,(e,i)=>i===t&&e.isCollapsed!==n&&!r.some(t=>e.containsLine(t)));e.toggleCollapseState(i)}function tw(e,t,n){let r=[];for(let t of n){let n=e.getAllRegionsAtLine(t,void 0);n.length>0&&r.push(n[0])}let i=e.getRegionsInside(null,e=>r.every(t=>!t.containedBy(e)&&!e.containedBy(t))&&e.isCollapsed!==t);e.toggleCollapseState(i)}function nw(e,t,n){let r=e.textModel,i=e.regions,a=[];for(let e=i.length-1;e>=0;e--)if(n!==i.isCollapsed(e)){let n=i.getStartLineNumber(e);t.test(r.getLineContent(n))&&a.push(i.toRegion(e))}e.toggleCollapseState(a)}function rw(e,t,n){let r=e.regions,i=[];for(let e=r.length-1;e>=0;e--)n!==r.isCollapsed(e)&&t===r.getType(e)&&i.push(r.toRegion(e));e.toggleCollapseState(i)}function iw(e,t){let n=null,r=t.getRegionAtLine(e);if(r!==null&&(n=r.startLineNumber,e===n)){let e=r.parentIndex;n=e===-1?null:t.regions.getStartLineNumber(e)}return n}function aw(e,t){let n=t.getRegionAtLine(e);if(n!==null&&n.startLineNumber===e){if(e!==n.startLineNumber)return n.startLineNumber;{let e=n.parentIndex,r=0;for(e!==-1&&(r=t.regions.getStartLineNumber(n.parentIndex));n!==null;)if(n.regionIndex>0){if(n=t.regions.toRegion(n.regionIndex-1),n.startLineNumber<=r)return null;if(n.parentIndex===e)return n.startLineNumber}else return null}}else if(t.regions.length>0)for(n=t.regions.toRegion(t.regions.length-1);n!==null;){if(n.startLineNumber<e)return n.startLineNumber;n=n.regionIndex>0?t.regions.toRegion(n.regionIndex-1):null}return null}function ow(e,t){let n=t.getRegionAtLine(e);if(n!==null&&n.startLineNumber===e){let e=n.parentIndex,r=0;if(e!==-1)r=t.regions.getEndLineNumber(n.parentIndex);else if(t.regions.length===0)return null;else r=t.regions.getEndLineNumber(t.regions.length-1);for(;n!==null;)if(n.regionIndex<t.regions.length){if(n=t.regions.toRegion(n.regionIndex+1),n.startLineNumber>=r)return null;if(n.parentIndex===e)return n.startLineNumber}else return null}else if(t.regions.length>0)for(n=t.regions.toRegion(0);n!==null;){if(n.startLineNumber>e)return n.startLineNumber;n=n.regionIndex<t.regions.length?t.regions.toRegion(n.regionIndex+1):null}return null}var sw=class{get onDidChange(){return this._updateEventEmitter.event}get hiddenRanges(){return this._hiddenRanges}constructor(e){this._updateEventEmitter=new D,this._hasLineChanges=!1,this._foldingModel=e,this._foldingModelListener=e.onDidChange(e=>this.updateHiddenRanges()),this._hiddenRanges=[],e.regions.length&&this.updateHiddenRanges()}notifyChangeModelContent(e){this._hiddenRanges.length&&!this._hasLineChanges&&(this._hasLineChanges=e.changes.some(e=>e.range.endLineNumber!==e.range.startLineNumber||Js(e.text)[0]!==0))}updateHiddenRanges(){let e=!1,t=[],n=0,r=0,i=Number.MAX_VALUE,a=-1,o=this._foldingModel.regions;for(;n<o.length;n++){if(!o.isCollapsed(n))continue;let s=o.getStartLineNumber(n)+1,c=o.getEndLineNumber(n);i<=s&&c<=a||(!e&&r<this._hiddenRanges.length&&this._hiddenRanges[r].startLineNumber===s&&this._hiddenRanges[r].endLineNumber===c?(t.push(this._hiddenRanges[r]),r++):(e=!0,t.push(new T(s,1,c,1))),i=s,a=c)}(this._hasLineChanges||e||r<this._hiddenRanges.length)&&this.applyHiddenRanges(t)}applyHiddenRanges(e){this._hiddenRanges=e,this._hasLineChanges=!1,this._updateEventEmitter.fire(e)}hasRanges(){return this._hiddenRanges.length>0}isHidden(e){return lw(this._hiddenRanges,e)!==null}adjustSelections(e){let t=!1,n=this._foldingModel.textModel,r=null,i=e=>((!r||!cw(e,r))&&(r=lw(this._hiddenRanges,e)),r?r.startLineNumber-1:null);for(let r=0,a=e.length;r<a;r++){let a=e[r],o=i(a.startLineNumber);o&&(a=a.setStartPosition(o,n.getLineMaxColumn(o)),t=!0);let s=i(a.endLineNumber);s&&(a=a.setEndPosition(s,n.getLineMaxColumn(s)),t=!0),e[r]=a}return t}dispose(){this.hiddenRanges.length>0&&(this._hiddenRanges=[],this._updateEventEmitter.fire(this._hiddenRanges)),this._foldingModelListener&&=(this._foldingModelListener.dispose(),null)}};function cw(e,t){return e>=t.startLineNumber&&e<=t.endLineNumber}function lw(e,t){let n=Pe(e,e=>t<e.startLineNumber)-1;return n>=0&&e[n].endLineNumber>=t?e[n]:null}var uw=5e3,dw=`indent`,fw=class{constructor(e,t,n){this.editorModel=e,this.languageConfigurationService=t,this.foldingRangesLimit=n,this.id=dw}dispose(){}compute(e){let t=this.languageConfigurationService.getLanguageConfiguration(this.editorModel.getLanguageId()).foldingRules,n=t&&!!t.offSide,r=t&&t.markers;return Promise.resolve(hw(this.editorModel,n,r,this.foldingRangesLimit))}},pw=class{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,n){if(e>16777215||t>16777215)return;let r=this._length;this._startIndexes[r]=e,this._endIndexes[r]=t,this._length++,n<1e3&&(this._indentOccurrences[n]=(this._indentOccurrences[n]||0)+1)}toIndentRanges(e){let t=this._foldingRangesLimit.limit;if(this._length<=t){this._foldingRangesLimit.update(this._length,!1);let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let n=this._length-1,r=0;n>=0;n--,r++)e[r]=this._startIndexes[n],t[r]=this._endIndexes[n];return new qC(e,t)}else{this._foldingRangesLimit.update(this._length,t);let n=0,r=this._indentOccurrences.length;for(let e=0;e<this._indentOccurrences.length;e++){let i=this._indentOccurrences[e];if(i){if(i+n>t){r=e;break}n+=i}}let i=e.getOptions().tabSize,a=new Uint32Array(t),o=new Uint32Array(t);for(let s=this._length-1,c=0;s>=0;s--){let l=this._startIndexes[s],u=e.getLineContent(l),d=gn(u,i);(d<r||d===r&&n++<t)&&(a[c]=l,o[c]=this._endIndexes[s],c++)}return new qC(a,o)}}},mw={limit:uw,update:()=>{}};function hw(e,t,n,r=mw){let i=e.getOptions().tabSize,a=new pw(r),o;n&&(o=RegExp(`(${n.start.source})|(?:${n.end.source})`));let s=[],c=e.getLineCount()+1;s.push({indent:-1,endAbove:c,line:c});for(let n=e.getLineCount();n>0;n--){let r=e.getLineContent(n),c=gn(r,i),l=s[s.length-1];if(c===-1){t&&(l.endAbove=n);continue}let u;if(o&&(u=r.match(o)))if(u[1]){let e=s.length-1;for(;e>0&&s[e].indent!==-2;)e--;if(e>0){s.length=e+1,l=s[e],a.insertFirst(n,l.line,c),l.line=n,l.indent=c,l.endAbove=n;continue}}else{s.push({indent:-2,endAbove:n,line:n});continue}if(l.indent>c){do s.pop(),l=s[s.length-1];while(l.indent>c);let e=l.endAbove-1;e-n>=1&&a.insertFirst(n,e,c)}l.indent===c?l.endAbove=n:s.push({indent:c,endAbove:n,line:n})}return a.toIndentRanges(e)}var gw=F(`editor.foldBackground`,{light:At(Ru,.3),dark:At(Ru,.3),hcDark:null,hcLight:null},G(997,`Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations.`),!0);F(`editor.foldPlaceholderForeground`,{light:`#808080`,dark:`#808080`,hcDark:null,hcLight:null},G(998,`Color of the collapsed text after the first line of a folded range.`)),F(`editorGutter.foldingControlForeground`,Ht,G(999,`Color of the folding control in the editor gutter.`));const _w=nu(`folding-expanded`,X.chevronDown,G(1e3,`Icon for expanded ranges in the editor glyph margin.`)),vw=nu(`folding-collapsed`,X.chevronRight,G(1001,`Icon for collapsed ranges in the editor glyph margin.`)),yw=nu(`folding-manual-collapsed`,vw,G(1002,`Icon for manually collapsed ranges in the editor glyph margin.`)),bw=nu(`folding-manual-expanded`,_w,G(1003,`Icon for manually expanded ranges in the editor glyph margin.`));var xw={color:Ta(gw),position:1},Sw=G(1004,`Click to expand the range.`),Cw=G(1005,`Click to collapse the range.`),ww=class e{static{this.COLLAPSED_VISUAL_DECORATION=Y.register({description:`folding-collapsed-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:Sw,firstLineDecorationClassName:I.asClassName(vw)})}static{this.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=Y.register({description:`folding-collapsed-highlighted-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:xw,isWholeLine:!0,linesDecorationsTooltip:Sw,firstLineDecorationClassName:I.asClassName(vw)})}static{this.MANUALLY_COLLAPSED_VISUAL_DECORATION=Y.register({description:`folding-manually-collapsed-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:Sw,firstLineDecorationClassName:I.asClassName(yw)})}static{this.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=Y.register({description:`folding-manually-collapsed-highlighted-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:xw,isWholeLine:!0,linesDecorationsTooltip:Sw,firstLineDecorationClassName:I.asClassName(yw)})}static{this.NO_CONTROLS_COLLAPSED_RANGE_DECORATION=Y.register({description:`folding-no-controls-range-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:Sw})}static{this.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION=Y.register({description:`folding-no-controls-range-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:xw,isWholeLine:!0,linesDecorationsTooltip:Sw})}static{this.EXPANDED_VISUAL_DECORATION=Y.register({description:`folding-expanded-visual-decoration`,stickiness:1,isWholeLine:!0,firstLineDecorationClassName:`alwaysShowFoldIcons `+I.asClassName(_w),linesDecorationsTooltip:Cw})}static{this.EXPANDED_AUTO_HIDE_VISUAL_DECORATION=Y.register({description:`folding-expanded-auto-hide-visual-decoration`,stickiness:1,isWholeLine:!0,firstLineDecorationClassName:I.asClassName(_w),linesDecorationsTooltip:Cw})}static{this.MANUALLY_EXPANDED_VISUAL_DECORATION=Y.register({description:`folding-manually-expanded-visual-decoration`,stickiness:0,isWholeLine:!0,firstLineDecorationClassName:`alwaysShowFoldIcons `+I.asClassName(bw),linesDecorationsTooltip:Cw})}static{this.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION=Y.register({description:`folding-manually-expanded-auto-hide-visual-decoration`,stickiness:0,isWholeLine:!0,firstLineDecorationClassName:I.asClassName(bw),linesDecorationsTooltip:Cw})}static{this.NO_CONTROLS_EXPANDED_RANGE_DECORATION=Y.register({description:`folding-no-controls-range-decoration`,stickiness:0,isWholeLine:!0})}static{this.HIDDEN_RANGE_DECORATION=Y.register({description:`folding-hidden-range-decoration`,stickiness:1})}constructor(e){this.editor=e,this.showFoldingControls=`mouseover`,this.showFoldingHighlights=!0}getDecorationOption(t,n,r){return n?e.HIDDEN_RANGE_DECORATION:this.showFoldingControls===`never`?t?this.showFoldingHighlights?e.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION:e.NO_CONTROLS_COLLAPSED_RANGE_DECORATION:e.NO_CONTROLS_EXPANDED_RANGE_DECORATION:t?r?this.showFoldingHighlights?e.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:e.MANUALLY_COLLAPSED_VISUAL_DECORATION:this.showFoldingHighlights?e.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:e.COLLAPSED_VISUAL_DECORATION:this.showFoldingControls===`mouseover`?r?e.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION:e.EXPANDED_AUTO_HIDE_VISUAL_DECORATION:r?e.MANUALLY_EXPANDED_VISUAL_DECORATION:e.EXPANDED_VISUAL_DECORATION}changeDecorations(e){return this.editor.changeDecorations(e)}removeDecorations(e){this.editor.removeDecorations(e)}},Tw={},Ew=`syntax`,Dw=class{constructor(e,t,n,r,i){this.editorModel=e,this.providers=t,this.handleFoldingRangesChange=n,this.foldingRangesLimit=r,this.fallbackRangeProvider=i,this.id=Ew,this.disposables=new L,i&&this.disposables.add(i);for(let e of t)typeof e.onDidChange==`function`&&this.disposables.add(e.onDidChange(n))}compute(e){return Ow(this.providers,this.editorModel,e).then(t=>this.editorModel.isDisposed()?null:t?Aw(t,this.foldingRangesLimit):this.fallbackRangeProvider?.compute(e)??null)}dispose(){this.disposables.dispose()}};function Ow(e,t,n){let r=null,i=e.map((e,i)=>Promise.resolve(e.provideFoldingRanges(t,Tw,n)).then(e=>{if(!n.isCancellationRequested&&Array.isArray(e)){Array.isArray(r)||(r=[]);let n=t.getLineCount();for(let t of e)t.start>0&&t.end>t.start&&t.end<=n&&r.push({start:t.start,end:t.end,rank:i,kind:t.kind})}},ct));return Promise.all(i).then(e=>r)}var kw=class{constructor(e){this._startIndexes=[],this._endIndexes=[],this._nestingLevels=[],this._nestingLevelCounts=[],this._types=[],this._length=0,this._foldingRangesLimit=e}add(e,t,n,r){if(e>16777215||t>16777215)return;let i=this._length;this._startIndexes[i]=e,this._endIndexes[i]=t,this._nestingLevels[i]=r,this._types[i]=n,this._length++,r<30&&(this._nestingLevelCounts[r]=(this._nestingLevelCounts[r]||0)+1)}toIndentRanges(){let e=this._foldingRangesLimit.limit;if(this._length<=e){this._foldingRangesLimit.update(this._length,!1);let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let n=0;n<this._length;n++)e[n]=this._startIndexes[n],t[n]=this._endIndexes[n];return new qC(e,t,this._types)}else{this._foldingRangesLimit.update(this._length,e);let t=0,n=this._nestingLevelCounts.length;for(let r=0;r<this._nestingLevelCounts.length;r++){let i=this._nestingLevelCounts[r];if(i){if(i+t>e){n=r;break}t+=i}}let r=new Uint32Array(e),i=new Uint32Array(e),a=[];for(let o=0,s=0;o<this._length;o++){let c=this._nestingLevels[o];(c<n||c===n&&t++<e)&&(r[s]=this._startIndexes[o],i[s]=this._endIndexes[o],a[s]=this._types[o],s++)}return new qC(r,i,a)}}};function Aw(e,t){let n=e.sort((e,t)=>{let n=e.start-t.start;return n===0&&(n=e.rank-t.rank),n}),r=new kw(t),i,a=[];for(let e of n)if(!i)i=e,r.add(e.start,e.end,e.kind&&e.kind.value,a.length);else if(e.start>i.start)if(e.end<=i.end)a.push(i),i=e,r.add(e.start,e.end,e.kind&&e.kind.value,a.length);else{if(e.start>i.end){do i=a.pop();while(i&&e.start>i.end);i&&a.push(i),i=e}r.add(e.start,e.end,e.kind&&e.kind.value,a.length)}return r.toIndentRanges()}var jw=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Mw=function(e,t){return function(n,r){t(n,r,e)}},Nw,Pw=new N(`foldingEnabled`,!1),Fw=class extends x{static{Nw=this}static{this.ID=`editor.contrib.folding`}static get(e){return e.getContribution(Nw.ID)}static getFoldingRangeProviders(e,t){let n=e.foldingRangeProvider.ordered(t);return Nw._foldingRangeSelector?.(n,t)??n}constructor(e,t,n,r,i,a){super(),this.contextKeyService=t,this.languageConfigurationService=n,this.languageFeaturesService=a,this.localToDispose=this._register(new L),this.editor=e,this._foldingLimitReporter=this._register(new Iw(e));let o=this.editor.getOptions();this._isEnabled=o.get(52),this._useFoldingProviders=o.get(53)!==`indentation`,this._unfoldOnClickAfterEndOfLine=o.get(57),this._restoringViewState=!1,this._currentModelHasFoldedImports=!1,this._foldingImportsByDefault=o.get(55),this.updateDebounceInfo=i.for(a.foldingRangeProvider,`Folding`,{min:200}),this.foldingModel=null,this.hiddenRangeModel=null,this.rangeProvider=null,this.foldingRegionPromise=null,this.foldingModelPromise=null,this.updateScheduler=null,this.cursorChangedScheduler=null,this.mouseDownInfo=null,this.foldingDecorationProvider=new ww(e),this.foldingDecorationProvider.showFoldingControls=o.get(126),this.foldingDecorationProvider.showFoldingHighlights=o.get(54),this.foldingEnabled=Pw.bindTo(this.contextKeyService),this.foldingEnabled.set(this._isEnabled),this._register(this.editor.onDidChangeModel(()=>this.onModelChanged())),this._register(this.editor.onDidChangeConfiguration(e=>{if(e.hasChanged(52)&&(this._isEnabled=this.editor.getOptions().get(52),this.foldingEnabled.set(this._isEnabled),this.onModelChanged()),e.hasChanged(56)&&this.onModelChanged(),e.hasChanged(126)||e.hasChanged(54)){let e=this.editor.getOptions();this.foldingDecorationProvider.showFoldingControls=e.get(126),this.foldingDecorationProvider.showFoldingHighlights=e.get(54),this.triggerFoldingModelChanged()}e.hasChanged(53)&&(this._useFoldingProviders=this.editor.getOptions().get(53)!==`indentation`,this.onFoldingStrategyChanged()),e.hasChanged(57)&&(this._unfoldOnClickAfterEndOfLine=this.editor.getOptions().get(57)),e.hasChanged(55)&&(this._foldingImportsByDefault=this.editor.getOptions().get(55))})),this.onModelChanged()}saveViewState(){let e=this.editor.getModel();if(!e||!this._isEnabled||e.isTooLargeForTokenization())return{};if(this.foldingModel){let t=this.foldingModel.getMemento(),n=this.rangeProvider?this.rangeProvider.id:void 0;return{collapsedRegions:t,lineCount:e.getLineCount(),provider:n,foldedImports:this._currentModelHasFoldedImports}}}restoreViewState(e){let t=this.editor.getModel();if(!(!t||!this._isEnabled||t.isTooLargeForTokenization()||!this.hiddenRangeModel)&&e&&(this._currentModelHasFoldedImports=!!e.foldedImports,e.collapsedRegions&&e.collapsedRegions.length>0&&this.foldingModel)){this._restoringViewState=!0;try{this.foldingModel.applyMemento(e.collapsedRegions)}finally{this._restoringViewState=!1}}}onModelChanged(){this.localToDispose.clear();let e=this.editor.getModel();!this._isEnabled||!e||e.isTooLargeForTokenization()||(this._currentModelHasFoldedImports=!1,this.foldingModel=new YC(e,this.foldingDecorationProvider),this.localToDispose.add(this.foldingModel),this.hiddenRangeModel=new sw(this.foldingModel),this.localToDispose.add(this.hiddenRangeModel),this.localToDispose.add(this.hiddenRangeModel.onDidChange(e=>this.onHiddenRangesChanges(e))),this.updateScheduler=new Hu(this.updateDebounceInfo.get(e)),this.localToDispose.add(this.updateScheduler),this.cursorChangedScheduler=new Zr(()=>this.revealCursor(),200),this.localToDispose.add(this.cursorChangedScheduler),this.localToDispose.add(this.languageFeaturesService.foldingRangeProvider.onDidChange(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelContent(e=>this.onDidChangeModelContent(e))),this.localToDispose.add(this.editor.onDidChangeCursorPosition(()=>this.onCursorPositionChanged())),this.localToDispose.add(this.editor.onMouseDown(e=>this.onEditorMouseDown(e))),this.localToDispose.add(this.editor.onMouseUp(e=>this.onEditorMouseUp(e))),this.localToDispose.add({dispose:()=>{this.foldingRegionPromise&&=(this.foldingRegionPromise.cancel(),null),this.updateScheduler?.cancel(),this.updateScheduler=null,this.foldingModel=null,this.foldingModelPromise=null,this.hiddenRangeModel=null,this.cursorChangedScheduler=null,this.rangeProvider?.dispose(),this.rangeProvider=null}}),this.triggerFoldingModelChanged())}onFoldingStrategyChanged(){this.rangeProvider?.dispose(),this.rangeProvider=null,this.triggerFoldingModelChanged()}getRangeProvider(e){if(this.rangeProvider)return this.rangeProvider;let t=new fw(e,this.languageConfigurationService,this._foldingLimitReporter);if(this.rangeProvider=t,this._useFoldingProviders&&this.foldingModel){let n=Nw.getFoldingRangeProviders(this.languageFeaturesService,e);n.length>0&&(this.rangeProvider=new Dw(e,n,()=>this.triggerFoldingModelChanged(),this._foldingLimitReporter,t))}return this.rangeProvider}getFoldingModel(){return this.foldingModelPromise}onDidChangeModelContent(e){this.hiddenRangeModel?.notifyChangeModelContent(e),this.triggerFoldingModelChanged()}triggerFoldingModelChanged(){this.updateScheduler&&(this.foldingRegionPromise&&=(this.foldingRegionPromise.cancel(),null),this.foldingModelPromise=this.updateScheduler.trigger(()=>{let e=this.foldingModel;if(!e)return null;let t=new vd,n=this.getRangeProvider(e.textModel),r=this.foldingRegionPromise=li(e=>n.compute(e));return r.then(n=>{if(n&&r===this.foldingRegionPromise){let r;if(this._foldingImportsByDefault&&!this._currentModelHasFoldedImports){let e=n.setCollapsedAllOfType(bc.Imports.value,!0);e&&(r=sd.capture(this.editor),this._currentModelHasFoldedImports=e)}let i=this.editor.getSelections();e.update(n,Rw(i)),r?.restore(this.editor);let a=this.updateDebounceInfo.update(e.textModel,t.elapsed());this.updateScheduler&&(this.updateScheduler.defaultDelay=a)}return e})}).then(void 0,e=>(mr(e),null)))}onHiddenRangesChanges(e){if(this.hiddenRangeModel&&e.length&&!this._restoringViewState){let e=this.editor.getSelections();e&&this.hiddenRangeModel.adjustSelections(e)&&this.editor.setSelections(e)}this.editor.setHiddenAreas(e,this)}onCursorPositionChanged(){this.hiddenRangeModel&&this.hiddenRangeModel.hasRanges()&&this.cursorChangedScheduler.schedule()}revealCursor(){let e=this.getFoldingModel();e&&e.then(e=>{if(e){let t=this.editor.getSelections();if(t&&t.length>0){let n=[];for(let r of t){let t=r.selectionStartLineNumber;this.hiddenRangeModel&&this.hiddenRangeModel.isHidden(t)&&n.push(...e.getAllRegionsAtLine(t,e=>e.isCollapsed&&t>e.startLineNumber))}n.length&&(e.toggleCollapseState(n),this.reveal(t[0].getPosition()))}}}).then(void 0,mr)}onEditorMouseDown(e){if(this.mouseDownInfo=null,!this.hiddenRangeModel||!e.target||!e.target.range||!e.event.leftButton&&!e.event.middleButton)return;let t=e.target.range,n=!1;switch(e.target.type){case 4:{let t=e.target.detail,r=e.target.element.offsetLeft;if(t.offsetX-r<4)return;n=!0;break}case 7:if(this._unfoldOnClickAfterEndOfLine&&this.hiddenRangeModel.hasRanges()&&!e.target.detail.isAfterLines)break;return;case 6:if(this.hiddenRangeModel.hasRanges()){let e=this.editor.getModel();if(e&&t.startColumn===e.getLineMaxColumn(t.startLineNumber))break}return;default:return}this.mouseDownInfo={lineNumber:t.startLineNumber,iconClicked:n}}onEditorMouseUp(e){let t=this.foldingModel;if(!t||!this.mouseDownInfo||!e.target)return;let n=this.mouseDownInfo.lineNumber,r=this.mouseDownInfo.iconClicked,i=e.target.range;if(!i||i.startLineNumber!==n)return;if(r){if(e.target.type!==4)return}else{let e=this.editor.getModel();if(!e||i.startColumn!==e.getLineMaxColumn(n))return}let a=t.getRegionAtLine(n);if(a&&a.startLineNumber===n){let i=a.isCollapsed;if(r||i){let r=e.event.altKey,o=[];if(r){let e=t.getRegionsInside(null,e=>!e.containedBy(a)&&!a.containedBy(e));for(let t of e)t.isCollapsed&&o.push(t);o.length===0&&(o=e)}else{let n=e.event.middleButton||e.event.shiftKey;if(n)for(let e of t.getRegionsInside(a))e.isCollapsed===i&&o.push(e);(i||!n||o.length===0)&&o.push(a)}t.toggleCollapseState(o),this.reveal({lineNumber:n,column:1})}}}reveal(e){this.editor.revealPositionInCenterIfOutsideViewport(e,0)}};Fw=Nw=jw([Mw(1,On),Mw(2,Ce),Mw(3,Ur),Mw(4,fu),Mw(5,H)],Fw);var Iw=class extends x{constructor(e){super(),this.editor=e,this._onDidChange=this._register(new D),this._computed=0,this._limited=!1}get limit(){return this.editor.getOptions().get(56)}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}},Lw=class extends R{runEditorCommand(e,t,n){let r=e.get(Ce),i=Fw.get(t);if(!i)return;let a=i.getFoldingModel();if(a)return this.reportTelemetry(e,t),a.then(e=>{if(e){this.invoke(i,e,t,n,r);let a=t.getSelection();a&&i.reveal(a.getStartPosition())}})}getSelectedLines(e){let t=e.getSelections();return t?t.map(e=>e.startLineNumber):[]}getLineNumbers(e,t){return e&&e.selectionLines?e.selectionLines.map(e=>e+1):this.getSelectedLines(t)}run(e,t){}};function Rw(e){return!e||e.length===0?{startsInside:()=>!1}:{startsInside(t,n){for(let r of e){let e=r.startLineNumber;if(e>=t&&e<=n)return!0}return!1}}}function zw(e){if(!ku(e)){if(!Yr(e))return!1;let t=e;if(!ku(t.levels)&&!Bu(t.levels)||!ku(t.direction)&&!Ae(t.direction)||!ku(t.selectionLines)&&(!Array.isArray(t.selectionLines)||!t.selectionLines.every(Bu)))return!1}return!0}var Bw=class extends Lw{constructor(){super({id:`editor.unfold`,label:U(977,`Unfold`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:3166,mac:{primary:2654},weight:100},metadata:{description:`Unfold the content in the editor`,args:[{name:`Unfold editor argument`,description:`Property-value pairs that can be passed through this argument:
						* 'levels': Number of levels to unfold. If not set, defaults to 1.
						* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.
						* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.
						`,constraint:zw,schema:{type:`object`,properties:{levels:{type:`number`,default:1},direction:{type:`string`,enum:[`up`,`down`],default:`down`},selectionLines:{type:`array`,items:{type:`number`}}}}}]}})}invoke(e,t,n,r){let i=r&&r.levels||1,a=this.getLineNumbers(r,n);r&&r.direction===`up`?QC(t,!1,i,a):ZC(t,!1,i,a)}},Vw=class extends Lw{constructor(){super({id:`editor.unfoldRecursively`,label:U(978,`Unfold Recursively`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2142),weight:100}})}invoke(e,t,n,r){ZC(t,!1,Number.MAX_VALUE,this.getSelectedLines(n))}},Hw=class extends Lw{constructor(){super({id:`editor.fold`,label:U(979,`Fold`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:3164,mac:{primary:2652},weight:100},metadata:{description:`Fold the content in the editor`,args:[{name:`Fold editor argument`,description:`Property-value pairs that can be passed through this argument:
							* 'levels': Number of levels to fold.
							* 'direction': If 'up', folds given number of levels up otherwise folds down.
							* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.
							If no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.
						`,constraint:zw,schema:{type:`object`,properties:{levels:{type:`number`},direction:{type:`string`,enum:[`up`,`down`]},selectionLines:{type:`array`,items:{type:`number`}}}}}]}})}invoke(e,t,n,r){let i=this.getLineNumbers(r,n),a=r&&r.levels,o=r&&r.direction;typeof a!=`number`&&typeof o!=`string`?$C(t,!0,i):o===`up`?QC(t,!0,a||1,i):ZC(t,!0,a||1,i)}},Uw=class extends Lw{constructor(){super({id:`editor.toggleFold`,label:U(980,`Toggle Fold`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2090),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);XC(t,1,r)}},Ww=class extends Lw{constructor(){super({id:`editor.foldRecursively`,label:U(981,`Fold Recursively`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2140),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);ZC(t,!0,Number.MAX_VALUE,r)}},Gw=class extends Lw{constructor(){super({id:`editor.toggleFoldRecursively`,label:U(982,`Toggle Fold Recursively`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,3114),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);XC(t,Number.MAX_VALUE,r)}},Kw=class extends Lw{constructor(){super({id:`editor.foldAllBlockComments`,label:U(983,`Fold All Block Comments`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2138),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())rw(t,bc.Comment.value,!0);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).comments;if(r&&r.blockCommentStartToken){let e=RegExp(`^\\s*`+Pt(r.blockCommentStartToken));nw(t,e,!0)}}}},qw=class extends Lw{constructor(){super({id:`editor.foldAllMarkerRegions`,label:U(984,`Fold All Regions`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2077),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())rw(t,bc.Region.value,!0);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).foldingRules;if(r&&r.markers&&r.markers.start){let e=new RegExp(r.markers.start);nw(t,e,!0)}}}},Jw=class extends Lw{constructor(){super({id:`editor.unfoldAllMarkerRegions`,label:U(985,`Unfold All Regions`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2078),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())rw(t,bc.Region.value,!1);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).foldingRules;if(r&&r.markers&&r.markers.start){let e=new RegExp(r.markers.start);nw(t,e,!1)}}}},Yw=class extends Lw{constructor(){super({id:`editor.foldAllExcept`,label:U(986,`Fold All Except Selected`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2136),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);tw(t,!0,r)}},Xw=class extends Lw{constructor(){super({id:`editor.unfoldAllExcept`,label:U(987,`Unfold All Except Selected`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2134),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);tw(t,!1,r)}},Zw=class extends Lw{constructor(){super({id:`editor.foldAll`,label:U(988,`Fold All`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2069),weight:100}})}invoke(e,t,n){ZC(t,!0)}},Qw=class extends Lw{constructor(){super({id:`editor.unfoldAll`,label:U(989,`Unfold All`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2088),weight:100}})}invoke(e,t,n){ZC(t,!1)}},$w=class e extends Lw{static{this.ID_PREFIX=`editor.foldLevel`}static{this.ID=t=>e.ID_PREFIX+t}getFoldingLevel(){return parseInt(this.id.substr(e.ID_PREFIX.length))}invoke(e,t,n){ew(t,this.getFoldingLevel(),!0,this.getSelectedLines(n))}},eT=class extends Lw{constructor(){super({id:`editor.gotoParentFold`,label:U(990,`Go to Parent Fold`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=iw(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},tT=class extends Lw{constructor(){super({id:`editor.gotoPreviousFold`,label:U(991,`Go to Previous Folding Range`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=aw(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},nT=class extends Lw{constructor(){super({id:`editor.gotoNextFold`,label:U(992,`Go to Next Folding Range`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=ow(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},rT=class extends Lw{constructor(){super({id:`editor.createFoldingRangeFromSelection`,label:U(993,`Create Folding Range from Selection`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2135),weight:100}})}invoke(e,t,n){let r=[],i=n.getSelections();if(i){for(let e of i){let t=e.endLineNumber;e.endColumn===1&&--t,t>e.startLineNumber&&(r.push({startLineNumber:e.startLineNumber,endLineNumber:t,type:void 0,isCollapsed:!0,source:1}),n.setSelection({startLineNumber:e.startLineNumber,startColumn:1,endLineNumber:e.startLineNumber,endColumn:1}))}if(r.length>0){r.sort((e,t)=>e.startLineNumber-t.startLineNumber);let e=qC.sanitizeAndMerge(t.regions,r,n.getModel()?.getLineCount());t.updatePost(qC.fromFoldRanges(e))}}}},iT=class extends Lw{constructor(){super({id:`editor.removeManualFoldingRanges`,label:U(994,`Remove Manual Folding Ranges`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2137),weight:100}})}invoke(e,t,n){let r=n.getSelections();if(r){let n=[];for(let e of r){let{startLineNumber:t,endLineNumber:r}=e;n.push(r>=t?{startLineNumber:t,endLineNumber:r}:{endLineNumber:r,startLineNumber:t})}t.removeManualRanges(n),e.triggerFoldingModelChanged()}}},aT=class extends Lw{constructor(){super({id:`editor.toggleImportFold`,label:U(995,`Toggle Import Fold`),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,weight:100}})}async invoke(e,t){let n=[],r=t.regions;for(let e=r.length-1;e>=0;e--)r.getType(e)===bc.Imports.value&&n.push(r.toRegion(e));t.toggleCollapseState(n),e.triggerFoldingModelChanged()}};K(Fw.ID,Fw,0),q(Bw),q(Vw),q(Hw),q(Ww),q(Gw),q(Zw),q(Qw),q(Kw),q(qw),q(Jw),q(Yw),q(Xw),q(Uw),q(eT),q(tT),q(nT),q(rT),q(iT),q(aT);for(let e=1;e<=7;e++)Ls(new $w({id:$w.ID(e),label:U(996,`Fold Level {0}`,e),precondition:Pw,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2048|21+e),weight:100}}));gd.registerCommand(`_executeFoldingRangeProvider`,async function(e,...t){let[n]=t;if(!(n instanceof ur))throw Pn();let r=e.get(H),i=e.get(_n).getModel(n);if(!i)throw Pn();let a=e.get(hn);if(!a.getValue(`editor.folding`,{resource:n}))return[];let o=e.get(Ce),s=a.getValue(`editor.foldingStrategy`,{resource:n}),c={get limit(){return a.getValue(`editor.foldingMaximumRegions`,{resource:n})},update:(e,t)=>{}},l=new fw(i,o,c),u=l;if(s!==`indentation`){let e=Fw.getFoldingRangeProviders(r,i);e.length&&(u=new Dw(i,e,()=>{},c,l))}let d=await u.compute(M.None),f=[];try{if(d)for(let e=0;e<d.length;e++){let t=d.getType(e);f.push({start:d.getStartLineNumber(e),end:d.getEndLineNumber(e),kind:t?bc.fromValue(t):void 0})}return f}finally{u.dispose()}});var oT=class extends R{constructor(){super({id:`editor.action.fontZoomIn`,label:U(1006,`Increase Editor Font Size`),precondition:void 0})}run(e,t){na.setZoomLevel(na.getZoomLevel()+1)}},sT=class extends R{constructor(){super({id:`editor.action.fontZoomOut`,label:U(1007,`Decrease Editor Font Size`),precondition:void 0})}run(e,t){na.setZoomLevel(na.getZoomLevel()-1)}},cT=class extends R{constructor(){super({id:`editor.action.fontZoomReset`,label:U(1008,`Reset Editor Font Size`),precondition:void 0})}run(e,t){na.setZoomLevel(0)}};q(oT),q(sT),q(cT);var lT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},uT=function(e,t){return function(n,r){t(n,r,e)}},dT=class{static{this.ID=`editor.contrib.autoFormat`}constructor(e,t,n,r){this._editor=e,this._languageFeaturesService=t,this._workerService=n,this._accessibilitySignalService=r,this._disposables=new L,this._sessionDisposables=new L,this._disposables.add(t.onTypeFormattingEditProvider.onDidChange(this._update,this)),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(e=>{e.hasChanged(65)&&this._update()})),this._update()}dispose(){this._disposables.dispose(),this._sessionDisposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(65)||!this._editor.hasModel())return;let e=this._editor.getModel(),[t]=this._languageFeaturesService.onTypeFormattingEditProvider.ordered(e);if(!t||!t.autoFormatTriggerCharacters)return;let n=new Hr;for(let e of t.autoFormatTriggerCharacters)n.add(e.charCodeAt(0));this._sessionDisposables.add(this._editor.onDidType(e=>{let t=e.charCodeAt(e.length-1);n.has(t)&&this._trigger(String.fromCharCode(t))}))}_trigger(e){if(!this._editor.hasModel()||this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;let t=this._editor.getModel(),n=this._editor.getPosition(),r=new Sr,i=this._editor.onDidChangeModelContent(e=>{if(e.isFlush){r.cancel(),i.dispose();return}for(let t=0,a=e.changes.length;t<a;t++)if(e.changes[t].range.endLineNumber<=n.lineNumber){r.cancel(),i.dispose();return}});gu(this._workerService,this._languageFeaturesService,t,n,e,t.getFormattingOptions(),r.token).then(e=>{r.token.isCancellationRequested||$t(e)&&(this._accessibilitySignalService.playSignal(fl.format,{userGesture:!1}),Yu.execute(this._editor,e,!0))}).finally(()=>{i.dispose()})}};dT=lT([uT(1,H),uT(2,Xs),uT(3,Zt)],dT);var fT=class{static{this.ID=`editor.contrib.formatOnPaste`}constructor(e,t,n){this.editor=e,this._languageFeaturesService=t,this._instantiationService=n,this._callOnDispose=new L,this._callOnModel=new L,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(t.documentRangeFormattingEditProvider.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(64)&&this.editor.hasModel()&&this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:e})=>this._trigger(e)))}_trigger(e){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(ns,this.editor,e,2,ol.None,M.None,!1).catch(mr))}};fT=lT([uT(1,H),uT(2,k)],fT);var pT=class extends R{constructor(){super({id:`editor.action.formatDocument`,label:U(1009,`Format Document`),precondition:E.and(y.notInCompositeEditor,y.writable,y.hasDocumentFormattingProvider),kbOpts:{kbExpr:y.editorTextFocus,primary:1572,linux:{primary:3111},weight:100},contextMenuOpts:{group:`1_modification`,order:1.3}})}async run(e,t){if(t.hasModel()){let n=e.get(k);await e.get(Oo).showWhile(n.invokeFunction(ka,t,1,ol.None,M.None,!0),250)}}},mT=class extends R{constructor(){super({id:`editor.action.formatSelection`,label:U(1010,`Format Selection`),precondition:E.and(y.writable,y.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2084),weight:100},contextMenuOpts:{when:y.hasNonEmptySelection,group:`1_modification`,order:1.31}})}async run(e,t){if(!t.hasModel())return;let n=e.get(k),r=t.getModel(),i=t.getSelections().map(e=>e.isEmpty()?new T(e.startLineNumber,1,e.startLineNumber,r.getLineMaxColumn(e.startLineNumber)):e);await e.get(Oo).showWhile(n.invokeFunction(ns,t,i,1,ol.None,M.None,!0),250)}};K(dT.ID,dT,2),K(fT.ID,fT,2),q(pT),q(mT),gd.registerCommand(`editor.action.format`,async e=>{let t=e.get(xl).getFocusedCodeEditor();if(!t||!t.hasModel())return;let n=e.get(Te);t.getSelection().isEmpty()?await n.executeCommand(`editor.action.formatDocument`):await n.executeCommand(`editor.action.formatSelection`)});var hT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gT=function(e,t){return function(n,r){t(n,r,e)}},_T=class{remove(){this.parent?.children.delete(this.id)}static findId(e,t){let n;typeof e==`string`?n=`${t.id}/${e}`:(n=`${t.id}/${e.name}`,t.children.get(n)!==void 0&&(n=`${t.id}/${e.name}_${e.range.startLineNumber}_${e.range.startColumn}`));let r=n;for(let e=0;t.children.get(r)!==void 0;e++)r=`${n}_${e}`;return r}static empty(e){return e.children.size===0}},vT=class extends _T{constructor(e,t,n){super(),this.id=e,this.parent=t,this.symbol=n,this.children=new Map}},yT=class extends _T{constructor(e,t,n,r){super(),this.id=e,this.parent=t,this.label=n,this.order=r,this.children=new Map}},bT=class e extends _T{static create(t,n,r){let i=new Sr(r),a=new e(n.uri),o=t.ordered(n),s=o.map((t,r)=>{let o=_T.findId(`provider_${r}`,a),s=new yT(o,a,t.displayName??`Unknown Outline Provider`,r);return Promise.resolve(t.provideDocumentSymbols(n,i.token)).then(t=>{for(let n of t||[])e._makeOutlineElement(n,s);return s},e=>(ct(e),s)).then(e=>{_T.empty(e)?e.remove():a._groups.set(o,e)})}),c=t.onDidChange(()=>{let e=t.ordered(n);bt(e,o)||i.cancel()});return Promise.all(s).then(()=>i.token.isCancellationRequested&&!r.isCancellationRequested?e.create(t,n,r):a._compact()).finally(()=>{i.dispose(),c.dispose(),i.dispose()})}static _makeOutlineElement(t,n){let r=_T.findId(t,n),i=new vT(r,n,t);if(t.children)for(let n of t.children)e._makeOutlineElement(n,i);n.children.set(i.id,i)}constructor(e){super(),this.uri=e,this.id=`root`,this.parent=void 0,this._groups=new Map,this.children=new Map,this.id=`root`,this.parent=void 0}_compact(){let e=0;for(let[t,n]of this._groups)n.children.size===0?this._groups.delete(t):e+=1;if(e!==1)this.children=this._groups;else{let e=Dl.first(this._groups.values());for(let[,t]of e.children)t.parent=this,this.children.set(t.id,t)}return this}getTopLevelSymbols(){let e=[];for(let t of this.children.values())t instanceof vT?e.push(t.symbol):e.push(...Dl.map(t.children.values(),e=>e.symbol));return e.sort((e,t)=>T.compareRangesUsingStarts(e.range,t.range))}asListOfDocumentSymbols(){let t=this.getTopLevelSymbols(),n=[];return e._flattenDocumentSymbols(n,t,``),n.sort((e,t)=>C.compare(T.getStartPosition(e.range),T.getStartPosition(t.range))||C.compare(T.getEndPosition(t.range),T.getEndPosition(e.range)))}static _flattenDocumentSymbols(t,n,r){for(let i of n)t.push({kind:i.kind,tags:i.tags,name:i.name,detail:i.detail,containerName:i.containerName||r,range:i.range,selectionRange:i.selectionRange,children:void 0}),i.children&&e._flattenDocumentSymbols(t,i.children,i.name)}};const xT=ma(`IOutlineModelService`);var ST=class{constructor(e,t,n){this._languageFeaturesService=e,this._disposables=new L,this._cache=new ti(15,.7),this._debounceInformation=t.for(e.documentSymbolProvider,`DocumentSymbols`,{min:350}),this._disposables.add(n.onModelRemoved(e=>{this._cache.delete(e.id)}))}dispose(){this._disposables.dispose()}async getOrCreate(e,t){let n=this._languageFeaturesService.documentSymbolProvider,r=n.ordered(e),i=this._cache.get(e.id);if(!i||i.versionId!==e.getVersionId()||!bt(i.provider,r)){let t=new Sr;i={versionId:e.getVersionId(),provider:r,promiseCnt:0,source:t,promise:bT.create(n,e,t.token),model:void 0},this._cache.set(e.id,i);let a=Date.now();i.promise.then(t=>{i.model=t,this._debounceInformation.update(e,Date.now()-a)}).catch(t=>{this._cache.delete(e.id)})}if(i.model)return i.model;i.promiseCnt+=1;let a=t.onCancellationRequested(()=>{--i.promiseCnt===0&&(i.source.cancel(),this._cache.delete(e.id))});try{return await i.promise}finally{a.dispose()}}};ST=hT([gT(0,H),gT(1,fu),gT(2,_n)],ST),Ui(xT,ST,1),gd.registerCommand(`_executeDocumentSymbolProvider`,async function(e,...t){let[n]=t;J(ur.isUri(n));let r=e.get(xT),i=await e.get(Et).createModelReference(n);try{return(await r.getOrCreate(i.object.textEditorModel,M.None)).getTopLevelSymbols()}finally{i.dispose()}});const CT=new class{constructor(){this._implementations=[]}register(e){return this._implementations.push(e),{dispose:()=>{let t=this._implementations.indexOf(e);t!==-1&&this._implementations.splice(t,1)}}}getImplementations(){return this._implementations}};var wT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},TT=function(e,t){return function(n,r){t(n,r,e)}};function ET(e){return e instanceof DT?e._instance:e}var DT=class{constructor(e){this.instantiationService=e}init(...e){}};function OT(e,t){return class extends t{constructor(){super(...arguments),this._autorun=void 0}init(...t){this._autorun=Ql((n,r)=>{let i=e.read(n);this._instance=r.add(this.instantiationService.createInstance(i,...t))})}dispose(){this._autorun?.dispose()}}}function kT(e){return Ii()?OT(e,AT):e.get()}var AT=class extends DT{constructor(e,t){super(t),this.init(e)}};AT=wT([TT(1,k)],AT);const Z={Visible:kS,HasFocusedSuggestion:new N(`suggestWidgetHasFocusedSuggestion`,!1,G(1440,`Whether any suggestion is focused`)),DetailsVisible:new N(`suggestWidgetDetailsVisible`,!1,G(1441,`Whether suggestion details are visible`)),MultipleSuggestions:new N(`suggestWidgetMultipleSuggestions`,!1,G(1442,`Whether there are multiple suggestions to pick from`)),MakesTextEdit:new N(`suggestionMakesTextEdit`,!0,G(1443,`Whether inserting the current suggestion yields in a change or has everything already been typed`)),AcceptSuggestionsOnEnter:new N(`acceptSuggestionOnEnter`,!0,G(1444,`Whether suggestions are inserted when pressing Enter`)),HasInsertAndReplaceRange:new N(`suggestionHasInsertAndReplaceRange`,!1,G(1445,`Whether the current suggestion has insert and replace behaviour`)),InsertMode:new N(`suggestionInsertMode`,void 0,{type:`string`,description:G(1446,`Whether the default behaviour is to insert or replace`)}),CanResolve:new N(`suggestionCanResolve`,!1,G(1447,`Whether the current suggestion supports to resolve further details`))},jT=new S(`suggestWidgetStatusBar`);var MT=class{constructor(e,t,n,r){this.position=e,this.completion=t,this.container=n,this.provider=r,this.isInvalid=!1,this.score=Vr.Default,this.distance=0,this.textLabel=typeof t.label==`string`?t.label:t.label?.label,this.labelLow=this.textLabel.toLowerCase(),this.isInvalid=!this.textLabel,this.sortTextLow=t.sortText&&t.sortText.toLowerCase(),this.filterTextLow=t.filterText&&t.filterText.toLowerCase(),this.extensionId=t.extensionId,T.isIRange(t.range)?(this.editStart=new C(t.range.startLineNumber,t.range.startColumn),this.editInsertEnd=new C(t.range.endLineNumber,t.range.endColumn),this.editReplaceEnd=new C(t.range.endLineNumber,t.range.endColumn),this.isInvalid=this.isInvalid||T.spansMultipleLines(t.range)||t.range.startLineNumber!==e.lineNumber):(this.editStart=new C(t.range.insert.startLineNumber,t.range.insert.startColumn),this.editInsertEnd=new C(t.range.insert.endLineNumber,t.range.insert.endColumn),this.editReplaceEnd=new C(t.range.replace.endLineNumber,t.range.replace.endColumn),this.isInvalid=this.isInvalid||T.spansMultipleLines(t.range.insert)||T.spansMultipleLines(t.range.replace)||t.range.insert.startLineNumber!==e.lineNumber||t.range.replace.startLineNumber!==e.lineNumber||t.range.insert.startColumn!==t.range.replace.startColumn),typeof r.resolveCompletionItem!=`function`&&(this._resolveCache=Promise.resolve(),this._resolveDuration=0)}get isResolved(){return this._resolveDuration!==void 0}get resolveDuration(){return this._resolveDuration===void 0?-1:this._resolveDuration}async resolve(e){if(!this._resolveCache){let t=e.onCancellationRequested(()=>{this._resolveCache=void 0,this._resolveDuration=void 0}),n=new vd(!0);this._resolveCache=Promise.resolve(this.provider.resolveCompletionItem(this.completion,e)).then(e=>{Object.assign(this.completion,e),this._resolveDuration=n.elapsed()},e=>{Gn(e)&&(this._resolveCache=void 0,this._resolveDuration=void 0)}).finally(()=>{t.dispose()})}return this._resolveCache}},NT=class e{static{this.default=new e}constructor(e=2,t=new Set,n=new Set,r=new Map,i=!0){this.snippetSortOrder=e,this.kindFilter=t,this.providerFilter=n,this.providerItemsToReuse=r,this.showDeprecated=i}},PT;function FT(){return PT}var IT=class{constructor(e,t,n,r){this.items=e,this.needsClipboard=t,this.durations=n,this.disposable=r}};async function LT(e,t,n,r=NT.default,i={triggerKind:0},a=M.None){let o=new vd;n=n.clone();let s=t.getWordAtPosition(n),c=s?new T(n.lineNumber,s.startColumn,n.lineNumber,s.endColumn):T.fromPositions(n),l={replace:c,insert:c.setEndPosition(n.lineNumber,n.column)},u=[],d=new L,f=[],p=!1,m=(e,t,i)=>{let a=!1;if(!t)return a;for(let i of t.suggestions)if(!r.kindFilter.has(i.kind)){if(!r.showDeprecated&&i?.tags?.includes(1))continue;i.range||=l,i.sortText||=typeof i.label==`string`?i.label:i.label.label,!p&&i.insertTextRules&&i.insertTextRules&4&&(p=Bm.guessNeedsClipboard(i.insertText)),u.push(new MT(n,i,t,e)),a=!0}return yn(t)&&d.add(t),f.push({providerName:e._debugDisplayName??`unknown_provider`,elapsedProvider:t.duration??-1,elapsedOverall:i.elapsed()}),a},h=(async()=>{})();for(let o of e.orderedGroups(t)){let e=!1;if(await Promise.all(o.map(async o=>{if(r.providerItemsToReuse.has(o)){let t=r.providerItemsToReuse.get(o);t.forEach(e=>u.push(e)),e||=t.length>0;return}if(!(r.providerFilter.size>0&&!r.providerFilter.has(o)))try{let r=new vd,s=await o.provideCompletionItems(t,n,i,a);e=m(o,s,r)||e}catch(e){ct(e)}})),e||a.isCancellationRequested)break}return await h,a.isCancellationRequested?(d.dispose(),Promise.reject(new Us)):new IT(u.sort(HT(r.snippetSortOrder)),p,{entries:f,elapsed:o.elapsed()},d)}function RT(e,t){if(e.sortTextLow&&t.sortTextLow){if(e.sortTextLow<t.sortTextLow)return-1;if(e.sortTextLow>t.sortTextLow)return 1}return e.textLabel<t.textLabel?-1:e.textLabel>t.textLabel?1:e.completion.kind-t.completion.kind}function zT(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===28)return-1;if(t.completion.kind===28)return 1}return RT(e,t)}function BT(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===28)return 1;if(t.completion.kind===28)return-1}return RT(e,t)}var VT=new Map;VT.set(0,zT),VT.set(2,BT),VT.set(1,RT);function HT(e){return VT.get(e)}gd.registerCommand(`_executeCompletionItemProvider`,async(e,...t)=>{let[n,r,i,a]=t;J(ur.isUri(n)),J(C.isIPosition(r)),J(typeof i==`string`||!i),J(typeof a==`number`||!a);let{completionProvider:o}=e.get(H),s=await e.get(Et).createModelReference(n);try{let e={incomplete:!1,suggestions:[]},t=[],n=s.object.textEditorModel.validatePosition(r),c=await LT(o,s.object.textEditorModel,n,void 0,{triggerCharacter:i??void 0,triggerKind:i?1:0});for(let n of c.items)t.length<(a??0)&&t.push(n.resolve(M.None)),e.incomplete=e.incomplete||n.container.incomplete,e.suggestions.push(n.completion);try{return await Promise.all(t),e}finally{setTimeout(()=>c.disposable.dispose(),100)}}finally{s.dispose()}});function UT(e,t){e.getContribution(`editor.contrib.suggestController`)?.triggerSuggest(new Set().add(t),void 0,!0)}var WT=class{static isAllOff(e){return e.other===`off`&&e.comments===`off`&&e.strings===`off`}static isAllOn(e){return e.other===`on`&&e.comments===`on`&&e.strings===`on`}static valueFor(e,t){switch(t){case 1:return e.comments;case 2:return e.strings;default:return e.other}}},GT=class{static{this.inlineSuggestionVisible=new N(`inlineSuggestionVisible`,!1,G(1184,`Whether an inline suggestion is visible`))}static{this.inlineSuggestionHasIndentation=new N(`inlineSuggestionHasIndentation`,!1,G(1185,`Whether the inline suggestion starts with whitespace`))}static{this.inlineSuggestionHasIndentationLessThanTabSize=new N(`inlineSuggestionHasIndentationLessThanTabSize`,!0,G(1186,`Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab`))}static{this.suppressSuggestions=new N(`inlineSuggestionSuppressSuggestions`,void 0,G(1187,`Whether suggestions should be suppressed for the current suggestion`))}static{this.cursorBeforeGhostText=new N(`cursorBeforeGhostText`,!1,G(1188,`Whether the cursor is at ghost text`))}static{this.cursorInIndentation=new N(`cursorInIndentation`,!1,G(1189,`Whether the cursor is in indentation`))}static{this.hasSelection=new N(`editor.hasSelection`,!1,G(1190,`Whether the editor has a selection`))}static{this.cursorAtInlineEdit=new N(`cursorAtInlineEdit`,!1,G(1191,`Whether the cursor is at an inline edit`))}static{this.inlineEditVisible=new N(`inlineEditIsVisible`,!1,G(1192,`Whether an inline edit is visible`))}static{this.tabShouldJumpToInlineEdit=new N(`tabShouldJumpToInlineEdit`,!1,G(1193,`Whether tab should jump to an inline edit.`))}static{this.tabShouldAcceptInlineEdit=new N(`tabShouldAcceptInlineEdit`,!1,G(1194,`Whether tab should accept the inline edit.`))}static{this.inInlineEditsPreviewEditor=new N(`inInlineEditsPreviewEditor`,!0,G(1195,`Whether the current code editor is showing an inline edits preview`))}},KT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qT=function(e,t){return function(n,r){t(n,r,e)}};function JT(e){return e.sourceId+` @@ `+JSON.stringify({...e,modelUri:e.modelUri?.toString(),sourceId:void 0})}var YT=class extends x{static cast(){return this}constructor(e,t,n){super(),this._key=e,this._contextKeyService=t,this._dataChannelService=n,this._isEnabledContextKeyValue=XT(`structuredLogger.enabled:`+this._key,this._contextKeyService).recomputeInitiallyAndOnChange(this._store),this.isEnabled=this._isEnabledContextKeyValue.map(e=>e!==void 0)}log(e){return this._isEnabledContextKeyValue.get()?(this._dataChannelService.getDataChannel(`structuredLogger:`+this._key).sendData(e),!0):!1}};YT=KT([qT(1,On),qT(2,_t)],YT);function XT(e,t){return yt(t.onDidChangeContext,()=>t.getContextKeyValue(e))}var ZT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},QT=function(e,t){return function(n,r){t(n,r,e)}},$T=class extends x{constructor(e,t,n){super(),this._editor=e,this._instantiationService=t,this._loggerService=n,this._structuredLogger=this._register(this._instantiationService.createInstance(YT.cast(),`editor.inlineSuggest.logChangeReason.commandId`));let r=this._loggerService?.createLogger(`textModelChanges`,{hidden:!1,name:`Text Model Changes Reason`}),i=yt(this,r.onDidChangeLogLevel,()=>r.getLevel());this._register(g(e=>{pu(i.read(e),vc.Trace)&&e.store.add(this._editor.onDidChangeModelContent(e=>{this._editor.getModel()?.uri.scheme!==`output`&&r.trace(`onDidChangeModelContent: `+e.detailedReasons.map(e=>e.toKey(Number.MAX_VALUE)).join(`, `))}))})),this._register(g(e=>{this._editor instanceof ws&&this._structuredLogger.isEnabled.read(e)&&e.store.add(this._editor.onDidChangeModelContent(e=>{let t=this._editor.getModel();if(!t)return;let n=e.detailedReasons[0],r={...n.metadata,sourceId:`TextModel.setChangeReason`,source:n.metadata.source,time:Date.now(),modelUri:t.uri,modelVersion:t.getVersionId()};setTimeout(()=>{this._structuredLogger.log(r)},0)}))}))}};$T=ZT([QT(1,k),QT(2,yo)],$T);function eE(e,t=To){return Ku(e,t)?e.charAt(0).toUpperCase()+e.slice(1):e}var tE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},nE=function(e,t){return function(n,r){t(n,r,e)}};Object.freeze({CURRENT_YEAR:!0,CURRENT_YEAR_SHORT:!0,CURRENT_MONTH:!0,CURRENT_DATE:!0,CURRENT_HOUR:!0,CURRENT_MINUTE:!0,CURRENT_SECOND:!0,CURRENT_DAY_NAME:!0,CURRENT_DAY_NAME_SHORT:!0,CURRENT_MONTH_NAME:!0,CURRENT_MONTH_NAME_SHORT:!0,CURRENT_SECONDS_UNIX:!0,CURRENT_TIMEZONE_OFFSET:!0,SELECTION:!0,CLIPBOARD:!0,TM_SELECTED_TEXT:!0,TM_CURRENT_LINE:!0,TM_CURRENT_WORD:!0,TM_LINE_INDEX:!0,TM_LINE_NUMBER:!0,TM_FILENAME:!0,TM_FILENAME_BASE:!0,TM_DIRECTORY:!0,TM_FILEPATH:!0,CURSOR_INDEX:!0,CURSOR_NUMBER:!0,RELATIVE_FILEPATH:!0,BLOCK_COMMENT_START:!0,BLOCK_COMMENT_END:!0,LINE_COMMENT:!0,WORKSPACE_NAME:!0,WORKSPACE_FOLDER:!0,RANDOM:!0,RANDOM_HEX:!0,UUID:!0});var rE=class{constructor(e){this._delegates=e}resolve(e){for(let t of this._delegates){let n=t.resolve(e);if(n!==void 0)return n}}},iE=class{constructor(e,t,n,r){this._model=e,this._selection=t,this._selectionIdx=n,this._overtypingCapturer=r}resolve(e){let{name:t}=e;if(t===`SELECTION`||t===`TM_SELECTED_TEXT`){let t=this._model.getValueInRange(this._selection)||void 0,n=this._selection.startLineNumber!==this._selection.endLineNumber;if(!t&&this._overtypingCapturer){let e=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);e&&(t=e.value,n=e.multiline)}if(t&&n&&e.snippet){let n=this._model.getLineContent(this._selection.startLineNumber),r=St(n,0,this._selection.startColumn-1),i=r;e.snippet.walk(t=>t===e?!1:(t instanceof jm&&(i=St(Uo(t.value).pop())),!0));let a=Kt(i,r);t=t.replace(/(\r\n|\r|\n)(.*)/g,(e,t,n)=>`${t}${i.substr(a)}${n}`)}return t}else if(t===`TM_CURRENT_LINE`)return this._model.getLineContent(this._selection.positionLineNumber);else if(t===`TM_CURRENT_WORD`){let e=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return e&&e.word||void 0}else if(t===`TM_LINE_INDEX`)return String(this._selection.positionLineNumber-1);else if(t===`TM_LINE_NUMBER`)return String(this._selection.positionLineNumber);else if(t===`CURSOR_INDEX`)return String(this._selectionIdx);else if(t===`CURSOR_NUMBER`)return String(this._selectionIdx+1)}},aE=class{constructor(e,t){this._labelService=e,this._model=t}resolve(e){let{name:t}=e;if(t===`TM_FILENAME`)return lc(this._model.uri.fsPath);if(t===`TM_FILENAME_BASE`){let e=lc(this._model.uri.fsPath),t=e.lastIndexOf(`.`);return t<=0?e:e.slice(0,t)}else if(t===`TM_DIRECTORY`)return he(this._model.uri.fsPath)===`.`?``:this._labelService.getUriLabel(kc(this._model.uri));else if(t===`TM_FILEPATH`)return this._labelService.getUriLabel(this._model.uri);else if(t===`RELATIVE_FILEPATH`)return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}},oE=class{constructor(e,t,n,r){this._readClipboardText=e,this._selectionIdx=t,this._selectionCount=n,this._spread=r}resolve(e){if(e.name!==`CLIPBOARD`)return;let t=this._readClipboardText();if(t){if(this._spread){let e=t.split(/\r\n|\n|\r/).filter(e=>!_l(e));if(e.length===this._selectionCount)return e[this._selectionIdx]}return t}}},sE=class{constructor(e,t,n){this._model=e,this._selection=t,this._languageConfigurationService=n}resolve(e){let{name:t}=e,n=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),r=this._languageConfigurationService.getLanguageConfiguration(n).comments;if(r){if(t===`LINE_COMMENT`)return r.lineCommentToken||void 0;if(t===`BLOCK_COMMENT_START`)return r.blockCommentStartToken||void 0;if(t===`BLOCK_COMMENT_END`)return r.blockCommentEndToken||void 0}}};sE=tE([nE(2,Ce)],sE);var cE=class e{constructor(){this._date=new Date}static{this.dayNames=[G(1391,`Sunday`),G(1392,`Monday`),G(1393,`Tuesday`),G(1394,`Wednesday`),G(1395,`Thursday`),G(1396,`Friday`),G(1397,`Saturday`)]}static{this.dayNamesShort=[G(1398,`Sun`),G(1399,`Mon`),G(1400,`Tue`),G(1401,`Wed`),G(1402,`Thu`),G(1403,`Fri`),G(1404,`Sat`)]}static{this.monthNames=[G(1405,`January`),G(1406,`February`),G(1407,`March`),G(1408,`April`),G(1409,`May`),G(1410,`June`),G(1411,`July`),G(1412,`August`),G(1413,`September`),G(1414,`October`),G(1415,`November`),G(1416,`December`)]}static{this.monthNamesShort=[G(1417,`Jan`),G(1418,`Feb`),G(1419,`Mar`),G(1420,`Apr`),G(1421,`May`),G(1422,`Jun`),G(1423,`Jul`),G(1424,`Aug`),G(1425,`Sep`),G(1426,`Oct`),G(1427,`Nov`),G(1428,`Dec`)]}resolve(t){let{name:n}=t;if(n===`CURRENT_YEAR`)return String(this._date.getFullYear());if(n===`CURRENT_YEAR_SHORT`)return String(this._date.getFullYear()).slice(-2);if(n===`CURRENT_MONTH`)return String(this._date.getMonth().valueOf()+1).padStart(2,`0`);if(n===`CURRENT_DATE`)return String(this._date.getDate().valueOf()).padStart(2,`0`);if(n===`CURRENT_HOUR`)return String(this._date.getHours().valueOf()).padStart(2,`0`);if(n===`CURRENT_MINUTE`)return String(this._date.getMinutes().valueOf()).padStart(2,`0`);if(n===`CURRENT_SECOND`)return String(this._date.getSeconds().valueOf()).padStart(2,`0`);if(n===`CURRENT_DAY_NAME`)return e.dayNames[this._date.getDay()];if(n===`CURRENT_DAY_NAME_SHORT`)return e.dayNamesShort[this._date.getDay()];if(n===`CURRENT_MONTH_NAME`)return e.monthNames[this._date.getMonth()];if(n===`CURRENT_MONTH_NAME_SHORT`)return e.monthNamesShort[this._date.getMonth()];if(n===`CURRENT_SECONDS_UNIX`)return String(Math.floor(this._date.getTime()/1e3));if(n===`CURRENT_TIMEZONE_OFFSET`){let e=this._date.getTimezoneOffset(),t=e>0?`-`:`+`,n=Math.trunc(Math.abs(e/60)),r=n<10?`0`+n:n,i=Math.abs(e)-n*60,a=i<10?`0`+i:i;return t+r+`:`+a}}},lE=class{constructor(e){this._workspaceService=e}resolve(e){if(!this._workspaceService)return;let t=gc(this._workspaceService.getWorkspace());if(!Yc(t)){if(e.name===`WORKSPACE_NAME`)return this._resolveWorkspaceName(t);if(e.name===`WORKSPACE_FOLDER`)return this._resoveWorkspacePath(t)}}_resolveWorkspaceName(e){if(Vl(e))return lc(e.uri.path);let t=lc(e.configPath.path);return t.endsWith(`code-workspace`)&&(t=t.substr(0,t.length-Ka.length-1)),t}_resoveWorkspacePath(e){if(Vl(e))return eE(e.uri.fsPath);let t=lc(e.configPath.path),n=e.configPath.fsPath;return n.endsWith(t)&&(n=n.substr(0,n.length-t.length-1)),n?eE(n):`/`}},uE=class{resolve(e){let{name:t}=e;if(t===`RANDOM`)return Math.random().toString().slice(-6);if(t===`RANDOM_HEX`)return Math.random().toString(16).slice(-6);if(t===`UUID`)return cs()}},dE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fE=function(e,t){return function(n,r){t(n,r,e)}},pE,mE=class e{static{this._decor={active:Y.register({description:`snippet-placeholder-1`,stickiness:0,className:`snippet-placeholder`}),inactive:Y.register({description:`snippet-placeholder-2`,stickiness:1,className:`snippet-placeholder`}),activeFinal:Y.register({description:`snippet-placeholder-3`,stickiness:1,className:`finish-snippet-placeholder`}),inactiveFinal:Y.register({description:`snippet-placeholder-4`,stickiness:1,className:`finish-snippet-placeholder`})}}constructor(e,t,n){this._editor=e,this._snippet=t,this._snippetLineLeadingWhitespace=n,this._offset=-1,this._nestingLevel=1,this._placeholderGroups=dn(t.placeholders,Nm.compareByIndex),this._placeholderGroupsIdx=-1}initialize(e){this._offset=e.newPosition}dispose(){this._placeholderDecorations&&this._editor.removeDecorations([...this._placeholderDecorations.values()]),this._placeholderGroups.length=0}_initDecorations(){if(this._offset===-1)throw Error(`Snippet not initialized!`);if(this._placeholderDecorations)return;this._placeholderDecorations=new Map;let t=this._editor.getModel();this._editor.changeDecorations(n=>{for(let r of this._snippet.placeholders){let i=this._snippet.offset(r),a=this._snippet.fullLen(r),o=T.fromPositions(t.getPositionAt(this._offset+i),t.getPositionAt(this._offset+i+a)),s=r.isFinalTabstop?e._decor.inactiveFinal:e._decor.inactive,c=n.addDecoration(o,s);this._placeholderDecorations.set(r,c)}})}move(t){if(!this._editor.hasModel())return[];if(this._initDecorations(),this._placeholderGroupsIdx>=0){let e=[];for(let t of this._placeholderGroups[this._placeholderGroupsIdx])if(t.transform){let n=this._placeholderDecorations.get(t),r=this._editor.getModel().getDecorationRange(n),i=this._editor.getModel().getValueInRange(r),a=t.transform.resolve(i).split(/\r\n|\r|\n/);for(let e=1;e<a.length;e++)a[e]=this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace+a[e]);e.push(Ss.replace(r,a.join(this._editor.getModel().getEOL())))}e.length>0&&this._editor.executeEdits(`snippet.placeholderTransform`,e)}let n=!1;t===!0&&this._placeholderGroupsIdx<this._placeholderGroups.length-1?(this._placeholderGroupsIdx+=1,n=!0):t===!1&&this._placeholderGroupsIdx>0&&(--this._placeholderGroupsIdx,n=!0);let r=this._editor.getModel().changeDecorations(t=>{let r=new Set,i=[];for(let a of this._placeholderGroups[this._placeholderGroupsIdx]){let o=this._placeholderDecorations.get(a),s=this._editor.getModel().getDecorationRange(o);i.push(new P(s.startLineNumber,s.startColumn,s.endLineNumber,s.endColumn)),n&&=this._hasPlaceholderBeenCollapsed(a),t.changeDecorationOptions(o,a.isFinalTabstop?e._decor.activeFinal:e._decor.active),r.add(a);for(let n of this._snippet.enclosingPlaceholders(a)){let i=this._placeholderDecorations.get(n);t.changeDecorationOptions(i,n.isFinalTabstop?e._decor.activeFinal:e._decor.active),r.add(n)}}for(let[n,i]of this._placeholderDecorations)r.has(n)||t.changeDecorationOptions(i,n.isFinalTabstop?e._decor.inactiveFinal:e._decor.inactive);return i});return n?this.move(t):r??[]}_hasPlaceholderBeenCollapsed(e){let t=e;for(;t;){if(t instanceof Nm){let e=this._placeholderDecorations.get(t);if(this._editor.getModel().getDecorationRange(e).isEmpty()&&t.toString().length>0)return!0}t=t.parent}return!1}get isAtFirstPlaceholder(){return this._placeholderGroupsIdx<=0||this._placeholderGroups.length===0}get isAtLastPlaceholder(){return this._placeholderGroupsIdx===this._placeholderGroups.length-1}get hasPlaceholder(){return this._snippet.placeholders.length>0}get isTrivialSnippet(){if(this._snippet.placeholders.length===0)return!0;if(this._snippet.placeholders.length===1){let[e]=this._snippet.placeholders;if(e.isFinalTabstop&&this._snippet.rightMostDescendant===e)return!0}return!1}computePossibleSelections(){let e=new Map;for(let t of this._placeholderGroups){let n;for(let r of t){if(r.isFinalTabstop)break;n||(n=[],e.set(r.index,n));let t=this._placeholderDecorations.get(r),i=this._editor.getModel().getDecorationRange(t);if(!i){e.delete(r.index);break}n.push(i)}}return e}get activeChoice(){if(!this._placeholderDecorations)return;let e=this._placeholderGroups[this._placeholderGroupsIdx][0];if(!e?.choice)return;let t=this._placeholderDecorations.get(e);if(!t)return;let n=this._editor.getModel().getDecorationRange(t);if(n)return{range:n,choice:e.choice}}get hasChoice(){let e=!1;return this._snippet.walk(t=>(e=t instanceof Pm,!e)),e}merge(t){let n=this._editor.getModel();this._nestingLevel*=10,this._editor.changeDecorations(r=>{for(let i of this._placeholderGroups[this._placeholderGroupsIdx]){let a=t.shift();console.assert(a._offset!==-1),console.assert(!a._placeholderDecorations);let o=a._snippet.placeholderInfo.last.index;for(let e of a._snippet.placeholderInfo.all)e.isFinalTabstop?e.index=i.index+(o+1)/this._nestingLevel:e.index=i.index+e.index/this._nestingLevel;this._snippet.replace(i,a._snippet.children);let s=this._placeholderDecorations.get(i);r.removeDecoration(s),this._placeholderDecorations.delete(i);for(let t of a._snippet.placeholders){let i=a._snippet.offset(t),o=a._snippet.fullLen(t),s=T.fromPositions(n.getPositionAt(a._offset+i),n.getPositionAt(a._offset+i+o)),c=r.addDecoration(s,e._decor.inactive);this._placeholderDecorations.set(t,c)}}this._placeholderGroups=dn(this._snippet.placeholders,Nm.compareByIndex)})}},hE={overwriteBefore:0,overwriteAfter:0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0},gE=pE=class{static adjustWhitespace(e,t,n,r,i){let a=e.getLineContent(t.lineNumber),o=St(a,0,t.column-1),s;return r.walk(t=>{if(!(t instanceof jm)||t.parent instanceof Pm||i&&!i.has(t))return!0;let a=t.value.split(/\r\n|\r|\n/);if(n){let n=r.offset(t);if(n===0)a[0]=e.normalizeIndentation(a[0]);else{s??=r.toString();let t=s.charCodeAt(n-1);(t===10||t===13)&&(a[0]=e.normalizeIndentation(o+a[0]))}for(let t=1;t<a.length;t++)a[t]=e.normalizeIndentation(o+a[t])}let c=a.join(e.getEOL());return c!==t.value&&(t.parent.replace(t,[new jm(c)]),s=void 0),!0}),o}static adjustSelection(e,t,n,r){if(n!==0||r!==0){let{positionLineNumber:i,positionColumn:a}=t,o=a-n,s=a+r,c=e.validateRange({startLineNumber:i,startColumn:o,endLineNumber:i,endColumn:s});t=P.createWithDirection(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn,t.getDirection())}return t}static createEditsAndSnippetsFromSelections(e,t,n,r,i,a,o,s,c){let l=[],u=[];if(!e.hasModel())return{edits:l,snippets:u};let d=e.getModel(),f=e.invokeWithinContext(e=>e.get(Ps)),p=e.invokeWithinContext(e=>new aE(e.get(Ec),d)),m=()=>o,h=d.getValueInRange(pE.adjustSelection(d,e.getSelection(),n,0)),g=d.getValueInRange(pE.adjustSelection(d,e.getSelection(),0,r)),_=d.getLineFirstNonWhitespaceColumn(e.getSelection().positionLineNumber),ee=e.getSelections().map((e,t)=>({selection:e,idx:t})).sort((e,t)=>T.compareRangesUsingStarts(e.selection,t.selection));for(let{selection:o,idx:v}of ee){let te=pE.adjustSelection(d,o,n,0),y=pE.adjustSelection(d,o,0,r);h!==d.getValueInRange(te)&&(te=o),g!==d.getValueInRange(y)&&(y=o);let b=o.setStartPosition(te.startLineNumber,te.startColumn).setEndPosition(y.endLineNumber,y.endColumn),ne=new Bm().parse(t,!0,i),re=b.getStartPosition(),ie=pE.adjustWhitespace(d,re,a||v>0&&_!==d.getLineFirstNonWhitespaceColumn(o.positionLineNumber),ne);ne.resolveVariables(new rE([p,new oE(m,v,ee.length,e.getOption(88)===`spread`),new iE(d,o,v,s),new sE(d,o,c),new cE,new lE(f),new uE])),l[v]=Ss.replace(b,ne.toString()),l[v].identifier={major:v,minor:0},l[v]._isTracked=!0,u[v]=new mE(e,ne,ie)}return{edits:l,snippets:u}}static createEditsAndSnippetsFromEdits(e,t,n,r,i,a,o){if(!e.hasModel()||t.length===0)return{edits:[],snippets:[]};let s=[],c=e.getModel(),l=new Bm,u=new zm,d=new rE([e.invokeWithinContext(e=>new aE(e.get(Ec),c)),new oE(()=>i,0,e.getSelections().length,e.getOption(88)===`spread`),new iE(c,e.getSelection(),0,a),new sE(c,e.getSelection(),o),new cE,new lE(e.invokeWithinContext(e=>e.get(Ps))),new uE]);t=t.sort((e,t)=>T.compareRangesUsingStarts(e.range,t.range));let f=0;for(let e=0;e<t.length;e++){let{range:n,template:i,keepWhitespace:a}=t[e];if(e>0){let r=t[e-1].range,i=T.fromPositions(r.getEndPosition(),n.getStartPosition()),a=new jm(c.getValueInRange(i));u.appendChild(a),f+=a.value.length}let o=l.parseFragment(i,u);pE.adjustWhitespace(c,n.getStartPosition(),a===void 0?r:!a,u,new Set(o)),u.resolveVariables(d);let p=u.toString(),m=p.slice(f);f=p.length;let h=Ss.replace(n,m);h.identifier={major:e,minor:0},h._isTracked=!0,s.push(h)}return l.ensureFinalTabstop(u,n,!0),{edits:s,snippets:[new mE(e,u,``)]}}constructor(e,t,n=hE,r){this._editor=e,this._template=t,this._options=n,this._languageConfigurationService=r,this._templateMerges=[],this._snippets=[]}dispose(){Ot(this._snippets)}_logInfo(){return`template="${this._template}", merged_templates="${this._templateMerges.join(` -> `)}"`}insert(e){if(!this._editor.hasModel())return;let{edits:t,snippets:n}=typeof this._template==`string`?pE.createEditsAndSnippetsFromSelections(this._editor,this._template,this._options.overwriteBefore,this._options.overwriteAfter,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService):pE.createEditsAndSnippetsFromEdits(this._editor,this._template,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService);this._snippets=n,this._editor.executeEdits(e??Fe.snippet(),t,e=>{let t=e.filter(e=>!!e.identifier);for(let e=0;e<n.length;e++)n[e].initialize(t[e].textChange);return this._snippets[0].hasPlaceholder?this._move(!0):t.map(e=>P.fromPositions(e.range.getEndPosition()))}),this._editor.revealRange(this._editor.getSelections()[0])}merge(e,t=hE){if(!this._editor.hasModel())return;this._templateMerges.push([this._snippets[0]._nestingLevel,this._snippets[0]._placeholderGroupsIdx,e]);let{edits:n,snippets:r}=pE.createEditsAndSnippetsFromSelections(this._editor,e,t.overwriteBefore,t.overwriteAfter,!0,t.adjustWhitespace,t.clipboardText,t.overtypingCapturer,this._languageConfigurationService);this._editor.executeEdits(`snippet`,n,e=>{let t=e.filter(e=>!!e.identifier);for(let e=0;e<r.length;e++)r[e].initialize(t[e].textChange);let n=r[0].isTrivialSnippet;if(!n){for(let e of this._snippets)e.merge(r);console.assert(r.length===0)}return this._snippets[0].hasPlaceholder&&!n?this._move(void 0):t.map(e=>P.fromPositions(e.range.getEndPosition()))})}next(){let e=this._move(!0);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}prev(){let e=this._move(!1);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}_move(e){let t=[];for(let n of this._snippets){let r=n.move(e);t.push(...r)}return t}get isAtFirstPlaceholder(){return this._snippets[0].isAtFirstPlaceholder}get isAtLastPlaceholder(){return this._snippets[0].isAtLastPlaceholder}get hasPlaceholder(){return this._snippets[0].hasPlaceholder}get hasChoice(){return this._snippets[0].hasChoice}get activeChoice(){return this._snippets[0].activeChoice}isSelectionWithinPlaceholders(){if(!this.hasPlaceholder)return!1;let e=this._editor.getSelections();if(e.length<this._snippets.length)return!1;let t=new Map;for(let n of this._snippets){let r=n.computePossibleSelections();if(t.size===0)for(let[n,i]of r){i.sort(T.compareRangesUsingStarts);for(let r of e)if(i[0].containsRange(r)){t.set(n,[]);break}}if(t.size===0)return!1;t.forEach((e,t)=>{e.push(...r.get(t))})}e.sort(T.compareRangesUsingStarts);for(let[n,r]of t){if(r.length!==e.length){t.delete(n);continue}r.sort(T.compareRangesUsingStarts);for(let i=0;i<r.length;i++)if(!r[i].containsRange(e[i])){t.delete(n);continue}}return t.size>0}};gE=pE=dE([fE(3,Ce)],gE);var _E=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vE=function(e,t){return function(n,r){t(n,r,e)}},yE,bE={overwriteBefore:0,overwriteAfter:0,undoStopBefore:!0,undoStopAfter:!0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0},xE=class{static{yE=this}static{this.ID=`snippetController2`}static get(e){return e.getContribution(yE.ID)}static{this.InSnippetMode=new N(`inSnippetMode`,!1,G(1387,`Whether the editor in current in snippet mode`))}static{this.HasNextTabstop=new N(`hasNextTabstop`,!1,G(1388,`Whether there is a next tab stop when in snippet mode`))}static{this.HasPrevTabstop=new N(`hasPrevTabstop`,!1,G(1389,`Whether there is a previous tab stop when in snippet mode`))}constructor(e,t,n,r,i){this._editor=e,this._logService=t,this._languageFeaturesService=n,this._languageConfigurationService=i,this._inSnippetObservable=kl(this,!1),this._snippetListener=new L,this._modelVersionId=-1,this._inSnippet=yE.InSnippetMode.bindTo(r),this._hasNextTabstop=yE.HasNextTabstop.bindTo(r),this._hasPrevTabstop=yE.HasPrevTabstop.bindTo(r)}dispose(){this._inSnippet.reset(),this._inSnippetObservable.set(!1,void 0),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._session?.dispose(),this._snippetListener.dispose()}insert(e,t){try{this._doInsert(e,t===void 0?bE:{...bE,...t})}catch(t){this.cancel(),this._logService.error(t),this._logService.error(`snippet_error`),this._logService.error(`insert_template=`,e),this._logService.error(`existing_template=`,this._session?this._session._logInfo():`<no_session>`)}}_doInsert(e,t){if(this._editor.hasModel()){if(this._snippetListener.clear(),t.undoStopBefore&&this._editor.getModel().pushStackElement(),this._session&&typeof e!=`string`&&this.cancel(),this._session?(J(typeof e==`string`),this._session.merge(e,t)):(this._modelVersionId=this._editor.getModel().getAlternativeVersionId(),this._session=new gE(this._editor,e,t,this._languageConfigurationService),this._session.insert(t.reason)),t.undoStopAfter&&this._editor.getModel().pushStackElement(),this._session?.hasChoice){let e={_debugDisplayName:`snippetChoiceCompletions`,provideCompletionItems:(e,t)=>{if(!this._session||e!==this._editor.getModel()||!C.equals(this._editor.getPosition(),t))return;let{activeChoice:n}=this._session;if(!n||n.choice.options.length===0)return;let r=e.getValueInRange(n.range),i=!!n.choice.options.find(e=>e.value===r),a=[];for(let e=0;e<n.choice.options.length;e++){let t=n.choice.options[e];a.push({kind:13,label:t.value,insertText:t.value,sortText:`a`.repeat(e+1),range:n.range,filterText:i?`${r}_${t.value}`:void 0,command:{id:`jumpToNextSnippetPlaceholder`,title:G(1390,`Go to next placeholder...`)}})}return{suggestions:a}}},t=this._editor.getModel(),n,r=!1;this._choiceCompletions={provider:e,enable:()=>{r||=(n=this._languageFeaturesService.completionProvider.register({language:t.getLanguageId(),pattern:t.uri.fsPath,scheme:t.uri.scheme,exclusive:!0},e),this._snippetListener.add(n),!0)},disable:()=>{n?.dispose(),r=!1}}}this._updateState(),this._snippetListener.add(this._editor.onDidChangeModelContent(e=>e.isFlush&&this.cancel())),this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel())),this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()))}}_updateState(){if(!(!this._session||!this._editor.hasModel())){if(this._modelVersionId===this._editor.getModel().getAlternativeVersionId()||!this._session.hasPlaceholder)return this.cancel();if(this._session.isAtLastPlaceholder||!this._session.isSelectionWithinPlaceholders())return this._editor.getModel().pushStackElement(),this.cancel();this._inSnippet.set(!0),this._inSnippetObservable.set(!0,void 0),this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder),this._hasNextTabstop.set(!this._session.isAtLastPlaceholder),this._handleChoice()}}_handleChoice(){if(!this._session||!this._editor.hasModel()){this._currentChoice=void 0;return}let{activeChoice:e}=this._session;if(!e||!this._choiceCompletions){this._choiceCompletions?.disable(),this._currentChoice=void 0;return}this._currentChoice!==e.choice&&(this._currentChoice=e.choice,this._choiceCompletions.enable(),queueMicrotask(()=>{UT(this._editor,this._choiceCompletions.provider)}))}finish(){for(;this._inSnippet.get();)this.next()}cancel(e=!1){this._inSnippet.reset(),this._inSnippetObservable.set(!1,void 0),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._snippetListener.clear(),this._currentChoice=void 0,this._session?.dispose(),this._session=void 0,this._modelVersionId=-1,e&&this._editor.setSelections([this._editor.getSelection()])}prev(){this._session?.prev(),this._updateState()}next(){this._session?.next(),this._updateState()}isInSnippet(){return!!this._inSnippet.get()}get isInSnippetObservable(){return this._inSnippetObservable}};xE=yE=_E([vE(1,Wl),vE(2,H),vE(3,On),vE(4,Ce)],xE),K(xE.ID,xE,4);var SE=Ar.bindToContribution(xE.get);W(new SE({id:`jumpToNextSnippetPlaceholder`,precondition:E.and(xE.InSnippetMode,xE.HasNextTabstop),handler:e=>e.next(),kbOpts:{weight:130,kbExpr:y.textInputFocus,primary:2}})),W(new SE({id:`jumpToPrevSnippetPlaceholder`,precondition:E.and(xE.InSnippetMode,xE.HasPrevTabstop),handler:e=>e.prev(),kbOpts:{weight:130,kbExpr:y.textInputFocus,primary:1026}})),W(new SE({id:`leaveSnippet`,precondition:xE.InSnippetMode,handler:e=>e.cancel(!0),kbOpts:{weight:130,kbExpr:y.textInputFocus,primary:9,secondary:[1033]}})),W(new SE({id:`acceptSnippet`,precondition:xE.InSnippetMode,handler:e=>e.finish()}));function CE(e){return new wE(e)}var wE=class extends ao{constructor(e){super(),this._textModel=e}getOffset(e){return this._textModel.getOffsetAt(e)}getPosition(e){return this._textModel.getPositionAt(e)}},TE=[];function EE(){return TE}function DE(e){return OE(e).map(e=>e.getEndPosition())}function OE(e){let t=Wt.createSortPermutation(e,Mt(e=>e.range,T.compareRangesUsingStarts)),n=new Ia(t.apply(e)).getNewRanges();return t.inverse().apply(n)}function kE(e,t){let n=CE(t),r=t.getValue();return e.map(e=>n.getStringReplacement(e)).map(e=>e.removeCommonSuffixPrefix(r)).map(e=>n.getTextReplacement(e))}function AE(e,t){let n=kl(`result`,[]),r=[];return t.add(g(t=>{let i=e.read(t);Bl(e=>{if(i.length!==r.length){r.length=i.length;for(let e=0;e<r.length;e++)r[e]||(r[e]=kl(`item`,i[e]));n.set([...r],e)}r.forEach((t,n)=>t.set(i[n],e))})})),n}var jE=class{constructor(e){this._contextKeyService=e}bind(e,t){return ge(e,this._contextKeyService,t instanceof Function?t:e=>t.read(e))}};function ME(e,t){return new Promise(n=>{let r,i=setTimeout(()=>{r&&r.dispose(),n()},e);t&&(r=t.onCancellationRequested(()=>{clearTimeout(i),r&&r.dispose(),n()}))})}var NE=class{constructor(e,t,n,r=PE){this.startValue=e,this.endValue=t,this.durationMs=n,this._interpolationFunction=r,this.startTimeMs=Date.now(),e===t&&(this.durationMs=0)}isFinished(){return Date.now()>=this.startTimeMs+this.durationMs}getValue(){let e=Date.now()-this.startTimeMs;return e>=this.durationMs?this.endValue:this._interpolationFunction(e,this.startValue,this.endValue-this.startValue,this.durationMs)}};function PE(e,t,n,r){return e===r?t+n:n*(-(2**(-10*e/r))+1)+t}function FE(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t}var IE=class{constructor(e){this._value=kl(this,e)}getValue(e){let t=this._value.read(e);return t.isFinished()||LE.instance.invalidateOnNextAnimationFrame(e),t.getValue()}},LE=class e{constructor(){this._counter=Ri(this),this._isScheduled=!1}static{this.instance=new e}invalidateOnNextAnimationFrame(e){this._counter.read(e),this._isScheduled||(this._isScheduled=!0,Ko().requestAnimationFrame(()=>{this._isScheduled=!1,this._update()}))}_update(){this._counter.trigger(void 0)}},RE=class{constructor(e,t){this.lineNumber=e,this.parts=t,He(()=>tc(t,(e,t)=>e.column<=t.column))}equals(e){return this.lineNumber===e.lineNumber&&this.parts.length===e.parts.length&&this.parts.every((t,n)=>t.equals(e.parts[n]))}renderForScreenReader(e){if(this.parts.length===0)return``;let t=this.parts[this.parts.length-1],n=e.substr(0,t.column-1);return new Ia([...this.parts.map(e=>new Su(T.fromPositions(new C(1,e.column)),e.lines.map(e=>e.line).join(`
`)))]).applyToString(n).substring(this.parts[0].column-1)}isEmpty(){return this.parts.every(e=>e.lines.length===0)}get lineCount(){return 1+this.parts.reduce((e,t)=>e+t.lines.length-1,0)}},zE=class{constructor(e,t,n,r=[]){this.column=e,this.text=t,this.preview=n,this._inlineDecorations=r,this.lines=Uo(this.text).map((e,t)=>({line:e,lineDecorations:eu.filter(this._inlineDecorations,t+1,1,e.length+1)}))}equals(e){return this.column===e.column&&this.lines.length===e.lines.length&&this.lines.every((t,n)=>t.line===e.lines[n].line&&eu.equalsArr(t.lineDecorations,e.lines[n].lineDecorations))}},BE=class{constructor(e,t,n,r=0){this.lineNumber=e,this.columnRange=t,this.text=n,this.additionalReservedLineCount=r,this.parts=[new zE(this.columnRange.endColumnExclusive,this.text,!1)],this.newLines=Uo(this.text)}renderForScreenReader(e){return this.newLines.join(`
`)}get lineCount(){return this.newLines.length}isEmpty(){return this.parts.every(e=>e.lines.length===0)}equals(e){return this.lineNumber===e.lineNumber&&this.columnRange.equals(e.columnRange)&&this.newLines.length===e.newLines.length&&this.newLines.every((t,n)=>t===e.newLines[n])&&this.additionalReservedLineCount===e.additionalReservedLineCount}};function VE(e,t){return bt(e,t,HE)}function HE(e,t){return e===t?!0:!e||!t?!1:e instanceof RE&&t instanceof RE||e instanceof BE&&t instanceof BE?e.equals(t):!1}function UE(e,t,n){let r=n?e.range.intersectRanges(n):e.range;if(!r)return e;let i=e.text.replaceAll(`\r
`,`
`),a=t.getValueInRange(r,1),o=Kt(a,i),s=Wu.ofText(a.substring(0,o)).addToPosition(e.range.getStartPosition()),c=i.substring(o),l=T.fromPositions(s,e.range.getEndPosition());return new Su(l,c)}function WE(e,t){return e.text.startsWith(t.text)&&GE(e.range,t.range)}function GE(e,t){return t.getStartPosition().equals(e.getStartPosition())&&t.getEndPosition().isBeforeOrEqual(e.getEndPosition())}function KE(e,t,n,r,i=0){let a=UE(e,t);if(a.range.endLineNumber!==a.range.startLineNumber)return;let o=t.getLineContent(a.range.startLineNumber),s=St(o).length;if(a.range.startColumn-1<=s){let e=St(a.text).length,t=o.substring(a.range.startColumn-1,s),[n,r]=[a.range.getStartPosition(),a.range.getEndPosition()],i=n.column+t.length<=r.column?n.delta(0,t.length):r,c=T.fromPositions(i,r),l=a.text.startsWith(t)?a.text.substring(t.length):a.text.substring(e);a=new Su(c,l)}let c=t.getValueInRange(a.range),l=JE(c,a.text);if(!l)return;let u=a.range.startLineNumber,d=[];if(n===`prefix`){let e=l.filter(e=>e.originalLength===0);if(e.length>1||e.length===1&&e[0].originalStart!==c.length)return}let f=a.text.length-i;for(let e of l){let t=a.range.startColumn+e.originalStart+e.originalLength;if(n===`subwordSmart`&&r&&r.lineNumber===a.range.startLineNumber&&t<r.column||e.originalLength>0)return;if(e.modifiedLength===0)continue;let i=e.modifiedStart+e.modifiedLength,o=Math.max(e.modifiedStart,Math.min(i,f)),s=a.text.substring(e.modifiedStart,o),c=a.text.substring(o,Math.max(e.modifiedStart,i));s.length>0&&d.push(new zE(t,s,!1)),c.length>0&&d.push(new zE(t,c,!0))}return new RE(u,d)}var qE=void 0;function JE(e,t){if(qE?.originalValue===e&&qE?.newValue===t)return qE?.changes;{let n=XE(e,t,!0);if(n){let r=YE(n);if(r>0){let i=XE(e,t,!1);i&&YE(i)<r&&(n=i)}}return qE={originalValue:e,newValue:t,changes:n},n}}function YE(e){let t=0;for(let n of e)t+=n.originalLength;return t}function XE(e,t,n){if(e.length>5e3||t.length>5e3)return;function r(e){let t=0;for(let n=0,r=e.length;n<r;n++){let r=e.charCodeAt(n);r>t&&(t=r)}return t}let i=Math.max(r(e),r(t));function a(e){if(e<0)throw Error(`unexpected`);return i+e+1}function o(e){let t=0,r=0,i=new Int32Array(e.length);for(let o=0,s=e.length;o<s;o++)if(n&&e[o]===`(`){let e=r*100+t;i[o]=a(2*e),t++}else if(n&&e[o]===`)`){t=Math.max(t-1,0);let e=r*100+t;i[o]=a(2*e+1),t===0&&r++}else i[o]=e.charCodeAt(o);return i}let s=o(e),c=o(t);return new md({getElements:()=>s},{getElements:()=>c}).ComputeDiff(!1).changes}function ZE(e,t){let n,r=!1,i=new Tr(new al(e,void 0,t.update),(e,i)=>{r||=(n=t.initial instanceof Function?t.initial():t.initial,!0);let a=t.update(e,n,i);return n=a,a},t.changeTracker,()=>{r&&=(t.disposeFinal?.(n),!1)},t.equalityComparer??Do,(e,t,a)=>{if(!r)throw new se(`Can only set when there is a listener! This is to prevent leaks.`);Jc(t,t=>{n=e,i.setValue(e,t,a)})},Ns.ofCaller());return i}var QE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$E=function(e,t){return function(n,r){t(n,r,e)}},eD=class{constructor(e,t){this._baseService=e,this._intercept=t}publicLog2(e,t){this._intercept(e,t),this._baseService.publicLog2(e,t)}},tD=class extends eD{constructor(e,t){super(e,(e,n)=>{let r=!0;n&&nD in n&&(r=!!n[nD]),r&&t.getDataChannel(`editTelemetry`).sendData({eventName:e,data:n})})}};tD=QE([$E(0,Fu),$E(1,_t)],tD);var nD=Symbol(`shouldForwardToChannel`);function rD(e){return{[nD]:e}}function iD(e){if(!e)return!1;let t=e.toLowerCase();return t===`github.copilot`||t===`github.copilot-chat`}function aD(e){let t=e.map(e=>new yr(ac.ofStartAndLength(e.rangeOffset,e.rangeLength),e.text));return t.reverse(),new Xn(t)}function oD(e,t){e.publicLog2(`inlineCompletion.endOfLife`,t)}var sD;(function(e){function t(e,t){return e.isInlineEdit?pD.create(e,t):dD.create(e,t)}e.create=t})(sD||={});var cD=class{constructor(e,t,n){this._data=e,this.identity=t,this.displayLocation=n}get source(){return this._data.source}get isFromExplicitRequest(){return this._data.context.triggerKind===jc.Explicit}get forwardStable(){return this.source.inlineSuggestions.enableForwardStability??!1}get editRange(){return this.getSingleTextEdit().range}get targetRange(){return this.displayLocation?.range??this.editRange}get insertText(){return this.getSingleTextEdit().text}get semanticId(){return this.hash}get action(){return this._sourceInlineCompletion.action}get command(){return this._sourceInlineCompletion.command}get warning(){return this._sourceInlineCompletion.warning}get showInlineEditMenu(){return!!this._sourceInlineCompletion.showInlineEditMenu}get hash(){return JSON.stringify([this.getSingleTextEdit().text,this.getSingleTextEdit().range.getStartPosition().toString()])}get requestUuid(){return this._data.context.requestUuid}get partialAccepts(){return this._data.partialAccepts}get _sourceInlineCompletion(){return this._data.sourceInlineCompletion}addRef(){this.identity.addRef(),this.source.addRef()}removeRef(){this.identity.removeRef(),this.source.removeRef()}reportInlineEditShown(e,t,n){this._data.reportInlineEditShown(e,this.insertText,t,n)}reportPartialAccept(e,t,n){this._data.reportPartialAccept(e,t,n)}reportEndOfLife(e){this._data.reportEndOfLife(e)}setEndOfLifeReason(e){this._data.setEndOfLifeReason(e)}reportInlineEditError(e){this._data.reportInlineEditError(e)}setIsPreceeded(e){this._data.setIsPreceeded(e.partialAccepts)}setNotShownReasonIfNotSet(e){this._data.setNotShownReason(e)}getSourceCompletion(){return this._sourceInlineCompletion}},lD=class e{constructor(){this._onDispose=Ri(this),this._refCount=1,this.id=`InlineCompletionIdentity`+ e.idCounter++}static{this.idCounter=0}addRef(){this._refCount++}removeRef(){this._refCount--,this._refCount===0&&this._onDispose.trigger(void 0)}},uD=class e{static create(t){return new e(t.range,t.label,t.kind)}constructor(e,t,n){this.range=e,this.label=t,this.kind=n}withEdit(t,n){let r=new ac(n.getOffset(this.range.getStartPosition()),n.getOffset(this.range.getEndPosition())),i=pt([r],t)[0];if(!i)return;let a=n.getRange(i);return new e(a,this.label,this.kind)}},dD=class e extends cD{static create(t,n){let r=new lD,i=CE(n),a=t.insertText.replace(/\r\n|\r|\n/g,n.getEOL()),o=gD(new yr(i.getOffsetRange(t.range),a),n),s=o.removeCommonSuffixAndPrefix(n.getValue()),c=i.getTextReplacement(o),l=t.displayLocation?uD.create(t.displayLocation):void 0;return new e(o,s,c,c.range,t.snippetInfo,t.additionalTextEdits,t,r,l)}constructor(e,t,n,r,i,a,o,s,c){super(o,s,c),this._edit=e,this._trimmedEdit=t,this._textEdit=n,this._originalRange=r,this.snippetInfo=i,this.additionalTextEdits=a,this.isInlineEdit=!1}get hash(){return JSON.stringify(this._trimmedEdit.toJson())}getSingleTextEdit(){return this._textEdit}withIdentity(t){return new e(this._edit,this._trimmedEdit,this._textEdit,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,t,this.displayLocation)}withEdit(t,n){let r=pt([this._edit.replaceRange],t);if(r.length===0)return;let i=new yr(r[0],this._textEdit.text),a=CE(n),o=a.getTextReplacement(i),s=this.displayLocation;if(s&&(s=s.withEdit(t,a),!s))return;let c=i.removeCommonSuffixAndPrefix(n.getValue());return new e(i,c,o,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,this.identity,s)}canBeReused(e,t){let n=this._textEdit.range;return!!n&&n.containsPosition(t)&&this.isVisible(e,t)&&Wu.ofRange(n).isGreaterThanOrEqualTo(Wu.ofRange(this._originalRange))}isVisible(e,t){let n=this.getSingleTextEdit();return fD(n,this._originalRange,e,t)}};function fD(e,t,n,r){let i=UE(e,n),a=e.range;if(!a||t&&!t.getStartPosition().equals(a.getStartPosition())||r.lineNumber!==i.range.startLineNumber||i.isEmpty)return!1;let o=n.getValueInRange(i.range,1),s=i.text,c=Math.max(0,r.column-i.range.startColumn),l=s.substring(0,c),u=s.substring(c),d=o.substring(0,c),f=o.substring(c),p=n.getLineIndentColumn(i.range.startLineNumber);return i.range.startColumn<=p&&(d=d.trimStart(),d.length===0&&(f=f.trimStart()),l=l.trimStart(),l.length===0&&(u=u.trimStart())),l.startsWith(d)&&!!mn(f,u)}var pD=class e extends cD{static create(t,n){let r=mD(n,t.range,t.insertText),i=new $n(n),a=Ia.fromStringEdit(r,i).toReplacement(i),o=new lD,s=r.replacements.map(e=>{let t=T.fromPositions(n.getPositionAt(e.replaceRange.start),n.getPositionAt(e.replaceRange.endExclusive)),r=n.getValueInRange(t);return hD.create(e,r)}),c=t.displayLocation?uD.create(t.displayLocation):void 0;return new e(r,a,t,o,s,c,!1,n.getVersionId())}constructor(e,t,n,r,i,a,o=!1,s){super(n,r,a),this._edit=e,this._textEdit=t,this._edits=i,this._lastChangePartOfInlineEdit=o,this._inlineEditModelVersion=s,this.snippetInfo=void 0,this.additionalTextEdits=[],this.isInlineEdit=!0}get updatedEditModelVersion(){return this._inlineEditModelVersion}get updatedEdit(){return this._edit}getSingleTextEdit(){return this._textEdit}withIdentity(t){return new e(this._edit,this._textEdit,this._data,t,this._edits,this.displayLocation,this._lastChangePartOfInlineEdit,this._inlineEditModelVersion)}canBeReused(e,t){return this._lastChangePartOfInlineEdit&&this.updatedEditModelVersion===e.getVersionId()}withEdit(e,t){return this._applyTextModelChanges(e,this._edits,t)}_applyTextModelChanges(t,n,r){if(n=n.map(e=>e.applyTextModelChanges(t)),n.some(e=>e.edit===void 0))return;let i=r.getVersionId(),a=this._inlineEditModelVersion,o=n.some(e=>e.lastChangeUpdatedEdit);if(o&&(a=i??-1),i===null||a+20<i||(n=n.filter(e=>!e.edit.isEmpty),n.length===0))return;let s=new Xn(n.map(e=>e.edit)),c=CE(r),l=c.getTextEdit(s).toReplacement(new $n(r)),u=this.displayLocation;if(!(u&&(u=u.withEdit(t,c),!u)))return new e(s,l,this._data,this.identity,n,u,o,a)}};function mD(e,t,n){let r=e.getEOL(),i=e.getValueInRange(t),a=n.replace(/\r\n|\r|\n/g,r),o=Dc.getDefault().computeDiff(Uo(i),Uo(a),{ignoreTrimWhitespace:!1,computeMoves:!1,extendToSubwords:!0,maxComputationTimeMs:500}).changes.flatMap(e=>e.innerChanges??[]);function s(e,t){let n=Wu.fromPosition(t.getStartPosition());return Wu.ofRange(t).createRange(n.addToPosition(e))}let c=new nd(a);return new Xn(o.map(n=>{let r=s(t.getStartPosition(),n.originalRange),i=CE(e).getOffsetRange(r),a=c.getValueOfRange(n.modifiedRange),l=new yr(i,a),u=e.getValueInRange(r);return _D(l,u,o.length,e)}))}var hD=class e{static create(t,n){let r=Kt(t.newText,n),i=wn(t.newText,n),a=t.newText.substring(r,t.newText.length-i);return new e(t,a,r,i)}get edit(){return this._edit}get lastChangeUpdatedEdit(){return this._lastChangeUpdatedEdit}constructor(e,t,n,r,i=!1){this._edit=e,this._trimmedNewText=t,this._prefixLength=n,this._suffixLength=r,this._lastChangeUpdatedEdit=i}applyTextModelChanges(e){let t=this._clone();return t._applyTextModelChanges(e),t}_clone(){return new e(this._edit,this._trimmedNewText,this._prefixLength,this._suffixLength,this._lastChangeUpdatedEdit)}_applyTextModelChanges(e){if(this._lastChangeUpdatedEdit=!1,!this._edit)throw new se(`UpdatedInnerEdits: No edit to apply changes to`);let t=this._applyChanges(this._edit,e);if(!t){this._edit=void 0;return}this._edit=t.edit,this._lastChangeUpdatedEdit=t.editHasChanged}_applyChanges(e,t){let n=e.replaceRange.start,r=e.replaceRange.endExclusive,i=e.newText,a=!1,o=this._prefixLength>0||this._suffixLength>0;for(let s=t.replacements.length-1;s>=0;s--){let c=t.replacements[s],l=c.newText.length>0&&c.replaceRange.isEmpty;if(l&&!o&&c.replaceRange.start===n&&i.startsWith(c.newText)){n+=c.newText.length,i=i.substring(c.newText.length),r=Math.max(n,r),a=!0;continue}if(l&&o&&c.replaceRange.start===n+this._prefixLength&&this._trimmedNewText.startsWith(c.newText)){r+=c.newText.length,a=!0,this._prefixLength+=c.newText.length,this._trimmedNewText=this._trimmedNewText.substring(c.newText.length);continue}if(c.newText.length===0&&c.replaceRange.length>0&&c.replaceRange.start>=n+this._prefixLength&&c.replaceRange.endExclusive<=r-this._suffixLength){r-=c.replaceRange.length,a=!0;continue}if(c.equals(e)){a=!0,n=c.replaceRange.endExclusive,i=``;continue}if(!(c.replaceRange.start>r)){if(c.replaceRange.endExclusive<n){n+=c.newText.length-c.replaceRange.length,r+=c.newText.length-c.replaceRange.length;continue}return}}return this._trimmedNewText.length===0&&n+this._prefixLength===r-this._suffixLength?{edit:new yr(new ac(n+this._prefixLength,n+this._prefixLength),``),editHasChanged:!0}:{edit:new yr(new ac(n,r),i),editHasChanged:a}}};function gD(e,t){let n=t.getEOL();return e.replaceRange.isEmpty&&e.newText.includes(n)&&(e=vD(e,t)),e}function _D(e,t,n,r){let i=r.getEOL();if(e.newText.endsWith(i)&&t.endsWith(i)&&(e=new yr(e.replaceRange.deltaEnd(-i.length),e.newText.slice(0,-i.length))),n===1&&e.replaceRange.isEmpty&&e.newText.includes(i)){let t=r.getPositionAt(e.replaceRange.start);r.getLineLength(t.lineNumber)!==0&&(e=vD(e,r))}if(n===1){let n=Kt(t,e.newText),r=wn(t.slice(n),e.newText.slice(n));if(n+r===t.length)return new yr(e.replaceRange.deltaStart(n).deltaEnd(-r),e.newText.substring(n,e.newText.length-r));if(n+r===e.newText.length)return new yr(e.replaceRange.deltaStart(n).deltaEnd(-r),``)}return e}function vD(e,t){if(!e.replaceRange.isEmpty)throw new se(`Unexpected original range`);if(e.replaceRange.start===0)return e;let n=t.getEOL(),r=t.getPositionAt(e.replaceRange.start),i=r.column,a=r.lineNumber;return i===1&&a>1&&e.newText.endsWith(n)&&!e.newText.startsWith(n)?new yr(e.replaceRange.delta(-1),n+e.newText.slice(0,-n.length)):e}function yD(e,t){let n=new qe,r=new fi(n,e=>t.getLanguageConfiguration(e)),i=new nt(new bD([e]),r),a=Pu(i,[],void 0,!0),o=``,s=e.getLineContent();function c(e,t){if(e.kind===2)if(c(e.openingBracket,t),t=sr(t,e.openingBracket.length),e.child&&(c(e.child,t),t=sr(t,e.child.length)),e.closingBracket)c(e.closingBracket,t),t=sr(t,e.closingBracket.length);else{let t=r.getSingleLanguageBracketTokens(e.openingBracket.languageId).findClosingTokenText(e.openingBracket.bracketIds);o+=t}else if(e.kind!==3){if(e.kind===0||e.kind===1)o+=s.substring(oc(t),oc(sr(t,e.length)));else if(e.kind===4)for(let n of e.children)c(n,t),t=sr(t,n.length)}}return c(a,0),o}var bD=class{constructor(e){this.lines=e,this.tokenization={getLineTokens:e=>this.lines[e-1]}}getLineCount(){return this.lines.length}getLineLength(e){return this.lines[e-1].getLineContent().length}},xD=class e{constructor(){this._nodes=new Set,this._outgoingEdges=new Map}static from(t,n){let r=new e;for(let e of t)r._nodes.add(e);for(let e of t){let t=n(e);if(t.length>0){let n=new Set;for(let e of t)n.add(e);r._outgoingEdges.set(e,n)}}return r}removeCycles(){let e=[],t=new Set,n=new Set,r=[],i=a=>{t.add(a),n.add(a);let o=this._outgoingEdges.get(a);if(o)for(let s of o)t.has(s)?n.has(s)&&(e.push(s),r.push({from:a,to:s})):i(s);n.delete(a)};for(let e of this._nodes)t.has(e)||i(e);for(let{from:e,to:t}of r){let n=this._outgoingEdges.get(e);n&&n.delete(t)}return{foundCycles:e}}getOutgoing(e){let t=this._outgoingEdges.get(e);return t?Array.from(t):[]}},SD;(function(e){e.Jump=`jump`,e.Accept=`accept`,e.Inactive=`inactive`})(SD||={});var Q;(function(e){e.GhostText=`ghostText`,e.Custom=`custom`,e.SideBySide=`sideBySide`,e.Deletion=`deletion`,e.InsertionInline=`insertionInline`,e.InsertionMultiLine=`insertionMultiLine`,e.WordReplacements=`wordReplacements`,e.LineReplacement=`lineReplacement`,e.Collapsed=`collapsed`})(Q||={});function CD(e,t,n,r,i,a){let o=Na(`icr`),s=new Sr,c,l={...r,requestUuid:o},u=kD(t,n),d=Gu(e,e=>e.groupId),f=xD.from(e,e=>e.yieldsToGroupIds?.flatMap(e=>d.get(e)??[])??[]),{foundCycles:p}=f.removeCycles();p.length>0&&ct(Error(`Inline completions: cyclic yield-to dependency detected. Path: ${p.map(e=>e.toString?e.toString():``+e).join(` -> `)}`));let m=0,h=new Pl(async e=>{try{if(m++,s.token.isCancellationRequested)return;let r=f.getOutgoing(e);for(let e of r){let r=await h.get(e);if(r)for(let e of r.inlineSuggestions.items){if(e.isInlineEdit||typeof e.insertText!=`string`)return;let r=new Su(T.lift(e.range)??u,e.insertText);if(fD(r,void 0,n,t))return}}let o,d=Date.now();try{o=await e.provideInlineCompletions(n,t,l,s.token)}catch(e){ct(e);return}let p=Date.now();if(!o)return;let g=[],_=new OD(o,g,e);if(_.addRef(),wD(s.token,()=>_.removeRef(c)),s.token.isCancellationRequested)return;for(let e of o.items)g.push(TD(e,_,u,n,a,l,i,{startTime:d,endTime:p}));return _}finally{m--}}),g=ed.fromPromisesResolveOrder(e.map(e=>h.get(e))).filter(Qu);return{contextWithUuid:l,get didAllProvidersReturn(){return m===0},lists:g,cancelAndDispose:e=>{c===void 0&&(c=e,s.dispose(!0))}}}function wD(e,t){if(e.isCancellationRequested)return t(),x.None;{let n=e.onCancellationRequested(()=>{n.dispose(),t()});return{dispose:()=>n.dispose()}}}function TD(e,t,n,r,i,a,o,s){let c,l,u=e.range?T.lift(e.range):n;if(typeof e.insertText==`string`){if(c=e.insertText,i&&e.completeBracketPairs){c=AD(c,u.getStartPosition(),r,i);let t=c.length-e.insertText.length;t!==0&&(u=new T(u.startLineNumber,u.startColumn,u.endLineNumber,u.endColumn+t))}l=void 0}else if(`snippet`in e.insertText){let t=e.insertText.snippet.length;if(i&&e.completeBracketPairs){e.insertText.snippet=AD(e.insertText.snippet,u.getStartPosition(),r,i);let n=e.insertText.snippet.length-t;n!==0&&(u=new T(u.startLineNumber,u.startColumn,u.endLineNumber,u.endColumn+n))}let n=new Bm().parse(e.insertText.snippet);n.children.length===1&&n.children[0]instanceof jm?(c=n.children[0].value,l=void 0):(c=n.toString(),l={snippet:e.insertText.snippet,range:u})}else nr(e.insertText);let d=e.displayLocation?{range:T.lift(e.displayLocation.range),label:e.displayLocation.label,kind:e.displayLocation.kind}:void 0;return new ED(u,c,l,d,e.additionalTextEdits||EE(),e,t,a,e.isInlineEdit??!1,o,s,e.correlationId)}var ED=class{constructor(e,t,n,r,i,a,o,s,c,l,u,d){this.range=e,this.insertText=t,this.snippetInfo=n,this.displayLocation=r,this.additionalTextEdits=i,this.sourceInlineCompletion=a,this.source=o,this.context=s,this.isInlineEdit=c,this._requestInfo=l,this._providerRequestInfo=u,this._correlationId=d,this._didShow=!1,this._timeUntilShown=void 0,this._showStartTime=void 0,this._shownDuration=0,this._showUncollapsedStartTime=void 0,this._showUncollapsedDuration=0,this._notShownReason=void 0,this._didReportEndOfLife=!1,this._lastSetEndOfLifeReason=void 0,this._isPreceeded=!1,this._partiallyAcceptedCount=0,this._partiallyAcceptedSinceOriginal={characters:0,ratio:0,count:0},this._viewData={editorType:l.editorType}}get showInlineEditMenu(){return this.sourceInlineCompletion.showInlineEditMenu??!1}get partialAccepts(){return this._partiallyAcceptedSinceOriginal}async reportInlineEditShown(e,t,n,r){if(this.updateShownDuration(n),this._didShow)return;this._didShow=!0,this._viewData.viewKind=n,this._viewData.renderData=r,this._timeUntilShown=Date.now()-this._requestInfo.startTime;let i=new ei(r.lineCountModified,r.lineCountOriginal,r.characterCountModified,r.characterCountOriginal);this.source.provider.handleItemDidShow?.(this.source.inlineSuggestions,this.sourceInlineCompletion,t,i),this.sourceInlineCompletion.shownCommand&&await e.executeCommand(this.sourceInlineCompletion.shownCommand.id,...this.sourceInlineCompletion.shownCommand.arguments||[])}reportPartialAccept(e,t,n){this._partiallyAcceptedCount++,this._partiallyAcceptedSinceOriginal.characters+=n.characters,this._partiallyAcceptedSinceOriginal.ratio=Math.min(this._partiallyAcceptedSinceOriginal.ratio+(1-this._partiallyAcceptedSinceOriginal.ratio)*n.ratio,1),this._partiallyAcceptedSinceOriginal.count+=n.count,this.source.provider.handlePartialAccept?.(this.source.inlineSuggestions,this.sourceInlineCompletion,e,t)}reportEndOfLife(e){if(!this._didReportEndOfLife&&(this._didReportEndOfLife=!0,this.reportInlineEditHidden(),e||=this._lastSetEndOfLifeReason??{kind:dl.Ignored,userTypingDisagreed:!1,supersededBy:void 0},e.kind===dl.Rejected&&this.source.provider.handleRejection&&this.source.provider.handleRejection(this.source.inlineSuggestions,this.sourceInlineCompletion),this.source.provider.handleEndOfLifetime)){let t={requestUuid:this.context.requestUuid,correlationId:this._correlationId,selectedSuggestionInfo:!!this.context.selectedSuggestionInfo,partiallyAccepted:this._partiallyAcceptedCount,partiallyAcceptedCountSinceOriginal:this._partiallyAcceptedSinceOriginal.count,partiallyAcceptedRatioSinceOriginal:this._partiallyAcceptedSinceOriginal.ratio,partiallyAcceptedCharactersSinceOriginal:this._partiallyAcceptedSinceOriginal.characters,shown:this._didShow,shownDuration:this._shownDuration,shownDurationUncollapsed:this._showUncollapsedDuration,preceeded:this._isPreceeded,timeUntilShown:this._timeUntilShown,timeUntilProviderRequest:this._providerRequestInfo.startTime-this._requestInfo.startTime,timeUntilProviderResponse:this._providerRequestInfo.endTime-this._requestInfo.startTime,editorType:this._viewData.editorType,languageId:this._requestInfo.languageId,requestReason:this._requestInfo.reason,viewKind:this._viewData.viewKind,notShownReason:this._notShownReason,error:this._viewData.error,typingInterval:this._requestInfo.typingInterval,typingIntervalCharacterCount:this._requestInfo.typingIntervalCharacterCount,availableProviders:this._requestInfo.availableProviders.map(e=>e.toString()).join(`,`),...this._viewData.renderData};this.source.provider.handleEndOfLifetime(this.source.inlineSuggestions,this.sourceInlineCompletion,e,t)}}reportInlineEditError(e){this._viewData.error?this._viewData.error+=`; ${e}`:this._viewData.error=e}setIsPreceeded(e){this._isPreceeded=!0,(this._partiallyAcceptedSinceOriginal.characters!==0||this._partiallyAcceptedSinceOriginal.ratio!==0||this._partiallyAcceptedSinceOriginal.count!==0)&&console.warn(`Expected partiallyAcceptedCountSinceOriginal to be { characters: 0, rate: 0, partialAcceptances: 0 } before setIsPreceeded.`),this._partiallyAcceptedSinceOriginal=e}setNotShownReason(e){this._notShownReason??=e}setEndOfLifeReason(e){this.reportInlineEditHidden(),this._lastSetEndOfLifeReason=e}updateShownDuration(e){let t=Date.now();this._showStartTime||=t;let n=e===Q.Collapsed;!n&&this._showUncollapsedStartTime===void 0&&(this._showUncollapsedStartTime=t),n&&this._showUncollapsedStartTime!==void 0&&(this._showUncollapsedDuration+=t-this._showUncollapsedStartTime)}reportInlineEditHidden(){if(this._showStartTime===void 0)return;let e=Date.now();this._shownDuration+=e-this._showStartTime,this._showStartTime=void 0,this._showUncollapsedStartTime!==void 0&&(this._showUncollapsedDuration+=e-this._showUncollapsedStartTime,this._showUncollapsedStartTime=void 0)}},DD;(function(e){e.TextEditor=`textEditor`,e.DiffEditor=`diffEditor`,e.Notebook=`notebook`})(DD||={});var OD=class{constructor(e,t,n){this.inlineSuggestions=e,this.inlineSuggestionsData=t,this.provider=n,this.refCount=0}addRef(){this.refCount++}removeRef(e={kind:`other`}){if(this.refCount--,this.refCount===0){for(let e of this.inlineSuggestionsData)e.reportEndOfLife();this.provider.disposeInlineCompletions(this.inlineSuggestions,e)}}};function kD(e,t){let n=t.getWordAtPosition(e),r=t.getLineMaxColumn(e.lineNumber);return n?new T(e.lineNumber,n.startColumn,e.lineNumber,r):T.fromPositions(e,e.with(void 0,r))}function AD(e,t,n,r){let i=n.getLineContent(t.lineNumber),a=yr.replace(new ac(t.column-1,i.length),e),o=n.tokenization.tokenizeLinesAt(t.lineNumber,[a.replace(i)])?.[0].sliceZeroCopy(a.getRangeAfterReplace());return o?yD(o,r):e}var jD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},MD=function(e,t){return function(n,r){t(n,r,e)}},ND,PD=class extends x{static{ND=this}static{this._requestId=0}constructor(e,t,n,r,i,a,o,s){super(),this._textModel=e,this._versionId=t,this._debounceValue=n,this._cursorPosition=r,this._languageConfigurationService=i,this._logService=a,this._configurationService=o,this._instantiationService=s,this._updateOperation=this._register(new Bt),this._state=ZE(this,{initial:()=>({inlineCompletions:zD.createEmpty(),suggestWidgetInlineCompletions:zD.createEmpty()}),disposeFinal:e=>{e.inlineCompletions.dispose(),e.suggestWidgetInlineCompletions.dispose()},changeTracker:ld(()=>({versionId:this._versionId})),update:(e,t,n)=>{let r=Xn.compose(n.changes.map(e=>e.change?aD(e.change.changes):Xn.empty).filter(Qu));if(r.isEmpty())return t;try{return{inlineCompletions:t.inlineCompletions.createStateWithAppliedEdit(r,this._textModel),suggestWidgetInlineCompletions:t.suggestWidgetInlineCompletions.createStateWithAppliedEdit(r,this._textModel)}}finally{t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()}}}),this.inlineCompletions=this._state.map(this,e=>e.inlineCompletions),this.suggestWidgetInlineCompletions=this._state.map(this,e=>e.suggestWidgetInlineCompletions),this.clearOperationOnTextModelChange=O(this,e=>{this._versionId.read(e),this._updateOperation.clear()}),this._loadingCount=kl(this,0),this._loggingEnabled=Di(`editor.inlineSuggest.logFetch`,!1,this._configurationService).recomputeInitiallyAndOnChange(this._store),this._sendRequestData=Di(`editor.inlineSuggest.emptyResponseInformation`,!0,this._configurationService).recomputeInitiallyAndOnChange(this._store),this._structuredFetchLogger=this._register(this._instantiationService.createInstance(YT.cast(),`editor.inlineSuggest.logFetch.commandId`)),this.clearOperationOnTextModelChange.recomputeInitiallyAndOnChange(this._store)}_log(e){this._loggingEnabled.get()&&this._logService.info(JT(e)),this._structuredFetchLogger.log(e)}fetch(e,t,n,r,i,a,o){let s=this._cursorPosition.get(),c=new FD(s,n,this._textModel.getVersionId(),new Set(e)),l=n.selectedSuggestionInfo?this.suggestWidgetInlineCompletions.get():this.inlineCompletions.get();if(this._updateOperation.value?.request.satisfies(c))return this._updateOperation.value.promise;if(l?.request?.satisfies(c))return Promise.resolve(!0);let u=!!this._updateOperation.value;this._updateOperation.clear();let d=new Sr,f=(async()=>{this._loadingCount.set(this._loadingCount.get()+1,void 0);let s=new L,l=e.filter(e=>e.providerId),f=new ID(n,o,l);try{let l=this._debounceValue.get(this._textModel),p=Ke(e.map(e=>e.debounceDelayMs),vi(ca))??l;if((u||i&&n.triggerKind===jc.Automatic)&&await ME(p,d.token),d.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId)return f.setNoSuggestionReasonIfNotSet(`canceled:beforeFetch`),!1;let m=ND._requestId++;(this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get())&&this._log({sourceId:`InlineCompletions.fetch`,kind:`start`,requestId:m,modelUri:this._textModel.uri,modelVersion:this._textModel.getVersionId(),context:{triggerKind:n.triggerKind,suggestInfo:n.selectedSuggestionInfo?!0:void 0},time:Date.now(),provider:t});let h=new Date,g=CD(e,this._cursorPosition.get(),this._textModel,n,o,this._languageConfigurationService);wD(d.token,()=>g.cancelAndDispose({kind:`tokenCancellation`}));let _=!1,ee=!1,v=[];for await(let e of g.lists)if(e){e.addRef(),s.add(Cl(()=>e.removeRef(e.inlineSuggestionsData.length===0?{kind:`empty`}:{kind:`notTaken`})));for(let t of e.inlineSuggestionsData){if(ee=!0,!n.includeInlineEdits&&(t.isInlineEdit||t.showInlineEditMenu)){t.setNotShownReason(`notInlineEditRequested`);continue}if(!n.includeInlineCompletions&&!(t.isInlineEdit||t.showInlineEditMenu)){t.setNotShownReason(`notInlineCompletionRequested`);continue}let e=sD.create(t,this._textModel);v.push(e),!e.isInlineEdit&&!e.showInlineEditMenu&&n.triggerKind===jc.Automatic&&e.isVisible(this._textModel,this._cursorPosition.get())&&(_=!0)}if(_)break}if(g.cancelAndDispose({kind:`lostRace`}),this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get()){let e=g.didAllProvidersReturn,t;(d.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId)&&(t=`canceled`);let n=v.map(e=>({range:e.editRange.toString(),text:e.insertText,isInlineEdit:!!e.isInlineEdit,source:e.source.provider.groupId}));this._log({sourceId:`InlineCompletions.fetch`,kind:`end`,requestId:m,durationMs:Date.now()-h.getTime(),error:t,result:n,time:Date.now(),didAllProvidersReturn:e})}f.setRequestUuid(g.contextWithUuid.requestUuid),ee?(f.setHasProducedSuggestion(),v.length>0&&d.token.isCancellationRequested&&v.forEach(e=>e.setNotShownReasonIfNotSet(`canceled:whileAwaitingOtherProviders`))):d.token.isCancellationRequested?f.setNoSuggestionReasonIfNotSet(`canceled:whileFetching`):f.setNoSuggestionReasonIfNotSet(`noSuggestion`);let te=n.earliestShownDateTime-Date.now();if(te>0&&await ME(te,d.token),d.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId||a.get()){let e=d.token.isCancellationRequested?`canceled:afterMinShowDelay`:this._store.isDisposed?`canceled:disposed`:this._textModel.getVersionId()===c.versionId?a.get()?`canceled:userJumped`:`unknown`:`canceled:documentChanged`;return v.forEach(t=>t.setNotShownReasonIfNotSet(e)),!1}let y=new Date;this._debounceValue.update(this._textModel,y.getTime()-h.getTime());let b=this._cursorPosition.get();this._updateOperation.clear(),Bl(e=>{let t=this._state.get();n.selectedSuggestionInfo?this._state.set({inlineCompletions:zD.createEmpty(),suggestWidgetInlineCompletions:t.suggestWidgetInlineCompletions.createStateWithAppliedResults(v,c,this._textModel,b,r)},e):this._state.set({inlineCompletions:t.inlineCompletions.createStateWithAppliedResults(v,c,this._textModel,b,r),suggestWidgetInlineCompletions:zD.createEmpty()},e),t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()})}finally{this._loadingCount.set(this._loadingCount.get()-1,void 0),s.dispose(),this.sendInlineCompletionsRequestTelemetry(f)}return!0})(),p=new RD(c,d,f);return this._updateOperation.value=p,f}clear(e){this._updateOperation.clear();let t=this._state.get();this._state.set({inlineCompletions:zD.createEmpty(),suggestWidgetInlineCompletions:zD.createEmpty()},e),t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()}seedInlineCompletionsWithSuggestWidget(){let e=this.inlineCompletions.get(),t=this.suggestWidgetInlineCompletions.get();t&&Bl(n=>{if(!e||(t.request?.versionId??-1)>(e.request?.versionId??-1)){e?.dispose();let r=this._state.get();this._state.set({inlineCompletions:t.clone(),suggestWidgetInlineCompletions:zD.createEmpty()},n),r.inlineCompletions.dispose(),r.suggestWidgetInlineCompletions.dispose()}this.clearSuggestWidgetInlineCompletions(n)})}sendInlineCompletionsRequestTelemetry(e){if(!this._sendRequestData.get()||e.requestUuid===void 0||e.hasProducedSuggestion)return;let t={id:e.requestUuid,opportunityId:e.requestUuid,noSuggestionReason:e.noSuggestionReason??`unknown`,extensionId:`vscode-core`,extensionVersion:`0.0.0`,groupId:`empty`,shown:!1,editorType:e.requestInfo.editorType,requestReason:e.requestInfo.reason,typingInterval:e.requestInfo.typingInterval,typingIntervalCharacterCount:e.requestInfo.typingIntervalCharacterCount,languageId:e.requestInfo.languageId,selectedSuggestionInfo:!!e.context.selectedSuggestionInfo,availableProviders:e.providers.map(e=>e.providerId?.toString()).filter(Qu).join(`,`),...rD(e.providers.some(e=>iD(e.providerId?.extensionId))),timeUntilProviderRequest:void 0,timeUntilProviderResponse:void 0,viewKind:void 0,preceeded:void 0,error:void 0,superseded:void 0,reason:void 0,correlationId:void 0,shownDuration:void 0,shownDurationUncollapsed:void 0,timeUntilShown:void 0,partiallyAccepted:void 0,partiallyAcceptedCountSinceOriginal:void 0,partiallyAcceptedRatioSinceOriginal:void 0,partiallyAcceptedCharactersSinceOriginal:void 0,cursorColumnDistance:void 0,cursorLineDistance:void 0,lineCountOriginal:void 0,lineCountModified:void 0,characterCountOriginal:void 0,characterCountModified:void 0,disjointReplacements:void 0,sameShapeReplacements:void 0,notShownReason:void 0},n=this._instantiationService.createInstance(tD);oD(n,t)}clearSuggestWidgetInlineCompletions(e){this._updateOperation.value?.request.context.selectedSuggestionInfo&&this._updateOperation.clear()}cancelUpdate(){this._updateOperation.clear()}};PD=ND=jD([MD(4,Ce),MD(5,Wl),MD(6,hn),MD(7,k)],PD);var FD=class{constructor(e,t,n,r){this.position=e,this.context=t,this.versionId=n,this.providers=r}satisfies(e){return this.position.equals(e.position)&&ho(this.context.selectedSuggestionInfo,e.context.selectedSuggestionInfo,hc())&&(e.context.triggerKind===jc.Automatic||this.context.triggerKind===jc.Explicit)&&this.versionId===e.versionId&&LD(e.providers,this.providers)}},ID=class{constructor(e,t,n){this.context=e,this.requestInfo=t,this.providers=n,this.hasProducedSuggestion=!1}setRequestUuid(e){this.requestUuid=e}setNoSuggestionReasonIfNotSet(e){this.noSuggestionReason??=e}setHasProducedSuggestion(){this.hasProducedSuggestion=!0}};function LD(e,t){return[...e].every(e=>t.has(e))}var RD=class{constructor(e,t,n){this.request=e,this.cancellationTokenSource=t,this.promise=n}dispose(){this.cancellationTokenSource.cancel()}},zD=class e extends x{static createEmpty(){return new e([],void 0)}constructor(e,t){for(let t of e)t.addRef();super(),this.inlineCompletions=e,this.request=t,this._register({dispose:()=>{for(let e of this.inlineCompletions)e.removeRef()}})}_findById(e){return this.inlineCompletions.find(t=>t.identity===e)}_findByHash(e){return this.inlineCompletions.find(t=>t.hash===e)}createStateWithAppliedEdit(t,n){let r=this.inlineCompletions.map(e=>e.withEdit(t,n)).filter(Qu);return new e(r,this.request)}createStateWithAppliedResults(t,n,r,i,a){let o;if(a){let e=this._findById(a);if(e&&e.canBeReused(r,n.position)){o=e;let n=t.find(t=>t.hash===e.hash);t=n?VD(n,t):[e,...t]}}let s=o?!o.isInlineEdit:t.some(e=>!e.isInlineEdit&&e.isVisible(r,i)),c=[];for(let e of t){let t=this._findByHash(e.hash),n;t&&t!==e?(n=e.withIdentity(t.identity),e.setIsPreceeded(t),t.setEndOfLifeReason({kind:dl.Ignored,userTypingDisagreed:!1,supersededBy:e.getSourceCompletion()})):n=e,s!==n.isInlineEdit&&c.push(n)}return c.sort(Mt(e=>e.showInlineEditMenu,ye)),c=BD(c,e=>e.semanticId),new e(c,n)}clone(){return new e(this.inlineCompletions,this.request)}};function BD(e,t){let n=new Set;return e.filter(e=>{let r=t(e);return n.has(r)?!1:(n.add(r),!0)})}function VD(e,t){let n=t.indexOf(e);return n>-1?[e,...t.slice(0,n),...t.slice(n+1)]:t}var HD=class{constructor(e,t,n){this.edit=e,this.commands=t,this.inlineCompletion=n}equals(e){return this.edit.equals(e.edit)&&this.inlineCompletion===e.inlineCompletion}},UD=class e extends x{static{this.MAX_SESSION_GAP_MS=3e3}static{this.MIN_SESSION_DURATION_MS=1e3}static{this.SESSION_HISTORY_LIMIT=50}static{this.TYPING_SPEED_WINDOW_MS=3e5}static{this.MIN_CHARS_FOR_RELIABLE_SPEED=20}getTypingInterval(){return(this._cacheInvalidated||this._cachedTypingIntervalResult===null)&&(this._cachedTypingIntervalResult=this._calculateTypingInterval(),this._cacheInvalidated=!1),this._cachedTypingIntervalResult}constructor(e){super(),this._textModel=e,this._typingSessions=[],this._currentSession=null,this._lastChangeTime=0,this._cachedTypingIntervalResult=null,this._cacheInvalidated=!0,this._register(this._textModel.onDidChangeContent(e=>this._updateTypingSpeed(e)))}_updateTypingSpeed(t){let n=Date.now();if(!this._isUserTyping(t)){this._finalizeCurrentSession();return}this._currentSession&&n-this._lastChangeTime>e.MAX_SESSION_GAP_MS&&this._finalizeCurrentSession(),this._currentSession||={startTime:n,endTime:n,characterCount:0},this._currentSession.endTime=n,this._currentSession.characterCount+=this._getActualCharacterCount(t),this._lastChangeTime=n,this._cacheInvalidated=!0}_getActualCharacterCount(e){let t=0;for(let n of e.changes)t+=Math.max(n.text.length,n.rangeLength);return t}_isUserTyping(e){if(!e.detailedReasons||e.detailedReasons.length===0)return!1;for(let t of e.detailedReasons)if(this._isUserTypingReason(t))return!0;return!1}_isUserTypingReason(e){if(e.metadata.isUndoing||e.metadata.isRedoing)return!1;switch(e.metadata.source){case`cursor`:{let t=e.metadata.kind;return t===`type`||t===`compositionType`||t===`compositionEnd`}default:return!1}}_finalizeCurrentSession(){this._currentSession&&=(this._currentSession.endTime-this._currentSession.startTime>=e.MIN_SESSION_DURATION_MS&&this._currentSession.characterCount>0&&(this._typingSessions.push(this._currentSession),this._typingSessions.length>e.SESSION_HISTORY_LIMIT&&this._typingSessions.shift()),null)}_calculateTypingInterval(){if(this._currentSession){let t={...this._currentSession};if(t.endTime-t.startTime>=e.MIN_SESSION_DURATION_MS&&t.characterCount>0){let e=[...this._typingSessions,t];return this._calculateSpeedFromSessions(e)}}return this._calculateSpeedFromSessions(this._typingSessions)}_calculateSpeedFromSessions(t){if(t.length===0)return{averageInterval:0,characterCount:0};let n=[...t].sort((e,t)=>t.endTime-e.endTime),r=Date.now()-e.TYPING_SPEED_WINDOW_MS,i=n.filter(e=>e.endTime>r),a=n.splice(i.length),o=Er(i.map(e=>e.characterCount));for(let t=0;t<a.length&&o<e.MIN_CHARS_FOR_RELIABLE_SPEED;t++)i.push(a[t]),o+=a[t].characterCount;let s=Er(i.map(e=>e.endTime-e.startTime));if(s===0||o<=1)return{averageInterval:0,characterCount:o};let c=Math.max(1,o-1),l=s/c;return{averageInterval:Math.round(l),characterCount:o}}dispose(){this._finalizeCurrentSession(),super.dispose()}},WD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},GD=function(e,t){return function(n,r){t(n,r,e)}},KD=class extends x{get isAcceptingPartially(){return this._isAcceptingPartially}constructor(e,t,n,r,i,a,o,s,c,l,u,d,f,p){super(),this.textModel=e,this._selectedSuggestItem=t,this._textModelVersionId=n,this._positions=r,this._debounceValue=i,this._enabled=a,this._editor=o,this._instantiationService=s,this._commandService=c,this._languageConfigurationService=l,this._accessibilityService=u,this._languageFeaturesService=d,this._codeEditorService=f,this._inlineCompletionsService=p,this._isActive=kl(this,!1),this._onlyRequestInlineEditsSignal=Ri(this),this._forceUpdateExplicitlySignal=Ri(this),this._noDelaySignal=Ri(this),this._fetchSpecificProviderSignal=Ri(this),this._selectedInlineCompletionId=kl(this,void 0),this.primaryPosition=O(this,e=>this._positions.read(e)[0]??new C(1,1)),this._isAcceptingPartially=!1,this._appearedInsideViewport=O(this,e=>{let t=this.state.read(e);if(!t||!t.inlineCompletion)return!1;let n=t.inlineCompletion.targetRange,r=this._editorObs.editor.getVisibleRanges();return r.length<1?!1:new T(r[0].startLineNumber,r[0].startColumn,r[r.length-1].endLineNumber,r[r.length-1].endColumn).containsRange(n)}),this._onDidAccept=new D,this.onDidAccept=this._onDidAccept.event,this._lastShownInlineCompletionInfo=void 0,this._lastAcceptedInlineCompletionInfo=void 0,this._didUndoInlineEdits=Xi({owner:this,changeTracker:{createChangeSummary:()=>({didUndo:!1}),handleChange:(e,t)=>(t.didUndo=e.didChange(this._textModelVersionId)&&!!e.change?.isUndoing,!0)}},(e,t)=>{let n=this._textModelVersionId.read(e);return n!==null&&this._lastAcceptedInlineCompletionInfo&&this._lastAcceptedInlineCompletionInfo.textModelVersionIdAfter===n-1&&this._lastAcceptedInlineCompletionInfo.inlineCompletion.isInlineEdit&&t.didUndo?(this._lastAcceptedInlineCompletionInfo=void 0,!0):!1}),this._preserveCurrentCompletionReasons=new Set([qD.Redo,qD.Undo,qD.AcceptWord]),this.dontRefetchSignal=Ri(this),this._fetchInlineCompletionsPromise=Xi({owner:this,changeTracker:{createChangeSummary:()=>({dontRefetch:!1,preserveCurrentCompletion:!1,inlineCompletionTriggerKind:jc.Automatic,onlyRequestInlineEdits:!1,shouldDebounce:!0,provider:void 0,textChange:!1,changeReason:``}),handleChange:(e,t)=>{if(e.didChange(this._textModelVersionId)){this._preserveCurrentCompletionReasons.has(this._getReason(e.change))&&(t.preserveCurrentCompletion=!0);let n=e.change?.detailedReasons??[];t.changeReason=n.length>0?n[0].getType():``,t.textChange=!0}else e.didChange(this._forceUpdateExplicitlySignal)?(t.preserveCurrentCompletion=!0,t.inlineCompletionTriggerKind=jc.Explicit):e.didChange(this.dontRefetchSignal)?t.dontRefetch=!0:e.didChange(this._onlyRequestInlineEditsSignal)?t.onlyRequestInlineEdits=!0:e.didChange(this._fetchSpecificProviderSignal)&&(t.provider=e.change);return!0}}},(e,t)=>{if(this._source.clearOperationOnTextModelChange.read(e),this._noDelaySignal.read(e),this.dontRefetchSignal.read(e),this._onlyRequestInlineEditsSignal.read(e),this._forceUpdateExplicitlySignal.read(e),this._fetchSpecificProviderSignal.read(e),!((this._enabled.read(e)&&this._selectedSuggestItem.read(e)||this._isActive.read(e))&&(!this._inlineCompletionsService.isSnoozing()||t.inlineCompletionTriggerKind===jc.Explicit))){this._source.cancelUpdate();return}this._textModelVersionId.read(e);let n=this._source.suggestWidgetInlineCompletions.read(void 0),r=this._selectedSuggestItem.read(e);if(this._shouldShowOnSuggestConflict.read(void 0)&&(r=void 0),n&&!r&&this._source.seedInlineCompletionsWithSuggestWidget(),t.dontRefetch)return Promise.resolve(!0);if(this._didUndoInlineEdits.read(e)&&t.inlineCompletionTriggerKind!==jc.Explicit){Bl(e=>{this._source.clear(e)});return}let i=``;t.provider?i+=`providerOnDidChange`:t.inlineCompletionTriggerKind===jc.Explicit&&(i+=`explicit`),t.changeReason&&(i+=i.length>0?`:${t.changeReason}`:t.changeReason);let a=this._typing.getTypingInterval(),o={editorType:this.editorType,startTime:Date.now(),languageId:this.textModel.getLanguageId(),reason:i,typingInterval:a.averageInterval,typingIntervalCharacterCount:a.characterCount,availableProviders:[]},s={triggerKind:t.inlineCompletionTriggerKind,selectedSuggestionInfo:r?.toSelectedSuggestionInfo(),includeInlineCompletions:!t.onlyRequestInlineEdits,includeInlineEdits:this._inlineEditsEnabled.read(e),requestIssuedDateTime:o.startTime,earliestShownDateTime:o.startTime+(t.inlineCompletionTriggerKind===jc.Explicit||this.inAcceptFlow.read(void 0)?0:this._minShowDelay.read(void 0))};s.triggerKind===jc.Automatic&&t.textChange&&this.textModel.getAlternativeVersionId()===this._lastShownInlineCompletionInfo?.alternateTextModelVersionId&&(s={...s,includeInlineCompletions:!this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit,includeInlineEdits:this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit});let c=this.selectedInlineCompletion.read(void 0)??this._inlineCompletionItems.read(void 0)?.inlineEdit,l=t.preserveCurrentCompletion||c?.forwardStable?c:void 0,u=this._jumpedToId.map(e=>!!e&&e===this._inlineCompletionItems.read(void 0)?.inlineEdit?.semanticId),d=t.provider?{providers:[t.provider],label:`single:`+t.provider.providerId?.toString()}:{providers:this._languageFeaturesService.inlineCompletionsProvider.all(this.textModel),label:void 0},f=this.getAvailableProviders(d.providers);return o.availableProviders=f.map(e=>e.providerId).filter(Qu),this._source.fetch(f,d.label,s,l?.identity,t.shouldDebounce,u,o)}),this._inlineCompletionItems=ya({owner:this},e=>{let t=this._source.inlineCompletions.read(e);if(!t)return;let n=this.primaryPosition.read(e),r,i=[];for(let e of t.inlineCompletions)e.isInlineEdit?r=e:e.isVisible(this.textModel,n)&&i.push(e);return i.length!==0&&(r=void 0),{inlineCompletions:i,inlineEdit:r}}),this._filteredInlineCompletionItems=ya({owner:this,equalsFn:lu()},e=>this._inlineCompletionItems.read(e)?.inlineCompletions??[]),this.selectedInlineCompletionIndex=O(this,e=>{let t=this._selectedInlineCompletionId.read(e),n=this._filteredInlineCompletionItems.read(e),r=this._selectedInlineCompletionId===void 0?-1:n.findIndex(e=>e.semanticId===t);return r===-1?(this._selectedInlineCompletionId.set(void 0,void 0),0):r}),this.selectedInlineCompletion=O(this,e=>{let t=this._filteredInlineCompletionItems.read(e),n=this.selectedInlineCompletionIndex.read(e);return t[n]}),this.activeCommands=ya({owner:this,equalsFn:lu()},e=>this.selectedInlineCompletion.read(e)?.source.inlineSuggestions.commands??[]),this.inlineCompletionsCount=O(this,e=>{if(this.lastTriggerKind.read(e)===jc.Explicit)return this._filteredInlineCompletionItems.read(e).length}),this._hasVisiblePeekWidgets=O(this,e=>this._editorObs.openedPeekWidgets.read(e)>0),this._shouldShowOnSuggestConflict=O(this,e=>{let t=this._showOnSuggestConflict.read(e);if(t!==`never`&&this.selectedInlineCompletion.read(e)){let n=this._selectedSuggestItem.read(e);return n?t===`whenSuggestListIsIncomplete`?n.listIncomplete:!0:!1}return!1}),this.state=ya({owner:this,equalsFn:(e,t)=>!e||!t?e===t:e.kind===`ghostText`&&t.kind===`ghostText`?VE(e.ghostTexts,t.ghostTexts)&&e.inlineCompletion===t.inlineCompletion&&e.suggestItem===t.suggestItem:e.kind===`inlineEdit`&&t.kind===`inlineEdit`?e.inlineEdit.equals(t.inlineEdit):!1},e=>{let t=this.textModel;if(this._suppressInSnippetMode.read(e)&&this._isInSnippetMode.read(e))return;let n=this._inlineCompletionItems.read(e),r=n?.inlineEdit;if(r){if(this._hasVisiblePeekWidgets.read(e))return;let i=r.getSingleTextEdit();i=UE(i,t);let a=this.primaryPosition.map(e=>$r.fromRangeInclusive(r.targetRange).addMargin(1,1).contains(e.lineNumber)),o=r.source.inlineSuggestions.commands,s=new HD(i,o??[],r),c=r.updatedEdit,l=c?Ia.fromStringEdit(c,new $n(this.textModel)).replacements:[i],u=(n.inlineEdit?.command?.id===`vscode.open`||n.inlineEdit?.command?.id===`_workbench.open`)&&n.inlineEdit?.command.arguments?.length?ur.from(n.inlineEdit?.command.arguments[0]):void 0;return{kind:`inlineEdit`,inlineEdit:s,inlineCompletion:r,edits:l,cursorAtInlineEdit:a,nextEditUri:u}}let i=this._selectedSuggestItem.read(e);if(!this._shouldShowOnSuggestConflict.read(e)&&i){let n=UE(i.getSingleTextEdit(),t),r=this._computeAugmentation(n,e);if(!this._suggestPreviewEnabled.read(e)&&!r)return;let a=r?.edit??n,o=r?r.edit.text.length-n.text.length:0,s=this._suggestPreviewMode.read(e),c=this._positions.read(e),l=[a,...JD(this.textModel,c,a)].map((e,n)=>({edit:e,ghostText:e?KE(e,t,s,c[n],o):void 0})).filter(({edit:e,ghostText:t})=>e!==void 0&&t!==void 0),u=l.map(({edit:e})=>e),d=l.map(({ghostText:e})=>e),f=d[0]??new RE(a.range.endLineNumber,[]);return{kind:`ghostText`,edits:u,primaryGhostText:f,ghostTexts:d,inlineCompletion:r?.completion,suggestItem:i}}else{if(!this._isActive.read(e))return;let n=this.selectedInlineCompletion.read(e);if(!n)return;let r=n.getSingleTextEdit(),i=this._inlineSuggestMode.read(e),a=this._positions.read(e),o=[r,...JD(this.textModel,a,r)].map((e,n)=>({edit:e,ghostText:e?KE(e,t,i,a[n],0):void 0})).filter(({edit:e,ghostText:t})=>e!==void 0&&t!==void 0),s=o.map(({edit:e})=>e),c=o.map(({ghostText:e})=>e);return c[0]?{kind:`ghostText`,edits:s,primaryGhostText:c[0],ghostTexts:c,inlineCompletion:n,suggestItem:void 0}:void 0}}),this.inlineCompletionState=O(this,e=>{let t=this.state.read(e);if(!(!t||t.kind!==`ghostText`)&&!this._editorObs.inComposition.read(e))return t}),this.inlineEditState=O(this,e=>{let t=this.state.read(e);if(!(!t||t.kind!==`inlineEdit`))return t}),this.inlineEditAvailable=O(this,e=>!!this.inlineEditState.read(e)),this.warning=O(this,e=>this.inlineCompletionState.read(e)?.inlineCompletion?.warning),this.ghostTexts=ya({owner:this,equalsFn:VE},e=>{let t=this.inlineCompletionState.read(e);if(t)return t.ghostTexts}),this.primaryGhostText=ya({owner:this,equalsFn:HE},e=>{let t=this.inlineCompletionState.read(e);if(t)return t?.primaryGhostText}),this.showCollapsed=O(this,e=>{let t=this.state.read(e);if(!t||t.kind!==`inlineEdit`||t.inlineCompletion.displayLocation)return!1;let n=t.inlineCompletion.updatedEditModelVersion===this._textModelVersionId.read(e);return(this._inlineEditsShowCollapsedEnabled.read(e)||!n)&&this._jumpedToId.read(e)!==t.inlineCompletion.semanticId&&!this._inAcceptFlow.read(e)}),this._tabShouldIndent=O(this,e=>{if(this._inAcceptFlow.read(e))return!1;function t(e){return e.startLineNumber!==e.endLineNumber}function n(e,t){let n=e.getLineIndentColumn(t),r=e.getLineLastNonWhitespaceColumn(t);return new T(t,n,t,Math.max(r,n))}return this._editorObs.selections.read(e)?.some(e=>e.isEmpty()?this.textModel.getLineLength(e.startLineNumber)===0:t(e)||e.containsRange(n(this.textModel,e.startLineNumber)))}),this.tabShouldJumpToInlineEdit=O(this,e=>{if(this._tabShouldIndent.read(e))return!1;let t=this.inlineEditState.read(e);return t?this.showCollapsed.read(e)?!0:this._inAcceptFlow.read(e)&&this._appearedInsideViewport.read(e)?!1:!t.cursorAtInlineEdit.read(e):!1}),this.tabShouldAcceptInlineEdit=O(this,e=>{let t=this.inlineEditState.read(e);return!t||this.showCollapsed.read(e)?!1:this._inAcceptFlow.read(e)&&this._appearedInsideViewport.read(e)||t.inlineCompletion.targetRange.startLineNumber===this._editorObs.cursorLineNumber.read(e)||this._jumpedToId.read(e)===t.inlineCompletion.semanticId?!0:this._tabShouldIndent.read(e)?!1:t.cursorAtInlineEdit.read(e)}),this._jumpedToId=kl(this,void 0),this._inAcceptFlow=kl(this,!1),this.inAcceptFlow=this._inAcceptFlow,this._source=this._register(this._instantiationService.createInstance(PD,this.textModel,this._textModelVersionId,this._debounceValue,this.primaryPosition)),this.lastTriggerKind=this._source.inlineCompletions.map(this,e=>e?.request?.context.triggerKind),this._editorObs=Bs(this._editor);let m=this._editorObs.getOption(134);this._suggestPreviewEnabled=m.map(e=>e.preview),this._suggestPreviewMode=m.map(e=>e.previewMode);let h=this._editorObs.getOption(71);this._inlineSuggestMode=h.map(e=>e.mode),this._suppressedInlineCompletionGroupIds=h.map(e=>new Set(e.experimental.suppressInlineSuggestions.split(`,`))),this._inlineEditsEnabled=h.map(e=>!!e.edits.enabled),this._inlineEditsShowCollapsedEnabled=h.map(e=>e.edits.showCollapsed),this._triggerCommandOnProviderChange=h.map(e=>e.triggerCommandOnProviderChange),this._minShowDelay=h.map(e=>e.minShowDelay),this._showOnSuggestConflict=h.map(e=>e.experimental.showOnSuggestConflict),this._suppressInSnippetMode=h.map(e=>e.suppressInSnippetMode),this._isInSnippetMode=xE.get(this._editor)?.isInSnippetObservable??Lr(!1),this._typing=this._register(new UD(this.textModel)),this._register(this._inlineCompletionsService.onDidChangeIsSnoozing(e=>{e&&this.stop()}));{let e=this.textModel.uri.scheme===`vscode-notebook-cell`,[t]=this._codeEditorService.listDiffEditors().filter(e=>e.getOriginalEditor().getId()===this._editor.getId()||e.getModifiedEditor().getId()===this._editor.getId());this.isInDiffEditor=!!t,this.editorType=e?DD.Notebook:this.isInDiffEditor?DD.DiffEditor:DD.TextEditor}this._register(_i(this.state,e=>{e&&e.inlineCompletion&&this._inlineCompletionsService.reportNewCompletion(e.inlineCompletion.requestUuid)})),this._register(_i(this._fetchInlineCompletionsPromise)),this._register(g(e=>{this._editorObs.versionId.read(e),this._inAcceptFlow.set(!1,void 0)})),this._register(g(e=>{this.state.map((e,t)=>!e||e.kind===`inlineEdit`&&!e.cursorAtInlineEdit.read(t)).read(e)&&this._jumpedToId.set(void 0,void 0)}));let _=this.inlineEditState.map(e=>e?.inlineCompletion.semanticId);this._register(g(e=>{_.read(e)&&(this._editor.pushUndoStop(),this._lastShownInlineCompletionInfo={alternateTextModelVersionId:this.textModel.getAlternativeVersionId(),inlineCompletion:this.state.get().inlineCompletion})}));let ee=yt(this._languageFeaturesService.inlineCompletionsProvider.onDidChange,()=>this._languageFeaturesService.inlineCompletionsProvider.all(e));jt(this,ee,(e,t)=>{e.onDidChangeInlineCompletions&&t.add(e.onDidChangeInlineCompletions(()=>{if(!this._enabled.get()||(this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor())!==this._editor)return;if(this._triggerCommandOnProviderChange.get()){this.trigger(void 0,{onlyFetchInlineEdits:!0});return}let t=this.state.get();t&&(t.inlineCompletion||t.edits)&&t.inlineCompletion?.source.provider!==e||Bl(t=>{this._fetchSpecificProviderSignal.trigger(t,e),this.trigger(t)})}))}).recomputeInitiallyAndOnChange(this._store),this._didUndoInlineEdits.recomputeInitiallyAndOnChange(this._store)}getIndentationInfo(e){let t=!1,n=!0,r=this?.primaryGhostText.read(e);if(this?._selectedSuggestItem&&r&&r.parts.length>0){let{column:e,lines:i}=r.parts[0],a=i[0].line,o=this.textModel.getLineIndentColumn(r.lineNumber);if(e<=o){let e=bi(a);e===-1&&(e=a.length-1),t=e>0;let r=this.textModel.getOptions().tabSize;n=Ue.visibleColumnFromColumn(a,e+1,r)<r}}return{startsWithIndentation:t,startsWithIndentationLessThanTabSize:n}}_getReason(e){return e?.isUndoing?qD.Undo:e?.isRedoing?qD.Redo:this.isAcceptingPartially?qD.AcceptWord:qD.Other}getAvailableProviders(e){let t=this._suppressedInlineCompletionGroupIds.get(),n=e.filter(e=>!(e.groupId&&t.has(e.groupId))),r=new Set;for(let e of n)e.excludesGroupIds?.forEach(e=>r.add(e));let i=[];for(let e of n)e.groupId&&r.has(e.groupId)||i.push(e);return i}async trigger(e,t){Jc(e,e=>{t?.onlyFetchInlineEdits&&this._onlyRequestInlineEditsSignal.trigger(e),t?.noDelay&&this._noDelaySignal.trigger(e),this._isActive.set(!0,e)}),await this._fetchInlineCompletionsPromise.get()}async triggerExplicitly(e,t=!1){Jc(e,e=>{t&&this._onlyRequestInlineEditsSignal.trigger(e),this._isActive.set(!0,e),this._inAcceptFlow.set(!0,e),this._forceUpdateExplicitlySignal.trigger(e)}),await this._fetchInlineCompletionsPromise.get()}stop(e=`automatic`,t){Jc(t,t=>{if(e===`explicitCancel`){let e=this.state.get()?.inlineCompletion;e&&e.reportEndOfLife({kind:dl.Rejected})}this._isActive.set(!1,t),this._source.clear(t)})}_computeAugmentation(e,t){let n=this.textModel,r=this._source.suggestWidgetInlineCompletions.read(t),i=r?r.inlineCompletions.filter(e=>!e.isInlineEdit):[this.selectedInlineCompletion.read(t)].filter(Qu);return or(i,t=>{let r=t.getSingleTextEdit();return r=UE(r,n,T.fromPositions(r.range.getStartPosition(),e.range.getEndPosition())),WE(r,e)?{completion:t,edit:r}:void 0})}async _deltaSelectedInlineCompletionIndex(e){await this.triggerExplicitly();let t=this._filteredInlineCompletionItems.get()||[];if(t.length>0){let n=(this.selectedInlineCompletionIndex.get()+e+t.length)%t.length;this._selectedInlineCompletionId.set(t[n].semanticId,void 0)}else this._selectedInlineCompletionId.set(void 0,void 0)}async next(){await this._deltaSelectedInlineCompletionIndex(1)}async previous(){await this._deltaSelectedInlineCompletionIndex(-1)}_getMetadata(e,t,n=void 0){return n?Fe.inlineCompletionPartialAccept({nes:e.isInlineEdit,requestUuid:e.requestUuid,providerId:e.source.provider.providerId,languageId:t,type:n}):Fe.inlineCompletionAccept({nes:e.isInlineEdit,requestUuid:e.requestUuid,providerId:e.source.provider.providerId,languageId:t})}async accept(e=this._editor){if(e.getModel()!==this.textModel)throw new se;let t,n=!1,r=this.state.get();if(r?.kind===`ghostText`){if(!r||r.primaryGhostText.isEmpty()||!r.inlineCompletion)return;t=r.inlineCompletion}else if(r?.kind===`inlineEdit`)t=r.inlineCompletion,n=!!r.nextEditUri;else return;t.addRef();try{if(e.pushUndoStop(),!n)if(t.snippetInfo){let n=Su.delete(t.editRange),r=t.additionalTextEdits.map(e=>new Su(T.lift(e.range),e.text??``)),i=Ia.fromParallelReplacementsUnsorted([n,...r]);e.edit(i,this._getMetadata(t,this.textModel.getLanguageId())),e.setPosition(t.snippetInfo.range.getStartPosition(),`inlineCompletionAccept`),xE.get(e)?.insert(t.snippetInfo.snippet,{undoStopBefore:!1})}else{let n=r.edits,i=n;r.kind===`ghostText`&&(i=kE(n,this.textModel));let a=DE(i).map(e=>P.fromPositions(e)),o=t.additionalTextEdits.map(e=>new Su(T.lift(e.range),e.text??``)),s=Ia.fromParallelReplacementsUnsorted([...n,...o]);if(e.edit(s,this._getMetadata(t,this.textModel.getLanguageId())),t.displayLocation===void 0&&e.setSelections(r.kind===`inlineEdit`?a.slice(-1):a,`inlineCompletionAccept`),r.kind===`inlineEdit`&&!this._accessibilityService.isMotionReduced()){let t=s.getNewRanges(),n=this._store.add(new YD(e,t,()=>{this._store.delete(n)}))}}this._onDidAccept.fire(),this.stop(),t.command&&await this._commandService.executeCommand(t.command.id,...t.command.arguments||[]).then(void 0,ct),t.reportEndOfLife({kind:dl.Accepted})}finally{t.removeRef(),this._inAcceptFlow.set(!0,void 0),this._lastAcceptedInlineCompletionInfo={textModelVersionIdAfter:this.textModel.getVersionId(),inlineCompletion:t}}}async acceptNextWord(){await this._acceptNext(this._editor,`word`,(e,t)=>{let n=this.textModel.getLanguageIdAtPosition(e.lineNumber,e.column),r=this._languageConfigurationService.getLanguageConfiguration(n),i=new RegExp(r.wordDefinition.source,r.wordDefinition.flags.replace(`g`,``)),a=t.match(i),o=0;o=a&&a.index!==void 0?a.index===0?a[0].length:a.index:t.length;let s=/\s+/g.exec(t);return s&&s.index!==void 0&&s.index+s[0].length<o&&(o=s.index+s[0].length),o},0)}async acceptNextLine(){await this._acceptNext(this._editor,`line`,(e,t)=>{let n=t.match(/\n/);return n&&n.index!==void 0?n.index+1:t.length},1)}async _acceptNext(e,t,n,r){if(e.getModel()!==this.textModel)throw new se;let i=this.inlineCompletionState.get();if(!i||i.primaryGhostText.isEmpty()||!i.inlineCompletion)return;let a=i.primaryGhostText,o=i.inlineCompletion;if(o.snippetInfo){await this.accept(e);return}let s=a.parts[0],c=new C(a.lineNumber,s.column),l=s.text,u=n(c,l);if(u===l.length&&a.parts.length===1){this.accept(e);return}let d=l.substring(0,u),f=this._positions.get(),p=f[0];o.addRef();try{this._isAcceptingPartially=!0;try{e.pushUndoStop();let n=T.fromPositions(p,c),r=e.getModel().getValueInRange(n)+d,i=new Su(n,r),a=[i,...JD(this.textModel,f,i)].filter(Qu),s=DE(a).map(e=>P.fromPositions(e));e.edit(Ia.fromParallelReplacementsUnsorted(a),this._getMetadata(o,t)),e.setSelections(s,`inlineCompletionPartialAccept`),e.revealPositionInCenterIfOutsideViewport(e.getPosition(),1)}finally{this._isAcceptingPartially=!1}let n=T.fromPositions(o.editRange.getStartPosition(),Wu.ofText(d).addToPosition(c)),i=e.getModel().getValueInRange(n,1).length;o.reportPartialAccept(i,{kind:r,acceptedLength:i},{characters:u,ratio:u/l.length,count:1})}finally{o.removeRef()}}handleSuggestAccepted(e){let t=UE(e.getSingleTextEdit(),this.textModel),n=this._computeAugmentation(t,void 0);if(!n)return;let r=this.textModel.getValueInRange(n.completion.editRange,1).length+t.text.length;n.completion.reportPartialAccept(t.text.length,{kind:2,acceptedLength:r},{characters:t.text.length,count:1,ratio:1})}extractReproSample(){let e=this.textModel.getValue(),t=this.state.get()?.inlineCompletion;return{documentValue:e,inlineCompletion:t?.getSourceCompletion()}}jump(){let e=this.inlineEditState.get();e&&Bl(t=>{this._jumpedToId.set(e.inlineCompletion.semanticId,t),this.dontRefetchSignal.trigger(t);let n=e.inlineCompletion.targetRange,r=n.getStartPosition();if(this._editor.setPosition(r,`inlineCompletions.jump`),n.isSingleLine()&&(e.inlineCompletion.displayLocation||!e.inlineCompletion.insertText.includes(`
`)))this._editor.revealPosition(r);else{let e=new T(n.startLineNumber-1,1,n.endLineNumber+1,1);this._editor.revealRange(e,1)}this._editor.focus()})}async handleInlineSuggestionShown(e,t,n){await e.reportInlineEditShown(this._commandService,t,n)}};KD=WD([GD(7,k),GD(8,Te),GD(9,Ce),GD(10,Qt),GD(11,H),GD(12,xl),GD(13,io)],KD);var qD;(function(e){e[e.Undo=0]=`Undo`,e[e.Redo=1]=`Redo`,e[e.AcceptWord=2]=`AcceptWord`,e[e.Other=3]=`Other`})(qD||={});function JD(e,t,n){if(t.length===1)return[];let r=new $n(e),i=r.getTransformer(),a=i.getOffset(t[0]),o=t.slice(1).map(e=>i.getOffset(e));n=n.removeCommonPrefixAndSuffix(r);let s=i.getStringReplacement(n),c=s.replaceRange.start-a,l=s.replaceRange.join(ac.emptyAt(a)),u=r.getValueOfOffsetRange(l);return o.map(e=>{let t=e+c,n=t+s.replaceRange.length,a=new ac(t,n),o=a.join(ac.emptyAt(e));if(r.getValueOfOffsetRange(o)!==u)return;let l=new yr(a,s.newText);return i.getTextReplacement(l)}).filter(Qu)}var YD=class extends x{constructor(e,t,n){super(),n&&this._register({dispose:()=>n()}),this._register(Bs(e).setDecorations(Lr(t.map(e=>({range:e,options:{description:`animation`,className:`edits-fadeout-decoration`,zIndex:1}})))));let r=new NE(1,0,1e3,FE),i=new IE(r);this._register(g(t=>{let n=i.getValue(t);e.getContainerDomNode().style.setProperty(`--animation-opacity`,n.toString()),r.isFinished()&&this.dispose()}))}},XD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ZD=function(e,t){return function(n,r){t(n,r,e)}},QD,$D=class{constructor(e){this.name=e}select(e,t,n){if(n.length===0)return 0;let r=n[0].score[0];for(let e=0;e<n.length;e++){let{score:t,completion:i}=n[e];if(t[0]!==r)break;if(i.preselect)return e}return 0}},eO=class extends $D{constructor(){super(`first`)}memorize(e,t,n){}toJSON(){}fromJSON(){}},tO=class extends $D{constructor(){super(`recentlyUsed`),this._cache=new ti(300,.66),this._seq=0}memorize(e,t,n){let r=`${e.getLanguageId()}/${n.textLabel}`;this._cache.set(r,{touch:this._seq++,type:n.completion.kind,insertText:n.completion.insertText})}select(e,t,n){if(n.length===0)return 0;let r=e.getLineContent(t.lineNumber).substr(t.column-10,t.column-1);if(/\s$/.test(r))return super.select(e,t,n);let i=n[0].score[0],a=-1,o=-1,s=-1;for(let t=0;t<n.length&&n[t].score[0]===i;t++){let r=`${e.getLanguageId()}/${n[t].textLabel}`,i=this._cache.peek(r);if(i&&i.touch>s&&i.type===n[t].completion.kind&&i.insertText===n[t].completion.insertText&&(s=i.touch,o=t),n[t].completion.preselect&&a===-1)return a=t}return o===-1?a===-1?0:a:o}toJSON(){return this._cache.toJSON()}fromJSON(e){this._cache.clear();for(let[t,n]of e)n.touch=0,n.type=typeof n.type==`number`?n.type:el.fromString(n.type),this._cache.set(t,n);this._seq=this._cache.size}},nO=class extends $D{constructor(){super(`recentlyUsedByPrefix`),this._trie=uu.forStrings(),this._seq=0}memorize(e,t,n){let{word:r}=e.getWordUntilPosition(t),i=`${e.getLanguageId()}/${r}`;this._trie.set(i,{type:n.completion.kind,insertText:n.completion.insertText,touch:this._seq++})}select(e,t,n){let{word:r}=e.getWordUntilPosition(t);if(!r)return super.select(e,t,n);let i=`${e.getLanguageId()}/${r}`,a=this._trie.get(i);if(a||=this._trie.findSubstr(i),a)for(let e=0;e<n.length;e++){let{kind:t,insertText:r}=n[e].completion;if(t===a.type&&r===a.insertText)return e}return super.select(e,t,n)}toJSON(){let e=[];return this._trie.forEach((t,n)=>e.push([n,t])),e.sort((e,t)=>-(e[1].touch-t[1].touch)).forEach((e,t)=>e[1].touch=t),e.slice(0,200)}fromJSON(e){if(this._trie.clear(),e.length>0){this._seq=e[0][1].touch+1;for(let[t,n]of e)n.type=typeof n.type==`number`?n.type:el.fromString(n.type),this._trie.set(t,n)}}},rO=class{static{QD=this}static{this._strategyCtors=new Map([[`recentlyUsedByPrefix`,nO],[`recentlyUsed`,tO],[`first`,eO]])}static{this._storagePrefix=`suggest/memories`}constructor(e,t){this._storageService=e,this._configService=t,this._disposables=new L,this._persistSoon=new Zr(()=>this._saveState(),500),this._disposables.add(e.onWillSaveState(e=>{e.reason===Ne.SHUTDOWN&&this._saveState()}))}dispose(){this._disposables.dispose(),this._persistSoon.dispose()}memorize(e,t,n){this._withStrategy(e,t).memorize(e,t,n),this._persistSoon.schedule()}select(e,t,n){return this._withStrategy(e,t).select(e,t,n)}_withStrategy(e,t){let n=this._configService.getValue(`editor.suggestSelection`,{overrideIdentifier:e.getLanguageIdAtPosition(t.lineNumber,t.column),resource:e.uri});if(this._strategy?.name!==n){this._saveState(),this._strategy=new((QD._strategyCtors.get(n))||eO);try{let e=this._configService.getValue(`editor.suggest.shareSuggestSelections`)?0:1,t=this._storageService.get(`${QD._storagePrefix}/${n}`,e);t&&this._strategy.fromJSON(JSON.parse(t))}catch{}}return this._strategy}_saveState(){if(this._strategy){let e=this._configService.getValue(`editor.suggest.shareSuggestSelections`)?0:1,t=JSON.stringify(this._strategy);this._storageService.store(`${QD._storagePrefix}/${this._strategy.name}`,t,e,1)}}};rO=QD=XD([ZD(0,Qr),ZD(1,hn)],rO);const iO=ma(`ISuggestMemories`);Ui(iO,rO,1);var aO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},oO=function(e,t){return function(n,r){t(n,r,e)}},sO,cO=class{static{sO=this}static{this.AtEnd=new N(`atEndOfWord`,!1,{type:`boolean`,description:G(1479,`A context key that is true when at the end of a word. Note that this is only defined when tab-completions are enabled`)})}constructor(e,t){this._editor=e,this._enabled=!1,this._ckAtEnd=sO.AtEnd.bindTo(t),this._configListener=this._editor.onDidChangeConfiguration(e=>e.hasChanged(139)&&this._update()),this._update()}dispose(){this._configListener.dispose(),this._selectionListener?.dispose(),this._ckAtEnd.reset()}_update(){let e=this._editor.getOption(139)===`on`;if(this._enabled!==e)if(this._enabled=e,this._enabled){let e=()=>{if(!this._editor.hasModel()){this._ckAtEnd.set(!1);return}let e=this._editor.getModel(),t=this._editor.getSelection(),n=e.getWordAtPosition(t.getStartPosition());if(!n){this._ckAtEnd.set(!1);return}this._ckAtEnd.set(n.endColumn===t.getStartPosition().column&&t.getStartPosition().lineNumber===t.getEndPosition().lineNumber)};this._selectionListener=this._editor.onDidChangeCursorSelection(e),e()}else this._selectionListener&&=(this._ckAtEnd.reset(),this._selectionListener.dispose(),void 0)}};cO=sO=aO([oO(1,On)],cO);var lO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},uO=function(e,t){return function(n,r){t(n,r,e)}},dO,fO=class{static{dO=this}static{this.OtherSuggestions=new N(`hasOtherSuggestions`,!1)}constructor(e,t){this._editor=e,this._index=0,this._ckOtherSuggestions=dO.OtherSuggestions.bindTo(t)}dispose(){this.reset()}reset(){this._ckOtherSuggestions.reset(),this._listener?.dispose(),this._model=void 0,this._acceptNext=void 0,this._ignore=!1}set({model:e,index:t},n){if(e.items.length===0){this.reset();return}if(dO._moveIndex(!0,e,t)===t){this.reset();return}this._acceptNext=n,this._model=e,this._index=t,this._listener=this._editor.onDidChangeCursorPosition(()=>{this._ignore||this.reset()}),this._ckOtherSuggestions.set(!0)}static _moveIndex(e,t,n){let r=n;for(let i=t.items.length;i>0&&(r=(r+t.items.length+(e?1:-1))%t.items.length,!(r===n||!t.items[r].completion.additionalTextEdits));i--);return r}next(){this._move(!0)}prev(){this._move(!1)}_move(e){if(this._model)try{this._ignore=!0,this._index=dO._moveIndex(e,this._model,this._index),this._acceptNext({index:this._index,item:this._model.items[this._index],model:this._model})}finally{this._ignore=!1}}};fO=dO=lO([uO(1,On)],fO);var pO=class{constructor(e,t,n,r){this._disposables=new L,this._disposables.add(n.onDidSuggest(e=>{e.completionModel.items.length===0&&this.reset()})),this._disposables.add(n.onDidCancel(e=>{this.reset()})),this._disposables.add(t.onDidShow(()=>this._onItem(t.getFocusedItem()))),this._disposables.add(t.onDidFocus(this._onItem,this)),this._disposables.add(t.onDidHide(this.reset,this)),this._disposables.add(e.onWillType(i=>{if(this._active&&!t.isFrozen()&&n.state!==0){let t=i.charCodeAt(i.length-1);this._active.acceptCharacters.has(t)&&e.getOption(0)&&r(this._active.item)}}))}_onItem(e){if(!e||!$t(e.item.completion.commitCharacters)){this.reset();return}if(this._active&&this._active.item.item===e.item)return;let t=new Hr;for(let n of e.item.completion.commitCharacters)n.length>0&&t.add(n.charCodeAt(0));this._active={acceptCharacters:t,item:e}}reset(){this._active=void 0}dispose(){this._disposables.dispose()}},mO=class e{async provideSelectionRanges(t,n){let r=[];for(let i of n){let n=[];r.push(n);let a=new Map;await new Promise(n=>e._bracketsRightYield(n,0,t,i,a)),await new Promise(r=>e._bracketsLeftYield(r,0,t,i,a,n))}return r}static{this._maxDuration=30}static{this._maxRounds=2}static _bracketsRightYield(t,n,r,i,a){let o=new Map,s=Date.now();for(;;){if(n>=e._maxRounds){t();break}if(!i){t();break}let c=r.bracketPairs.findNextBracket(i);if(!c){t();break}if(Date.now()-s>e._maxDuration){setTimeout(()=>e._bracketsRightYield(t,n+1,r,i,a));break}if(c.bracketInfo.isOpeningBracket){let e=c.bracketInfo.bracketText,t=o.has(e)?o.get(e):0;o.set(e,t+1)}else{let e=c.bracketInfo.getOpeningBrackets()[0].bracketText,t=o.has(e)?o.get(e):0;if(--t,o.set(e,Math.max(0,t)),t<0){let t=a.get(e);t||(t=new Fc,a.set(e,t)),t.push(c.range)}}i=c.range.getEndPosition()}}static _bracketsLeftYield(t,n,r,i,a,o){let s=new Map,c=Date.now();for(;;){if(n>=e._maxRounds&&a.size===0){t();break}if(!i){t();break}let l=r.bracketPairs.findPrevBracket(i);if(!l){t();break}if(Date.now()-c>e._maxDuration){setTimeout(()=>e._bracketsLeftYield(t,n+1,r,i,a,o));break}if(l.bracketInfo.isOpeningBracket){let t=l.bracketInfo.bracketText,n=s.has(t)?s.get(t):0;if(--n,s.set(t,Math.max(0,n)),n<0){let n=a.get(t);if(n){let i=n.shift();n.size===0&&a.delete(t);let s=T.fromPositions(l.range.getEndPosition(),i.getStartPosition()),c=T.fromPositions(l.range.getStartPosition(),i.getEndPosition());o.push({range:s}),o.push({range:c}),e._addBracketLeading(r,c,o)}}}else{let e=l.bracketInfo.getOpeningBrackets()[0].bracketText,t=s.has(e)?s.get(e):0;s.set(e,t+1)}i=l.range.getStartPosition()}}static _addBracketLeading(e,t,n){if(t.startLineNumber===t.endLineNumber)return;let r=t.startLineNumber,i=e.getLineFirstNonWhitespaceColumn(r);i!==0&&i!==t.startColumn&&(n.push({range:T.fromPositions(new C(r,i),t.getEndPosition())}),n.push({range:T.fromPositions(new C(r,1),t.getEndPosition())}));let a=r-1;if(a>0){let r=e.getLineFirstNonWhitespaceColumn(a);r===t.startColumn&&r!==e.getLineLastNonWhitespaceColumn(a)&&(n.push({range:T.fromPositions(new C(a,r),t.getEndPosition())}),n.push({range:T.fromPositions(new C(a,1),t.getEndPosition())}))}}},hO=class e{static{this.None=new class extends e{distance(){return 0}}}static async create(t,n){if(!n.getOption(134).localityBonus||!n.hasModel())return e.None;let r=n.getModel(),i=n.getPosition();if(!t.canComputeWordRanges(r.uri))return e.None;let[a]=await new mO().provideSelectionRanges(r,[i]);if(a.length===0)return e.None;let o=await t.computeWordRanges(r.uri,a[0].range);if(!o)return e.None;let s=r.getWordUntilPosition(i);return delete o[s.word],new class extends e{distance(e,t){if(!i.equals(n.getPosition()))return 0;if(t.kind===17)return 2<<20;let r=typeof t.label==`string`?t.label:t.label.label,s=o[r];if(hl(s))return 2<<20;let c=Rr(s,T.fromPositions(e),T.compareRangesUsingStarts),l=c>=0?s[c]:s[Math.max(0,~c-1)],u=a.length;for(let e of a){if(!T.containsRange(e.range,l))break;--u}return u}}}},gO=class{constructor(e,t){this.leadingLineContent=e,this.characterCountDelta=t}},_O=class e{constructor(t,n,r,i,a,o,s=pd.default,c=void 0){this.clipboardText=c,this._snippetCompareFn=e._compareCompletionItems,this._items=t,this._column=n,this._wordDistance=i,this._options=a,this._refilterKind=1,this._lineContext=r,this._fuzzyScoreOptions=s,o===`top`?this._snippetCompareFn=e._compareCompletionItemsSnippetsUp:o===`bottom`&&(this._snippetCompareFn=e._compareCompletionItemsSnippetsDown)}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?2:1,this._lineContext=e)}get items(){return this._ensureCachedState(),this._filteredItems}getItemsByProvider(){return this._ensureCachedState(),this._itemsByProvider}getIncompleteProvider(){this._ensureCachedState();let e=new Set;for(let[t,n]of this.getItemsByProvider())n.length>0&&n[0].container.incomplete&&e.add(t);return e}get stats(){return this._ensureCachedState(),this._stats}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){this._itemsByProvider=new Map;let e=[],{leadingLineContent:t,characterCountDelta:n}=this._lineContext,r=``,i=``,a=this._refilterKind===1?this._items:this._filteredItems,o=[],s=!this._options.filterGraceful||a.length>2e3?Ft:xi;for(let c=0;c<a.length;c++){let l=a[c];if(l.isInvalid)continue;let u=this._itemsByProvider.get(l.provider);u?u.push(l):this._itemsByProvider.set(l.provider,[l]);let d=l.position.column-l.editStart.column,f=d+n-(l.position.column-this._column);if(r.length!==f&&(r=f===0?``:t.slice(-f),i=r.toLowerCase()),l.word=r,f===0)l.score=Vr.Default;else{let e=0;for(;e<d;){let t=r.charCodeAt(e);if(t===32||t===9)e+=1;else break}if(e>=f)l.score=Vr.Default;else if(typeof l.completion.filterText==`string`){let t=s(r,i,e,l.completion.filterText,l.filterTextLow,0,this._fuzzyScoreOptions);if(!t)continue;fd(l.completion.filterText,l.textLabel)===0?l.score=t:(l.score=Se(r,i,e,l.textLabel,l.labelLow,0),l.score[0]=t[0])}else{let t=s(r,i,e,l.textLabel,l.labelLow,0,this._fuzzyScoreOptions);if(!t)continue;l.score=t}}l.idx=c,l.distance=this._wordDistance.distance(l.position,l.completion),o.push(l),e.push(l.textLabel.length)}this._filteredItems=o.sort(this._snippetCompareFn),this._refilterKind=0,this._stats={pLabelLen:e.length?Zi(e.length-.85,e,(e,t)=>e-t):0}}static _compareCompletionItems(e,t){return e.score[0]>t.score[0]?-1:e.score[0]<t.score[0]?1:e.distance<t.distance?-1:e.distance>t.distance?1:e.idx<t.idx?-1:e.idx>t.idx?1:0}static _compareCompletionItemsSnippetsDown(t,n){if(t.completion.kind!==n.completion.kind){if(t.completion.kind===28)return 1;if(n.completion.kind===28)return-1}return e._compareCompletionItems(t,n)}static _compareCompletionItemsSnippetsUp(t,n){if(t.completion.kind!==n.completion.kind){if(t.completion.kind===28)return-1;if(n.completion.kind===28)return 1}return e._compareCompletionItems(t,n)}},vO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yO=function(e,t){return function(n,r){t(n,r,e)}},bO,xO=class{static shouldAutoTrigger(e){if(!e.hasModel())return!1;let t=e.getModel(),n=e.getPosition();t.tokenization.tokenizeIfCheap(n.lineNumber);let r=t.getWordAtPosition(n);return!(!r||r.endColumn!==n.column&&r.startColumn+1!==n.column||!isNaN(Number(r.word)))}constructor(e,t,n){this.leadingLineContent=e.getLineContent(t.lineNumber).substr(0,t.column-1),this.leadingWord=e.getWordUntilPosition(t),this.lineNumber=t.lineNumber,this.column=t.column,this.triggerOptions=n}};function SO(e,t,n){if(!t.getContextKeyValue(GT.inlineSuggestionVisible.key))return!0;let r=t.getContextKeyValue(GT.suppressSuggestions.key);return r===void 0?!e.getOption(71).suppressSuggestions:!r}function CO(e,t,n){if(!t.getContextKeyValue(`inlineSuggestionVisible`))return!0;let r=t.getContextKeyValue(GT.suppressSuggestions.key);return r===void 0?!e.getOption(71).suppressSuggestions:!r}var wO=bO=class{constructor(e,t,n,r,i,a,o,s,c){this._editor=e,this._editorWorkerService=t,this._clipboardService=n,this._telemetryService=r,this._logService=i,this._contextKeyService=a,this._configurationService=o,this._languageFeaturesService=s,this._envService=c,this._toDispose=new L,this._triggerCharacterListener=new L,this._triggerQuickSuggest=new Me,this._triggerState=void 0,this._completionDisposables=new L,this._onDidCancel=new D,this._onDidTrigger=new D,this._onDidSuggest=new D,this.onDidCancel=this._onDidCancel.event,this.onDidTrigger=this._onDidTrigger.event,this.onDidSuggest=this._onDidSuggest.event,this._currentSelection=this._editor.getSelection()||new P(1,1,1,1),this._toDispose.add(this._editor.onDidChangeModel(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{this._updateTriggerCharacters()})),this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{this._updateTriggerCharacters(),this._updateActiveSuggestSession()}));let l=!1;this._toDispose.add(this._editor.onDidCompositionStart(()=>{l=!0})),this._toDispose.add(this._editor.onDidCompositionEnd(()=>{l=!1,this._onCompositionEnd()})),this._toDispose.add(this._editor.onDidChangeCursorSelection(e=>{l||this._onCursorChange(e)})),this._toDispose.add(this._editor.onDidChangeModelContent(()=>{!l&&this._triggerState!==void 0&&this._refilterCompletionItems()})),this._updateTriggerCharacters()}dispose(){Ot(this._triggerCharacterListener),Ot([this._onDidCancel,this._onDidSuggest,this._onDidTrigger,this._triggerQuickSuggest]),this._toDispose.dispose(),this._completionDisposables.dispose(),this.cancel()}_updateTriggerCharacters(){if(this._triggerCharacterListener.clear(),this._editor.getOption(104)||!this._editor.hasModel()||!this._editor.getOption(137))return;let e=new Map;for(let t of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for(let n of t.triggerCharacters||[]){let r=e.get(n);if(!r){r=new Set;let t=FT();t&&r.add(t),e.set(n,r)}r.add(t)}let t=t=>{if(!CO(this._editor,this._contextKeyService,this._configurationService)||xO.shouldAutoTrigger(this._editor))return;if(!t){let e=this._editor.getPosition();t=this._editor.getModel().getLineContent(e.lineNumber).substr(0,e.column-1)}let n=``;ua(t.charCodeAt(t.length-1))?tn(t.charCodeAt(t.length-2))&&(n=t.substr(t.length-2)):n=t.charAt(t.length-1);let r=e.get(n);if(r){let e=new Map;if(this._completionModel)for(let[t,n]of this._completionModel.getItemsByProvider())r.has(t)||e.set(t,n);this.trigger({auto:!0,triggerKind:1,triggerCharacter:n,retrigger:!!this._completionModel,clipboardText:this._completionModel?.clipboardText,completionOptions:{providerFilter:r,providerItemsToReuse:e}})}};this._triggerCharacterListener.add(this._editor.onDidType(t)),this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>t()))}get state(){return this._triggerState?this._triggerState.auto?2:1:0}cancel(e=!1){this._triggerState!==void 0&&(this._triggerQuickSuggest.cancel(),this._requestToken?.cancel(),this._requestToken=void 0,this._triggerState=void 0,this._completionModel=void 0,this._context=void 0,this._onDidCancel.fire({retrigger:e}))}clear(){this._completionDisposables.clear()}_updateActiveSuggestSession(){this._triggerState!==void 0&&(!this._editor.hasModel()||!this._languageFeaturesService.completionProvider.has(this._editor.getModel())?this.cancel():this.trigger({auto:this._triggerState.auto,retrigger:!0}))}_onCursorChange(e){if(!this._editor.hasModel())return;let t=this._currentSelection;if(this._currentSelection=this._editor.getSelection(),!e.selection.isEmpty()||e.reason!==0&&e.reason!==3||e.source!==`keyboard`&&e.source!==`deleteLeft`){this.cancel();return}this._triggerState===void 0&&e.reason===0?(t.containsRange(this._currentSelection)||t.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition()))&&this._doTriggerQuickSuggest():this._triggerState!==void 0&&e.reason===3&&this._refilterCompletionItems()}_onCompositionEnd(){this._triggerState===void 0?this._doTriggerQuickSuggest():this._refilterCompletionItems()}_doTriggerQuickSuggest(){WT.isAllOff(this._editor.getOption(102))||this._editor.getOption(134).snippetsPreventQuickSuggestions&&xE.get(this._editor)?.isInSnippet()||(this.cancel(),this._triggerQuickSuggest.cancelAndSet(()=>{if(this._triggerState!==void 0||!xO.shouldAutoTrigger(this._editor)||!this._editor.hasModel()||!this._editor.hasWidgetFocus())return;let e=this._editor.getModel(),t=this._editor.getPosition(),n=this._editor.getOption(102);if(!WT.isAllOff(n)){if(!WT.isAllOn(n)){e.tokenization.tokenizeIfCheap(t.lineNumber);let r=e.tokenization.getLineTokens(t.lineNumber),i=r.getStandardTokenType(r.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(WT.valueFor(n,i)!==`on`)return}SO(this._editor,this._contextKeyService,this._configurationService)&&this._languageFeaturesService.completionProvider.has(e)&&this.trigger({auto:!0})}},this._editor.getOption(103)))}_refilterCompletionItems(){J(this._editor.hasModel()),J(this._triggerState!==void 0);let e=this._editor.getModel(),t=this._editor.getPosition(),n=new xO(e,t,{...this._triggerState,refilter:!0});this._onNewContext(n)}trigger(e){if(!this._editor.hasModel())return;let t=this._editor.getModel(),n=new xO(t,this._editor.getPosition(),e);this.cancel(e.retrigger),this._triggerState=e,this._onDidTrigger.fire({auto:e.auto,shy:e.shy??!1,position:this._editor.getPosition()}),this._context=n;let r={triggerKind:e.triggerKind??0};e.triggerCharacter&&(r={triggerKind:1,triggerCharacter:e.triggerCharacter}),this._requestToken=new Sr;let i=this._editor.getOption(128),a=1;switch(i){case`top`:a=0;break;case`bottom`:a=2;break}let{itemKind:o,showDeprecated:s}=bO.createSuggestFilter(this._editor),c=new NT(a,e.completionOptions?.kindFilter??o,e.completionOptions?.providerFilter,e.completionOptions?.providerItemsToReuse,s),l=hO.create(this._editorWorkerService,this._editor),u=LT(this._languageFeaturesService.completionProvider,t,this._editor.getPosition(),c,r,this._requestToken.token);Promise.all([u,l]).then(async([t,n])=>{if(this._requestToken?.dispose(),!this._editor.hasModel()){t.disposable.dispose();return}let r=e?.clipboardText;if(!r&&t.needsClipboard&&(r=await this._clipboardService.readText()),this._triggerState===void 0){t.disposable.dispose();return}let i=this._editor.getModel(),a=new xO(i,this._editor.getPosition(),e),o={...pd.default,firstMatchCanBeWeak:!this._editor.getOption(134).matchOnWordStartOnly};if(this._completionModel=new _O(t.items,this._context.column,{leadingLineContent:a.leadingLineContent,characterCountDelta:a.column-this._context.column},n,this._editor.getOption(134),this._editor.getOption(128),o,r),this._completionDisposables.add(t.disposable),this._onNewContext(a),this._reportDurationsTelemetry(t.durations),!this._envService.isBuilt||this._envService.isExtensionDevelopment)for(let e of t.items)e.isInvalid&&this._logService.warn(`[suggest] did IGNORE invalid completion item from ${e.provider._debugDisplayName}`,e.completion)}).catch(mr)}_reportDurationsTelemetry(e){Math.random()>1e-4||setTimeout(()=>{this._telemetryService.publicLog2(`suggest.durations.json`,{data:JSON.stringify(e)}),this._logService.debug(`suggest.durations.json`,e)})}static createSuggestFilter(e){let t=new Set;e.getOption(128)===`none`&&t.add(28);let n=e.getOption(134);return n.showMethods||t.add(0),n.showFunctions||t.add(1),n.showConstructors||t.add(2),n.showFields||t.add(3),n.showVariables||t.add(4),n.showClasses||t.add(5),n.showStructs||t.add(6),n.showInterfaces||t.add(7),n.showModules||t.add(8),n.showProperties||t.add(9),n.showEvents||t.add(10),n.showOperators||t.add(11),n.showUnits||t.add(12),n.showValues||t.add(13),n.showConstants||t.add(14),n.showEnums||t.add(15),n.showEnumMembers||t.add(16),n.showKeywords||t.add(17),n.showWords||t.add(18),n.showColors||t.add(19),n.showFiles||t.add(20),n.showReferences||t.add(21),n.showColors||t.add(22),n.showFolders||t.add(23),n.showTypeParameters||t.add(24),n.showSnippets||t.add(28),n.showUsers||t.add(25),n.showIssues||t.add(26),{itemKind:t,showDeprecated:n.showDeprecated}}_onNewContext(e){if(this._context){if(e.lineNumber!==this._context.lineNumber){this.cancel();return}if(St(e.leadingLineContent)!==St(this._context.leadingLineContent)){this.cancel();return}if(e.column<this._context.column){e.leadingWord.word?this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0}):this.cancel();return}if(this._completionModel){if(e.leadingWord.word.length!==0&&e.leadingWord.startColumn>this._context.leadingWord.startColumn){if(xO.shouldAutoTrigger(this._editor)&&this._context){let e=this._completionModel.getItemsByProvider();this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerItemsToReuse:e}})}return}if(e.column>this._context.column&&this._completionModel.getIncompleteProvider().size>0&&e.leadingWord.word.length!==0){let e=new Map,t=new Set;for(let[n,r]of this._completionModel.getItemsByProvider())r.length>0&&r[0].container.incomplete?t.add(n):e.set(n,r);this.trigger({auto:this._context.triggerOptions.auto,triggerKind:2,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerFilter:t,providerItemsToReuse:e}})}else{let t=this._completionModel.lineContext,n=!1;if(this._completionModel.lineContext={leadingLineContent:e.leadingLineContent,characterCountDelta:e.column-this._context.column},this._completionModel.items.length===0){let r=xO.shouldAutoTrigger(this._editor);if(!this._context){this.cancel();return}if(r&&this._context.leadingWord.endColumn<e.leadingWord.startColumn){this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0});return}if(this._context.triggerOptions.auto){this.cancel();return}else if(this._completionModel.lineContext=t,n=this._completionModel.items.length>0,n&&e.leadingWord.word.length===0){this.cancel();return}}this._onDidSuggest.fire({completionModel:this._completionModel,triggerOptions:e.triggerOptions,isFrozen:n})}}}}};wO=bO=vO([yO(1,Xs),yO(2,aa),yO(3,Fu),yO(4,Wl),yO(5,On),yO(6,hn),yO(7,H),yO(8,ko)],wO);var TO=class e{static{this._maxSelectionLength=51200}constructor(t,n){this._disposables=new L,this._lastOvertyped=[],this._locked=!1,this._disposables.add(t.onWillType(()=>{if(this._locked||!t.hasModel())return;let n=t.getSelections(),r=n.length,i=!1;for(let e=0;e<r;e++)if(!n[e].isEmpty()){i=!0;break}if(!i){this._lastOvertyped.length!==0&&(this._lastOvertyped.length=0);return}this._lastOvertyped=[];let a=t.getModel();for(let t=0;t<r;t++){let r=n[t];if(a.getValueLengthInRange(r)>e._maxSelectionLength)return;this._lastOvertyped[t]={value:a.getValueInRange(r),multiline:r.startLineNumber!==r.endLineNumber}}})),this._disposables.add(n.onDidTrigger(e=>{this._locked=!0})),this._disposables.add(n.onDidCancel(e=>{this._locked=!1}))}getLastOvertypedInfo(e){if(e>=0&&e<this._lastOvertyped.length)return this._lastOvertyped[e]}dispose(){this._disposables.dispose()}},EO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},DO=function(e,t){return function(n,r){t(n,r,e)}},OO=class{constructor(e,t,n,r,i){this._menuId=t,this._menuService=r,this._contextKeyService=i,this._menuDisposables=new L,this.element=B(e,b(`.suggest-status-bar`));let a=(e=>e instanceof cr?n.createInstance(xr,e,{useComma:!1}):void 0);this._leftActions=new Bn(this.element,{actionViewItemProvider:a}),this._rightActions=new Bn(this.element,{actionViewItemProvider:a}),this._leftActions.domNode.classList.add(`left`),this._rightActions.domNode.classList.add(`right`)}dispose(){this._menuDisposables.dispose(),this._leftActions.dispose(),this._rightActions.dispose(),this.element.remove()}show(){let e=this._menuService.createMenu(this._menuId,this._contextKeyService),t=()=>{let t=[],n=[];for(let[r,i]of e.getActions())r===`left`?t.push(...i):n.push(...i);this._leftActions.clear(),this._leftActions.push(t),this._rightActions.clear(),this._rightActions.push(n)};this._menuDisposables.add(e.onDidChange(()=>t())),this._menuDisposables.add(e)}hide(){this._menuDisposables.clear()}};OO=EO([DO(2,k),DO(3,rt),DO(4,On)],OO);var kO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},AO=function(e,t){return function(n,r){t(n,r,e)}};function jO(e){return!!e&&!!(e.completion.documentation||e.completion.detail&&e.completion.detail!==e.completion.label)}var MO=class{constructor(e,t){this._editor=e,this._onDidClose=new D,this.onDidClose=this._onDidClose.event,this._onDidChangeContents=new D,this.onDidChangeContents=this._onDidChangeContents.event,this._disposables=new L,this._renderDisposeable=new L,this._borderWidth=1,this._size=new Po(330,0),this.domNode=b(`.suggest-details`),this.domNode.classList.add(`no-docs`),this._markdownRenderer=t.createInstance(et,{editor:e}),this._body=b(`.body`),this._scrollbar=new Xr(this._body,{alwaysConsumeMouseWheel:!0}),B(this.domNode,this._scrollbar.getDomNode()),this._disposables.add(this._scrollbar),this._header=B(this._body,b(`.header`)),this._close=B(this._header,b(`span`+I.asCSSSelector(X.close))),this._close.title=G(1475,`Close`),this._close.role=`button`,this._close.tabIndex=-1,this._type=B(this._header,b(`p.type`)),this._docs=B(this._body,b(`p.docs`)),this._configureFont(),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(59)&&this._configureFont()}))}dispose(){this._disposables.dispose(),this._renderDisposeable.dispose()}_configureFont(){let e=this._editor.getOptions(),t=e.get(59),n=t.getMassagedFontFamily(),r=e.get(135)||t.fontSize,i=e.get(136)||t.lineHeight,a=t.fontWeight,o=`${r}px`,s=`${i}px`;this.domNode.style.fontSize=o,this.domNode.style.lineHeight=`${i/r}`,this.domNode.style.fontWeight=a,this.domNode.style.fontFeatureSettings=t.fontFeatureSettings,this._type.style.fontFamily=n,this._close.style.height=s,this._close.style.width=s}getLayoutInfo(){let e=this._editor.getOption(136)||this._editor.getOption(59).lineHeight,t=this._borderWidth,n=t*2;return{lineHeight:e,borderWidth:t,borderHeight:n,verticalPadding:22,horizontalPadding:14}}renderLoading(){this._type.textContent=G(1476,`Loading...`),this._docs.textContent=``,this.domNode.classList.remove(`no-docs`,`no-type`),this.layout(this.size.width,this.getLayoutInfo().lineHeight*2),this._onDidChangeContents.fire(this)}renderItem(e,t){this._renderDisposeable.clear();let{detail:n,documentation:r}=e.completion;if(t){let t=``;t+=`score: ${e.score[0]}\n`,t+=`prefix: ${e.word??`(no prefix)`}\n`,t+=`word: ${e.completion.filterText?e.completion.filterText+` (filterText)`:e.textLabel}\n`,t+=`distance: ${e.distance} (localityBonus-setting)\n`,t+=`index: ${e.idx}, based on ${e.completion.sortText&&`sortText: "${e.completion.sortText}"`||`label`}\n`,t+=`commit_chars: ${e.completion.commitCharacters?.join(``)}\n`,r=new Jn().appendCodeblock(`empty`,t),n=`Provider: ${e.provider._debugDisplayName}`}if(!t&&!jO(e)){this.clearContents();return}if(this.domNode.classList.remove(`no-docs`,`no-type`),n){let e=n.length>1e5?`${n.substr(0,1e5)}`:n;this._type.textContent=e,this._type.title=e,Hs(this._type),this._type.classList.toggle(`auto-wrap`,!/\r?\n^\s+/gim.test(e))}else fc(this._type),this._type.title=``,Jr(this._type),this.domNode.classList.add(`no-type`);if(fc(this._docs),typeof r==`string`)this._docs.classList.remove(`markdown-docs`),this._docs.textContent=r;else if(r){this._docs.classList.add(`markdown-docs`),fc(this._docs);let e=this._markdownRenderer.render(r,{asyncRenderCallback:()=>{this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}});this._docs.appendChild(e.element),this._renderDisposeable.add(e)}this.domNode.classList.toggle(`detail-and-doc`,!!n&&!!r),this.domNode.style.userSelect=`text`,this.domNode.tabIndex=-1,this._close.onmousedown=e=>{e.preventDefault(),e.stopPropagation()},this._close.onclick=e=>{e.preventDefault(),e.stopPropagation(),this._onDidClose.fire()},this._body.scrollTop=0,this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}clearContents(){this.domNode.classList.add(`no-docs`),this._type.textContent=``,this._docs.textContent=``}get isEmpty(){return this.domNode.classList.contains(`no-docs`)}get size(){return this._size}layout(e,t){let n=new Po(e,t);Po.equals(n,this._size)||(this._size=n,Nn(this.domNode,e,t)),this._scrollbar.scanDomNode()}scrollDown(e=8){this._body.scrollTop+=e}scrollUp(e=8){this._body.scrollTop-=e}scrollTop(){this._body.scrollTop=0}scrollBottom(){this._body.scrollTop=this._body.scrollHeight}pageDown(){this.scrollDown(80)}pageUp(){this.scrollUp(80)}set borderWidth(e){this._borderWidth=e}get borderWidth(){return this._borderWidth}focus(){this.domNode.focus()}};MO=kO([AO(1,k)],MO);var NO=class{constructor(e,t){this.widget=e,this._editor=t,this.allowEditorOverflow=!0,this._disposables=new L,this._added=!1,this._preferAlignAtTop=!0,this._resizable=new G_,this._resizable.domNode.classList.add(`suggest-details-container`),this._resizable.domNode.appendChild(e.domNode),this._resizable.enableSashes(!1,!0,!0,!1);let n,r,i=0,a=0;this._disposables.add(this._resizable.onDidWillResize(()=>{n=this._topLeft,r=this._resizable.size})),this._disposables.add(this._resizable.onDidResize(e=>{if(n&&r){this.widget.layout(e.dimension.width,e.dimension.height);let t=!1;e.west&&(a=r.width-e.dimension.width,t=!0),e.north&&(i=r.height-e.dimension.height,t=!0),t&&this._applyTopLeft({top:n.top+i,left:n.left+a})}e.done&&(n=void 0,r=void 0,i=0,a=0,this._userSize=e.dimension)})),this._disposables.add(this.widget.onDidChangeContents(()=>{this._anchorBox&&this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,this._preferAlignAtTop)}))}dispose(){this._resizable.dispose(),this._disposables.dispose(),this.hide()}getId(){return`suggest.details`}getDomNode(){return this._resizable.domNode}getPosition(){return this._topLeft?{preference:this._topLeft}:null}show(){this._added||=(this._editor.addOverlayWidget(this),!0)}hide(e=!1){this._resizable.clearSashHoverState(),this._added&&(this._editor.removeOverlayWidget(this),this._added=!1,this._anchorBox=void 0,this._topLeft=void 0),e&&(this._userSize=void 0,this.widget.clearContents())}placeAtAnchor(e,t){this._anchorBox=e.getBoundingClientRect(),this._preferAlignAtTop=t,this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,t)}_placeAtAnchor(e,t,n){let r=rl(this.getDomNode().ownerDocument.body),i=this.widget.getLayoutInfo(),a=new Po(220,2*i.lineHeight),o=e.top,s=(function(){let n=r.width-(e.left+e.width+i.borderWidth+i.horizontalPadding),s=-i.borderWidth+e.left+e.width,c=new Po(n,r.height-e.top-i.borderHeight-i.verticalPadding),l=c.with(void 0,e.top+e.height-i.borderHeight-i.verticalPadding);return{top:o,left:s,fit:n-t.width,maxSizeTop:c,maxSizeBottom:l,minSize:a.with(Math.min(n,a.width))}})(),c=(function(){let n=e.left-i.borderWidth-i.horizontalPadding,s=Math.max(i.horizontalPadding,e.left-t.width-i.borderWidth),c=new Po(n,r.height-e.top-i.borderHeight-i.verticalPadding),l=c.with(void 0,e.top+e.height-i.borderHeight-i.verticalPadding);return{top:o,left:s,fit:n-t.width,maxSizeTop:c,maxSizeBottom:l,minSize:a.with(Math.min(n,a.width))}})(),l=(function(){let n=e.left,o=-i.borderWidth+e.top+e.height,s=new Po(e.width-i.borderHeight,r.height-e.top-e.height-i.verticalPadding);return{top:o,left:n,fit:s.height-t.height,maxSizeBottom:s,maxSizeTop:s,minSize:a.with(s.width)}})(),u=[s,c,l],d=u.find(e=>e.fit>=0)??u.sort((e,t)=>t.fit-e.fit)[0],f=e.top+e.height-i.borderHeight,p,m=t.height,h=Math.max(d.maxSizeTop.height,d.maxSizeBottom.height);m>h&&(m=h);let g;n?m<=d.maxSizeTop.height?(p=!0,g=d.maxSizeTop):(p=!1,g=d.maxSizeBottom):m<=d.maxSizeBottom.height?(p=!1,g=d.maxSizeBottom):(p=!0,g=d.maxSizeTop);let{top:_,left:ee}=d;!p&&m>e.height&&(_=f-m);let v=this._editor.getDomNode();if(v){let e=v.getBoundingClientRect();_-=e.top,ee-=e.left}this._applyTopLeft({left:ee,top:_}),this._resizable.enableSashes(!p,d===s,p,d!==s),this._resizable.minSize=d.minSize,this._resizable.maxSize=g,this._resizable.layout(m,Math.min(g.width,t.width)),this.widget.layout(this._resizable.size.width,this._resizable.size.height)}_applyTopLeft(e){this._topLeft=e,this._editor.layoutOverlayWidget(this)}};const PO=ma(`fileService`);var FO;(function(e){e[e.FILE=0]=`FILE`,e[e.FOLDER=1]=`FOLDER`,e[e.ROOT_FOLDER=2]=`ROOT_FOLDER`})(FO||={});var IO=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function LO(e,t,n,r,i){if(I.isThemeIcon(i))return[`codicon-${i.id}`,`predefined-file-icon`];if(ur.isUri(i))return[];let a=r===FO.ROOT_FOLDER?[`rootfolder-icon`]:r===FO.FOLDER?[`folder-icon`]:[`file-icon`];if(n){let i;if(n.scheme===ls.data)i=Ao.parseMetaData(n).get(Ao.META_DATA_LABEL);else{let e=n.path.match(IO);e?(i=zO(e[2].toLowerCase()),e[1]&&a.push(`${zO(e[1].toLowerCase())}-name-dir-icon`)):i=zO(n.authority.toLowerCase())}if(r===FO.ROOT_FOLDER)a.push(`${i}-root-name-folder-icon`);else if(r===FO.FOLDER)a.push(`${i}-name-folder-icon`);else{if(i){if(a.push(`${i}-name-file-icon`),a.push(`name-file-icon`),i.length<=255){let e=i.split(`.`);for(let t=1;t<e.length;t++)a.push(`${e.slice(t).join(`.`)}-ext-file-icon`)}a.push(`ext-file-icon`)}let r=RO(e,t,n);r&&a.push(`${zO(r)}-lang-file-icon`)}}return a}function RO(e,t,n){if(!n)return null;let r=null;if(n.scheme===ls.data){let e=Ao.parseMetaData(n).get(Ao.META_DATA_MIME);e&&(r=t.getLanguageIdByMimeType(e))}else{let t=e.getModel(n);t&&(r=t.getLanguageId())}return r&&r!==`plaintext`?r:t.guessLanguageIdByFilepathOrFirstLine(n)}function zO(e){return e.replace(/[\s]/g,`/`)}var BO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},VO=function(e,t){return function(n,r){t(n,r,e)}},HO=nu(`suggest-more-info`,X.chevronRight,G(1477,`Icon for more information in the suggest widget.`)),UO=new class e{static{this._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/}static{this._regexStrict=RegExp(`^${e._regexRelaxed.source}$`,`i`)}extract(t,n){if(t.textLabel.match(e._regexStrict))return n[0]=t.textLabel,!0;if(t.completion.detail&&t.completion.detail.match(e._regexStrict))return n[0]=t.completion.detail,!0;if(t.completion.documentation){let r=typeof t.completion.documentation==`string`?t.completion.documentation:t.completion.documentation.value,i=e._regexRelaxed.exec(r);if(i&&(i.index===0||i.index+i[0].length===r.length))return n[0]=i[0],!0}return!1}},WO=class{constructor(e,t,n,r){this._editor=e,this._modelService=t,this._languageService=n,this._themeService=r,this._onDidToggleDetails=new D,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId=`suggestion`}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){let t=new L,n=e;n.classList.add(`show-file-icons`);let r=B(e,b(`.icon`)),i=B(r,b(`span.colorspan`)),a=B(e,b(`.contents`)),o=B(a,b(`.main`)),s=B(o,b(`.icon-label.codicon`)),c=B(o,b(`span.left`)),l=B(o,b(`span.right`)),u=new za(c,{supportHighlights:!0,supportIcons:!0});t.add(u);let d=B(c,b(`span.signature-label`)),f=B(c,b(`span.qualifier-label`)),p=B(l,b(`span.details-label`)),m=B(l,b(`span.readMore`+I.asCSSSelector(HO)));return m.title=G(1478,`Read More`),{root:n,left:c,right:l,icon:r,colorspan:i,iconLabel:u,iconContainer:s,parametersLabel:d,qualifierLabel:f,detailsLabel:p,readMore:m,disposables:t,configureFont:()=>{let e=this._editor.getOptions(),t=e.get(59),i=t.getMassagedFontFamily(),a=t.fontFeatureSettings,s=t.fontVariationSettings,c=e.get(135)||t.fontSize,l=e.get(136)||t.lineHeight,u=t.fontWeight,d=t.letterSpacing,f=`${c}px`,p=`${l}px`,h=`${d}px`;n.style.fontSize=f,n.style.fontWeight=u,n.style.letterSpacing=h,o.style.fontFamily=i,o.style.fontFeatureSettings=a,o.style.fontVariationSettings=s,o.style.lineHeight=p,r.style.height=p,r.style.width=p,m.style.height=p,m.style.width=p}}}renderElement(e,t,n){n.configureFont();let{completion:r}=e;n.colorspan.style.backgroundColor=``;let i={labelEscapeNewLines:!0,matches:Mi(e.score)},a=[];if(r.kind===19&&UO.extract(e,a))n.icon.className=`icon customcolor`,n.iconContainer.className=`icon hide`,n.colorspan.style.backgroundColor=a[0];else if(r.kind===20&&this._themeService.getFileIconTheme().hasFileIcons){n.icon.className=`icon hide`,n.iconContainer.className=`icon hide`;let t=LO(this._modelService,this._languageService,ur.from({scheme:`fake`,path:e.textLabel}),FO.FILE),a=LO(this._modelService,this._languageService,ur.from({scheme:`fake`,path:r.detail}),FO.FILE);i.extraClasses=t.length>a.length?t:a}else r.kind===23&&this._themeService.getFileIconTheme().hasFolderIcons?(n.icon.className=`icon hide`,n.iconContainer.className=`icon hide`,i.extraClasses=[LO(this._modelService,this._languageService,ur.from({scheme:`fake`,path:e.textLabel}),FO.FOLDER),LO(this._modelService,this._languageService,ur.from({scheme:`fake`,path:r.detail}),FO.FOLDER)].flat()):(n.icon.className=`icon hide`,n.iconContainer.className=``,n.iconContainer.classList.add(`suggest-icon`,...I.asClassNameArray(el.toIcon(r.kind))));r.tags&&r.tags.indexOf(1)>=0&&(i.extraClasses=(i.extraClasses||[]).concat([`deprecated`]),i.matches=[]),n.iconLabel.setLabel(e.textLabel,void 0,i),typeof r.label==`string`?(n.parametersLabel.textContent=``,n.detailsLabel.textContent=GO(r.detail||``),n.root.classList.add(`string-label`)):(n.parametersLabel.textContent=GO(r.label.detail||``),n.detailsLabel.textContent=GO(r.label.description||``),n.root.classList.remove(`string-label`)),this._editor.getOption(134).showInlineDetails?Hs(n.detailsLabel):Jr(n.detailsLabel),jO(e)?(n.right.classList.add(`can-expand-details`),Hs(n.readMore),n.readMore.onmousedown=e=>{e.stopPropagation(),e.preventDefault()},n.readMore.onclick=e=>{e.stopPropagation(),e.preventDefault(),this._onDidToggleDetails.fire()}):(n.right.classList.remove(`can-expand-details`),Jr(n.readMore),n.readMore.onmousedown=null,n.readMore.onclick=null)}disposeTemplate(e){e.disposables.dispose()}};WO=BO([VO(1,_n),VO(2,wt),VO(3,pa)],WO);function GO(e){return e.replace(/\r\n|\r|\n/g,``)}var KO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qO=function(e,t){return function(n,r){t(n,r,e)}},JO;F(`editorSuggestWidget.background`,ai,G(1458,`Background color of the suggest widget.`)),F(`editorSuggestWidget.border`,Xe,G(1459,`Border color of the suggest widget.`));const YO=F(`editorSuggestWidget.foreground`,dc,G(1460,`Foreground color of the suggest widget.`));F(`editorSuggestWidget.selectedForeground`,hr,G(1461,`Foreground color of the selected entry in the suggest widget.`)),F(`editorSuggestWidget.selectedIconForeground`,lt,G(1462,`Icon foreground color of the selected entry in the suggest widget.`));const XO=F(`editorSuggestWidget.selectedBackground`,Kn,G(1463,`Background color of the selected entry in the suggest widget.`));F(`editorSuggestWidget.highlightForeground`,zr,G(1464,`Color of the match highlights in the suggest widget.`)),F(`editorSuggestWidget.focusHighlightForeground`,Cn,G(1465,`Color of the match highlights in the suggest widget when an item is focused.`)),F(`editorSuggestWidgetStatus.foreground`,At(YO,.5),G(1466,`Foreground color of the suggest widget status.`));var ZO=class{constructor(e,t){this._service=e,this._key=`suggestWidget.size/${t.getEditorType()}/${t instanceof sy}`}restore(){let e=this._service.get(this._key,0)??``;try{let t=JSON.parse(e);if(Po.is(t))return Po.lift(t)}catch{}}store(e){this._service.store(this._key,JSON.stringify(e),0,1)}reset(){this._service.remove(this._key,0)}},QO=class{static{JO=this}static{this.LOADING_MESSAGE=G(1467,`Loading...`)}static{this.NO_SUGGESTIONS_MESSAGE=G(1468,`No suggestions.`)}constructor(e,t,n,r,i){this.editor=e,this._storageService=t,this._state=0,this._isAuto=!1,this._pendingLayout=new Bt,this._pendingShowDetails=new Bt,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new Me,this._disposables=new L,this._onDidSelect=new Gr,this._onDidFocus=new Gr,this._onDidHide=new D,this._onDidShow=new D,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new D,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new G_,this.element.domNode.classList.add(`editor-widget`,`suggest-widget`),this._contentWidget=new $O(this,e),this._persistedSize=new ZO(t,e);class a{constructor(e,t,n=!1,r=!1){this.persistedSize=e,this.currentSize=t,this.persistHeight=n,this.persistWidth=r}}let o;this._disposables.add(this.element.onDidWillResize(()=>{this._contentWidget.lockPreference(),o=new a(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(e=>{if(this._resize(e.dimension.width,e.dimension.height),o&&(o.persistHeight=o.persistHeight||!!e.north||!!e.south,o.persistWidth=o.persistWidth||!!e.east||!!e.west),e.done){if(o){let{itemHeight:e,defaultSize:t}=this.getLayoutInfo(),n=Math.round(e/2),{width:r,height:i}=this.element.size;(!o.persistHeight||Math.abs(o.currentSize.height-i)<=n)&&(i=o.persistedSize?.height??t.height),(!o.persistWidth||Math.abs(o.currentSize.width-r)<=n)&&(r=o.persistedSize?.width??t.width),this._persistedSize.store(new Po(r,i))}this._contentWidget.unlockPreference(),o=void 0}})),this._messageElement=B(this.element.domNode,b(`.message`)),this._listElement=B(this.element.domNode,b(`.tree`));let s=this._disposables.add(i.createInstance(MO,this.editor));s.onDidClose(()=>this.toggleDetails(),this,this._disposables),this._details=new NO(s,this.editor);let c=()=>this.element.domNode.classList.toggle(`no-icons`,!this.editor.getOption(134).showIcons);c();let l=i.createInstance(WO,this.editor);this._disposables.add(l),this._disposables.add(l.onDidToggleDetails(()=>this.toggleDetails())),this._list=new vn(`SuggestWidget`,this._listElement,{getHeight:e=>this.getLayoutInfo().itemHeight,getTemplateId:e=>`suggestion`},[l],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>To?`listitem`:`option`,getWidgetAriaLabel:()=>G(1469,`Suggest`),getWidgetRole:()=>`listbox`,getAriaLabel:e=>{let t=e.textLabel,n=el.toLabel(e.completion.kind);if(typeof e.completion.label!=`string`){let{detail:r,description:i}=e.completion.label;r&&i?t=G(1470,`{0} {1}, {2}, {3}`,t,r,i,n):r?t=G(1471,`{0} {1}, {2}`,t,r,n):i&&(t=G(1472,`{0}, {1}, {2}`,t,i,n))}else t=G(1473,`{0}, {1}`,t,n);if(!e.isResolved||!this._isDetailsVisible())return t;let{documentation:r,detail:i}=e.completion,a=Vi(`{0}{1}`,i||``,r?typeof r==`string`?r:r.value:``);return G(1474,`{0}, docs: {1}`,t,a)}}}),this._list.style(Ti({listInactiveFocusBackground:XO,listInactiveFocusOutline:Mn})),this._status=i.createInstance(OO,this.element.domNode,jT);let u=()=>this.element.domNode.classList.toggle(`with-status-bar`,this.editor.getOption(134).showStatusBar);u(),this._disposables.add(r.onDidColorThemeChange(e=>this._onThemeChange(e))),this._onThemeChange(r.getColorTheme()),this._disposables.add(this._list.onMouseDown(e=>this._onListMouseDownOrTap(e))),this._disposables.add(this._list.onTap(e=>this._onListMouseDownOrTap(e))),this._disposables.add(this._list.onDidChangeSelection(e=>this._onListSelection(e))),this._disposables.add(this._list.onDidChangeFocus(e=>this._onListFocus(e))),this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged())),this._disposables.add(this.editor.onDidChangeConfiguration(e=>{e.hasChanged(134)&&(u(),c()),this._completionModel&&(e.hasChanged(59)||e.hasChanged(135)||e.hasChanged(136))&&this._list.splice(0,this._list.length,this._completionModel.items)})),this._ctxSuggestWidgetVisible=Z.Visible.bindTo(n),this._ctxSuggestWidgetDetailsVisible=Z.DetailsVisible.bindTo(n),this._ctxSuggestWidgetMultipleSuggestions=Z.MultipleSuggestions.bindTo(n),this._ctxSuggestWidgetHasFocusedSuggestion=Z.HasFocusedSuggestion.bindTo(n),this._disposables.add(Ll(this._details.widget.domNode,`keydown`,e=>{this._onDetailsKeydown.fire(e)})),this._disposables.add(this.editor.onMouseDown(e=>this._onEditorMouseDown(e)))}dispose(){this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),this._loadingTimeout?.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(e){this._details.widget.domNode.contains(e.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(e.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){this._state!==0&&this._contentWidget.layout()}_onListMouseDownOrTap(e){e.element===void 0||e.index===void 0||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){let n=this._completionModel;n&&(this._onDidSelect.fire({item:e,index:t,model:n}),this.editor.focus())}_onThemeChange(e){this._details.widget.borderWidth=ce(e.type)?2:1}_onListFocus(e){if(this._ignoreFocusEvents)return;if(this._state===5&&this._setState(3),!e.elements.length){this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);return}if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);let t=e.elements[0],n=e.indexes[0];t!==this._focusedItem&&(this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=t,this._list.reveal(n),this._currentSuggestionDetails=li(async e=>{let n=$e(()=>{this._isDetailsVisible()&&this._showDetails(!0,!1)},250),r=e.onCancellationRequested(()=>n.dispose());try{return await t.resolve(e)}finally{n.dispose(),r.dispose()}}),this._currentSuggestionDetails.then(()=>{n>=this._list.length||t!==this._list.element(n)||(this._ignoreFocusEvents=!0,this._list.splice(n,1,[t]),this._list.setFocus([n]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this._showDetails(!1,!1):this.element.domNode.classList.remove(`docs-side`),this.editor.setAriaOptions({activeDescendant:this._list.getElementID(n)}))}).catch(mr)),this._onDidFocus.fire({item:t,index:n,model:this._completionModel})}_setState(e){if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle(`frozen`,e===4),this.element.domNode.classList.remove(`message`),e){case 0:Jr(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove(`visible`),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case 1:this.element.domNode.classList.add(`message`),this._messageElement.textContent=JO.LOADING_MESSAGE,Jr(this._listElement,this._status.element),Hs(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,wr(JO.LOADING_MESSAGE);break;case 2:this.element.domNode.classList.add(`message`),this._messageElement.textContent=JO.NO_SUGGESTIONS_MESSAGE,Jr(this._listElement,this._status.element),Hs(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,wr(JO.NO_SUGGESTIONS_MESSAGE);break;case 3:Jr(this._messageElement),Hs(this._listElement,this._status.element),this._show();break;case 4:Jr(this._messageElement),Hs(this._listElement,this._status.element),this._show();break;case 5:Jr(this._messageElement),Hs(this._listElement,this._status.element),this._details.show(),this._show(),this._details.widget.focus();break}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add(`visible`),this._onDidShow.fire(this)},100)}showTriggered(e,t){this._state===0&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!e,this._isAuto||(this._loadingTimeout=$e(()=>this._setState(1),t)))}showSuggestions(e,t,n,r,i){if(this._contentWidget.setPosition(this.editor.getPosition()),this._loadingTimeout?.dispose(),this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==e&&(this._completionModel=e),n&&this._state!==2&&this._state!==0){this._setState(4);return}let a=this._completionModel.items.length,o=a===0;if(this._ctxSuggestWidgetMultipleSuggestions.set(a>1),o){this._setState(r?0:2),this._completionModel=void 0;return}this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(n?4:3),this._list.reveal(t,0,t===0?0:this.getLayoutInfo().itemHeight*.33),this._list.setFocus(i?[]:[t])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=tr(eo(this.element.domNode),()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove(`focused`)})}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageDown(),!0;case 1:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollBottom(),!0;case 1:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageUp(),!0;case 1:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollTop(),!0;case 1:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(this._state!==0&&this._state!==2&&this._state!==1&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){this._state===5?(this._list.setFocus(this._list.getFocus()),this._setState(3)):this._state===3&&(this._setState(5),this._isDetailsVisible()?this._details.widget.focus():this.toggleDetails(!0))}toggleDetails(e=!1){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove(`shows-details`)):(jO(this._list.getFocusedElements()[0])||this._explainMode)&&(this._state===3||this._state===5||this._state===4)&&(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this._showDetails(!1,e))}_showDetails(e,t){this._pendingShowDetails.value=tr(eo(this.element.domNode),()=>{this._pendingShowDetails.clear(),this._details.show();let n=!1;e?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._details.widget.isEmpty?this._details.hide():(this._positionDetails(),this.element.domNode.classList.add(`shows-details`),t&&(this._details.widget.focus(),n=!0)),n||this.editor.focus()})}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this._showDetails(!1,!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){this._pendingLayout.clear(),this._pendingShowDetails.clear(),this._loadingTimeout?.dispose(),this._setState(0),this._onDidHide.fire(this),this.element.clearSashHoverState();let e=this._persistedSize.restore(),t=Math.ceil(this.getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}isFrozen(){return this._state===4}_afterRender(e){if(e===null){this._isDetailsVisible()&&this._details.hide();return}this._state===2||this._state===1||(this._isDetailsVisible()&&!this._details.widget.isEmpty&&this._details.show(),this._positionDetails())}_layout(e){if(!this.editor.hasModel()||!this.editor.getDomNode())return;let t=rl(this.element.domNode.ownerDocument.body),n=this.getLayoutInfo();e||=n.defaultSize;let r=e.height,i=e.width;if(this._status.element.style.height=`${n.itemHeight}px`,this._state===2||this._state===1)r=n.itemHeight+n.borderHeight,i=n.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new Po(i,r),this._contentWidget.setPreference(2);else{let a=t.width-n.borderHeight-2*n.horizontalPadding;i>a&&(i=a);let o=this._completionModel?this._completionModel.stats.pLabelLen*n.typicalHalfwidthCharacterWidth:i,s=n.statusBarHeight+this._list.contentHeight+n.borderHeight,c=n.itemHeight+n.statusBarHeight,l=vs(this.editor.getDomNode()),u=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),d=l.top+u.top+u.height,f=Math.min(t.height-d-n.verticalPadding,s),p=l.top+u.top-n.verticalPadding,m=Math.min(p,s),h=Math.min(Math.max(m,f)+n.borderHeight,s);r===this._cappedHeight?.capped&&(r=this._cappedHeight.wanted),r<c&&(r=c),r>h&&(r=h),r>f&&m>f||this._forceRenderingAbove&&p>150?(this._contentWidget.setPreference(1),this.element.enableSashes(!0,!0,!1,!1),h=m):(this._contentWidget.setPreference(2),this.element.enableSashes(!1,!0,!0,!1),h=f),this.element.preferredSize=new Po(o,n.defaultSize.height),this.element.maxSize=new Po(a,h),this.element.minSize=new Po(220,c),this._cappedHeight=r===s?{wanted:this._cappedHeight?.wanted??e.height,capped:r}:void 0}this._resize(i,r)}_resize(e,t){let{width:n,height:r}=this.element.maxSize;e=Math.min(n,e),t=Math.min(r,t);let{statusBarHeight:i}=this.getLayoutInfo();this._list.layout(t-i,e),this._listElement.style.height=`${t-i}px`,this.element.layout(t,e),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,this._contentWidget.getPosition()?.preference[0]===2)}getLayoutInfo(){let e=this.editor.getOption(59),t=Qo(this.editor.getOption(136)||e.lineHeight,8,1e3),n=!this.editor.getOption(134).showStatusBar||this._state===2||this._state===1?0:t,r=this._details.widget.borderWidth,i=2*r;return{itemHeight:t,statusBarHeight:n,borderWidth:r,borderHeight:i,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new Po(430,n+12*t)}}_isDetailsVisible(){return this._storageService.getBoolean(`expandSuggestionDocs`,0,!1)}_setDetailsVisible(e){this._storageService.store(`expandSuggestionDocs`,e,0,0)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};QO=JO=KO([qO(1,Qr),qO(2,On),qO(3,pa),qO(4,k)],QO);var $O=class{constructor(e,t){this._widget=e,this._editor=t,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return`editor.widget.suggestWidget`}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return this._hidden||!this._position||!this._preference?null:{position:this._position,preference:[this._preference]}}beforeRender(){let{height:e,width:t}=this._widget.element.size,{borderWidth:n,horizontalPadding:r}=this._widget.getLayoutInfo();return new Po(t+2*n+r,e+2*n)}afterRender(e){this._widget._afterRender(e)}setPreference(e){this._preferenceLocked||(this._preference=e)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(e){this._position=e}},ek=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},tk=function(e,t){return function(n,r){t(n,r,e)}},nk,rk=class{constructor(e,t){if(this._model=e,this._position=t,this._decorationOptions=Y.register({description:`suggest-line-suffix`,stickiness:1}),e.getLineMaxColumn(t.lineNumber)!==t.column){let n=e.getOffsetAt(t),r=e.getPositionAt(n+1);e.changeDecorations(e=>{this._marker&&e.removeDecoration(this._marker),this._marker=e.addDecoration(T.fromPositions(t,r),this._decorationOptions)})}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.changeDecorations(e=>{e.removeDecoration(this._marker),this._marker=void 0})}delta(e){if(this._model.isDisposed()||this._position.lineNumber!==e.lineNumber)return 0;if(this._marker){let t=this._model.getDecorationRange(this._marker);return this._model.getOffsetAt(t.getStartPosition())-this._model.getOffsetAt(e)}else return this._model.getLineMaxColumn(e.lineNumber)-e.column}},ik=class{static{nk=this}static{this.ID=`editor.contrib.suggestController`}static get(e){return e.getContribution(nk.ID)}get onWillInsertSuggestItem(){return this._onWillInsertSuggestItem.event}constructor(e,t,n,r,i,a,o){this._memoryService=t,this._commandService=n,this._contextKeyService=r,this._instantiationService=i,this._logService=a,this._telemetryService=o,this._lineSuffix=new Bt,this._toDispose=new L,this._selectors=new ak(e=>e.priority),this._onWillInsertSuggestItem=new D,this._wantsForceRenderingAbove=!1,this.editor=e,this.model=i.createInstance(wO,this.editor),this._selectors.register({priority:0,select:(e,t,n)=>this._memoryService.select(e,t,n)});let s=Z.InsertMode.bindTo(r);s.set(e.getOption(134).insertMode),this._toDispose.add(this.model.onDidTrigger(()=>s.set(e.getOption(134).insertMode))),this.widget=this._toDispose.add(new As(eo(e.getDomNode()),()=>{let e=this._instantiationService.createInstance(QO,this.editor);this._toDispose.add(e),this._toDispose.add(e.onDidSelect(e=>this._insertSuggestion(e,0),this));let t=new pO(this.editor,e,this.model,e=>this._insertSuggestion(e,2));this._toDispose.add(t);let n=Z.MakesTextEdit.bindTo(this._contextKeyService),r=Z.HasInsertAndReplaceRange.bindTo(this._contextKeyService),i=Z.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(Cl(()=>{n.reset(),r.reset(),i.reset()})),this._toDispose.add(e.onDidFocus(({item:e})=>{let t=this.editor.getPosition(),a=e.editStart.column,o=t.column,s=!0;this.editor.getOption(1)===`smart`&&this.model.state===2&&!e.completion.additionalTextEdits&&!(e.completion.insertTextRules&4)&&o-a===e.completion.insertText.length&&(s=this.editor.getModel().getValueInRange({startLineNumber:t.lineNumber,startColumn:a,endLineNumber:t.lineNumber,endColumn:o})!==e.completion.insertText),n.set(s),r.set(!C.equals(e.editInsertEnd,e.editReplaceEnd)),i.set(!!e.provider.resolveCompletionItem||!!e.completion.documentation||e.completion.detail!==e.completion.label)})),this._toDispose.add(e.onDetailsKeyDown(e=>{if(e.toKeyCodeChord().equals(new qn(!0,!1,!1,!1,33))||po&&e.toKeyCodeChord().equals(new qn(!1,!1,!1,!0,33))){e.stopPropagation();return}e.toKeyCodeChord().isModifierKey()||this.editor.focus()})),this._wantsForceRenderingAbove&&e.forceRenderingAbove(),e})),this._overtypingCapturer=this._toDispose.add(new As(eo(e.getDomNode()),()=>this._toDispose.add(new TO(this.editor,this.model)))),this._alternatives=this._toDispose.add(new As(eo(e.getDomNode()),()=>this._toDispose.add(new fO(this.editor,this._contextKeyService)))),this._toDispose.add(i.createInstance(cO,e)),this._toDispose.add(this.model.onDidTrigger(e=>{this.widget.value.showTriggered(e.auto,e.shy?250:50),this._lineSuffix.value=new rk(this.editor.getModel(),e.position)})),this._toDispose.add(this.model.onDidSuggest(e=>{if(e.triggerOptions.shy)return;let t=-1;for(let n of this._selectors.itemsOrderedByPriorityDesc)if(t=n.select(this.editor.getModel(),this.editor.getPosition(),e.completionModel.items),t!==-1)break;if(t===-1&&(t=0),this.model.state===0)return;let n=!1;if(e.triggerOptions.auto){let t=this.editor.getOption(134);t.selectionMode===`never`||t.selectionMode===`always`?n=t.selectionMode===`never`:t.selectionMode===`whenTriggerCharacter`?n=e.triggerOptions.triggerKind!==1:t.selectionMode===`whenQuickSuggestion`&&(n=e.triggerOptions.triggerKind===1&&!e.triggerOptions.refilter)}this.widget.value.showSuggestions(e.completionModel,t,e.isFrozen,e.triggerOptions.auto,n)})),this._toDispose.add(this.model.onDidCancel(e=>{e.retrigger||this.widget.value.hideWidget()})),this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{this.model.cancel(),this.model.clear()}));let c=Z.AcceptSuggestionsOnEnter.bindTo(r),l=()=>{let e=this.editor.getOption(1);c.set(e===`on`||e===`smart`)};this._toDispose.add(this.editor.onDidChangeConfiguration(()=>l())),l()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose(),this._onWillInsertSuggestItem.dispose()}_insertSuggestion(e,t){if(!e||!e.item){this._alternatives.value.reset(),this.model.cancel(),this.model.clear();return}if(!this.editor.hasModel())return;let n=xE.get(this.editor);if(!n)return;this._onWillInsertSuggestItem.fire({item:e.item});let r=this.editor.getModel(),i=r.getAlternativeVersionId(),{item:a}=e,o=[],s=new Sr;t&1||this.editor.pushUndoStop();let c=this.getOverwriteInfo(a,!!(t&8));this._memoryService.memorize(r,this.editor.getPosition(),a);let l=a.isResolved,u=-1,d=-1;if(Array.isArray(a.completion.additionalTextEdits)){this.model.cancel();let e=sd.capture(this.editor);this.editor.executeEdits(`suggestController.additionalTextEdits.sync`,a.completion.additionalTextEdits.map(e=>{let t=T.lift(e.range);if(t.startLineNumber===a.position.lineNumber&&t.startColumn>a.position.column){let e=this.editor.getPosition().column-a.position.column,n=e,r=T.spansMultipleLines(t)?0:e;t=new T(t.startLineNumber,t.startColumn+n,t.endLineNumber,t.endColumn+r)}return Ss.replaceMove(t,e.text)})),e.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!l){let e=new vd,n,i=r.onDidChangeContent(e=>{if(e.isFlush){s.cancel(),i.dispose();return}for(let t of e.changes){let e=T.getEndPosition(t.range);(!n||C.isBefore(e,n))&&(n=e)}}),c=t;t|=2;let l=!1,u=this.editor.onWillType(()=>{u.dispose(),l=!0,c&2||this.editor.pushUndoStop()});o.push(a.resolve(s.token).then(()=>{if(!a.completion.additionalTextEdits||s.token.isCancellationRequested)return;if(n&&a.completion.additionalTextEdits.some(e=>C.isBefore(n,T.getStartPosition(e.range))))return!1;l&&this.editor.pushUndoStop();let e=sd.capture(this.editor);return this.editor.executeEdits(`suggestController.additionalTextEdits.async`,a.completion.additionalTextEdits.map(e=>Ss.replaceMove(T.lift(e.range),e.text))),e.restoreRelativeVerticalPositionOfCursor(this.editor),(l||!(c&2))&&this.editor.pushUndoStop(),!0}).then(t=>{this._logService.trace(`[suggest] async resolving of edits DONE (ms, applied?)`,e.elapsed(),t),d=t===!0?1:t===!1?0:-2}).finally(()=>{i.dispose(),u.dispose()}))}let{insertText:f}=a.completion;if(a.completion.insertTextRules&4||(f=Bm.escape(f)),this.model.cancel(),n.insert(f,{overwriteBefore:c.overwriteBefore,overwriteAfter:c.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(a.completion.insertTextRules&1),clipboardText:e.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value,reason:Fe.suggest({providerId:Ba.fromExtensionId(a.extensionId?.value)})}),t&2||this.editor.pushUndoStop(),a.completion.command)if(a.completion.command.id===ok.id)this.model.trigger({auto:!0,retrigger:!0});else{let e=new vd;o.push(this._commandService.executeCommand(a.completion.command.id,...a.completion.command.arguments?[...a.completion.command.arguments]:[]).catch(e=>{a.completion.extensionId?ct(e):mr(e)}).finally(()=>{u=e.elapsed()}))}t&4&&this._alternatives.value.set(e,e=>{for(s.cancel();r.canUndo();){i!==r.getAlternativeVersionId()&&r.undo(),this._insertSuggestion(e,3|(t&8?8:0));break}}),this._alertCompletionItem(a),Promise.all(o).finally(()=>{this._reportSuggestionAcceptedTelemetry(a,r,l,u,d,e.index,e.model.items),this.model.clear(),s.dispose()})}_reportSuggestionAcceptedTelemetry(e,t,n,r,i,a,o){if(Math.random()>1e-4)return;let s=new Map;for(let e=0;e<Math.min(30,o.length);e++){let t=o[e].textLabel;s.has(t)?s.get(t).push(e):s.set(t,[e])}let c=s.get(e.textLabel),l=c&&c.length>1?c[0]:-1;this._telemetryService.publicLog2(`suggest.acceptedSuggestion`,{extensionId:e.extensionId?.value??`unknown`,providerId:e.provider._debugDisplayName??`unknown`,kind:e.completion.kind,basenameHash:Tc($o(t.uri)).toString(16),languageId:t.getLanguageId(),fileExtension:ps(t.uri),resolveInfo:e.provider.resolveCompletionItem?n?1:0:-1,resolveDuration:e.resolveDuration,commandDuration:r,additionalEditsAsync:i,index:a,firstIndex:l})}getOverwriteInfo(e,t){J(this.editor.hasModel());let n=this.editor.getOption(134).insertMode===`replace`;t&&(n=!n);let r=e.position.column-e.editStart.column,i=(n?e.editReplaceEnd.column:e.editInsertEnd.column)-e.position.column,a=this.editor.getPosition().column-e.position.column,o=this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0;return{overwriteBefore:r+a,overwriteAfter:i+o}}_alertCompletionItem(e){if($t(e.completion.additionalTextEdits)){let t=G(1448,`Accepting '{0}' made {1} additional edits`,e.textLabel,e.completion.additionalTextEdits.length);va(t)}}triggerSuggest(e,t,n){this.editor.hasModel()&&(this.model.trigger({auto:t??!1,completionOptions:{providerFilter:e,kindFilter:n?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),0),this.editor.focus())}triggerSuggestAndAcceptBest(e){if(!this.editor.hasModel())return;let t=this.editor.getPosition(),n=()=>{t.equals(this.editor.getPosition())&&this._commandService.executeCommand(e.fallback)},r=e=>{if(e.completion.insertTextRules&4||e.completion.additionalTextEdits)return!0;let t=this.editor.getPosition(),n=e.editStart.column,r=t.column;return r-n===e.completion.insertText.length?this.editor.getModel().getValueInRange({startLineNumber:t.lineNumber,startColumn:n,endLineNumber:t.lineNumber,endColumn:r})!==e.completion.insertText:!0};An.once(this.model.onDidTrigger)(e=>{let t=[];An.any(this.model.onDidTrigger,this.model.onDidCancel)(()=>{Ot(t),n()},void 0,t),this.model.onDidSuggest(({completionModel:e})=>{if(Ot(t),e.items.length===0){n();return}let i=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),e.items),a=e.items[i];if(!r(a)){n();return}this.editor.pushUndoStop(),this._insertSuggestion({index:i,item:a,model:e},7)},void 0,t)}),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(t,0),this.editor.focus()}acceptSelectedSuggestion(e,t){let n=this.widget.value.getFocusedItem(),r=0;e&&(r|=4),t&&(r|=8),this._insertSuggestion(n,r)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.isInitialized?this.widget.value.forceRenderingAbove():this._wantsForceRenderingAbove=!0}stopForceRenderingAbove(){this.widget.isInitialized?this.widget.value.stopForceRenderingAbove():this._wantsForceRenderingAbove=!1}registerSelector(e){return this._selectors.register(e)}};ik=nk=ek([tk(1,iO),tk(2,Te),tk(3,On),tk(4,k),tk(5,Wl),tk(6,Fu)],ik);var ak=class{constructor(e){this.prioritySelector=e,this._items=[]}register(e){if(this._items.indexOf(e)!==-1)throw Error(`Value is already registered`);return this._items.push(e),this._items.sort((e,t)=>this.prioritySelector(t)-this.prioritySelector(e)),{dispose:()=>{let t=this._items.indexOf(e);t>=0&&this._items.splice(t,1)}}}get itemsOrderedByPriorityDesc(){return this._items}},ok=class e extends R{static{this.id=`editor.action.triggerSuggest`}constructor(){super({id:e.id,label:U(1456,`Trigger Suggest`),precondition:E.and(y.writable,y.hasCompletionItemProvider,Z.Visible.toNegated()),kbOpts:{kbExpr:y.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[521,2087]},weight:100}})}run(e,t,n){let r=ik.get(t);if(!r)return;let i;n&&typeof n==`object`&&n.auto===!0&&(i=!0),r.triggerSuggest(void 0,i,void 0)}};K(ik.ID,ik,2),q(ok);var sk=190,ck=Ar.bindToContribution(ik.get);W(new ck({id:`acceptSelectedSuggestion`,precondition:E.and(Z.Visible,Z.HasFocusedSuggestion),handler(e){e.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:2,kbExpr:E.and(Z.Visible,y.textInputFocus),weight:sk},{primary:3,kbExpr:E.and(Z.Visible,y.textInputFocus,Z.AcceptSuggestionsOnEnter,Z.MakesTextEdit),weight:sk}],menuOpts:[{menuId:jT,title:G(1449,`Insert`),group:`left`,order:1,when:Z.HasInsertAndReplaceRange.toNegated()},{menuId:jT,title:G(1450,`Insert`),group:`left`,order:1,when:E.and(Z.HasInsertAndReplaceRange,Z.InsertMode.isEqualTo(`insert`))},{menuId:jT,title:G(1451,`Replace`),group:`left`,order:1,when:E.and(Z.HasInsertAndReplaceRange,Z.InsertMode.isEqualTo(`replace`))}]})),W(new ck({id:`acceptAlternativeSelectedSuggestion`,precondition:E.and(Z.Visible,y.textInputFocus,Z.HasFocusedSuggestion),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:1027,secondary:[1026]},handler(e){e.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:jT,group:`left`,order:2,when:E.and(Z.HasInsertAndReplaceRange,Z.InsertMode.isEqualTo(`insert`)),title:G(1452,`Replace`)},{menuId:jT,group:`left`,order:2,when:E.and(Z.HasInsertAndReplaceRange,Z.InsertMode.isEqualTo(`replace`)),title:G(1453,`Insert`)}]})),gd.registerCommandAlias(`acceptSelectedSuggestionOnEnter`,`acceptSelectedSuggestion`),W(new ck({id:`hideSuggestWidget`,precondition:Z.Visible,handler:e=>e.cancelSuggestWidget(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:9,secondary:[1033]}})),W(new ck({id:`selectNextSuggestion`,precondition:E.and(Z.Visible,E.or(Z.MultipleSuggestions,Z.HasFocusedSuggestion.negate())),handler:e=>e.selectNextSuggestion(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})),W(new ck({id:`selectNextPageSuggestion`,precondition:E.and(Z.Visible,E.or(Z.MultipleSuggestions,Z.HasFocusedSuggestion.negate())),handler:e=>e.selectNextPageSuggestion(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:12,secondary:[2060]}})),W(new ck({id:`selectLastSuggestion`,precondition:E.and(Z.Visible,E.or(Z.MultipleSuggestions,Z.HasFocusedSuggestion.negate())),handler:e=>e.selectLastSuggestion()})),W(new ck({id:`selectPrevSuggestion`,precondition:E.and(Z.Visible,E.or(Z.MultipleSuggestions,Z.HasFocusedSuggestion.negate())),handler:e=>e.selectPrevSuggestion(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})),W(new ck({id:`selectPrevPageSuggestion`,precondition:E.and(Z.Visible,E.or(Z.MultipleSuggestions,Z.HasFocusedSuggestion.negate())),handler:e=>e.selectPrevPageSuggestion(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:11,secondary:[2059]}})),W(new ck({id:`selectFirstSuggestion`,precondition:E.and(Z.Visible,E.or(Z.MultipleSuggestions,Z.HasFocusedSuggestion.negate())),handler:e=>e.selectFirstSuggestion()})),W(new ck({id:`focusSuggestion`,precondition:E.and(Z.Visible,Z.HasFocusedSuggestion.negate()),handler:e=>e.focusSuggestion(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}}})),W(new ck({id:`focusAndAcceptSuggestion`,precondition:E.and(Z.Visible,Z.HasFocusedSuggestion.negate()),handler:e=>{e.focusSuggestion(),e.acceptSelectedSuggestion(!0,!1)}})),W(new ck({id:`toggleSuggestionDetails`,precondition:E.and(Z.Visible,Z.HasFocusedSuggestion),handler:e=>e.toggleSuggestionDetails(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}},menuOpts:[{menuId:jT,group:`right`,order:1,when:E.and(Z.DetailsVisible,Z.CanResolve),title:G(1454,`Show Less`)},{menuId:jT,group:`right`,order:1,when:E.and(Z.DetailsVisible.toNegated(),Z.CanResolve),title:G(1455,`Show More`)}]})),W(new ck({id:`toggleExplainMode`,precondition:Z.Visible,handler:e=>e.toggleExplainMode(),kbOpts:{weight:100,primary:2138}})),W(new ck({id:`toggleSuggestionFocus`,precondition:Z.Visible,handler:e=>e.toggleSuggestionFocus(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:2570,mac:{primary:778}}})),W(new ck({id:`insertBestCompletion`,precondition:E.and(y.textInputFocus,E.equals(`config.editor.tabCompletion`,`on`),cO.AtEnd,Z.Visible.toNegated(),fO.OtherSuggestions.toNegated(),xE.InSnippetMode.toNegated()),handler:(e,t)=>{e.triggerSuggestAndAcceptBest(Yr(t)?{fallback:`tab`,...t}:{fallback:`tab`})},kbOpts:{weight:sk,primary:2}})),W(new ck({id:`insertNextSuggestion`,precondition:E.and(y.textInputFocus,E.equals(`config.editor.tabCompletion`,`on`),fO.OtherSuggestions,Z.Visible.toNegated(),xE.InSnippetMode.toNegated()),handler:e=>e.acceptNextSuggestion(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:2}})),W(new ck({id:`insertPrevSuggestion`,precondition:E.and(y.textInputFocus,E.equals(`config.editor.tabCompletion`,`on`),fO.OtherSuggestions,Z.Visible.toNegated(),xE.InSnippetMode.toNegated()),handler:e=>e.acceptPrevSuggestion(),kbOpts:{weight:sk,kbExpr:y.textInputFocus,primary:1026}})),q(class extends R{constructor(){super({id:`editor.action.resetSuggestSize`,label:U(1457,`Reset Suggest Widget Size`),precondition:void 0})}run(e,t){ik.get(t)?.resetWidgetSize()}});var lk=class extends x{get selectedItem(){return this._currentSuggestItemInfo}constructor(e,t,n){super(),this.editor=e,this.suggestControllerPreselector=t,this.onWillAccept=n,this.isSuggestWidgetVisible=!1,this.isShiftKeyPressed=!1,this._isActive=!1,this._currentSuggestItemInfo=void 0,this._onDidSelectedItemChange=this._register(new D),this.onDidSelectedItemChange=this._onDidSelectedItemChange.event,this._register(e.onKeyDown(e=>{e.shiftKey&&!this.isShiftKeyPressed&&(this.isShiftKeyPressed=!0,this.update(this._isActive))})),this._register(e.onKeyUp(e=>{e.shiftKey&&this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,this.update(this._isActive))}));let r=ik.get(this.editor);if(r){this._register(r.registerSelector({priority:100,select:(e,t,n)=>{let i=this.editor.getModel();if(!i)return-1;let a=this.suggestControllerPreselector(),o=a?UE(a,i):void 0;if(!o)return-1;let s=C.lift(t),c=n.map((e,t)=>{let n=uk.fromSuggestion(r,i,s,e,this.isShiftKeyPressed),a=UE(n.getSingleTextEdit(),i),c=WE(o,a);return{index:t,valid:c,prefixLength:a.text.length,suggestItem:e}}).filter(e=>e&&e.valid&&e.prefixLength>0),l=Nu(c,Mt(e=>e.prefixLength,ca));return l?l.index:-1}}));let e=!1,t=()=>{e||(e=!0,this._register(r.widget.value.onDidShow(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})),this._register(r.widget.value.onDidHide(()=>{this.isSuggestWidgetVisible=!1,this.update(!1)})),this._register(r.widget.value.onDidFocus(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})))};this._register(An.once(r.model.onDidTrigger)(e=>{t()})),this._register(r.onWillInsertSuggestItem(e=>{let t=this.editor.getPosition(),n=this.editor.getModel();if(!t||!n)return;let i=uk.fromSuggestion(r,n,t,e.item,this.isShiftKeyPressed);this.onWillAccept(i)}))}this.update(this._isActive)}update(e){let t=this.getSuggestItemInfo();(this._isActive!==e||!dk(this._currentSuggestItemInfo,t))&&(this._isActive=e,this._currentSuggestItemInfo=t,this._onDidSelectedItemChange.fire())}getSuggestItemInfo(){let e=ik.get(this.editor);if(!e||!this.isSuggestWidgetVisible)return;let t=e.widget.value.getFocusedItem(),n=this.editor.getPosition(),r=this.editor.getModel();if(!(!t||!n||!r))return uk.fromSuggestion(e,r,n,t.item,this.isShiftKeyPressed)}stopForceRenderingAbove(){ik.get(this.editor)?.stopForceRenderingAbove()}forceRenderingAbove(){ik.get(this.editor)?.forceRenderingAbove()}},uk=class e{static fromSuggestion(t,n,r,i,a){let{insertText:o}=i.completion,s=!1;if(i.completion.insertTextRules&4){let e=new Bm().parse(o);e.children.length<100&&gE.adjustWhitespace(n,r,!0,e),o=e.toString(),s=!0}let c=t.getOverwriteInfo(i,a);return new e(T.fromPositions(r.delta(0,-c.overwriteBefore),r.delta(0,Math.max(c.overwriteAfter,0))),o,i.completion.kind,s,i.container.incomplete??!1)}constructor(e,t,n,r,i){this.range=e,this.insertText=t,this.completionItemKind=n,this.isSnippetText=r,this.listIncomplete=i}equals(e){return this.range.equalsRange(e.range)&&this.insertText===e.insertText&&this.completionItemKind===e.completionItemKind&&this.isSnippetText===e.isSnippetText}toSelectedSuggestionInfo(){return new Tu(this.range,this.insertText,this.completionItemKind,this.isSnippetText)}getSingleTextEdit(){return new Su(this.range,this.insertText)}};function dk(e,t){return e===t?!0:!e||!t?!1:e.equals(t)}var fk=class extends x{constructor(e,t,n){super(),this._editorObs=e,this._handleSuggestAccepted=t,this._suggestControllerPreselector=n,this._suggestWidgetAdaptor=this._register(new lk(this._editorObs.editor,()=>(this._editorObs.forceUpdate(),this._suggestControllerPreselector()),e=>this._editorObs.forceUpdate(t=>{this._handleSuggestAccepted(e)}))),this.selectedItem=yt(this,e=>this._suggestWidgetAdaptor.onDidSelectedItemChange(()=>{this._editorObs.forceUpdate(t=>e(void 0))}),()=>this._suggestWidgetAdaptor.selectedItem)}stopForceRenderingAbove(){this._suggestWidgetAdaptor.stopForceRenderingAbove()}forceRenderingAbove(){this._suggestWidgetAdaptor.forceRenderingAbove()}},pk=class{constructor(e,t){this.lineNumber=e,this.columnRange=t}},mk=class{constructor(e,t){if(this.startColumn=e,this.endColumnExclusive=t,e>t)throw new se(`startColumn ${e} cannot be after endColumnExclusive ${t}`)}toRange(e){return new T(e,this.startColumn,e,this.endColumnExclusive)}equals(e){return this.startColumn===e.startColumn&&this.endColumnExclusive===e.endColumnExclusive}toZeroBasedOffsetRange(){return new ac(this.startColumn-1,this.endColumnExclusive-1)}},hk=class e{static fromLineTokens(t){let n=[];for(let e=0;e<t.getCount();e++)n.push(new gk(t.getTokenText(e),t.getMetadata(e)));return e.create(n)}static create(t){return new e(t)}constructor(e){this._tokenInfo=e}toLineTokens(e){return zc.createFromTextAndMetadata(this.map((e,t)=>({text:t.text,metadata:t.metadata})),e)}map(e){let t=[],n=0;for(let r of this._tokenInfo){let i=new ac(n,n+r.text.length);t.push(e(i,r)),n+=r.text.length}return t}slice(t){let n=[],r=0;for(let e of this._tokenInfo){let i=r,a=i+e.text.length;if(a>t.start){if(i>=t.endExclusive)break;let r=Math.max(0,t.start-i),o=Math.max(0,a-t.endExclusive);n.push(new gk(e.text.slice(r,e.text.length-o),e.metadata))}r+=e.text.length}return e.create(n)}append(t){let n=this._tokenInfo.concat(t._tokenInfo);return e.create(n)}},gk=class{constructor(e,t){this.text=e,this.metadata=t}},_k=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vk=function(e,t){return function(n,r){t(n,r,e)}},yk,bk=`ghost-text`,xk=class extends x{static{yk=this}static{this.hot=kt(yk)}constructor(e,t,n,r,i,a){super(),this._editor=e,this._model=t,this._options=n,this._shouldKeepCursorStable=r,this._isClickable=i,this._languageService=a,this._isDisposed=kl(this,!1),this._editorObs=Bs(this._editor),this._warningState=O(e=>{let t=this._model.ghostText.read(e);if(!t)return;let n=this._model.warning.read(e);if(n)return{lineNumber:t.lineNumber,position:new C(t.lineNumber,t.parts[0].column),icon:n.icon}}),this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._useSyntaxHighlighting=this._options.map(e=>e.syntaxHighlightingEnabled),this._extraClassNames=O(this,e=>{let t=[...this._options.read(e).extraClasses??[]];return this._useSyntaxHighlighting.read(e)&&t.push(`syntax-highlighted`),this._warningState.read(e)&&t.push(`warning`),t.map(e=>` ${e}`).join(``)}),this.uiState=O(this,e=>{if(this._isDisposed.read(e))return;let t=this._editorObs.model.read(e);if(t!==this._model.targetTextModel.read(e))return;let n=this._model.ghostText.read(e);if(!n)return;let r=n instanceof BE?n.columnRange:void 0,i=this._useSyntaxHighlighting.read(e),a=this._extraClassNames.read(e),{inlineTexts:o,additionalLines:s,hiddenRange:c,additionalLinesOriginalSuffix:l}=Ck(n,t,bk+a),u=t.getLineContent(n.lineNumber),d=new Xn(o.map(e=>yr.insert(e.column-1,e.text))),f=i?t.tokenization.tokenizeLinesAt(n.lineNumber,[d.apply(u),...s.map(e=>e.content)]):void 0,p=d.getNewRanges(),m=o.map((e,t)=>({...e,tokens:f?.[0]?.getTokensInRange(p[t])})),h=s.map((e,n)=>{let r=f?.[n+1]??zc.createEmpty(e.content,this._languageService.languageIdCodec);if(n===s.length-1&&l){let e=hk.fromLineTokens(t.tokenization.getLineTokens(l.lineNumber)).slice(l.columnRange.toZeroBasedOffsetRange());r=hk.fromLineTokens(r).append(e).toLineTokens(r.languageIdCodec)}return{content:r,decorations:e.decorations}}),g=this._editor.getSelection()?.getStartPosition().column,_=m.filter(e=>e.text!==``),ee=_.length!==0,v={cursorColumnDistance:(ee?_[0].column:1)-g,cursorLineDistance:ee?0:s.findIndex(e=>e.content!==``)+1,lineCountOriginal:ee?1:0,lineCountModified:s.length+(ee?1:0),characterCountOriginal:0,characterCountModified:Er(_.map(e=>e.text.length))+Er(h.map(e=>e.content.getTextLength())),disjointReplacements:_.length+(s.length>0?1:0),sameShapeReplacements:_.length>1&&h.length===0?_.every(e=>e.text===_[0].text):void 0};return this._model.handleInlineCompletionShown.read(e)?.(v),{replacedRange:r,inlineTexts:m,additionalLines:h,hiddenRange:c,lineNumber:n.lineNumber,additionalReservedLineCount:this._model.minReservedLineCount.read(e),targetTextModel:t,syntaxHighlightingEnabled:i}}),this.decorations=O(this,e=>{let t=this.uiState.read(e);if(!t)return[];let n=[],r=this._extraClassNames.read(e);t.replacedRange&&n.push({range:t.replacedRange.toRange(t.lineNumber),options:{inlineClassName:`inline-completion-text-to-replace`+r,description:`GhostTextReplacement`}}),t.hiddenRange&&n.push({range:t.hiddenRange.toRange(t.lineNumber),options:{inlineClassName:`ghost-text-hidden`,description:`ghost-text-hidden`}});for(let e of t.inlineTexts)n.push({range:T.fromPositions(new C(t.lineNumber,e.column)),options:{description:`ghost-text-decoration`,after:{content:e.text,tokens:e.tokens,inlineClassName:(e.preview?`ghost-text-decoration-preview`:`ghost-text-decoration`)+(this._isClickable?` clickable`:``)+r+e.lineDecorations.map(e=>` `+e.className).join(` `),cursorStops:Yn.Left,attachedData:new Sk(this)},showIfCollapsed:!0}});return n}),this._additionalLinesWidget=this._register(new wk(this._editor,O(e=>{let t=this.uiState.read(e);return t?{lineNumber:t.lineNumber,additionalLines:t.additionalLines,minReservedLineCount:t.additionalReservedLineCount,targetTextModel:t.targetTextModel}:void 0}),this._shouldKeepCursorStable,this._isClickable)),this._isInlineTextHovered=this._editorObs.isTargetHovered(e=>e.target.type===6&&e.target.detail.injectedText?.options.attachedData instanceof Sk&&e.target.detail.injectedText.options.attachedData.owner===this,this._store),this.isHovered=O(this,e=>this._isDisposed.read(e)?!1:this._isInlineTextHovered.read(e)||this._additionalLinesWidget.isHovered.read(e)),this.height=O(this,e=>this._editorObs.getOption(75).read(e)+(this._additionalLinesWidget.viewZoneHeight.read(e)??0)),this._register(Cl(()=>{this._isDisposed.set(!0,void 0)})),this._register(this._editorObs.setDecorations(this.decorations)),this._isClickable&&(this._register(this._additionalLinesWidget.onDidClick(e=>this._onDidClick.fire(e))),this._register(this._editor.onMouseUp(e=>{if(e.target.type!==6)return;let t=e.target.detail.injectedText?.options.attachedData;t instanceof Sk&&t.owner===this&&this._onDidClick.fire(e.event)}))),this._register(Ql((e,t)=>{}))}static getWarningWidgetContext(e){let t=e.ghostTextViewWarningWidgetData;if(t)return t;if(e.parentElement)return this.getWarningWidgetContext(e.parentElement)}ownsViewZone(e){return this._additionalLinesWidget.viewZoneId===e}};xk=yk=_k([vk(5,wt)],xk);var Sk=class{constructor(e){this.owner=e}};function Ck(e,t,n){let r=[],i=[];function a(e,t){if(i.length>0){let n=i[i.length-1];t&&n.decorations.push(new eu(n.content.length+1,n.content.length+1+e[0].line.length,t,0)),n.content+=e[0].line,e=e.slice(1)}for(let n of e)i.push({content:n.line,decorations:t?[new eu(1,n.line.length+1,t,0),...n.lineDecorations]:[...n.lineDecorations]})}let o=t.getLineContent(e.lineNumber),s,c=0;for(let t of e.parts){let e=t.lines;s===void 0?(r.push({column:t.column,text:e[0].line,preview:t.preview,lineDecorations:e[0].lineDecorations}),e=e.slice(1)):a([{line:o.substring(c,t.column-1),lineDecorations:[]}],void 0),e.length>0&&(a(e,n),s===void 0&&t.column<=o.length&&(s=t.column)),c=t.column-1}let l;s!==void 0&&(l=new pk(e.lineNumber,new mk(c+1,o.length+1)));let u=s===void 0?void 0:new mk(s,o.length+1);return{inlineTexts:r,additionalLines:i,hiddenRange:u,additionalLinesOriginalSuffix:l}}var wk=class extends x{get viewZoneId(){return this._viewZoneInfo?.viewZoneId}get viewZoneHeight(){return this._viewZoneHeight}constructor(e,t,n,r){super(),this._editor=e,this._lines=t,this._shouldKeepCursorStable=n,this._isClickable=r,this._viewZoneHeight=kl(`viewZoneHeight`,void 0),this.editorOptionsChanged=xn(`editorOptionChanged`,An.filter(this._editor.onDidChangeConfiguration,e=>e.hasChanged(40)||e.hasChanged(133)||e.hasChanged(113)||e.hasChanged(108)||e.hasChanged(60)||e.hasChanged(59)||e.hasChanged(75))),this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._viewZoneListener=this._register(new Bt),this.isHovered=Bs(this._editor).isTargetHovered(e=>Tk(e.target.element),this._store),this.hasBeenAccepted=!1,this._editor instanceof ws&&this._shouldKeepCursorStable&&this._register(this._editor.onBeforeExecuteEdit(e=>this.hasBeenAccepted=e.source===`inlineSuggestion.accept`)),this._register(g(e=>{let t=this._lines.read(e);this.editorOptionsChanged.read(e),t?(this.hasBeenAccepted=!1,this.updateLines(t.lineNumber,t.additionalLines,t.minReservedLineCount)):this.clear()}))}dispose(){super.dispose(),this.clear()}clear(){this._viewZoneListener.clear(),this._editor.changeViewZones(e=>{this.removeActiveViewZone(e)})}updateLines(e,t,n){let r=this._editor.getModel();if(!r)return;let{tabSize:i}=r.getOptions();this._editor.changeViewZones(r=>{let a=new L;this.removeActiveViewZone(r);let o=Math.max(t.length,n);if(o>0){let n=document.createElement(`div`);Ek(n,i,t,this._editor.getOptions(),this._isClickable),this._isClickable&&(a.add(z(n,`mousedown`,e=>{e.preventDefault()})),a.add(z(n,`click`,e=>{Tk(e.target)&&this._onDidClick.fire(new Gs(eo(e),e))}))),this.addViewZone(r,e,o,n)}this._viewZoneListener.value=a})}addViewZone(e,t,n,r){let i=e.addZone({afterLineNumber:t,heightInLines:n,domNode:r,afterColumnAffinity:1,onComputedHeight:e=>{this._viewZoneHeight.set(e,void 0)}});this.keepCursorStable(t,n),this._viewZoneInfo={viewZoneId:i,heightInLines:n,lineNumber:t}}removeActiveViewZone(e){this._viewZoneInfo&&(e.removeZone(this._viewZoneInfo.viewZoneId),this.hasBeenAccepted||this.keepCursorStable(this._viewZoneInfo.lineNumber,-this._viewZoneInfo.heightInLines),this._viewZoneInfo=void 0,this._viewZoneHeight.set(void 0,void 0))}keepCursorStable(e,t){if(!this._shouldKeepCursorStable)return;let n=this._editor.getSelection()?.getStartPosition()?.lineNumber;n!==void 0&&e<n&&this._editor.setScrollTop(this._editor.getScrollTop()+t*this._editor.getOption(75))}};function Tk(e){return oi(e)&&e.classList.contains(bk)}function Ek(e,t,n,r,i){let a=r.get(40),o=r.get(133),s=r.get(108),c=r.get(60),l=r.get(59),u=r.get(75),d=`suggest-preview-text`;i&&(d+=` clickable`);let f=new yl(1e4);f.appendString(`<div class="${d}">`);for(let e=0,r=n.length;e<r;e++){let r=n[e],i=r.content;f.appendString(`<div class="view-line`),f.appendString(`" style="top:`),f.appendString(String(e*u)),f.appendString(`px;width:1000000px;">`);let d=i.getLineContent(),p=pn(d),m=xe(d);zo(new h(l.isMonospace&&!a,l.canUseHalfwidthRightwardsArrow,d,!1,p,m,0,i,r.decorations,t,0,l.spaceWidth,l.middotWidth,l.wsmiddotWidth,o,`none`,s,c!==ia.OFF,null,null,0),f),f.appendString(`</div>`)}f.appendString(`</div>`),Ea(e,l);let p=f.build();e.innerHTML=Dk?Dk.createHTML(p):p}const Dk=fa(`editorGhostText`,{createHTML:e=>e});var Ok=class e{static{this.empty=new e([])}constructor(e){this.replacements=e,Ze(tc(e,(e,t)=>e.lineRange.endLineNumberExclusive<=t.lineRange.startLineNumber))}toString(){return this.replacements.map(e=>e.toString()).join(`,`)}getNewLineRanges(){let e=[],t=0;for(let n of this.replacements)e.push($r.ofLength(n.lineRange.startLineNumber+t,n.newLines.length)),t+=n.newLines.length-n.lineRange.length;return e}},kk=class e{static fromSingleTextEdit(t,n){let r=Uo(t.text),i=t.range.startLineNumber,a=n.getValueOfRange(T.fromPositions(new C(t.range.startLineNumber,1),t.range.getStartPosition()));r[0]=a+r[0];let o=t.range.endLineNumber+1,s=n.getTransformer().getLineLength(t.range.endLineNumber)+1,c=n.getValueOfRange(T.fromPositions(t.range.getEndPosition(),new C(t.range.endLineNumber,s)));r[r.length-1]=r[r.length-1]+c;let l=t.range.startColumn===n.getTransformer().getLineLength(t.range.startLineNumber)+1,u=t.range.endColumn===1;return l&&r[0].length===a.length&&(i++,r.shift()),r.length>0&&i<o&&u&&r[r.length-1].length===c.length&&(o--,r.pop()),new e(new $r(i,o),r)}constructor(e,t){this.lineRange=e,this.newLines=t}toString(){return`${this.lineRange}->${JSON.stringify(this.newLines)}`}toLineEdit(){return new Ok([this])}},Ak=class{get lineEdit(){return kk.fromSingleTextEdit(this.edit.toReplacement(this.originalText),this.originalText)}get originalLineRange(){return this.lineEdit.lineRange}get modifiedLineRange(){return this.lineEdit.toLineEdit().getNewLineRanges()[0]}get displayRange(){return this.originalText.lineRange.intersect(this.originalLineRange.join($r.ofLength(this.originalLineRange.startLineNumber,this.lineEdit.newLines.length)))}constructor(e,t,n,r,i){this.originalText=e,this.edit=t,this.cursorPosition=n,this.commands=r,this.inlineCompletion=i}},jk=class{constructor(e,t,n){this._model=e,this.inlineEdit=t,this.tabAction=n,this.action=this.inlineEdit.inlineCompletion.action,this.displayName=this.inlineEdit.inlineCompletion.source.provider.displayName??G(1209,`Inline Edit`),this.extensionCommands=this.inlineEdit.inlineCompletion.source.inlineSuggestions.commands??[],this.isInDiffEditor=this._model.isInDiffEditor,this.displayLocation=this.inlineEdit.inlineCompletion.displayLocation,this.showCollapsed=this._model.showCollapsed}accept(){this._model.accept()}jump(){this._model.jump()}abort(e){console.error(e),this.inlineEdit.inlineCompletion.reportInlineEditError(e),this._model.stop()}handleInlineEditShown(e,t){this._model.handleInlineSuggestionShown(this.inlineEdit.inlineCompletion,e,t)}},Mk=class{constructor(e){this._model=e,this.onDidAccept=this._model.onDidAccept,this.inAcceptFlow=this._model.inAcceptFlow}},Nk=class{constructor(e,t,n,r){this.lineRange=n;let i=Bs(e),a=O(this,e=>i.isFocused.read(e)&&r.showInlineEditMenu?SD.Accept:SD.Inactive);this.model=new jk(t,new Ak(new nd(``),new Ia([r.getSingleTextEdit()]),t.primaryPosition.get(),r.source.inlineSuggestions.commands??[],r),a)}},Pk=class e{static fromPoints(t,n){return new e(t.x,t.y,n.x,n.y)}static fromPointSize(t,n){return new e(t.x,t.y,t.x+n.x,t.y+n.y)}static fromLeftTopRightBottom(t,n,r,i){return new e(t,n,r,i)}static fromLeftTopWidthHeight(t,n,r,i){return new e(t,n,t+r,n+i)}static fromRanges(t,n){return new e(t.start,n.start,t.endExclusive,n.endExclusive)}static hull(t){let n=2**53-1,r=2**53-1,i=-(2**53-1),a=-(2**53-1);for(let e of t)n=Math.min(n,e.left),r=Math.min(r,e.top),i=Math.max(i,e.right),a=Math.max(a,e.bottom);return new e(n,r,i,a)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}constructor(e,t,n,r){if(this.left=e,this.top=t,this.right=n,this.bottom=r,e>n)throw new se(`Invalid arguments: Horizontally offset by `+(e-n));if(t>r)throw new se(`Invalid arguments: Vertically offset by `+(t-r))}withMargin(t,n,r,i){let a,o,s,c;return n===void 0&&r===void 0&&i===void 0?a=o=s=c=t:r===void 0&&i===void 0?(a=o=n,s=c=t):(a=i,o=n,s=t,c=r),new e(this.left-a,this.top-s,this.right+o,this.bottom+c)}intersectVertical(t){let n=Math.max(this.top,t.start),r=Math.min(this.bottom,t.endExclusive);return new e(this.left,n,this.right,Math.max(n,r))}intersectHorizontal(t){let n=Math.max(this.left,t.start),r=Math.min(this.right,t.endExclusive);return new e(n,this.top,Math.max(n,r),this.bottom)}toString(){return`Rect{(${this.left},${this.top}), (${this.right},${this.bottom})}`}intersect(t){let n=Math.max(this.left,t.left),r=Math.min(this.right,t.right),i=Math.max(this.top,t.top),a=Math.min(this.bottom,t.bottom);if(!(n>r||i>a))return new e(n,i,r,a)}containsRect(e){return this.left<=e.left&&this.top<=e.top&&this.right>=e.right&&this.bottom>=e.bottom}containsPoint(e){return this.left<=e.x&&this.top<=e.y&&this.right>=e.x&&this.bottom>=e.y}moveToBeContainedIn(t){let n=this.width,r=this.height,i=this.left,a=this.top;return i<t.left?i=t.left:i+n>t.right&&(i=t.right-n),a<t.top?a=t.top:a+r>t.bottom&&(a=t.bottom-r),new e(i,a,i+n,a+r)}withWidth(t){return new e(this.left,this.top,this.left+t,this.bottom)}withHeight(t){return new e(this.left,this.top,this.right,this.top+t)}withTop(t){return new e(this.left,t,this.right,this.bottom)}withLeft(t){return new e(t,this.top,this.right,this.bottom)}translateX(t){return new e(this.left+t,this.top,this.right+t,this.bottom)}translateY(t){return new e(this.left,this.top+t,this.right,this.bottom+t)}getLeftBottom(){return new jn(this.left,this.bottom)}getRightBottom(){return new jn(this.right,this.bottom)}getRightTop(){return new jn(this.right,this.top)}toStyles(){return{position:`absolute`,left:`${this.left}px`,top:`${this.top}px`,width:`${this.width}px`,height:`${this.height}px`}}},Fk=class e{constructor(e,t,n,r=null){this.startLineNumbers=e,this.endLineNumbers=t,this.lastLineRelativePosition=n,this.showEndForLine=r}equals(e){return!!e&&this.lastLineRelativePosition===e.lastLineRelativePosition&&this.showEndForLine===e.showEndForLine&&bt(this.startLineNumbers,e.startLineNumbers)&&bt(this.endLineNumbers,e.endLineNumbers)}static get Empty(){return new e([],[],0)}},Ik=fa(`stickyScrollViewLayer`,{createHTML:e=>e}),Lk=`data-sticky-line-index`,Rk=`data-sticky-is-line`,zk=`data-sticky-is-line-number`,Bk=`data-sticky-is-folding-icon`,Vk=class extends x{get height(){return this._height}constructor(e){super(),this._foldingIconStore=new L,this._rootDomNode=document.createElement(`div`),this._lineNumbersDomNode=document.createElement(`div`),this._linesDomNodeScrollable=document.createElement(`div`),this._linesDomNode=document.createElement(`div`),this._renderedStickyLines=[],this._lineNumbers=[],this._lastLineRelativePosition=0,this._minContentWidthInPx=0,this._isOnGlyphMargin=!1,this._height=-1,this._onDidChangeStickyScrollHeight=this._register(new D),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._editor=e,this._lineHeight=e.getOption(75),this._lineNumbersDomNode.className=`sticky-widget-line-numbers`,this._lineNumbersDomNode.setAttribute(`role`,`none`),this._linesDomNode.className=`sticky-widget-lines`,this._linesDomNode.setAttribute(`role`,`list`),this._linesDomNodeScrollable.className=`sticky-widget-lines-scrollable`,this._linesDomNodeScrollable.appendChild(this._linesDomNode),this._rootDomNode.className=`sticky-widget`,this._rootDomNode.classList.toggle(`peek`,e instanceof sy),this._rootDomNode.appendChild(this._lineNumbersDomNode),this._rootDomNode.appendChild(this._linesDomNodeScrollable),this._setHeight(0);let t=()=>{this._linesDomNode.style.left=this._editor.getOption(131).scrollWithEditor?`-${this._editor.getScrollLeft()}px`:`0px`};this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(131)&&t(),e.hasChanged(75)&&(this._lineHeight=this._editor.getOption(75))})),this._register(this._editor.onDidScrollChange(e=>{e.scrollLeftChanged&&t(),e.scrollWidthChanged&&this._updateWidgetWidth()})),this._register(this._editor.onDidChangeModel(()=>{t(),this._updateWidgetWidth()})),this._register(this._foldingIconStore),t(),this._register(this._editor.onDidLayoutChange(e=>{this._updateWidgetWidth()})),this._updateWidgetWidth()}get lineNumbers(){return this._lineNumbers}get lineNumberCount(){return this._lineNumbers.length}getRenderedStickyLine(e){return this._renderedStickyLines.find(t=>t.lineNumber===e)}getCurrentLines(){return this._lineNumbers}setState(e,t,n){let r=!this._state&&!e,i=this._state&&this._state.equals(e);if(n===void 0&&(r||i))return;let a=this._findRenderingData(e),o=this._lineNumbers;this._lineNumbers=a.lineNumbers,this._lastLineRelativePosition=a.lastLineRelativePosition;let s=this._findIndexToRebuildFrom(o,this._lineNumbers,n);this._renderRootNode(this._lineNumbers,this._lastLineRelativePosition,t,s),this._state=e}_findRenderingData(e){if(!e)return{lineNumbers:[],lastLineRelativePosition:0};let t=[...e.startLineNumbers];e.showEndForLine!==null&&(t[e.showEndForLine]=e.endLineNumbers[e.showEndForLine]);let n=0;for(let e=0;e<t.length;e++)n+=this._editor.getLineHeightForPosition(new C(t[e],1));return n===0?{lineNumbers:[],lastLineRelativePosition:0}:{lineNumbers:t,lastLineRelativePosition:e.lastLineRelativePosition}}_findIndexToRebuildFrom(e,t,n){if(t.length===0)return 0;if(n!==void 0)return n;let r=t.findIndex(t=>!e.includes(t));return r===-1?0:r}_updateWidgetWidth(){let e=this._editor.getLayoutInfo(),t=e.contentLeft;this._lineNumbersDomNode.style.width=`${t}px`,this._linesDomNodeScrollable.style.setProperty(`--vscode-editorStickyScroll-scrollableWidth`,`${this._editor.getScrollWidth()-e.verticalScrollbarWidth}px`),this._rootDomNode.style.width=`${e.width-e.verticalScrollbarWidth}px`}_useFoldingOpacityTransition(e){this._lineNumbersDomNode.style.setProperty(`--vscode-editorStickyScroll-foldingOpacityTransition`,`opacity ${e?.5:0}s`)}_setFoldingIconsVisibility(e){for(let t of this._renderedStickyLines){let n=t.foldingIcon;n&&n.setVisible(e?!0:n.isCollapsed)}}async _renderRootNode(e,t,n,r){let i=this._editor._getViewModel();if(!i){this._clearWidget();return}if(e.length===0){this._clearWidget();return}let a=[],o=e[e.length-1],s=0;for(let e=0;e<this._renderedStickyLines.length;e++)if(e<r){let t=this._renderedStickyLines[e];a.push(this._updatePosition(t,s,t.lineNumber===o)),s+=t.height}else{let t=this._renderedStickyLines[e];t.lineNumberDomNode.remove(),t.lineDomNode.remove()}let c=this._editor.getLayoutInfo();for(let t=r;t<e.length;t++){let r=this._renderChildNode(i,t,e[t],s,o===e[t],n,c);s+=r.height,this._linesDomNode.appendChild(r.lineDomNode),this._lineNumbersDomNode.appendChild(r.lineNumberDomNode),a.push(r)}n&&(this._setFoldingHoverListeners(),this._useFoldingOpacityTransition(!this._isOnGlyphMargin)),this._minContentWidthInPx=Math.max(...this._renderedStickyLines.map(e=>e.scrollWidth))+c.verticalScrollbarWidth,this._renderedStickyLines=a,this._setHeight(s+t),this._editor.layoutOverlayWidget(this)}_clearWidget(){for(let e=0;e<this._renderedStickyLines.length;e++){let t=this._renderedStickyLines[e];t.lineNumberDomNode.remove(),t.lineDomNode.remove()}this._setHeight(0)}_setHeight(e){this._height!==e&&(this._height=e,this._height===0?this._rootDomNode.style.display=`none`:(this._rootDomNode.style.display=`block`,this._lineNumbersDomNode.style.height=`${this._height}px`,this._linesDomNodeScrollable.style.height=`${this._height}px`,this._rootDomNode.style.height=`${this._height}px`),this._onDidChangeStickyScrollHeight.fire({height:this._height}))}_setFoldingHoverListeners(){this._editor.getOption(126)===`mouseover`&&(this._foldingIconStore.add(z(this._lineNumbersDomNode,Pc.MOUSE_ENTER,()=>{this._isOnGlyphMargin=!0,this._setFoldingIconsVisibility(!0)})),this._foldingIconStore.add(z(this._lineNumbersDomNode,Pc.MOUSE_LEAVE,()=>{this._isOnGlyphMargin=!1,this._useFoldingOpacityTransition(!0),this._setFoldingIconsVisibility(!1)})))}_renderChildNode(e,t,n,r,i,a,o){let s=e.coordinatesConverter.convertModelPositionToViewPosition(new C(n,1)).lineNumber,c=e.getViewLineRenderingData(s),l=this._editor.getOption(76),u=this._editor.getOption(117).verticalScrollbarSize,d;try{d=eu.filter(c.inlineDecorations,s,c.minColumn,c.maxColumn)}catch{d=[]}let f=this._editor.getLineHeightForPosition(new C(n,1)),p=e.getTextDirection(n),m=new h(!0,!0,c.content,c.continuesWithWrappedLine,c.isBasicASCII,c.containsRTL,0,c.tokens,d,c.tabSize,c.startVisibleColumn,1,1,1,500,`none`,!0,!0,null,p,u),g=new yl(2e3),_=zo(m,g),ee;ee=Ik?Ik.createHTML(g.build()):g.build();let v=document.createElement(`span`);v.setAttribute(Lk,String(t)),v.setAttribute(Rk,``),v.setAttribute(`role`,`listitem`),v.tabIndex=0,v.className=`sticky-line-content`,v.classList.add(`stickyLine${n}`),v.style.lineHeight=`${f}px`,v.innerHTML=ee;let te=document.createElement(`span`);te.setAttribute(Lk,String(t)),te.setAttribute(zk,``),te.className=`sticky-line-number`,te.style.lineHeight=`${f}px`;let y=o.contentLeft;te.style.width=`${y}px`;let b=document.createElement(`span`);l.renderType===1||l.renderType===3&&n%10==0?b.innerText=n.toString():l.renderType===2&&(b.innerText=Math.abs(n-this._editor.getPosition().lineNumber).toString()),b.className=`sticky-line-number-inner`,b.style.width=`${o.lineNumbersWidth}px`,b.style.paddingLeft=`${o.lineNumbersLeft}px`,te.appendChild(b);let ne=this._renderFoldingIconForLine(a,n);ne&&(te.appendChild(ne.domNode),ne.domNode.style.left=`${o.lineNumbersWidth+o.lineNumbersLeft}px`,ne.domNode.style.lineHeight=`${f}px`),this._editor.applyFontInfo(v),this._editor.applyFontInfo(te),te.style.lineHeight=`${f}px`,v.style.lineHeight=`${f}px`,te.style.height=`${f}px`,v.style.height=`${f}px`;let re=new Hk(t,n,v,te,ne,_.characterMapping,v.scrollWidth,f);return this._updatePosition(re,r,i)}_updatePosition(e,t,n){let r=e.lineDomNode,i=e.lineNumberDomNode;if(n){r.style.zIndex=`0`,i.style.zIndex=`0`;let n=`${t+this._lastLineRelativePosition+(e.foldingIcon?.isCollapsed?1:0)}px`;r.style.top=n,i.style.top=n}else r.style.zIndex=`1`,i.style.zIndex=`1`,r.style.top=`${t}px`,i.style.top=`${t}px`;return e}_renderFoldingIconForLine(e,t){let n=this._editor.getOption(126);if(!e||n===`never`)return;let r=e.regions,i=r.findRange(t),a=r.getStartLineNumber(i);if(t!==a)return;let o=r.isCollapsed(i),s=new Uk(o,a,r.getEndLineNumber(i),this._lineHeight);return s.setVisible(this._isOnGlyphMargin?!0:o||n===`always`),s.domNode.setAttribute(Bk,``),s}getId(){return`editor.contrib.stickyScrollWidget`}getDomNode(){return this._rootDomNode}getPosition(){return{preference:2,stackOridinal:10}}getMinContentWidthInPx(){return this._minContentWidthInPx}focusLineWithIndex(e){0<=e&&e<this._renderedStickyLines.length&&this._renderedStickyLines[e].lineDomNode.focus()}getEditorPositionFromNode(e){if(!e||e.children.length>0)return null;let t=this._getRenderedStickyLineFromChildDomNode(e);if(!t)return null;let n=rr(t.characterMapping,e,0);return new C(t.lineNumber,n)}getLineNumberFromChildDomNode(e){return this._getRenderedStickyLineFromChildDomNode(e)?.lineNumber??null}_getRenderedStickyLineFromChildDomNode(e){let t=this.getLineIndexFromChildDomNode(e);return t===null||t<0||t>=this._renderedStickyLines.length?null:this._renderedStickyLines[t]}getLineIndexFromChildDomNode(e){let t=this._getAttributeValue(e,Lk);return t?parseInt(t,10):null}isInStickyLine(e){return this._getAttributeValue(e,Rk)!==void 0}isInFoldingIconDomNode(e){return this._getAttributeValue(e,Bk)!==void 0}_getAttributeValue(e,t){for(;e&&e!==this._rootDomNode;){let n=e.getAttribute(t);if(n!==null)return n;e=e.parentElement}}},Hk=class{constructor(e,t,n,r,i,a,o,s){this.index=e,this.lineNumber=t,this.lineDomNode=n,this.lineNumberDomNode=r,this.foldingIcon=i,this.characterMapping=a,this.scrollWidth=o,this.height=s}},Uk=class{constructor(e,t,n,r){this.isCollapsed=e,this.foldingStartLine=t,this.foldingEndLine=n,this.dimension=r,this.domNode=document.createElement(`div`),this.domNode.style.width=`26px`,this.domNode.style.height=`${r}px`,this.domNode.style.lineHeight=`${r}px`,this.domNode.className=I.asClassName(e?vw:_w)}setVisible(e){this.domNode.style.cursor=e?`pointer`:`default`,this.domNode.style.opacity=e?`1`:`0`}},Wk=class{constructor(e,t){this.startLineNumber=e,this.endLineNumber=t}},Gk=class{constructor(e,t,n){this.range=e,this.children=t,this.parent=n}},Kk=class{constructor(e,t,n,r){this.uri=e,this.version=t,this.element=n,this.outlineProviderId=r}},qk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Jk=function(e,t){return function(n,r){t(n,r,e)}},Yk;(function(e){e.OUTLINE_MODEL=`outlineModel`,e.FOLDING_PROVIDER_MODEL=`foldingProviderModel`,e.INDENTATION_MODEL=`indentationModel`})(Yk||={});var Xk;(function(e){e[e.VALID=0]=`VALID`,e[e.INVALID=1]=`INVALID`,e[e.CANCELED=2]=`CANCELED`})(Xk||={});var Zk=class extends x{constructor(e,t,n,r){switch(super(),this._editor=e,this._modelProviders=[],this._modelPromise=null,this._updateScheduler=this._register(new Hu(300)),this._updateOperation=this._register(new L),this._editor.getOption(131).defaultModel){case Yk.OUTLINE_MODEL:this._modelProviders.push(new $k(this._editor,r));case Yk.FOLDING_PROVIDER_MODEL:this._modelProviders.push(new nA(this._editor,t,r));case Yk.INDENTATION_MODEL:this._modelProviders.push(new tA(this._editor,n));break}}dispose(){this._modelProviders.forEach(e=>e.dispose()),this._updateOperation.clear(),this._cancelModelPromise(),super.dispose()}_cancelModelPromise(){this._modelPromise&&=(this._modelPromise.cancel(),null)}async update(e){return this._updateOperation.clear(),this._updateOperation.add({dispose:()=>{this._cancelModelPromise(),this._updateScheduler.cancel()}}),this._cancelModelPromise(),await this._updateScheduler.trigger(async()=>{for(let t of this._modelProviders){let{statusPromise:n,modelPromise:r}=t.computeStickyModel(e);this._modelPromise=r;let i=await n;if(this._modelPromise!==r)return null;switch(i){case Xk.CANCELED:return this._updateOperation.clear(),null;case Xk.VALID:return t.stickyModel}}return null}).catch(e=>(mr(e),null))}};Zk=qk([Jk(2,k),Jk(3,H)],Zk);var Qk=class extends x{constructor(e){super(),this._editor=e,this._stickyModel=null}get stickyModel(){return this._stickyModel}_invalid(){return this._stickyModel=null,Xk.INVALID}computeStickyModel(e){if(e.isCancellationRequested||!this.isProviderValid())return{statusPromise:this._invalid(),modelPromise:null};let t=li(e=>this.createModelFromProvider(e));return{statusPromise:t.then(t=>this.isModelValid(t)?e.isCancellationRequested?Xk.CANCELED:(this._stickyModel=this.createStickyModel(e,t),Xk.VALID):this._invalid()).then(void 0,e=>(mr(e),Xk.CANCELED)),modelPromise:t}}isModelValid(e){return!0}isProviderValid(){return!0}},$k=class extends Qk{constructor(e,t){super(e),this._languageFeaturesService=t}createModelFromProvider(e){return bT.create(this._languageFeaturesService.documentSymbolProvider,this._editor.getModel(),e)}createStickyModel(e,t){let{stickyOutlineElement:n,providerID:r}=this._stickyModelFromOutlineModel(t,this._stickyModel?.outlineProviderId),i=this._editor.getModel();return new Kk(i.uri,i.getVersionId(),n,r)}isModelValid(e){return e&&e.children.size>0}_stickyModelFromOutlineModel(e,t){let n;if(Dl.first(e.children.values())instanceof yT){let r=Dl.find(e.children.values(),e=>e.id===t);if(r)n=r.children;else{let r=``,i=-1,a;for(let[t,n]of e.children.entries()){let e=this._findSumOfRangesOfGroup(n);e>i&&(a=n,i=e,r=n.id)}t=r,n=a.children}}else n=e.children;let r=[],i=Array.from(n.values()).sort((e,t)=>{let n=new Wk(e.symbol.range.startLineNumber,e.symbol.range.endLineNumber),r=new Wk(t.symbol.range.startLineNumber,t.symbol.range.endLineNumber);return this._comparator(n,r)});for(let e of i)r.push(this._stickyModelFromOutlineElement(e,e.symbol.selectionRange.startLineNumber));return{stickyOutlineElement:new Gk(void 0,r,void 0),providerID:t}}_stickyModelFromOutlineElement(e,t){let n=[];for(let r of e.children.values())if(r.symbol.selectionRange.startLineNumber!==r.symbol.range.endLineNumber)if(r.symbol.selectionRange.startLineNumber!==t)n.push(this._stickyModelFromOutlineElement(r,r.symbol.selectionRange.startLineNumber));else for(let e of r.children.values())n.push(this._stickyModelFromOutlineElement(e,r.symbol.selectionRange.startLineNumber));n.sort((e,t)=>this._comparator(e.range,t.range));let r=new Wk(e.symbol.selectionRange.startLineNumber,e.symbol.range.endLineNumber);return new Gk(r,n,void 0)}_comparator(e,t){return e.startLineNumber===t.startLineNumber?t.endLineNumber-e.endLineNumber:e.startLineNumber-t.startLineNumber}_findSumOfRangesOfGroup(e){let t=0;for(let n of e.children.values())t+=this._findSumOfRangesOfGroup(n);return e instanceof vT?t+e.symbol.range.endLineNumber-e.symbol.selectionRange.startLineNumber:t}};$k=qk([Jk(1,H)],$k);var eA=class extends Qk{constructor(e){super(e),this._foldingLimitReporter=this._register(new Iw(e))}createStickyModel(e,t){let n=this._fromFoldingRegions(t),r=this._editor.getModel();return new Kk(r.uri,r.getVersionId(),n,void 0)}isModelValid(e){return e!==null}_fromFoldingRegions(e){let t=e.length,n=[],r=new Gk(void 0,[],void 0);for(let i=0;i<t;i++){let t=e.getParentIndex(i),a;a=t===-1?r:n[t];let o=new Gk(new Wk(e.getStartLineNumber(i),e.getEndLineNumber(i)+1),[],a);a.children.push(o),n.push(o)}return r}},tA=class extends eA{constructor(e,t){super(e),this._languageConfigurationService=t,this.provider=this._register(new fw(e.getModel(),this._languageConfigurationService,this._foldingLimitReporter))}async createModelFromProvider(e){return this.provider.compute(e)}};tA=qk([Jk(1,Ce)],tA);var nA=class extends eA{constructor(e,t,n){super(e),this._languageFeaturesService=n,this.provider=this._register(new Bt),this._register(this._languageFeaturesService.foldingRangeProvider.onDidChange(()=>{this._updateProvider(e,t)})),this._updateProvider(e,t)}_updateProvider(e,t){let n=Fw.getFoldingRangeProviders(this._languageFeaturesService,e.getModel());n.length!==0&&(this.provider.value=new Dw(e.getModel(),n,t,this._foldingLimitReporter,void 0))}isProviderValid(){return this.provider!==void 0}async createModelFromProvider(e){return this.provider.value?.compute(e)??null}};nA=qk([Jk(2,H)],nA);var rA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},iA=function(e,t){return function(n,r){t(n,r,e)}},aA=class{constructor(e,t,n,r){this.startLineNumber=e,this.endLineNumber=t,this.top=n,this.height=r}},oA=class extends x{constructor(e,t,n){super(),this._languageFeaturesService=t,this._languageConfigurationService=n,this._onDidChangeStickyScroll=this._register(new D),this.onDidChangeStickyScroll=this._onDidChangeStickyScroll.event,this._model=null,this._cts=null,this._stickyModelProvider=null,this._editor=e,this._sessionStore=this._register(new L),this._updateSoon=this._register(new Zr(()=>this.update(),50)),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(131)&&this.readConfiguration()})),this.readConfiguration()}readConfiguration(){this._sessionStore.clear(),this._editor.getOption(131).enabled&&(this._sessionStore.add(this._editor.onDidChangeModel(()=>{this._model=null,this.updateStickyModelProvider(),this._onDidChangeStickyScroll.fire(),this.update()})),this._sessionStore.add(this._editor.onDidChangeHiddenAreas(()=>this.update())),this._sessionStore.add(this._editor.onDidChangeModelContent(()=>this._updateSoon.schedule())),this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>this.update())),this._sessionStore.add(Cl(()=>{this._stickyModelProvider?.dispose(),this._stickyModelProvider=null})),this.updateStickyModelProvider(),this.update())}getVersionId(){return this._model?.version}updateStickyModelProvider(){this._stickyModelProvider?.dispose(),this._stickyModelProvider=null,this._editor.hasModel()&&(this._stickyModelProvider=new Zk(this._editor,()=>this._updateSoon.schedule(),this._languageConfigurationService,this._languageFeaturesService))}async update(){this._cts?.dispose(!0),this._cts=new Sr,await this.updateStickyModel(this._cts.token),this._onDidChangeStickyScroll.fire()}async updateStickyModel(e){if(!this._editor.hasModel()||!this._stickyModelProvider||this._editor.getModel().isTooLargeForTokenization()){this._model=null;return}let t=await this._stickyModelProvider.update(e);e.isCancellationRequested||(this._model=t)}getCandidateStickyLinesIntersecting(e){if(!this._model?.element)return[];let t=[];return this.getCandidateStickyLinesIntersectingFromStickyModel(e,this._model.element,t,0,0,-1),this.filterHiddenRanges(t)}getCandidateStickyLinesIntersectingFromStickyModel(e,t,n,r,i,a){let o=this._editor.getModel();if(!o||t.children.length===0)return;let s=a,c=[];for(let e=0;e<t.children.length;e++){let n=t.children[e];n.range&&c.push(n.range.startLineNumber)}let l=this.updateIndex(Rr(c,e.startLineNumber,(e,t)=>e-t)),u=this.updateIndex(Rr(c,e.endLineNumber,(e,t)=>e-t));for(let a=l;a<=u;a++){let c=t.children[a];if(!c||!c.range)continue;let{startLineNumber:l,endLineNumber:u}=c.range;if(u>l+1&&e.startLineNumber<=u+1&&l-1<=e.endLineNumber&&l!==s&&o.isValidRange(new T(l,1,u,1))){s=l;let t=this._editor.getLineHeightForPosition(new C(l,1));n.push(new aA(l,u-1,i,t)),this.getCandidateStickyLinesIntersectingFromStickyModel(e,c,n,r+1,i+t,l)}}}filterHiddenRanges(e){let t=this._editor._getViewModel()?.getHiddenAreas();return t?e.filter(e=>!t.some(t=>e.startLineNumber>=t.startLineNumber&&e.endLineNumber<=t.endLineNumber+1)):e}updateIndex(e){return e===-1?0:e<0?-e-2:e}};oA=rA([iA(1,H),iA(2,Ce)],oA);var sA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},cA=function(e,t){return function(n,r){t(n,r,e)}},lA,uA=class extends x{static{lA=this}static{this.ID=`store.contrib.stickyScrollController`}constructor(e,t,n,r,i,a,o){super(),this._editor=e,this._contextMenuService=t,this._languageFeaturesService=n,this._instaService=r,this._contextKeyService=o,this._sessionStore=new L,this._maxStickyLines=2**53-1,this._candidateDefinitionsLength=-1,this._focusedStickyElementIndex=-1,this._enabled=!1,this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1,this._endLineNumbers=[],this._mouseTarget=null,this._onDidChangeStickyScrollHeight=this._register(new D),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._stickyScrollWidget=new Vk(this._editor),this._stickyLineCandidateProvider=new oA(this._editor,n,i),this._register(this._stickyScrollWidget),this._register(this._stickyLineCandidateProvider),this._widgetState=Fk.Empty;let s=this._stickyScrollWidget.getDomNode();this._register(this._editor.onDidChangeLineHeight(e=>{e.changes.forEach(e=>{let t=e.lineNumber;this._widgetState.startLineNumbers.includes(t)&&this._renderStickyScroll(t)})})),this._register(this._editor.onDidChangeFont(e=>{e.changes.forEach(e=>{let t=e.lineNumber;this._widgetState.startLineNumbers.includes(t)&&this._renderStickyScroll(t)})})),this._register(this._editor.onDidChangeConfiguration(e=>{this._readConfigurationChange(e)})),this._register(z(s,Pc.CONTEXT_MENU,async e=>{this._onContextMenu(eo(s),e)})),this._stickyScrollFocusedContextKey=y.stickyScrollFocused.bindTo(this._contextKeyService),this._stickyScrollVisibleContextKey=y.stickyScrollVisible.bindTo(this._contextKeyService);let c=this._register(Wn(s));this._register(c.onDidBlur(e=>{this._positionRevealed===!1&&s.clientHeight===0?(this._focusedStickyElementIndex=-1,this.focus()):this._disposeFocusStickyScrollStore()})),this._register(c.onDidFocus(e=>{this.focus()})),this._registerMouseListeners(),this._register(z(s,Pc.MOUSE_DOWN,e=>{this._onMouseDown=!0})),this._register(this._stickyScrollWidget.onDidChangeStickyScrollHeight(e=>{this._onDidChangeStickyScrollHeight.fire(e)})),this._onDidResize(),this._readConfiguration()}get stickyScrollWidgetHeight(){return this._stickyScrollWidget.height}static get(e){return e.getContribution(lA.ID)}_disposeFocusStickyScrollStore(){this._stickyScrollFocusedContextKey.set(!1),this._focusDisposableStore?.dispose(),this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1}isFocused(){return this._focused}focus(){if(this._onMouseDown){this._onMouseDown=!1,this._editor.focus();return}this._stickyScrollFocusedContextKey.get()!==!0&&(this._focused=!0,this._focusDisposableStore=new L,this._stickyScrollFocusedContextKey.set(!0),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumbers.length-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}focusNext(){this._focusedStickyElementIndex<this._stickyScrollWidget.lineNumberCount-1&&this._focusNav(!0)}focusPrevious(){this._focusedStickyElementIndex>0&&this._focusNav(!1)}selectEditor(){this._editor.focus()}_focusNav(e){this._focusedStickyElementIndex=e?this._focusedStickyElementIndex+1:this._focusedStickyElementIndex-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}goToFocused(){let e=this._stickyScrollWidget.lineNumbers;this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:e[this._focusedStickyElementIndex],column:1})}_revealPosition(e){this._reveaInEditor(e,()=>this._editor.revealPosition(e))}_revealLineInCenterIfOutsideViewport(e){this._reveaInEditor(e,()=>this._editor.revealLineInCenterIfOutsideViewport(e.lineNumber,0))}_reveaInEditor(e,t){this._focused&&this._disposeFocusStickyScrollStore(),this._positionRevealed=!0,t(),this._editor.setSelection(T.fromPositions(e)),this._editor.focus()}_registerMouseListeners(){let e=this._register(new L),t=this._register(new ey(this._editor,{extractLineNumberFromMouseEvent:e=>{let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);return t?t.lineNumber:0}})),n=e=>{if(!this._editor.hasModel()||e.target.type!==12||e.target.detail!==this._stickyScrollWidget.getId())return null;let t=e.target.element;if(!t||t.innerText!==t.innerHTML)return null;let n=this._stickyScrollWidget.getEditorPositionFromNode(t);return n?{range:new T(n.lineNumber,n.column,n.lineNumber,n.column+t.innerText.length),textElement:t}:null},r=this._stickyScrollWidget.getDomNode();this._register(Ll(r,Pc.CLICK,e=>{if(e.ctrlKey||e.altKey||e.metaKey||!e.leftButton)return;if(e.shiftKey){let t=this._stickyScrollWidget.getLineIndexFromChildDomNode(e.target);if(t===null)return;let n=new C(this._endLineNumbers[t],1);this._revealLineInCenterIfOutsideViewport(n);return}if(this._stickyScrollWidget.isInFoldingIconDomNode(e.target)){let t=this._stickyScrollWidget.getLineNumberFromChildDomNode(e.target);this._toggleFoldingRegionForLine(t);return}if(!this._stickyScrollWidget.isInStickyLine(e.target))return;let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target);if(!t){let n=this._stickyScrollWidget.getLineNumberFromChildDomNode(e.target);if(n===null)return;t=new C(n,1)}this._revealPosition(t)})),this._register(z(zs,Pc.MOUSE_MOVE,e=>{this._mouseTarget=e.target,this._onMouseMoveOrKeyDown(e)})),this._register(z(zs,Pc.KEY_DOWN,e=>{this._onMouseMoveOrKeyDown(e)})),this._register(z(zs,Pc.KEY_UP,()=>{this._showEndForLine!==void 0&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._register(t.onMouseMoveOrRelevantKeyDown(([t,r])=>{let i=n(t);if(!i||!t.hasTriggerModifier||!this._editor.hasModel()){e.clear();return}let{range:a,textElement:o}=i;if(!a.equalsRange(this._stickyRangeProjectedOnEditor))this._stickyRangeProjectedOnEditor=a,e.clear();else if(o.style.textDecoration===`underline`)return;let s=new Sr;e.add(Cl(()=>s.dispose(!0)));let c;fb(this._languageFeaturesService.definitionProvider,this._editor.getModel(),new C(a.startLineNumber,a.startColumn+1),!1,s.token).then((t=>{if(!s.token.isCancellationRequested)if(t.length!==0){this._candidateDefinitionsLength=t.length;let n=o;c===n?c||(c=n,c.style.textDecoration=`underline`,e.add(Cl(()=>{c.style.textDecoration=`none`}))):(e.clear(),c=n,c.style.textDecoration=`underline`,e.add(Cl(()=>{c.style.textDecoration=`none`})))}else e.clear()}))})),this._register(t.onCancel(()=>{e.clear()})),this._register(t.onExecute(async e=>{if(e.target.type!==12||e.target.detail!==this._stickyScrollWidget.getId())return;let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);t&&(!this._editor.hasModel()||!this._stickyRangeProjectedOnEditor||(this._candidateDefinitionsLength>1&&(this._focused&&this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:t.lineNumber,column:1})),this._instaService.invokeFunction(Db,e,this._editor,{uri:this._editor.getModel().uri,range:this._stickyRangeProjectedOnEditor})))}))}_onContextMenu(e,t){let n=new Gs(e,t);this._contextMenuService.showContextMenu({menuId:S.StickyScrollContext,getAnchor:()=>n})}_onMouseMoveOrKeyDown(e){if(!e.shiftKey||!this._mouseTarget||!oi(this._mouseTarget))return;let t=this._stickyScrollWidget.getLineIndexFromChildDomNode(this._mouseTarget);t===null||this._showEndForLine===t||(this._showEndForLine=t,this._renderStickyScroll())}_toggleFoldingRegionForLine(e){if(!this._foldingModel||e===null)return;let t=this._stickyScrollWidget.getRenderedStickyLine(e),n=t?.foldingIcon;if(!n)return;XC(this._foldingModel,1,[e]),n.isCollapsed=!n.isCollapsed;let r=(n.isCollapsed?this._editor.getTopForLineNumber(n.foldingEndLine):this._editor.getTopForLineNumber(n.foldingStartLine))-this._editor.getOption(75)*t.index+1;this._editor.setScrollTop(r),this._renderStickyScroll(e)}_readConfiguration(){let e=this._editor.getOption(131);if(e.enabled===!1){this._editor.removeOverlayWidget(this._stickyScrollWidget),this._resetState(),this._sessionStore.clear(),this._enabled=!1;return}else e.enabled&&!this._enabled&&(this._editor.addOverlayWidget(this._stickyScrollWidget),this._sessionStore.add(this._editor.onDidScrollChange(e=>{e.scrollTopChanged&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._sessionStore.add(this._editor.onDidLayoutChange(()=>this._onDidResize())),this._sessionStore.add(this._editor.onDidChangeModelTokens(e=>this._onTokensChange(e))),this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(()=>{this._showEndForLine=void 0,this._renderStickyScroll()})),this._enabled=!0);this._editor.getOption(76).renderType===2&&this._sessionStore.add(this._editor.onDidChangeCursorPosition(()=>{this._showEndForLine=void 0,this._renderStickyScroll(0)}))}_readConfigurationChange(e){(e.hasChanged(131)||e.hasChanged(81)||e.hasChanged(75)||e.hasChanged(126)||e.hasChanged(76))&&this._readConfiguration(),(e.hasChanged(76)||e.hasChanged(52)||e.hasChanged(126))&&this._renderStickyScroll(0)}_needsUpdate(e){let t=this._stickyScrollWidget.getCurrentLines();for(let n of t)for(let t of e.ranges)if(n>=t.fromLineNumber&&n<=t.toLineNumber)return!0;return!1}_onTokensChange(e){this._needsUpdate(e)&&this._renderStickyScroll(0)}_onDidResize(){let e=this._editor.getLayoutInfo().height/this._editor.getOption(75);this._maxStickyLines=Math.round(e*.25),this._renderStickyScroll(0)}async _renderStickyScroll(e){let t=this._editor.getModel();if(!t||t.isTooLargeForTokenization()){this._resetState();return}let n=this._updateAndGetMinRebuildFromLine(e),r=this._stickyLineCandidateProvider.getVersionId();if(r===void 0||r===t.getVersionId())if(!this._focused)await this._updateState(n);else if(this._focusedStickyElementIndex===-1)await this._updateState(n),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1,this._focusedStickyElementIndex!==-1&&this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);else{let e=this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];await this._updateState(n),this._stickyScrollWidget.lineNumberCount===0?this._focusedStickyElementIndex=-1:(this._stickyScrollWidget.lineNumbers.includes(e)||(this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1),this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}}_updateAndGetMinRebuildFromLine(e){if(e!==void 0){let t=this._minRebuildFromLine===void 0?1/0:this._minRebuildFromLine;this._minRebuildFromLine=Math.min(e,t)}return this._minRebuildFromLine}async _updateState(e){this._minRebuildFromLine=void 0,this._foldingModel=await Fw.get(this._editor)?.getFoldingModel()??void 0,this._widgetState=this.findScrollWidgetState();let t=this._widgetState.startLineNumbers.length>0;this._stickyScrollVisibleContextKey.set(t),this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e)}async _resetState(){this._minRebuildFromLine=void 0,this._foldingModel=void 0,this._widgetState=Fk.Empty,this._stickyScrollVisibleContextKey.set(!1),this._stickyScrollWidget.setState(void 0,void 0)}findScrollWidgetState(){let e=Math.min(this._maxStickyLines,this._editor.getOption(131).maxLineCount),t=this._editor.getScrollTop(),n=0,r=[],i=[],a=this._editor.getVisibleRanges();if(a.length!==0){let o=new Wk(a[0].startLineNumber,a[a.length-1].endLineNumber),s=this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(o);for(let a of s){let o=a.startLineNumber,s=a.endLineNumber,c=a.top,l=c+a.height,u=this._editor.getTopForLineNumber(o)-t,d=this._editor.getBottomForLineNumber(s)-t;if(c>u&&c<=d&&(r.push(o),i.push(s+1),l>d&&(n=d-l)),r.length===e)break}}return this._endLineNumbers=i,new Fk(r,i,n,this._showEndForLine)}dispose(){super.dispose(),this._sessionStore.dispose()}};uA=lA=sA([cA(1,Bc),cA(2,H),cA(3,k),cA(4,Ce),cA(5,fu),cA(6,On)],uA);const dA=F(`inlineEdit.originalBackground`,At(_,.2),G(1210,`Background color for the original text in inline edits.`),!0),fA=F(`inlineEdit.modifiedBackground`,At(xa,.3),G(1211,`Background color for the modified text in inline edits.`),!0);F(`inlineEdit.originalChangedLineBackground`,At(_,.8),G(1212,`Background color for the changed lines in the original text of inline edits.`),!0);const pA=F(`inlineEdit.originalChangedTextBackground`,At(_,.8),G(1213,`Overlay color for the changed text in the original text of inline edits.`),!0),mA=F(`inlineEdit.modifiedChangedLineBackground`,{light:At(Dr,.7),dark:At(Dr,.7),hcDark:Dr,hcLight:Dr},G(1214,`Background color for the changed lines in the modified text of inline edits.`),!0),hA=F(`inlineEdit.modifiedChangedTextBackground`,At(xa,.7),G(1215,`Overlay color for the changed text in the modified text of inline edits.`),!0),gA=F(`inlineEdit.gutterIndicator.primaryForeground`,be,G(1216,`Foreground color for the primary inline edit gutter indicator.`)),_A=F(`inlineEdit.gutterIndicator.primaryBorder`,dd,G(1217,`Border color for the primary inline edit gutter indicator.`)),vA=F(`inlineEdit.gutterIndicator.primaryBackground`,{light:At(_A,.5),dark:At(_A,.4),hcDark:At(_A,.4),hcLight:At(_A,.5)},G(1218,`Background color for the primary inline edit gutter indicator.`)),yA=F(`inlineEdit.gutterIndicator.secondaryForeground`,Nt,G(1219,`Foreground color for the secondary inline edit gutter indicator.`)),bA=F(`inlineEdit.gutterIndicator.secondaryBorder`,Ai,G(1220,`Border color for the secondary inline edit gutter indicator.`)),xA=F(`inlineEdit.gutterIndicator.secondaryBackground`,bA,G(1221,`Background color for the secondary inline edit gutter indicator.`)),SA=F(`inlineEdit.gutterIndicator.successfulForeground`,be,G(1222,`Foreground color for the successful inline edit gutter indicator.`)),CA=F(`inlineEdit.gutterIndicator.successfulBorder`,dd,G(1223,`Border color for the successful inline edit gutter indicator.`)),wA=F(`inlineEdit.gutterIndicator.successfulBackground`,CA,G(1224,`Background color for the successful inline edit gutter indicator.`)),TA=F(`inlineEdit.gutterIndicator.background`,{hcDark:At(`tab.inactiveBackground`,.5),hcLight:At(`tab.inactiveBackground`,.5),dark:At(`tab.inactiveBackground`,.5),light:`#5f5f5f18`},G(1225,`Background color for the inline edit gutter indicator.`));var EA=F(`inlineEdit.originalBorder`,{light:_,dark:_,hcDark:_,hcLight:_},G(1226,`Border color for the original text in inline edits.`)),DA=F(`inlineEdit.modifiedBorder`,{light:cd(xa,.6),dark:xa,hcDark:xa,hcLight:xa},G(1227,`Border color for the modified text in inline edits.`)),OA=F(`inlineEdit.tabWillAcceptModifiedBorder`,{light:cd(DA,0),dark:cd(DA,0),hcDark:cd(DA,0),hcLight:cd(DA,0)},G(1228,`Modified border color for the inline edits widget when tab will accept it.`)),kA=F(`inlineEdit.tabWillAcceptOriginalBorder`,{light:cd(EA,0),dark:cd(EA,0),hcDark:cd(EA,0),hcLight:cd(EA,0)},G(1229,`Original border color for the inline edits widget over the original text when tab will accept it.`));function AA(e){return e.map(e=>e===SD.Accept?OA:DA)}function jA(e){return e.map(e=>e===SD.Accept?kA:EA)}function MA(e,t){let n;n=typeof e==`string`?NA(e,t):e.map((e,n)=>NA(e,t).read(n));let r=NA(Jl,t);return n.map((e,t)=>e.makeOpaque(r.read(t)))}function NA(e,t){return un({owner:{observeColor:e},equalsFn:(e,t)=>e.equals(t),debugName:()=>`observeColor(${e})`},t.onDidColorThemeChange,()=>{let n=t.getColorTheme().getColor(e);if(!n)throw new se(`Missing color: ${e}`);return n})}function PA(e,t,n){e.layoutInfo.read(n),e.value.read(n);let r=e.model.read(n);if(!r)return 0;let i=0;e.scrollTop.read(n);for(let n=t.startLineNumber;n<t.endLineNumberExclusive;n++){let t=r.getLineMaxColumn(n),a=e.editor.getOffsetForColumn(n,t);if(a===-1){let n=e.editor.getOption(59).typicalHalfwidthCharacterWidth;a=t*n}i=Math.max(i,a)}let a=t.mapToLineArray(e=>r.getLineContent(e));return i<5&&a.some(e=>e.length>0)&&r.uri.scheme!==`file`&&console.error(`unexpected width`),i}function FA(e,t,n){return e.layoutInfo.read(n),e.value.read(n),e.model.read(n)?(e.scrollTop.read(n),e.editor.getOffsetForColumn(t.lineNumber,t.column)):0}function IA(e,t,n,r){let i=r.getModel();if(!i)return{prefixTrim:0,prefixLeftOffset:0};let a=e.map(e=>e.isSingleLine()?e.startColumn-1:0),o=t.mapToLineArray(e=>oo(i.getLineContent(e))),s=n.filter(e=>e!==``).map(e=>oo(e)),c=Math.min(...a,...o,...s),l;if(i.getLineIndentColumn(t.startLineNumber)>=c+1)l=r.getOffsetForColumn(t.startLineNumber,c+1);else if(n.length>0)l=LA(n[0].slice(0,c),r,i);else return{prefixTrim:0,prefixLeftOffset:0};return{prefixTrim:c,prefixLeftOffset:l}}function LA(e,t,n){let r=t.getOption(59).typicalHalfwidthCharacterWidth,i=n.getOptions().tabSize*r,a=e.split(`	`).length-1;return(e.length-a)*r+a*i}function RA(e){let t=e.layoutInfoContentLeft,n=O({name:`editor.validOverlay.width`},n=>{let r=e.layoutInfoMinimap.read(n).minimapLeft!==0,i=e.layoutInfoWidth.read(n)-t.read(n);if(r){let t=e.layoutInfoMinimap.read(n).minimapWidth+e.layoutInfoVerticalScrollbarWidth.read(n);return i-t}return i}),r=O({name:`editor.validOverlay.height`},t=>e.layoutInfoHeight.read(t)+e.contentHeight.read(t));return O({name:`editor.validOverlay`},e=>Pk.fromLeftTopWidthHeight(t.read(e),0,n.read(e),r.read(e)))}function zA(e,t){let n=[];for(let r of e){let e=t.mapRange(r.modifiedRange);n.push(new Cs(r.originalRange,e))}return n}function BA(...e){return e.filter(e=>typeof e==`string`).join(` `)}function VA(e,t){return new T(t.lineNumber,t.column+e.start,t.lineNumber,t.column+e.endExclusive)}function HA(e,t){let n=0;loop:for(let r=0,i=e.length;r<i;r++)switch(e.charCodeAt(r)){case 9:n+=t;break;case 32:n++;break;default:break loop}return n-n%t}function UA(e,t,n){let r=t-t%n,i=0;for(;i<e.length&&r!==0;i++)switch(e.charCodeAt(i)){case 9:r-=n;break;case 32:r--;break;default:throw new se(`Unexpected character found while calculating indent length`)}return i}function WA(e,t,n){let r=Uo(e),i=[],a=di(t.mapToLineArray(e=>HA(r[e-1],n)),ca);return t.forEach(e=>{let t=UA(r[e-1],a,n);i.push(new Su(VA(new ac(0,t),new C(e,1)),``))}),new Ia(i)}var GA=class{constructor(){this._data=``}moveTo(e){return this._data+=`M ${e.x} ${e.y} `,this}lineTo(e){return this._data+=`L ${e.x} ${e.y} `,this}build(){return this._data}};function KA(e){let t=Oi(void 0,(t,n)=>e.read(t)||n);return ya({debugName:()=>`${e.debugName}.mapOutFalsy`},n=>{if(t.read(n),e.read(n))return t})}function qA(e){return{left:O({name:`editor.validOverlay.left`},t=>e(t).left),top:O({name:`editor.validOverlay.top`},t=>e(t).top),width:O({name:`editor.validOverlay.width`},t=>e(t).right-e(t).left),height:O({name:`editor.validOverlay.height`},t=>e(t).bottom-e(t).top)}}var JA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},YA=function(e,t){return function(n,r){t(n,r,e)}},XA=class{constructor(e,t,n,r,i,a){this._model=e,this._close=t,this._editorObs=n,this._contextKeyService=r,this._keybindingService=i,this._commandService=a,this._inlineEditsShowCollapsed=this._editorObs.getOption(71).map(e=>e.edits.showCollapsed)}toDisposableLiveElement(){return this._createHoverContent().toDisposableLiveElement()}_createHoverContent(){let e=kl(`active`,void 0),t=t=>({title:t.title,icon:t.icon,keybinding:typeof t.commandId==`string`?this._getKeybinding(t.commandArgs?void 0:t.commandId):O(this,e=>typeof t.commandId==`string`?void 0:this._getKeybinding(t.commandArgs?void 0:t.commandId.read(e)).read(e)),isActive:e.map(e=>e===t.id),onHoverChange:n=>e.set(n?t.id:void 0,void 0),onAction:()=>(this._close(!0),this._commandService.executeCommand(typeof t.commandId==`string`?t.commandId:t.commandId.get(),...t.commandArgs??[]))}),n=QA(this._model.displayName),r=$A(t({id:`gotoAndAccept`,title:`${G(1203,`Go To`)} / ${G(1204,`Accept`)}`,icon:X.check,commandId:E_})),i=$A(t({id:`reject`,title:G(1205,`Reject`),icon:X.close,commandId:k_})),a=this._model.extensionCommands.map((e,n)=>$A(t({id:e.command.id+`_`+n,title:e.command.title,icon:e.icon??X.symbolEvent,commandId:e.command.id,commandArgs:e.command.arguments}))),o=this._inlineEditsShowCollapsed.map(e=>$A(t(e?{id:`showExpanded`,title:G(1206,`Show Expanded`),icon:X.expandAll,commandId:A_}:{id:`showCollapsed`,title:G(1207,`Show Collapsed`),icon:X.collapseAll,commandId:A_}))),s=$A(t({id:`settings`,title:G(1208,`Settings`),icon:X.gear,commandId:`workbench.action.openSettings`,commandArgs:[`@tag:nextEditSuggestions`]})),c=this._model.action?[this._model.action]:[],l=c.length>0?ej(c.map(e=>({id:e.id,label:e.title+`...`,enabled:!0,run:()=>this._commandService.executeCommand(e.id,...e.arguments??[]),class:void 0,tooltip:e.tooltip??e.title})),{hoverDelegate:Zc}):void 0;return ZA([n,r,i,o,a.length?tj():void 0,s,...a,l?tj():void 0,l])}_getKeybinding(e){return e?yt(this._contextKeyService.onDidChangeContext,()=>this._keybindingService.lookupKeybinding(e)):Lr(void 0)}};XA=JA([YA(3,On),YA(4,Yt),YA(5,Te)],XA);function ZA(e){return w.div({class:`content`,style:{margin:4,minWidth:180}},e)}function QA(e){return w.div({class:`header`,style:{color:A(fr),fontSize:`13px`,fontWeight:`600`,padding:`0 4px`,lineHeight:28}},[e])}function $A(e){return O({name:`inlineEdits.option`},t=>w.div({class:[`monaco-menu-option`,e.isActive?.map(e=>e&&`active`)],onmouseenter:()=>e.onHoverChange?.(!0),onmouseleave:()=>e.onHoverChange?.(!1),onclick:e.onAction,onkeydown:t=>{t.key===`Enter`&&e.onAction?.()},tabIndex:0,style:{borderRadius:3}},[w.elem(`span`,{style:{fontSize:16,display:`flex`}},[I.isThemeIcon(e.icon)?ic(e.icon):e.icon.map(e=>ic(e))]),w.elem(`span`,{},[e.title]),w.div({style:{marginLeft:`auto`},ref:n=>{let r=t.store.add(new Es(n,js,{disableTitle:!0,...Ee,keybindingLabelShadow:void 0,keybindingLabelForeground:A(fr),keybindingLabelBackground:`transparent`,keybindingLabelBorder:`transparent`,keybindingLabelBottomBorder:void 0}));t.store.add(g(t=>{r.set(e.keybinding.read(t))}))}})]))}function ej(e,t){return O({name:`inlineEdits.actionBar`},n=>w.div({class:[`action-widget-action-bar`],style:{padding:`3px 24px`}},[w.div({ref:r=>{n.store.add(new Bn(r,t)).push(e,{icon:!1,label:!0})}})]))}function tj(){return w.div({id:`inline-edit-gutter-indicator-menu-separator`,class:`menu-separator`,style:{color:A(Gt),padding:`2px 0`}},w.div({style:{borderBottom:`1px solid ${A(Co)}`}}))}var nj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rj=function(e,t){return function(n,r){t(n,r,e)}},ij=class extends x{get model(){let e=this._model.get();if(!e)throw new se(`Inline Edit Model not available`);return e}constructor(e,t,n,r,i,a,o,s,c,l){super(),this._editorObs=e,this._originalRange=t,this._verticalOffset=n,this._model=r,this._isHoveringOverInlineEdit=i,this._focusIsInMenu=a,this._hoverService=o,this._instantiationService=s,this._accessibilityService=c,this._tabAction=O(this,e=>{let t=this._model.read(e);return t?t.tabAction.read(e):SD.Inactive}),this._hoverVisible=kl(this,!1),this.isHoverVisible=this._hoverVisible,this._isHoveredOverIcon=kl(this,!1),this._isHoveredOverIconDebounced=ve(this._isHoveredOverIcon,100),this.isHoveredOverIcon=this._isHoveredOverIconDebounced,this._isHoveredOverInlineEditDebounced=ve(this._isHoveringOverInlineEdit,100),this._gutterIndicatorStyles=this._tabAction.map(this,(e,t)=>{switch(e){case SD.Inactive:return{background:MA(xA,l).read(t).toString(),foreground:MA(yA,l).read(t).toString(),border:MA(bA,l).read(t).toString()};case SD.Jump:return{background:MA(vA,l).read(t).toString(),foreground:MA(gA,l).read(t).toString(),border:MA(_A,l).read(t).toString()};case SD.Accept:return{background:MA(wA,l).read(t).toString(),foreground:MA(SA,l).read(t).toString(),border:MA(CA,l).read(t).toString()};default:nr(e)}}),this._originalRangeObs=KA(this._originalRange),this._state=O(this,e=>{let t=this._originalRangeObs.read(e);if(t)return{range:t,lineOffsetRange:this._editorObs.observeLineOffsetRange(t,this._store)}}),this._stickyScrollController=uA.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?yt(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):Lr(0),this._lineNumberToRender=O(this,e=>{if(this._verticalOffset.read(e)!==0)return``;let t=this._originalRange.read(e)?.startLineNumber,n=this._editorObs.getOption(76).read(e);if(t===void 0||n.renderType===0)return``;if(n.renderType===3){let n=this._editorObs.cursorPosition.read(e);return t%10==0||n&&n.lineNumber===t?t.toString():``}if(n.renderType===2){let n=this._editorObs.cursorPosition.read(e);if(!n)return``;let r=Math.abs(t-n.lineNumber);return r===0?t.toString():r.toString()}return n.renderType===4?n.renderFn?n.renderFn(t):``:t.toString()}),this._availableWidthForIcon=O(this,e=>{let t=this._editorObs.editor.getModel(),n=this._editorObs.editor,r=this._editorObs.layoutInfo.read(e),i=r.decorationsLeft+r.decorationsWidth-r.glyphMarginLeft;if(!t||i<=0)return()=>0;if(r.lineNumbersLeft===0)return()=>i;let a=this._editorObs.getOption(76).read(e);if(a.renderType===2||a.renderType===0)return()=>i;let o=n.getOption(59).typicalHalfwidthCharacterWidth,s=r.lineNumbersLeft+r.lineNumbersWidth,c=(t.getLineCount()+1).toString().length,l=[];for(let e=1;e<=c;e++){let t=10**(e-1),a=n.getTopForLineNumber(t),c=e*o,u=Math.min(i,Math.max(0,s-c-r.glyphMarginLeft));l.push({firstLineNumberWithDigitCount:t,topOfLineNumber:a,usableWidthLeftOfLineNumber:u})}return e=>{for(let t=l.length-1;t>=0;t--)if(e>=l[t].topOfLineNumber)return l[t].usableWidthLeftOfLineNumber;throw new se(`Could not find avilable width for icon`)}}),this._layout=O(this,e=>{let t=this._state.read(e);if(!t)return;let n=this._editorObs.layoutInfo.read(e),r=this._editorObs.observeLineHeightForLine(t.range.map(e=>e.startLineNumber)).read(e),i=n.decorationsLeft+n.decorationsWidth-n.glyphMarginLeft-4,a=n.height-4,o=Pk.fromLeftTopWidthHeight(2,2,i,a),s=o.withTop(this._stickyScrollHeight.read(e)),c=o.withTop(s.top+2),l=t.lineOffsetRange.read(e),u=Pk.fromRanges(ac.fromTo(c.left,c.right),l),d=r,f=this._verticalOffset.read(e),p=u.withHeight(d).translateY(f),m=s.containsRect(p),h=this._tabAction.map(e=>e===SD.Accept?X.keyboardTab:X.arrowRight),g=O(this,e=>{if(this._isHoveredOverIconDebounced.read(e)||this._isHoveredOverInlineEditDebounced.read(e))return X.check;if(this._tabAction.read(e)===SD.Accept)return X.keyboardTab;let n=this._editorObs.cursorLineNumber.read(e)??0,r=t.range.read(e).startLineNumber;return n<=r?X.keyboardTabAbove:X.keyboardTabBelow}),_=e=>{let t=this._availableWidthForIcon.read(void 0)(e.bottom+this._editorObs.editor.getScrollTop())-2;return Math.max(Math.min(t,22),16)};if(m){let e=p,t;t=n.lineNumbersWidth===0?Math.min(Math.max(n.lineNumbersLeft-o.left,0),e.width-22):Math.max(n.lineNumbersLeft+n.lineNumbersWidth-o.left,0);let r=e.withWidth(t),i=Math.max(Math.min(n.decorationsWidth,22),16),a=e.withWidth(i).translateX(t);return{gutterEditArea:u,icon:g,iconDirection:`right`,iconRect:a,pillRect:e,lineNumberRect:r}}let ee=o.intersect(u);if(ee&&ee.height>=d){let e=p.moveToBeContainedIn(c).moveToBeContainedIn(ee),t=e.withWidth(_(e));return{gutterEditArea:u,icon:g,iconDirection:`right`,iconRect:t,pillRect:t}}let v=p.moveToBeContainedIn(o),te=v.withWidth(_(v)),y=te,b=te.top<p.top?`top`:`bottom`;return{gutterEditArea:u,icon:h,iconDirection:b,iconRect:y,pillRect:te}}),this._iconRef=w.ref(),this.isVisible=this._layout.map(e=>!!e),this._indicator=w.div({class:`inline-edits-view-gutter-indicator`,onclick:()=>{let e=this._layout.get()?.icon.get()===X.check;this._editorObs.editor.focus(),e?this.model.accept():this.model.jump()},tabIndex:0,style:{position:`absolute`,overflow:`visible`}},KA(this._layout).map(e=>e?[w.div({style:{position:`absolute`,background:A(TA),borderRadius:`4px`,...qA(t=>e.read(t).gutterEditArea)}}),w.div({class:`icon`,ref:this._iconRef,onmouseenter:()=>{this._showHover()},style:{cursor:`pointer`,zIndex:`20`,position:`absolute`,backgroundColor:this._gutterIndicatorStyles.map(e=>e.background),"--vscodeIconForeground":this._gutterIndicatorStyles.map(e=>e.foreground),border:this._gutterIndicatorStyles.map(e=>`1px solid ${e.border}`),boxSizing:`border-box`,borderRadius:`4px`,display:`flex`,justifyContent:`flex-end`,transition:`background-color 0.2s ease-in-out, width 0.2s ease-in-out`,...qA(t=>e.read(t).pillRect)}},[w.div({className:`line-number`,style:{lineHeight:e.map(e=>e.lineNumberRect?e.lineNumberRect.height:0),display:e.map(e=>e.lineNumberRect?`flex`:`none`),alignItems:`center`,justifyContent:`flex-end`,width:e.map(e=>e.lineNumberRect?e.lineNumberRect.width:0),height:`100%`,color:this._gutterIndicatorStyles.map(e=>e.foreground)}},this._lineNumberToRender),w.div({style:{rotate:e.map(e=>`${aj(e.iconDirection)}deg`),transition:`rotate 0.2s ease-in-out`,display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`,marginRight:e.map(e=>e.pillRect.width-e.iconRect.width-(e.lineNumberRect?.width??0)),width:e.map(e=>e.iconRect.width)}},[e.map((e,t)=>ic(e.icon.read(t)))])])]:[])).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._indicator.element,position:Lr(null),allowEditorOverflow:!1,minContentWidthInPx:Lr(0)})),this._register(this._editorObs.editor.onMouseMove(e=>{if(this._state.get()===void 0)return;let t=this._iconRef.element.getBoundingClientRect(),n=Pk.fromLeftTopWidthHeight(t.left,t.top,t.width,t.height),r=new jn(e.event.posx,e.event.posy);this._isHoveredOverIcon.set(n.containsPoint(r),void 0)})),this._register(this._editorObs.editor.onDidScrollChange(()=>{this._isHoveredOverIcon.set(!1,void 0)})),this._register(pr(this._isHoveredOverInlineEditDebounced,e=>{e&&this.triggerAnimation()})),this._register(g(e=>{this._indicator.readEffect(e),this._indicator.element&&this._editorObs.editor.applyFontInfo(this._indicator.element)}))}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{outline:`2px solid ${this._gutterIndicatorStyles.map(e=>e.border).get()}`,outlineOffset:`-1px`,offset:0},{outline:`2px solid transparent`,outlineOffset:`10px`,offset:1}],{duration:500}).finished}_showHover(){if(this._hoverVisible.get())return;let e=new L,t=e.add(this._instantiationService.createInstance(XA,this.model,e=>{e&&this._editorObs.editor.focus(),r?.dispose()},this._editorObs).toDisposableLiveElement()),n=e.add(Wn(t.element));e.add(n.onDidBlur(()=>this._focusIsInMenu.set(!1,void 0))),e.add(n.onDidFocus(()=>this._focusIsInMenu.set(!0,void 0))),e.add(Cl(()=>this._focusIsInMenu.set(!1,void 0)));let r=this._hoverService.showInstantHover({target:this._iconRef.element,content:t.element});r?(this._hoverVisible.set(!0,void 0),e.add(this._editorObs.editor.onDidScrollChange(()=>r.dispose())),e.add(r.onDispose(()=>{this._hoverVisible.set(!1,void 0),e.dispose()}))):e.dispose()}};ij=nj([rj(6,Is),rj(7,k),rj(8,Qt),rj(9,pa)],ij);function aj(e){switch(e){case`top`:return 90;case`bottom`:return-90;case`right`:return 0}}var oj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},sj=function(e,t){return function(n,r){t(n,r,e)}},cj;(function(e){e.FirstTime=`firstTime`,e.SecondTime=`secondTime`,e.Active=`active`})(cj||={});var lj=class extends x{constructor(e,t,n,r,i,a){super(),this._host=e,this._model=t,this._indicator=n,this._collapsedView=r,this._storageService=i,this._configurationService=a,this._disposables=this._register(new Bt),this._setupDone=kl({name:`setupDone`},!1),this._activeCompletionId=O(e=>{let t=this._model.read(e);if(!t||!this._setupDone.read(e))return;let n=this._indicator.read(e);if(!(!n||!n.isVisible.read(e)))return t.inlineEdit.inlineCompletion.identity.id}),this._register(this._initializeDebugSetting()),this._disposables.value=this.setupNewUserExperience(),this._setupDone.set(!0,void 0)}setupNewUserExperience(){if(this.getNewUserType()===cj.Active)return;let e=new L,t=!1,n=!1,r=0,i=0;return e.add(st(this._activeCompletionId,async(e,a,o,s)=>{if(e===void 0)return;let c=this.getNewUserType();switch(c){case cj.FirstTime:(r++>=5||t)&&(c=cj.SecondTime,this.setNewUserType(c));break;case cj.SecondTime:i++>=3&&n&&(c=cj.Active,this.setNewUserType(c));break}switch(c){case cj.FirstTime:for(let e=0;e<3&&!s.isCancellationRequested;e++)await this._indicator.get()?.triggerAnimation(),await le(500);break;case cj.SecondTime:this._indicator.get()?.triggerAnimation();break}})),e.add(g(e=>{this._collapsedView.isVisible.read(e)&&this.getNewUserType()!==cj.Active&&this._collapsedView.triggerAnimation()})),e.add(Ql((e,n)=>{let r=this._indicator.read(e);r&&n.add(pr(r.isHoveredOverIcon,async e=>{e&&(t=!0)}))})),e.add(Ql((e,t)=>{let r=this._host.read(e);r&&t.add(r.onDidAccept(()=>{n=!0}))})),e}getNewUserType(){return this._storageService.get(`inlineEditsGutterIndicatorUserKind`,-1,cj.FirstTime)}setNewUserType(e){switch(e){case cj.FirstTime:throw new se(`UserKind should not be set to first time`);case cj.SecondTime:break;case cj.Active:this._disposables.clear();break}this._storageService.store(`inlineEditsGutterIndicatorUserKind`,e,-1,0)}_initializeDebugSetting(){let e=`editor.inlineSuggest.edits.resetNewUserExperience`;return this._configurationService.getValue(e)&&this._storageService.remove(`inlineEditsGutterIndicatorUserKind`,-1),this._configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration(e)&&this._configurationService.getValue(e)&&(this._storageService.remove(`inlineEditsGutterIndicatorUserKind`,-1),this._disposables.value=this.setupNewUserExperience())})}};lj=oj([sj(4,Qr),sj(5,hn)],lj);var uj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},dj=function(e,t){return function(n,r){t(n,r,e)}},fj=class extends x{constructor(e,t,n){super(),this._editor=e,this._edit=t,this._accessibilityService=n,this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._iconRef=w.ref(),this.isHovered=Lr(!1),this._editorObs=Bs(this._editor);let r=this._edit.map(e=>e?.edit.replacements[0]??null).map(e=>e?UE(e,this._editor.getModel()).range.getStartPosition():null),i=this._editorObs.observePosition(r,this._store),a=O(e=>{let t=i.read(e);if(!t)return null;let n=this._editorObs.layoutInfoContentLeft.read(e),r=this._editorObs.scrollLeft.read(e);return new jn(n+t.x-r,t.y)}),o=w.div({class:`inline-edits-collapsed-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:`block`}},[[this.getCollapsedIndicator(a)]]).keepUpdated(this._store).element;this._register(this._editorObs.createOverlayWidget({domNode:o,position:Lr(null),allowEditorOverflow:!1,minContentWidthInPx:Lr(0)})),this.isVisible=this._edit.map((e,t)=>!!e&&a.read(t)!==null)}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{offset:0,transform:`translateY(-3px)`},{offset:.2,transform:`translateY(1px)`},{offset:.36,transform:`translateY(-1px)`},{offset:.52,transform:`translateY(1px)`},{offset:.68,transform:`translateY(-1px)`},{offset:.84,transform:`translateY(1px)`},{offset:1,transform:`translateY(0px)`}],{duration:2e3}).finished}getCollapsedIndicator(e){let t=this._editorObs.layoutInfoContentLeft,n=e.map((e,n)=>e?e.deltaX(-t.read(n)):null),r=this.createIconPath(n);return w.svg({class:`collapsedView`,ref:this._iconRef,style:{position:`absolute`,...qA(e=>RA(this._editorObs).read(e)),overflow:`hidden`,pointerEvents:`none`}},[w.svgElem(`path`,{class:`collapsedViewPath`,d:r,fill:A(_A)})])}createIconPath(e){return e.map(e=>{if(!e)return new GA().build();let t=e.deltaX(-6/2).deltaY(-1),n=t.deltaX(6),r=t.deltaY(1),i=n.deltaY(1),a=r.deltaX(6/2).deltaY(3);return new GA().moveTo(t).lineTo(n).lineTo(i).lineTo(a).lineTo(r).lineTo(t).build()})}};fj=uj([dj(2,Qt)],fj);var pj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mj=function(e,t){return function(n,r){t(n,r,e)}},hj=14,gj=0,_j=4,vj=4,yj=2,bj=class extends x{constructor(e,t,n,r,i){super(),this._editor=e,this._languageService=i,this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._isHovered=kl(this,!1),this.isHovered=this._isHovered,this._viewRef=w.ref(),this._editorObs=Bs(this._editor);let a=n.map((e,t)=>{let n;switch(e){case SD.Inactive:n=xA;break;case SD.Jump:n=vA;break;case SD.Accept:n=wA;break}return{border:MA(n,r).read(t).toString(),background:A(Jl)}}),o=t.map(e=>e?this.getState(e):void 0),s=o.map(e=>e?this.getRendering(e,a):void 0);this.minEditorScrollHeight=O(this,e=>{let t=o.read(e);return t?t.rect.read(e).bottom+this._editor.getScrollTop():0});let c=w.div({class:`inline-edits-custom-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:`block`}},[s]).keepUpdated(this._store);this._register(this._editorObs.createOverlayWidget({domNode:c.element,position:Lr(null),allowEditorOverflow:!1,minContentWidthInPx:Oi(this,(e,t)=>{let n=o.read(e);if(!n)return t??0;let r=n.rect.map(e=>e.right).read(e)+this._editorObs.layoutInfoVerticalScrollbarWidth.read(e)+_j-this._editorObs.layoutInfoContentLeft.read(e);return Math.max(t??0,r)}).recomputeInitiallyAndOnChange(this._store)})),this._register(g(e=>{if(!s.read(e)){this._isHovered.set(!1,void 0);return}this._isHovered.set(c.isHovered.read(e),void 0)}))}fitsInsideViewport(e,t,n){let r=this._editorObs.layoutInfoWidth.read(n),i=this._editorObs.layoutInfoContentLeft.read(n),a=this._editor.getLayoutInfo().verticalScrollbarWidth,o=this._editorObs.layoutInfoMinimap.read(n).minimapLeft===0?0:this._editorObs.layoutInfoMinimap.read(n).minimapWidth,s=PA(this._editorObs,e,void 0),c=LA(t,this._editor,this._editor.getModel()),l=_j+hj;return s+c+l<r-i-a-o}getState(e){let t=O(this,t=>{let n=e.range.startLineNumber,r=e.range.endLineNumber,i=e.range.startColumn,a=e.range.endColumn,o=this._editor.getModel()?.getLineCount()??0,s=PA(this._editorObs,new $r(n,n+1),t),c=n+1<=o?PA(this._editorObs,new $r(n+1,n+2),t):void 0,l=n-1>=1?PA(this._editorObs,new $r(n-1,n),t):void 0,u=this._editor.getOffsetForColumn(n,i),d=this._editor.getOffsetForColumn(r,a);return{lineWidth:s,lineWidthBelow:c,lineWidthAbove:l,startContentLeftOffset:u,endContentLeftOffset:d}}),n=e.range.startLineNumber,r=e.range.endLineNumber,i=this.fitsInsideViewport(new $r(n,r+1),e.label,void 0);return{rect:O(this,a=>{let o=this._editorObs.getOption(59).read(a).typicalHalfwidthCharacterWidth,{lineWidth:s,lineWidthBelow:c,lineWidthAbove:l,startContentLeftOffset:u,endContentLeftOffset:d}=t.read(a),f=this._editorObs.layoutInfoContentLeft.read(a),p=this._editorObs.observeLineHeightForLine(n).recomputeInitiallyAndOnChange(a.store).read(a),m=this._editorObs.scrollTop.read(a),h=this._editorObs.scrollLeft.read(a),g;g=n===r&&d+5*o>=s&&i?`end`:c!==void 0&&c+hj-vj-_j<u?`below`:l!==void 0&&l+hj-vj-_j<u?`above`:`end`;let _,ee,v=0,te=0;switch(g){case`end`:_=this._editorObs.editor.getTopForLineNumber(n),ee=s,v=_j+hj;break;case`below`:_=this._editorObs.editor.getTopForLineNumber(n+1),ee=u,v=_j+vj,te=gj+yj;break;case`above`:_=this._editorObs.editor.getTopForLineNumber(n-1),ee=u,v=_j+vj,te=-gj+yj;break}return Pk.fromLeftTopWidthHeight(f+ee-h,_-m,o*e.label.length,p).withMargin(gj,_j).translateX(v).translateY(te)}),label:e.label,kind:e.kind}}getRendering(e,t){let n=document.createElement(`div`),r=this._editor.getModel().tokenization.tokenizeLinesAt(1,[e.label])?.[0],i;i=r&&e.kind===ts.Code?jl.fromLineTokens(r).toLineTokens(e.label,this._languageService.languageIdCodec):zc.createEmpty(e.label,this._languageService.languageIdCodec);let a=Vt(new dr([i]),at.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],n,!0);n.style.width=`${a.minWidthInPx}px`;let o=e.rect.map(e=>e.withMargin(0,_j));return w.div({class:`collapsedView`,ref:this._viewRef,style:{position:`absolute`,...qA(e=>o.read(e)),overflow:`hidden`,boxSizing:`border-box`,cursor:`pointer`,border:t.map(e=>`1px solid ${e.border}`),borderRadius:`4px`,backgroundColor:t.map(e=>e.background),display:`flex`,alignItems:`center`,justifyContent:`center`,whiteSpace:`nowrap`},onmousedown:e=>{e.preventDefault()},onclick:e=>{this._onDidClick.fire(new Gs(eo(e),e))}},[n])}};bj=pj([mj(3,pa),mj(4,wt)],bj);var xj=0,Sj=0,Cj=1,wj=1,Tj=3,Ej=4,Dj=class extends x{constructor(e,t,n,r){super(),this._editor=e,this._edit=t,this._uiState=n,this._tabAction=r,this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._display=O(this,e=>this._uiState.read(e)?`block`:`none`),this._editorMaxContentWidthInRange=O(this,e=>{let t=this._originalDisplayRange.read(e);return t?(this._editorObs.versionId.read(e),Oi(this,(e,n)=>{let r=PA(this._editorObs,t,e);return Math.max(r,n??0)})):Lr(0)}).map((e,t)=>e.read(t)),this._maxPrefixTrim=O(this,e=>{let t=this._uiState.read(e);return t?IA(t.deletions,t.originalRange,[],this._editor):{prefixTrim:0,prefixLeftOffset:0}}),this._editorLayoutInfo=O(this,e=>{let t=this._edit.read(e);if(!t||!this._uiState.read(e))return null;let n=this._editorObs.layoutInfo.read(e),r=this._editorObs.scrollLeft.read(e),i=this._editorObs.getOption(59).map(e=>e.typicalHalfwidthCharacterWidth).read(e),a=n.contentLeft+Math.max(this._editorMaxContentWidthInRange.read(e),i)-r,o=t.originalLineRange,s=this._originalVerticalStartPosition.read(e)??this._editor.getTopForLineNumber(o.startLineNumber)-this._editorObs.scrollTop.read(e),c=this._originalVerticalEndPosition.read(e)??this._editor.getTopForLineNumber(o.endLineNumberExclusive)-this._editorObs.scrollTop.read(e),l=n.contentLeft+this._maxPrefixTrim.read(e).prefixLeftOffset-r;return a<=l?null:{codeRect:Pk.fromLeftTopRightBottom(l,s,a,c).withMargin(Sj,xj),contentLeft:n.contentLeft}}).recomputeInitiallyAndOnChange(this._store),this._originalOverlay=w.div({style:{pointerEvents:`none`}},O(this,e=>{let t=KA(this._editorLayoutInfo).read(e);if(!t)return;let n=t.map(e=>Pk.fromLeftTopRightBottom(e.contentLeft-Ej-Cj,e.codeRect.top,e.contentLeft,e.codeRect.bottom)),r=O(this,e=>{let r=t.read(e).codeRect,i=n.read(e);return r.intersectHorizontal(new ac(i.left,2**53-1))}),i=this._uiState.map(e=>e?.inDiffEditor?Tj:wj).read(e),a=r.map(e=>e.withMargin(i,i));return[w.div({class:`originalSeparatorDeletion`,style:{...a.read(e).toStyles(),borderRadius:`${Ej}px`,border:`${Cj+i}px solid ${A(Jl)}`,boxSizing:`border-box`}}),w.div({class:`originalOverlayDeletion`,style:{...r.read(e).toStyles(),borderRadius:`${Ej}px`,border:jA(this._tabAction).map(e=>`${Cj}px solid ${A(e)}`),boxSizing:`border-box`,backgroundColor:A(dA)}}),w.div({class:`originalOverlayHiderDeletion`,style:{...n.read(e).toStyles(),backgroundColor:A(Jl)}})]})).keepUpdated(this._store),this._nonOverflowView=w.div({class:`inline-edits-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:this._display}},[[this._originalOverlay]]).keepUpdated(this._store),this.isHovered=Lr(!1),this._editorObs=Bs(this._editor);let i=O(this,e=>{let t=this._edit.read(e);return t?new C(t.originalLineRange.startLineNumber,1):null}),a=O(this,e=>{let t=this._edit.read(e);return t?new C(t.originalLineRange.endLineNumberExclusive,1):null});this._originalDisplayRange=this._uiState.map(e=>e?.originalRange),this._originalVerticalStartPosition=this._editorObs.observePosition(i,this._store).map(e=>e?.y),this._originalVerticalEndPosition=this._editorObs.observePosition(a,this._store).map(e=>e?.y),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:Lr(null),allowEditorOverflow:!1,minContentWidthInPx:O(this,e=>{let t=this._editorLayoutInfo.read(e);return t===null?0:t.codeRect.width})}))}},Oj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},kj=function(e,t){return function(n,r){t(n,r,e)}},Aj=1,jj=1,Mj=3,Nj=4,Pj=class extends x{constructor(e,t,n,r,i){super(),this._editor=e,this._input=t,this._tabAction=n,this._languageService=i,this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._state=O(this,e=>{let t=this._input.read(e);if(!t)return;let n=this._editor.getModel(),r=n.getEOL();if(t.startColumn===1&&t.lineNumber>1&&n.getLineLength(t.lineNumber)!==0&&t.text.endsWith(r)&&!t.text.startsWith(r)){let e=n.getLineLength(t.lineNumber-1)+1;return{lineNumber:t.lineNumber-1,column:e,text:r+t.text.slice(0,-r.length)}}return{lineNumber:t.lineNumber,column:t.startColumn,text:t.text}}),this._trimVertically=O(this,e=>{let t=this._state.read(e),n=t?.text;if(!n||n.trim()===``)return{topOffset:0,bottomOffset:0,linesTop:0,linesBottom:0};let r=this._editor.getLineHeightForPosition(new C(t.lineNumber,1)),i=this._editor.getModel().getEOL(),a=0,o=0,s=0;for(;s<n.length&&n.startsWith(i,s);s+=i.length)a+=1;for(let e=n.length;e>s&&n.endsWith(i,e);e-=i.length)o+=1;return{topOffset:a*r,bottomOffset:o*r,linesTop:a,linesBottom:o}}),this._maxPrefixTrim=O(this,e=>{let t=this._state.read(e);if(!t)return{prefixLeftOffset:0,prefixTrim:0};let n=this._editor.getModel(),r=n.getEOL(),i=this._trimVertically.read(e),a=t.text.split(r),o=a.slice(i.linesTop,a.length-i.linesBottom);i.linesTop===0&&(o[0]=n.getLineContent(t.lineNumber)+o[0]);let s=new $r(t.lineNumber,t.lineNumber+(i.linesTop>0?0:1));return IA([],s,o,this._editor)}),this._ghostText=O(e=>{let t=this._state.read(e),n=this._maxPrefixTrim.read(e);if(!t)return;let r=this._editor.getModel().getEOL(),i=t.text.split(r).map((e,t)=>new fs(new T(t+1,t===0?1:n.prefixTrim+1,t+1,e.length+1),`modified-background`,0));return new RE(t.lineNumber,[new zE(t.column,t.text,!1,i)])}),this._display=O(this,e=>this._state.read(e)?`block`:`none`),this._editorMaxContentWidthInRange=O(this,e=>{let t=this._state.read(e);if(!t)return 0;this._editorObs.versionId.read(e);let n=this._editor.getModel(),r=n.getEOL(),i=t.text.startsWith(r)?``:n.getValueInRange(new T(t.lineNumber,1,t.lineNumber,t.column)),a=n.getValueInRange(new T(t.lineNumber,t.column,t.lineNumber,n.getLineLength(t.lineNumber)+1)),o=(i+t.text+a).split(r),s=at.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),c=o.map(e=>{let r=n.tokenization.tokenizeLinesAt(t.lineNumber,[e])?.[0],i;return i=r?jl.fromLineTokens(r).toLineTokens(e,this._languageService.languageIdCodec):zc.createEmpty(e,this._languageService.languageIdCodec),Vt(new dr([i]),s,[],b(`div`),!0).minWidthInPx});return Math.max(...c)}),this.startLineOffset=this._trimVertically.map(e=>e.topOffset),this.originalLines=this._state.map(e=>e?new $r(e.lineNumber,Math.min(e.lineNumber+2,this._editor.getModel().getLineCount()+1)):void 0),this._overlayLayout=O(this,e=>{this._ghostText.read(e);let t=this._state.read(e);if(!t)return null;this._editorObs.observePosition(kl(this,new C(t.lineNumber,t.column)),e.store).read(e);let n=this._editorObs.layoutInfo.read(e),r=this._editorObs.scrollLeft.read(e),i=this._editorObs.layoutInfoVerticalScrollbarWidth.read(e),a=n.contentLeft+this._editorMaxContentWidthInRange.read(e)-r,o=this._maxPrefixTrim.read(e).prefixLeftOffset??0,s=n.contentLeft+o-r;if(a<=s)return null;let{topOffset:c,bottomOffset:l}=this._trimVertically.read(e),u=this._editorObs.scrollTop.read(e),d=this._ghostTextView.height.read(e)-c-l,f=this._editor.getTopForLineNumber(t.lineNumber)-u+c,p=f+d,m=new Pk(s,f,a,p);return{overlay:m,startsAtContentLeft:o===0,contentLeft:n.contentLeft,minContentWidthRequired:o+m.width+i}}).recomputeInitiallyAndOnChange(this._store),this._modifiedOverlay=w.div({style:{pointerEvents:`none`}},O(this,e=>{let t=KA(this._overlayLayout).read(e);if(!t)return;let n=t.map(e=>Pk.fromLeftTopRightBottom(e.contentLeft-Nj-Aj,e.overlay.top,e.contentLeft,e.overlay.bottom)).read(e),r=this._input.map(e=>e?.inDiffEditor?Mj:jj).read(e),i=t.map(e=>e.overlay.withMargin(0,Aj,0,e.startsAtContentLeft?0:Aj).intersectHorizontal(new ac(n.left,2**53-1))),a=i.map(e=>e.withMargin(r,r));return[w.div({class:`originalUnderlayInsertion`,style:{...a.read(e).toStyles(),borderRadius:Nj,border:`${Aj+r}px solid ${A(Jl)}`,boxSizing:`border-box`}}),w.div({class:`originalOverlayInsertion`,style:{...i.read(e).toStyles(),borderRadius:Nj,border:AA(this._tabAction).map(e=>`${Aj}px solid ${A(e)}`),boxSizing:`border-box`,backgroundColor:A(fA)}}),w.div({class:`originalOverlayHiderInsertion`,style:{...n.toStyles(),backgroundColor:A(Jl)}})]})).keepUpdated(this._store),this._view=w.div({class:`inline-edits-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:this._display}},[[this._modifiedOverlay]]).keepUpdated(this._store),this._editorObs=Bs(this._editor),this._ghostTextView=this._register(r.createInstance(xk,this._editor,{ghostText:this._ghostText,minReservedLineCount:Lr(0),targetTextModel:this._editorObs.model.map(e=>e??void 0),warning:Lr(void 0),handleInlineCompletionShown:Lr(()=>{})},kl(this,{syntaxHighlightingEnabled:!0,extraClasses:[`inline-edit`]}),!0,!0)),this.isHovered=this._ghostTextView.isHovered,this._register(this._ghostTextView.onDidClick(e=>{this._onDidClick.fire(e)})),this._register(this._editorObs.createOverlayWidget({domNode:this._view.element,position:Lr(null),allowEditorOverflow:!1,minContentWidthInPx:O(this,e=>{let t=this._overlayLayout.read(e);return t===null?0:t.minContentWidthRequired})}))}};Pj=Oj([kj(3,k),kj(4,wt)],Pj);var Fj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ij=function(e,t){return function(n,r){t(n,r,e)}},Lj=class extends x{constructor(e,t,n,r,i,a){super(),this._editor=e,this._edit=t,this._isInDiffEditor=n,this._tabAction=r,this._languageService=i,this._themeService=a,this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._maxPrefixTrim=this._edit.map(e=>e?IA(e.replacements.flatMap(e=>[e.originalRange,e.modifiedRange]),e.originalRange,e.modifiedLines,this._editor.editor):void 0),this._modifiedLineElements=O(this,e=>{let t=[],n=0,r=this._maxPrefixTrim.read(e),i=this._edit.read(e);if(!i||!r)return;let a=r.prefixTrim,o=Rj(i.replacements.map(e=>e.modifiedRange)).map(e=>new T(e.startLineNumber,e.startColumn-a,e.endLineNumber,e.endColumn-a)),s=this._editor.model.get(),c=i.modifiedRange.startLineNumber;for(let r=0;r<i.modifiedRange.length;r++){let l=document.createElement(`div`),u=c+r,d=i.modifiedLines[r].slice(a),f=s.tokenization.tokenizeLinesAt(u,[d])?.[0],p;p=f?jl.fromLineTokens(f).toLineTokens(d,this._languageService.languageIdCodec):zc.createEmpty(d,this._languageService.languageIdCodec);let m=[];for(let e of o.filter(e=>e.startLineNumber===u)){let t=Math.min(e.endColumn,d.length+1);m.push(new fs(new T(1,e.startColumn,1,t),`inlineCompletions-modified-bubble`,0))}let h=Vt(new dr([p]),at.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),m,l,!0);this._editor.getOption(59).read(e),n=Math.max(n,h.minWidthInPx),t.push(l)}return{lines:t,requiredWidth:n}}),this._layout=O(this,e=>{let t=this._modifiedLineElements.read(e),n=this._maxPrefixTrim.read(e),r=this._edit.read(e);if(!t||!n||!r)return;let{prefixLeftOffset:i}=n,{requiredWidth:a}=t,o=this._editor.observeLineHeightsForLineRange(r.originalRange).read(e),s=(()=>{let e=o.slice(0,r.modifiedRange.length);for(;e.length<r.modifiedRange.length;)e.push(o[o.length-1]);return e})(),c=this._editor.layoutInfoContentLeft.read(e),l=this._editor.layoutInfoVerticalScrollbarWidth.read(e),u=this._editor.scrollLeft.read(e),d=this._editor.scrollTop.read(e),f=c-u,p=this._editor.editor.getModel(),m=r.originalRange.mapToLineArray(e=>this._editor.editor.getOffsetForColumn(e,p.getLineMaxColumn(e))-i),h=Math.max(...m,a),g=r.originalRange.startLineNumber,_=r.originalRange.endLineNumberExclusive-1,ee=this._editor.editor.getTopForLineNumber(g)-d,v=this._editor.editor.getBottomForLineNumber(_)-d,te=Pk.fromLeftTopWidthHeight(f+i,ee,h,v-ee),y=Pk.fromLeftTopWidthHeight(te.left,te.bottom,te.width,s.reduce((e,t)=>e+t,0)),b=Pk.hull([te,y]),ne=b.intersectVertical(new ac(te.bottom,2**53-1)),re=new Pk(ne.left,ne.top,ne.right,ne.bottom);return{originalLinesOverlay:te,modifiedLinesOverlay:y,background:b,lowerBackground:ne,lowerText:re,modifiedLineHeights:s,minContentWidthRequired:i+h+l}}),this._viewZoneInfo=O(e=>{if(!this._editor.getOption(71).map(e=>e.edits.allowCodeShifting===`always`).read(e))return;let t=this._layout.read(e),n=this._edit.read(e);if(!t||!n)return;let r=t.lowerBackground.height,i=n.originalRange.endLineNumberExclusive;return{height:r,lineNumber:i}}),this.minEditorScrollHeight=O(this,e=>{let t=KA(this._layout).read(e);return!t||this._viewZoneInfo.read(e)!==void 0?0:t.read(e).lowerText.bottom+this._editor.editor.getScrollTop()}),this._div=w.div({class:`line-replacement`},[O(this,e=>{let t=KA(this._layout).read(e),n=this._modifiedLineElements.read(e);if(!t||!n)return[];let r=t.read(e),i=this._editor.layoutInfoContentLeft.read(e),a=this._isInDiffEditor.read(e)?3:1;n.lines.forEach((e,t)=>{e.style.width=`${r.lowerText.width}px`,e.style.height=`${r.modifiedLineHeights[t]}px`,e.style.position=`relative`});let o=AA(this._tabAction).read(e),s=jA(this._tabAction).read(e);return[w.div({style:{position:`absolute`,...qA(e=>RA(this._editor).read(e)),overflow:`hidden`,pointerEvents:`none`}},[w.div({class:`borderAroundLineReplacement`,style:{position:`absolute`,...qA(e=>t.read(e).background.translateX(-i).withMargin(a)),borderRadius:`4px`,border:`${a+1}px solid ${A(Jl)}`,boxSizing:`border-box`,pointerEvents:`none`}}),w.div({class:`originalOverlayLineReplacement`,style:{position:`absolute`,...qA(e=>t.read(e).background.translateX(-i)),borderRadius:`4px`,border:MA(s,this._themeService).map(e=>`1px solid ${e.toString()}`),pointerEvents:`none`,boxSizing:`border-box`,background:A(dA)}}),w.div({class:`modifiedOverlayLineReplacement`,style:{position:`absolute`,...qA(e=>t.read(e).lowerBackground.translateX(-i)),borderRadius:`0 0 4px 4px`,background:A(Jl),boxShadow:`${A(Vs)} 0 6px 6px -6px`,border:`1px solid ${A(o)}`,boxSizing:`border-box`,overflow:`hidden`,cursor:`pointer`,pointerEvents:`auto`},onmousedown:e=>{e.preventDefault()},onclick:e=>this._onDidClick.fire(new Gs(eo(e),e))},[w.div({style:{position:`absolute`,top:0,left:0,width:`100%`,height:`100%`,background:A(mA)}})]),w.div({class:`modifiedLinesLineReplacement`,style:{position:`absolute`,boxSizing:`border-box`,...qA(e=>t.read(e).lowerText.translateX(-i)),fontFamily:this._editor.getOption(58),fontSize:this._editor.getOption(61),fontWeight:this._editor.getOption(62),pointerEvents:`none`,whiteSpace:`nowrap`,borderRadius:`0 0 4px 4px`,overflow:`hidden`}},[...n.lines])])]})]).keepUpdated(this._store),this.isHovered=this._editor.isTargetHovered(e=>this._isMouseOverWidget(e),this._store),this._previousViewZoneInfo=void 0,this._register(Cl(()=>this._editor.editor.changeViewZones(e=>this.removePreviousViewZone(e)))),this._register(Lo(this._viewZoneInfo,({lastValue:e,newValue:t})=>{e===t||e?.height===t?.height&&e?.lineNumber===t?.lineNumber||this._editor.editor.changeViewZones(e=>{this.removePreviousViewZone(e),t&&this.addViewZone(t,e)})})),this._register(this._editor.createOverlayWidget({domNode:this._div.element,minContentWidthInPx:O(this,e=>this._layout.read(e)?.minContentWidthRequired??0),position:Lr({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}_isMouseOverWidget(e){let t=this._layout.get();return!t||!(e.event instanceof Fn)?!1:t.lowerBackground.containsPoint(new jn(e.event.relativePos.x,e.event.relativePos.y))}removePreviousViewZone(e){if(!this._previousViewZoneInfo)return;e.removeZone(this._previousViewZoneInfo.id);let t=this._editor.cursorLineNumber.get();t!==null&&t>=this._previousViewZoneInfo.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()-this._previousViewZoneInfo.height),this._previousViewZoneInfo=void 0}addViewZone(e,t){let n=t.addZone({afterLineNumber:e.lineNumber-1,heightInPx:e.height,domNode:b(`div`)});this._previousViewZoneInfo={height:e.height,lineNumber:e.lineNumber,id:n};let r=this._editor.cursorLineNumber.get();r!==null&&r>=e.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()+e.height)}};Lj=Fj([Ij(4,wt),Ij(5,pa)],Lj);function Rj(e){let t=[];for(;e.length;){let n=e.shift();n.startLineNumber!==n.endLineNumber&&(e.push(new T(n.startLineNumber+1,1,n.endLineNumber,n.endColumn)),n=new T(n.startLineNumber,n.startColumn,n.startLineNumber,2**53-1)),t.push(n)}return t}var zj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Bj=function(e,t){return function(n,r){t(n,r,e)}},Vj=0,Hj=0,Uj=1,Wj=1,Gj=3,Kj=4,qj=20,Jj=12,Yj=class extends x{static fitsInsideViewport(e,t,n,r){let i=Bs(e),a=i.layoutInfoWidth.read(r),o=i.layoutInfoContentLeft.read(r),s=e.getLayoutInfo().verticalScrollbarWidth,c=i.layoutInfoMinimap.read(r).minimapLeft===0?0:i.layoutInfoMinimap.read(r).minimapWidth,l=PA(i,n.displayRange,void 0),u=n.lineEdit.newLines.reduce((n,r)=>Math.max(n,LA(r,e,t)),0),d=qj,f=Jj+2*Uj;return l+u+d+f<a-o-s-c}constructor(e,t,n,r,i,a,o){super(),this._editor=e,this._edit=t,this._previewTextModel=n,this._uiState=r,this._tabAction=i,this._instantiationService=a,this._themeService=o,this._editorObs=Bs(this._editor),this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._display=O(this,e=>this._uiState.read(e)?`block`:`none`),this.previewRef=w.ref();let s=this._uiState.map(e=>e?.isInDiffEditor?Gj:Wj);this._editorContainer=w.div({class:[`editorContainer`],style:{position:`absolute`,overflow:`hidden`,cursor:`pointer`},onmousedown:e=>{e.preventDefault()},onclick:e=>{this._onDidClick.fire(new Gs(eo(e),e))}},[w.div({class:`preview`,style:{pointerEvents:`none`},ref:this.previewRef})]).keepUpdated(this._store),this.isHovered=this._editorContainer.didMouseMoveDuringHover,this.previewEditor=this._register(this._instantiationService.createInstance(sy,this.previewRef.element,{glyphMargin:!1,lineNumbers:`off`,minimap:{enabled:!1},guides:{indentation:!1,bracketPairs:!1,bracketPairsHorizontal:!1,highlightActiveIndentation:!1},rulers:[],padding:{top:0,bottom:0},folding:!1,selectOnLineNumbers:!1,selectionHighlight:!1,columnSelection:!1,overviewRulerBorder:!1,overviewRulerLanes:0,lineDecorationsWidth:0,lineNumbersMinChars:0,revealHorizontalRightPadding:0,bracketPairColorization:{enabled:!0,independentColorPoolPerBracketType:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:`hidden`,horizontal:`hidden`,handleMouseWheel:!1},readOnly:!0,wordWrap:`off`,wordWrapOverride1:`off`,wordWrapOverride2:`off`},{contextKeyValues:{[GT.inInlineEditsPreviewEditor.key]:!0},contributions:[]},this._editor)),this._previewEditorObs=Bs(this.previewEditor),this._activeViewZones=[],this._updatePreviewEditor=O(this,e=>{this._editorContainer.readEffect(e),this._previewEditorObs.model.read(e),this._display.read(e),this._nonOverflowView&&(this._nonOverflowView.element.style.display=this._display.read(e));let t=this._uiState.read(e),n=this._edit.read(e);if(!t||!n)return;let r=n.originalLineRange,i=[];r.startLineNumber>1&&i.push(new T(1,1,r.startLineNumber-1,1)),r.startLineNumber+t.newTextLineCount<this._previewTextModel.getLineCount()+1&&i.push(new T(r.startLineNumber+t.newTextLineCount,1,this._previewTextModel.getLineCount()+1,1)),this.previewEditor.setHiddenAreas(i,void 0,!0);let a=[...this._activeViewZones];this._activeViewZones=[];let o=r.endLineNumberExclusive-r.startLineNumber-t.newTextLineCount;this.previewEditor.changeViewZones(e=>{a.forEach(t=>e.removeZone(t)),o>0&&this._activeViewZones.push(e.addZone({afterLineNumber:r.startLineNumber+t.newTextLineCount-1,heightInLines:o,showInHiddenAreas:!0,domNode:b(`div.diagonal-fill.inline-edits-view-zone`)}))})}),this._previewEditorWidth=O(this,e=>{let t=this._edit.read(e);return t?(this._updatePreviewEditor.read(e),PA(this._previewEditorObs,t.modifiedLineRange,e)):0}),this._cursorPosIfTouchesEdit=O(this,e=>{let t=this._editorObs.cursorPosition.read(e),n=this._edit.read(e);if(!(!n||!t))return n.modifiedLineRange.contains(t.lineNumber)?t:void 0}),this._originalStartPosition=O(this,e=>{let t=this._edit.read(e);return t?new C(t.originalLineRange.startLineNumber,1):null}),this._originalEndPosition=O(this,e=>{let t=this._edit.read(e);return t?new C(t.originalLineRange.endLineNumberExclusive,1):null}),this._originalVerticalStartPosition=this._editorObs.observePosition(this._originalStartPosition,this._store).map(e=>e?.y),this._originalVerticalEndPosition=this._editorObs.observePosition(this._originalEndPosition,this._store).map(e=>e?.y),this._originalDisplayRange=this._edit.map(e=>e?.displayRange),this._editorMaxContentWidthInRange=O(this,e=>{let t=this._originalDisplayRange.read(e);return t?(this._editorObs.versionId.read(e),Oi(this,(e,n)=>{let r=PA(this._editorObs,t,e);return Math.max(r,n??0)})):Lr(0)}).map((e,t)=>e.read(t)),this._previewEditorLayoutInfo=O(this,e=>{let t=this._edit.read(e);if(!t||!this._uiState.read(e))return null;let n=t.originalLineRange,r=this._editorObs.scrollLeft.read(e),i=this._editorMaxContentWidthInRange.read(e),a=this._editorObs.layoutInfo.read(e),o=this._previewEditorWidth.read(e),s=a.contentWidth-a.verticalScrollbarWidth,c=this._editor.getContainerDomNode().getBoundingClientRect(),l=a.contentLeft+a.contentWidth+c.left,u=eo(this._editor.getContainerDomNode()).innerWidth-l,d=eo(this._editor.getContainerDomNode()).innerWidth-c.right,f=Math.min(a.contentWidth*.3,o,100),p=0+u,m=this._cursorPosIfTouchesEdit.read(e),h=Math.max(s+r-0-Math.max(0,f-p),Math.min(m?FA(this._editorObs,m,e)+50:0,s+r)),g=Math.min(i+qj,h),_=i+qj+o+70,ee=h-g,v,te;g>r?(v=0,te=a.contentLeft+g-r):(v=r-g,te=a.contentLeft);let y=this._originalVerticalStartPosition.read(e)??this._editor.getTopForLineNumber(n.startLineNumber)-this._editorObs.scrollTop.read(e),b=this._originalVerticalEndPosition.read(e)??this._editor.getBottomForLineNumber(n.endLineNumberExclusive-1)-this._editorObs.scrollTop.read(e),ne=a.contentLeft-r,re=Pk.fromLeftTopRightBottom(ne,y,te,b),ie=re.height===0;ie||(re=re.withMargin(Hj,Vj));let ae=this._previewEditorObs.observeLineHeightsForLineRange(t.modifiedLineRange).read(e).reduce((e,t)=>e+t,0),oe=b-y,se=Math.max(oe,ae),ce=ee===0,le=Math.min(o+Jj,d+a.width-a.contentLeft-0),ue=Pk.fromLeftTopWidthHeight(re.right+0,y,le,se);return ue=ie?ue.withMargin(Hj,Vj).translateY(Hj):ue.withMargin(Hj,Vj).translateX(Vj+Uj),{codeRect:re,editRect:ue,codeScrollLeft:r,contentLeft:a.contentLeft,isInsertion:ie,maxContentWidth:_,shouldShowShadow:ce,desiredPreviewEditorScrollLeft:v,previewEditorWidth:le}}),this._stickyScrollController=uA.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?yt(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):Lr(0),this._shouldOverflow=O(this,e=>!1),this._originalBackgroundColor=yt(this,this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme().getColor(dA)??V.transparent),this._backgroundSvg=w.svg({transform:`translate(-0.5 -0.5)`,style:{overflow:`visible`,pointerEvents:`none`,position:`absolute`}},[w.svgElem(`path`,{class:`rightOfModifiedBackgroundCoverUp`,d:O(this,e=>{let t=this._previewEditorLayoutInfo.read(e);if(t&&!this._originalBackgroundColor.read(e).isTransparent())return new GA().moveTo(t.codeRect.getRightTop()).lineTo(t.codeRect.getRightTop().deltaX(1e3)).lineTo(t.codeRect.getRightBottom().deltaX(1e3)).lineTo(t.codeRect.getRightBottom()).build()}),style:{fill:Ir(Jl,`transparent`)}})]).keepUpdated(this._store),this._originalOverlay=w.div({style:{pointerEvents:`none`,display:this._previewEditorLayoutInfo.map(e=>e?.isInsertion?`none`:`block`)}},O(this,e=>{let t=KA(this._previewEditorLayoutInfo).read(e);if(!t)return;let n=s.read(e),r=jA(this._tabAction).map(e=>`${Uj}px solid ${A(e)}`),i=`${Uj+n}px solid ${A(Jl)}`,a=t.read(e).codeScrollLeft!==0,o=t.map(e=>e.codeRect.bottom<e.editRect.bottom),c=Kj*2+Uj*2,l=t.map(e=>Pk.fromLeftTopRightBottom(e.contentLeft-Kj-Uj,e.codeRect.top,e.contentLeft,e.codeRect.bottom+c)).read(e),u=new ac(l.left,2**53-1),d=t.map(e=>e.codeRect.intersectHorizontal(u)),f=d.map(e=>e.withMargin(n,0,n,n).intersectHorizontal(u)),p=d.map(e=>Pk.fromLeftTopWidthHeight(e.right-c+Uj,e.bottom-Uj,c,c).intersectHorizontal(u));return[w.div({class:`originalSeparatorSideBySide`,style:{...f.read(e).toStyles(),boxSizing:`border-box`,borderRadius:`${Kj}px 0 0 ${Kj}px`,borderTop:i,borderBottom:i,borderLeft:a?`none`:i}}),w.div({class:`originalOverlaySideBySide`,style:{...d.read(e).toStyles(),boxSizing:`border-box`,borderRadius:`${Kj}px 0 0 ${Kj}px`,borderTop:r,borderBottom:r,borderLeft:a?`none`:r,backgroundColor:A(dA)}}),w.div({class:`originalCornerCutoutSideBySide`,style:{pointerEvents:`none`,display:o.map(e=>e?`block`:`none`),...p.read(e).toStyles()}},[w.div({class:`originalCornerCutoutBackground`,style:{position:`absolute`,top:`0px`,left:`0px`,width:`100%`,height:`100%`,backgroundColor:MA(dA,this._themeService).map(e=>e.toString())}}),w.div({class:`originalCornerCutoutBorder`,style:{position:`absolute`,top:`0px`,left:`0px`,width:`100%`,height:`100%`,boxSizing:`border-box`,borderTop:r,borderRight:r,borderRadius:`0 100% 0 0`,backgroundColor:A(Jl)}})]),w.div({class:`originalOverlaySideBySideHider`,style:{...l.toStyles(),backgroundColor:A(Jl)}})]})).keepUpdated(this._store),this._modifiedOverlay=w.div({style:{pointerEvents:`none`}},O(this,e=>{let t=KA(this._previewEditorLayoutInfo).read(e);if(!t)return;let n=t.map(e=>e.codeRect.bottom<e.editRect.bottom),r=s.read(e),i=n.map(e=>`0 ${Kj}px ${Kj}px ${e?Kj:0}px`),a=MA(AA(this._tabAction),this._themeService).map(e=>`1px solid ${e.toString()}`),o=`${Uj+r}px solid ${A(Jl)}`,c=t.map(e=>e.editRect.withMargin(0,Uj)),l=c.map(e=>e.withMargin(r,r,r,0)),u=O(this,e=>{let n=c.read(e),r=t.read(e);return!r.isInsertion||r.contentLeft>=n.left?Pk.fromLeftTopWidthHeight(n.left,n.top,0,0):new Pk(r.contentLeft,n.top,n.left,n.top+Uj*2)});return[w.div({class:`modifiedInsertionSideBySide`,style:{...u.read(e).toStyles(),backgroundColor:AA(this._tabAction).map(e=>A(e))}}),w.div({class:`modifiedSeparatorSideBySide`,style:{...l.read(e).toStyles(),borderRadius:i,borderTop:o,borderBottom:o,borderRight:o,boxSizing:`border-box`}}),w.div({class:`modifiedOverlaySideBySide`,style:{...c.read(e).toStyles(),borderRadius:i,border:a,boxSizing:`border-box`,backgroundColor:A(fA)}})]})).keepUpdated(this._store),this._nonOverflowView=w.div({class:`inline-edits-view`,style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`,display:this._display}},[this._backgroundSvg,O(this,e=>this._shouldOverflow.read(e)?[]:[this._editorContainer,this._originalOverlay,this._modifiedOverlay])]).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:Lr(null),allowEditorOverflow:!1,minContentWidthInPx:O(this,e=>{let t=this._previewEditorLayoutInfo.read(e)?.maxContentWidth;return t===void 0?0:t})})),this.previewEditor.setModel(this._previewTextModel),this._register(g(e=>{let t=this._previewEditorLayoutInfo.read(e);if(!t)return;let n=t.editRect.withMargin(-Hj,-Vj);this.previewEditor.layout({height:n.height,width:t.previewEditorWidth+15}),this._editorContainer.element.style.top=`${n.top}px`,this._editorContainer.element.style.left=`${n.left}px`,this._editorContainer.element.style.width=`${t.previewEditorWidth+Vj}px`})),this._register(g(e=>{let t=this._previewEditorLayoutInfo.read(e);t&&this._previewEditorObs.editor.setScrollLeft(t.desiredPreviewEditorScrollLeft)})),this._updatePreviewEditor.recomputeInitiallyAndOnChange(this._store)}};Yj=zj([Bj(5,k),Bj(6,pa)],Yj);var Xj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Zj=function(e,t){return function(n,r){t(n,r,e)}},Qj=1,$j=class extends x{static{this.MAX_LENGTH=100}constructor(e,t,n,r){super(),this._editor=e,this._edit=t,this._tabAction=n,this._languageService=r,this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this._start=this._editor.observePosition(Lr(this._edit.range.getStartPosition()),this._store),this._end=this._editor.observePosition(Lr(this._edit.range.getEndPosition()),this._store),this._line=document.createElement(`div`),this._hoverableElement=kl(this,null),this.isHovered=this._hoverableElement.map((e,t)=>e?.didMouseMoveDuringHover.read(t)??!1),this._renderTextEffect=O(this,e=>{let t=this._editor.model.get(),n=t.getLineContent(this._edit.range.startLineNumber),r=yr.replace(new ac(this._edit.range.startColumn-1,this._edit.range.endColumn-1),this._edit.text),i=r.replace(n),a=t.tokenization.tokenizeLinesAt(this._edit.range.startLineNumber,[i])?.[0],o;o=a?jl.fromLineTokens(a).slice(r.getRangeAfterReplace()).toLineTokens(this._edit.text,this._languageService.languageIdCodec):zc.createEmpty(this._edit.text,this._languageService.languageIdCodec);let s=Vt(new dr([o]),at.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],this._line,!0);this._line.style.width=`${s.minWidthInPx}px`});let i=this._editor.observeLineHeightForPosition(this._edit.range.getStartPosition());this._layout=O(this,e=>{this._renderTextEffect.read(e);let t=this._start.read(e),n=this._end.read(e);if(!t||!n||t.x>n.x||t.y>n.y)return;let r=i.read(e),a=this._editor.scrollLeft.read(e),o=this._editor.getOption(59).read(e).typicalHalfwidthCharacterWidth,s=3*o,c=new jn(s,4),l=Pk.fromPoints(t,n).withHeight(r).translateX(-a),u=Pk.fromPointSize(l.getLeftBottom().add(c),new jn(this._edit.text.length*o,l.height)),d=u.withLeft(l.left);return{originalLine:l,modifiedLine:u,lowerBackground:d,lineHeight:r}}),this.minEditorScrollHeight=O(this,e=>{let t=KA(this._layout).read(e);return t?t.read(e).modifiedLine.bottom+Qj+this._editor.editor.getScrollTop():0}),this._root=w.div({class:`word-replacement`},[O(this,e=>{let t=KA(this._layout).read(e);if(!t)return[];let n=jA(this._tabAction).map(e=>A(e)).read(e),r=AA(this._tabAction).map(e=>A(e)).read(e);return[w.div({style:{position:`absolute`,...qA(e=>RA(this._editor).read(e)),overflow:`hidden`,pointerEvents:`none`}},[w.div({style:{position:`absolute`,...qA(e=>t.read(e).lowerBackground.withMargin(Qj,2*Qj,Qj,0)),background:A(Jl),cursor:`pointer`,pointerEvents:`auto`},onmousedown:e=>{e.preventDefault()},onmouseup:e=>this._onDidClick.fire(new Gs(eo(e),e)),obsRef:e=>{this._hoverableElement.set(e,void 0)}}),w.div({style:{position:`absolute`,...qA(e=>t.read(e).modifiedLine.withMargin(Qj,2*Qj)),fontFamily:this._editor.getOption(58),fontSize:this._editor.getOption(61),fontWeight:this._editor.getOption(62),pointerEvents:`none`,boxSizing:`border-box`,borderRadius:`4px`,border:`${Qj}px solid ${r}`,background:A(hA),display:`flex`,justifyContent:`center`,alignItems:`center`,outline:`2px solid ${A(Jl)}`}},[this._line]),w.div({style:{position:`absolute`,...qA(e=>t.read(e).originalLine.withMargin(Qj)),boxSizing:`border-box`,borderRadius:`4px`,border:`${Qj}px solid ${n}`,background:A(pA),pointerEvents:`none`}},[]),w.svg({width:11,height:14,viewBox:`0 0 11 14`,fill:`none`,style:{position:`absolute`,left:t.map(e=>e.modifiedLine.left-16),top:t.map(e=>e.modifiedLine.top+Math.round((e.lineHeight-14-5)/2))}},[w.svgElem(`path`,{d:`M1 0C1 2.98966 1 5.92087 1 8.49952C1 9.60409 1.89543 10.5 3 10.5H10.5`,stroke:A(Go)}),w.svgElem(`path`,{d:`M6 7.5L9.99999 10.49998L6 13.5`,stroke:A(Go)})])])]})]).keepUpdated(this._store),this._register(this._editor.createOverlayWidget({domNode:this._root.element,minContentWidthInPx:Lr(0),position:Lr({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}};$j=Xj([Zj(3,wt)],$j);var eM=class extends x{constructor(e,t,n){super(),this._originalEditor=e,this._state=t,this._modifiedTextModel=n,this._onDidClick=this._register(new D),this.onDidClick=this._onDidClick.event,this.isHovered=Bs(this._originalEditor).isTargetHovered(e=>e.target.type===6&&e.target.detail.injectedText?.options.attachedData instanceof tM&&e.target.detail.injectedText.options.attachedData.owner===this,this._store),this._tokenizationFinished=iM(this._modifiedTextModel),this._decorations=O(this,e=>{let t=this._state.read(e);if(!t)return;let n=t.modifiedText,r=t.mode===`insertionInline`,i=t.diff.length===1&&t.diff[0].innerChanges?.length===1,a=[],o=[],s=Y.register({className:`inlineCompletions-line-insert`,description:`line-insert`,isWholeLine:!0,marginClassName:`gutter-insert`}),c=Y.register({className:`inlineCompletions-line-delete`,description:`line-delete`,isWholeLine:!0,marginClassName:`gutter-delete`}),l=Y.register({className:`inlineCompletions-char-delete`,description:`char-delete`,isWholeLine:!1,zIndex:1}),u=Y.register({className:`inlineCompletions-char-insert`,description:`char-insert`,isWholeLine:!0}),d=Y.register({className:`inlineCompletions-char-insert`,description:`char-insert`,shouldFillLineOnLineBreak:!0}),f=Y.register({className:`inlineCompletions-char-insert diff-range-empty`,description:`char-insert diff-range-empty`}),p=Y.register({className:`inlineCompletions-original-lines`,description:`inlineCompletions-original-lines`,isWholeLine:!1,shouldFillLineOnLineBreak:!0}),m=t.mode!==`sideBySide`&&t.mode!==`deletion`&&t.mode!==`insertionInline`&&t.mode!==`lineReplacement`,h=t.mode===`lineReplacement`;for(let p of t.diff)if(m&&(p.original.isEmpty||a.push({range:p.original.toInclusiveRange(),options:c}),p.modified.isEmpty||o.push({range:p.modified.toInclusiveRange(),options:s})),p.modified.isEmpty||p.original.isEmpty)p.original.isEmpty||a.push({range:p.original.toInclusiveRange(),options:l}),p.modified.isEmpty||o.push({range:p.modified.toInclusiveRange(),options:u});else{let s=r&&nM(p);for(let r of p.innerChanges||[]){if(p.original.contains(r.originalRange.startLineNumber)&&!(h&&r.originalRange.isEmpty())){let e=this._originalEditor.getModel()?.getValueInRange(r.originalRange,1);a.push({range:r.originalRange,options:{description:`char-delete`,shouldFillLineOnLineBreak:!1,className:BA(`inlineCompletions-char-delete`,r.originalRange.isSingleLine()&&t.mode===`insertionInline`&&`single-line-inline`,r.originalRange.isEmpty()&&`empty`,(r.originalRange.isEmpty()&&i||t.mode===`deletion`&&e===`
`)&&!s&&`diff-range-empty`),inlineClassName:s?BA(`strike-through`,`inlineCompletions`):null,zIndex:1}})}if(p.modified.contains(r.modifiedRange.startLineNumber)&&o.push({range:r.modifiedRange,options:r.modifiedRange.isEmpty()&&!s&&i?f:d}),s){let i=n.getValueOfRange(r.modifiedRange),o=i.length>3?[{text:i.slice(0,1),extraClasses:[`start`],offsetRange:new ac(r.modifiedRange.startColumn-1,r.modifiedRange.startColumn)},{text:i.slice(1,-1),extraClasses:[],offsetRange:new ac(r.modifiedRange.startColumn,r.modifiedRange.endColumn-2)},{text:i.slice(-1),extraClasses:[`end`],offsetRange:new ac(r.modifiedRange.endColumn-2,r.modifiedRange.endColumn-1)}]:[{text:i,extraClasses:[`start`,`end`],offsetRange:new ac(r.modifiedRange.startColumn-1,r.modifiedRange.endColumn)}];this._tokenizationFinished.read(e);let s=this._modifiedTextModel.tokenization.getLineTokens(r.modifiedRange.startLineNumber);for(let{text:e,extraClasses:n,offsetRange:i}of o)a.push({range:T.fromPositions(r.originalRange.getEndPosition()),options:{description:`inserted-text`,before:{tokens:s.getTokensInRange(i),content:e,inlineClassName:BA(`inlineCompletions-char-insert`,r.modifiedRange.isSingleLine()&&t.mode===`insertionInline`&&`single-line-inline`,...n),cursorStops:Yn.None,attachedData:new tM(this)},zIndex:2,showIfCollapsed:!0}})}}}if(t.isInDiffEditor)for(let e of t.diff)e.original.isEmpty||a.push({range:e.original.toExclusiveRange(),options:p});return{originalDecorations:a,modifiedDecorations:o}}),this._register(Bs(this._originalEditor).setDecorations(this._decorations.map(e=>e?.originalDecorations??[])));let r=this._state.map(e=>e?.modifiedCodeEditor);this._register(Ql((e,t)=>{let n=r.read(e);n&&t.add(Bs(n).setDecorations(this._decorations.map(e=>e?.modifiedDecorations??[])))})),this._register(this._originalEditor.onMouseUp(e=>{if(e.target.type!==6)return;let t=e.target.detail.injectedText?.options.attachedData;t instanceof tM&&t.owner===this&&this._onDidClick.fire(e.event)}))}},tM=class{constructor(e){this.owner=e}};function nM(e){return e.innerChanges?e.innerChanges.every(e=>Hn(e.modifiedRange)&&Hn(e.originalRange)):!1}var rM=0;function iM(e){return yt(e.onDidChangeTokens,()=>rM++)}var aM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},oM=function(e,t){return function(n,r){t(n,r,e)}},sM=class extends x{constructor(e,t,n,r,i,a){super(),this._editor=e,this._host=t,this._model=n,this._ghostTextIndicator=r,this._focusIsInMenu=i,this._instantiationService=a,this._editorObs=Bs(this._editor),this._tabAction=O(e=>this._model.read(e)?.tabAction.read(e)??SD.Inactive),this._constructorDone=kl(this,!1),this._uiState=O(this,e=>{let t=this._model.read(e);if(!t||!this._constructorDone.read(e))return;let n=t.inlineEdit,r=Cs.fromEdit(n.edit),i=n.edit.apply(n.originalText),a=ds(r,n.originalText,new nd(i)),o=this.determineRenderState(t,e,a,new nd(i));if(!o){t.abort(`unable to determine view: tried to render ${this._previousView?.view}`);return}if(o.kind===Q.SideBySide){let e=WA(i,n.modifiedLineRange,s.getOptions().tabSize);i=e.applyToString(i),r=zA(r,e),a=ds(r,n.originalText,new nd(i))}return this._previewTextModel.setLanguage(this._editor.getModel().getLanguageId()),this._previewTextModel.getValue()!==i&&this._previewTextModel.setValue(i),t.showCollapsed.read(e)&&!this._indicator.read(e)?.isHoverVisible.read(e)&&(o={kind:Q.Collapsed,viewData:o.viewData}),t.handleInlineEditShown(o.kind,o.viewData),{state:o,diff:a,edit:n,newText:i,newTextLineCount:n.modifiedLineRange.length,isInDiffEditor:t.isInDiffEditor}}),this._previewTextModel=this._register(this._instantiationService.createInstance(rd,``,this._editor.getModel().getLanguageId(),{...rd.DEFAULT_CREATION_OPTIONS,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}},null)),this._indicatorCyclicDependencyCircuitBreaker=kl(this,!1),this._indicator=O(this,e=>{if(!this._indicatorCyclicDependencyCircuitBreaker.read(e))return;let t=ya({owner:this,equalsFn:ho(hc())},e=>{let t=this._ghostTextIndicator.read(e);if(t)return t.lineRange;let n=this._uiState.read(e);if(n){if(n.state?.kind===`custom`){let e=n.state.displayLocation?.range;if(!e)throw new se(`custom view should have a range`);return new $r(e.startLineNumber,e.endLineNumber)}return n.state?.kind===`insertionMultiLine`?this._insertion.originalLines.read(e):n.edit.displayRange}}),n=O(this,e=>{let t=this._model.read(e);if(t)return t;let n=this._ghostTextIndicator.read(e);return n?n.model:t});return e.store.add(this._instantiationService.createInstance(ij,this._editorObs,t,this._gutterIndicatorOffset,n,this._inlineEditsIsHovered,this._focusIsInMenu))}),this._inlineEditsIsHovered=O(this,e=>this._sideBySide.isHovered.read(e)||this._wordReplacementViews.read(e).some(t=>t.isHovered.read(e))||this._deletion.isHovered.read(e)||this._inlineDiffView.isHovered.read(e)||this._lineReplacementView.isHovered.read(e)||this._insertion.isHovered.read(e)||this._customView.isHovered.read(e)),this._gutterIndicatorOffset=O(this,e=>{if(this._uiState.read(e)?.state?.kind===`insertionMultiLine`)return this._insertion.startLineOffset.read(e);let t=this._ghostTextIndicator.read(e);return t?hM(t,this._editor):0}),this._sideBySide=this._register(this._instantiationService.createInstance(Yj,this._editor,this._model.map(e=>e?.inlineEdit),this._previewTextModel,this._uiState.map(e=>e&&e.state?.kind===Q.SideBySide?{newTextLineCount:e.newTextLineCount,isInDiffEditor:e.isInDiffEditor}:void 0),this._tabAction)),this._deletion=this._register(this._instantiationService.createInstance(Dj,this._editor,this._model.map(e=>e?.inlineEdit),this._uiState.map(e=>e&&e.state?.kind===Q.Deletion?{originalRange:e.state.originalRange,deletions:e.state.deletions,inDiffEditor:e.isInDiffEditor}:void 0),this._tabAction)),this._insertion=this._register(this._instantiationService.createInstance(Pj,this._editor,this._uiState.map(e=>e&&e.state?.kind===Q.InsertionMultiLine?{lineNumber:e.state.lineNumber,startColumn:e.state.column,text:e.state.text,inDiffEditor:e.isInDiffEditor}:void 0),this._tabAction)),this._inlineDiffViewState=O(this,e=>{let t=this._uiState.read(e);if(!(!t||!t.state)&&!(t.state.kind===`wordReplacements`||t.state.kind===`insertionMultiLine`||t.state.kind===`collapsed`||t.state.kind===`custom`))return{modifiedText:new nd(t.newText),diff:t.diff,mode:t.state.kind,modifiedCodeEditor:this._sideBySide.previewEditor,isInDiffEditor:t.isInDiffEditor}}),this._inlineCollapsedView=this._register(this._instantiationService.createInstance(fj,this._editor,this._model.map((e,t)=>this._uiState.read(t)?.state?.kind===`collapsed`?e?.inlineEdit:void 0))),this._customView=this._register(this._instantiationService.createInstance(bj,this._editor,this._model.map((e,t)=>this._uiState.read(t)?.state?.kind===`custom`?e?.displayLocation:void 0),this._tabAction)),this._inlineDiffView=this._register(new eM(this._editor,this._inlineDiffViewState,this._previewTextModel)),this._wordReplacementViews=jt(this,this._uiState.map(e=>e?.state?.kind===`wordReplacements`?e.state.replacements:[]),(e,t)=>t.add(this._instantiationService.createInstance($j,this._editorObs,e,this._tabAction))),this._lineReplacementView=this._register(this._instantiationService.createInstance(Lj,this._editorObs,this._uiState.map(e=>e?.state?.kind===Q.LineReplacement?{originalRange:e.state.originalRange,modifiedRange:e.state.modifiedRange,modifiedLines:e.state.modifiedLines,replacements:e.state.replacements}:void 0),this._uiState.map(e=>e?.isInDiffEditor??!1),this._tabAction)),this._useCodeShifting=this._editorObs.getOption(71).map(e=>e.edits.allowCodeShifting),this._renderSideBySide=this._editorObs.getOption(71).map(e=>e.edits.renderSideBySide),this._register(Ql((e,t)=>{let n=this._model.read(e);n&&t.add(An.any(this._sideBySide.onDidClick,this._deletion.onDidClick,this._lineReplacementView.onDidClick,this._insertion.onDidClick,...this._wordReplacementViews.read(e).map(e=>e.onDidClick),this._inlineDiffView.onDidClick,this._customView.onDidClick)(e=>{this._viewHasBeenShownLongerThan(350)&&(e.preventDefault(),n.accept())}))})),this._indicator.recomputeInitiallyAndOnChange(this._store),this._wordReplacementViews.recomputeInitiallyAndOnChange(this._store),this._indicatorCyclicDependencyCircuitBreaker.set(!0,void 0),this._register(this._instantiationService.createInstance(lj,this._host,this._model,this._indicator,this._inlineCollapsedView));let o=O(this,e=>Math.max(...this._wordReplacementViews.read(e).map(t=>t.minEditorScrollHeight.read(e)),this._lineReplacementView.minEditorScrollHeight.read(e),this._customView.minEditorScrollHeight.read(e))).recomputeInitiallyAndOnChange(this._store),s=this._editor.getModel(),c;this._register(g(e=>{let t=o.read(e);this._editor.changeViewZones(e=>{let n=this._editor.getScrollHeight(),r=t-n+1;r!==0&&c&&(e.removeZone(c),c=void 0),!(r<=0)&&(c=e.addZone({afterLineNumber:s.getLineCount(),heightInPx:r,domNode:b(`div.minScrollHeightViewZone`)}))})})),this._constructorDone.set(!0,void 0)}getCacheId(e){return e.inlineEdit.inlineCompletion.identity.id}determineView(e,t,n,r){let i=e.inlineEdit,a=this._previousView?.id===this.getCacheId(e),o=this._previousView?.editorWidth!==this._editorObs.layoutInfoWidth.read(t)&&(this._previousView?.view===Q.SideBySide||this._previousView?.view===Q.LineReplacement);if(a&&!o)return this._previousView.view;if(e.displayLocation)return Q.Custom;let s=i.originalLineRange.length,c=i.modifiedLineRange.length,l=n.flatMap(e=>e.innerChanges??[]),u=l.length===1;if(!e.isInDiffEditor){if(u&&this._useCodeShifting.read(t)!==`never`&&cM(n))return lM(n,i.cursorPosition)?Q.InsertionInline:Q.LineReplacement;if(dM(l,i,r))return Q.Deletion;if(uM(n)&&this._useCodeShifting.read(t)===`always`)return Q.InsertionMultiLine;if(l.every(e=>Wu.ofRange(e.originalRange).columnCount<$j.MAX_LENGTH&&Wu.ofRange(e.modifiedRange).columnCount<$j.MAX_LENGTH)&&u&&s===1&&c===1){let t=l.map(e=>r.getValueOfRange(e.modifiedRange)),n=l.map(t=>e.inlineEdit.originalText.getValueOfRange(t.originalRange));if(!t.some(e=>e.includes(`	`))&&!n.some(e=>e.includes(`	`))&&(!l.some(e=>e.originalRange.isEmpty())||!pM(l.map(e=>new Su(e.originalRange,``)),i.originalText).some(e=>e.range.isEmpty()&&Wu.ofRange(e.range).columnCount<$j.MAX_LENGTH)))return Q.WordReplacements}}if(s>0&&c>0)return s===1&&c===1&&!e.isInDiffEditor?Q.LineReplacement:this._renderSideBySide.read(t)!==`never`&&Yj.fitsInsideViewport(this._editor,this._previewTextModel,i,t)?Q.SideBySide:Q.LineReplacement;if(e.isInDiffEditor){if(dM(l,i,r))return Q.Deletion;if(uM(n)&&this._useCodeShifting.read(t)===`always`)return Q.InsertionMultiLine}return Q.SideBySide}determineRenderState(e,t,n,r){let i=e.inlineEdit,a=this.determineView(e,t,n,r);this._previousView={id:this.getCacheId(e),view:a,editorWidth:this._editor.getLayoutInfo().width,timestamp:Date.now()};let o=n.flatMap(e=>e.innerChanges??[]),s=this._editor.getModel(),c=o.map(e=>({originalRange:e.originalRange,modifiedRange:e.modifiedRange,original:s.getValueInRange(e.originalRange),modified:r.getValueOfRange(e.modifiedRange)})),l=i.cursorPosition,u=c[0].modified.startsWith(s.getEOL()),d={cursorColumnDistance:i.edit.replacements[0].range.getStartPosition().column-l.column,cursorLineDistance:i.lineEdit.lineRange.startLineNumber-l.lineNumber+(u&&i.lineEdit.lineRange.startLineNumber>=l.lineNumber?1:0),lineCountOriginal:i.lineEdit.lineRange.length,lineCountModified:i.lineEdit.newLines.length,characterCountOriginal:c.reduce((e,t)=>e+t.original.length,0),characterCountModified:c.reduce((e,t)=>e+t.modified.length,0),disjointReplacements:c.length,sameShapeReplacements:c.every(e=>e.original===c[0].original&&e.modified===c[0].modified)};switch(a){case Q.InsertionInline:return{kind:Q.InsertionInline,viewData:d};case Q.SideBySide:return{kind:Q.SideBySide,viewData:d};case Q.Collapsed:return{kind:Q.Collapsed,viewData:d};case Q.Custom:return{kind:Q.Custom,displayLocation:e.displayLocation,viewData:d}}if(a===Q.Deletion)return{kind:Q.Deletion,originalRange:i.originalLineRange,deletions:o.map(e=>e.originalRange),viewData:d};if(a===Q.InsertionMultiLine){let e=o[0];return{kind:Q.InsertionMultiLine,lineNumber:e.originalRange.startLineNumber,column:e.originalRange.startColumn,text:r.getValueOfRange(e.modifiedRange),viewData:d}}let f=c.map(e=>new Su(e.originalRange,e.modified));if(f.length!==0){if(a===Q.WordReplacements){let e=fM(f,i.originalText);return e.some(e=>e.range.isEmpty())&&(e=pM(f,i.originalText)),{kind:Q.WordReplacements,replacements:e,viewData:d}}if(a===Q.LineReplacement)return{kind:Q.LineReplacement,originalRange:i.originalLineRange,modifiedRange:i.modifiedLineRange,modifiedLines:i.modifiedLineRange.mapToLineArray(e=>r.getLineAt(e)),replacements:o.map(e=>({originalRange:e.originalRange,modifiedRange:e.modifiedRange})),viewData:d}}}_viewHasBeenShownLongerThan(e){let t=this._previousView?.timestamp;if(!t)throw new se(`viewHasBeenShownLongThan called before a view has been shown`);return Date.now()-t>=e}};sM=aM([oM(5,k)],sM);function cM(e){return e.every(e=>e.innerChanges.every(e=>t(e)));function t(e){return!(!e.originalRange.isEmpty()||e.modifiedRange.startLineNumber!==e.modifiedRange.endLineNumber)}}function lM(e,t){if(!t||!cM(e))return!1;let n=t;return e.every(e=>e.innerChanges.every(e=>r(e)));function r(e){let t=e.originalRange.getStartPosition();return!!(n.isBeforeOrEqual(t)||t.lineNumber<n.lineNumber)}}function uM(e){let t=e.flatMap(e=>e.innerChanges??[]);if(t.length!==1)return!1;let n=t[0];return!(!n.originalRange.isEmpty()||n.modifiedRange.startLineNumber===n.modifiedRange.endLineNumber)}function dM(e,t,n){return e.map(e=>({original:t.originalText.getValueOfRange(e.originalRange),modified:n.getValueOfRange(e.modifiedRange)})).every(({original:e,modified:t})=>t.trim()===``&&e.length>0&&(e.length>t.length||e.trim()!==``))}function fM(e,t){return mM(e,t,e=>/^[a-zA-Z]$/.test(e))}function pM(e,t){return mM(e,t,e=>!/^\s$/.test(e))}function mM(e,t,n){let r=[];e.sort((e,t)=>T.compareRangesUsingStarts(e.range,t.range));for(let n of e){let e=n.range.startColumn-1,a=n.range.endColumn-2,o=``,s=``,c=t.getLineAt(n.range.startLineNumber),l=t.getLineAt(n.range.endLineNumber);if(i(c[e]))for(;i(c[e-1]);)o=c[e-1]+o,e--;if(i(l[a])||a<e)for(;i(l[a+1]);)s+=l[a+1],a++;let u=new Su(new T(n.range.startLineNumber,e+1,n.range.endLineNumber,a+2),o+n.text+s);r.length>0&&T.areIntersectingOrTouching(r[r.length-1].range,u.range)&&(u=Su.joinReplacements([r.pop(),u],t)),r.push(u)}function i(e){return e===void 0?!1:n(e)}return r}function hM(e,t){let n=e.model.inlineEdit.edit.replacements;if(n.length!==1)return 0;let r=t.getModel();if(!r)return 0;let i=r.getEOL(),a=n[0];if(a.range.isEmpty()&&a.text.startsWith(i)){let e=t.getLineHeightForPosition(a.range.getStartPosition());return gM(a.text,i)*e}return 0}function gM(e,t){if(!t.length)return 0;let n=0,r=0;for(;e.startsWith(t,r);)n++,r+=t.length;return n}var _M=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vM=function(e,t){return function(n,r){t(n,r,e)}},yM,bM=class extends x{static{yM=this}static{this.hot=kt(yM)}constructor(e,t,n,r,i){super(),this._editor=e,this._edit=t,this._model=n,this._focusIsInMenu=r,this._inlineEdit=O(this,e=>{let t=this._model.read(e);if(!t)return;let n=this._edit.read(e);if(!n)return;let r=this._editor.getModel();if(!r)return;let i=t.inlineEditState.read(void 0)?.inlineCompletion.updatedEdit;if(!i)return;let a=i.replacements.map(e=>{let t=T.fromPositions(r.getPositionAt(e.replaceRange.start),r.getPositionAt(e.replaceRange.endExclusive));return new Su(t,e.newText)}),o=new Ia(a),s=new $n(r);return new Ak(s,o,t.primaryPosition.read(void 0),n.commands,n.inlineCompletion)}),this._inlineEditModel=O(this,e=>{let t=this._model.read(e);if(!t)return;let n=this._inlineEdit.read(e);if(!n)return;let r=O(this,e=>{if(this._editorObs.isFocused.read(e)){if(t.tabShouldJumpToInlineEdit.read(e))return SD.Jump;if(t.tabShouldAcceptInlineEdit.read(e))return SD.Accept}return SD.Inactive});return new jk(t,n,r)}),this._inlineEditHost=O(this,e=>{let t=this._model.read(e);if(t)return new Mk(t)}),this._ghostTextIndicator=O(this,e=>{let t=this._model.read(e);if(!t)return;let n=t.inlineCompletionState.read(e);if(!n)return;let r=n.inlineCompletion;if(!r||!r.showInlineEditMenu)return;let i=$r.ofLength(n.primaryGhostText.lineNumber,1);return new Nk(this._editor,t,i,r)}),this._editorObs=Bs(this._editor),this._register(i.createInstance(sM,this._editor,this._inlineEditHost,this._inlineEditModel,this._ghostTextIndicator,this._focusIsInMenu))}};bM=yM=_M([vM(4,k)],bM);var xM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},SM=function(e,t){return function(n,r){t(n,r,e)}},CM=class extends x{constructor(e,t,n,r){super(),this._editor=e,this._model=t,this._focusIsInMenu=n,this._instantiationService=r,this._ghostTexts=O(this,e=>this._model.read(e)?.ghostTexts.read(e)??[]),this._stablizedGhostTexts=AE(this._ghostTexts,this._store),this._editorObs=Bs(this._editor),this._ghostTextWidgets=jt(this,this._stablizedGhostTexts,(e,t)=>sa(t=>this._instantiationService.createInstance(xk.hot.read(t),this._editor,{ghostText:e,warning:this._model.map((e,t)=>{let n=e?.warning?.read(t);return n?{icon:n.icon}:void 0}),minReservedLineCount:Lr(0),targetTextModel:this._model.map(e=>e?.textModel),handleInlineCompletionShown:this._model.map((e,t)=>{let n=e?.inlineCompletionState.read(t)?.inlineCompletion;return n?t=>e.handleInlineSuggestionShown(n,Q.GhostText,t):()=>{}})},this._editorObs.getOption(71).map(e=>({syntaxHighlightingEnabled:e.syntaxHighlightingEnabled})),!1,!1)).recomputeInitiallyAndOnChange(t)).recomputeInitiallyAndOnChange(this._store),this._inlineEdit=O(this,e=>this._model.read(e)?.inlineEditState.read(e)?.inlineEdit),this._everHadInlineEdit=Oi(this,(e,t)=>t||!!this._inlineEdit.read(e)||!!this._model.read(e)?.inlineCompletionState.read(e)?.inlineCompletion?.showInlineEditMenu),this._inlineEditWidget=sa(e=>{if(this._everHadInlineEdit.read(e))return this._instantiationService.createInstance(bM.hot.read(e),this._editor,this._inlineEdit,this._model,this._focusIsInMenu)}).recomputeInitiallyAndOnChange(this._store),this._fontFamily=this._editorObs.getOption(71).map(e=>e.fontFamily),this._register(vt(O(e=>`
.monaco-editor .ghost-text-decoration,
.monaco-editor .ghost-text-decoration-preview,
.monaco-editor .ghost-text {
	font-family: ${this._fontFamily.read(e)};
}`))),this._register(new P_(this._editor,this._model,this._instantiationService))}shouldShowHoverAtViewZone(e){return this._ghostTextWidgets.get()[0]?.get().ownsViewZone(e)??!1}};CM=xM([SM(3,k)],CM);var wM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},TM=function(e,t){return function(n,r){t(n,r,e)}},EM,DM=class extends x{static{EM=this}static{this._instances=new Set}static{this.hot=kt(EM)}static{this.ID=`editor.contrib.inlineCompletionsController`}static getInFocusedEditorOrParent(e){let t=cy(e);return t?EM.get(t):null}static get(e){return ET(e.getContribution(EM.ID))}constructor(e,t,n,r,i,a,o,s,c,l){super(),this.editor=e,this._instantiationService=t,this._contextKeyService=n,this._configurationService=r,this._commandService=i,this._debounceService=a,this._languageFeaturesService=o,this._accessibilitySignalService=s,this._keybindingService=c,this._accessibilityService=l,this._editorObs=Bs(this.editor),this._positions=O(this,e=>this._editorObs.selections.read(e)?.map(e=>e.getEndPosition())??[new C(1,1)]),this._suggestWidgetAdapter=this._register(new fk(this._editorObs,e=>this.model.get()?.handleSuggestAccepted(e),()=>this.model.get()?.selectedInlineCompletion.get()?.getSingleTextEdit())),this._enabledInConfig=yt(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(71).enabled),this._isScreenReaderEnabled=yt(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this._editorDictationInProgress=yt(this,this._contextKeyService.onDidChangeContext,()=>this._contextKeyService.getContext(this.editor.getDomNode()).getValue(`editorDictation.inProgress`)===!0),this._enabled=O(this,e=>this._enabledInConfig.read(e)&&(!this._isScreenReaderEnabled.read(e)||!this._editorDictationInProgress.read(e))),this._debounceValue=this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider,`InlineCompletionsDebounce`,{min:50,max:50}),this._focusIsInMenu=kl(this,!1),this._focusIsInEditorOrMenu=O(this,e=>{let t=this._editorObs.isFocused.read(e),n=this._focusIsInMenu.read(e);return t||n}),this._cursorIsInIndentation=O(this,e=>{let t=this._editorObs.cursorPosition.read(e);if(t===null)return!1;let n=this._editorObs.model.read(e);if(!n)return!1;this._editorObs.versionId.read(e);let r=n.getLineIndentColumn(t.lineNumber);return t.column<=r}),this.model=sa(this,e=>{if(this._editorObs.isReadonly.read(e))return;let t=this._editorObs.model.read(e);if(t)return this._instantiationService.createInstance(KD,t,this._suggestWidgetAdapter.selectedItem,this._editorObs.versionId,this._positions,this._debounceValue,this._enabled,this.editor)}).recomputeInitiallyAndOnChange(this._store),this._playAccessibilitySignal=Ri(this),this._hideInlineEditOnSelectionChange=this._editorObs.getOption(71).map(e=>!0),this._view=this._register(this._instantiationService.createInstance(CM,this.editor,this.model,this._focusIsInMenu)),EM._instances.add(this),this._register(Cl(()=>EM._instances.delete(this))),this._register(g(e=>{let t=this.model.read(e);if(!t)return;let n=t.state.read(e);if(!n||!this._focusIsInEditorOrMenu.read(void 0))return;let r=n.kind===`inlineEdit`?n.nextEditUri:void 0;for(let e of EM._instances)if(e===this)continue;else r&&Ra(r,e.editor.getModel()?.uri)?e.model.read(void 0)?.trigger():e.reject()})),this._register(g(e=>{let t=this.model.read(e),n=this.editor.getModel()?.uri;!t||!n||e.store.add(t.onDidAccept(()=>{for(let e of EM._instances){if(e===this)continue;let t=e.model.read(void 0)?.state.read(void 0);t?.kind===`inlineEdit`&&Ra(t.nextEditUri,n)&&e.model.read(void 0)?.stop(`automatic`)}}))})),this._register(pr(this._editorObs.onDidType,(e,t)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(pr(this._editorObs.onDidPaste,(e,t)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(this._commandService.onDidExecuteCommand(t=>{if(new Set([jr.Tab.id,jr.DeleteLeft.id,jr.DeleteRight.id,`editor.action.inlineSuggest.commit`,`acceptSelectedSuggestion`]).has(t.commandId)&&e.hasTextFocus()&&this._enabled.get()){let e=!1;t.commandId===`editor.action.inlineSuggest.commit`&&(e=!0),this._editorObs.forceUpdate(t=>{this.model.get()?.trigger(t,{noDelay:e})})}})),this._register(pr(this._editorObs.selections,(e,t,n)=>{if(n.some(e=>e.reason===3||e.source===`api`)){if(!this._hideInlineEditOnSelectionChange.get()&&this.model.get()?.state.get()?.kind===`inlineEdit`)return;let e=this.model.get();if(!e)return;e.state.get()?.kind===`ghostText`&&this.model.get()?.stop()}})),this._register(g(t=>{let n=this._focusIsInEditorOrMenu.read(t),r=this.model.read(void 0);if(n){let e=r?.state.read(void 0);(!e||e.kind!==`inlineEdit`||!e.nextEditUri)&&Bl(e=>{for(let t of EM._instances)t!==this&&t.model.read(void 0)?.stop(`automatic`,e)});return}this._contextKeyService.getContextKeyValue(`accessibleViewIsShown`)||this._configurationService.getValue(`editor.inlineSuggest.keepOnBlur`)||e.getOption(71).keepOnBlur||L_.dropDownVisible||r&&(r.state.read(void 0)?.inlineCompletion?.isFromExplicitRequest&&r.inlineEditAvailable.read(void 0)||Bl(e=>{r.stop(`automatic`,e)}))})),this._register(g(e=>{let t=this.model.read(e)?.inlineCompletionState.read(e);t?.suggestItem?t.primaryGhostText.lineCount>=2&&this._suggestWidgetAdapter.forceRenderingAbove():this._suggestWidgetAdapter.stopForceRenderingAbove()})),this._register(Cl(()=>{this._suggestWidgetAdapter.stopForceRenderingAbove()}));let u=Oi(this,(e,t)=>{let n=this.model.read(e)?.state.read(e);return this._suggestWidgetAdapter.selectedItem.get()?t:n?.inlineCompletion?.semanticId});this._register(Ut(O(e=>(this._playAccessibilitySignal.read(e),u.read(e),{})),async(e,t,n,r)=>{let i=this.model.get(),a=i?.state.get();if(!a||!i||(await le(50,gt(r)),await ml(this._suggestWidgetAdapter.selectedItem,ku,()=>!1,gt(r)),i=this.model.get(),a=i?.state.get(),!a||!i))return;let o=a.kind===`ghostText`?i.textModel.getLineContent(a.primaryGhostText.lineNumber):``;this._accessibilitySignalService.playSignal(a.kind===`ghostText`?fl.inlineSuggestion:fl.nextEditSuggestion),this.editor.getOption(12)&&(a.kind===`ghostText`?this._provideScreenReaderUpdate(a.primaryGhostText.renderForScreenReader(o)):this._provideScreenReaderUpdate(``))})),this._register(this._configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(`accessibility.verbosity.inlineCompletions`)&&this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue(`accessibility.verbosity.inlineCompletions`)})})),this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue(`accessibility.verbosity.inlineCompletions`)});let d=new jE(this._contextKeyService);this._register(d.bind(GT.cursorInIndentation,this._cursorIsInIndentation)),this._register(d.bind(GT.hasSelection,e=>!this._editorObs.cursorSelection.read(e)?.isEmpty())),this._register(d.bind(GT.cursorAtInlineEdit,this.model.map((e,t)=>e?.inlineEditState?.read(t)?.cursorAtInlineEdit.read(t)))),this._register(d.bind(GT.tabShouldAcceptInlineEdit,this.model.map((e,t)=>!!e?.tabShouldAcceptInlineEdit.read(t)))),this._register(d.bind(GT.tabShouldJumpToInlineEdit,this.model.map((e,t)=>!!e?.tabShouldJumpToInlineEdit.read(t)))),this._register(d.bind(GT.inlineEditVisible,e=>this.model.read(e)?.inlineEditState.read(e)!==void 0)),this._register(d.bind(GT.inlineSuggestionHasIndentation,e=>this.model.read(e)?.getIndentationInfo(e)?.startsWithIndentation)),this._register(d.bind(GT.inlineSuggestionHasIndentationLessThanTabSize,e=>this.model.read(e)?.getIndentationInfo(e)?.startsWithIndentationLessThanTabSize)),this._register(d.bind(GT.suppressSuggestions,e=>{let t=this.model.read(e)?.inlineCompletionState.read(e);return t?.primaryGhostText&&t?.inlineCompletion?t.inlineCompletion.source.inlineSuggestions.suppressSuggestions:void 0})),this._register(d.bind(GT.inlineSuggestionVisible,e=>{let t=this.model.read(e)?.inlineCompletionState.read(e);return!!t?.inlineCompletion&&t?.primaryGhostText!==void 0&&!t?.primaryGhostText.isEmpty()}));let f=O(this,e=>{let t=this.model.read(e)?.inlineCompletionState.read(e)?.primaryGhostText;if(!(!t||t.isEmpty()))return new C(t.lineNumber,t.parts[0].column)});this._register(d.bind(GT.cursorBeforeGhostText,e=>{let t=f.read(e);if(!t)return!1;let n=this._editorObs.cursorPosition.read(e);return n?t.equals(n):!1})),this._register(this._instantiationService.createInstance($T,this.editor))}playAccessibilitySignal(e){this._playAccessibilitySignal.trigger(e)}_provideScreenReaderUpdate(e){let t=this._contextKeyService.getContextKeyValue(`accessibleViewIsShown`),n=this._keybindingService.lookupKeybinding(`editor.action.accessibleView`),r;!t&&n&&this.editor.getOption(169)&&(r=G(1196,`Inspect this in the accessible view ({0})`,n.getAriaLabel())),va(r?e+`, `+r:e)}shouldShowHoverAt(e){let t=this.model.get()?.primaryGhostText.get();return t?t.parts.some(n=>e.containsPosition(new C(t.lineNumber,n.column))):!1}shouldShowHoverAtViewZone(e){return this._view.shouldShowHoverAtViewZone(e)}reject(){Bl(e=>{let t=this.model.get();if(t&&(t.stop(`explicitCancel`,e),this._focusIsInEditorOrMenu.get()))for(let t of EM._instances)t!==this&&t.model.get()?.stop(`automatic`,e)})}jump(){let e=this.model.get();e&&e.jump()}};DM=EM=wM([TM(1,k),TM(2,On),TM(3,hn),TM(4,Te),TM(5,fu),TM(6,H),TM(7,Zt),TM(8,Yt),TM(9,Qt)],DM);var OM=class e extends R{static{this.ID=O_}constructor(){super({id:e.ID,label:U(1174,`Show Next Inline Suggestion`),precondition:E.and(y.writable,GT.inlineSuggestionVisible),kbOpts:{weight:100,primary:606}})}async run(e,t){DM.get(t)?.model.get()?.next()}},kM=class e extends R{static{this.ID=D_}constructor(){super({id:e.ID,label:U(1175,`Show Previous Inline Suggestion`),precondition:E.and(y.writable,GT.inlineSuggestionVisible),kbOpts:{weight:100,primary:604}})}async run(e,t){DM.get(t)?.model.get()?.previous()}},AM=class extends R{constructor(){super({id:`editor.action.inlineSuggest.trigger`,label:U(1176,`Trigger Inline Suggestion`),precondition:y.writable})}async run(e,t){let n=DM.get(t);await Ga(async e=>{await n?.model.get()?.triggerExplicitly(e),n?.playAccessibilitySignal(e)})}},jM=class extends R{constructor(){super({id:`editor.action.inlineSuggest.triggerInlineEditExplicit`,label:U(1177,`Trigger Next Edit Suggestion`),precondition:y.writable})}async run(e,t){let n=e.get(Ur),r=DM.get(t);await r?.model.get()?.triggerExplicitly(void 0,!0),r?.model.get()?.inlineEditAvailable.get()||n.notify({severity:hd.Info,message:G(1165,`No inline edit is available.`)})}},MM=class extends Ar{constructor(){super({id:`editor.action.inlineSuggest.triggerInlineEdit`,precondition:y.writable})}async runEditorCommand(e,t,n){await DM.get(t)?.model.get()?.trigger(void 0,{onlyFetchInlineEdits:!0})}},NM=class extends R{constructor(){super({id:`editor.action.inlineSuggest.acceptNextWord`,label:U(1178,`Accept Next Word Of Inline Suggestion`),precondition:E.and(y.writable,GT.inlineSuggestionVisible),kbOpts:{weight:101,primary:2065,kbExpr:E.and(y.writable,GT.inlineSuggestionVisible,GT.cursorBeforeGhostText,pl.negate())},menuOpts:[{menuId:S.InlineSuggestionToolbar,title:G(1166,`Accept Word`),group:`primary`,order:2}]})}async run(e,t){await DM.get(t)?.model.get()?.acceptNextWord()}},PM=class extends R{constructor(){super({id:`editor.action.inlineSuggest.acceptNextLine`,label:U(1179,`Accept Next Line Of Inline Suggestion`),precondition:E.and(y.writable,GT.inlineSuggestionVisible),kbOpts:{weight:101},menuOpts:[{menuId:S.InlineSuggestionToolbar,title:G(1167,`Accept Line`),group:`secondary`,order:2}]})}async run(e,t){await DM.get(t)?.model.get()?.acceptNextLine()}},FM=class extends R{constructor(){super({id:E_,label:U(1180,`Accept Inline Suggestion`),precondition:E.or(GT.inlineSuggestionVisible,GT.inlineEditVisible),menuOpts:[{menuId:S.InlineSuggestionToolbar,title:G(1168,`Accept`),group:`primary`,order:2},{menuId:S.InlineEditsActions,title:G(1169,`Accept`),group:`primary`,order:2}],kbOpts:[{primary:2,weight:200,kbExpr:E.or(E.and(GT.inlineSuggestionVisible,y.tabMovesFocus.toNegated(),Z.Visible.toNegated(),y.hoverFocused.toNegated(),GT.hasSelection.toNegated(),GT.inlineSuggestionHasIndentationLessThanTabSize),E.and(GT.inlineEditVisible,y.tabMovesFocus.toNegated(),Z.Visible.toNegated(),y.hoverFocused.toNegated(),GT.tabShouldAcceptInlineEdit))}]})}async run(e,t){let n=DM.getInFocusedEditorOrParent(e);n&&(n.model.get()?.accept(n.editor),n.editor.focus())}};Zn.registerKeybindingRule({id:E_,weight:202,primary:2,when:E.and(GT.inInlineEditsPreviewEditor)});var IM=class extends R{constructor(){super({id:`editor.action.inlineSuggest.jump`,label:U(1181,`Jump to next inline edit`),precondition:GT.inlineEditVisible,menuOpts:[{menuId:S.InlineEditsActions,title:G(1170,`Jump`),group:`primary`,order:1,when:GT.cursorAtInlineEdit.toNegated()}],kbOpts:{primary:2,weight:201,kbExpr:E.and(GT.inlineEditVisible,y.tabMovesFocus.toNegated(),Z.Visible.toNegated(),y.hoverFocused.toNegated(),GT.tabShouldJumpToInlineEdit)}})}async run(e,t){let n=DM.get(t);n&&n.jump()}},LM=class e extends R{static{this.ID=k_}constructor(){super({id:e.ID,label:U(1182,`Hide Inline Suggestion`),precondition:E.or(GT.inlineSuggestionVisible,GT.inlineEditVisible),kbOpts:{weight:190,primary:9},menuOpts:[{menuId:S.InlineEditsActions,title:G(1171,`Reject`),group:`primary`,order:3}]})}async run(e,t){let n=DM.getInFocusedEditorOrParent(e);Bl(e=>{n?.model.get()?.stop(`explicitCancel`,e)}),n?.editor.focus()}},RM=class e extends R{static{this.ID=A_}constructor(){super({id:e.ID,label:U(1183,`Toggle Inline Suggestions Show Collapsed`),precondition:E.true()})}async run(e,t){let n=e.get(hn),r=n.getValue(`editor.inlineSuggest.edits.showCollapsed`);n.updateValue(`editor.inlineSuggest.edits.showCollapsed`,!r)}};Zn.registerKeybindingRule({id:LM.ID,weight:-1,primary:9,secondary:[1033],when:E.and(GT.inInlineEditsPreviewEditor)});var zM=class e extends pi{static{this.ID=`editor.action.inlineSuggest.toggleAlwaysShowToolbar`}constructor(){super({id:e.ID,title:G(1172,`Always Show Toolbar`),f1:!1,precondition:void 0,menu:[{id:S.InlineSuggestionToolbar,group:`secondary`,order:10}],toggled:E.equals(`config.editor.inlineSuggest.showToolbar`,`always`)})}async run(e){let t=e.get(hn),n=t.getValue(`editor.inlineSuggest.showToolbar`)===`always`?`onHover`:`always`;t.updateValue(`editor.inlineSuggest.showToolbar`,n)}},BM=class extends R{constructor(){super({id:`editor.action.inlineSuggest.dev.extractRepro`,label:G(1173,`Developer: Extract Inline Suggest State`),alias:`Developer: Inline Suggest Extract Repro`,precondition:E.or(GT.inlineEditVisible,GT.inlineSuggestionVisible)})}async run(e,t){let n=e.get(aa),r=DM.get(t)?.model.get();if(!r)return;let i=r.extractReproSample(),a=Uo(JSON.stringify({inlineCompletion:i.inlineCompletion},null,4)).map(e=>`// `+e).join(`
`),o=`${i.documentValue}\n\n// <json>\n${a}\n// </json>\n`;return await n.writeText(o),{reproCase:o}}},VM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},HM=function(e,t){return function(n,r){t(n,r,e)}},UM=class{constructor(e,t,n){this.owner=e,this.range=t,this.controller=n}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},WM=class{constructor(e,t,n,r,i,a){this._editor=e,this._languageService=t,this._openerService=n,this.accessibilityService=r,this._instantiationService=i,this._telemetryService=a,this.hoverOrdinal=4}suggestHoverAnchor(e){let t=DM.get(this._editor);if(!t)return null;let n=e.target;if(n.type===8){let r=n.detail;if(t.shouldShowHoverAtViewZone(r.viewZoneId))return new n_(1e3,this,T.fromPositions(this._editor.getModel().validatePosition(r.positionBefore||r.position)),e.event.posx,e.event.posy,!1)}if(n.type===7&&t.shouldShowHoverAt(n.range)||n.type===6&&n.detail.mightBeForeignElement&&t.shouldShowHoverAt(n.range))return new n_(1e3,this,n.range,e.event.posx,e.event.posy,!1);if(n.type===9&&n.element){let r=xk.getWarningWidgetContext(n.element);if(r&&t.shouldShowHoverAt(r.range))return new n_(1e3,this,r.range,e.event.posx,e.event.posy,!1)}return null}computeSync(e,t){if(this._editor.getOption(71).showToolbar!==`onHover`)return[];let n=DM.get(this._editor);return n&&n.shouldShowHoverAt(e.range)?[new UM(this,e.range,n)]:[]}renderHoverParts(e,t){let n=new L,r=t[0];this._telemetryService.publicLog2(`inlineCompletionHover.shown`),this.accessibilityService.isScreenReaderOptimized()&&!this._editor.getOption(12)&&n.add(this.renderScreenReaderText(e,r));let i=r.controller.model.get(),a=document.createElement(`div`);return e.fragment.appendChild(a),n.add(Ql((t,n)=>{let r=n.add(this._instantiationService.createInstance(L_.hot.read(t),this._editor,!1,Lr(null),i.selectedInlineCompletionIndex,i.inlineCompletionsCount,i.activeCommands,i.warning,()=>{e.onContentsChanged()}));a.replaceChildren(r.getDomNode())})),i.triggerExplicitly(),new r_([{hoverPart:r,hoverElement:a,dispose(){n.dispose()}}])}renderScreenReaderText(e,t){let n=new L,r=b,i=r(`div.hover-row.markdown-hover`),a=B(i,r(`div.hover-contents`,{"aria-live":`assertive`})),o=new et({editor:this._editor},this._languageService,this._openerService),s=t=>{let r=G(1197,`Suggestion:`),i=n.add(o.render(new Jn().appendText(r).appendCodeblock(`text`,t),{asyncRenderCallback:()=>{a.className=`hover-contents code-hover-contents`,e.onContentsChanged()}}));a.replaceChildren(i.element)};return n.add(g(e=>{let n=t.controller.model.read(e)?.primaryGhostText.read(e);if(n){let e=this._editor.getModel().getLineContent(n.lineNumber);s(n.renderForScreenReader(e))}else Ve(a)})),e.fragment.appendChild(i),n}};WM=VM([HM(1,wt),HM(2,da),HM(3,Qt),HM(4,k),HM(5,Fu)],WM);var GM=class{};K(DM.ID,kT(DM.hot),3),q(AM),q(jM),W(new MM),q(OM),q(kM),q(NM),q(PM),q(FM),q(RM),q(LM),q(IM),j(zM),q(BM),j(Uu),j(td),i_.register(WM),CT.register(new GM);var KM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qM=function(e,t){return function(n,r){t(n,r,e)}},JM,YM=class{static{JM=this}static{this.ID=`editor.contrib.gotodefinitionatposition`}static{this.MAX_SOURCE_PREVIEW_LINES=8}constructor(e,t,n,r){this.textModelResolverService=t,this.languageService=n,this.languageFeaturesService=r,this.toUnhook=new L,this.toUnhookForKeyboard=new L,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e,this.linkDecorations=this.editor.createDecorationsCollection();let i=new ey(e);this.toUnhook.add(i),this.toUnhook.add(i.onMouseMoveOrRelevantKeyDown(([e,t])=>{this.startFindDefinitionFromMouse(e,t??void 0)})),this.toUnhook.add(i.onExecute(e=>{this.isEnabled(e)&&this.gotoDefinition(e.target.position,e.hasSideBySideModifier).catch(e=>{mr(e)}).finally(()=>{this.removeLinkDecorations()})})),this.toUnhook.add(i.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(e){return e.getContribution(JM.ID)}async startFindDefinitionFromCursor(e){await this.startFindDefinition(e),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(e=>{e&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))}startFindDefinitionFromMouse(e,t){if(e.target.type===9&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t)){this.currentWordAtPosition=null,this.removeLinkDecorations();return}let n=e.target.position;this.startFindDefinition(n)}async startFindDefinition(e){this.toUnhookForKeyboard.clear();let t=e?this.editor.getModel()?.getWordAtPosition(e):null;if(!t){this.currentWordAtPosition=null,this.removeLinkDecorations();return}if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===t.startColumn&&this.currentWordAtPosition.endColumn===t.endColumn&&this.currentWordAtPosition.word===t.word)return;this.currentWordAtPosition=t;let n=new De(this.editor,15);this.previousPromise&&=(this.previousPromise.cancel(),null),this.previousPromise=li(t=>this.findDefinition(e,t));let r;try{r=await this.previousPromise}catch(e){mr(e);return}if(!r||!r.length||!n.validate(this.editor)){this.removeLinkDecorations();return}let i=r[0].originSelectionRange?T.lift(r[0].originSelectionRange):new T(e.lineNumber,t.startColumn,e.lineNumber,t.endColumn);if(r.length>1){let e=i;for(let{originSelectionRange:t}of r)t&&(e=T.plusRange(e,t));this.addDecoration(e,new Jn().appendText(G(1072,`Click to show {0} definitions.`,r.length)))}else{let e=r[0];return e.uri?this.textModelResolverService.createModelReference(e.uri).then(t=>{if(!t.object||!t.object.textEditorModel){t.dispose();return}let{object:{textEditorModel:n}}=t,{startLineNumber:r}=e.range;if(r<1||r>n.getLineCount()){t.dispose();return}let a=this.getPreviewValue(n,r,e),o=this.languageService.guessLanguageIdByFilepathOrFirstLine(n.uri);this.addDecoration(i,a?new Jn().appendCodeblock(o||``,a):void 0),t.dispose()}):void 0}}getPreviewValue(e,t,n){let r=n.range;return r.endLineNumber-r.startLineNumber>=JM.MAX_SOURCE_PREVIEW_LINES&&(r=this.getPreviewRangeBasedOnIndentation(e,t)),r=e.validateRange(r),this.stripIndentationFromPreviewRange(e,t,r)}stripIndentationFromPreviewRange(e,t,n){let r=e.getLineFirstNonWhitespaceColumn(t);for(let i=t+1;i<n.endLineNumber;i++){let t=e.getLineFirstNonWhitespaceColumn(i);r=Math.min(r,t)}return e.getValueInRange(n).replace(RegExp(`^\\s{${r-1}}`,`gm`),``).trim()}getPreviewRangeBasedOnIndentation(e,t){let n=e.getLineFirstNonWhitespaceColumn(t),r=Math.min(e.getLineCount(),t+JM.MAX_SOURCE_PREVIEW_LINES),i=t+1;for(;i<r;i++){let t=e.getLineFirstNonWhitespaceColumn(i);if(n===t)break}return new T(t,1,i+1,1)}addDecoration(e,t){let n={range:e,options:{description:`goto-definition-link`,inlineClassName:`goto-definition-link`,hoverMessage:t}};this.linkDecorations.set([n])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(e,t){return this.editor.hasModel()&&e.isLeftClick&&e.isNoneOrSingleMouseDown&&e.target.type===6&&!(e.target.detail.injectedText?.options instanceof La)&&(e.hasTriggerModifier||(t?t.keyCodeIsTriggerKey:!1))&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(e,t){let n=this.editor.getModel();return n?fb(this.languageFeaturesService.definitionProvider,n,e,!1,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext(e=>{let n=!t&&this.editor.getOption(101)&&!this.isInPeekEditor(e);return new bb({openToSide:t,openInPeek:n,muteMessage:!0},{title:{value:``,original:``},id:``,precondition:void 0}).run(e)})}isInPeekEditor(e){let t=e.get(On);return yy.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}};YM=JM=KM([qM(1,Et),qM(2,wt),qM(3,H)],YM),K(YM.ID,YM,2);var XM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ZM=function(e,t){return function(n,r){t(n,r,e)}},QM=class{constructor(e,t,n){this.marker=e,this.index=t,this.total=n}},$M=class{constructor(e,t,n){this._markerService=t,this._configService=n,this._onDidChange=new D,this.onDidChange=this._onDidChange.event,this._dispoables=new L,this._markers=[],this._nextIdx=-1,ur.isUri(e)?this._resourceFilter=t=>t.toString()===e.toString():e&&(this._resourceFilter=e);let r=this._configService.getValue(`problems.sortOrder`),i=(e,t)=>{let n=Br(e.resource.toString(),t.resource.toString());return n===0&&(n=r===`position`?T.compareRangesUsingStarts(e,t)||me.compare(e.severity,t.severity):me.compare(e.severity,t.severity)||T.compareRangesUsingStarts(e,t)),n},a=()=>{let t=this._markerService.read({resource:ur.isUri(e)?e:void 0,severities:me.Error|me.Warning|me.Info});return typeof e==`function`&&(t=t.filter(e=>this._resourceFilter(e.resource))),t.sort(i),bt(t,this._markers,(e,t)=>e.resource.toString()===t.resource.toString()&&e.startLineNumber===t.startLineNumber&&e.startColumn===t.startColumn&&e.endLineNumber===t.endLineNumber&&e.endColumn===t.endColumn&&e.severity===t.severity&&e.message===t.message)?!1:(this._markers=t,!0)};a(),this._dispoables.add(t.onMarkerChanged(e=>{(!this._resourceFilter||e.some(e=>this._resourceFilter(e)))&&a()&&(this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e?!0:!this._resourceFilter||!e?!1:this._resourceFilter(e)}get selected(){let e=this._markers[this._nextIdx];return e&&new QM(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,n){let r=this._markers.findIndex(t=>Ra(t.resource,e.uri));if(r<0)r=ud(this._markers.length,t=>Br(this._markers[t].resource.toString(),e.uri.toString())),r<0&&(r=~r),n?this._nextIdx=r:this._nextIdx=(this._markers.length+r-1)%this._markers.length;else{let i=!1,a=!1;for(let n=r;n<this._markers.length;n++){let r=T.lift(this._markers[n]);if(r.isEmpty()){let t=e.getWordAtPosition(r.getStartPosition());t&&(r=new T(r.startLineNumber,t.startColumn,r.startLineNumber,t.endColumn))}if(t&&(r.containsPosition(t)||t.isBeforeOrEqual(r.getStartPosition()))){this._nextIdx=n,i=!0,a=!r.containsPosition(t);break}if(this._markers[n].resource.toString()!==e.uri.toString())break}i?a&&!n&&--this._nextIdx:this._nextIdx=n?0:this._markers.length-1}this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,n){if(this._markers.length===0)return!1;let r=this._nextIdx;return this._nextIdx===-1?this._initIdx(t,n,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),r!==this._nextIdx}find(e,t){let n=this._markers.findIndex(t=>t.resource.toString()===e.toString());if(!(n<0)){for(;n<this._markers.length;n++)if(T.containsPosition(this._markers[n],t))return new QM(this._markers[n],n+1,this._markers.length)}}};$M=XM([ZM(1,cc),ZM(2,hn)],$M);const eN=ma(`IMarkerNavigationService`);var tN=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new Fc}getMarkerList(e){for(let t of this._provider){let n=t.getMarkerList(e);if(n)return n}return new $M(e,this._markerService,this._configService)}};tN=XM([ZM(0,cc),ZM(1,hn)],tN),Ui(eN,tN,1);var nN;(function(e){function t(e){switch(e){case we.Ignore:return`severity-ignore `+I.asClassName(X.info);case we.Info:return I.asClassName(X.info);case we.Warning:return I.asClassName(X.warning);case we.Error:return I.asClassName(X.error);default:return``}}e.className=t})(nN||={});var rN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},iN=function(e,t){return function(n,r){t(n,r,e)}},aN,oN=class{constructor(e,t,n,r,i){this._openerService=r,this._labelService=i,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new L,this._editor=t;let a=document.createElement(`div`);a.className=`descriptioncontainer`,this._messageBlock=document.createElement(`div`),this._messageBlock.classList.add(`message`),this._messageBlock.setAttribute(`aria-live`,`assertive`),this._messageBlock.setAttribute(`role`,`alert`),a.appendChild(this._messageBlock),this._relatedBlock=document.createElement(`div`),a.appendChild(this._relatedBlock),this._disposables.add(Ll(this._relatedBlock,`click`,e=>{e.preventDefault();let t=this._relatedDiagnostics.get(e.target);t&&n(t)})),this._scrollable=new je(a,{horizontal:1,vertical:1,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(e=>{a.style.left=`-${e.scrollLeft}px`,a.style.top=`-${e.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){Ot(this._disposables)}update(e){let{source:t,message:n,relatedInformation:r,code:i}=e,a=(t?.length||0)+2;i&&(typeof i==`string`?a+=i.length:a+=i.value.length);let o=Uo(n);this._lines=o.length,this._longestLineLength=0;for(let e of o)this._longestLineLength=Math.max(e.length+a,this._longestLineLength);fc(this._messageBlock),this._messageBlock.setAttribute(`aria-label`,this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let s=this._messageBlock;for(let e of o)s=document.createElement(`div`),s.innerText=e,e===``&&(s.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(s);if(t||i){let e=document.createElement(`span`);if(e.classList.add(`details`),s.appendChild(e),t){let n=document.createElement(`span`);n.innerText=t,n.classList.add(`source`),e.appendChild(n)}if(i)if(typeof i==`string`){let t=document.createElement(`span`);t.innerText=`(${i})`,t.classList.add(`code`),e.appendChild(t)}else{this._codeLink=b(`a.code-link`),this._codeLink.setAttribute(`href`,`${i.target.toString()}`),this._codeLink.onclick=e=>{this._openerService.open(i.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()};let t=B(this._codeLink,b(`span`));t.innerText=i.value,e.appendChild(this._codeLink)}}if(fc(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),$t(r)){let e=this._relatedBlock.appendChild(document.createElement(`div`));e.style.paddingTop=`${Math.floor(this._editor.getOption(75)*.66)}px`,this._lines+=1;for(let t of r){let n=document.createElement(`div`),r=document.createElement(`a`);r.classList.add(`filename`),r.innerText=`${this._labelService.getUriBasenameLabel(t.resource)}(${t.startLineNumber}, ${t.startColumn}): `,r.title=this._labelService.getUriLabel(t.resource),this._relatedDiagnostics.set(r,t);let i=document.createElement(`span`);i.innerText=t.message,n.appendChild(r),n.appendChild(i),this._lines+=1,e.appendChild(n)}}let c=this._editor.getOption(59),l=Math.ceil(c.typicalFullwidthCharacterWidth*this._longestLineLength*.75),u=c.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:l,scrollHeight:u})}layout(e,t){this._scrollable.getDomNode().style.height=`${e}px`,this._scrollable.getDomNode().style.width=`${t}px`,this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t=``;switch(e.severity){case me.Error:t=G(1019,`Error`);break;case me.Warning:t=G(1020,`Warning`);break;case me.Info:t=G(1021,`Info`);break;case me.Hint:t=G(1022,`Hint`);break}let n=G(1023,`{0} at {1}. `,t,e.startLineNumber+`:`+e.startColumn),r=this._editor.getModel();return r&&e.startLineNumber<=r.getLineCount()&&e.startLineNumber>=1&&(n=`${r.getLineContent(e.startLineNumber)}, ${n}`),n}},sN=class extends Sy{static{aN=this}static{this.TitleMenu=new S(`gotoErrorTitleMenu`)}constructor(e,t,n,r,i,a,o){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},i),this._themeService=t,this._openerService=n,this._menuService=r,this._contextKeyService=a,this._labelService=o,this._callOnDispose=new L,this._onDidSelectRelatedInformation=new D,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=me.Warning,this._backgroundColor=V.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(_N);let t=dN,n=fN;this._severity===me.Warning?(t=pN,n=mN):this._severity===me.Info&&(t=hN,n=gN);let r=e.getColor(t),i=e.getColor(n);this.style({arrowColor:r,frameColor:r,headerBackgroundColor:i,primaryHeadingColor:e.getColor(wy),secondaryHeadingColor:e.getColor(Ty)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():``),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}_fillHead(e){super._fillHead(e),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun(e=>this.editor.focus()));let t=this._menuService.getMenuActions(aN.TitleMenu,this._contextKeyService),n=kn(t);this._actionbarWidget.push(n,{label:!1,icon:!0,index:0})}_fillTitleIcon(e){this._icon=B(e,b(``))}_fillBody(e){this._parentContainer=e,e.classList.add(`marker-widget`),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute(`role`,`tooltip`),this._container=document.createElement(`div`),e.appendChild(this._container),this._message=new oN(this._container,this.editor,e=>this._onDidSelectRelatedInformation.fire(e),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw Error(`call showAtMarker`)}showAtMarker(e,t,n){this._container.classList.remove(`stale`),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());let r=T.lift(e),i=this.editor.getPosition(),a=i&&r.containsPosition(i)?i:r.getStartPosition();super.show(a,this.computeRequiredHeight());let o=this.editor.getModel();if(o){let e=n>1?G(1024,`{0} of {1} problems`,t,n):G(1025,`{0} of {1} problem`,t,n);this.setTitle($o(o.uri),e)}this._icon.className=`codicon ${nN.className(me.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(a,0),this.editor.focus()}updateMarker(e){this._container.classList.remove(`stale`),this._message.update(e)}showStale(){this._container.classList.add(`stale`),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=`${e}px`}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}};sN=aN=rN([iN(1,pa),iN(2,da),iN(3,rt),iN(4,k),iN(5,On),iN(6,Ec)],sN);var cN=_e(Tl,Nc),lN=_e(Du,Oe),uN=_e(Sc,nl),dN=F(`editorMarkerNavigationError.background`,{dark:cN,light:cN,hcDark:Un,hcLight:Un},G(1026,`Editor marker navigation widget error color.`)),fN=F(`editorMarkerNavigationError.headerBackground`,{dark:At(dN,.1),light:At(dN,.1),hcDark:null,hcLight:null},G(1027,`Editor marker navigation widget error heading background.`)),pN=F(`editorMarkerNavigationWarning.background`,{dark:lN,light:lN,hcDark:Un,hcLight:Un},G(1028,`Editor marker navigation widget warning color.`)),mN=F(`editorMarkerNavigationWarning.headerBackground`,{dark:At(pN,.1),light:At(pN,.1),hcDark:`#0C141F`,hcLight:At(pN,.2)},G(1029,`Editor marker navigation widget warning heading background.`)),hN=F(`editorMarkerNavigationInfo.background`,{dark:uN,light:uN,hcDark:Un,hcLight:Un},G(1030,`Editor marker navigation widget info color.`)),gN=F(`editorMarkerNavigationInfo.headerBackground`,{dark:At(hN,.1),light:At(hN,.1),hcDark:null,hcLight:null},G(1031,`Editor marker navigation widget info heading background.`)),_N=F(`editorMarkerNavigation.background`,Jl,G(1032,`Editor marker navigation widget background.`)),vN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yN=function(e,t){return function(n,r){t(n,r,e)}},bN,xN=class{static{bN=this}static{this.ID=`editor.contrib.markerController`}static get(e){return e.getContribution(bN.ID)}constructor(e,t,n,r,i){this._markerNavigationService=t,this._contextKeyService=n,this._editorService=r,this._instantiationService=i,this._sessionDispoables=new L,this._editor=e,this._widgetVisible=DN.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(sN,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(e=>{(!this._model?.selected||!T.containsPosition(this._model?.selected.marker,e.position))&&this._model?.resetIndex()})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;let e=this._model.find(this._editor.getModel().uri,this._widget.position);e?this._widget.updateMarker(e.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(e=>{this._editorService.openCodeEditor({resource:e.resource,options:{pinned:!0,revealIfOpened:!0,selection:T.lift(e).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(!this._editor.hasModel())return;let t=this._editor.getModel(),n=this._getOrCreateModel(t.uri);n.resetIndex(),n.move(!0,t,new C(e.startLineNumber,e.startColumn)),n.selected&&this._widget.showAtMarker(n.selected.marker,n.selected.index,n.selected.total)}async navigate(e,t){if(!this._editor.hasModel())return;let n=this._editor.getModel(),r=this._getOrCreateModel(t?void 0:n.uri);if(r.move(e,n,this._editor.getPosition()),r.selected)if(r.selected.marker.resource.toString()!==n.uri.toString()){this._cleanUp();let n=await this._editorService.openCodeEditor({resource:r.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:2,selection:r.selected.marker}},this._editor);n&&(bN.get(n)?.close(),bN.get(n)?.navigate(e,t))}else this._widget.showAtMarker(r.selected.marker,r.selected.index,r.selected.total)}};xN=bN=vN([yN(1,eN),yN(2,On),yN(3,xl),yN(4,k)],xN);var SN=class extends R{constructor(e,t,n){super(n),this._next=e,this._multiFile=t}async run(e,t){t.hasModel()&&await xN.get(t)?.navigate(this._next,this._multiFile)}},CN=class e extends SN{static{this.ID=`editor.action.marker.next`}static{this.LABEL=U(1015,`Go to Next Problem (Error, Warning, Info)`)}constructor(){super(!0,!1,{id:e.ID,label:e.LABEL,precondition:void 0,kbOpts:{kbExpr:y.focus,primary:578,weight:100},menuOpts:{menuId:sN.TitleMenu,title:e.LABEL.value,icon:nu(`marker-navigation-next`,X.arrowDown,G(1011,`Icon for goto next marker.`)),group:`navigation`,order:1}})}},wN=class e extends SN{static{this.ID=`editor.action.marker.prev`}static{this.LABEL=U(1016,`Go to Previous Problem (Error, Warning, Info)`)}constructor(){super(!1,!1,{id:e.ID,label:e.LABEL,precondition:void 0,kbOpts:{kbExpr:y.focus,primary:1602,weight:100},menuOpts:{menuId:sN.TitleMenu,title:e.LABEL.value,icon:nu(`marker-navigation-previous`,X.arrowUp,G(1012,`Icon for goto previous marker.`)),group:`navigation`,order:2}})}},TN=class extends SN{constructor(){super(!0,!0,{id:`editor.action.marker.nextInFiles`,label:U(1017,`Go to Next Problem in Files (Error, Warning, Info)`),precondition:void 0,kbOpts:{kbExpr:y.focus,primary:66,weight:100},menuOpts:{menuId:S.MenubarGoMenu,title:G(1013,`Next &&Problem`),group:`6_problem_nav`,order:1}})}},EN=class extends SN{constructor(){super(!1,!0,{id:`editor.action.marker.prevInFiles`,label:U(1018,`Go to Previous Problem in Files (Error, Warning, Info)`),precondition:void 0,kbOpts:{kbExpr:y.focus,primary:1090,weight:100},menuOpts:{menuId:S.MenubarGoMenu,title:G(1014,`Previous &&Problem`),group:`6_problem_nav`,order:2}})}};K(xN.ID,xN,4),q(CN),q(wN),q(TN),q(EN);var DN=new N(`markersNavigationVisible`,!1),ON=Ar.bindToContribution(xN.get);W(new ON({id:`closeMarkersNavigation`,precondition:DN,handler:e=>e.close(),kbOpts:{weight:150,kbExpr:y.focus,primary:9,secondary:[1033]}})),q(class extends R{constructor(){super({id:`editor.action.debugEditorGpuRenderer`,label:U(1096,`Developer: Debug Editor GPU Renderer`),precondition:E.true()})}async run(e,t){let n=e.get(k),r=await e.get(Mu).pick([{label:G(1093,`Log Texture Atlas Stats`),id:`logTextureAtlasStats`},{label:G(1094,`Save Texture Atlas`),id:`saveTextureAtlas`},{label:G(1095,`Draw Glyph`),id:`drawGlyph`}],{canPickMany:!1});if(r)switch(r.id){case`logTextureAtlasStats`:n.invokeFunction(e=>{let t=e.get(Wl),n=Dn.atlas;if(!Dn.atlas){t.error(`No texture atlas found`);return}let r=n.getStats();t.info([`Texture atlas stats`,...r].join(`

`))});break;case`saveTextureAtlas`:n.invokeFunction(async e=>{let t=e.get(Ps),n=e.get(PO),r=t.getWorkspace().folders;if(r.length>0){let e=Dn.atlas,t=[];for(let[i,a]of e.pages.entries())t.push(n.writeFile(ur.joinPath(r[0].uri,`textureAtlasPage${i}_actual.png`),xs.wrap(new Uint8Array(await(await a.source.convertToBlob()).arrayBuffer()))),n.writeFile(ur.joinPath(r[0].uri,`textureAtlasPage${i}_usage.png`),xs.wrap(new Uint8Array(await(await a.getUsagePreview()).arrayBuffer()))));await Promise.all(t)}});break;case`drawGlyph`:n.invokeFunction(async e=>{let t=e.get(hn),n=e.get(PO),r=e.get(Mu),i=e.get(Ps).getWorkspace().folders;if(i.length===0)return;let a=Dn.atlas,o=t.getValue(`editor.fontFamily`),s=t.getValue(`editor.fontSize`),c=new Pi(s,o,Ko().devicePixelRatio,Dn.decorationStyleCache),l=await r.input({prompt:`Enter a character to draw (prefix with 0x for code point))`});if(!l)return;let u=l.match(/0x(?<codePoint>[0-9a-f]+)/i)?.groups?.codePoint;u!==void 0&&(l=String.fromCodePoint(parseInt(u,16)));let d=a.getGlyph(c,l,0,0,0);if(!d)return;let f=a.pages[d.pageIndex].source.getContext(`2d`)?.getImageData(d.x,d.y,d.w,d.h);if(!f)return;let p=new OffscreenCanvas(f.width,f.height);Lt(p.getContext(`2d`)).putImageData(f,0,0);let m=await p.convertToBlob({type:`image/png`}),h=ur.joinPath(i[0].uri,`glyph_${l}_0_${s}px_${o.replaceAll(/[,\\\/\.'\s]/g,`_`)}.png`);await n.writeFile(h,xs.wrap(new Uint8Array(await m.arrayBuffer())))});break}}});var kN;(function(e){e.NoAutoFocus=`noAutoFocus`,e.FocusIfVisible=`focusIfVisible`,e.AutoFocusImmediately=`autoFocusImmediately`})(kN||={});var AN=class extends R{constructor(){super({id:`editor.action.showHover`,label:U(1102,`Show or Focus Hover`),metadata:{description:U(1103,`Show or focus the editor hover which shows documentation, references, and other content for a symbol at the current cursor position.`),args:[{name:`args`,schema:{type:`object`,properties:{focus:{description:`Controls if and when the hover should take focus upon being triggered by this action.`,enum:[kN.NoAutoFocus,kN.FocusIfVisible,kN.AutoFocusImmediately],enumDescriptions:[G(1099,`The hover will not automatically take focus.`),G(1100,`The hover will take focus only if it is already visible.`),G(1101,`The hover will automatically take focus when it appears.`)],default:kN.FocusIfVisible}}}}]},precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2087),weight:100}})}run(e,t,n){if(!t.hasModel())return;let r=tx.get(t);if(!r)return;let i=n?.focus,a=kN.FocusIfVisible;Object.values(kN).includes(i)?a=i:typeof i==`boolean`&&i&&(a=kN.AutoFocusImmediately);let o=e=>{let n=t.getPosition(),i=new T(n.lineNumber,n.column,n.lineNumber,n.column);r.showContentHover(i,1,2,e)},s=t.getOption(2)===2;r.isHoverVisible?a===kN.NoAutoFocus?o(s):r.focus():o(s||a===kN.AutoFocusImmediately)}},jN=class extends R{constructor(){super({id:`editor.action.showDefinitionPreviewHover`,label:U(1104,`Show Definition Preview Hover`),precondition:void 0,metadata:{description:U(1105,`Show the definition preview hover in the editor.`)}})}run(e,t){let n=tx.get(t);if(!n)return;let r=t.getPosition();if(!r)return;let i=new T(r.lineNumber,r.column,r.lineNumber,r.column),a=YM.get(t);a&&a.startFindDefinitionFromCursor(r).then(()=>{n.showContentHover(i,1,2,!0)})}},MN=class extends R{constructor(){super({id:`editor.action.hideHover`,label:U(1106,`Hide Hover`),alias:`Hide Content Hover`,precondition:void 0})}run(e,t){tx.get(t)?.hideContentHover()}},NN=class extends R{constructor(){super({id:`editor.action.scrollUpHover`,label:U(1107,`Scroll Up Hover`),precondition:y.hoverFocused,kbOpts:{kbExpr:y.hoverFocused,primary:16,weight:100},metadata:{description:U(1108,`Scroll up the editor hover.`)}})}run(e,t){let n=tx.get(t);n&&n.scrollUp()}},PN=class extends R{constructor(){super({id:`editor.action.scrollDownHover`,label:U(1109,`Scroll Down Hover`),precondition:y.hoverFocused,kbOpts:{kbExpr:y.hoverFocused,primary:18,weight:100},metadata:{description:U(1110,`Scroll down the editor hover.`)}})}run(e,t){let n=tx.get(t);n&&n.scrollDown()}},FN=class extends R{constructor(){super({id:`editor.action.scrollLeftHover`,label:U(1111,`Scroll Left Hover`),precondition:y.hoverFocused,kbOpts:{kbExpr:y.hoverFocused,primary:15,weight:100},metadata:{description:U(1112,`Scroll left the editor hover.`)}})}run(e,t){let n=tx.get(t);n&&n.scrollLeft()}},IN=class extends R{constructor(){super({id:`editor.action.scrollRightHover`,label:U(1113,`Scroll Right Hover`),precondition:y.hoverFocused,kbOpts:{kbExpr:y.hoverFocused,primary:17,weight:100},metadata:{description:U(1114,`Scroll right the editor hover.`)}})}run(e,t){let n=tx.get(t);n&&n.scrollRight()}},LN=class extends R{constructor(){super({id:`editor.action.pageUpHover`,label:U(1115,`Page Up Hover`),precondition:y.hoverFocused,kbOpts:{kbExpr:y.hoverFocused,primary:11,secondary:[528],weight:100},metadata:{description:U(1116,`Page up the editor hover.`)}})}run(e,t){let n=tx.get(t);n&&n.pageUp()}},RN=class extends R{constructor(){super({id:`editor.action.pageDownHover`,label:U(1117,`Page Down Hover`),precondition:y.hoverFocused,kbOpts:{kbExpr:y.hoverFocused,primary:12,secondary:[530],weight:100},metadata:{description:U(1118,`Page down the editor hover.`)}})}run(e,t){let n=tx.get(t);n&&n.pageDown()}},zN=class extends R{constructor(){super({id:`editor.action.goToTopHover`,label:U(1119,`Go To Top Hover`),precondition:y.hoverFocused,kbOpts:{kbExpr:y.hoverFocused,primary:14,secondary:[2064],weight:100},metadata:{description:U(1120,`Go to the top of the editor hover.`)}})}run(e,t){let n=tx.get(t);n&&n.goToTop()}},BN=class extends R{constructor(){super({id:`editor.action.goToBottomHover`,label:U(1121,`Go To Bottom Hover`),precondition:y.hoverFocused,kbOpts:{kbExpr:y.hoverFocused,primary:13,secondary:[2066],weight:100},metadata:{description:U(1122,`Go to the bottom of the editor hover.`)}})}run(e,t){let n=tx.get(t);n&&n.goToBottom()}},VN=class extends R{constructor(){super({id:S_,label:C_,alias:`Increase Hover Verbosity Level`,precondition:y.hoverVisible})}run(e,t,n){let r=tx.get(t);if(!r)return;let i=n?.index===void 0?r.focusedHoverPartIndex():n.index;r.updateHoverVerbosityLevel(hu.Increase,i,n?.focus)}},HN=class extends R{constructor(){super({id:w_,label:T_,alias:`Decrease Hover Verbosity Level`,precondition:y.hoverVisible})}run(e,t,n){let r=tx.get(t);if(!r)return;let i=n?.index===void 0?r.focusedHoverPartIndex():n.index;tx.get(t)?.updateHoverVerbosityLevel(hu.Decrease,i,n?.focus)}},UN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},WN=function(e,t){return function(n,r){t(n,r,e)}},GN=b,KN=class{constructor(e,t,n){this.owner=e,this.range=t,this.marker=n}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},qN={type:1,filter:{include:Ph.QuickFix},triggerAction:Fh.QuickFixHover},JN=class{constructor(e,t,n,r){this._editor=e,this._markerDecorationsService=t,this._openerService=n,this._languageFeaturesService=r,this.hoverOrdinal=1,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1&&!e.supportsMarkerHover)return[];let n=this._editor.getModel(),r=e.range;if(!n.isValidRange(e.range))return[];let i=r.startLineNumber,a=n.getLineMaxColumn(i),o=[];for(let r of t){let t=r.range.startLineNumber===i?r.range.startColumn:1,s=r.range.endLineNumber===i?r.range.endColumn:a,c=this._markerDecorationsService.getMarker(n.uri,r);if(!c)continue;let l=new T(e.range.startLineNumber,t,e.range.startLineNumber,s);o.push(new KN(this,l,c))}return o}renderHoverParts(e,t){if(!t.length)return new r_([]);let n=[];t.forEach(t=>{let r=this._renderMarkerHover(t);e.fragment.appendChild(r.hoverElement),n.push(r)});let r=t.length===1?t[0]:t.sort((e,t)=>me.compare(e.marker.severity,t.marker.severity))[0],i=this._renderMarkerStatusbar(e,r);return new r_(n,i)}_renderMarkerHover(e){let t=new L,n=GN(`div.hover-row`),r=B(n,GN(`div.marker.hover-contents`)),{source:i,message:a,code:o,relatedInformation:s}=e.marker;this._editor.applyFontInfo(r);let c=B(r,GN(`span`));if(c.style.whiteSpace=`pre-wrap`,c.innerText=a,i||o)if(o&&typeof o!=`string`){let e=GN(`span`);if(i){let t=B(e,GN(`span`));t.innerText=i}let n=B(e,GN(`a.code-link`));n.setAttribute(`href`,o.target.toString(!0)),t.add(z(n,`click`,e=>{this._openerService.open(o.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()}));let a=B(n,GN(`span`));a.innerText=o.value;let s=B(r,e);s.style.opacity=`0.6`,s.style.paddingLeft=`6px`}else{let e=B(r,GN(`span`));e.style.opacity=`0.6`,e.style.paddingLeft=`6px`,e.innerText=i&&o?`${i}(${o})`:i||`(${o})`}if($t(s))for(let{message:e,resource:n,startLineNumber:i,startColumn:a}of s){let o=B(r,GN(`div`));o.style.marginTop=`8px`;let s=B(o,GN(`a`));s.innerText=`${$o(n)}(${i}, ${a}): `,s.style.cursor=`pointer`,t.add(z(s,`click`,e=>{if(e.stopPropagation(),e.preventDefault(),this._openerService){let e={selection:{startLineNumber:i,startColumn:a}};this._openerService.open(n,{fromUserGesture:!0,editorOptions:e}).catch(mr)}}));let c=B(o,GN(`span`));c.innerText=e,this._editor.applyFontInfo(c)}return{hoverPart:e,hoverElement:n,dispose:()=>t.dispose()}}_renderMarkerStatusbar(e,t){let n=new L;if(t.marker.severity===me.Error||t.marker.severity===me.Warning||t.marker.severity===me.Info){let n=xN.get(this._editor);n&&e.statusBar.addAction({label:G(1132,`View Problem`),commandId:CN.ID,run:()=>{e.hide(),n.showAtMarker(t.marker),this._editor.focus()}})}if(!this._editor.getOption(104)){let r=e.statusBar.append(GN(`div`));this.recentMarkerCodeActionsInfo&&(lr.makeKey(this.recentMarkerCodeActionsInfo.marker)===lr.makeKey(t.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(r.textContent=G(1133,`No quick fixes available`)):this.recentMarkerCodeActionsInfo=void 0);let i=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?x.None:$e(()=>r.textContent=G(1134,`Checking for quick fixes...`),200,n);r.textContent||=`\xA0`;let a=this.getCodeActions(t.marker);n.add(Cl(()=>a.cancel())),a.then(a=>{if(i.dispose(),this.recentMarkerCodeActionsInfo={marker:t.marker,hasCodeActions:a.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions){a.dispose(),r.textContent=G(1135,`No quick fixes available`);return}r.style.display=`none`;let o=!1;n.add(Cl(()=>{o||a.dispose()})),e.statusBar.addAction({label:G(1136,`Quick Fix...`),commandId:Hh,run:t=>{o=!0;let n=kg.get(this._editor),r=vs(t);e.hide(),n?.showCodeActions(qN,a,{x:r.left,y:r.top,width:r.width,height:r.height})}});let s=a.validActions.find(e=>e.action.isAI);s&&e.statusBar.addAction({label:s.action.title,commandId:s.action.command?.id??``,iconClass:I.asClassName(X.sparkle),run:()=>{kg.get(this._editor)?.applyCodeAction(s,!1,!1,eg.FromProblemsHover)}}),e.onContentsChanged()},mr)}return n}getCodeActions(e){return li(t=>Xh(this._languageFeaturesService.codeActionProvider,this._editor.getModel(),new T(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),qN,ol.None,t))}};JN=UN([WN(1,Yi),WN(2,da),WN(3,H)],JN);var YN=class{constructor(e){this._editor=e}computeSync(e){let t=e=>({value:e}),n=this._editor.getLineDecorations(e.lineNumber),r=[],i=e.laneOrLine===`lineNo`;if(!n)return r;for(let a of n){let n=a.options.glyphMargin?.position??Rn.Center;if(!i&&n!==e.laneOrLine)continue;let o=i?a.options.lineNumberHoverMessage:a.options.glyphMarginHoverMessage;!o||dt(o)||r.push(...Sn(o).map(t))}return r}},XN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ZN=function(e,t){return function(n,r){t(n,r,e)}},QN,$N=b,eP=class extends x{static{QN=this}static{this.ID=`editor.contrib.modesGlyphHoverWidget`}constructor(e,t,n){super(),this._renderDisposeables=this._register(new L),this._editor=e,this._isVisible=!1,this._messages=[],this._hover=this._register(new v(!0)),this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible),this._markdownRenderer=new et({editor:this._editor},t,n),this._hoverOperation=this._register(new U_(this._editor,new YN(this._editor))),this._register(this._hoverOperation.onResult(e=>this._withResult(e))),this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged())),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(59)&&this._updateFont()})),this._register(Ll(this._hover.containerDomNode,`mouseleave`,e=>{this._onMouseLeave(e)})),this._editor.addOverlayWidget(this)}dispose(){this._hoverComputerOptions=void 0,this._editor.removeOverlayWidget(this),super.dispose()}getId(){return QN.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName(`code`)).forEach(e=>this._editor.applyFontInfo(e))}_onModelDecorationsChanged(){this._isVisible&&this._hoverComputerOptions&&(this._hoverOperation.cancel(),this._hoverOperation.start(0,this._hoverComputerOptions))}showsOrWillShow(e){let t=e.target;return t.type===2&&t.detail.glyphMarginLane?(this._startShowingAt(t.position.lineNumber,t.detail.glyphMarginLane),!0):t.type===3?(this._startShowingAt(t.position.lineNumber,`lineNo`),!0):!1}_startShowingAt(e,t){this._hoverComputerOptions&&this._hoverComputerOptions.lineNumber===e&&this._hoverComputerOptions.laneOrLine===t||(this._hoverOperation.cancel(),this.hide(),this._hoverComputerOptions={lineNumber:e,laneOrLine:t},this._hoverOperation.start(0,this._hoverComputerOptions))}hide(){this._hoverComputerOptions=void 0,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible))}_withResult(e){this._messages=e.value,this._messages.length>0?this._renderMessages(e.options.lineNumber,e.options.laneOrLine,this._messages):this.hide()}_renderMessages(e,t,n){this._renderDisposeables.clear();let r=document.createDocumentFragment();for(let e of n){let t=$N(`div.hover-row.markdown-hover`),n=B(t,$N(`div.hover-contents`)),i=this._renderDisposeables.add(this._markdownRenderer.render(e.value));n.appendChild(i.element),r.appendChild(t)}this._updateContents(r),this._showAt(e,t)}_updateContents(e){this._hover.contentsDomNode.textContent=``,this._hover.contentsDomNode.appendChild(e),this._updateFont()}_showAt(e,t){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible));let n=this._editor.getLayoutInfo(),r=this._editor.getTopForLineNumber(e),i=this._editor.getScrollTop(),a=this._editor.getOption(75),o=this._hover.containerDomNode.clientHeight,s=r-i-(o-a)/2,c=n.glyphMarginLeft+n.glyphMarginWidth+(t===`lineNo`?n.lineNumbersWidth:0);this._hover.containerDomNode.style.left=`${c}px`,this._hover.containerDomNode.style.top=`${Math.max(Math.round(s),0)}px`,this._hover.containerDomNode.style.zIndex=`11`}_onMouseLeave(e){let t=this._editor.getDomNode();(!t||!V_(t,e.x,e.y))&&this.hide()}};eP=QN=XN([ZN(1,wt),ZN(2,da)],eP);var tP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},nP=function(e,t){return function(n,r){t(n,r,e)}},rP=class extends x{static{this.ID=`editor.contrib.marginHover`}constructor(e,t){super(),this._editor=e,this._instantiationService=t,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new L,this._hoverState={mouseDown:!1},this._reactToEditorMouseMoveRunner=this._register(new Zr(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(69)&&(this._unhookListeners(),this._hookListeners())}))}_hookListeners(){let e=this._editor.getOption(69);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))):(this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))),this._listenersStore.add(this._editor.onMouseLeave(e=>this._onEditorMouseLeave(e))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this.hideGlyphHover()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(e=>this._onEditorScrollChanged(e)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideGlyphHover()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._isMouseOnGlyphHoverWidget(e)&&this.hideGlyphHover()}_isMouseOnGlyphHoverWidget(e){let t=this._glyphWidget?.getDomNode();return t?V_(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),!this._isMouseOnGlyphHoverWidget(e)&&this.hideGlyphHover())}_shouldNotRecomputeCurrentHoverWidget(e){let t=this._hoverSettings.sticky,n=this._isMouseOnGlyphHoverWidget(e);return t&&n}_onEditorMouseMove(e){if(!this.shouldKeepOpenOnEditorMouseMoveOrLeave){if(this._mouseMoveEvent=e,this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}this._reactToEditorMouseMove(e)}}_reactToEditorMouseMove(e){e&&(this._tryShowHoverWidget(e)||this.hideGlyphHover())}_tryShowHoverWidget(e){return this._getOrCreateGlyphWidget().showsOrWillShow(e)}_onKeyDown(e){this._editor.hasModel()&&(e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4||this.hideGlyphHover())}hideGlyphHover(){this._glyphWidget?.hide()}_getOrCreateGlyphWidget(){return this._glyphWidget||=this._instantiationService.createInstance(eP,this._editor),this._glyphWidget}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._glyphWidget?.dispose()}};rP=tP([nP(1,k)],rP);var iP=class{},aP=class{},oP=class{};K(tx.ID,tx,2),K(rP.ID,rP,2),q(AN),q(jN),q(MN),q(NN),q(PN),q(FN),q(IN),q(LN),q(RN),q(zN),q(BN),q(VN),q(HN),i_.register(bv),i_.register(JN),ta((e,t)=>{let n=e.getColor(Co);n&&(t.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${n.transparent(.5)}; }`),t.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${n.transparent(.5)}; }`),t.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${n.transparent(.5)}; }`))}),CT.register(new iP),CT.register(new aP),CT.register(new oP);function sP(e,t){let n=0;for(let r=0;r<e.length;r++)e.charAt(r)===`	`?n+=t:n++;return n}function cP(e,t,n){e=e<0?0:e;let r=``;if(!n){let n=Math.floor(e/t);e%=t;for(let e=0;e<n;e++)r+=`	`}for(let t=0;t<e;t++)r+=` `;return r}function lP(e,t,n,r){if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return[];let i=t.getLanguageConfiguration(e.getLanguageId()).indentRulesSupport;if(!i)return[];let a=new qc(e,i,t);for(r=Math.min(r,e.getLineCount());n<=r&&a.shouldIgnore(n);)n++;if(n>r-1)return[];let{tabSize:o,indentSize:s,insertSpaces:c}=e.getOptions(),l=(e,t)=>(t||=1,Ms.shiftIndent(e,e.length+t,o,s,c)),u=(e,t)=>(t||=1,Ms.unshiftIndent(e,e.length+t,o,s,c)),d=[],f=e.getLineContent(n),p=St(f),m=p;a.shouldIncrease(n)?(m=l(m),p=l(p)):a.shouldIndentNextLine(n)&&(m=l(m)),n++;for(let t=n;t<=r;t++){if(uP(e,t))continue;let n=e.getLineContent(t),r=St(n),i=m;a.shouldDecrease(t,i)&&(m=u(m),p=u(p)),r!==m&&d.push(Ss.replaceMove(new P(t,1,t,r.length+1),bs(m,s,c))),!a.shouldIgnore(t)&&(a.shouldIncrease(t,i)?(p=l(p),m=p):m=a.shouldIndentNextLine(t,i)?l(m):p)}return d}function uP(e,t){return e.tokenization.isCheapToTokenize(t)?e.tokenization.getLineTokens(t).getStandardTokenType(0)===2:!1}var dP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fP=function(e,t){return function(n,r){t(n,r,e)}},pP=class e extends R{static{this.ID=`editor.action.indentationToSpaces`}constructor(){super({id:e.ID,label:U(1141,`Convert Indentation to Spaces`),precondition:y.writable,metadata:{description:U(1142,`Convert the tab indentation to spaces.`)}})}run(e,t){let n=t.getModel();if(!n)return;let r=n.getOptions(),i=t.getSelection();if(!i)return;let a=new EP(i,r.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[a]),t.pushUndoStop(),n.updateOptions({insertSpaces:!0})}},mP=class e extends R{static{this.ID=`editor.action.indentationToTabs`}constructor(){super({id:e.ID,label:U(1143,`Convert Indentation to Tabs`),precondition:y.writable,metadata:{description:U(1144,`Convert the spaces indentation to tabs.`)}})}run(e,t){let n=t.getModel();if(!n)return;let r=n.getOptions(),i=t.getSelection();if(!i)return;let a=new DP(i,r.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[a]),t.pushUndoStop(),n.updateOptions({insertSpaces:!1})}},hP=class extends R{constructor(e,t,n){super(n),this.insertSpaces=e,this.displaySizeOnly=t}run(e,t){let n=e.get(Mu),r=e.get(_n),i=t.getModel();if(!i)return;let a=r.getCreationOptions(i.getLanguageId(),i.uri,i.isForSimpleWidget),o=i.getOptions(),s=[1,2,3,4,5,6,7,8].map(e=>({id:e.toString(),label:e.toString(),description:e===a.tabSize&&e===o.tabSize?G(1137,`Configured Tab Size`):e===a.tabSize?G(1138,`Default Tab Size`):e===o.tabSize?G(1139,`Current Tab Size`):void 0})),c=Math.min(i.getOptions().tabSize-1,7);setTimeout(()=>{n.pick(s,{placeHolder:G(1140,`Select Tab Size for Current File`),activeItem:s[c]}).then(e=>{if(e&&i&&!i.isDisposed()){let t=parseInt(e.label,10);this.displaySizeOnly?i.updateOptions({tabSize:t}):i.updateOptions({tabSize:t,indentSize:t,insertSpaces:this.insertSpaces})}})},50)}},gP=class e extends hP{static{this.ID=`editor.action.indentUsingTabs`}constructor(){super(!1,!1,{id:e.ID,label:U(1145,`Indent Using Tabs`),precondition:void 0,metadata:{description:U(1146,`Use indentation with tabs.`)}})}},_P=class e extends hP{static{this.ID=`editor.action.indentUsingSpaces`}constructor(){super(!0,!1,{id:e.ID,label:U(1147,`Indent Using Spaces`),precondition:void 0,metadata:{description:U(1148,`Use indentation with spaces.`)}})}},vP=class e extends hP{static{this.ID=`editor.action.changeTabDisplaySize`}constructor(){super(!0,!0,{id:e.ID,label:U(1149,`Change Tab Display Size`),precondition:void 0,metadata:{description:U(1150,`Change the space size equivalent of the tab.`)}})}},yP=class e extends R{static{this.ID=`editor.action.detectIndentation`}constructor(){super({id:e.ID,label:U(1151,`Detect Indentation from Content`),precondition:void 0,metadata:{description:U(1152,`Detect the indentation from content.`)}})}run(e,t){let n=e.get(_n),r=t.getModel();if(!r)return;let i=n.getCreationOptions(r.getLanguageId(),r.uri,r.isForSimpleWidget);r.detectIndentation(i.insertSpaces,i.tabSize)}},bP=class extends R{constructor(){super({id:`editor.action.reindentlines`,label:U(1153,`Reindent Lines`),precondition:y.writable,metadata:{description:U(1154,`Reindent the lines of the editor.`)}})}run(e,t){let n=e.get(Ce),r=t.getModel();if(!r)return;let i=lP(r,n,1,r.getLineCount());i.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,i),t.pushUndoStop())}},xP=class extends R{constructor(){super({id:`editor.action.reindentselectedlines`,label:U(1155,`Reindent Selected Lines`),precondition:y.writable,metadata:{description:U(1156,`Reindent the selected lines of the editor.`)}})}run(e,t){let n=e.get(Ce),r=t.getModel();if(!r)return;let i=t.getSelections();if(i===null)return;let a=[];for(let e of i){let t=e.startLineNumber,i=e.endLineNumber;if(t!==i&&e.endColumn===1&&i--,t===1){if(t===i)continue}else t--;let o=lP(r,n,t,i);a.push(...o)}a.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,a),t.pushUndoStop())}},SP=class{constructor(e,t){this._initialSelection=t,this._edits=[],this._selectionId=null;for(let t of e)t.range&&typeof t.text==`string`&&this._edits.push(t)}getEditOperations(e,t){for(let e of this._edits)t.addEditOperation(T.lift(e.range),e.text);let n=!1;Array.isArray(this._edits)&&this._edits.length===1&&this._initialSelection.isEmpty()&&(this._edits[0].range.startColumn===this._initialSelection.endColumn&&this._edits[0].range.startLineNumber===this._initialSelection.endLineNumber?(n=!0,this._selectionId=t.trackSelection(this._initialSelection,!0)):this._edits[0].range.endColumn===this._initialSelection.startColumn&&this._edits[0].range.endLineNumber===this._initialSelection.startLineNumber&&(n=!0,this._selectionId=t.trackSelection(this._initialSelection,!1))),n||(this._selectionId=t.trackSelection(this._initialSelection))}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}},CP=class{static{this.ID=`editor.contrib.autoIndentOnPaste`}constructor(e,t){this.editor=e,this._languageConfigurationService=t,this.callOnDispose=new L,this.callOnModel=new L,this.callOnDispose.add(e.onDidChangeConfiguration(()=>this.update())),this.callOnDispose.add(e.onDidChangeModel(()=>this.update())),this.callOnDispose.add(e.onDidChangeModelLanguage(()=>this.update()))}update(){this.callOnModel.clear(),!(!this.editor.getOption(17)||this.editor.getOption(16)<4)&&this.editor.hasModel()&&this.callOnModel.add(this.editor.onDidPaste(({range:e})=>{this.trigger(e)}))}trigger(e){let t=this.editor.getSelections();if(t===null||t.length>1)return;let n=this.editor.getModel();if(!n||this.rangeContainsOnlyWhitespaceCharacters(n,e)||!this.editor.getOption(18)&&wP(n,e)||!n.tokenization.isCheapToTokenize(e.getStartPosition().lineNumber))return;let r=this.editor.getOption(16),{tabSize:i,indentSize:a,insertSpaces:o}=n.getOptions(),s=[],c={shiftIndent:e=>Ms.shiftIndent(e,e.length+1,i,a,o),unshiftIndent:e=>Ms.unshiftIndent(e,e.length+1,i,a,o)},l=e.startLineNumber,u=n.getLineContent(l);if(!/\S/.test(u.substring(0,e.startColumn-1))){let e=Ic(r,n,n.getLanguageId(),l,c,this._languageConfigurationService);if(e!==null){let t=St(u),r=sP(e,i),a=sP(t,i);if(r!==a){let e=cP(r,i,o);s.push({range:new T(l,1,l,t.length+1),text:e}),u=e+u.substring(t.length)}else{let e=Ol(n,l,this._languageConfigurationService);if(e===0||e===8)return}}}let d=l;for(;l<e.endLineNumber;){if(!/\S/.test(n.getLineContent(l+1))){l++;continue}break}if(l!==e.endLineNumber){let t=Ic(r,{tokenization:{getLineTokens:e=>n.tokenization.getLineTokens(e),getLanguageId:()=>n.getLanguageId(),getLanguageIdAtPosition:(e,t)=>n.getLanguageIdAtPosition(e,t)},getLineContent:e=>e===d?u:n.getLineContent(e)},n.getLanguageId(),l+1,c,this._languageConfigurationService);if(t!==null){let r=sP(t,i),a=sP(St(n.getLineContent(l+1)),i);if(r!==a){let t=r-a;for(let r=l+1;r<=e.endLineNumber;r++){let e=n.getLineContent(r),a=St(e),c=sP(a,i)+t,l=cP(c,i,o);l!==a&&s.push({range:new T(r,1,r,a.length+1),text:l})}}}}if(s.length>0){this.editor.pushUndoStop();let e=new SP(s,this.editor.getSelection());this.editor.executeCommand(`autoIndentOnPaste`,e),this.editor.pushUndoStop()}}rangeContainsOnlyWhitespaceCharacters(e,t){let n=e=>e.trim().length===0,r=!0;if(t.startLineNumber===t.endLineNumber){let i=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);r=n(i)}else for(let i=t.startLineNumber;i<=t.endLineNumber;i++){let a=e.getLineContent(i);if(i===t.startLineNumber){let e=a.substring(t.startColumn-1);r=n(e)}else if(i===t.endLineNumber){let e=a.substring(0,t.endColumn-1);r=n(e)}else r=e.getLineFirstNonWhitespaceColumn(i)===0;if(!r)break}return r}dispose(){this.callOnDispose.dispose(),this.callOnModel.dispose()}};CP=dP([fP(1,Ce)],CP);function wP(e,t){let n=t=>Fs(e,t)===2;return n(t.getStartPosition())||n(t.getEndPosition())}function TP(e,t,n,r){if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return;let i=``;for(let e=0;e<n;e++)i+=` `;let a=new RegExp(i,`gi`);for(let n=1,o=e.getLineCount();n<=o;n++){let o=e.getLineFirstNonWhitespaceColumn(n);if(o===0&&(o=e.getLineMaxColumn(n)),o===1)continue;let s=new T(n,1,n,o),c=e.getValueInRange(s),l=r?c.replace(/\t/gi,i):c.replace(a,`	`);t.addEditOperation(s,l)}}var EP=class{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),TP(e,t,this.tabSize,!0)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}},DP=class{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),TP(e,t,this.tabSize,!1)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}};K(CP.ID,CP,2),q(pP),q(mP),q(gP),q(_P),q(vP),q(yP),q(bP),q(xP),K(Fb.ID,Fb,1),i_.register(Bb);var OP=class{constructor(e,t,n){this._editRange=e,this._originalSelection=t,this._text=n}getEditOperations(e,t){t.addTrackedEditOperation(this._editRange,this._text)}computeCursorState(e,t){let n=t.getInverseEditOperations()[0].range;return this._originalSelection.isEmpty()?new P(n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn),n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn)):new P(n.endLineNumber,n.endColumn-this._text.length,n.endLineNumber,n.endColumn)}},kP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},AP=function(e,t){return function(n,r){t(n,r,e)}},jP,MP=class{static{jP=this}static{this.ID=`editor.contrib.inPlaceReplaceController`}static get(e){return e.getContribution(jP.ID)}static{this.DECORATION=Y.register({description:`in-place-replace`,className:`valueSetReplacement`})}constructor(e,t){this.editor=e,this.editorWorkerService=t,this.decorations=this.editor.createDecorationsCollection()}dispose(){}run(e,t){this.currentRequest?.cancel();let n=this.editor.getSelection(),r=this.editor.getModel();if(!r||!n)return;let i=n;if(i.startLineNumber!==i.endLineNumber)return;let a=new De(this.editor,5),o=r.uri;return this.editorWorkerService.canNavigateValueSet(o)?(this.currentRequest=li(e=>this.editorWorkerService.navigateValueSet(o,i,t)),this.currentRequest.then(t=>{if(!t||!t.range||!t.value||!a.validate(this.editor))return;let n=T.lift(t.range),r=t.range,o=t.value.length-(i.endColumn-i.startColumn);r={startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.endLineNumber,endColumn:r.startColumn+t.value.length},o>1&&(i=new P(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn+o-1));let s=new OP(n,i,t.value);this.editor.pushUndoStop(),this.editor.executeCommand(e,s),this.editor.pushUndoStop(),this.decorations.set([{range:r,options:jP.DECORATION}]),this.decorationRemover?.cancel(),this.decorationRemover=le(350),this.decorationRemover.then(()=>this.decorations.clear()).catch(mr)}).catch(mr)):Promise.resolve(void 0)}};MP=jP=kP([AP(1,Xs)],MP);var NP=class extends R{constructor(){super({id:`editor.action.inPlaceReplace.up`,label:U(1230,`Replace with Previous Value`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:3159,weight:100}})}run(e,t){let n=MP.get(t);return n?n.run(this.id,!1):Promise.resolve(void 0)}},PP=class extends R{constructor(){super({id:`editor.action.inPlaceReplace.down`,label:U(1231,`Replace with Next Value`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:3161,weight:100}})}run(e,t){let n=MP.get(t);return n?n.run(this.id,!0):Promise.resolve(void 0)}};K(MP.ID,MP,4),q(NP),q(PP);var FP=class{constructor(e){this._selection=e,this._selectionId=null}getEditOperations(e,t){let n=IP(e);n&&t.addEditOperation(n.range,n.text),this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}};function IP(e){let t=e.getLineCount(),n=e.getLineContent(t),r=Or(n)===-1;if(!(!t||r))return Ss.insert(new C(t,e.getLineMaxColumn(t)),e.getEOL())}var LP=class e extends R{static{this.ID=`editor.action.insertFinalNewLine`}constructor(){super({id:e.ID,label:U(1232,`Insert Final New Line`),precondition:y.writable})}run(e,t,n){let r=t.getSelection();if(r===null)return;let i=new FP(r);t.pushUndoStop(),t.executeCommands(this.id,[i]),t.pushUndoStop()}};q(LP),q(class extends R{constructor(){super({id:`expandLineSelection`,label:U(1233,`Expand Line Selection`),precondition:void 0,kbOpts:{weight:0,kbExpr:y.textInputFocus,primary:2090}})}run(e,t,n){if(n||={},!t.hasModel())return;let r=t._getViewModel();r.model.pushStackElement(),r.setCursorStates(n.source,3,zl.expandLineSelection(r,r.getCursorStates())),r.revealAllCursors(n.source,!0)}});var RP=class{constructor(e,t,n){this._selection=e,this._cursors=t,this._selectionId=null,this._trimInRegexesAndStrings=n}getEditOperations(e,t){let n=zP(e,this._cursors,this._trimInRegexesAndStrings);for(let e=0,r=n.length;e<r;e++){let r=n[e];t.addEditOperation(r.range,r.text)}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}};function zP(e,t,n){t.sort((e,t)=>e.lineNumber===t.lineNumber?e.column-t.column:e.lineNumber-t.lineNumber);for(let e=t.length-2;e>=0;e--)t[e].lineNumber===t[e+1].lineNumber&&t.splice(e,1);let r=[],i=0,a=0,o=t.length;for(let s=1,c=e.getLineCount();s<=c;s++){let c=e.getLineContent(s),l=c.length+1,u=0;if(a<o&&t[a].lineNumber===s&&(u=t[a].column,a++,u===l)||c.length===0)continue;let d=Or(c),f=0;if(d===-1)f=1;else if(d!==c.length-1)f=d+2;else continue;if(!n){if(!e.tokenization.hasAccurateTokensForLine(s))continue;let t=e.tokenization.getLineTokens(s),n=t.getStandardTokenType(t.findTokenIndexAtOffset(f));if(n===2||n===3)continue}f=Math.max(u,f),r[i++]=Ss.delete(new T(s,f,s,l))}return r}var BP=class{constructor(e,t,n){this._selection=e,this._isCopyingDown=t,this._noop=n||!1,this._selectionDirection=0,this._selectionId=null,this._startLineNumberDelta=0,this._endLineNumberDelta=0}getEditOperations(e,t){let n=this._selection;this._startLineNumberDelta=0,this._endLineNumberDelta=0,n.startLineNumber<n.endLineNumber&&n.endColumn===1&&(this._endLineNumberDelta=1,n=n.setEndPosition(n.endLineNumber-1,e.getLineMaxColumn(n.endLineNumber-1)));let r=[];for(let t=n.startLineNumber;t<=n.endLineNumber;t++)r.push(e.getLineContent(t));let i=r.join(`
`);i===``&&this._isCopyingDown&&(this._startLineNumberDelta++,this._endLineNumberDelta++),this._noop?t.addEditOperation(new T(n.endLineNumber,e.getLineMaxColumn(n.endLineNumber),n.endLineNumber+1,1),n.endLineNumber===e.getLineCount()?``:`
`):this._isCopyingDown?t.addEditOperation(new T(n.startLineNumber,1,n.startLineNumber,1),i+`
`):t.addEditOperation(new T(n.endLineNumber,e.getLineMaxColumn(n.endLineNumber),n.endLineNumber,e.getLineMaxColumn(n.endLineNumber)),`
`+i),this._selectionId=t.trackSelection(n),this._selectionDirection=this._selection.getDirection()}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);if(this._startLineNumberDelta!==0||this._endLineNumberDelta!==0){let e=n.startLineNumber,t=n.startColumn,r=n.endLineNumber,i=n.endColumn;this._startLineNumberDelta!==0&&(e+=this._startLineNumberDelta,t=1),this._endLineNumberDelta!==0&&(r+=this._endLineNumberDelta,i=1),n=P.createWithDirection(e,t,r,i,this._selectionDirection)}return n}},VP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},HP=function(e,t){return function(n,r){t(n,r,e)}},UP=class{constructor(e,t,n,r){this._languageConfigurationService=r,this._selection=e,this._isMovingDown=t,this._autoIndent=n,this._selectionId=null,this._moveEndLineSelectionShrink=!1}getEditOperations(e,t){let n=()=>e.getLanguageId(),r=(t,n)=>e.getLanguageIdAtPosition(t,n),i=e.getLineCount();if(this._isMovingDown&&this._selection.endLineNumber===i){this._selectionId=t.trackSelection(this._selection);return}if(!this._isMovingDown&&this._selection.startLineNumber===1){this._selectionId=t.trackSelection(this._selection);return}this._moveEndPositionDown=!1;let a=this._selection;a.startLineNumber<a.endLineNumber&&a.endColumn===1&&(this._moveEndPositionDown=!0,a=a.setEndPosition(a.endLineNumber-1,e.getLineMaxColumn(a.endLineNumber-1)));let{tabSize:o,indentSize:s,insertSpaces:c}=e.getOptions(),l=this.buildIndentConverter(o,s,c);if(a.startLineNumber===a.endLineNumber&&e.getLineMaxColumn(a.startLineNumber)===1){let n=a.startLineNumber,r=this._isMovingDown?n+1:n-1;e.getLineMaxColumn(r)===1?t.addEditOperation(new T(1,1,1,1),null):(t.addEditOperation(new T(n,1,n,1),e.getLineContent(r)),t.addEditOperation(new T(r,1,r,e.getLineMaxColumn(r)),null)),a=new P(r,1,r,1)}else{let i,s;if(this._isMovingDown){i=a.endLineNumber+1,s=e.getLineContent(i),t.addEditOperation(new T(i-1,e.getLineMaxColumn(i-1),i,e.getLineMaxColumn(i)),null);let u=s;if(this.shouldAutoIndent(e,a)){let d=this.matchEnterRule(e,l,o,i,a.startLineNumber-1);if(d!==null){let t=St(e.getLineContent(i)),n=d+sP(t,o);u=cP(n,o,c)+this.trimStart(s)}else{let t={tokenization:{getLineTokens:t=>t===a.startLineNumber?e.tokenization.getLineTokens(i):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===a.startLineNumber?e.getLineContent(i):e.getLineContent(t)},d=Ic(this._autoIndent,t,e.getLanguageIdAtPosition(i,1),a.startLineNumber,l,this._languageConfigurationService);if(d!==null){let t=St(e.getLineContent(i)),n=sP(d,o),r=sP(t,o);n!==r&&(u=cP(n,o,c)+this.trimStart(s))}}t.addEditOperation(new T(a.startLineNumber,1,a.startLineNumber,1),u+`
`);let f=this.matchEnterRuleMovingDown(e,l,o,a.startLineNumber,i,u);if(f!==null)f!==0&&this.getIndentEditsOfMovingBlock(e,t,a,o,c,f);else{let s={tokenization:{getLineTokens:t=>t===a.startLineNumber?e.tokenization.getLineTokens(i):t>=a.startLineNumber+1&&t<=a.endLineNumber+1?e.tokenization.getLineTokens(t-1):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===a.startLineNumber?u:t>=a.startLineNumber+1&&t<=a.endLineNumber+1?e.getLineContent(t-1):e.getLineContent(t)},d=Ic(this._autoIndent,s,e.getLanguageIdAtPosition(i,1),a.startLineNumber+1,l,this._languageConfigurationService);if(d!==null){let n=St(e.getLineContent(a.startLineNumber)),r=sP(d,o),i=sP(n,o);if(r!==i){let n=r-i;this.getIndentEditsOfMovingBlock(e,t,a,o,c,n)}}}}else t.addEditOperation(new T(a.startLineNumber,1,a.startLineNumber,1),u+`
`)}else if(i=a.startLineNumber-1,s=e.getLineContent(i),t.addEditOperation(new T(i,1,i+1,1),null),t.addEditOperation(new T(a.endLineNumber,e.getLineMaxColumn(a.endLineNumber),a.endLineNumber,e.getLineMaxColumn(a.endLineNumber)),`
`+s),this.shouldAutoIndent(e,a)){let s={tokenization:{getLineTokens:t=>t===i?e.tokenization.getLineTokens(a.startLineNumber):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===i?e.getLineContent(a.startLineNumber):e.getLineContent(t)},u=this.matchEnterRule(e,l,o,a.startLineNumber,a.startLineNumber-2);if(u!==null)u!==0&&this.getIndentEditsOfMovingBlock(e,t,a,o,c,u);else{let n=Ic(this._autoIndent,s,e.getLanguageIdAtPosition(a.startLineNumber,1),i,l,this._languageConfigurationService);if(n!==null){let r=St(e.getLineContent(a.startLineNumber)),i=sP(n,o),s=sP(r,o);if(i!==s){let n=i-s;this.getIndentEditsOfMovingBlock(e,t,a,o,c,n)}}}}}this._selectionId=t.trackSelection(a)}buildIndentConverter(e,t,n){return{shiftIndent:r=>Ms.shiftIndent(r,r.length+1,e,t,n),unshiftIndent:r=>Ms.unshiftIndent(r,r.length+1,e,t,n)}}parseEnterResult(e,t,n,r,i){if(i){let a=i.indentation;i.indentAction===rn.None||i.indentAction===rn.Indent?a=i.indentation+i.appendText:i.indentAction===rn.IndentOutdent?a=i.indentation:i.indentAction===rn.Outdent&&(a=t.unshiftIndent(i.indentation)+i.appendText);let o=e.getLineContent(r);if(this.trimStart(o).indexOf(this.trimStart(a))>=0){let i=St(e.getLineContent(r)),o=St(a),s=Ol(e,r,this._languageConfigurationService);s!==null&&s&2&&(o=t.unshiftIndent(o));let c=sP(o,n),l=sP(i,n);return c-l}}return null}matchEnterRuleMovingDown(e,t,n,r,i,a){if(Or(a)>=0){let a=e.getLineMaxColumn(i),o=Wa(this._autoIndent,e,new T(i,a,i,a),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,o)}else{let i=r-1;for(;i>=1;){let t=e.getLineContent(i);if(Or(t)>=0)break;i--}if(i<1||r>e.getLineCount())return null;let a=e.getLineMaxColumn(i),o=Wa(this._autoIndent,e,new T(i,a,i,a),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,o)}}matchEnterRule(e,t,n,r,i,a){let o=i;for(;o>=1;){let t;if(t=o===i&&a!==void 0?a:e.getLineContent(o),Or(t)>=0)break;o--}if(o<1||r>e.getLineCount())return null;let s=e.getLineMaxColumn(o),c=Wa(this._autoIndent,e,new T(o,s,o,s),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,c)}trimStart(e){return e.replace(/^\s+/,``)}shouldAutoIndent(e,t){if(this._autoIndent<4||!e.tokenization.isCheapToTokenize(t.startLineNumber))return!1;let n=e.getLanguageIdAtPosition(t.startLineNumber,1),r=e.getLanguageIdAtPosition(t.endLineNumber,1);return!(n!==r||this._languageConfigurationService.getLanguageConfiguration(n).indentRulesSupport===null)}getIndentEditsOfMovingBlock(e,t,n,r,i,a){for(let o=n.startLineNumber;o<=n.endLineNumber;o++){let s=e.getLineContent(o),c=St(s),l=sP(c,r)+a,u=cP(l,r,i);u!==c&&(t.addEditOperation(new T(o,1,o,c.length+1),u),o===n.endLineNumber&&n.endColumn<=c.length+1&&u===``&&(this._moveEndLineSelectionShrink=!0))}}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(n=n.setEndPosition(n.endLineNumber+1,1)),this._moveEndLineSelectionShrink&&n.startLineNumber<n.endLineNumber&&(n=n.setEndPosition(n.endLineNumber,2)),n}};UP=VP([HP(3,Ce)],UP);var WP=class{static{this._COLLATOR=En.Collator()}constructor(e,t){this.selection=e,this.descending=t,this.selectionId=null}getEditOperations(e,t){let n=KP(e,this.selection,this.descending);n&&t.addEditOperation(n.range,n.text),this.selectionId=t.trackSelection(this.selection)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}static canRun(e,t,n){if(e===null)return!1;let r=GP(e,t,n);if(!r)return!1;for(let e=0,t=r.before.length;e<t;e++)if(r.before[e]!==r.after[e])return!0;return!1}};function GP(e,t,n){let r=t.startLineNumber,i=t.endLineNumber;if(t.endColumn===1&&i--,r>=i)return null;let a=[];for(let t=r;t<=i;t++)a.push(e.getLineContent(t));let o=a.slice(0);return o.sort(WP._COLLATOR.value.compare),n===!0&&(o=o.reverse()),{startLineNumber:r,endLineNumber:i,before:a,after:o}}function KP(e,t,n){let r=GP(e,t,n);return r?Ss.replace(new T(r.startLineNumber,1,r.endLineNumber,e.getLineMaxColumn(r.endLineNumber)),r.after.join(`
`)):null}var qP=class extends R{constructor(e,t){super(t),this.down=e}run(e,t){if(!t.hasModel())return;let n=t.getSelections().map((e,t)=>({selection:e,index:t,ignore:!1}));n.sort((e,t)=>T.compareRangesUsingStarts(e.selection,t.selection));let r=n[0];for(let e=1;e<n.length;e++){let t=n[e];r.selection.endLineNumber===t.selection.startLineNumber&&(r.index<t.index?t.ignore=!0:(r.ignore=!0,r=t))}let i=[];for(let e of n)i.push(new BP(e.selection,this.down,e.ignore));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},JP=class extends qP{constructor(){super(!1,{id:`editor.action.copyLinesUpAction`,label:U(1239,`Copy Line Up`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:1552,linux:{primary:3600},weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`2_line`,title:G(1234,`&&Copy Line Up`),order:1}})}},YP=class extends qP{constructor(){super(!0,{id:`editor.action.copyLinesDownAction`,label:U(1240,`Copy Line Down`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:1554,linux:{primary:3602},weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`2_line`,title:G(1235,`Co&&py Line Down`),order:2}})}},XP=class extends R{constructor(){super({id:`editor.action.duplicateSelection`,label:U(1241,`Duplicate Selection`),precondition:y.writable,menuOpts:{menuId:S.MenubarSelectionMenu,group:`2_line`,title:G(1236,`&&Duplicate Selection`),order:5}})}run(e,t,n){if(!t.hasModel())return;let r=[],i=t.getSelections(),a=t.getModel();for(let e of i)if(e.isEmpty())r.push(new BP(e,!0));else{let t=new P(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn);r.push(new il(t,a.getValueInRange(e)))}t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}},ZP=class extends R{constructor(e,t){super(t),this.down=e}run(e,t){let n=e.get(Ce),r=[],i=t.getSelections()||[],a=t.getOption(16);for(let e of i)r.push(new UP(e,this.down,a,n));t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}},QP=class extends ZP{constructor(){super(!1,{id:`editor.action.moveLinesUpAction`,label:U(1242,`Move Line Up`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:528,linux:{primary:528},weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`2_line`,title:G(1237,`Mo&&ve Line Up`),order:3}})}},$P=class extends ZP{constructor(){super(!0,{id:`editor.action.moveLinesDownAction`,label:U(1243,`Move Line Down`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:530,linux:{primary:530},weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`2_line`,title:G(1238,`Move &&Line Down`),order:4}})}},eF=class extends R{constructor(e,t){super(t),this.descending=e}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=t.getSelections();r.length===1&&r[0].isEmpty()&&(r=[new P(1,1,n.getLineCount(),n.getLineMaxColumn(n.getLineCount()))]);for(let e of r)if(!WP.canRun(t.getModel(),e,this.descending))return;let i=[];for(let e=0,t=r.length;e<t;e++)i[e]=new WP(r[e],this.descending);t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},tF=class extends eF{constructor(){super(!1,{id:`editor.action.sortLinesAscending`,label:U(1244,`Sort Lines Ascending`),precondition:y.writable})}},nF=class extends eF{constructor(){super(!0,{id:`editor.action.sortLinesDescending`,label:U(1245,`Sort Lines Descending`),precondition:y.writable})}},rF=class extends R{constructor(){super({id:`editor.action.removeDuplicateLines`,label:U(1246,`Delete Duplicate Lines`),precondition:y.writable})}run(e,t){if(!t.hasModel())return;let n=t.getModel();if(n.getLineCount()===1&&n.getLineMaxColumn(1)===1)return;let r=[],i=[],a=0,o=!0,s=t.getSelections();s.length===1&&s[0].isEmpty()&&(s=[new P(1,1,n.getLineCount(),n.getLineMaxColumn(n.getLineCount()))],o=!1);for(let e of s){let t=new Set,o=[];for(let r=e.startLineNumber;r<=e.endLineNumber;r++){let e=n.getLineContent(r);t.has(e)||(o.push(e),t.add(e))}let s=new P(e.startLineNumber,1,e.endLineNumber,n.getLineMaxColumn(e.endLineNumber)),c=e.startLineNumber-a,l=new P(c,1,c+o.length-1,o[o.length-1].length);r.push(Ss.replace(s,o.join(`
`))),i.push(l),a+=e.endLineNumber-e.startLineNumber+1-o.length}t.pushUndoStop(),t.executeEdits(this.id,r,o?i:void 0),t.pushUndoStop()}},iF=class extends R{constructor(){super({id:`editor.action.reverseLines`,label:U(1247,`Reverse lines`),precondition:y.writable})}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=t.getSelections(),i=r;i.length===1&&i[0].isEmpty()&&(i=[new P(1,1,n.getLineCount(),n.getLineMaxColumn(n.getLineCount()))]);let a=[],o=[];for(let e=0;e<i.length;e++){let t=i[e],s=r[e],c=t.endLineNumber;t.startLineNumber<t.endLineNumber&&t.endColumn===1&&c--;let l=new T(t.startLineNumber,1,c,n.getLineMaxColumn(c));c===n.getLineCount()&&n.getLineContent(l.endLineNumber)===``&&(l=l.setEndPosition(l.endLineNumber-1,n.getLineMaxColumn(l.endLineNumber-1)));let u=[];for(let e=l.endLineNumber;e>=l.startLineNumber;e--)u.push(n.getLineContent(e));let d=Ss.replace(l,u.join(`
`));a.push(d);let f=function(e){return e<=l.endLineNumber?l.endLineNumber-e+l.startLineNumber:e};o.push(function(e){if(e.isEmpty())return new P(f(e.positionLineNumber),e.positionColumn,f(e.positionLineNumber),e.positionColumn);{let t=f(e.selectionStartLineNumber),n=f(e.positionLineNumber),r=e.selectionStartColumn,i=e.positionColumn;return new P(t,r,n,i)}}(s))}t.pushUndoStop(),t.executeEdits(this.id,a,o),t.pushUndoStop()}},aF=class e extends R{static{this.ID=`editor.action.trimTrailingWhitespace`}constructor(){super({id:e.ID,label:U(1248,`Trim Trailing Whitespace`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:Vn(2089,2102),weight:100}})}run(e,t,n){let r=[];n.reason===`auto-save`&&(r=(t.getSelections()||[]).map(e=>new C(e.positionLineNumber,e.positionColumn)));let i=t.getSelection();if(i===null)return;let a=e.get(hn),o=t.getModel(),s=a.getValue(`files.trimTrailingWhitespaceInRegexAndStrings`,{overrideIdentifier:o?.getLanguageId(),resource:o?.uri}),c=new RP(i,r,s);t.pushUndoStop(),t.executeCommands(this.id,[c]),t.pushUndoStop()}},oF=class extends R{constructor(){super({id:`editor.action.deleteLines`,label:U(1249,`Delete Line`),precondition:y.writable,kbOpts:{kbExpr:y.textInputFocus,primary:3113,weight:100}})}run(e,t){if(!t.hasModel())return;let n=this._getLinesToRemove(t),r=t.getModel();if(r.getLineCount()===1&&r.getLineMaxColumn(1)===1)return;let i=0,a=[],o=[];for(let e=0,t=n.length;e<t;e++){let t=n[e],s=t.startLineNumber,c=t.endLineNumber,l=1,u=r.getLineMaxColumn(c);c<r.getLineCount()?(c+=1,u=1):s>1&&(--s,l=r.getLineMaxColumn(s)),a.push(Ss.replace(new P(s,l,c,u),``)),o.push(new P(s-i,t.positionColumn,s-i,t.positionColumn)),i+=t.endLineNumber-t.startLineNumber+1}t.pushUndoStop(),t.executeEdits(this.id,a,o),t.pushUndoStop()}_getLinesToRemove(e){let t=e.getSelections().map(e=>{let t=e.endLineNumber;return e.startLineNumber<e.endLineNumber&&e.endColumn===1&&--t,{startLineNumber:e.startLineNumber,selectionStartColumn:e.selectionStartColumn,endLineNumber:t,positionColumn:e.positionColumn}});t.sort((e,t)=>e.startLineNumber===t.startLineNumber?e.endLineNumber-t.endLineNumber:e.startLineNumber-t.startLineNumber);let n=[],r=t[0];for(let e=1;e<t.length;e++)r.endLineNumber+1>=t[e].startLineNumber?r.endLineNumber=t[e].endLineNumber:(n.push(r),r=t[e]);return n.push(r),n}},sF=class extends R{constructor(){super({id:`editor.action.indentLines`,label:U(1250,`Indent Line`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:2142,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,Io.indent(n.cursorConfig,t.getModel(),t.getSelections())),t.pushUndoStop())}},cF=class extends R{constructor(){super({id:`editor.action.outdentLines`,label:U(1251,`Outdent Line`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:2140,weight:100}})}run(e,t){jr.Outdent.runEditorCommand(e,t,null)}},lF=class extends R{constructor(){super({id:`editor.action.insertLineBefore`,label:U(1252,`Insert Line Above`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:3075,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,Zl.lineInsertBefore(n.cursorConfig,t.getModel(),t.getSelections())))}},uF=class extends R{constructor(){super({id:`editor.action.insertLineAfter`,label:U(1253,`Insert Line Below`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:2051,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,Zl.lineInsertAfter(n.cursorConfig,t.getModel(),t.getSelections())))}},dF=class extends R{run(e,t){if(!t.hasModel())return;let n=t.getSelection(),r=this._getRangesToDelete(t),i=[];for(let e=0,t=r.length-1;e<t;e++){let t=r[e],n=r[e+1];T.intersectRanges(t,n)===null?i.push(t):r[e+1]=T.plusRange(t,n)}i.push(r[r.length-1]);let a=this._getEndCursorState(n,i),o=i.map(e=>Ss.replace(e,``));t.pushUndoStop(),t.executeEdits(this.id,o,a),t.pushUndoStop()}},fF=class extends dF{constructor(){super({id:`deleteAllLeft`,label:U(1254,`Delete All Left`),precondition:y.writable,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:2049},weight:100}})}_getEndCursorState(e,t){let n=null,r=[],i=0;return t.forEach(t=>{let a;if(t.endColumn===1&&i>0){let e=t.startLineNumber-i;a=new P(e,t.startColumn,e,t.startColumn)}else a=new P(t.startLineNumber,t.startColumn,t.startLineNumber,t.startColumn);i+=t.endLineNumber-t.startLineNumber,t.intersectRanges(e)?n=a:r.push(a)}),n&&r.unshift(n),r}_getRangesToDelete(e){let t=e.getSelections();if(t===null)return[];let n=t,r=e.getModel();return r===null?[]:(n.sort(T.compareRangesUsingStarts),n=n.map(e=>{if(e.isEmpty())if(e.startColumn===1){let t=Math.max(1,e.startLineNumber-1),n=e.startLineNumber===1?1:r.getLineLength(t)+1;return new T(t,n,e.startLineNumber,1)}else return new T(e.startLineNumber,1,e.startLineNumber,e.startColumn);else return new T(e.startLineNumber,1,e.endLineNumber,e.endColumn)}),n)}},pF=class extends dF{constructor(){super({id:`deleteAllRight`,label:U(1255,`Delete All Right`),precondition:y.writable,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:297,secondary:[2068]},weight:100}})}_getEndCursorState(e,t){let n=null,r=[];for(let i=0,a=t.length;i<a;i++){let a=t[i],o=new P(a.startLineNumber-0,a.startColumn,a.startLineNumber-0,a.startColumn);a.intersectRanges(e)?n=o:r.push(o)}return n&&r.unshift(n),r}_getRangesToDelete(e){let t=e.getModel();if(t===null)return[];let n=e.getSelections();if(n===null)return[];let r=n.map(e=>{if(e.isEmpty()){let n=t.getLineMaxColumn(e.startLineNumber);return e.startColumn===n?new T(e.startLineNumber,e.startColumn,e.startLineNumber+1,1):new T(e.startLineNumber,e.startColumn,e.startLineNumber,n)}return e});return r.sort(T.compareRangesUsingStarts),r}},mF=class extends R{constructor(){super({id:`editor.action.joinLines`,label:U(1256,`Join Lines`),precondition:y.writable,kbOpts:{kbExpr:y.editorTextFocus,primary:0,mac:{primary:296},weight:100}})}run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getSelection();if(r===null)return;n.sort(T.compareRangesUsingStarts);let i=[],a=n.reduce((e,t)=>e.isEmpty()?e.endLineNumber===t.startLineNumber?(r.equalsSelection(e)&&(r=t),t):t.startLineNumber>e.endLineNumber+1?(i.push(e),t):new P(e.startLineNumber,e.startColumn,t.endLineNumber,t.endColumn):t.startLineNumber>e.endLineNumber?(i.push(e),t):new P(e.startLineNumber,e.startColumn,t.endLineNumber,t.endColumn));i.push(a);let o=t.getModel();if(o===null)return;let s=[],c=[],l=r,u=0;for(let e=0,t=i.length;e<t;e++){let t=i[e],n=t.startLineNumber,a=0,d,f,p=o.getLineLength(t.endLineNumber)-t.endColumn;if(t.isEmpty()||t.startLineNumber===t.endLineNumber){let e=t.getStartPosition();e.lineNumber<o.getLineCount()?(d=n+1,f=o.getLineMaxColumn(d)):(d=e.lineNumber,f=o.getLineMaxColumn(e.lineNumber))}else d=t.endLineNumber,f=o.getLineMaxColumn(d);let m=o.getLineContent(n);for(let e=n+1;e<=d;e++){let t=o.getLineContent(e),n=o.getLineFirstNonWhitespaceColumn(e);if(n>=1){let e=!0;m===``&&(e=!1),e&&(m.charAt(m.length-1)===` `||m.charAt(m.length-1)===`	`)&&(e=!1,m=m.replace(/[\s\uFEFF\xA0]+$/g,` `));let r=t.substr(n-1);m+=(e?` `:``)+r,a=e?r.length+1:r.length}else a=0}let h=new T(n,1,d,f);if(!h.isEmpty()){let e;t.isEmpty()?(s.push(Ss.replace(h,m)),e=new P(h.startLineNumber-u,m.length-a+1,n-u,m.length-a+1)):t.startLineNumber===t.endLineNumber?(s.push(Ss.replace(h,m)),e=new P(t.startLineNumber-u,t.startColumn,t.endLineNumber-u,t.endColumn)):(s.push(Ss.replace(h,m)),e=new P(t.startLineNumber-u,t.startColumn,t.startLineNumber-u,m.length-p)),T.intersectRanges(h,r)===null?c.push(e):l=e}u+=h.endLineNumber-h.startLineNumber}c.unshift(l),t.pushUndoStop(),t.executeEdits(this.id,s,c),t.pushUndoStop()}},hF=class extends R{constructor(){super({id:`editor.action.transpose`,label:U(1257,`Transpose Characters around the Cursor`),precondition:y.writable})}run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getModel();if(r===null)return;let i=[];for(let e=0,t=n.length;e<t;e++){let t=n[e];if(!t.isEmpty())continue;let a=t.getStartPosition(),o=r.getLineMaxColumn(a.lineNumber);if(a.column>=o){if(a.lineNumber===r.getLineCount())continue;let e=new T(a.lineNumber,Math.max(1,a.column-1),a.lineNumber+1,1),t=r.getValueInRange(e).split(``).reverse().join(``);i.push(new Eo(new P(a.lineNumber,Math.max(1,a.column-1),a.lineNumber+1,1),t))}else{let e=new T(a.lineNumber,Math.max(1,a.column-1),a.lineNumber,a.column+1),t=r.getValueInRange(e).split(``).reverse().join(``);i.push(new Jo(e,t,new P(a.lineNumber,a.column+1,a.lineNumber,a.column+1)))}}t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},gF=class extends R{run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getModel();if(r===null)return;let i=t.getOption(148),a=[];for(let e of n)if(e.isEmpty()){let n=e.getStartPosition(),o=t.getConfiguredWordAtPosition(n);if(!o)continue;let s=new T(n.lineNumber,o.startColumn,n.lineNumber,o.endColumn),c=r.getValueInRange(s);a.push(Ss.replace(s,this._modifyText(c,i)))}else{let t=r.getValueInRange(e);a.push(Ss.replace(e,this._modifyText(t,i)))}t.pushUndoStop(),t.executeEdits(this.id,a),t.pushUndoStop()}},_F=class extends gF{constructor(){super({id:`editor.action.transformToUppercase`,label:U(1258,`Transform to Uppercase`),precondition:y.writable})}_modifyText(e,t){return e.toLocaleUpperCase()}},vF=class extends gF{constructor(){super({id:`editor.action.transformToLowercase`,label:U(1259,`Transform to Lowercase`),precondition:y.writable})}_modifyText(e,t){return e.toLocaleLowerCase()}},yF=class{constructor(e,t){this._pattern=e,this._flags=t,this._actual=null,this._evaluated=!1}get(){if(!this._evaluated){this._evaluated=!0;try{this._actual=new RegExp(this._pattern,this._flags)}catch{}}return this._actual}isSupported(){return this.get()!==null}},bF=class e extends gF{static{this.titleBoundary=new yF(`(^|[^\\p{L}\\p{N}']|((^|\\P{L})'))\\p{L}`,`gmu`)}constructor(){super({id:`editor.action.transformToTitlecase`,label:U(1260,`Transform to Title Case`),precondition:y.writable})}_modifyText(t,n){let r=e.titleBoundary.get();return r?t.toLocaleLowerCase().replace(r,e=>e.toLocaleUpperCase()):t}},xF=class e extends gF{static{this.caseBoundary=new yF(`(\\p{Ll})(\\p{Lu})`,`gmu`)}static{this.singleLetters=new yF(`(\\p{Lu}|\\p{N})(\\p{Lu})(\\p{Ll})`,`gmu`)}constructor(){super({id:`editor.action.transformToSnakecase`,label:U(1261,`Transform to Snake Case`),precondition:y.writable})}_modifyText(t,n){let r=e.caseBoundary.get(),i=e.singleLetters.get();return!r||!i?t:t.replace(r,`$1_$2`).replace(i,`$1_$2$3`).toLocaleLowerCase()}},SF=class e extends gF{static{this.singleLineWordBoundary=new yF(`[_\\s-]+`,`gm`)}static{this.multiLineWordBoundary=new yF(`[_-]+`,`gm`)}static{this.validWordStart=new yF(`^(\\p{Lu}[^\\p{Lu}])`,`gmu`)}constructor(){super({id:`editor.action.transformToCamelcase`,label:U(1262,`Transform to Camel Case`),precondition:y.writable})}_modifyText(t,n){let r=/\r\n|\r|\n/.test(t)?e.multiLineWordBoundary.get():e.singleLineWordBoundary.get(),i=e.validWordStart.get();if(!r||!i)return t;let a=t.split(r);return a.shift()?.replace(i,e=>e.toLocaleLowerCase())+a.map(e=>e.substring(0,1).toLocaleUpperCase()+e.substring(1)).join(``)}},CF=class e extends gF{static{this.wordBoundary=new yF(`[_ \\t-]`,`gm`)}static{this.wordBoundaryToMaintain=new yF(`(?<=\\.)`,`gm`)}constructor(){super({id:`editor.action.transformToPascalcase`,label:U(1263,`Transform to Pascal Case`),precondition:y.writable})}_modifyText(t,n){let r=e.wordBoundary.get(),i=e.wordBoundaryToMaintain.get();return!r||!i?t:t.split(i).map(e=>e.split(r)).flat().map(e=>e.substring(0,1).toLocaleUpperCase()+e.substring(1)).join(``)}},wF=class e extends gF{static isSupported(){return[this.caseBoundary,this.singleLetters,this.underscoreBoundary].every(e=>e.isSupported())}static{this.caseBoundary=new yF(`(\\p{Ll})(\\p{Lu})`,`gmu`)}static{this.singleLetters=new yF(`(\\p{Lu}|\\p{N})(\\p{Lu}\\p{Ll})`,`gmu`)}static{this.underscoreBoundary=new yF(`(\\S)(_)(\\S)`,`gm`)}constructor(){super({id:`editor.action.transformToKebabcase`,label:U(1264,`Transform to Kebab Case`),precondition:y.writable})}_modifyText(t,n){let r=e.caseBoundary.get(),i=e.singleLetters.get(),a=e.underscoreBoundary.get();return!r||!i||!a?t:t.replace(a,`$1-$3`).replace(r,`$1-$2`).replace(i,`$1-$2`).toLocaleLowerCase()}};q(JP),q(YP),q(XP),q(QP),q($P),q(tF),q(nF),q(rF),q(aF),q(oF),q(sF),q(cF),q(lF),q(uF),q(fF),q(pF),q(mF),q(hF),q(_F),q(vF),q(iF),xF.caseBoundary.isSupported()&&xF.singleLetters.isSupported()&&q(xF),SF.singleLineWordBoundary.isSupported()&&SF.multiLineWordBoundary.isSupported()&&q(SF),CF.wordBoundary.isSupported()&&q(CF),bF.titleBoundary.isSupported()&&q(bF),wF.isSupported()&&q(wF);var TF=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},EF=function(e,t){return function(n,r){t(n,r,e)}},DF;const OF=new N(`LinkedEditingInputVisible`,!1);var kF=`linked-editing-decoration`,AF=class extends x{static{DF=this}static{this.ID=`editor.contrib.linkedEditing`}static{this.DECORATION=Y.register({description:`linked-editing`,stickiness:0,className:kF})}static get(e){return e.getContribution(DF.ID)}constructor(e,t,n,r,i){super(),this.languageConfigurationService=r,this._syncRangesToken=0,this._localToDispose=this._register(new L),this._editor=e,this._providers=n.linkedEditingRangeProvider,this._enabled=!1,this._visibleContextKey=OF.bindTo(t),this._debounceInformation=i.for(this._providers,`Linked Editing`,{max:200}),this._currentDecorations=this._editor.createDecorationsCollection(),this._languageWordPattern=null,this._currentWordPattern=null,this._ignoreChangeEvent=!1,this._localToDispose=this._register(new L),this._rangeUpdateTriggerPromise=null,this._rangeSyncTriggerPromise=null,this._currentRequestCts=null,this._currentRequestPosition=null,this._currentRequestModelVersion=null,this._register(this._editor.onDidChangeModel(()=>this.reinitialize(!0))),this._register(this._editor.onDidChangeConfiguration(e=>{(e.hasChanged(78)||e.hasChanged(106))&&this.reinitialize(!1)})),this._register(this._providers.onDidChange(()=>this.reinitialize(!1))),this._register(this._editor.onDidChangeModelLanguage(()=>this.reinitialize(!0))),this.reinitialize(!0)}reinitialize(e){let t=this._editor.getModel(),n=t!==null&&(this._editor.getOption(78)||this._editor.getOption(106))&&this._providers.has(t);if(n===this._enabled&&!e||(this._enabled=n,this.clearRanges(),this._localToDispose.clear(),!n||t===null))return;this._localToDispose.add(An.runAndSubscribe(t.onDidChangeLanguageConfiguration,()=>{this._languageWordPattern=this.languageConfigurationService.getLanguageConfiguration(t.getLanguageId()).getWordDefinition()}));let r=new Hu(this._debounceInformation.get(t)),i=()=>{this._rangeUpdateTriggerPromise=r.trigger(()=>this.updateRanges(),this._debounceDuration??this._debounceInformation.get(t))},a=new Hu(0),o=e=>{this._rangeSyncTriggerPromise=a.trigger(()=>this._syncRanges(e))};this._localToDispose.add(this._editor.onDidChangeCursorPosition(()=>{i()})),this._localToDispose.add(this._editor.onDidChangeModelContent(e=>{if(!this._ignoreChangeEvent&&this._currentDecorations.length>0){let t=this._currentDecorations.getRange(0);if(t&&e.changes.every(e=>t.intersectRanges(e.range))){o(this._syncRangesToken);return}}i()})),this._localToDispose.add({dispose:()=>{r.dispose(),a.dispose()}}),this.updateRanges()}_syncRanges(e){if(!this._editor.hasModel()||e!==this._syncRangesToken||this._currentDecorations.length===0)return;let t=this._editor.getModel(),n=this._currentDecorations.getRange(0);if(!n||n.startLineNumber!==n.endLineNumber)return this.clearRanges();let r=t.getValueInRange(n);if(this._currentWordPattern){let e=r.match(this._currentWordPattern);if((e?e[0].length:0)!==r.length)return this.clearRanges()}let i=[];for(let e=1,n=this._currentDecorations.length;e<n;e++){let n=this._currentDecorations.getRange(e);if(n)if(n.startLineNumber!==n.endLineNumber)i.push({range:n,text:r});else{let e=t.getValueInRange(n),a=r,o=n.startColumn,s=n.endColumn,c=Kt(e,a);o+=c,e=e.substr(c),a=a.substr(c);let l=wn(e,a);s-=l,e=e.substr(0,e.length-l),a=a.substr(0,a.length-l),(o!==s||a.length!==0)&&i.push({range:new T(n.startLineNumber,o,n.endLineNumber,s),text:a})}}if(i.length!==0)try{this._editor.popUndoStop(),this._ignoreChangeEvent=!0;let e=this._editor._getViewModel().getPrevEditOperationType();this._editor.executeEdits(`linkedEditing`,i),this._editor._getViewModel().setPrevEditOperationType(e)}finally{this._ignoreChangeEvent=!1}}dispose(){this.clearRanges(),super.dispose()}clearRanges(){this._visibleContextKey.set(!1),this._currentDecorations.clear(),this._currentRequestCts&&(this._currentRequestCts.cancel(),this._currentRequestCts=null,this._currentRequestPosition=null)}async updateRanges(e=!1){if(!this._editor.hasModel()){this.clearRanges();return}let t=this._editor.getPosition();if(!this._enabled&&!e||this._editor.getSelections().length>1){this.clearRanges();return}let n=this._editor.getModel(),r=n.getVersionId();if(this._currentRequestPosition&&this._currentRequestModelVersion===r){if(t.equals(this._currentRequestPosition))return;if(this._currentDecorations.length>0){let e=this._currentDecorations.getRange(0);if(e&&e.containsPosition(t))return}}this._currentRequestPosition?.equals(t)||this._currentDecorations.getRange(0)?.containsPosition(t)||this.clearRanges(),this._currentRequestPosition=t,this._currentRequestModelVersion=r;let i=this._currentRequestCts=new Sr;try{let e=new vd(!1),a=await NF(this._providers,n,t,i.token);if(this._debounceInformation.update(n,e.elapsed()),i!==this._currentRequestCts||(this._currentRequestCts=null,r!==n.getVersionId()))return;let o=[];a?.ranges&&(o=a.ranges),this._currentWordPattern=a?.wordPattern||this._languageWordPattern;let s=!1;for(let e=0,n=o.length;e<n;e++)if(T.containsPosition(o[e],t)){if(s=!0,e!==0){let t=o[e];o.splice(e,1),o.unshift(t)}break}if(!s){this.clearRanges();return}let c=o.map(e=>({range:e,options:DF.DECORATION}));this._visibleContextKey.set(!0),this._currentDecorations.set(c),this._syncRangesToken++}catch(e){Gn(e)||mr(e),(this._currentRequestCts===i||!this._currentRequestCts)&&this.clearRanges()}}};AF=DF=TF([EF(1,On),EF(2,H),EF(3,Ce),EF(4,fu)],AF);var jF=class extends R{constructor(){super({id:`editor.action.linkedEditing`,label:U(1266,`Start Linked Editing`),precondition:E.and(y.writable,y.hasRenameProvider),kbOpts:{kbExpr:y.editorTextFocus,primary:3132,weight:100}})}runCommand(e,t){let n=e.get(xl),[r,i]=Array.isArray(t)&&t||[void 0,void 0];return ur.isUri(r)&&C.isIPosition(i)?n.openCodeEditor({resource:r},n.getActiveCodeEditor()).then(e=>{e&&(e.setPosition(i),e.invokeWithinContext(t=>(this.reportTelemetry(t,e),this.run(t,e))))},mr):super.runCommand(e,t)}run(e,t){let n=AF.get(t);return n?Promise.resolve(n.updateRanges(!0)):Promise.resolve()}},MF=Ar.bindToContribution(AF.get);W(new MF({id:`cancelLinkedEditingInput`,precondition:OF,handler:e=>e.clearRanges(),kbOpts:{kbExpr:y.editorTextFocus,weight:199,primary:9,secondary:[1033]}}));function NF(e,t,n,r){let i=e.ordered(t);return We(i.map(e=>async()=>{try{return await e.provideLinkedEditingRanges(t,n,r)}catch(e){ct(e);return}}),e=>!!e&&$t(e?.ranges))}F(`editor.linkedEditingBackground`,{dark:V.fromHex(`#f00`).transparent(.3),light:V.fromHex(`#f00`).transparent(.3),hcDark:V.fromHex(`#f00`).transparent(.3),hcLight:V.white},G(1265,`Background color when the editor auto renames on type.`)),Ya(`_executeLinkedEditingProvider`,(e,t,n)=>{let{linkedEditingRangeProvider:r}=e.get(H);return NF(r,t,n,M.None)}),K(AF.ID,AF,1),q(jF);var PF=class{constructor(e,t){this._link=e,this._provider=t}toJSON(){return{range:this.range,url:this.url,tooltip:this.tooltip}}get range(){return this._link.range}get url(){return this._link.url}get tooltip(){return this._link.tooltip}async resolve(e){return this._link.url?this._link.url:typeof this._provider.resolveLink==`function`?Promise.resolve(this._provider.resolveLink(this._link,e)).then(t=>(this._link=t||this._link,this._link.url?this.resolve(e):Promise.reject(Error(`missing`)))):Promise.reject(Error(`missing`))}},FF=class e{static{this.Empty=new e([])}constructor(t){this._disposables=new L;let n=[];for(let[r,i]of t){let t=r.links.map(e=>new PF(e,i));n=e._union(n,t),yn(r)&&(this._disposables??=new L,this._disposables.add(r))}this.links=n}dispose(){this._disposables?.dispose(),this.links.length=0}static _union(e,t){let n=[],r,i,a,o;for(r=0,a=0,i=e.length,o=t.length;r<i&&a<o;){let i=e[r],o=t[a];if(T.areIntersectingOrTouching(i.range,o.range)){r++;continue}T.compareRangesUsingStarts(i.range,o.range)<0?(n.push(i),r++):(n.push(o),a++)}for(;r<i;r++)n.push(e[r]);for(;a<o;a++)n.push(t[a]);return n}};async function IF(e,t,n){let r=[],i=e.ordered(t).reverse().map(async(e,i)=>{try{let a=await e.provideLinks(t,n);a&&(r[i]=[a,e])}catch(e){ct(e)}});await Promise.all(i);let a=new FF(ki(r));return n.isCancellationRequested&&(a.dispose(),a=FF.Empty),a}gd.registerCommand(`_executeLinkProvider`,async(e,...t)=>{let[n,r]=t;J(n instanceof ur),typeof r!=`number`&&(r=0);let{linkProvider:i}=e.get(H),a=e.get(_n).getModel(n);if(!a)return[];let o=await IF(i,a,M.None);if(!o)return[];for(let e=0;e<Math.min(r,o.links.length);e++)await o.links[e].resolve(M.None);let s=o.links.slice(0);return o.dispose(),s});var LF=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},RF=function(e,t){return function(n,r){t(n,r,e)}},zF,BF=class extends x{static{zF=this}static{this.ID=`editor.linkDetector`}static get(e){return e.getContribution(zF.ID)}constructor(e,t,n,r,i){super(),this.editor=e,this.openerService=t,this.notificationService=n,this.languageFeaturesService=r,this.providers=this.languageFeaturesService.linkProvider,this.debounceInformation=i.for(this.providers,`Links`,{min:1e3,max:4e3}),this.computeLinks=this._register(new Zr(()=>this.computeLinksNow(),1e3)),this.computePromise=null,this.activeLinksList=null,this.currentOccurrences={},this.activeLinkDecorationId=null;let a=this._register(new ey(e));this._register(a.onMouseMoveOrRelevantKeyDown(([e,t])=>{this._onEditorMouseMove(e,t)})),this._register(a.onExecute(e=>{this.onEditorMouseUp(e)})),this._register(a.onCancel(e=>{this.cleanUpActiveLinkDecoration()})),this._register(e.onDidChangeConfiguration(e=>{e.hasChanged(79)&&(this.updateDecorations([]),this.stop(),this.computeLinks.schedule(0))})),this._register(e.onDidChangeModelContent(e=>{this.editor.hasModel()&&this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()))})),this._register(e.onDidChangeModel(e=>{this.currentOccurrences={},this.activeLinkDecorationId=null,this.stop(),this.computeLinks.schedule(0)})),this._register(e.onDidChangeModelLanguage(e=>{this.stop(),this.computeLinks.schedule(0)})),this._register(this.providers.onDidChange(e=>{this.stop(),this.computeLinks.schedule(0)})),this.computeLinks.schedule(0)}async computeLinksNow(){if(!this.editor.hasModel()||!this.editor.getOption(79))return;let e=this.editor.getModel();if(!e.isTooLargeForSyncing()&&this.providers.has(e)){this.activeLinksList&&=(this.activeLinksList.dispose(),null),this.computePromise=li(t=>IF(this.providers,e,t));try{let t=new vd(!1);if(this.activeLinksList=await this.computePromise,this.debounceInformation.update(e,t.elapsed()),e.isDisposed())return;this.updateDecorations(this.activeLinksList.links)}catch(e){mr(e)}finally{this.computePromise=null}}}updateDecorations(e){let t=this.editor.getOption(86)===`altKey`,n=[],r=Object.keys(this.currentOccurrences);for(let e of r){let t=this.currentOccurrences[e];n.push(t.decorationId)}let i=[];if(e)for(let n of e)i.push(HF.decoration(n,t));this.editor.changeDecorations(t=>{let r=t.deltaDecorations(n,i);this.currentOccurrences={},this.activeLinkDecorationId=null;for(let t=0,n=r.length;t<n;t++){let n=new HF(e[t],r[t]);this.currentOccurrences[n.decorationId]=n}})}_onEditorMouseMove(e,t){let n=this.editor.getOption(86)===`altKey`;if(this.isEnabled(e,t)){this.cleanUpActiveLinkDecoration();let t=this.getLinkOccurrence(e.target.position);t&&this.editor.changeDecorations(e=>{t.activate(e,n),this.activeLinkDecorationId=t.decorationId})}else this.cleanUpActiveLinkDecoration()}cleanUpActiveLinkDecoration(){let e=this.editor.getOption(86)===`altKey`;if(this.activeLinkDecorationId){let t=this.currentOccurrences[this.activeLinkDecorationId];t&&this.editor.changeDecorations(n=>{t.deactivate(n,e)}),this.activeLinkDecorationId=null}}onEditorMouseUp(e){if(!this.isEnabled(e))return;let t=this.getLinkOccurrence(e.target.position);t&&this.openLinkOccurrence(t,e.hasSideBySideModifier,!0)}openLinkOccurrence(e,t,n=!1){if(!this.openerService)return;let{link:r}=e;r.resolve(M.None).then(e=>{if(typeof e==`string`&&this.editor.hasModel()){let t=this.editor.getModel().uri;if(t.scheme===ls.file&&e.startsWith(`${ls.file}:`)){let n=ur.parse(e);if(n.scheme===ls.file){let r=id(n),i=null;r.startsWith(`/./`)||r.startsWith(`\\.\\`)?i=`.${r.substr(1)}`:(r.startsWith(`//./`)||r.startsWith(`\\\\.\\`))&&(i=`.${r.substr(2)}`),i&&(e=Cu(t,i))}}}return this.openerService.open(e,{openToSide:t,fromUserGesture:n,allowContributedOpeners:!0,allowCommands:!0,fromWorkspace:!0})},e=>{let t=e instanceof Error?e.message:e;t===`invalid`?this.notificationService.warn(G(1267,`Failed to open this link because it is not well-formed: {0}`,r.url.toString())):t===`missing`?this.notificationService.warn(G(1268,`Failed to open this link because its target is missing.`)):mr(e)})}getLinkOccurrence(e){if(!this.editor.hasModel()||!e)return null;let t=this.editor.getModel().getDecorationsInRange({startLineNumber:e.lineNumber,startColumn:e.column,endLineNumber:e.lineNumber,endColumn:e.column},0,!0);for(let e of t){let t=this.currentOccurrences[e.id];if(t)return t}return null}isEnabled(e,t){return!!(e.target.type===6&&(e.hasTriggerModifier||t&&t.keyCodeIsTriggerKey||e.isMiddleClick&&e.mouseMiddleClickAction===`openLink`))}stop(){this.computeLinks.cancel(),this.activeLinksList&&=(this.activeLinksList?.dispose(),null),this.computePromise&&=(this.computePromise.cancel(),null)}dispose(){super.dispose(),this.stop()}};BF=zF=LF([RF(1,da),RF(2,Ur),RF(3,H),RF(4,fu)],BF);var VF={general:Y.register({description:`detected-link`,stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:`detected-link`}),active:Y.register({description:`detected-link-active`,stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:`detected-link-active`})},HF=class e{static decoration(t,n){return{range:t.range,options:e._getOptions(t,n,!1)}}static _getOptions(e,t,n){let r={...n?VF.active:VF.general};return r.hoverMessage=UF(e,t),r}constructor(e,t){this.link=e,this.decorationId=t}activate(t,n){t.changeDecorationOptions(this.decorationId,e._getOptions(this.link,n,!0))}deactivate(t,n){t.changeDecorationOptions(this.decorationId,e._getOptions(this.link,n,!1))}};function UF(e,t){let n=e.url&&/^command:/i.test(e.url.toString()),r=e.tooltip?e.tooltip:n?G(1269,`Execute command`):G(1270,`Follow link`),i=t?po?G(1271,`cmd + click`):G(1272,`ctrl + click`):po?G(1273,`option + click`):G(1274,`alt + click`);if(e.url){let t=``;if(/^command:/i.test(e.url.toString())){let n=e.url.toString().match(/^command:([^?#]+)/);if(n){let e=n[1];t=G(1275,`Execute command {0}`,e)}}return new Jn(``,!0).appendLink(e.url.toString(!0).replace(/ /g,`%20`),r,t).appendMarkdown(` (${i})`)}else return new Jn().appendText(`${r} (${i})`)}var WF=class extends R{constructor(){super({id:`editor.action.openLink`,label:U(1276,`Open Link`),precondition:void 0})}run(e,t){let n=BF.get(t);if(!n||!t.hasModel())return;let r=t.getSelections();for(let e of r){let t=n.getLinkOccurrence(e.getEndPosition());t&&n.openLinkOccurrence(t,!1)}}};K(BF.ID,BF,1),q(WF);var GF=class extends x{static{this.ID=`editor.contrib.longLinesHelper`}constructor(e){super(),this._editor=e,this._register(this._editor.onMouseDown(e=>{let t=this._editor.getOption(133);t>=0&&e.target.type===6&&e.target.position.column>=t&&this._editor.updateOptions({stopRenderingLineAfter:-1})}))}};K(GF.ID,GF,2);var KF=class extends x{static{this.ID=`editor.contrib.middleScroll`}constructor(e){super(),this._editor=e;let t=Bs(this._editor),n=t.getOption(171);this._register(g(e=>{if(!n.read(e))return;let r=t.domNode.read(e);if(!r)return;let i=e.store.add(Lc(`scrollingSession`,void 0));e.store.add(this._editor.onMouseDown(e=>{if(i.read(void 0)){i.set(void 0,void 0);return}if(!e.event.middleButton)return;e.event.stopPropagation(),e.event.preventDefault();let t=new L,n=new jn(e.event.posx,e.event.posy),a=qF(eo(r),n,t).map(e=>e.subtract(n).withThreshold(5)),o=r.getBoundingClientRect(),s=new jn(n.x-o.left,n.y-o.top);i.set({mouseDeltaAfterThreshold:a,initialMousePosInEditor:s,didScroll:!1,dispose:()=>t.dispose()},void 0),t.add(this._editor.onMouseUp(e=>{let t=i.read(void 0);t&&t.didScroll&&i.set(void 0,void 0)})),t.add(this._editor.onKeyDown(e=>{i.set(void 0,void 0)}))})),e.store.add(g(e=>{let t=i.read(e);if(!t)return;let n=Date.now();e.store.add(g(e=>{LE.instance.invalidateOnNextAnimationFrame(e);let r=Date.now(),i=r-n;n=r;let a=t.mouseDeltaAfterThreshold.read(void 0),o=i/32,s=a.scale(o),c=new jn(this._editor.getScrollLeft(),this._editor.getScrollTop());this._editor.setScrollPosition(JF(c.add(s))),s.isZero()||(t.didScroll=!0)}));let a=O(e=>{let n=t.mouseDeltaAfterThreshold.read(e),r=``;return r+=n.y<0?`n`:n.y>0?`s`:``,r+=n.x<0?`w`:n.x>0?`e`:``,r});e.store.add(g(e=>{r.setAttribute(`data-scroll-direction`,a.read(e))}))}));let a=e.store.add(w.div({class:[`scroll-editor-on-middle-click-dot`,i.map(e=>e?``:`hidden`)],style:{left:i.map(e=>e?e.initialMousePosInEditor.x:0),top:i.map(e=>e?e.initialMousePosInEditor.y:0)}}).toDisposableLiveElement());e.store.add(Fr(r,a.element)),e.store.add(g(e=>{let t=i.read(e);r.classList.toggle(`scroll-editor-on-middle-click-editor`,!!t)}))}))}};function qF(e,t,n){let r=kl(`pos`,t);return n.add(z(e,`mousemove`,e=>{r.set(new jn(e.pageX,e.pageY),void 0)})),r}function JF(e){return{scrollLeft:e.x,scrollTop:e.y}}K(KF.ID,KF,2);var YF=F(`editor.wordHighlightBackground`,{dark:`#575757B8`,light:`#57575740`,hcDark:null,hcLight:null},G(1548,`Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations.`),!0);F(`editor.wordHighlightStrongBackground`,{dark:`#004972B8`,light:`#0e639c40`,hcDark:null,hcLight:null},G(1549,`Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations.`),!0),F(`editor.wordHighlightTextBackground`,YF,G(1550,`Background color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations.`),!0);var XF=F(`editor.wordHighlightBorder`,{light:null,dark:null,hcDark:Mn,hcLight:Mn},G(1551,`Border color of a symbol during read-access, like reading a variable.`));F(`editor.wordHighlightStrongBorder`,{light:null,dark:null,hcDark:Mn,hcLight:Mn},G(1552,`Border color of a symbol during write-access, like writing to a variable.`)),F(`editor.wordHighlightTextBorder`,XF,G(1553,`Border color of a textual occurrence for a symbol.`));var ZF=F(`editorOverviewRuler.wordHighlightForeground`,`#A0A0A0CC`,G(1554,`Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations.`),!0),QF=F(`editorOverviewRuler.wordHighlightStrongForeground`,`#C0A0C0CC`,G(1555,`Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations.`),!0),$F=F(`editorOverviewRuler.wordHighlightTextForeground`,er,G(1556,`Overview ruler marker color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations.`),!0),eI=Y.register({description:`word-highlight-strong`,stickiness:1,className:`wordHighlightStrong`,overviewRuler:{color:Ta(QF),position:vr.Center},minimap:{color:Ta(Qi),position:1}}),tI=Y.register({description:`word-highlight-text`,stickiness:1,className:`wordHighlightText`,overviewRuler:{color:Ta($F),position:vr.Center},minimap:{color:Ta(Qi),position:1}}),nI=Y.register({description:`selection-highlight-overview`,stickiness:1,className:`selectionHighlight`,overviewRuler:{color:Ta(er),position:vr.Center},minimap:{color:Ta(Qi),position:1}}),rI=Y.register({description:`selection-highlight`,stickiness:1,className:`selectionHighlight`}),iI=Y.register({description:`word-highlight`,stickiness:1,className:`wordHighlight`,overviewRuler:{color:Ta(ZF),position:vr.Center},minimap:{color:Ta(Qi),position:1}});function aI(e){return e===Kl.Write?eI:e===Kl.Text?tI:iI}function oI(e){return e?rI:nI}ta((e,t)=>{let n=e.getColor(qr);n&&t.addRule(`.monaco-editor .selectionHighlight { background-color: ${n.transparent(.5)}; }`)});var sI=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},cI=function(e,t){return function(n,r){t(n,r,e)}},lI;function uI(e,t){let n=t.filter(t=>!e.find(e=>e.equals(t)));if(n.length>=1){let e=n.map(e=>`line ${e.viewState.position.lineNumber} column ${e.viewState.position.column}`).join(`, `),t=n.length===1?G(1278,`Cursor added: {0}`,e):G(1279,`Cursors added: {0}`,e);wr(t)}}var dI=class extends R{constructor(){super({id:`editor.action.insertCursorAbove`,label:U(1288,`Add Cursor Above`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:2576,linux:{primary:1552,secondary:[3088]},weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`3_multi`,title:G(1280,`&&Add Cursor Above`),order:2}})}run(e,t,n){if(!t.hasModel())return;let r=!0;n&&n.logicalLine===!1&&(r=!1);let i=t._getViewModel();if(i.cursorConfig.readOnly)return;i.model.pushStackElement();let a=i.getCursorStates();i.setCursorStates(n.source,3,zl.addCursorUp(i,a,r)),i.revealTopMostCursor(n.source),uI(a,i.getCursorStates())}},fI=class extends R{constructor(){super({id:`editor.action.insertCursorBelow`,label:U(1289,`Add Cursor Below`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:2578,linux:{primary:1554,secondary:[3090]},weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`3_multi`,title:G(1281,`A&&dd Cursor Below`),order:3}})}run(e,t,n){if(!t.hasModel())return;let r=!0;n&&n.logicalLine===!1&&(r=!1);let i=t._getViewModel();if(i.cursorConfig.readOnly)return;i.model.pushStackElement();let a=i.getCursorStates();i.setCursorStates(n.source,3,zl.addCursorDown(i,a,r)),i.revealBottomMostCursor(n.source),uI(a,i.getCursorStates())}},pI=class extends R{constructor(){super({id:`editor.action.insertCursorAtEndOfEachLineSelected`,label:U(1290,`Add Cursors to Line Ends`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:1575,weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`3_multi`,title:G(1282,`Add C&&ursors to Line Ends`),order:4}})}getCursorsForSelection(e,t,n){if(!e.isEmpty()){for(let r=e.startLineNumber;r<e.endLineNumber;r++){let e=t.getLineMaxColumn(r);n.push(new P(r,e,r,e))}e.endColumn>1&&n.push(new P(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn))}}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=t.getSelections(),i=t._getViewModel(),a=i.getCursorStates(),o=[];r.forEach(e=>this.getCursorsForSelection(e,n,o)),o.length>0&&t.setSelections(o),uI(a,i.getCursorStates())}},mI=class extends R{constructor(){super({id:`editor.action.addCursorsToBottom`,label:U(1291,`Add Cursors to Bottom`),precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getSelections(),r=t.getModel().getLineCount(),i=[];for(let e=n[0].startLineNumber;e<=r;e++)i.push(new P(e,n[0].startColumn,e,n[0].endColumn));let a=t._getViewModel(),o=a.getCursorStates();i.length>0&&t.setSelections(i),uI(o,a.getCursorStates())}},hI=class extends R{constructor(){super({id:`editor.action.addCursorsToTop`,label:U(1292,`Add Cursors to Top`),precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getSelections(),r=[];for(let e=n[0].startLineNumber;e>=1;e--)r.push(new P(e,n[0].startColumn,e,n[0].endColumn));let i=t._getViewModel(),a=i.getCursorStates();r.length>0&&t.setSelections(r),uI(a,i.getCursorStates())}},gI=class{constructor(e,t,n){this.selections=e,this.revealRange=t,this.revealScrollType=n}},_I=class e{static create(t,n){if(!t.hasModel())return null;let r=n.getState();if(!t.hasTextFocus()&&r.isRevealed&&r.searchString.length>0)return new e(t,n,!1,r.searchString,r.wholeWord,r.matchCase,null);let i=!1,a,o,s=t.getSelections();s.length===1&&s[0].isEmpty()?(i=!0,a=!0,o=!0):(a=r.wholeWord,o=r.matchCase);let c=t.getSelection(),l,u=null;if(c.isEmpty()){let e=t.getConfiguredWordAtPosition(c.getStartPosition());if(!e)return null;l=e.word,u=new P(c.startLineNumber,e.startColumn,c.startLineNumber,e.endColumn)}else l=t.getModel().getValueInRange(c).replace(/\r\n/g,`
`);return new e(t,n,i,l,a,o,u)}constructor(e,t,n,r,i,a,o){this._editor=e,this.findController=t,this.isDisconnectedFromFindController=n,this.searchText=r,this.wholeWord=i,this.matchCase=a,this.currentMatch=o}addSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;let e=this._getNextMatch();if(!e)return null;let t=this._editor.getSelections();return new gI(t.concat(e),e,0)}moveSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;let e=this._getNextMatch();if(!e)return null;let t=this._editor.getSelections();return new gI(t.slice(0,t.length-1).concat(e),e,0)}_getNextMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){let e=this.currentMatch;return this.currentMatch=null,e}this.findController.highlightFindOptions();let e=this._editor.getSelections(),t=e[e.length-1],n=this._editor.getModel().findNextMatch(this.searchText,t.getEndPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(148):null,!1);return n?new P(n.range.startLineNumber,n.range.startColumn,n.range.endLineNumber,n.range.endColumn):null}addSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;let e=this._getPreviousMatch();if(!e)return null;let t=this._editor.getSelections();return new gI(t.concat(e),e,0)}moveSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;let e=this._getPreviousMatch();if(!e)return null;let t=this._editor.getSelections();return new gI(t.slice(0,t.length-1).concat(e),e,0)}_getPreviousMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){let e=this.currentMatch;return this.currentMatch=null,e}this.findController.highlightFindOptions();let e=this._editor.getSelections(),t=e[e.length-1],n=this._editor.getModel().findPreviousMatch(this.searchText,t.getStartPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(148):null,!1);return n?new P(n.range.startLineNumber,n.range.startColumn,n.range.endLineNumber,n.range.endColumn):null}selectAll(e){if(!this._editor.hasModel())return[];this.findController.highlightFindOptions();let t=this._editor.getModel();return e?t.findMatches(this.searchText,e,!1,this.matchCase,this.wholeWord?this._editor.getOption(148):null,!1,1073741824):t.findMatches(this.searchText,!0,!1,this.matchCase,this.wholeWord?this._editor.getOption(148):null,!1,1073741824)}},vI=class e extends x{static{this.ID=`editor.contrib.multiCursorController`}static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._sessionDispose=this._register(new L),this._editor=e,this._ignoreSelectionChange=!1,this._session=null}dispose(){this._endSession(),super.dispose()}_beginSessionIfNeeded(e){if(!this._session){let t=_I.create(this._editor,e);if(!t)return;this._session=t;let n={searchString:this._session.searchText};this._session.isDisconnectedFromFindController&&(n.wholeWordOverride=1,n.matchCaseOverride=1,n.isRegexOverride=2),e.getState().change(n,!1),this._sessionDispose.add(this._editor.onDidChangeCursorSelection(e=>{this._ignoreSelectionChange||this._endSession()})),this._sessionDispose.add(this._editor.onDidBlurEditorText(()=>{this._endSession()})),this._sessionDispose.add(e.getState().onFindReplaceStateChange(e=>{(e.matchCase||e.wholeWord)&&this._endSession()}))}}_endSession(){this._sessionDispose.clear(),this._session&&this._session.isDisconnectedFromFindController&&this._session.findController.getState().change({wholeWordOverride:0,matchCaseOverride:0,isRegexOverride:0},!1),this._session=null}_setSelections(e){this._ignoreSelectionChange=!0,this._editor.setSelections(e),this._ignoreSelectionChange=!1}_expandEmptyToWord(e,t){if(!t.isEmpty())return t;let n=this._editor.getConfiguredWordAtPosition(t.getStartPosition());return n?new P(t.startLineNumber,n.startColumn,t.startLineNumber,n.endColumn):t}_applySessionResult(e){e&&(this._setSelections(e.selections),e.revealRange&&this._editor.revealRangeInCenterIfOutsideViewport(e.revealRange,e.revealScrollType))}getSession(e){return this._session}addSelectionToNextFindMatch(e){if(this._editor.hasModel()){if(!this._session){let t=this._editor.getSelections();if(t.length>1){let n=e.getState().matchCase;if(!OI(this._editor.getModel(),t,n)){let e=this._editor.getModel(),n=[];for(let r=0,i=t.length;r<i;r++)n[r]=this._expandEmptyToWord(e,t[r]);this._editor.setSelections(n);return}}}this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToNextFindMatch())}}addSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToPreviousFindMatch())}moveSelectionToNextFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToNextFindMatch())}moveSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToPreviousFindMatch())}selectAll(e){if(!this._editor.hasModel())return;let t=null,n=e.getState();if(n.isRevealed&&n.searchString.length>0&&n.isRegex){let e=this._editor.getModel();t=n.searchScope?e.findMatches(n.searchString,n.searchScope,n.isRegex,n.matchCase,n.wholeWord?this._editor.getOption(148):null,!1,1073741824):e.findMatches(n.searchString,!0,n.isRegex,n.matchCase,n.wholeWord?this._editor.getOption(148):null,!1,1073741824)}else{if(this._beginSessionIfNeeded(e),!this._session)return;t=this._session.selectAll(n.searchScope)}if(t.length>0){let e=this._editor.getSelection();for(let n=0,r=t.length;n<r;n++){let r=t[n];if(r.range.intersectRanges(e)){t[n]=t[0],t[0]=r;break}}this._setSelections(t.map(e=>new P(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn)))}}},yI=class extends R{run(e,t){let n=vI.get(t);if(!n)return;let r=t._getViewModel();if(r){let i=r.getCursorStates(),a=AC.get(t);if(a)this._run(n,a);else{let r=e.get(k).createInstance(AC,t);this._run(n,r),r.dispose()}uI(i,r.getCursorStates())}}},bI=class extends yI{constructor(){super({id:`editor.action.addSelectionToNextFindMatch`,label:U(1293,`Add Selection to Next Find Match`),precondition:void 0,kbOpts:{kbExpr:y.focus,primary:2082,weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`3_multi`,title:G(1283,`Add &&Next Occurrence`),order:5}})}_run(e,t){e.addSelectionToNextFindMatch(t)}},xI=class extends yI{constructor(){super({id:`editor.action.addSelectionToPreviousFindMatch`,label:U(1294,`Add Selection to Previous Find Match`),precondition:void 0,menuOpts:{menuId:S.MenubarSelectionMenu,group:`3_multi`,title:G(1284,`Add P&&revious Occurrence`),order:6}})}_run(e,t){e.addSelectionToPreviousFindMatch(t)}},SI=class extends yI{constructor(){super({id:`editor.action.moveSelectionToNextFindMatch`,label:U(1295,`Move Last Selection to Next Find Match`),precondition:void 0,kbOpts:{kbExpr:y.focus,primary:Vn(2089,2082),weight:100}})}_run(e,t){e.moveSelectionToNextFindMatch(t)}},CI=class extends yI{constructor(){super({id:`editor.action.moveSelectionToPreviousFindMatch`,label:U(1296,`Move Last Selection to Previous Find Match`),precondition:void 0})}_run(e,t){e.moveSelectionToPreviousFindMatch(t)}},wI=class extends yI{constructor(){super({id:`editor.action.selectHighlights`,label:U(1297,`Select All Occurrences of Find Match`),precondition:void 0,kbOpts:{kbExpr:y.focus,primary:3114,weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`3_multi`,title:G(1285,`Select All &&Occurrences`),order:7}})}_run(e,t){e.selectAll(t)}},TI=class extends yI{constructor(){super({id:`editor.action.changeAll`,label:U(1298,`Change All Occurrences`),precondition:E.and(y.writable,y.editorTextFocus),kbOpts:{kbExpr:y.editorTextFocus,primary:2108,weight:100},contextMenuOpts:{group:`1_modification`,order:1.2}})}_run(e,t){e.selectAll(t)}},EI=class{constructor(e,t,n,r,i){this._model=e,this._searchText=t,this._matchCase=n,this._wordSeparators=r,this._cachedFindMatches=null,this._modelVersionId=this._model.getVersionId(),i&&this._model===i._model&&this._searchText===i._searchText&&this._matchCase===i._matchCase&&this._wordSeparators===i._wordSeparators&&this._modelVersionId===i._modelVersionId&&(this._cachedFindMatches=i._cachedFindMatches)}findMatches(){return this._cachedFindMatches===null&&(this._cachedFindMatches=this._model.findMatches(this._searchText,!0,!1,this._matchCase,this._wordSeparators,!1).map(e=>e.range),this._cachedFindMatches.sort(T.compareRangesUsingStarts)),this._cachedFindMatches}},DI=class extends x{static{lI=this}static{this.ID=`editor.contrib.selectionHighlighter`}constructor(e,t){super(),this._languageFeaturesService=t,this.editor=e,this._isEnabled=e.getOption(122),this._isEnabledMultiline=e.getOption(124),this._maxLength=e.getOption(123),this._decorations=e.createDecorationsCollection(),this.updateSoon=this._register(new Zr(()=>this._update(),300)),this.state=null,this._register(e.onDidChangeConfiguration(t=>{this._isEnabled=e.getOption(122),this._isEnabledMultiline=e.getOption(124),this._maxLength=e.getOption(123)})),this._register(e.onDidChangeCursorSelection(e=>{this._isEnabled&&(e.selection.isEmpty()?e.reason===3?(this.state&&this._setState(null),this.updateSoon.schedule()):this._setState(null):this._update())})),this._register(e.onDidChangeModel(e=>{this._setState(null)})),this._register(e.onDidChangeModelContent(e=>{this._isEnabled&&this.updateSoon.schedule()}));let n=AC.get(e);n&&this._register(n.getState().onFindReplaceStateChange(e=>{this._update()})),this.updateSoon.schedule()}_update(){this._setState(lI._createState(this.state,this._isEnabled,this._isEnabledMultiline,this._maxLength,this.editor))}static _createState(e,t,n,r,i){if(!t||!i.hasModel())return null;if(!n){let e=i.getSelection();if(e.startLineNumber!==e.endLineNumber)return null}let a=vI.get(i);if(!a)return null;let o=AC.get(i);if(!o)return null;let s=a.getSession(o);if(!s){let e=i.getSelections();if(e.length>1){let t=o.getState().matchCase;if(!OI(i.getModel(),e,t))return null}s=_I.create(i,o)}if(!s||s.currentMatch||/^[ \t]+$/.test(s.searchText)||r>0&&s.searchText.length>r)return null;let c=o.getState(),l=c.matchCase;if(c.isRevealed){let e=c.searchString;l||(e=e.toLowerCase());let t=s.searchText;if(l||(t=t.toLowerCase()),e===t&&s.matchCase===c.matchCase&&s.wholeWord===c.wholeWord&&!c.isRegex)return null}return new EI(i.getModel(),s.searchText,s.matchCase,s.wholeWord?i.getOption(148):null,e)}_setState(e){if(this.state=e,!this.state){this._decorations.clear();return}if(!this.editor.hasModel())return;let t=this.editor.getModel();if(t.isTooLargeForTokenization())return;let n=this.state.findMatches(),r=this.editor.getSelections();r.sort(T.compareRangesUsingStarts);let i=[];for(let e=0,t=0,a=n.length,o=r.length;e<a;){let a=n[e];if(t>=o)i.push(a),e++;else{let n=T.compareRangesUsingStarts(a,r[t]);n<0?((r[t].isEmpty()||!T.areIntersecting(a,r[t]))&&i.push(a),e++):(n>0||e++,t++)}}let a=this.editor.getOption(90)!==`off`,o=this._languageFeaturesService.documentHighlightProvider.has(t)&&a,s=i.map(e=>({range:e,options:oI(o)}));this._decorations.set(s)}dispose(){this._setState(null),super.dispose()}};DI=lI=sI([cI(1,H)],DI);function OI(e,t,n){let r=kI(e,t[0],!n);for(let i=1,a=t.length;i<a;i++){let a=t[i];if(a.isEmpty())return!1;let o=kI(e,a,!n);if(r!==o)return!1}return!0}function kI(e,t,n){let r=e.getValueInRange(t);return n?r.toLowerCase():r}var AI=class extends R{constructor(){super({id:`editor.action.focusNextCursor`,label:U(1299,`Focus Next Cursor`),metadata:{description:G(1286,`Focuses the next cursor`),args:[]},precondition:void 0})}run(e,t,n){if(!t.hasModel())return;let r=t._getViewModel();if(r.cursorConfig.readOnly)return;r.model.pushStackElement();let i=Array.from(r.getCursorStates()),a=i.shift();a&&(i.push(a),r.setCursorStates(n.source,3,i),r.revealPrimaryCursor(n.source,!0),uI(i,r.getCursorStates()))}},jI=class extends R{constructor(){super({id:`editor.action.focusPreviousCursor`,label:U(1300,`Focus Previous Cursor`),metadata:{description:G(1287,`Focuses the previous cursor`),args:[]},precondition:void 0})}run(e,t,n){if(!t.hasModel())return;let r=t._getViewModel();if(r.cursorConfig.readOnly)return;r.model.pushStackElement();let i=Array.from(r.getCursorStates()),a=i.pop();a&&(i.unshift(a),r.setCursorStates(n.source,3,i),r.revealPrimaryCursor(n.source,!0),uI(i,r.getCursorStates()))}};K(vI.ID,vI,4),K(DI.ID,DI,1),q(dI),q(fI),q(pI),q(bI),q(xI),q(SI),q(CI),q(wI),q(TI),q(mI),q(hI),q(AI),q(jI);const MI={Visible:new N(`parameterHintsVisible`,!1),MultipleSignatures:new N(`parameterHintsMultipleSignatures`,!1)};async function NI(e,t,n,r,i){let a=e.ordered(t);for(let e of a)try{let a=await e.provideSignatureHelp(t,n,i,r);if(a)return a}catch(e){ct(e)}}gd.registerCommand(`_executeSignatureHelpProvider`,async(e,...t)=>{let[n,r,i]=t;J(ur.isUri(n)),J(C.isIPosition(r)),J(typeof i==`string`||!i);let a=e.get(H),o=await e.get(Et).createModelReference(n);try{let e=await NI(a.signatureHelpProvider,o.object.textEditorModel,C.lift(r),{triggerKind:od.Invoke,isRetrigger:!1,triggerCharacter:i},M.None);return e?(setTimeout(()=>e.dispose(),0),e.value):void 0}finally{o.dispose()}});var PI;(function(e){e.Default={type:0};class t{constructor(e,t){this.request=e,this.previouslyActiveHints=t,this.type=2}}e.Pending=t;class n{constructor(e){this.hints=e,this.type=1}}e.Active=n})(PI||={});var FI=class e extends x{static{this.DEFAULT_DELAY=120}constructor(t,n,r=e.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new D),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=PI.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new Bt),this.triggerChars=new Hr,this.retriggerChars=new Hr,this.triggerId=0,this.editor=t,this.providers=n,this.throttledDelayer=new Hu(r),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(e=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(e=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(e=>this.onCursorChange(e))),this._register(this.editor.onDidChangeModelContent(e=>this.onModelContentChange())),this._register(this.providers.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(e=>this.onDidType(e))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(e){this._state.type===2&&this._state.request.cancel(),this._state=e}cancel(e=!1){this.state=PI.Default,this.throttledDelayer.cancel(),e||this._onChangedHints.fire(void 0)}trigger(e,t){let n=this.editor.getModel();if(!n||!this.providers.has(n))return;let r=++this.triggerId;this._pendingTriggers.push(e),this.throttledDelayer.trigger(()=>this.doTrigger(r),t).catch(mr)}next(){if(this.state.type!==1)return;let e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,n=t%e===e-1,r=this.editor.getOption(98).cycle;if((e<2||n)&&!r){this.cancel();return}this.updateActiveSignature(n&&r?0:t+1)}previous(){if(this.state.type!==1)return;let e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,n=t===0,r=this.editor.getOption(98).cycle;if((e<2||n)&&!r){this.cancel();return}this.updateActiveSignature(n&&r?e-1:t-1)}updateActiveSignature(e){this.state.type===1&&(this.state=new PI.Active({...this.state.hints,activeSignature:e}),this._onChangedHints.fire(this.state.hints))}async doTrigger(e){let t=this.state.type===1||this.state.type===2,n=this.getLastActiveHints();if(this.cancel(!0),this._pendingTriggers.length===0)return!1;let r=this._pendingTriggers.reduce(II);this._pendingTriggers=[];let i={triggerKind:r.triggerKind,triggerCharacter:r.triggerCharacter,isRetrigger:t,activeSignatureHelp:n};if(!this.editor.hasModel())return!1;let a=this.editor.getModel(),o=this.editor.getPosition();this.state=new PI.Pending(li(e=>NI(this.providers,a,o,i,e)),n);try{let t=await this.state.request;return e===this.triggerId?!t||!t.value.signatures||t.value.signatures.length===0?(t?.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1):(this.state=new PI.Active(t.value),this._lastSignatureHelpResult.value=t,this._onChangedHints.fire(this.state.hints),!0):(t?.dispose(),!1)}catch(t){return e===this.triggerId&&(this.state=PI.Default),mr(t),!1}}getLastActiveHints(){switch(this.state.type){case 1:return this.state.hints;case 2:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return this.state.type===1||this.state.type===2||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars.clear(),this.retriggerChars.clear();let e=this.editor.getModel();if(e)for(let t of this.providers.ordered(e)){for(let e of t.signatureHelpTriggerCharacters||[])if(e.length){let t=e.charCodeAt(0);this.triggerChars.add(t),this.retriggerChars.add(t)}for(let e of t.signatureHelpRetriggerCharacters||[])e.length&&this.retriggerChars.add(e.charCodeAt(0))}}onDidType(e){if(!this.triggerOnType)return;let t=e.length-1,n=e.charCodeAt(t);(this.triggerChars.has(n)||this.isTriggered&&this.retriggerChars.has(n))&&this.trigger({triggerKind:od.TriggerCharacter,triggerCharacter:e.charAt(t)})}onCursorChange(e){e.source===`mouse`?this.cancel():this.isTriggered&&this.trigger({triggerKind:od.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:od.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(98).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}};function II(e,t){switch(t.triggerKind){case od.Invoke:return t;case od.ContentChange:return e;case od.TriggerCharacter:default:return t}}var LI=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},RI=function(e,t){return function(n,r){t(n,r,e)}},zI,BI=b,VI=nu(`parameter-hints-next`,X.chevronDown,G(1302,`Icon for show next parameter hint.`)),HI=nu(`parameter-hints-previous`,X.chevronUp,G(1303,`Icon for show previous parameter hint.`)),UI=class extends x{static{zI=this}static{this.ID=`editor.widget.parameterHintsWidget`}constructor(e,t,n,r,i){super(),this.editor=e,this.model=t,this.renderDisposeables=this._register(new L),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=new et({editor:e},i,r),this.keyVisible=MI.Visible.bindTo(n),this.keyMultipleSignatures=MI.MultipleSignatures.bindTo(n)}createParameterHintDOMNodes(){let e=BI(`.editor-widget.parameter-hints-widget`),t=B(e,BI(`.phwrapper`));t.tabIndex=-1;let n=B(t,BI(`.controls`)),r=B(n,BI(`.button`+I.asCSSSelector(HI))),i=B(n,BI(`.overloads`)),a=B(n,BI(`.button`+I.asCSSSelector(VI)));this._register(z(r,`click`,e=>{Yl.stop(e),this.previous()})),this._register(z(a,`click`,e=>{Yl.stop(e),this.next()}));let o=BI(`.body`),s=new Xr(o,{alwaysConsumeMouseWheel:!0});this._register(s),t.appendChild(s.getDomNode());let c=B(o,BI(`.signature`)),l=B(o,BI(`.docs`));e.style.userSelect=`text`,this.domNodes={element:e,signature:c,overloads:i,docs:l,scrollbar:s},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(e=>{this.visible&&this.editor.layoutContentWidget(this)}));let u=()=>{if(!this.domNodes)return;let e=this.editor.getOption(59),t=this.domNodes.element;t.style.fontSize=`${e.fontSize}px`,t.style.lineHeight=`${e.lineHeight/e.fontSize}`,t.style.setProperty(`--vscode-parameterHintsWidget-editorFontFamily`,e.fontFamily),t.style.setProperty(`--vscode-parameterHintsWidget-editorFontFamilyDefault`,ga.fontFamily)};u(),this._register(An.chain(this.editor.onDidChangeConfiguration.bind(this.editor),e=>e.filter(e=>e.hasChanged(59)))(u)),this._register(this.editor.onDidLayoutChange(e=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{this.domNodes?.element.classList.add(`visible`)},100),this.editor.layoutContentWidget(this))}hide(){this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,this.domNodes?.element.classList.remove(`visible`),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[1,2]}:null}render(e){if(this.renderDisposeables.clear(),!this.domNodes)return;let t=e.signatures.length>1;this.domNodes.element.classList.toggle(`multiple`,t),this.keyMultipleSignatures.set(t),this.domNodes.signature.innerText=``,this.domNodes.docs.innerText=``;let n=e.signatures[e.activeSignature];if(!n)return;let r=B(this.domNodes.signature,BI(`.code`)),i=n.parameters.length>0,a=n.activeParameter??e.activeParameter;if(i)this.renderParameters(r,n,a);else{let e=B(r,BI(`span`));e.textContent=n.label}let o=n.parameters[a];if(o?.documentation){let e=BI(`span.documentation`);if(typeof o.documentation==`string`)e.textContent=o.documentation;else{let t=this.renderMarkdownDocs(o.documentation);e.appendChild(t.element)}B(this.domNodes.docs,BI(`p`,{},e))}if(n.documentation!==void 0)if(typeof n.documentation==`string`)B(this.domNodes.docs,BI(`p`,{},n.documentation));else{let e=this.renderMarkdownDocs(n.documentation);B(this.domNodes.docs,e.element)}let s=this.hasDocs(n,o);if(this.domNodes.signature.classList.toggle(`has-docs`,s),this.domNodes.docs.classList.toggle(`empty`,!s),this.domNodes.overloads.textContent=String(e.activeSignature+1).padStart(e.signatures.length.toString().length,`0`)+`/`+e.signatures.length,o){let e=``,t=n.parameters[a];e=Array.isArray(t.label)?n.label.substring(t.label[0],t.label[1]):t.label,t.documentation&&(e+=typeof t.documentation==`string`?`, ${t.documentation}`:`, ${t.documentation.value}`),n.documentation&&(e+=typeof n.documentation==`string`?`, ${n.documentation}`:`, ${n.documentation.value}`),this.announcedLabel!==e&&(va(G(1304,`{0}, hint`,e)),this.announcedLabel=e)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(e){let t=this.renderDisposeables.add(this.markdownRenderer.render(e,{asyncRenderCallback:()=>{this.domNodes?.scrollbar.scanDomNode()}}));return t.element.classList.add(`markdown-docs`),t}hasDocs(e,t){return!!(t&&typeof t.documentation==`string`&&Ma(t.documentation).length>0||t&&typeof t.documentation==`object`&&Ma(t.documentation).value.length>0||e.documentation&&typeof e.documentation==`string`&&Ma(e.documentation).length>0||e.documentation&&typeof e.documentation==`object`&&Ma(e.documentation.value).length>0)}renderParameters(e,t,n){let[r,i]=this.getParameterLabelOffsets(t,n),a=document.createElement(`span`);a.textContent=t.label.substring(0,r);let o=document.createElement(`span`);o.textContent=t.label.substring(r,i),o.className=`parameter active`;let s=document.createElement(`span`);s.textContent=t.label.substring(i),B(e,a,o,s)}getParameterLabelOffsets(e,t){let n=e.parameters[t];if(n){if(Array.isArray(n.label))return n.label;if(n.label.length){let t=RegExp(`(\\W|^)${Pt(n.label)}(?=\\W|$)`,`g`);t.test(e.label);let r=t.lastIndex-n.label.length;return r>=0?[r,t.lastIndex]:[0,0]}else return[0,0]}else return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return zI.ID}updateMaxHeight(){if(!this.domNodes)return;let e=`${Math.max(this.editor.getLayoutInfo().height/4,250)}px`;this.domNodes.element.style.maxHeight=e;let t=this.domNodes.element.getElementsByClassName(`phwrapper`);t.length&&(t[0].style.maxHeight=e)}};UI=zI=LI([RI(2,On),RI(3,da),RI(4,wt)],UI),F(`editorHoverWidget.highlightForeground`,zr,G(1305,`Foreground color of the active item in the parameter hint.`));var WI=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},GI=function(e,t){return function(n,r){t(n,r,e)}},KI,qI=class extends x{static{KI=this}static{this.ID=`editor.controller.parameterHints`}static get(e){return e.getContribution(KI.ID)}constructor(e,t,n){super(),this.editor=e,this.model=this._register(new FI(e,n.signatureHelpProvider)),this._register(this.model.onChangedHints(e=>{e?(this.widget.value.show(),this.widget.value.render(e)):this.widget.rawValue?.hide()})),this.widget=new Hc(()=>this._register(t.createInstance(UI,this.editor,this.model)))}cancel(){this.model.cancel()}previous(){this.widget.rawValue?.previous()}next(){this.widget.rawValue?.next()}trigger(e){this.model.trigger(e,0)}};qI=KI=WI([GI(1,k),GI(2,H)],qI);var JI=class extends R{constructor(){super({id:`editor.action.triggerParameterHints`,label:U(1301,`Trigger Parameter Hints`),precondition:y.hasSignatureHelpProvider,kbOpts:{kbExpr:y.editorTextFocus,primary:3082,weight:100}})}run(e,t){qI.get(t)?.trigger({triggerKind:od.Invoke})}};K(qI.ID,qI,2),q(JI);var YI=175,XI=Ar.bindToContribution(qI.get);W(new XI({id:`closeParameterHints`,precondition:MI.Visible,handler:e=>e.cancel(),kbOpts:{weight:YI,kbExpr:y.focus,primary:9,secondary:[1033]}})),W(new XI({id:`showPrevParameterHint`,precondition:E.and(MI.Visible,MI.MultipleSignatures),handler:e=>e.previous(),kbOpts:{weight:YI,kbExpr:y.focus,primary:16,secondary:[528],mac:{primary:16,secondary:[528,302]}}})),W(new XI({id:`showNextParameterHint`,precondition:E.and(MI.Visible,MI.MultipleSignatures),handler:e=>e.next(),kbOpts:{weight:YI,kbExpr:y.focus,primary:18,secondary:[530],mac:{primary:18,secondary:[530,300]}}}));var ZI=class extends x{static{this.ID=`editor.contrib.placeholderText`}constructor(e){super(),this._editor=e,this._editorObs=Bs(this._editor),this._placeholderText=this._editorObs.getOption(100),this._state=ya({owner:this,equalsFn:Yo},e=>{let t=this._placeholderText.read(e);if(t&&this._editorObs.valueIsEmpty.read(e))return{placeholder:t}}),this._shouldViewBeAlive=QI(this,e=>this._state.read(e)?.placeholder!==void 0),this._view=O(e=>{if(!this._shouldViewBeAlive.read(e))return;let t=zu(`div.editorPlaceholder`);e.store.add(g(e=>{let n=this._state.read(e),r=n?.placeholder!==void 0;t.root.style.display=r?`block`:`none`,t.root.innerText=n?.placeholder??``})),e.store.add(g(e=>{let n=this._editorObs.layoutInfo.read(e);t.root.style.left=`${n.contentLeft}px`,t.root.style.width=n.contentWidth-n.verticalScrollbarWidth+`px`,t.root.style.top=`${this._editor.getTopForLineNumber(0)}px`})),e.store.add(g(e=>{t.root.style.fontFamily=this._editorObs.getOption(58).read(e),t.root.style.fontSize=this._editorObs.getOption(61).read(e)+`px`,t.root.style.lineHeight=this._editorObs.getOption(75).read(e)+`px`})),e.store.add(this._editorObs.createOverlayWidget({allowEditorOverflow:!1,minContentWidthInPx:Lr(0),position:Lr(null),domNode:t.root}))}),this._view.recomputeInitiallyAndOnChange(this._store)}};function QI(e,t){return Oi(e,(e,n)=>n===!0?!0:t(e))}var $I=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},eL=function(e,t){return function(n,r){t(n,r,e)}},tL=class{constructor(e){this.instantiationService=e}init(...e){}};function nL(e,t){return class extends t{constructor(){super(...arguments),this._autorun=void 0}init(...t){this._autorun=Ql((n,r)=>{let i=hi(e(),n);r.add(this.instantiationService.createInstance(i,...t))})}dispose(){this._autorun?.dispose()}}}function rL(e){return Ii()?nL(e,iL):e()}var iL=class extends tL{constructor(e,t){super(t),this.init(e)}};iL=$I([eL(1,k)],iL),K(ZI.ID,rL(()=>ZI),0),F(`editor.placeholder.foreground`,bl,G(1324,`Foreground color of the placeholder text in the editor.`));var aL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},oL=function(e,t){return function(n,r){t(n,r,e)}};const sL=new N(`renameInputVisible`,!1,G(1376,`Whether the rename input widget is visible`));new N(`renameInputFocused`,!1,G(1377,`Whether the rename input widget is focused`));var cL=class{constructor(e,t,n,r,i,a){this._editor=e,this._acceptKeybindings=t,this._themeService=n,this._keybindingService=r,this._logService=a,this.allowEditorOverflow=!0,this._disposables=new L,this._visibleContextKey=sL.bindTo(i),this._isEditingRenameCandidate=!1,this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,this._candidates=new Set,this._beforeFirstInputFieldEditSW=new vd,this._inputWithButton=new uL,this._disposables.add(this._inputWithButton),this._editor.addContentWidget(this),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(59)&&this._updateFont()})),this._disposables.add(n.onDidColorThemeChange(this._updateStyles,this))}dispose(){this._disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return`__renameInputWidget`}getDomNode(){return this._domNode||(this._domNode=document.createElement(`div`),this._domNode.className=`monaco-editor rename-box`,this._domNode.appendChild(this._inputWithButton.domNode),this._renameCandidateListView=this._disposables.add(new lL(this._domNode,{fontInfo:this._editor.getOption(59),onFocusChange:e=>{this._inputWithButton.input.value=e,this._isEditingRenameCandidate=!1},onSelectionChange:()=>{this._isEditingRenameCandidate=!1,this.acceptInput(!1)}})),this._disposables.add(this._inputWithButton.onDidInputChange(()=>{this._renameCandidateListView?.focusedCandidate!==void 0&&(this._isEditingRenameCandidate=!0),this._timeBeforeFirstInputFieldEdit??=this._beforeFirstInputFieldEditSW.elapsed(),this._renameCandidateProvidersCts?.token.isCancellationRequested===!1&&this._renameCandidateProvidersCts.cancel(),this._renameCandidateListView?.clearFocus()})),this._label=document.createElement(`div`),this._label.className=`rename-label`,this._domNode.appendChild(this._label),this._updateFont(),this._updateStyles(this._themeService.getColorTheme())),this._domNode}_updateStyles(e){if(!this._domNode)return;let t=e.getColor(ae),n=e.getColor($s);this._domNode.style.backgroundColor=String(e.getColor(ai)??``),this._domNode.style.boxShadow=t?` 0 0 8px 2px ${t}`:``,this._domNode.style.border=n?`1px solid ${n}`:``,this._domNode.style.color=String(e.getColor(en)??``);let r=e.getColor(gl);this._inputWithButton.domNode.style.backgroundColor=String(e.getColor(fn)??``),this._inputWithButton.input.style.backgroundColor=String(e.getColor(fn)??``),this._inputWithButton.domNode.style.borderWidth=r?`1px`:`0px`,this._inputWithButton.domNode.style.borderStyle=r?`solid`:`none`,this._inputWithButton.domNode.style.borderColor=r?.toString()??`none`}_updateFont(){if(this._domNode===void 0)return;J(this._label!==void 0,`RenameWidget#_updateFont: _label must not be undefined given _domNode is defined`),this._editor.applyFontInfo(this._inputWithButton.input);let e=this._editor.getOption(59);this._label.style.fontSize=`${this._computeLabelFontSize(e.fontSize)}px`}_computeLabelFontSize(e){return e*.8}getPosition(){if(!this._visible||!this._editor.hasModel()||!this._editor.getDomNode())return null;let e=rl(this.getDomNode().ownerDocument.body),t=vs(this._editor.getDomNode());this._nPxAvailableAbove=this._getTopForPosition()+t.top,this._nPxAvailableBelow=e.height-this._nPxAvailableAbove;let n=this._editor.getOption(75),{totalHeight:r}=dL.getLayoutInfo({lineHeight:n}),i=this._nPxAvailableBelow>r*6?[2,1]:[1,2];return{position:this._position,preference:i}}beforeRender(){let[e,t]=this._acceptKeybindings;return this._label.innerText=G(1378,`{0} to Rename, {1} to Preview`,this._keybindingService.lookupKeybinding(e)?.getLabel(),this._keybindingService.lookupKeybinding(t)?.getLabel()),this._domNode.style.minWidth=`200px`,null}afterRender(e){if(e===null){this.cancelInput(!0,`afterRender (because position is null)`);return}if(!this._editor.hasModel()||!this._editor.getDomNode())return;J(this._renameCandidateListView),J(this._nPxAvailableAbove!==void 0),J(this._nPxAvailableBelow!==void 0);let t=vu(this._inputWithButton.domNode),n=vu(this._label),r;r=e===2?this._nPxAvailableBelow:this._nPxAvailableAbove,this._renameCandidateListView.layout({height:r-n-t,width:Zu(this._inputWithButton.domNode)})}acceptInput(e){this._trace(`invoking acceptInput`),this._currentAcceptInput?.(e)}cancelInput(e,t){this._currentCancelInput?.(e)}focusNextRenameSuggestion(){this._renameCandidateListView?.focusNext()||(this._inputWithButton.input.value=this._currentName)}focusPreviousRenameSuggestion(){this._renameCandidateListView?.focusPrevious()||(this._inputWithButton.input.value=this._currentName)}getInput(e,t,n,r,i){let{start:a,end:o}=this._getSelection(e,t);this._renameCts=i;let s=new L;this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,r===void 0?this._inputWithButton.button.style.display=`none`:(this._inputWithButton.button.style.display=`flex`,this._requestRenameCandidatesOnce=r,this._requestRenameCandidates(t,!1),s.add(z(this._inputWithButton.button,`click`,()=>this._requestRenameCandidates(t,!0))),s.add(z(this._inputWithButton.button,Pc.KEY_DOWN,e=>{let n=new In(e);(n.equals(3)||n.equals(10))&&(n.stopPropagation(),n.preventDefault(),this._requestRenameCandidates(t,!0))}))),this._isEditingRenameCandidate=!1,this._domNode.classList.toggle(`preview`,n),this._position=new C(e.startLineNumber,e.startColumn),this._currentName=t,this._inputWithButton.input.value=t,this._inputWithButton.input.setAttribute(`selectionStart`,a.toString()),this._inputWithButton.input.setAttribute(`selectionEnd`,o.toString()),this._inputWithButton.input.size=Math.max((e.endColumn-e.startColumn)*1.1,20),this._beforeFirstInputFieldEditSW.reset(),s.add(Cl(()=>{this._renameCts=void 0,i.dispose(!0)})),s.add(Cl(()=>{this._renameCandidateProvidersCts!==void 0&&(this._renameCandidateProvidersCts.dispose(!0),this._renameCandidateProvidersCts=void 0)})),s.add(Cl(()=>this._candidates.clear()));let c=new ro;return c.p.finally(()=>{s.dispose(),this._hide()}),this._currentCancelInput=e=>(this._trace(`invoking _currentCancelInput`),this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView?.clearCandidates(),c.complete(e),!0),this._currentAcceptInput=e=>{this._trace(`invoking _currentAcceptInput`),J(this._renameCandidateListView!==void 0);let r=this._renameCandidateListView.nCandidates,i,a,o=this._renameCandidateListView.focusedCandidate;if(o===void 0?(this._trace(`using new name from inputField`),i=this._inputWithButton.input.value,a=this._isEditingRenameCandidate?{k:`userEditedRenameSuggestion`}:{k:`inputField`}):(this._trace(`using new name from renameSuggestion`),i=o,a={k:`renameSuggestion`}),i===t||i.trim().length===0){this.cancelInput(!0,`_currentAcceptInput (because newName === value || newName.trim().length === 0)`);return}this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView.clearCandidates(),c.complete({newName:i,wantsPreview:n&&e,stats:{source:a,nRenameSuggestions:r,timeBeforeFirstInputFieldEdit:this._timeBeforeFirstInputFieldEdit,nRenameSuggestionsInvocations:this._nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:this._hadAutomaticRenameSuggestionsInvocation}})},s.add(i.token.onCancellationRequested(()=>this.cancelInput(!0,`cts.token.onCancellationRequested`))),s.add(this._editor.onDidBlurEditorWidget(()=>this.cancelInput(!this._domNode?.ownerDocument.hasFocus(),`editor.onDidBlurEditorWidget`))),this._show(),c.p}_requestRenameCandidates(e,t){if(this._requestRenameCandidatesOnce!==void 0&&(this._renameCandidateProvidersCts!==void 0&&this._renameCandidateProvidersCts.dispose(!0),J(this._renameCts),this._inputWithButton.buttonState!==`stop`)){this._renameCandidateProvidersCts=new Sr;let n=t?hs.Invoke:hs.Automatic,r=this._requestRenameCandidatesOnce(n,this._renameCandidateProvidersCts.token);if(r.length===0){this._inputWithButton.setSparkleButton();return}t||(this._hadAutomaticRenameSuggestionsInvocation=!0),this._nRenameSuggestionsInvocations+=1,this._inputWithButton.setStopButton(),this._updateRenameCandidates(r,e,this._renameCts.token)}}_getSelection(e,t){J(this._editor.hasModel());let n=this._editor.getSelection(),r=0,i=t.length;return!T.isEmpty(n)&&!T.spansMultipleLines(n)&&T.containsRange(e,n)&&(r=Math.max(0,n.startColumn-e.startColumn),i=Math.min(e.endColumn,n.endColumn)-e.startColumn),{start:r,end:i}}_show(){this._trace(`invoking _show`),this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber,0),this._visible=!0,this._visibleContextKey.set(!0),this._editor.layoutContentWidget(this),setTimeout(()=>{this._inputWithButton.input.focus(),this._inputWithButton.input.setSelectionRange(parseInt(this._inputWithButton.input.getAttribute(`selectionStart`)),parseInt(this._inputWithButton.input.getAttribute(`selectionEnd`)))},100)}async _updateRenameCandidates(e,t,n){let r=(...e)=>this._trace(`_updateRenameCandidates`,...e);r(`start`);let i=await ir(Promise.allSettled(e),n);if(this._inputWithButton.setSparkleButton(),i===void 0){r(`returning early - received updateRenameCandidates results - undefined`);return}let a=i.flatMap(e=>e.status===`fulfilled`&&Qu(e.value)?e.value:[]);r(`received updateRenameCandidates results - total (unfiltered) ${a.length} candidates.`);let o=zi(a,e=>e.newSymbolName);r(`distinct candidates - ${o.length} candidates.`);let s=o.filter(({newSymbolName:e})=>e.trim().length>0&&e!==this._inputWithButton.input.value&&e!==t&&!this._candidates.has(e));if(r(`valid distinct candidates - ${a.length} candidates.`),s.forEach(e=>this._candidates.add(e.newSymbolName)),s.length<1){r(`returning early - no valid distinct candidates`);return}r(`setting candidates`),this._renameCandidateListView.setCandidates(s),r(`asking editor to re-layout`),this._editor.layoutContentWidget(this)}_hide(){this._trace(`invoked _hide`),this._visible=!1,this._visibleContextKey.reset(),this._editor.layoutContentWidget(this)}_getTopForPosition(){let e=this._editor.getVisibleRanges(),t;return e.length>0?t=e[0].startLineNumber:(this._logService.warn(`RenameWidget#_getTopForPosition: this should not happen - visibleRanges is empty`),t=Math.max(1,this._position.lineNumber-5)),this._editor.getTopForLineNumber(this._position.lineNumber)-this._editor.getTopForLineNumber(t)}_trace(...e){this._logService.trace(`RenameWidget`,...e)}};cL=aL([oL(2,pa),oL(3,Yt),oL(4,On),oL(5,Wl)],cL);var lL=class e{constructor(t,n){this._disposables=new L,this._availableHeight=0,this._minimumWidth=0,this._lineHeight=n.fontInfo.lineHeight,this._typicalHalfwidthCharacterWidth=n.fontInfo.typicalHalfwidthCharacterWidth,this._listContainer=document.createElement(`div`),this._listContainer.className=`rename-box rename-candidate-list-container`,t.appendChild(this._listContainer),this._listWidget=e._createListWidget(this._listContainer,this._candidateViewHeight,n.fontInfo),this._disposables.add(this._listWidget.onDidChangeFocus(e=>{e.elements.length===1&&n.onFocusChange(e.elements[0].newSymbolName)},this._disposables)),this._disposables.add(this._listWidget.onDidChangeSelection(e=>{e.elements.length===1&&n.onSelectionChange()},this._disposables)),this._disposables.add(this._listWidget.onDidBlur(e=>{this._listWidget.setFocus([])})),this._listWidget.style(Ti({listInactiveFocusForeground:hr,listInactiveFocusBackground:Kn}))}dispose(){this._listWidget.dispose(),this._disposables.dispose()}layout({height:e,width:t}){this._availableHeight=e,this._minimumWidth=t}setCandidates(e){this._listWidget.splice(0,0,e);let t=this._pickListHeight(this._listWidget.length),n=this._pickListWidth(e);this._listWidget.layout(t,n),this._listContainer.style.height=`${t}px`,this._listContainer.style.width=`${n}px`,wr(G(1379,`Received {0} rename suggestions`,e.length))}clearCandidates(){this._listContainer.style.height=`0px`,this._listContainer.style.width=`0px`,this._listWidget.splice(0,this._listWidget.length,[])}get nCandidates(){return this._listWidget.length}get focusedCandidate(){if(this._listWidget.length===0)return;let e=this._listWidget.getSelectedElements()[0];if(e!==void 0)return e.newSymbolName;let t=this._listWidget.getFocusedElements()[0];if(t!==void 0)return t.newSymbolName}focusNext(){if(this._listWidget.length===0)return!1;let e=this._listWidget.getFocus();if(e.length===0)return this._listWidget.focusFirst(),this._listWidget.reveal(0),!0;if(e[0]===this._listWidget.length-1)return this._listWidget.setFocus([]),this._listWidget.reveal(0),!1;{this._listWidget.focusNext();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}}focusPrevious(){if(this._listWidget.length===0)return!1;let e=this._listWidget.getFocus();if(e.length===0){this._listWidget.focusLast();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}else if(e[0]===0)return this._listWidget.setFocus([]),!1;else{this._listWidget.focusPrevious();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}}clearFocus(){this._listWidget.setFocus([])}get _candidateViewHeight(){let{totalHeight:e}=dL.getLayoutInfo({lineHeight:this._lineHeight});return e}_pickListHeight(e){let t=this._candidateViewHeight*e;return Math.min(t,this._availableHeight,this._candidateViewHeight*7)}_pickListWidth(e){let t=Math.ceil(Math.max(...e.map(e=>e.newSymbolName.length))*this._typicalHalfwidthCharacterWidth);return Math.max(this._minimumWidth,25+t+10)}static _createListWidget(e,t,n){let r=new class{getTemplateId(e){return`candidate`}getHeight(e){return t}},i=new class{constructor(){this.templateId=`candidate`}renderTemplate(e){return new dL(e,n)}renderElement(e,t,n){n.populate(e)}disposeTemplate(e){e.dispose()}};return new vn(`NewSymbolNameCandidates`,e,r,[i],{keyboardSupport:!1,mouseSupport:!0,multipleSelectionSupport:!1})}},uL=class{constructor(){this._buttonHoverContent=``,this._onDidInputChange=new D,this.onDidInputChange=this._onDidInputChange.event,this._disposables=new L}get domNode(){return this._domNode||(this._domNode=document.createElement(`div`),this._domNode.className=`rename-input-with-button`,this._domNode.style.display=`flex`,this._domNode.style.flexDirection=`row`,this._domNode.style.alignItems=`center`,this._inputNode=document.createElement(`input`),this._inputNode.className=`rename-input`,this._inputNode.type=`text`,this._inputNode.style.border=`none`,this._inputNode.setAttribute(`aria-label`,G(1380,`Rename input. Type new name and press Enter to commit.`)),this._domNode.appendChild(this._inputNode),this._buttonNode=document.createElement(`div`),this._buttonNode.className=`rename-suggestions-button`,this._buttonNode.setAttribute(`tabindex`,`0`),this._buttonGenHoverText=G(1381,`Generate new name suggestions`),this._buttonCancelHoverText=G(1382,`Cancel`),this._buttonHoverContent=this._buttonGenHoverText,this._disposables.add(Sl().setupDelayedHover(this._buttonNode,()=>({content:this._buttonHoverContent,appearance:{showPointer:!0,compact:!0}}))),this._domNode.appendChild(this._buttonNode),this._disposables.add(z(this.input,Pc.INPUT,()=>this._onDidInputChange.fire())),this._disposables.add(z(this.input,Pc.KEY_DOWN,e=>{let t=new In(e);(t.keyCode===15||t.keyCode===17)&&this._onDidInputChange.fire()})),this._disposables.add(z(this.input,Pc.CLICK,()=>this._onDidInputChange.fire())),this._disposables.add(z(this.input,Pc.FOCUS,()=>{this.domNode.style.outlineWidth=`1px`,this.domNode.style.outlineStyle=`solid`,this.domNode.style.outlineOffset=`-1px`,this.domNode.style.outlineColor=`var(--vscode-focusBorder)`})),this._disposables.add(z(this.input,Pc.BLUR,()=>{this.domNode.style.outline=`none`}))),this._domNode}get input(){return J(this._inputNode),this._inputNode}get button(){return J(this._buttonNode),this._buttonNode}get buttonState(){return this._buttonState}setSparkleButton(){this._buttonState=`sparkle`,this._sparkleIcon??=ic(X.sparkle),fc(this.button),this.button.appendChild(this._sparkleIcon),this.button.setAttribute(`aria-label`,`Generating new name suggestions`),this._buttonHoverContent=this._buttonGenHoverText,this.input.focus()}setStopButton(){this._buttonState=`stop`,this._stopIcon??=ic(X.stopCircle),fc(this.button),this.button.appendChild(this._stopIcon),this.button.setAttribute(`aria-label`,`Cancel generating new name suggestions`),this._buttonHoverContent=this._buttonCancelHoverText,this.input.focus()}dispose(){this._disposables.dispose()}},dL=class e{static{this._PADDING=2}constructor(t,n){this._domNode=document.createElement(`div`),this._domNode.className=`rename-box rename-candidate`,this._domNode.style.display=`flex`,this._domNode.style.columnGap=`5px`,this._domNode.style.alignItems=`center`,this._domNode.style.height=`${n.lineHeight}px`,this._domNode.style.padding=`${e._PADDING}px`;let r=document.createElement(`div`);r.style.display=`flex`,r.style.alignItems=`center`,r.style.width=r.style.height=`${n.lineHeight*.8}px`,this._domNode.appendChild(r),this._icon=ic(X.sparkle),this._icon.style.display=`none`,r.appendChild(this._icon),this._label=document.createElement(`div`),Ea(this._label,n),this._domNode.appendChild(this._label),t.appendChild(this._domNode)}populate(e){this._updateIcon(e),this._updateLabel(e)}_updateIcon(e){let t=!!e.tags?.includes(Ds.AIGenerated);this._icon.style.display=t?`inherit`:`none`}_updateLabel(e){this._label.innerText=e.newSymbolName}static getLayoutInfo({lineHeight:t}){return{totalHeight:t+e._PADDING*2}}dispose(){}},fL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},pL=function(e,t){return function(n,r){t(n,r,e)}},mL,hL=class{constructor(e,t,n){this.model=e,this.position=t,this._providerRenameIdx=0,this._providers=n.ordered(e)}hasProvider(){return this._providers.length>0}async resolveRenameLocation(e){let t=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){let n=this._providers[this._providerRenameIdx];if(!n.resolveRenameLocation)break;let r=await n.resolveRenameLocation(this.model,this.position,e);if(r){if(r.rejectReason){t.push(r.rejectReason);continue}return r}}this._providerRenameIdx=0;let n=this.model.getWordAtPosition(this.position);return n?{range:new T(this.position.lineNumber,n.startColumn,this.position.lineNumber,n.endColumn),text:n.word,rejectReason:t.length>0?t.join(`
`):void 0}:{range:T.fromPositions(this.position),text:``,rejectReason:t.length>0?t.join(`
`):void 0}}async provideRenameEdits(e,t){return this._provideRenameEdits(e,this._providerRenameIdx,[],t)}async _provideRenameEdits(e,t,n,r){let i=this._providers[t];if(!i)return{edits:[],rejectReason:n.join(`
`)};let a=await i.provideRenameEdits(this.model,this.position,e,r);if(a){if(a.rejectReason)return this._provideRenameEdits(e,t+1,n.concat(a.rejectReason),r)}else return this._provideRenameEdits(e,t+1,n.concat(G(1365,`No result.`)),r);return a}};async function gL(e,t,n,r){let i=new hL(t,n,e),a=await i.resolveRenameLocation(M.None);return a?.rejectReason?{edits:[],rejectReason:a.rejectReason}:i.provideRenameEdits(r,M.None)}var _L=class{static{mL=this}static{this.ID=`editor.contrib.renameController`}static get(e){return e.getContribution(mL.ID)}constructor(e,t,n,r,i,a,o,s){this.editor=e,this._instaService=t,this._notificationService=n,this._bulkEditService=r,this._progressService=i,this._logService=a,this._configService=o,this._languageFeaturesService=s,this._disposableStore=new L,this._cts=new Sr,this._renameWidget=this._disposableStore.add(this._instaService.createInstance(cL,this.editor,[`acceptRenameInput`,`acceptRenameInputWithPreview`]))}dispose(){this._disposableStore.dispose(),this._cts.dispose(!0)}async run(){let e=this._logService.trace.bind(this._logService,`[rename]`);if(this._cts.dispose(!0),this._cts=new Sr,!this.editor.hasModel()){e(`editor has no model`);return}let t=this.editor.getPosition(),n=new hL(this.editor.getModel(),t,this._languageFeaturesService.renameProvider);if(!n.hasProvider()){e(`skeleton has no provider`);return}let r=new Eu(this.editor,5,void 0,this._cts.token),i;try{e(`resolving rename location`);let t=n.resolveRenameLocation(r.token);this._progressService.showWhile(t,250),i=await t,e(`resolved rename location`)}catch(n){n instanceof Us?e(`resolve rename location cancelled`,JSON.stringify(n,null,`	`)):(e(`resolve rename location failed`,n instanceof Error?n:JSON.stringify(n,null,`	`)),(typeof n==`string`||qt(n))&&hm.get(this.editor)?.showMessage(n||G(1366,`An unknown error occurred while resolving rename location`),t));return}finally{r.dispose()}if(!i){e(`returning early - no loc`);return}if(i.rejectReason){e(`returning early - rejected with reason: ${i.rejectReason}`,i.rejectReason),hm.get(this.editor)?.showMessage(i.rejectReason,t);return}if(r.token.isCancellationRequested){e(`returning early - cts1 cancelled`);return}let a=new Eu(this.editor,5,i.range,this._cts.token),o=this.editor.getModel(),s=this._languageFeaturesService.newSymbolNamesProvider.all(o),c=await Promise.all(s.map(async e=>[e,await e.supportsAutomaticNewSymbolNamesTriggerKind??!1])),l=(e,t)=>{let n=c.slice();return e===hs.Automatic&&(n=n.filter(([e,t])=>t)),n.map(([n])=>n.provideNewSymbolNames(o,i.range,e,t))};e(`creating rename input field and awaiting its result`);let u=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,`editor.rename.enablePreview`),d=await this._renameWidget.getInput(i.range,i.text,u,s.length>0?l:void 0,a);if(e(`received response from rename input field`),typeof d==`boolean`){e(`returning early - rename input field response - ${d}`),d&&this.editor.focus(),a.dispose();return}this.editor.focus(),e(`requesting rename edits`);let f=ir(n.provideRenameEdits(d.newName,a.token),a.token).then(async t=>{if(!t){e(`returning early - no rename edits result`);return}if(!this.editor.hasModel()){e(`returning early - no model after rename edits are provided`);return}if(t.rejectReason){e(`returning early - rejected with reason: ${t.rejectReason}`),this._notificationService.info(t.rejectReason);return}this.editor.setSelection(T.fromPositions(this.editor.getSelection().getPosition())),e(`applying edits`),this._bulkEditService.apply(t,{editor:this.editor,showPreview:d.wantsPreview,label:G(1367,`Renaming '{0}' to '{1}'`,i?.text,d.newName),code:`undoredo.rename`,quotableLabel:G(1368,`Renaming {0} to {1}`,i?.text,d.newName),respectAutoSaveConfig:!0,reason:Fe.rename()}).then(t=>{e(`edits applied`),t.ariaSummary&&va(G(1369,`Successfully renamed '{0}' to '{1}'. Summary: {2}`,i.text,d.newName,t.ariaSummary))}).catch(t=>{e(`error when applying edits ${JSON.stringify(t,null,`	`)}`),this._notificationService.error(G(1370,`Rename failed to apply edits`)),this._logService.error(t)})},t=>{e(`error when providing rename edits`,JSON.stringify(t,null,`	`)),this._notificationService.error(G(1371,`Rename failed to compute edits`)),this._logService.error(t)}).finally(()=>{a.dispose()});return e(`returning rename operation`),this._progressService.showWhile(f,250),f}acceptRenameInput(e){this._renameWidget.acceptInput(e)}cancelRenameInput(){this._renameWidget.cancelInput(!0,`cancelRenameInput command`)}focusNextRenameSuggestion(){this._renameWidget.focusNextRenameSuggestion()}focusPreviousRenameSuggestion(){this._renameWidget.focusPreviousRenameSuggestion()}};_L=mL=fL([pL(1,k),pL(2,Ur),pL(3,Fa),pL(4,Oo),pL(5,Wl),pL(6,du),pL(7,H)],_L);var vL=class extends R{constructor(){super({id:`editor.action.rename`,label:U(1373,`Rename Symbol`),precondition:E.and(y.writable,y.hasRenameProvider),kbOpts:{kbExpr:y.editorTextFocus,primary:60,weight:100},contextMenuOpts:{group:`1_modification`,order:1.1}})}runCommand(e,t){let n=e.get(xl),[r,i]=Array.isArray(t)&&t||[void 0,void 0];return ur.isUri(r)&&C.isIPosition(i)?n.openCodeEditor({resource:r},n.getActiveCodeEditor()).then(e=>{e&&(e.setPosition(i),e.invokeWithinContext(t=>(this.reportTelemetry(t,e),this.run(t,e))))},mr):super.runCommand(e,t)}run(e,t){let n=e.get(Wl),r=_L.get(t);return r?(n.trace(`[RenameAction] got controller, running...`),r.run()):(n.trace(`[RenameAction] returning early - controller missing`),Promise.resolve())}};K(_L.ID,_L,4),q(vL);var yL=Ar.bindToContribution(_L.get);W(new yL({id:`acceptRenameInput`,precondition:sL,handler:e=>e.acceptRenameInput(!1),kbOpts:{weight:199,kbExpr:E.and(y.focus,E.not(`isComposing`)),primary:3}})),W(new yL({id:`acceptRenameInputWithPreview`,precondition:E.and(sL,E.has(`config.editor.rename.enablePreview`)),handler:e=>e.acceptRenameInput(!0),kbOpts:{weight:199,kbExpr:E.and(y.focus,E.not(`isComposing`)),primary:2051}})),W(new yL({id:`cancelRenameInput`,precondition:sL,handler:e=>e.cancelRenameInput(),kbOpts:{weight:199,kbExpr:y.focus,primary:9,secondary:[1033]}})),j(class extends pi{constructor(){super({id:`focusNextRenameSuggestion`,title:{...U(1374,`Focus Next Rename Suggestion`)},precondition:sL,keybinding:[{primary:18,weight:199}]})}run(e){let t=e.get(xl).getFocusedCodeEditor();if(!t)return;let n=_L.get(t);n&&n.focusNextRenameSuggestion()}}),j(class extends pi{constructor(){super({id:`focusPreviousRenameSuggestion`,title:{...U(1375,`Focus Previous Rename Suggestion`)},precondition:sL,keybinding:[{primary:16,weight:199}]})}run(e){let t=e.get(xl).getFocusedCodeEditor();if(!t)return;let n=_L.get(t);n&&n.focusPreviousRenameSuggestion()}}),Ya(`_executeDocumentRenameProvider`,function(e,t,n,...r){let[i]=r;J(typeof i==`string`);let{renameProvider:a}=e.get(H);return gL(a,t,n,i)}),Ya(`_executePrepareRename`,async function(e,t,n){let{renameProvider:r}=e.get(H),i=await new hL(t,n,r).resolveRenameLocation(M.None);if(i?.rejectReason)throw Error(i.rejectReason);return i}),br.as(It.Configuration).registerConfiguration({id:`editor`,properties:{"editor.rename.enablePreview":{scope:6,description:G(1372,`Enable/disable the ability to preview changes before renaming`),default:!0,type:`boolean`}}});var bL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},xL=function(e,t){return function(n,r){t(n,r,e)}},SL=class extends x{static{this.ID=`editor.sectionHeaderDetector`}constructor(e,t,n){super(),this.editor=e,this.languageConfigurationService=t,this.editorWorkerService=n,this.decorations=this.editor.createDecorationsCollection(),this.options=this.createOptions(e.getOption(81)),this.computePromise=null,this.currentOccurrences={},this._register(e.onDidChangeModel(t=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(e.onDidChangeModelLanguage(t=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(t.onDidChange(t=>{let n=this.editor.getModel()?.getLanguageId();n&&t.affects(n)&&(this.currentOccurrences={},this.options=this.createOptions(e.getOption(81)),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(e.onDidChangeConfiguration(t=>{this.options&&!t.hasChanged(81)||(this.options=this.createOptions(e.getOption(81)),this.updateDecorations([]),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(this.editor.onDidChangeModelContent(e=>{this.computeSectionHeaders.schedule()})),this._register(e.onDidChangeModelTokens(e=>{this.computeSectionHeaders.isScheduled()||this.computeSectionHeaders.schedule(1e3)})),this.computeSectionHeaders=this._register(new Zr(()=>{this.findSectionHeaders()},250)),this.computeSectionHeaders.schedule(0)}createOptions(e){if(!e||!this.editor.hasModel())return;let t=this.editor.getModel().getLanguageId();if(!t)return;let n=this.languageConfigurationService.getLanguageConfiguration(t).comments,r=this.languageConfigurationService.getLanguageConfiguration(t).foldingRules;if(!(!n&&!r?.markers))return{foldingRules:r,markSectionHeaderRegex:e.markSectionHeaderRegex,findMarkSectionHeaders:e.showMarkSectionHeaders,findRegionSectionHeaders:e.showRegionSectionHeaders}}findSectionHeaders(){if(!this.editor.hasModel()||!this.options?.findMarkSectionHeaders&&!this.options?.findRegionSectionHeaders)return;let e=this.editor.getModel();if(e.isDisposed()||e.isTooLargeForSyncing())return;let t=e.getVersionId();this.editorWorkerService.findSectionHeaders(e.uri,this.options).then(n=>{e.isDisposed()||e.getVersionId()!==t||this.updateDecorations(n)})}updateDecorations(e){let t=this.editor.getModel();t&&(e=e.filter(e=>{if(!e.shouldBeInComments)return!0;let n=t.validateRange(e.range),r=t.tokenization.getLineTokens(n.startLineNumber),i=r.findTokenIndexAtOffset(n.startColumn-1),a=r.getStandardTokenType(i);return r.getLanguageId(i)===t.getLanguageId()&&a===1}));let n=Object.values(this.currentOccurrences).map(e=>e.decorationId),r=e.map(e=>CL(e));this.editor.changeDecorations(t=>{let i=t.deltaDecorations(n,r);this.currentOccurrences={};for(let t=0,n=i.length;t<n;t++){let n={sectionHeader:e[t],decorationId:i[t]};this.currentOccurrences[n.decorationId]=n}})}stop(){this.computeSectionHeaders.cancel(),this.computePromise&&=(this.computePromise.cancel(),null)}dispose(){super.dispose(),this.stop(),this.decorations.clear()}};SL=bL([xL(1,Ce),xL(2,Xs)],SL);function CL(e){return{range:e.range,options:Y.createDynamic({description:`section-header`,stickiness:3,collapseOnReplaceEdit:!0,minimap:{color:void 0,position:1,sectionHeaderStyle:e.hasSeparatorLine?2:1,sectionHeaderText:e.text}})}}K(SL.ID,SL,1);function wL(e){for(let t=0,n=e.length;t<n;t+=4){let n=e[t+0],r=e[t+1],i=e[t+2],a=e[t+3];e[t+0]=a,e[t+1]=i,e[t+2]=r,e[t+3]=n}}function TL(e){let t=new Uint8Array(e.buffer,e.byteOffset,e.length*4);return Rl()||wL(t),xs.wrap(t)}function EL(e){let t=new Uint32Array(DL(e)),n=0;if(t[n++]=e.id,e.type===`full`)t[n++]=1,t[n++]=e.data.length,t.set(e.data,n),n+=e.data.length;else{t[n++]=2,t[n++]=e.deltas.length;for(let r of e.deltas)t[n++]=r.start,t[n++]=r.deleteCount,r.data?(t[n++]=r.data.length,t.set(r.data,n),n+=r.data.length):t[n++]=0}return TL(t)}function DL(e){let t=0;if(t+=2,e.type===`full`)t+=1+e.data.length;else{t+=1,t+=3*e.deltas.length;for(let n of e.deltas)n.data&&(t+=n.data.length)}return t}function OL(e){return e&&!!e.data}function kL(e){return e&&Array.isArray(e.edits)}var AL=class{constructor(e,t,n){this.provider=e,this.tokens=t,this.error=n}};function jL(e,t){return e.has(t)}function ML(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:[]}async function NL(e,t,n,r,i){let a=ML(e,t),o=await Promise.all(a.map(async e=>{let a,o=null;try{a=await e.provideDocumentSemanticTokens(t,e===n?r:null,i)}catch(e){o=e,a=null}return(!a||!OL(a)&&!kL(a))&&(a=null),new AL(e,a,o)}));for(let e of o){if(e.error)throw e.error;if(e.tokens)return e}return o.length>0?o[0]:null}function PL(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:null}var FL=class{constructor(e,t){this.provider=e,this.tokens=t}};function IL(e,t){return e.has(t)}function LL(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:[]}async function RL(e,t,n,r){let i=LL(e,t),a=await Promise.all(i.map(async e=>{let i;try{i=await e.provideDocumentRangeSemanticTokens(t,n,r)}catch(e){ct(e),i=null}return(!i||!OL(i))&&(i=null),new FL(e,i)}));for(let e of a)if(e.tokens)return e;return a.length>0?a[0]:null}gd.registerCommand(`_provideDocumentSemanticTokensLegend`,async(e,...t)=>{let[n]=t;J(n instanceof ur);let r=e.get(_n).getModel(n);if(!r)return;let{documentSemanticTokensProvider:i}=e.get(H),a=PL(i,r);return a?a[0].getLegend():e.get(Te).executeCommand(`_provideDocumentRangeSemanticTokensLegend`,n)}),gd.registerCommand(`_provideDocumentSemanticTokens`,async(e,...t)=>{let[n]=t;J(n instanceof ur);let r=e.get(_n).getModel(n);if(!r)return;let{documentSemanticTokensProvider:i}=e.get(H);if(!jL(i,r))return e.get(Te).executeCommand(`_provideDocumentRangeSemanticTokens`,n,r.getFullModelRange());let a=await NL(i,r,null,null,M.None);if(!a)return;let{provider:o,tokens:s}=a;if(!s||!OL(s))return;let c=EL({id:0,type:`full`,data:s.data});return s.resultId&&o.releaseDocumentSemanticTokens(s.resultId),c}),gd.registerCommand(`_provideDocumentRangeSemanticTokensLegend`,async(e,...t)=>{let[n,r]=t;J(n instanceof ur);let i=e.get(_n).getModel(n);if(!i)return;let{documentRangeSemanticTokensProvider:a}=e.get(H),o=LL(a,i);if(o.length===0)return;if(o.length===1)return o[0].getLegend();if(!r||!T.isIRange(r))return console.warn(`provideDocumentRangeSemanticTokensLegend might be out-of-sync with provideDocumentRangeSemanticTokens unless a range argument is passed in`),o[0].getLegend();let s=await RL(a,i,T.lift(r),M.None);if(s)return s.provider.getLegend()}),gd.registerCommand(`_provideDocumentRangeSemanticTokens`,async(e,...t)=>{let[n,r]=t;J(n instanceof ur),J(T.isIRange(r));let i=e.get(_n).getModel(n);if(!i)return;let{documentRangeSemanticTokensProvider:a}=e.get(H),o=await RL(a,i,T.lift(r),M.None);if(!(!o||!o.tokens))return EL({id:0,type:`full`,data:o.tokens.data})});function zL(e,t,n){let r=n.getValue(`editor.semanticHighlighting`,{overrideIdentifier:e.getLanguageId(),resource:e.uri})?.enabled;return typeof r==`boolean`?r:t.getColorTheme().semanticHighlighting}var BL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},VL=function(e,t){return function(n,r){t(n,r,e)}},HL,UL=class extends x{constructor(e,t,n,r,i,a){super(),this._watchers=new Ie;let o=t=>{this._watchers.get(t.uri)?.dispose(),this._watchers.set(t.uri,new WL(t,e,n,i,a))},s=(e,t)=>{t.dispose(),this._watchers.delete(e.uri)},c=()=>{for(let e of t.getModels()){let t=this._watchers.get(e.uri);zL(e,n,r)?t||o(e):t&&s(e,t)}};t.getModels().forEach(e=>{zL(e,n,r)&&o(e)}),this._register(t.onModelAdded(e=>{zL(e,n,r)&&o(e)})),this._register(t.onModelRemoved(e=>{let t=this._watchers.get(e.uri);t&&s(e,t)})),this._register(r.onDidChangeConfiguration(e=>{e.affectsConfiguration(`editor.semanticHighlighting`)&&c()})),this._register(n.onDidColorThemeChange(c))}dispose(){Ot(this._watchers.values()),this._watchers.clear(),super.dispose()}};UL=BL([VL(0,vo),VL(1,_n),VL(2,pa),VL(3,hn),VL(4,fu),VL(5,H)],UL);var WL=class extends x{static{HL=this}static{this.REQUEST_MIN_DELAY=300}static{this.REQUEST_MAX_DELAY=2e3}constructor(e,t,n,r,i){super(),this._semanticTokensStylingService=t,this._isDisposed=!1,this._model=e,this._provider=i.documentSemanticTokensProvider,this._debounceInformation=r.for(this._provider,`DocumentSemanticTokens`,{min:HL.REQUEST_MIN_DELAY,max:HL.REQUEST_MAX_DELAY}),this._fetchDocumentSemanticTokens=this._register(new Zr(()=>this._fetchDocumentSemanticTokensNow(),HL.REQUEST_MIN_DELAY)),this._currentDocumentResponse=null,this._currentDocumentRequestCancellationTokenSource=null,this._documentProvidersChangeListeners=[],this._providersChangedDuringRequest=!1,this._register(this._model.onDidChangeContent(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeAttached(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeLanguage(()=>{this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._currentDocumentRequestCancellationTokenSource&&=(this._currentDocumentRequestCancellationTokenSource.cancel(),null),this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(0)}));let a=()=>{Ot(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[];for(let t of this._provider.all(e))typeof t.onDidChange==`function`&&this._documentProvidersChangeListeners.push(t.onDidChange(()=>{if(this._currentDocumentRequestCancellationTokenSource){this._providersChangedDuringRequest=!0;return}this._fetchDocumentSemanticTokens.schedule(0)}))};a(),this._register(this._provider.onDidChange(()=>{a(),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(n.onDidColorThemeChange(e=>{this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._fetchDocumentSemanticTokens.schedule(0)}dispose(){this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._currentDocumentRequestCancellationTokenSource&&=(this._currentDocumentRequestCancellationTokenSource.cancel(),null),Ot(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[],this._setDocumentSemanticTokens(null,null,null,[]),this._isDisposed=!0,super.dispose()}_fetchDocumentSemanticTokensNow(){if(this._currentDocumentRequestCancellationTokenSource)return;if(!jL(this._provider,this._model)){this._currentDocumentResponse&&this._model.tokenization.setSemanticTokens(null,!1);return}if(!this._model.isAttachedToEditor())return;let e=new Sr,t=this._currentDocumentResponse?this._currentDocumentResponse.provider:null,n=this._currentDocumentResponse&&this._currentDocumentResponse.resultId||null,r=NL(this._provider,this._model,t,n,e.token);this._currentDocumentRequestCancellationTokenSource=e,this._providersChangedDuringRequest=!1;let i=[],a=this._model.onDidChangeContent(e=>{i.push(e)}),o=new vd(!1);r.then(e=>{if(this._debounceInformation.update(this._model,o.elapsed()),this._currentDocumentRequestCancellationTokenSource=null,a.dispose(),!e)this._setDocumentSemanticTokens(null,null,null,i);else{let{provider:t,tokens:n}=e,r=this._semanticTokensStylingService.getStyling(t);this._setDocumentSemanticTokens(t,n||null,r,i)}},e=>{e&&(Gn(e)||typeof e.message==`string`&&e.message.indexOf(`busy`)!==-1)||mr(e),this._currentDocumentRequestCancellationTokenSource=null,a.dispose(),(i.length>0||this._providersChangedDuringRequest)&&(this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model)))})}static _copy(e,t,n,r,i){i=Math.min(i,n.length-r,e.length-t);for(let a=0;a<i;a++)n[r+a]=e[t+a]}_setDocumentSemanticTokens(e,t,n,r){let i=this._currentDocumentResponse,a=()=>{(r.length>0||this._providersChangedDuringRequest)&&!this._fetchDocumentSemanticTokens.isScheduled()&&this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))};if(this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._isDisposed){e&&t&&e.releaseDocumentSemanticTokens(t.resultId);return}if(!e||!n){this._model.tokenization.setSemanticTokens(null,!1);return}if(!t){this._model.tokenization.setSemanticTokens(null,!0),a();return}if(kL(t)){if(!i){this._model.tokenization.setSemanticTokens(null,!0);return}if(t.edits.length===0)t={resultId:t.resultId,data:i.data};else{let e=0;for(let n of t.edits)e+=(n.data?n.data.length:0)-n.deleteCount;let r=i.data,a=new Uint32Array(r.length+e),o=r.length,s=a.length;for(let e=t.edits.length-1;e>=0;e--){let c=t.edits[e];if(c.start>r.length){n.warnInvalidEditStart(i.resultId,t.resultId,e,c.start,r.length),this._model.tokenization.setSemanticTokens(null,!0);return}let l=o-(c.start+c.deleteCount);l>0&&(HL._copy(r,o-l,a,s-l,l),s-=l),c.data&&(HL._copy(c.data,0,a,s-c.data.length,c.data.length),s-=c.data.length),o=c.start}o>0&&HL._copy(r,0,a,0,o),t={resultId:t.resultId,data:a}}}if(OL(t)){this._currentDocumentResponse=new GL(e,t.resultId,t.data);let i=_c(t,n,this._model.getLanguageId());if(r.length>0)for(let e of r)for(let t of i)for(let n of e.changes)t.applyEdit(n.range,n.text);this._model.tokenization.setSemanticTokens(i,!0)}else this._model.tokenization.setSemanticTokens(null,!0);a()}};WL=HL=BL([VL(1,vo),VL(2,pa),VL(3,fu),VL(4,H)],WL);var GL=class{constructor(e,t,n){this.provider=e,this.resultId=t,this.data=n}dispose(){this.provider.releaseDocumentSemanticTokens(this.resultId)}};cn(UL);var KL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qL=function(e,t){return function(n,r){t(n,r,e)}},JL=class extends x{static{this.ID=`editor.contrib.viewportSemanticTokens`}constructor(e,t,n,r,i,a){super(),this._semanticTokensStylingService=t,this._themeService=n,this._configurationService=r,this._editor=e,this._provider=a.documentRangeSemanticTokensProvider,this._debounceInformation=i.for(this._provider,`DocumentRangeSemanticTokens`,{min:100,max:500}),this._tokenizeViewport=this._register(new Zr(()=>this._tokenizeViewportNow(),100)),this._outstandingRequests=[];let o=()=>{this._editor.hasModel()&&this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()))};this._register(this._editor.onDidScrollChange(()=>{o()})),this._register(this._editor.onDidChangeModel(()=>{this._cancelAll(),o()})),this._register(this._editor.onDidChangeModelContent(e=>{this._cancelAll(),o()})),this._register(this._provider.onDidChange(()=>{this._cancelAll(),o()})),this._register(this._configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(`editor.semanticHighlighting`)&&(this._cancelAll(),o())})),this._register(this._themeService.onDidColorThemeChange(()=>{this._cancelAll(),o()})),o()}_cancelAll(){for(let e of this._outstandingRequests)e.cancel();this._outstandingRequests=[]}_removeOutstandingRequest(e){for(let t=0,n=this._outstandingRequests.length;t<n;t++)if(this._outstandingRequests[t]===e){this._outstandingRequests.splice(t,1);return}}_tokenizeViewportNow(){if(!this._editor.hasModel())return;let e=this._editor.getModel();if(e.tokenization.hasCompleteSemanticTokens())return;if(!zL(e,this._themeService,this._configurationService)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}if(!IL(this._provider,e)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}let t=this._editor.getVisibleRangesPlusViewportAboveBelow();this._outstandingRequests=this._outstandingRequests.concat(t.map(t=>this._requestRange(e,t)))}_requestRange(e,t){let n=e.getVersionId(),r=li(n=>Promise.resolve(RL(this._provider,e,t,n))),i=new vd(!1);return r.then(r=>{if(this._debounceInformation.update(e,i.elapsed()),!r||!r.tokens||e.isDisposed()||e.getVersionId()!==n)return;let{provider:a,tokens:o}=r,s=this._semanticTokensStylingService.getStyling(a);e.tokenization.setPartialSemanticTokens(t,_c(o,s,e.getLanguageId()))}).then(()=>this._removeOutstandingRequest(r),()=>this._removeOutstandingRequest(r)),r}};JL=KL([qL(1,vo),qL(2,pa),qL(3,hn),qL(4,fu),qL(5,H)],JL),K(JL.ID,JL,1);var YL=class{constructor(e=!0){this.selectSubwords=e}provideSelectionRanges(e,t){let n=[];for(let r of t){let t=[];n.push(t),this.selectSubwords&&this._addInWordRanges(t,e,r),this._addWordRanges(t,e,r),this._addWhitespaceLine(t,e,r),t.push({range:e.getFullModelRange()})}return n}_addInWordRanges(e,t,n){let r=t.getWordAtPosition(n);if(!r)return;let{word:i,startColumn:a}=r,o=n.column-a,s=o,c=o,l=0;for(;s>=0;s--){let e=i.charCodeAt(s);if(s!==o&&(e===95||e===45)||$i(e)&&Sa(l))break;l=e}for(s+=1;c<i.length;c++){let e=i.charCodeAt(c);if(Sa(e)&&$i(l)||e===95||e===45)break;l=e}s<c&&e.push({range:new T(n.lineNumber,a+s,n.lineNumber,a+c)})}_addWordRanges(e,t,n){let r=t.getWordAtPosition(n);r&&e.push({range:new T(n.lineNumber,r.startColumn,n.lineNumber,r.endColumn)})}_addWhitespaceLine(e,t,n){t.getLineLength(n.lineNumber)>0&&t.getLineFirstNonWhitespaceColumn(n.lineNumber)===0&&t.getLineLastNonWhitespaceColumn(n.lineNumber)===0&&e.push({range:new T(n.lineNumber,1,n.lineNumber,t.getLineMaxColumn(n.lineNumber))})}},XL=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ZL=function(e,t){return function(n,r){t(n,r,e)}},QL,$L=class e{constructor(e,t){this.index=e,this.ranges=t}mov(t){let n=this.index+(t?1:-1);if(n<0||n>=this.ranges.length)return this;let r=new e(n,this.ranges);return r.ranges[n].equalsRange(this.ranges[this.index])?r.mov(t):r}},eR=class{static{QL=this}static{this.ID=`editor.contrib.smartSelectController`}static get(e){return e.getContribution(QL.ID)}constructor(e,t){this._editor=e,this._languageFeaturesService=t,this._ignoreSelection=!1}dispose(){this._selectionListener?.dispose()}async run(e){if(!this._editor.hasModel())return;let t=this._editor.getSelections(),n=this._editor.getModel();if(this._state||await iR(this._languageFeaturesService.selectionRangeProvider,n,t.map(e=>e.getPosition()),this._editor.getOption(129),M.None).then(e=>{if(!(!$t(e)||e.length!==t.length)&&!(!this._editor.hasModel()||!bt(this._editor.getSelections(),t,(e,t)=>e.equalsSelection(t)))){for(let n=0;n<e.length;n++)e[n]=e[n].filter(e=>e.containsPosition(t[n].getStartPosition())&&e.containsPosition(t[n].getEndPosition())),e[n].unshift(t[n]);this._state=e.map(e=>new $L(0,e)),this._selectionListener?.dispose(),this._selectionListener=this._editor.onDidChangeCursorPosition(()=>{this._ignoreSelection||(this._selectionListener?.dispose(),this._state=void 0)})}}),!this._state)return;this._state=this._state.map(t=>t.mov(e));let r=this._state.map(e=>P.fromPositions(e.ranges[e.index].getStartPosition(),e.ranges[e.index].getEndPosition()));this._ignoreSelection=!0;try{this._editor.setSelections(r)}finally{this._ignoreSelection=!1}}};eR=QL=XL([ZL(1,H)],eR);var tR=class extends R{constructor(e,t){super(t),this._forward=e}async run(e,t){let n=eR.get(t);n&&await n.run(this._forward)}},nR=class extends tR{constructor(){super(!0,{id:`editor.action.smartSelect.expand`,label:U(1385,`Expand Selection`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:1553,mac:{primary:3345,secondary:[1297]},weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`1_basic`,title:G(1383,`&&Expand Selection`),order:2}})}};gd.registerCommandAlias(`editor.action.smartSelect.grow`,`editor.action.smartSelect.expand`);var rR=class extends tR{constructor(){super(!1,{id:`editor.action.smartSelect.shrink`,label:U(1386,`Shrink Selection`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:1551,mac:{primary:3343,secondary:[1295]},weight:100},menuOpts:{menuId:S.MenubarSelectionMenu,group:`1_basic`,title:G(1384,`&&Shrink Selection`),order:3}})}};K(eR.ID,eR,4),q(nR),q(rR);async function iR(e,t,n,r,i){let a=e.all(t).concat(new YL(r.selectSubwords));a.length===1&&a.unshift(new mO);let o=[],s=[];for(let e of a)o.push(Promise.resolve(e.provideSelectionRanges(t,n,i)).then(e=>{if($t(e)&&e.length===n.length)for(let t=0;t<n.length;t++){s[t]||(s[t]=[]);for(let r of e[t])T.isIRange(r.range)&&T.containsPosition(r.range,n[t])&&s[t].push(T.lift(r.range))}},ct));return await Promise.all(o),s.map(e=>{if(e.length===0)return[];e.sort((e,t)=>C.isBefore(e.getStartPosition(),t.getStartPosition())?1:C.isBefore(t.getStartPosition(),e.getStartPosition())||C.isBefore(e.getEndPosition(),t.getEndPosition())?-1:C.isBefore(t.getEndPosition(),e.getEndPosition())?1:0);let n=[],i;for(let t of e)(!i||T.containsRange(t,i)&&!T.equalsRange(t,i))&&(n.push(t),i=t);if(!r.selectLeadingAndTrailingWhitespace)return n;let a=[n[0]];for(let e=1;e<n.length;e++){let r=n[e-1],i=n[e];if(i.startLineNumber!==r.startLineNumber||i.endLineNumber!==r.endLineNumber){let e=new T(r.startLineNumber,t.getLineFirstNonWhitespaceColumn(r.startLineNumber),r.endLineNumber,t.getLineLastNonWhitespaceColumn(r.endLineNumber));e.containsRange(r)&&!e.equalsRange(r)&&i.containsRange(e)&&!i.equalsRange(e)&&a.push(e);let n=new T(r.startLineNumber,1,r.endLineNumber,t.getLineMaxColumn(r.endLineNumber));n.containsRange(r)&&!n.equalsRange(e)&&i.containsRange(n)&&!i.equalsRange(n)&&a.push(n)}a.push(i)}return a})}gd.registerCommand(`_executeSelectionRangeProvider`,async function(e,...t){let[n,r]=t;J(ur.isUri(n));let i=e.get(H).selectionRangeProvider,a=await e.get(Et).createModelReference(n);try{return iR(i,a.object.textEditorModel,r,{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},M.None)}finally{a.dispose()}});const aR=Object.freeze({View:U(1623,`View`),Help:U(1624,`Help`),Test:U(1625,`Test`),File:U(1626,`File`),Preferences:U(1627,`Preferences`),Developer:U(1628,`Developer`)});var oR=class extends wa{constructor(){super({id:`editor.action.toggleStickyScroll`,title:{...U(1433,`Toggle Editor Sticky Scroll`),mnemonicTitle:G(1429,`&&Toggle Editor Sticky Scroll`)},metadata:{description:U(1434,`Toggle/enable the editor sticky scroll which shows the nested scopes at the top of the viewport`)},category:aR.View,toggled:{condition:E.equals(`config.editor.stickyScroll.enabled`,!0),title:G(1430,`Sticky Scroll`),mnemonicTitle:G(1431,`&&Sticky Scroll`)},menu:[{id:S.CommandPalette},{id:S.MenubarAppearanceMenu,group:`4_editor`,order:3},{id:S.StickyScrollContext}]})}async runEditorCommand(e,t){let n=e.get(hn),r=!n.getValue(`editor.stickyScroll.enabled`),i=uA.get(t)?.isFocused();n.updateValue(`editor.stickyScroll.enabled`,r),i&&t.focus()}},sR=100,cR=class extends wa{constructor(){super({id:`editor.action.focusStickyScroll`,title:{...U(1435,`Focus Editor Sticky Scroll`),mnemonicTitle:G(1432,`&&Focus Editor Sticky Scroll`)},precondition:E.and(E.has(`config.editor.stickyScroll.enabled`),y.stickyScrollVisible),menu:[{id:S.CommandPalette}]})}runEditorCommand(e,t){uA.get(t)?.focus()}},lR=class extends wa{constructor(){super({id:`editor.action.selectNextStickyScrollLine`,title:U(1436,`Select the next editor sticky scroll line`),precondition:y.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:sR,primary:18}})}runEditorCommand(e,t){uA.get(t)?.focusNext()}},uR=class extends wa{constructor(){super({id:`editor.action.selectPreviousStickyScrollLine`,title:U(1437,`Select the previous sticky scroll line`),precondition:y.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:sR,primary:16}})}runEditorCommand(e,t){uA.get(t)?.focusPrevious()}},dR=class extends wa{constructor(){super({id:`editor.action.goToFocusedStickyScrollLine`,title:U(1438,`Go to the focused sticky scroll line`),precondition:y.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:sR,primary:3}})}runEditorCommand(e,t){uA.get(t)?.goToFocused()}},fR=class extends wa{constructor(){super({id:`editor.action.selectEditor`,title:U(1439,`Select Editor`),precondition:y.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:sR,primary:9}})}runEditorCommand(e,t){uA.get(t)?.selectEditor()}};K(uA.ID,uA,1),j(oR),j(cR),j(uR),j(lR),j(dR),j(fR);var pR=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},mR=function(e,t){return function(n,r){t(n,r,e)}},hR=class{constructor(e,t,n,r,i,a,o){this.range=e,this.insertText=t,this.filterText=n,this.additionalTextEdits=r,this.command=i,this.action=a,this.completion=o}},gR=class extends Ei{constructor(e,t,n,r,i,a){super(i.disposable),this.model=e,this.line=t,this.word=n,this.completionModel=r,this._suggestMemoryService=a}canBeReused(e,t,n){return this.model===e&&this.line===t&&this.word.word.length>0&&this.word.startColumn===n.startColumn&&this.word.endColumn<n.endColumn&&this.completionModel.getIncompleteProvider().size===0}get items(){let e=[],{items:t}=this.completionModel,n=this._suggestMemoryService.select(this.model,{lineNumber:this.line,column:this.word.endColumn+this.completionModel.lineContext.characterCountDelta},t),r=Dl.slice(t,n),i=Dl.slice(t,0,n),a=5;for(let t of Dl.concat(r,i)){if(t.score===Vr.Default)continue;let n=new T(t.editStart.lineNumber,t.editStart.column,t.editInsertEnd.lineNumber,t.editInsertEnd.column+this.completionModel.lineContext.characterCountDelta),r=t.completion.insertTextRules&&t.completion.insertTextRules&4?{snippet:t.completion.insertText}:t.completion.insertText;e.push(new hR(n,r,t.filterTextLow??t.labelLow,t.completion.additionalTextEdits,t.completion.command,t.completion.action,t)),a-->=0&&t.resolve(M.None)}return e}};gR=pR([mR(5,iO)],gR);var _R=class extends x{constructor(e,t,n,r){super(),this._languageFeatureService=e,this._clipboardService=t,this._suggestMemoryService=n,this._editorService=r,this._store.add(e.inlineCompletionsProvider.register(`*`,this))}async provideInlineCompletions(e,t,n,r){if(n.selectedSuggestionInfo)return;let i;for(let t of this._editorService.listCodeEditors())if(t.getModel()===e){i=t;break}if(!i)return;let a=i.getOption(102);if(WT.isAllOff(a))return;e.tokenization.tokenizeIfCheap(t.lineNumber);let o=e.tokenization.getLineTokens(t.lineNumber),s=o.getStandardTokenType(o.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(WT.valueFor(a,s)!==`inline`)return;let c=e.getWordAtPosition(t),l;if(c?.word||(l=this._getTriggerCharacterInfo(e,t)),!c?.word&&!l||(c||=e.getWordUntilPosition(t),c.endColumn!==t.column))return;let u,d=e.getValueInRange(new T(t.lineNumber,1,t.lineNumber,t.column));if(!l&&this._lastResult?.canBeReused(e,t.lineNumber,c)){let e=new gO(d,t.column-this._lastResult.word.endColumn);this._lastResult.completionModel.lineContext=e,this._lastResult.acquire(),u=this._lastResult}else{let n=await LT(this._languageFeatureService.completionProvider,e,t,new NT(void 0,wO.createSuggestFilter(i).itemKind,l?.providers),l&&{triggerKind:1,triggerCharacter:l.ch},r),a;n.needsClipboard&&(a=await this._clipboardService.readText());let o=new _O(n.items,t.column,new gO(d,0),hO.None,i.getOption(134),i.getOption(128),{boostFullMatch:!1,firstMatchCanBeWeak:!1},a);u=new gR(e,t.lineNumber,c,o,n,this._suggestMemoryService)}return this._lastResult=u,u}handleItemDidShow(e,t){t.completion.resolve(M.None)}disposeInlineCompletions(e){e.release()}_getTriggerCharacterInfo(e,t){let n=e.getValueInRange(T.fromPositions({lineNumber:t.lineNumber,column:t.column-1},t)),r=new Set;for(let t of this._languageFeatureService.completionProvider.all(e))t.triggerCharacters?.includes(n)&&r.add(t);if(r.size!==0)return{providers:r,ch:n}}};_R=pR([mR(0,H),mR(1,aa),mR(2,iO),mR(3,xl)],_R),cn(_R),q(class extends R{constructor(){super({id:`editor.action.forceRetokenize`,label:U(1517,`Developer: Force Retokenize`),precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getModel();n.tokenization.resetTokenization();let r=new vd;n.tokenization.forceTokenization(n.getLineCount()),r.stop(),console.log(`tokenization took ${r.elapsed()}`)}});var vR=class e extends pi{static{this.ID=`editor.action.toggleTabFocusMode`}constructor(){super({id:e.ID,title:U(1515,`Toggle Tab Key Moves Focus`),precondition:void 0,keybinding:{primary:2091,mac:{primary:1323},weight:100},metadata:{description:U(1516,`Determines whether the tab key moves focus around the workbench or inserts the tab character in the current editor. This is also called tab trapping, tab navigation, or tab focus mode.`)},f1:!0})}run(){let e=!oa.getTabFocusMode();oa.setTabFocusMode(e),va(e?G(1513,`Pressing Tab will now move focus to the next focusable element`):G(1514,`Pressing Tab will now insert the tab character`))}};j(vR);var yR=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bR=function(e,t){return function(n,r){t(n,r,e)}},xR=class extends x{get enabled(){return this._enabled}set enabled(e){e?(this.el.setAttribute(`aria-disabled`,`false`),this.el.tabIndex=0,this.el.style.pointerEvents=`auto`,this.el.style.opacity=`1`,this.el.style.cursor=`pointer`,this._enabled=!1):(this.el.setAttribute(`aria-disabled`,`true`),this.el.tabIndex=-1,this.el.style.pointerEvents=`none`,this.el.style.opacity=`0.4`,this.el.style.cursor=`default`,this._enabled=!0),this._enabled=e}constructor(e,t,n={},r,i){super(),this._link=t,this._hoverService=r,this._enabled=!0,this.el=B(e,b(`a.monaco-link`,{tabIndex:t.tabIndex??0,href:t.href},t.label)),this.hoverDelegate=n.hoverDelegate??ha(`mouse`),this.setTooltip(t.title),this.el.setAttribute(`role`,`button`);let a=this._register(new Vu(this.el,`click`)),o=this._register(new Vu(this.el,`keypress`)),s=An.chain(o.event,e=>e.map(e=>new In(e)).filter(e=>e.keyCode===3)),c=this._register(new Vu(this.el,ci.Tap)).event;this._register(Qe.addTarget(this.el));let l=An.any(a.event,s,c);this._register(l(e=>{this.enabled&&(Yl.stop(e,!0),n?.opener?n.opener(this._link.href):i.open(this._link.href,{allowCommands:!0}))})),this.enabled=!0}setTooltip(e){!this.hover&&e?this.hover=this._register(this._hoverService.setupManagedHover(this.hoverDelegate,this.el,e)):this.hover&&this.hover.update(e)}};xR=yR([bR(3,Is),bR(4,da)],xR);var SR=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},CR=function(e,t){return function(n,r){t(n,r,e)}},wR=26,TR=class extends x{constructor(e,t){super(),this._editor=e,this.instantiationService=t,this.banner=this._register(this.instantiationService.createInstance(ER))}hide(){this._editor.setBanner(null,0),this.banner.clear()}show(e){this.banner.show({...e,onClose:()=>{this.hide(),e.onClose?.()}}),this._editor.setBanner(this.banner.element,wR)}};TR=SR([CR(1,k)],TR);var ER=class extends x{constructor(e){super(),this.instantiationService=e,this.markdownRenderer=this.instantiationService.createInstance(et,{}),this.element=b(`div.editor-banner`),this.element.tabIndex=0}getAriaLabel(e){if(e.ariaLabel)return e.ariaLabel;if(typeof e.message==`string`)return e.message}getBannerMessage(e){if(typeof e==`string`){let t=b(`span`);return t.innerText=e,t}return this.markdownRenderer.render(e).element}clear(){fc(this.element)}show(e){fc(this.element);let t=this.getAriaLabel(e);t&&this.element.setAttribute(`aria-label`,t);let n=B(this.element,b(`div.icon-container`));n.setAttribute(`aria-hidden`,`true`),e.icon&&n.appendChild(b(`div${I.asCSSSelector(e.icon)}`));let r=B(this.element,b(`div.message-container`));if(r.setAttribute(`aria-hidden`,`true`),r.appendChild(this.getBannerMessage(e.message)),this.messageActionsContainer=B(this.element,b(`div.message-actions-container`)),e.actions)for(let t of e.actions)this._register(this.instantiationService.createInstance(xR,this.messageActionsContainer,{...t,tabIndex:-1},{}));let i=B(this.element,b(`div.action-container`));this.actionBar=this._register(new Bn(i)),this.actionBar.push(this._register(new Rt(`banner.close`,G(1518,`Close Banner`),I.asClassName(Vc),!0,()=>{typeof e.onClose==`function`&&e.onClose()})),{icon:!0,label:!1}),this.actionBar.setFocusable(!1)}};ER=SR([CR(0,k)],ER);var DR=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},OR=function(e,t){return function(n,r){t(n,r,e)}};const kR=nu(`extensions-warning-message`,X.warning,G(1519,`Icon shown with a warning message in the extensions editor.`));var AR=class extends x{static{this.ID=`editor.contrib.unicodeHighlighter`}constructor(e,t,n,r){super(),this._editor=e,this._editorWorkerService=t,this._workspaceTrustService=n,this._highlighter=null,this._bannerClosed=!1,this._updateState=e=>{if(e&&e.hasMore){if(this._bannerClosed)return;let t=Math.max(e.ambiguousCharacterCount,e.nonBasicAsciiCharacterCount,e.invisibleCharacterCount),n;if(e.nonBasicAsciiCharacterCount>=t)n={message:G(1520,`This document contains many non-basic ASCII unicode characters`),command:new GR};else if(e.ambiguousCharacterCount>=t)n={message:G(1521,`This document contains many ambiguous unicode characters`),command:new UR};else if(e.invisibleCharacterCount>=t)n={message:G(1522,`This document contains many invisible unicode characters`),command:new WR};else throw Error(`Unreachable`);this._bannerController.show({id:`unicodeHighlightBanner`,message:n.message,icon:kR,actions:[{label:n.command.shortLabel,href:`command:${n.command.desc.id}`}],onClose:()=>{this._bannerClosed=!0}})}else this._bannerController.hide()},this._bannerController=this._register(r.createInstance(TR,e)),this._register(this._editor.onDidChangeModel(()=>{this._bannerClosed=!1,this._updateHighlighter()})),this._options=e.getOption(142),this._register(n.onDidChangeTrust(e=>{this._updateHighlighter()})),this._register(e.onDidChangeConfiguration(t=>{t.hasChanged(142)&&(this._options=e.getOption(142),this._updateHighlighter())})),this._updateHighlighter()}dispose(){this._highlighter&&=(this._highlighter.dispose(),null),super.dispose()}_updateHighlighter(){if(this._updateState(null),this._highlighter&&=(this._highlighter.dispose(),null),!this._editor.hasModel())return;let e=jR(this._workspaceTrustService.isWorkspaceTrusted(),this._options);if([e.nonBasicASCII,e.ambiguousCharacters,e.invisibleCharacters].every(e=>e===!1))return;let t={nonBasicASCII:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments,includeStrings:e.includeStrings,allowedCodePoints:Object.keys(e.allowedCharacters).map(e=>e.codePointAt(0)),allowedLocales:Object.keys(e.allowedLocales).map(e=>e===`_os`?En.NumberFormat().value.resolvedOptions().locale:e===`_vscode`?qo:e)};this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)?this._highlighter=new MR(this._editor,t,this._updateState,this._editorWorkerService):this._highlighter=new NR(this._editor,t,this._updateState)}getDecorationInfo(e){return this._highlighter?this._highlighter.getDecorationInfo(e):null}};AR=DR([OR(1,Xs),OR(2,Da),OR(3,k)],AR);function jR(e,t){return{nonBasicASCII:t.nonBasicASCII===`inUntrustedWorkspace`?!e:t.nonBasicASCII,ambiguousCharacters:t.ambiguousCharacters,invisibleCharacters:t.invisibleCharacters,includeComments:t.includeComments===`inUntrustedWorkspace`?!e:t.includeComments,includeStrings:t.includeStrings===`inUntrustedWorkspace`?!e:t.includeStrings,allowedCharacters:t.allowedCharacters,allowedLocales:t.allowedLocales}}var MR=class extends x{constructor(e,t,n,r){super(),this._editor=e,this._options=t,this._updateState=n,this._editorWorkerService=r,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new Zr(()=>this._update(),250)),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}let e=this._model.getVersionId();this._editorWorkerService.computedUnicodeHighlights(this._model.uri,this._options).then(t=>{if(this._model.isDisposed()||this._model.getVersionId()!==e)return;this._updateState(t);let n=[];if(!t.hasMore)for(let e of t.ranges)n.push({range:e,options:BR.instance.getDecorationFromOptions(this._options)});this._decorations.set(n)})}getDecorationInfo(e){if(!this._decorations.has(e))return null;let t=this._editor.getModel();if(!Tt(t,e))return null;let n=t.getValueInRange(e.range);return{reason:zR(n,this._options),inComment:Ci(t,e),inString:Wi(t,e)}}};MR=DR([OR(3,Xs)],MR);var NR=class extends x{constructor(e,t,n){super(),this._editor=e,this._options=t,this._updateState=n,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new Zr(()=>this._update(),250)),this._register(this._editor.onDidLayoutChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidScrollChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeHiddenAreas(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}let e=this._editor.getVisibleRanges(),t=[],n={ranges:[],ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0,hasMore:!1};for(let t of e){let e=de.computeUnicodeHighlights(this._model,this._options,t);for(let t of e.ranges)n.ranges.push(t);n.ambiguousCharacterCount+=n.ambiguousCharacterCount,n.invisibleCharacterCount+=n.invisibleCharacterCount,n.nonBasicAsciiCharacterCount+=n.nonBasicAsciiCharacterCount,n.hasMore=n.hasMore||e.hasMore}if(!n.hasMore)for(let e of n.ranges)t.push({range:e,options:BR.instance.getDecorationFromOptions(this._options)});this._updateState(n),this._decorations.set(t)}getDecorationInfo(e){if(!this._decorations.has(e))return null;let t=this._editor.getModel(),n=t.getValueInRange(e.range);return Tt(t,e)?{reason:zR(n,this._options),inComment:Ci(t,e),inString:Wi(t,e)}:null}},PR=G(1523,`Configure Unicode Highlight Options`),FR=class{constructor(e,t,n){this._editor=e,this._languageService=t,this._openerService=n,this.hoverOrdinal=5}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];let n=this._editor.getModel(),r=this._editor.getContribution(AR.ID);if(!r)return[];let i=[],a=new Set,o=300;for(let e of t){let t=r.getDecorationInfo(e);if(!t)continue;let s=n.getValueInRange(e.range).codePointAt(0),c=LR(s),l;switch(t.reason.kind){case 0:l=pn(t.reason.confusableWith)?G(1524,`The character {0} could be confused with the ASCII character {1}, which is more common in source code.`,c,LR(t.reason.confusableWith.codePointAt(0))):G(1525,`The character {0} could be confused with the character {1}, which is more common in source code.`,c,LR(t.reason.confusableWith.codePointAt(0)));break;case 1:l=G(1526,`The character {0} is invisible.`,c);break;case 2:l=G(1527,`The character {0} is not a basic ASCII character.`,c);break}if(a.has(l))continue;a.add(l);let u={codePoint:s,reason:t.reason,inComment:t.inComment,inString:t.inString},d=G(1528,`Adjust settings`),f=_r(KR.ID,u),p=new Jn(``,!0).appendMarkdown(l).appendText(` `).appendLink(f,d,PR);i.push(new vv(this,e.range,[p],!1,o++))}return i}renderHoverParts(e,t){return Cv(e,t,this._editor,this._languageService,this._openerService)}};FR=DR([OR(1,wt),OR(2,da)],FR);function IR(e){return`U+${e.toString(16).padStart(4,`0`)}`}function LR(e){let t=`\`${IR(e)}\``;return ut.isInvisibleCharacter(e)||(t+=` "${`${RR(e)}`}"`),t}function RR(e){return e===96?"`` ` ``":"`"+String.fromCodePoint(e)+"`"}function zR(e,t){return de.computeUnicodeHighlightReason(e,t)}var BR=class e{constructor(){this.map=new Map}static{this.instance=new e}getDecorationFromOptions(e){return this.getDecoration(!e.includeComments,!e.includeStrings)}getDecoration(e,t){let n=`${e}${t}`,r=this.map.get(n);return r||(r=Y.createDynamic({description:`unicode-highlight`,stickiness:1,className:`unicode-highlight`,showIfCollapsed:!0,overviewRuler:null,minimap:null,hideInCommentTokens:e,hideInStringTokens:t}),this.map.set(n,r)),r}},VR=class extends R{constructor(){super({id:UR.ID,label:U(1537,`Disable highlighting of characters in comments`),precondition:void 0}),this.shortLabel=G(1529,`Disable Highlight In Comments`)}async run(e,t,n){let r=e.get(hn);r&&this.runAction(r)}async runAction(e){await e.updateValue(Fo.includeComments,!1,2)}},HR=class extends R{constructor(){super({id:UR.ID,label:U(1538,`Disable highlighting of characters in strings`),precondition:void 0}),this.shortLabel=G(1530,`Disable Highlight In Strings`)}async run(e,t,n){let r=e.get(hn);r&&this.runAction(r)}async runAction(e){await e.updateValue(Fo.includeStrings,!1,2)}},UR=class e extends pi{static{this.ID=`editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters`}constructor(){super({id:e.ID,title:U(1539,`Disable highlighting of ambiguous characters`),precondition:void 0,f1:!1}),this.shortLabel=G(1531,`Disable Ambiguous Highlight`)}async run(e,t,n){let r=e.get(hn);r&&this.runAction(r)}async runAction(e){await e.updateValue(Fo.ambiguousCharacters,!1,2)}},WR=class e extends pi{static{this.ID=`editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters`}constructor(){super({id:e.ID,title:U(1540,`Disable highlighting of invisible characters`),precondition:void 0,f1:!1}),this.shortLabel=G(1532,`Disable Invisible Highlight`)}async run(e,t,n){let r=e.get(hn);r&&this.runAction(r)}async runAction(e){await e.updateValue(Fo.invisibleCharacters,!1,2)}},GR=class e extends pi{static{this.ID=`editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters`}constructor(){super({id:e.ID,title:U(1541,`Disable highlighting of non basic ASCII characters`),precondition:void 0,f1:!1}),this.shortLabel=G(1533,`Disable Non ASCII Highlight`)}async run(e,t,n){let r=e.get(hn);r&&this.runAction(r)}async runAction(e){await e.updateValue(Fo.nonBasicASCII,!1,2)}},KR=class e extends pi{static{this.ID=`editor.action.unicodeHighlight.showExcludeOptions`}constructor(){super({id:e.ID,title:U(1542,`Show Exclude Options`),precondition:void 0,f1:!1})}async run(e,t){let{codePoint:n,reason:r,inString:i,inComment:a}=t,o=String.fromCodePoint(n),s=e.get(Mu),c=e.get(hn);function l(e){return ut.isInvisibleCharacter(e)?G(1534,`Exclude {0} (invisible character) from being highlighted`,IR(e)):G(1535,`Exclude {0} from being highlighted`,`${IR(e)} "${o}"`)}let u=[];if(r.kind===0)for(let e of r.notAmbiguousInLocales)u.push({label:G(1536,`Allow unicode characters that are more common in the language "{0}".`,e),run:async()=>{JR(c,[e])}});if(u.push({label:l(n),run:()=>qR(c,[n])}),a){let e=new VR;u.push({label:e.label,run:async()=>e.runAction(c)})}else if(i){let e=new HR;u.push({label:e.label,run:async()=>e.runAction(c)})}function d(e){return typeof e.desc.title==`string`?e.desc.title:e.desc.title.value}if(r.kind===0){let e=new UR;u.push({label:d(e),run:async()=>e.runAction(c)})}else if(r.kind===1){let e=new WR;u.push({label:d(e),run:async()=>e.runAction(c)})}else if(r.kind===2){let e=new GR;u.push({label:d(e),run:async()=>e.runAction(c)})}else YR(r);let f=await s.pick(u,{title:PR});f&&await f.run()}};async function qR(e,t){let n=e.getValue(Fo.allowedCharacters),r;r=typeof n==`object`&&n?n:{};for(let e of t)r[String.fromCodePoint(e)]=!0;await e.updateValue(Fo.allowedCharacters,r,2)}async function JR(e,t){let n=e.inspect(Fo.allowedLocales).user?.value,r;r=typeof n==`object`&&n?Object.assign({},n):{};for(let e of t)r[e]=!0;await e.updateValue(Fo.allowedLocales,r,2)}function YR(e){throw Error(`Unexpected value: ${e}`)}j(UR),j(WR),j(GR),j(KR),K(AR.ID,AR,1),i_.register(FR);var XR=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ZR=function(e,t){return function(n,r){t(n,r,e)}},QR=`ignoreUnusualLineTerminators`;function $R(e,t,n){e.setModelProperty(t.uri,QR,n)}function ez(e,t){return e.getModelProperty(t.uri,QR)}var tz=class extends x{static{this.ID=`editor.contrib.unusualLineTerminatorsDetector`}constructor(e,t,n){super(),this._editor=e,this._dialogService=t,this._codeEditorService=n,this._isPresentingDialog=!1,this._config=this._editor.getOption(143),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(143)&&(this._config=this._editor.getOption(143),this._checkForUnusualLineTerminators())})),this._register(this._editor.onDidChangeModel(()=>{this._checkForUnusualLineTerminators()})),this._register(this._editor.onDidChangeModelContent(e=>{e.isUndoing||this._checkForUnusualLineTerminators()})),this._checkForUnusualLineTerminators()}async _checkForUnusualLineTerminators(){if(this._config===`off`||!this._editor.hasModel())return;let e=this._editor.getModel();if(!e.mightContainUnusualLineTerminators()||ez(this._codeEditorService,e)===!0||this._editor.getOption(104))return;if(this._config===`auto`){e.removeUnusualLineTerminators(this._editor.getSelections());return}if(this._isPresentingDialog)return;let t;try{this._isPresentingDialog=!0,t=await this._dialogService.confirm({title:G(1543,`Unusual Line Terminators`),message:G(1544,`Detected unusual line terminators`),detail:G(1545,`The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).

It is recommended to remove them from the file. This can be configured via \`editor.unusualLineTerminators\`.`,$o(e.uri)),primaryButton:G(1546,`&&Remove Unusual Line Terminators`),cancelButton:G(1547,`Ignore`)})}finally{this._isPresentingDialog=!1}if(!t.confirmed){$R(this._codeEditorService,e,!0);return}e.removeUnusualLineTerminators(this._editor.getSelections())}};tz=XR([ZR(1,cl),ZR(2,xl)],tz),K(tz.ID,tz,1);var nz=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rz=function(e,t){return function(n,r){t(n,r,e)}},iz=class{constructor(){this.selector={language:`*`}}provideDocumentHighlights(e,t,n){let r=[],i=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!i)return Promise.resolve(r);if(!e.isDisposed())return e.findMatches(i.word,!0,!1,!0,Xl,!1).map(e=>({range:e.range,kind:Kl.Text}))}provideMultiDocumentHighlights(e,t,n,r){let i=new Ie,a=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!a)return Promise.resolve(i);for(let t of[e,...n]){if(t.isDisposed())continue;let e=t.findMatches(a.word,!0,!1,!0,Xl,!1).map(e=>({range:e.range,kind:Kl.Text}));e&&i.set(t.uri,e)}return i}},az=class extends x{constructor(e){super(),this._register(e.documentHighlightProvider.register(`*`,new iz)),this._register(e.multiDocumentHighlightProvider.register(`*`,new iz))}};az=nz([rz(0,H)],az);var oz=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},sz=function(e,t){return function(n,r){t(n,r,e)}},cz,lz,uz=new N(`hasWordHighlights`,!1);function dz(e,t,n,r){let i=e.ordered(t);return We(i.map(e=>()=>Promise.resolve(e.provideDocumentHighlights(t,n,r)).then(void 0,ct)),e=>e!=null).then(e=>{if(e){let n=new Ie;return n.set(t.uri,e),n}return new Ie})}function fz(e,t,n,r,i){let a=e.ordered(t);return We(a.map(e=>()=>{let a=i.filter(e=>ft(e)).filter(t=>Ul(e.selector,t.uri,t.getLanguageId(),!0,void 0,void 0)>0);return Promise.resolve(e.provideMultiDocumentHighlights(t,n,a,r)).then(void 0,ct)}),e=>e!=null)}var pz=class{constructor(e,t,n){this._model=e,this._selection=t,this._wordSeparators=n,this._wordRange=this._getCurrentWordRange(e,t),this._result=null}get result(){return this._result||=li(e=>this._compute(this._model,this._selection,this._wordSeparators,e)),this._result}_getCurrentWordRange(e,t){let n=e.getWordAtPosition(t.getPosition());return n?new T(t.startLineNumber,n.startColumn,t.startLineNumber,n.endColumn):null}cancel(){this.result.cancel()}},mz=class extends pz{constructor(e,t,n,r){super(e,t,n),this._providers=r}_compute(e,t,n,r){return dz(this._providers,e,t.getPosition(),r).then(e=>e||new Ie)}},hz=class extends pz{constructor(e,t,n,r,i){super(e,t,n),this._providers=r,this._otherModels=i}_compute(e,t,n,r){return fz(this._providers,e,t.getPosition(),r,this._otherModels).then(e=>e||new Ie)}};function gz(e,t,n,r){return new mz(t,n,r,e)}function _z(e,t,n,r,i){return new hz(t,n,r,e,i)}Ya(`_executeDocumentHighlights`,async(e,t,n)=>{let r=e.get(H);return(await dz(r.documentHighlightProvider,t,n,M.None))?.get(t.uri)});var vz=class{static{cz=this}static{this.storedDecorationIDs=new Ie}static{this.query=null}constructor(e,t,n,r,i,a,o,s){this.toUnhook=new L,this.workerRequestTokenId=0,this.workerRequestCompleted=!1,this.workerRequestValue=new Ie,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=void 0,this.runDelayer=this.toUnhook.add(new Hu(50)),this.editor=e,this.providers=t,this.multiDocumentProviders=n,this.codeEditorService=a,this.textModelService=i,this.configurationService=o,this.logService=s,this._hasWordHighlights=uz.bindTo(r),this._ignorePositionChangeEvent=!1,this.occurrencesHighlightEnablement=this.editor.getOption(90),this.occurrencesHighlightDelay=this.configurationService.getValue(`editor.occurrencesHighlightDelay`),this.model=this.editor.getModel(),this.toUnhook.add(e.onDidChangeCursorPosition(e=>{this._ignorePositionChangeEvent||this.occurrencesHighlightEnablement!==`off`&&this.runDelayer.trigger(()=>{this._onPositionChanged(e)})})),this.toUnhook.add(e.onDidFocusEditorText(e=>{this.occurrencesHighlightEnablement!==`off`&&(this.workerRequest||this.runDelayer.trigger(()=>{this._run()}))})),this.toUnhook.add(e.onDidChangeModelContent(e=>{Pa(this.model.uri,`output`)||this._stopAll()})),this.toUnhook.add(e.onDidChangeModel(e=>{!e.newModelUrl&&e.oldModelUrl?this._stopSingular():cz.query&&this._run()})),this.toUnhook.add(e.onDidChangeConfiguration(e=>{let t=this.editor.getOption(90);if(this.occurrencesHighlightEnablement!==t)switch(this.occurrencesHighlightEnablement=t,t){case`off`:this._stopAll();break;case`singleFile`:this._stopAll(cz.query?.modelInfo?.modelURI);break;case`multiFile`:cz.query&&this._run(!0);break;default:console.warn(`Unknown occurrencesHighlight setting value:`,t);break}})),this.toUnhook.add(this.configurationService.onDidChangeConfiguration(e=>{if(e.affectsConfiguration(`editor.occurrencesHighlightDelay`)){let e=o.getValue(`editor.occurrencesHighlightDelay`);this.occurrencesHighlightDelay!==e&&(this.occurrencesHighlightDelay=e)}})),this.toUnhook.add(e.onDidBlurEditorWidget(()=>{let e=this.codeEditorService.getFocusedCodeEditor();e?e.getModel()?.uri.scheme===ls.vscodeNotebookCell&&this.editor.getModel()?.uri.scheme!==ls.vscodeNotebookCell&&this._stopAll():this._stopAll()})),this.decorations=this.editor.createDecorationsCollection(),this.workerRequestTokenId=0,this.workerRequest=null,this.workerRequestCompleted=!1,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=void 0,cz.query&&this._run()}hasDecorations(){return this.decorations.length>0}restore(e){this.occurrencesHighlightEnablement!==`off`&&(this.runDelayer.cancel(),this.runDelayer.trigger(()=>{this._run(!1,e)}))}stop(){this.occurrencesHighlightEnablement!==`off`&&this._stopAll()}_getSortedHighlights(){return this.decorations.getRanges().sort(T.compareRangesUsingStarts)}moveNext(){let e=this._getSortedHighlights(),t=(e.findIndex(e=>e.containsPosition(this.editor.getPosition()))+1)%e.length,n=e[t];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);let r=this._getWord();if(r){let i=this.editor.getModel().getLineContent(n.startLineNumber);va(`${i}, ${t+1} of ${e.length} for '${r.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}moveBack(){let e=this._getSortedHighlights(),t=(e.findIndex(e=>e.containsPosition(this.editor.getPosition()))-1+e.length)%e.length,n=e[t];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);let r=this._getWord();if(r){let i=this.editor.getModel().getLineContent(n.startLineNumber);va(`${i}, ${t+1} of ${e.length} for '${r.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}_removeSingleDecorations(){if(!this.editor.hasModel())return;let e=cz.storedDecorationIDs.get(this.editor.getModel().uri);e&&(this.editor.removeDecorations(e),cz.storedDecorationIDs.delete(this.editor.getModel().uri),this.decorations.length>0&&(this.decorations.clear(),this._hasWordHighlights.set(!1)))}_removeAllDecorations(e){let t=this.codeEditorService.listCodeEditors(),n=[];for(let r of t){if(!r.hasModel()||Ra(r.getModel().uri,e))continue;let t=cz.storedDecorationIDs.get(r.getModel().uri);if(!t)continue;r.removeDecorations(t),n.push(r.getModel().uri);let i=yz.get(r);i?.wordHighlighter&&i.wordHighlighter.decorations.length>0&&(i.wordHighlighter.decorations.clear(),i.wordHighlighter.workerRequest=null,i.wordHighlighter._hasWordHighlights.set(!1))}for(let e of n)cz.storedDecorationIDs.delete(e)}_stopSingular(){this._removeSingleDecorations(),this.editor.hasTextFocus()&&(this.editor.getModel()?.uri.scheme!==ls.vscodeNotebookCell&&cz.query?.modelInfo?.modelURI.scheme!==ls.vscodeNotebookCell?(cz.query=null,this._run()):cz.query?.modelInfo&&(cz.query.modelInfo=null)),this.renderDecorationsTimer!==void 0&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=void 0),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||=(this.workerRequestTokenId++,!0)}_stopAll(e){this._removeAllDecorations(e),this.renderDecorationsTimer!==void 0&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=void 0),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||=(this.workerRequestTokenId++,!0)}_onPositionChanged(e){if(this.occurrencesHighlightEnablement===`off`){this._stopAll();return}if(e.source!==`api`&&e.reason!==3){this._stopAll();return}this._run()}_getWord(){let e=this.editor.getSelection(),t=e.startLineNumber,n=e.startColumn;return this.model.isDisposed()?null:this.model.getWordAtPosition({lineNumber:t,column:n})}getOtherModelsToHighlight(e){if(!e)return[];if(e.uri.scheme===ls.vscodeNotebookCell){let t=[],n=this.codeEditorService.listCodeEditors();for(let r of n){let n=r.getModel();n&&n!==e&&n.uri.scheme===ls.vscodeNotebookCell&&t.push(n)}return t}let t=[],n=this.codeEditorService.listCodeEditors();for(let r of n){if(!Kr(r))continue;let n=r.getModel();n&&e===n.modified&&t.push(n.modified)}if(t.length)return t;if(this.occurrencesHighlightEnablement===`singleFile`)return[];for(let r of n){let n=r.getModel();n&&n!==e&&t.push(n)}return t}async _run(e,t){if(this.editor.hasTextFocus()){let e=this.editor.getSelection();if(!e||e.startLineNumber!==e.endLineNumber){cz.query=null,this._stopAll();return}let t=e.startColumn,n=e.endColumn,r=this._getWord();if(!r||r.startColumn>t||r.endColumn<n){cz.query=null,this._stopAll();return}cz.query={modelInfo:{modelURI:this.model.uri,selection:e}}}else if(!cz.query){this._stopAll();return}if(this.lastCursorPositionChangeTime=new Date().getTime(),Ra(this.editor.getModel().uri,cz.query.modelInfo?.modelURI)){if(!e){let e=this.decorations.getRanges();for(let t of e)if(t.containsPosition(this.editor.getPosition()))return}this._stopAll(e?this.model.uri:void 0);let n=++this.workerRequestTokenId;this.workerRequestCompleted=!1;let r=this.getOtherModelsToHighlight(this.editor.getModel());if(!cz.query||!cz.query.modelInfo)return;let i=await this.textModelService.createModelReference(cz.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(i.object.textEditorModel,cz.query.modelInfo.selection,r),this.workerRequest?.result.then(e=>{n===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=e||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},mr)}catch(e){this.logService.error(`Unexpected error during occurrence request. Log: `,e)}finally{i.dispose()}}else if(this.model.uri.scheme===ls.vscodeNotebookCell){let e=++this.workerRequestTokenId;if(this.workerRequestCompleted=!1,!cz.query||!cz.query.modelInfo)return;let n=await this.textModelService.createModelReference(cz.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(n.object.textEditorModel,cz.query.modelInfo.selection,[this.model]),this.workerRequest?.result.then(n=>{e===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=n||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},mr)}catch(e){this.logService.error(`Unexpected error during occurrence request. Log: `,e)}finally{n.dispose()}}}computeWithModel(e,t,n){return n.length?_z(this.multiDocumentProviders,e,t,this.editor.getOption(148),n):gz(this.providers,e,t,this.editor.getOption(148))}_beginRenderDecorations(e){let t=new Date().getTime(),n=this.lastCursorPositionChangeTime+e;t>=n?(this.renderDecorationsTimer=void 0,this.renderDecorations()):this.renderDecorationsTimer=setTimeout(()=>{this.renderDecorations()},n-t)}renderDecorations(){this.renderDecorationsTimer=void 0;let e=this.codeEditorService.listCodeEditors();for(let t of e){let e=yz.get(t);if(!e)continue;let n=[],r=t.getModel()?.uri;if(r&&this.workerRequestValue.has(r)){let i=cz.storedDecorationIDs.get(r),a=this.workerRequestValue.get(r);if(a)for(let e of a)e.range&&n.push({range:e.range,options:aI(e.kind)});let o=[];t.changeDecorations(e=>{o=e.deltaDecorations(i??[],n)}),cz.storedDecorationIDs=cz.storedDecorationIDs.set(r,o),n.length>0&&(e.wordHighlighter?.decorations.set(n),e.wordHighlighter?._hasWordHighlights.set(!0))}}this.workerRequest=null}dispose(){this._stopSingular(),this.toUnhook.dispose()}};vz=cz=oz([sz(4,Et),sz(5,xl),sz(6,hn),sz(7,Wl)],vz);var yz=class extends x{static{lz=this}static{this.ID=`editor.contrib.wordHighlighter`}static get(e){return e.getContribution(lz.ID)}constructor(e,t,n,r,i,a,o){super(),this._wordHighlighter=null;let s=()=>{e.hasModel()&&!e.getModel().isTooLargeForTokenization()&&e.getModel().uri.scheme!==ls.accessibleView&&(this._wordHighlighter=new vz(e,n.documentHighlightProvider,n.multiDocumentHighlightProvider,t,i,r,a,o))};this._register(e.onDidChangeModel(e=>{this._wordHighlighter&&=(!e.newModelUrl&&e.oldModelUrl?.scheme!==ls.vscodeNotebookCell&&this.wordHighlighter?.stop(),this._wordHighlighter.dispose(),null),s()})),s()}get wordHighlighter(){return this._wordHighlighter}saveViewState(){return!!(this._wordHighlighter&&this._wordHighlighter.hasDecorations())}moveNext(){this._wordHighlighter?.moveNext()}moveBack(){this._wordHighlighter?.moveBack()}restoreViewState(e){this._wordHighlighter&&e&&this._wordHighlighter.restore(250)}dispose(){this._wordHighlighter&&=(this._wordHighlighter.dispose(),null),super.dispose()}};yz=lz=oz([sz(1,On),sz(2,H),sz(3,xl),sz(4,Et),sz(5,hn),sz(6,Wl)],yz);var bz=class extends R{constructor(e,t){super(t),this._isNext=e}run(e,t){let n=yz.get(t);n&&(this._isNext?n.moveNext():n.moveBack())}},xz=class extends bz{constructor(){super(!0,{id:`editor.action.wordHighlight.next`,label:U(1557,`Go to Next Symbol Highlight`),precondition:uz,kbOpts:{kbExpr:y.editorTextFocus,primary:65,weight:100}})}},Sz=class extends bz{constructor(){super(!1,{id:`editor.action.wordHighlight.prev`,label:U(1558,`Go to Previous Symbol Highlight`),precondition:uz,kbOpts:{kbExpr:y.editorTextFocus,primary:1089,weight:100}})}},Cz=class extends R{constructor(){super({id:`editor.action.wordHighlight.trigger`,label:U(1559,`Trigger Symbol Highlight`),precondition:void 0,kbOpts:{kbExpr:y.editorTextFocus,primary:0,weight:100}})}run(e,t,n){let r=yz.get(t);r&&r.restoreViewState(!0)}};K(yz.ID,yz,0),q(xz),q(Sz),q(Cz),cn(az);var wz=class extends Ar{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,n){if(!t.hasModel())return;let r=Jt(t.getOption(148),t.getOption(147)),i=t.getModel(),a=t.getSelections(),o=a.length>1,s=a.map(e=>{let t=new C(e.positionLineNumber,e.positionColumn),n=this._move(r,i,t,this._wordNavigationType,o);return this._moveTo(e,n,this._inSelectionMode)});if(i.pushStackElement(),t._getViewModel().setCursorStates(`moveWordCommand`,3,s.map(e=>wc.fromModelSelection(e))),s.length===1){let e=new C(s[0].positionLineNumber,s[0].positionColumn);t.revealPosition(e,0)}}_moveTo(e,t,n){return n?new P(e.selectionStartLineNumber,e.selectionStartColumn,t.lineNumber,t.column):new P(t.lineNumber,t.column,t.lineNumber,t.column)}},Tz=class extends wz{_move(e,t,n,r,i){return mo.moveWordLeft(e,t,n,r,i)}},Ez=class extends wz{_move(e,t,n,r,i){return mo.moveWordRight(e,t,n,r)}},Dz=class extends Tz{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordStartLeft`,precondition:void 0})}},Oz=class extends Tz{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordEndLeft`,precondition:void 0})}},kz=class extends Tz{constructor(){super({inSelectionMode:!1,wordNavigationType:1,id:`cursorWordLeft`,precondition:void 0,kbOpts:{kbExpr:E.and(y.textInputFocus,E.and(pl,mu)?.negate()),primary:2063,mac:{primary:527},weight:100}})}},Az=class extends Tz{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordStartLeftSelect`,precondition:void 0})}},jz=class extends Tz{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordEndLeftSelect`,precondition:void 0})}},Mz=class extends Tz{constructor(){super({inSelectionMode:!0,wordNavigationType:1,id:`cursorWordLeftSelect`,precondition:void 0,kbOpts:{kbExpr:E.and(y.textInputFocus,E.and(pl,mu)?.negate()),primary:3087,mac:{primary:1551},weight:100}})}},Nz=class extends Tz{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:`cursorWordAccessibilityLeft`,precondition:void 0})}_move(e,t,n,r,i){return super._move(Jt(Oa.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},Pz=class extends Tz{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:`cursorWordAccessibilityLeftSelect`,precondition:void 0})}_move(e,t,n,r,i){return super._move(Jt(Oa.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},Fz=class extends Ez{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordStartRight`,precondition:void 0})}},Iz=class extends Ez{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordEndRight`,precondition:void 0,kbOpts:{kbExpr:E.and(y.textInputFocus,E.and(pl,mu)?.negate()),primary:2065,mac:{primary:529},weight:100}})}},Lz=class extends Ez{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordRight`,precondition:void 0})}},Rz=class extends Ez{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordStartRightSelect`,precondition:void 0})}},zz=class extends Ez{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordEndRightSelect`,precondition:void 0,kbOpts:{kbExpr:E.and(y.textInputFocus,E.and(pl,mu)?.negate()),primary:3089,mac:{primary:1553},weight:100}})}},Bz=class extends Ez{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordRightSelect`,precondition:void 0})}},Vz=class extends Ez{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:`cursorWordAccessibilityRight`,precondition:void 0})}_move(e,t,n,r,i){return super._move(Jt(Oa.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},Hz=class extends Ez{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:`cursorWordAccessibilityRightSelect`,precondition:void 0})}_move(e,t,n,r,i){return super._move(Jt(Oa.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},Uz=class extends Ar{constructor(e){super(e),this._whitespaceHeuristics=e.whitespaceHeuristics,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,n){let r=e?.get(Ce);if(!t.hasModel()||!r)return;let i=Jt(t.getOption(148),t.getOption(147)),a=t.getModel(),o=t.getSelections(),s=t.getOption(10),c=t.getOption(15),l=r.getLanguageConfiguration(a.getLanguageId()).getAutoClosingPairs(),u=t._getViewModel(),d=o.map(e=>{let n=this._delete({wordSeparators:i,model:a,selection:e,whitespaceHeuristics:this._whitespaceHeuristics,autoClosingDelete:t.getOption(13),autoClosingBrackets:s,autoClosingQuotes:c,autoClosingPairs:l,autoClosedCharacters:u.getCursorAutoClosedCharacters()},this._wordNavigationType);return new Eo(n,``)});t.pushUndoStop(),t.executeCommands(this.id,d),t.pushUndoStop()}},Wz=class extends Uz{_delete(e,t){return mo.deleteWordLeft(e,t)||new T(1,1,1,1)}},Gz=class extends Uz{_delete(e,t){let n=mo.deleteWordRight(e,t);if(n)return n;let r=e.model.getLineCount(),i=e.model.getLineMaxColumn(r);return new T(r,i,r,i)}},Kz=class extends Wz{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:`deleteWordStartLeft`,precondition:y.writable})}},qz=class extends Wz{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:`deleteWordEndLeft`,precondition:y.writable})}},Jz=class extends Wz{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:`deleteWordLeft`,precondition:y.writable,kbOpts:{kbExpr:y.textInputFocus,primary:2049,mac:{primary:513},weight:100}})}},Yz=class extends Gz{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:`deleteWordStartRight`,precondition:y.writable})}},Xz=class extends Gz{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:`deleteWordEndRight`,precondition:y.writable})}},Zz=class extends Gz{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:`deleteWordRight`,precondition:y.writable,kbOpts:{kbExpr:y.textInputFocus,primary:2068,mac:{primary:532},weight:100}})}},Qz=class extends R{constructor(){super({id:`deleteInsideWord`,precondition:y.writable,label:U(1560,`Delete Word`)})}run(e,t,n){if(!t.hasModel())return;let r=Jt(t.getOption(148),t.getOption(147)),i=t.getModel(),a=t.getSelections().map(e=>{let t=mo.deleteInsideWord(r,i,e);return new Eo(t,``)});t.pushUndoStop(),t.executeCommands(this.id,a),t.pushUndoStop()}};W(new Dz),W(new Oz),W(new kz),W(new Az),W(new jz),W(new Mz),W(new Fz),W(new Iz),W(new Lz),W(new Rz),W(new zz),W(new Bz),W(new Nz),W(new Pz),W(new Vz),W(new Hz),W(new Kz),W(new qz),W(new Jz),W(new Yz),W(new Xz),W(new Zz),q(Qz);var $z=class extends Uz{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:`deleteWordPartLeft`,precondition:y.writable,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:769},weight:100}})}_delete(e,t){return mc.deleteWordPartLeft(e)||new T(1,1,1,1)}},eB=class extends Uz{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:`deleteWordPartRight`,precondition:y.writable,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:788},weight:100}})}_delete(e,t){let n=mc.deleteWordPartRight(e);if(n)return n;let r=e.model.getLineCount(),i=e.model.getLineMaxColumn(r);return new T(r,i,r,i)}},tB=class extends wz{_move(e,t,n,r,i){return mc.moveWordPartLeft(e,t,n,i)}},nB=class extends tB{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordPartLeft`,precondition:void 0,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:783},weight:100}})}};gd.registerCommandAlias(`cursorWordPartStartLeft`,`cursorWordPartLeft`);var rB=class extends tB{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordPartLeftSelect`,precondition:void 0,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:1807},weight:100}})}};gd.registerCommandAlias(`cursorWordPartStartLeftSelect`,`cursorWordPartLeftSelect`);var iB=class extends wz{_move(e,t,n,r,i){return mc.moveWordPartRight(e,t,n)}},aB=class extends iB{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordPartRight`,precondition:void 0,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:785},weight:100}})}},oB=class extends iB{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordPartRightSelect`,precondition:void 0,kbOpts:{kbExpr:y.textInputFocus,primary:0,mac:{primary:1809},weight:100}})}};W(new $z),W(new eB),W(new nB),W(new rB),W(new aB),W(new oB);var sB=class extends x{static{this.ID=`editor.contrib.readOnlyMessageController`}constructor(e){super(),this.editor=e,this._register(this.editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit()))}_onDidAttemptReadOnlyEdit(){let e=hm.get(this.editor);if(e&&this.editor.hasModel()){let t=this.editor.getOptions().get(105);t||=this.editor.isSimpleWidget?new Jn(G(1363,`Cannot edit in read-only input`)):new Jn(G(1364,`Cannot edit in read-only editor`)),e.showMessage(t,this.editor.getPosition())}}};K(sB.ID,sB,2);var cB=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lB=function(e,t){return function(n,r){t(n,r,e)}},uB=class extends x{constructor(e,t,n){super(),this._textModel=e,this._languageFeaturesService=t,this._outlineModelService=n,this._currentModel=kl(this,void 0);let r=xn(`documentSymbolProvider.onDidChange`,this._languageFeaturesService.documentSymbolProvider.onDidChange),i=xn(`_textModel.onDidChangeContent`,An.debounce(e=>this._textModel.onDidChangeContent(e),()=>void 0,100));this._register(Ql(async(e,t)=>{r.read(e),i.read(e);let n=t.add(new bn),a=await this._outlineModelService.getOrCreate(this._textModel,n.token);t.isDisposed||this._currentModel.set(a,void 0)}))}getBreadcrumbItems(e,t){let n=this._currentModel.read(t);if(!n)return[];let r=n.asListOfDocumentSymbols().filter(t=>e.contains(t.range.startLineNumber)&&!e.contains(t.range.endLineNumber));return r.sort(ba(Mt(e=>e.range.endLineNumber-e.range.startLineNumber,ca))),r.map(e=>({name:e.name,kind:e.kind,startLineNumber:e.range.startLineNumber}))}};uB=cB([lB(1,H),lB(2,xT)],uB),ze.setBreadcrumbsSourceFactory((e,t)=>t.createInstance(uB,e));var dB=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fB=function(e,t){return function(n,r){t(n,r,e)}},pB=class extends x{static{this.ID=`editor.contrib.floatingToolbar`}constructor(e,t,n,r){super();let i=this._register(Bs(e)),a=this._register(r.createMenu(S.EditorContent,e.contextKeyService)),o=yt(this,a.onDidChange,()=>a.getActions().length===0);this._register(g(e=>{if(o.read(e))return;let r=zu(`div.floating-menu-overlay-widget`);r.root.style.height=`28px`;let a=t.createInstance(Qs,r.root,S.EditorContent,{actionViewItemProvider:(e,r)=>{if(!(e instanceof cr))return;let i=n.lookupKeybinding(e.id);if(i)return t.createInstance(class extends Qn{updateLabel(){this.options.label&&this.label&&(this.label.textContent=`${this._commandAction.label} (${i.getLabel()})`)}},e,{...r,keybindingNotRenderedWithLabel:!0})},hiddenItemStrategy:0,menuOptions:{shouldForwardArgs:!0},telemetrySource:`editor.overlayToolbar`,toolbarOptions:{primaryGroup:()=>!0,useSeparatorsInPrimaryActions:!0}});e.store.add(a),e.store.add(g(e=>{a.context=i.model.read(e)?.uri})),e.store.add(i.createOverlayWidget({allowEditorOverflow:!1,domNode:r.root,minContentWidthInPx:Lr(0),position:Lr({preference:1})}))}))}};pB=dB([fB(1,k),fB(2,Yt),fB(3,rt)],pB),K(pB.ID,pB,1);var mB=class extends x{static{this.ID=`editor.contrib.iPadShowKeyboard`}constructor(e){super(),this.editor=e,this.widget=null,Ua&&(this._register(e.onDidChangeConfiguration(()=>this.update())),this.update())}update(){let e=!this.editor.getOption(104);!this.widget&&e?this.widget=new hB(this.editor):this.widget&&!e&&(this.widget.dispose(),this.widget=null)}dispose(){super.dispose(),this.widget&&=(this.widget.dispose(),null)}},hB=class e extends x{static{this.ID=`editor.contrib.ShowKeyboardWidget`}constructor(e){super(),this.editor=e,this._domNode=document.createElement(`textarea`),this._domNode.className=`iPadShowKeyboard`,this._register(z(this._domNode,`touchstart`,e=>{this.editor.focus()})),this._register(z(this._domNode,`focus`,e=>{this.editor.focus()})),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return{preference:1}}};K(mB.ID,mB,3);var gB=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_B=function(e,t){return function(n,r){t(n,r,e)}},vB,yB=class extends x{static{vB=this}static{this.ID=`editor.contrib.inspectTokens`}static get(e){return e.getContribution(vB.ID)}constructor(e,t,n){super(),this._editor=e,this._languageService=n,this._widget=null,this._register(this._editor.onDidChangeModel(e=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(e=>this.stop())),this._register(Ju.onDidChange(e=>this.stop())),this._register(this._editor.onKeyUp(e=>e.keyCode===9&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&(this._widget=new CB(this._editor,this._languageService))}stop(){this._widget&&=(this._widget.dispose(),null)}};yB=vB=gB([_B(1,Ji),_B(2,wt)],yB);var bB=class extends R{constructor(){super({id:`editor.action.inspectTokens`,label:ne.inspectTokensAction,alias:`Developer: Inspect Tokens`,precondition:void 0})}run(e,t){yB.get(t)?.launch()}};function xB(e){let t=``;for(let n=0,r=e.length;n<r;n++){let r=e.charCodeAt(n);switch(r){case 9:t+=``;break;case 32:t+=``;break;default:t+=String.fromCharCode(r)}}return t}function SB(e,t){let n=Ju.get(t);if(n)return n;let r=e.encodeLanguageId(t);return{getInitialState:()=>Xc,tokenize:(e,n,r)=>Hl(t,r),tokenizeEncoded:(e,t,n)=>_o(r,n)}}var CB=class e extends x{static{this._ID=`editor.contrib.inspectTokensWidget`}constructor(e,t){super(),this.allowEditorOverflow=!0,this._editor=e,this._languageService=t,this._model=this._editor.getModel(),this._domNode=document.createElement(`div`),this._domNode.className=`tokens-inspect-widget`,this._tokenizationSupport=SB(this._languageService.languageIdCodec,this._model.getLanguageId()),this._compute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(e=>this._compute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._editor.removeContentWidget(this),super.dispose()}getId(){return e._ID}_compute(e){let t=this._getTokensAtLine(e.lineNumber),n=0;for(let r=t.tokens1.length-1;r>=0;r--){let i=t.tokens1[r];if(e.column-1>=i.offset){n=r;break}}let r=0;for(let n=t.tokens2.length>>>1;n>=0;n--)if(e.column-1>=t.tokens2[n<<1]){r=n;break}let i=this._model.getLineContent(e.lineNumber),a=``;if(n<t.tokens1.length){let e=t.tokens1[n].offset,r=n+1<t.tokens1.length?t.tokens1[n+1].offset:i.length;a=i.substring(e,r)}Ve(this._domNode,b(`h2.tm-token`,void 0,xB(a),b(`span.tm-token-length`,void 0,`${a.length} ${a.length===1?`char`:`chars`}`))),B(this._domNode,b(`hr.tokens-inspect-separator`,{style:`clear:both`}));let o=(r<<1)+1<t.tokens2.length?this._decodeMetadata(t.tokens2[(r<<1)+1]):null;B(this._domNode,b(`table.tm-metadata-table`,void 0,b(`tbody`,void 0,b(`tr`,void 0,b(`td.tm-metadata-key`,void 0,`language`),b(`td.tm-metadata-value`,void 0,`${o?o.languageId:`-?-`}`)),b(`tr`,void 0,b(`td.tm-metadata-key`,void 0,`token type`),b(`td.tm-metadata-value`,void 0,`${o?this._tokenTypeToString(o.tokenType):`-?-`}`)),b(`tr`,void 0,b(`td.tm-metadata-key`,void 0,`font style`),b(`td.tm-metadata-value`,void 0,`${o?this._fontStyleToString(o.fontStyle):`-?-`}`)),b(`tr`,void 0,b(`td.tm-metadata-key`,void 0,`foreground`),b(`td.tm-metadata-value`,void 0,`${o?V.Format.CSS.formatHex(o.foreground):`-?-`}`)),b(`tr`,void 0,b(`td.tm-metadata-key`,void 0,`background`),b(`td.tm-metadata-value`,void 0,`${o?V.Format.CSS.formatHex(o.background):`-?-`}`))))),B(this._domNode,b(`hr.tokens-inspect-separator`)),n<t.tokens1.length&&B(this._domNode,b(`span.tm-token-type`,void 0,t.tokens1[n].type)),this._editor.layoutContentWidget(this)}_decodeMetadata(e){let t=Ju.getColorMap(),n=qa.getLanguageId(e),r=qa.getTokenType(e),i=qa.getFontStyle(e),a=qa.getForeground(e),o=qa.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(n),tokenType:r,fontStyle:i,foreground:t[a],background:t[o]}}_tokenTypeToString(e){switch(e){case 0:return`Other`;case 1:return`Comment`;case 2:return`String`;case 3:return`RegEx`;default:return`??`}}_fontStyleToString(e){let t=``;return e&1&&(t+=`italic `),e&2&&(t+=`bold `),e&4&&(t+=`underline `),e&8&&(t+=`strikethrough `),t.length===0&&(t=`---`),t}_getTokensAtLine(e){let t=this._getStateBeforeLine(e),n=this._tokenizationSupport.tokenize(this._model.getLineContent(e),!0,t),r=this._tokenizationSupport.tokenizeEncoded(this._model.getLineContent(e),!0,t);return{startState:t,tokens1:n.tokens,tokens2:r.tokens,endState:n.endState}}_getStateBeforeLine(e){let t=this._tokenizationSupport.getInitialState();for(let n=1;n<e;n++)t=this._tokenizationSupport.tokenize(this._model.getLineContent(n),!0,t).endState;return t}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[2,1]}}};K(yB.ID,yB,4),q(bB);var wB=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},TB=function(e,t){return function(n,r){t(n,r,e)}},EB,DB=class{static{EB=this}static{this.PREFIX=`?`}constructor(e,t){this.quickInputService=e,this.keybindingService=t,this.registry=br.as(Je.Quickaccess)}provide(e){let t=new L;return t.add(e.onDidAccept(()=>{let[t]=e.selectedItems;t&&this.quickInputService.quickAccess.show(t.prefix,{preserveValue:!0})})),t.add(e.onDidChangeValue(e=>{let t=this.registry.getQuickAccessProvider(e.substr(EB.PREFIX.length));t&&t.prefix&&t.prefix!==EB.PREFIX&&this.quickInputService.quickAccess.show(t.prefix,{preserveValue:!0})})),e.items=this.getQuickAccessProviders().filter(e=>e.prefix!==EB.PREFIX),t}getQuickAccessProviders(){return this.registry.getQuickAccessProviders().sort((e,t)=>e.prefix.localeCompare(t.prefix)).flatMap(e=>this.createPicks(e))}createPicks(e){return e.helpEntries.map(t=>{let n=t.prefix||e.prefix,r=n||``;return{prefix:n,label:r,keybinding:t.commandId?this.keybindingService.lookupKeybinding(t.commandId):void 0,ariaLabel:G(1730,`{0}, {1}`,r,t.description),description:t.description}})}};DB=EB=wB([TB(0,Mu),TB(1,Yt)],DB),br.as(Je.Quickaccess).registerQuickAccessProvider({ctor:DB,prefix:``,helpEntries:[{description:$l.helpQuickAccessActionLabel}]});var OB=class{constructor(e){this.options=e,this.rangeHighlightDecorationId=void 0}provide(e,t,n){let r=new L;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;let i=r.add(new Bt);return i.value=this.doProvide(e,t,n),r.add(this.onDidActiveTextEditorControlChange(()=>{i.value=void 0,i.value=this.doProvide(e,t)})),r}doProvide(e,t,n){let r=new L,i=this.activeTextEditorControl;if(i&&this.canProvideWithTextEditor(i)){let a={editor:i},o=Qa(i);if(o){let e=i.saveViewState()??void 0;r.add(o.onDidChangeCursorPosition(()=>{e=i.saveViewState()??void 0})),a.restoreViewState=()=>{e&&i===this.activeTextEditorControl&&i.restoreViewState(e)},r.add(sn(t.onCancellationRequested)(()=>a.restoreViewState?.()))}r.add(Cl(()=>this.clearDecorations(i))),r.add(this.provideWithTextEditor(a,e,t,n))}else r.add(this.provideWithoutTextEditor(e,t));return r}canProvideWithTextEditor(e){return!0}gotoLocation({editor:e},t){e.setSelection(t.range,`code.jump`),e.revealRangeInCenter(t.range,0),t.preserveFocus||e.focus();let n=e.getModel();n&&`getLineContent`in n&&wr(`${n.getLineContent(t.range.startLineNumber)}`)}getModel(e){return Kr(e)?e.getModel()?.modified:e.getModel()}addDecorations(e,t){e.changeDecorations(e=>{let n=[];this.rangeHighlightDecorationId&&=(n.push(this.rangeHighlightDecorationId.overviewRulerDecorationId),n.push(this.rangeHighlightDecorationId.rangeHighlightId),void 0);let r=[{range:t,options:{description:`quick-access-range-highlight`,className:`rangeHighlight`,isWholeLine:!0}},{range:t,options:{description:`quick-access-range-highlight-overview`,overviewRuler:{color:Ta(an),position:vr.Full}}}],[i,a]=e.deltaDecorations(n,r);this.rangeHighlightDecorationId={rangeHighlightId:i,overviewRulerDecorationId:a}})}clearDecorations(e){let t=this.rangeHighlightDecorationId;t&&(e.changeDecorations(e=>{e.deltaDecorations([t.overviewRulerDecorationId,t.rangeHighlightId],[])}),this.rangeHighlightDecorationId=void 0)}},kB=class e extends OB{static{this.PREFIX=`:`}constructor(){super({canAcceptInBackground:!0})}provideWithoutTextEditor(e){let t=G(1325,`Open a text editor first to go to a line.`);return e.items=[{label:t}],e.ariaLabel=t,x.None}provideWithTextEditor(t,n,r){let i=t.editor,a=new L;a.add(n.onDidAccept(e=>{let[r]=n.selectedItems;if(r){if(!this.isValidLineNumber(i,r.lineNumber))return;this.gotoLocation(t,{range:this.toRange(r.lineNumber,r.column),keyMods:n.keyMods,preserveFocus:e.inBackground}),e.inBackground||n.hide()}}));let o=()=>{let t=this.parsePosition(i,n.value.trim().substr(e.PREFIX.length)),r=this.getPickLabel(i,t.lineNumber,t.column);if(n.items=[{lineNumber:t.lineNumber,column:t.column,label:r}],n.ariaLabel=r,!this.isValidLineNumber(i,t.lineNumber)){this.clearDecorations(i);return}let a=this.toRange(t.lineNumber,t.column);i.revealRangeInCenter(a,0),this.addDecorations(i,a)};o(),a.add(n.onDidChangeValue(()=>o()));let s=Qa(i);return s&&s.getOptions().get(76).renderType===2&&(s.updateOptions({lineNumbers:`on`}),a.add(Cl(()=>s.updateOptions({lineNumbers:`relative`})))),a}toRange(e=1,t=1){return{startLineNumber:e,startColumn:t,endLineNumber:e,endColumn:t}}parsePosition(e,t){let n=t.split(/,|:|#/).map(e=>parseInt(e,10)).filter(e=>!isNaN(e)),r=this.lineCount(e)+1;return{lineNumber:n[0]>0?n[0]:r+n[0],column:n[1]}}getPickLabel(e,t,n){if(this.isValidLineNumber(e,t))return this.isValidColumn(e,t,n)?G(1326,`Go to line {0} and character {1}.`,t,n):G(1327,`Go to line {0}.`,t);let r=e.getPosition()||{lineNumber:1,column:1},i=this.lineCount(e);return i>1?G(1328,`Current Line: {0}, Character: {1}. Type a line number between 1 and {2} to navigate to.`,r.lineNumber,r.column,i):G(1329,`Current Line: {0}, Character: {1}. Type a line number to navigate to.`,r.lineNumber,r.column)}isValidLineNumber(e,t){return!t||typeof t!=`number`?!1:t>0&&t<=this.lineCount(e)}isValidColumn(e,t,n){if(!n||typeof n!=`number`)return!1;let r=this.getModel(e);if(!r)return!1;let i={lineNumber:t,column:n};return r.validatePosition(i).equals(i)}lineCount(e){return this.getModel(e)?.getLineCount()??0}},AB=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},jB=function(e,t){return function(n,r){t(n,r,e)}},MB=class extends kB{constructor(e){super(),this.editorService=e,this.onDidActiveTextEditorControlChange=An.None}get activeTextEditorControl(){return this.editorService.getFocusedCodeEditor()??void 0}};MB=AB([jB(0,xl)],MB);var NB=class e extends R{static{this.ID=`editor.action.gotoLine`}constructor(){super({id:e.ID,label:Nr.gotoLineActionLabel,alias:`Go to Line/Column...`,precondition:void 0,kbOpts:{kbExpr:y.focus,primary:2085,mac:{primary:293},weight:100}})}run(e){e.get(Mu).quickAccess.show(MB.PREFIX)}};q(NB),br.as(Je.Quickaccess).registerQuickAccessProvider({ctor:MB,prefix:MB.PREFIX,helpEntries:[{description:Nr.gotoLineActionLabel,commandId:NB.ID}]});var PB=[void 0,[]];function FB(e,t,n=0,r=0){let i=t;return i.values&&i.values.length>1?IB(e,i.values,n,r):LB(e,t,n,r)}function IB(e,t,n,r){let i=0,a=[];for(let o of t){let[t,s]=LB(e,o,n,r);if(typeof t!=`number`)return PB;i+=t,a.push(...s)}return[i,RB(a)]}function LB(e,t,n,r){let i=Ft(t.original,t.originalLowercase,n,e,e.toLowerCase(),r,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return i?[i[0],Mi(i)]:PB}Object.freeze({score:0});function RB(e){let t=e.sort((e,t)=>e.start-t.start),n=[],r;for(let e of t)!r||!zB(r,e)?(r=e,n.push(e)):(r.start=Math.min(r.start,e.start),r.end=Math.max(r.end,e.end));return n}function zB(e,t){return!(e.end<t.start||t.end<e.start)}function BB(e){return e.startsWith(`"`)&&e.endsWith(`"`)}var VB=` `;function HB(e){typeof e!=`string`&&(e=``);let t=e.toLowerCase(),{pathNormalized:n,normalized:r,normalizedLowercase:i}=UB(e),a=n.indexOf(Zs)>=0,o=BB(e),s,c=e.split(VB);if(c.length>1)for(let e of c){let t=BB(e),{pathNormalized:n,normalized:r,normalizedLowercase:i}=UB(e);r&&(s||=[],s.push({original:e,originalLowercase:e.toLowerCase(),pathNormalized:n,normalized:r,normalizedLowercase:i,expectContiguousMatch:t}))}return{original:e,originalLowercase:t,pathNormalized:n,normalized:r,normalizedLowercase:i,values:s,containsPathSeparator:a,expectContiguousMatch:o}}function UB(e){let t;t=To?e.replace(/\//g,Zs):e.replace(/\\/g,Zs);let n=t.replace(/[\*\u2026\s"]/g,``);return{pathNormalized:t,normalized:n,normalizedLowercase:n.toLowerCase()}}function WB(e){return HB(Array.isArray(e)?e.map(e=>e.original).join(VB):e.original)}var GB=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},KB=function(e,t){return function(n,r){t(n,r,e)}},qB,JB=class extends OB{static{qB=this}static{this.PREFIX=`@`}static{this.SCOPE_PREFIX=`:`}static{this.PREFIX_BY_CATEGORY=`${this.PREFIX}${this.SCOPE_PREFIX}`}constructor(e,t,n=Object.create(null)){super(n),this._languageFeaturesService=e,this._outlineModelService=t,this.options=n,this.options.canAcceptInBackground=!0}provideWithoutTextEditor(e){return this.provideLabelPick(e,G(1330,`To go to a symbol, first open a text editor with symbol information.`)),x.None}provideWithTextEditor(e,t,n,r){let i=e.editor,a=this.getModel(i);return a?this._languageFeaturesService.documentSymbolProvider.has(a)?this.doProvideWithEditorSymbols(e,a,t,n,r):this.doProvideWithoutEditorSymbols(e,a,t,n):x.None}doProvideWithoutEditorSymbols(e,t,n,r){let i=new L;return this.provideLabelPick(n,G(1331,`The active text editor does not provide symbol information.`)),(async()=>{!await this.waitForLanguageSymbolRegistry(t,i)||r.isCancellationRequested||i.add(this.doProvideWithEditorSymbols(e,t,n,r))})(),i}provideLabelPick(e,t){e.items=[{label:t,index:0,kind:14}],e.ariaLabel=t}async waitForLanguageSymbolRegistry(e,t){if(this._languageFeaturesService.documentSymbolProvider.has(e))return!0;let n=new ro,r=t.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>{this._languageFeaturesService.documentSymbolProvider.has(e)&&(r.dispose(),n.complete(!0))}));return t.add(Cl(()=>n.complete(!1))),n.p}doProvideWithEditorSymbols(e,t,n,r,i){let a=e.editor,o=new L;o.add(n.onDidAccept(t=>{let[r]=n.selectedItems;r&&r.range&&(this.gotoLocation(e,{range:r.range.selection,keyMods:n.keyMods,preserveFocus:t.inBackground}),i?.handleAccept?.(r,t.inBackground),t.inBackground||n.hide())})),o.add(n.onDidTriggerItemButton(({item:t})=>{t&&t.range&&(this.gotoLocation(e,{range:t.range.selection,keyMods:n.keyMods,forceSideBySide:!0}),n.hide())}));let s=this.getDocumentSymbols(t,r),c=o.add(new Bt),l=async e=>{c?.value?.cancel(),n.busy=!1,c.value=new Sr,n.busy=!0;try{let i=HB(n.value.substr(qB.PREFIX.length).trim()),a=await this.doGetSymbolPicks(s,i,void 0,c.value.token,t);if(r.isCancellationRequested)return;if(a.length>0){if(n.items=a,e&&i.original.length===0){let t=tt(a,t=>!!(t.type!==`separator`&&t.range&&T.containsPosition(t.range.decoration,e)));t&&(n.activeItems=[t])}}else i.original.length>0?this.provideLabelPick(n,G(1332,`No matching editor symbols`)):this.provideLabelPick(n,G(1333,`No editor symbols`))}finally{r.isCancellationRequested||(n.busy=!1)}};return o.add(n.onDidChangeValue(()=>l(void 0))),l(a.getSelection()?.getPosition()),o.add(n.onDidChangeActive(()=>{let[e]=n.activeItems;e&&e.range&&(a.revealRangeInCenter(e.range.selection,0),this.addDecorations(a,e.range.decoration))})),o}async doGetSymbolPicks(e,t,n,r,i){let a=await e;if(r.isCancellationRequested)return[];let o=t.original.indexOf(qB.SCOPE_PREFIX)===0,s=o?1:0,c,l;t.values&&t.values.length>1?(c=WB(t.values[0]),l=WB(t.values.slice(1))):c=t;let u,d=this.options?.openSideBySideDirection?.();d&&(u=[{iconClass:d===`right`?I.asClassName(X.splitHorizontal):I.asClassName(X.splitVertical),tooltip:d===`right`?G(1334,`Open to the Side`):G(1335,`Open to the Bottom`)}]);let f=[];for(let e=0;e<a.length;e++){let r=a[e],o=ru(r.name),d=`$(${lo.toIcon(r.kind).id}) ${o}`,p=d.length-o.length,m=r.containerName;n?.extraContainerLabel&&(m=m?`${n.extraContainerLabel}  ${m}`:n.extraContainerLabel);let h,g,_,ee;if(t.original.length>s){let e=!1;if(c!==t&&([h,g]=FB(d,{...t,values:void 0},s,p),typeof h==`number`&&(e=!0)),typeof h!=`number`&&([h,g]=FB(d,c,s,p),typeof h!=`number`))continue;if(!e&&l){if(m&&l.original.length>0&&([_,ee]=FB(m,l)),typeof _!=`number`)continue;typeof h==`number`&&(h+=_)}}let v=r.tags&&r.tags.indexOf(1)>=0;f.push({index:e,kind:r.kind,score:h,label:d,ariaLabel:ri(r.name,r.kind),description:m,highlights:v?void 0:{label:g,description:ee},range:{selection:T.collapseToStart(r.selectionRange),decoration:r.range},uri:i.uri,symbolName:o,strikethrough:v,buttons:u})}let p=f.sort((e,t)=>o?this.compareByKindAndScore(e,t):this.compareByScore(e,t)),m=[];if(o){let e,t,n=0;function r(){t&&typeof e==`number`&&n>0&&(t.label=Vi(XB[e]||YB,n))}for(let i of p)e===i.kind?n++:(r(),e=i.kind,n=1,t={type:`separator`},m.push(t)),m.push(i);r()}else p.length>0&&(m=[{label:G(1336,`symbols ({0})`,f.length),type:`separator`},...p]);return m}compareByScore(e,t){if(typeof e.score!=`number`&&typeof t.score==`number`)return 1;if(typeof e.score==`number`&&typeof t.score!=`number`)return-1;if(typeof e.score==`number`&&typeof t.score==`number`){if(e.score>t.score)return-1;if(e.score<t.score)return 1}return e.index<t.index?-1:e.index>t.index?1:0}compareByKindAndScore(e,t){let n=XB[e.kind]||YB,r=XB[t.kind]||YB,i=n.localeCompare(r);return i===0?this.compareByScore(e,t):i}async getDocumentSymbols(e,t){let n=await this._outlineModelService.getOrCreate(e,t);return t.isCancellationRequested?[]:n.asListOfDocumentSymbols()}};JB=qB=GB([KB(0,H),KB(1,xT)],JB);var YB=G(1337,`properties ({0})`),XB={5:G(1338,`methods ({0})`),11:G(1339,`functions ({0})`),8:G(1340,`constructors ({0})`),12:G(1341,`variables ({0})`),4:G(1342,`classes ({0})`),22:G(1343,`structs ({0})`),23:G(1344,`events ({0})`),24:G(1345,`operators ({0})`),10:G(1346,`interfaces ({0})`),2:G(1347,`namespaces ({0})`),3:G(1348,`packages ({0})`),25:G(1349,`type parameters ({0})`),1:G(1350,`modules ({0})`),6:G(1351,`properties ({0})`),9:G(1352,`enumerations ({0})`),21:G(1353,`enumeration members ({0})`),14:G(1354,`strings ({0})`),0:G(1355,`files ({0})`),17:G(1356,`arrays ({0})`),15:G(1357,`numbers ({0})`),16:G(1358,`booleans ({0})`),18:G(1359,`objects ({0})`),19:G(1360,`keys ({0})`),7:G(1361,`fields ({0})`),13:G(1362,`constants ({0})`)},ZB=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},QB=function(e,t){return function(n,r){t(n,r,e)}},$B=class extends JB{constructor(e,t,n){super(t,n),this.editorService=e,this.onDidActiveTextEditorControlChange=An.None}get activeTextEditorControl(){return this.editorService.getFocusedCodeEditor()??void 0}};$B=ZB([QB(0,xl),QB(1,H),QB(2,xT)],$B);var eV=class e extends R{static{this.ID=`editor.action.quickOutline`}constructor(){super({id:e.ID,label:Rc.quickOutlineActionLabel,alias:`Go to Symbol...`,precondition:y.hasDocumentSymbolProvider,kbOpts:{kbExpr:y.focus,primary:3117,weight:100},contextMenuOpts:{group:`navigation`,order:3}})}run(e){e.get(Mu).quickAccess.show(JB.PREFIX,{itemActivation:ui.NONE})}};q(eV),br.as(Je.Quickaccess).registerQuickAccessProvider({ctor:$B,prefix:JB.PREFIX,helpEntries:[{description:Rc.quickOutlineActionLabel,prefix:JB.PREFIX,commandId:eV.ID},{description:Rc.quickOutlineByCategoryActionLabel,prefix:JB.PREFIX_BY_CATEGORY}]});function tV(e){let t=new Map;for(let n of e)t.set(n,(t.get(n)??0)+1);return t}var nV=class e{constructor(){this.chunkCount=0,this.chunkOccurrences=new Map,this.documents=new Map}calculateScores(e,t){let n=this.computeEmbedding(e),r=new Map,i=[];for(let[e,a]of this.documents){if(t.isCancellationRequested)return[];for(let t of a.chunks){let a=this.computeSimilarityScore(t,n,r);a>0&&i.push({key:e,score:a})}}return i}static termFrequencies(t){return tV(e.splitTerms(t))}static*splitTerms(e){let t=e=>e.toLowerCase();for(let[n]of e.matchAll(/\b\p{Letter}[\p{Letter}\d]{2,}\b/gu)){yield t(n);let e=n.replace(/([a-z])([A-Z])/g,`$1 $2`).split(/\s+/g);if(e.length>1)for(let n of e)n.length>2&&/\p{Letter}{3,}/gu.test(n)&&(yield t(n))}}updateDocuments(t){for(let{key:e}of t)this.deleteDocument(e);for(let n of t){let t=[];for(let r of n.textChunks){let n=e.termFrequencies(r);for(let e of n.keys())this.chunkOccurrences.set(e,(this.chunkOccurrences.get(e)??0)+1);t.push({text:r,tf:n})}this.chunkCount+=t.length,this.documents.set(n.key,{chunks:t})}return this}deleteDocument(e){let t=this.documents.get(e);if(t){this.documents.delete(e),this.chunkCount-=t.chunks.length;for(let e of t.chunks)for(let t of e.tf.keys()){let e=this.chunkOccurrences.get(t);if(typeof e==`number`){let n=e-1;n<=0?this.chunkOccurrences.delete(t):this.chunkOccurrences.set(t,n)}}}}computeSimilarityScore(e,t,n){let r=0;for(let[i,a]of Object.entries(t)){let t=e.tf.get(i);if(!t)continue;let o=n.get(i);typeof o!=`number`&&(o=this.computeIdf(i),n.set(i,o));let s=t*o;r+=s*a}return r}computeEmbedding(t){let n=e.termFrequencies(t);return this.computeTfidf(n)}computeIdf(e){let t=this.chunkOccurrences.get(e)??0;return t>0?Math.log((this.chunkCount+1)/t):0}computeTfidf(e){let t=Object.create(null);for(let[n,r]of e){let e=this.computeIdf(n);e>0&&(t[n]=r*e)}return t}};function rV(e){let t=e.slice(0);t.sort((e,t)=>t.score-e.score);let n=t[0]?.score??0;if(n>0)for(let e of t)e.score/=n;return t}var iV;(function(e){e[e.NO_ACTION=0]=`NO_ACTION`,e[e.CLOSE_PICKER=1]=`CLOSE_PICKER`,e[e.REFRESH_PICKER=2]=`REFRESH_PICKER`,e[e.REMOVE_ITEM=3]=`REMOVE_ITEM`})(iV||={});function aV(e){let t=e;return Array.isArray(t.items)}function oV(e){let t=e;return!!t.picks&&t.additionalPicks instanceof Promise}var sV=class extends x{constructor(e,t){super(),this.prefix=e,this.options=t}provide(e,t,n){let r=new L;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;let i,a=r.add(new Bt),o=async()=>{i?.dispose(!0),e.busy=!1;let r=a.value=new L;i=r.add(new Sr(t));let o=i.token,s=e.value.substring(this.prefix.length);this.options?.shouldSkipTrimPickFilter||(s=s.trim());let c=this._getPicks(s,r,o,n),l=(t,n)=>{let r,i;if(aV(t)?(r=t.items,i=t.active):r=t,r.length===0){if(n)return!1;(s.length>0||e.hideInput)&&this.options?.noResultsPick&&(r=to(this.options.noResultsPick)?[this.options.noResultsPick(s)]:[this.options.noResultsPick])}return e.items=r,i&&(e.activeItems=[i]),!0},u=async t=>{let n=!1,r=!1;await Promise.all([(async()=>{typeof t.mergeDelay==`number`&&(await le(t.mergeDelay),o.isCancellationRequested)||r||(n=l(t.picks,!0))})(),(async()=>{e.busy=!0;try{let r=await t.additionalPicks;if(o.isCancellationRequested)return;let i,a;aV(t.picks)?(i=t.picks.items,a=t.picks.active):i=t.picks;let s,c;if(aV(r)?(s=r.items,c=r.active):s=r,s.length>0||!n){let t;if(!a&&!c){let n=e.activeItems[0];n&&i.indexOf(n)!==-1&&(t=n)}l({items:[...i,...s],active:a||c||t})}}finally{o.isCancellationRequested||(e.busy=!1),r=!0}})()])};if(c!==null)if(oV(c))await u(c);else if(!(c instanceof Promise))l(c);else{e.busy=!0;try{let e=await c;if(o.isCancellationRequested)return;oV(e)?await u(e):l(e)}finally{o.isCancellationRequested||(e.busy=!1)}}};r.add(e.onDidChangeValue(()=>o())),o(),r.add(e.onDidAccept(t=>{if(n?.handleAccept){t.inBackground||e.hide(),n.handleAccept?.(e.activeItems[0],t.inBackground);return}let[r]=e.selectedItems;typeof r?.accept==`function`&&(t.inBackground||e.hide(),r.accept(e.keyMods,t))}));let s=async(n,r)=>{if(typeof r.trigger!=`function`)return;let i=r.buttons?.indexOf(n)??-1;if(i>=0){let n=r.trigger(i,e.keyMods),a=typeof n==`number`?n:await n;if(t.isCancellationRequested)return;switch(a){case iV.NO_ACTION:break;case iV.CLOSE_PICKER:e.hide();break;case iV.REFRESH_PICKER:o();break;case iV.REMOVE_ITEM:{let t=e.items.indexOf(r);if(t!==-1){let n=e.items.slice(),r=n.splice(t,1),i=e.activeItems.filter(e=>e!==r[0]),a=e.keepScrollPosition;e.keepScrollPosition=!0,e.items=n,i&&(e.activeItems=i),e.keepScrollPosition=a}break}}}};return r.add(e.onDidTriggerItemButton(({button:e,item:t})=>s(e,t))),r.add(e.onDidTriggerSeparatorButton(({button:e,separator:t})=>s(e,t))),r}},cV=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lV=function(e,t){return function(n,r){t(n,r,e)}},uV,dV,fV=class extends sV{static{uV=this}static{this.PREFIX=`>`}static{this.TFIDF_THRESHOLD=.5}static{this.TFIDF_MAX_RESULTS=5}static{this.WORD_FILTER=nn(Ct,vl,Hi)}constructor(e,t,n,r,i,a){super(uV.PREFIX,e),this.keybindingService=n,this.commandService=r,this.telemetryService=i,this.dialogService=a,this.commandsHistory=this._register(t.createInstance(pV)),this.options=e}async _getPicks(e,t,n,r){let i=await this.getCommandPicks(n);if(n.isCancellationRequested)return[];let a=sn(()=>{let t=new nV;t.updateDocuments(i.map(e=>({key:e.commandId,textChunks:[this.getTfIdfChunk(e)]})));let r=t.calculateScores(e,n);return rV(r).filter(e=>e.score>uV.TFIDF_THRESHOLD).slice(0,uV.TFIDF_MAX_RESULTS)}),o=[];for(let t of i){let r=uV.WORD_FILTER(e,t.label)??void 0,i=t.commandAlias?uV.WORD_FILTER(e,t.commandAlias)??void 0:void 0;if(r||i)t.highlights={label:r,detail:this.options.showAlias?i:void 0},o.push(t);else if(e===t.commandId)o.push(t);else if(e.length>=3){let e=a();if(n.isCancellationRequested)return[];let r=e.find(e=>e.key===t.commandId);r&&(t.tfIdfScore=r.score,o.push(t))}}let s=new Map;for(let e of o){let t=s.get(e.label);t?(e.description=e.commandId,t.description=t.commandId):s.set(e.label,e)}o.sort((e,t)=>{if(e.tfIdfScore&&t.tfIdfScore)return e.tfIdfScore===t.tfIdfScore?e.label.localeCompare(t.label):t.tfIdfScore-e.tfIdfScore;if(e.tfIdfScore)return 1;if(t.tfIdfScore)return-1;let n=this.commandsHistory.peek(e.commandId),r=this.commandsHistory.peek(t.commandId);if(n&&r)return n>r?-1:1;if(n)return-1;if(r)return 1;if(this.options.suggestedCommandIds){let n=this.options.suggestedCommandIds.has(e.commandId),r=this.options.suggestedCommandIds.has(t.commandId);if(n&&r)return 0;if(n)return-1;if(r)return 1}return e.label.localeCompare(t.label)});let c=[],l=!1,u=!0,d=!!this.options.suggestedCommandIds;for(let e=0;e<o.length;e++){let t=o[e];e===0&&this.commandsHistory.peek(t.commandId)&&(c.push({type:`separator`,label:G(1723,`recently used`)}),l=!0),u&&t.tfIdfScore!==void 0&&(c.push({type:`separator`,label:G(1724,`similar commands`)}),u=!1),d&&t.tfIdfScore===void 0&&!this.commandsHistory.peek(t.commandId)&&this.options.suggestedCommandIds?.has(t.commandId)&&(c.push({type:`separator`,label:G(1725,`commonly used`)}),l=!0,d=!1),l&&t.tfIdfScore===void 0&&!this.commandsHistory.peek(t.commandId)&&!this.options.suggestedCommandIds?.has(t.commandId)&&(c.push({type:`separator`,label:G(1726,`other commands`)}),l=!1),c.push(this.toCommandPick(t,r))}return this.hasAdditionalCommandPicks(e,n)?{picks:c,additionalPicks:(async()=>{let t=await this.getAdditionalCommandPicks(i,o,e,n);if(n.isCancellationRequested)return[];let a=t.map(e=>this.toCommandPick(e,r));return u&&a[0]?.type!==`separator`&&a.unshift({type:`separator`,label:G(1727,`similar commands`)}),a})()}:c}toCommandPick(e,t){if(e.type===`separator`)return e;let n=this.keybindingService.lookupKeybinding(e.commandId),r=n?G(1728,`{0}, {1}`,e.label,n.getAriaLabel()):e.label;return{...e,ariaLabel:r,detail:this.options.showAlias&&e.commandAlias!==e.label?e.commandAlias:void 0,keybinding:n,accept:async()=>{this.commandsHistory.push(e.commandId),this.telemetryService.publicLog2(`workbenchActionExecuted`,{id:e.commandId,from:t?.from??`quick open`});try{e.args?.length?await this.commandService.executeCommand(e.commandId,...e.args):await this.commandService.executeCommand(e.commandId)}catch(t){Gn(t)||this.dialogService.error(G(1729,`Command '{0}' resulted in an error`,e.label),Km(t))}}}}getTfIdfChunk({label:e,commandAlias:t,commandDescription:n}){let r=e;return t&&t!==e&&(r+=` - ${t}`),n&&n.value!==e&&(r+=` - ${n.value===n.original?n.value:`${n.value} (${n.original})`}`),r}};fV=uV=cV([lV(1,k),lV(2,Yt),lV(3,Te),lV(4,Fu),lV(5,cl)],fV);var pV=class extends x{static{dV=this}static{this.DEFAULT_COMMANDS_HISTORY_LENGTH=50}static{this.PREF_KEY_CACHE=`commandPalette.mru.cache`}static{this.PREF_KEY_COUNTER=`commandPalette.mru.counter`}static{this.counter=1}static{this.hasChanges=!1}constructor(e,t,n){super(),this.storageService=e,this.configurationService=t,this.logService=n,this.configuredCommandsHistoryLength=0,this.updateConfiguration(),this.load(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.updateConfiguration(e))),this._register(this.storageService.onWillSaveState(e=>{e.reason===Ne.SHUTDOWN&&this.saveState()}))}updateConfiguration(e){e&&!e.affectsConfiguration(`workbench.commandPalette.history`)||(this.configuredCommandsHistoryLength=dV.getConfiguredCommandHistoryLength(this.configurationService),dV.cache&&dV.cache.limit!==this.configuredCommandsHistoryLength&&(dV.cache.limit=this.configuredCommandsHistoryLength,dV.hasChanges=!0))}load(){let e=this.storageService.get(dV.PREF_KEY_CACHE,0),t;if(e)try{t=JSON.parse(e)}catch(e){this.logService.error(`[CommandsHistory] invalid data: ${e}`)}let n=dV.cache=new ti(this.configuredCommandsHistoryLength,1);if(t){let e;e=t.usesLRU?t.entries:t.entries.sort((e,t)=>e.value-t.value),e.forEach(e=>n.set(e.key,e.value))}dV.counter=this.storageService.getNumber(dV.PREF_KEY_COUNTER,0,dV.counter)}push(e){dV.cache&&(dV.cache.set(e,dV.counter++),dV.hasChanges=!0)}peek(e){return dV.cache?.peek(e)}saveState(){if(!dV.cache||!dV.hasChanges)return;let e={usesLRU:!0,entries:[]};dV.cache.forEach((t,n)=>e.entries.push({key:n,value:t})),this.storageService.store(dV.PREF_KEY_CACHE,JSON.stringify(e),0,0),this.storageService.store(dV.PREF_KEY_COUNTER,dV.counter,0,0),dV.hasChanges=!1}static getConfiguredCommandHistoryLength(e){let t=e.getValue().workbench?.commandPalette?.history;return typeof t==`number`?t:dV.DEFAULT_COMMANDS_HISTORY_LENGTH}};pV=dV=cV([lV(0,Qr),lV(1,hn),lV(2,Wl)],pV);var mV=class extends fV{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a)}getCodeEditorCommandPicks(){let e=this.activeTextEditorControl;if(!e)return[];let t=[];for(let n of e.getSupportedActions()){let e;n.metadata?.description&&(e=Ki(n.metadata.description)?n.metadata.description:{original:n.metadata.description,value:n.metadata.description}),t.push({commandId:n.id,commandAlias:n.alias,commandDescription:e,label:Tn(n.label)||n.id})}return t}},hV=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gV=function(e,t){return function(n,r){t(n,r,e)}},_V=class extends mV{get activeTextEditorControl(){return this.codeEditorService.getFocusedCodeEditor()??void 0}constructor(e,t,n,r,i,a){super({showAlias:!1},e,n,r,i,a),this.codeEditorService=t}async getCommandPicks(){return this.getCodeEditorCommandPicks()}hasAdditionalCommandPicks(){return!1}async getAdditionalCommandPicks(){return[]}};_V=hV([gV(0,k),gV(1,xl),gV(2,Yt),gV(3,Te),gV(4,Fu),gV(5,cl)],_V);var vV=class e extends R{static{this.ID=`editor.action.quickCommand`}constructor(){super({id:e.ID,label:Ro.quickCommandActionLabel,alias:`Command Palette`,precondition:void 0,kbOpts:{kbExpr:y.focus,primary:59,weight:100},contextMenuOpts:{group:`z_commands`,order:1}})}run(e){e.get(Mu).quickAccess.show(_V.PREFIX)}};q(vV),br.as(Je.Quickaccess).registerQuickAccessProvider({ctor:_V,prefix:_V.PREFIX,helpEntries:[{description:Ro.quickCommandHelp,commandId:vV.ID}]});var yV=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bV=function(e,t){return function(n,r){t(n,r,e)}},xV=class extends nb{constructor(e,t,n,r,i,a,o){super(!0,e,t,n,r,i,a,o)}};xV=yV([bV(1,On),bV(2,xl),bV(3,Ur),bV(4,k),bV(5,Qr),bV(6,hn)],xV),K(nb.ID,xV,4),q(class extends R{constructor(){super({id:`editor.action.toggleHighContrast`,label:Al.toggleHighContrast,alias:`Toggle High Contrast Theme`,precondition:void 0}),this._originalThemeName=null}run(e,t){let n=e.get(Ji),r=n.getColorTheme();ce(r.type)?(n.setTheme(this._originalThemeName||(nc(r.type)?`vs-dark`:`vs`)),this._originalThemeName=null):(n.setTheme(nc(r.type)?_a:Cr),this._originalThemeName=r.themeName)}});var SV=d({CancellationTokenSource:()=>ql,Emitter:()=>Mc,KeyCode:()=>wl,KeyMod:()=>Os,MarkerSeverity:()=>Va,MarkerTag:()=>Uc,Position:()=>Fl,Range:()=>uo,Selection:()=>uc,SelectionDirection:()=>iu,Token:()=>So,Uri:()=>Wo,editor:()=>tl,languages:()=>gs}),CV=Object.defineProperty,wV=Object.getOwnPropertyDescriptor,TV=Object.getOwnPropertyNames,EV=Object.prototype.hasOwnProperty,DV=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of TV(t))!EV.call(e,i)&&i!==n&&CV(e,i,{get:()=>t[i],enumerable:!(r=wV(t,i))||r.enumerable});return e},OV=(e,t,n)=>(DV(e,t,`default`),n&&DV(n,t,`default`)),kV={};OV(kV,xc);var AV={},jV={},MV=class e{static getOrCreate(t){return jV[t]||(jV[t]=new e(t)),jV[t]}constructor(e){this._languageId=e,this._loadingTriggered=!1,this._lazyLoadPromise=new Promise((e,t)=>{this._lazyLoadPromiseResolve=e,this._lazyLoadPromiseReject=t})}load(){return this._loadingTriggered||(this._loadingTriggered=!0,AV[this._languageId].loader().then(e=>this._lazyLoadPromiseResolve(e),e=>this._lazyLoadPromiseReject(e))),this._lazyLoadPromise}};function $(e){let t=e.id;AV[t]=e,kV.languages.register(e);let n=MV.getOrCreate(t);kV.languages.registerTokensProviderFactory(t,{create:async()=>(await n.load()).language}),kV.languages.onLanguageEncountered(t,async()=>{let e=await n.load();kV.languages.setLanguageConfiguration(t,e.conf)})}$({id:`abap`,extensions:[`.abap`],aliases:[`abap`,`ABAP`],loader:()=>f(()=>import(`./abap-BxTDLPEo.js`),[],import.meta.url)}),$({id:`apex`,extensions:[`.cls`],aliases:[`Apex`,`apex`],mimetypes:[`text/x-apex-source`,`text/x-apex`],loader:()=>f(()=>import(`./apex-i2-ZU0Iw.js`),[],import.meta.url)}),$({id:`azcli`,extensions:[`.azcli`],aliases:[`Azure CLI`,`azcli`],loader:()=>f(()=>import(`./azcli-CgMBKRMB.js`),[],import.meta.url)}),$({id:`bat`,extensions:[`.bat`,`.cmd`],aliases:[`Batch`,`bat`],loader:()=>f(()=>import(`./bat-DSkyvFA-.js`),[],import.meta.url)}),$({id:`bicep`,extensions:[`.bicep`],aliases:[`Bicep`],loader:()=>f(()=>import(`./bicep-CiatMSp3.js`),[],import.meta.url)}),$({id:`cameligo`,extensions:[`.mligo`],aliases:[`Cameligo`],loader:()=>f(()=>import(`./cameligo-DJDGHaV3.js`),[],import.meta.url)}),$({id:`clojure`,extensions:[`.clj`,`.cljs`,`.cljc`,`.edn`],aliases:[`clojure`,`Clojure`],loader:()=>f(()=>import(`./clojure-omRoH8IK.js`),[],import.meta.url)}),$({id:`coffeescript`,extensions:[`.coffee`],aliases:[`CoffeeScript`,`coffeescript`,`coffee`],mimetypes:[`text/x-coffeescript`,`text/coffeescript`],loader:()=>f(()=>import(`./coffee-C22wzVqn.js`),[],import.meta.url)}),$({id:`c`,extensions:[`.c`,`.h`],aliases:[`C`,`c`],loader:()=>f(()=>import(`./cpp-Cgo1Wzp9.js`),[],import.meta.url)}),$({id:`cpp`,extensions:[`.cpp`,`.cc`,`.cxx`,`.hpp`,`.hh`,`.hxx`],aliases:[`C++`,`Cpp`,`cpp`],loader:()=>f(()=>import(`./cpp-Cgo1Wzp9.js`),[],import.meta.url)}),$({id:`csharp`,extensions:[`.cs`,`.csx`,`.cake`],aliases:[`C#`,`csharp`],loader:()=>f(()=>import(`./csharp-C6luVNoY.js`),[],import.meta.url)}),$({id:`csp`,extensions:[`.csp`],aliases:[`CSP`,`csp`],loader:()=>f(()=>import(`./csp-BDiFAUwX.js`),[],import.meta.url)}),$({id:`css`,extensions:[`.css`],aliases:[`CSS`,`css`],mimetypes:[`text/css`],loader:()=>f(()=>import(`./css-BVKG1TyL.js`),[],import.meta.url)}),$({id:`cypher`,extensions:[`.cypher`,`.cyp`],aliases:[`Cypher`,`OpenCypher`],loader:()=>f(()=>import(`./cypher-Cg5q1mT7.js`),[],import.meta.url)}),$({id:`dart`,extensions:[`.dart`],aliases:[`Dart`,`dart`],mimetypes:[`text/x-dart-source`,`text/x-dart`],loader:()=>f(()=>import(`./dart-Czze8Rbm.js`),[],import.meta.url)}),$({id:`dockerfile`,extensions:[`.dockerfile`],filenames:[`Dockerfile`],aliases:[`Dockerfile`],loader:()=>f(()=>import(`./dockerfile-BLaClzQJ.js`),[],import.meta.url)}),$({id:`ecl`,extensions:[`.ecl`],aliases:[`ECL`,`Ecl`,`ecl`],loader:()=>f(()=>import(`./ecl-DP5JGxwu.js`),[],import.meta.url)}),$({id:`elixir`,extensions:[`.ex`,`.exs`],aliases:[`Elixir`,`elixir`,`ex`],loader:()=>f(()=>import(`./elixir-Dy0Uy0tn.js`),[],import.meta.url)}),$({id:`flow9`,extensions:[`.flow`],aliases:[`Flow9`,`Flow`,`flow9`,`flow`],loader:()=>f(()=>import(`./flow9-ySGzxKql.js`),[],import.meta.url)}),$({id:`fsharp`,extensions:[`.fs`,`.fsi`,`.ml`,`.mli`,`.fsx`,`.fsscript`],aliases:[`F#`,`FSharp`,`fsharp`],loader:()=>f(()=>import(`./fsharp-BdHGCb0z.js`),[],import.meta.url)}),$({id:`freemarker2`,extensions:[`.ftl`,`.ftlh`,`.ftlx`],aliases:[`FreeMarker2`,`Apache FreeMarker2`],loader:()=>f(()=>import(`./freemarker2-DWNK8h2Y.js`),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>e.TagAutoInterpolationDollar)}),$({id:`freemarker2.tag-angle.interpolation-dollar`,aliases:[`FreeMarker2 (Angle/Dollar)`,`Apache FreeMarker2 (Angle/Dollar)`],loader:()=>f(()=>import(`./freemarker2-DWNK8h2Y.js`),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>e.TagAngleInterpolationDollar)}),$({id:`freemarker2.tag-bracket.interpolation-dollar`,aliases:[`FreeMarker2 (Bracket/Dollar)`,`Apache FreeMarker2 (Bracket/Dollar)`],loader:()=>f(()=>import(`./freemarker2-DWNK8h2Y.js`),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>e.TagBracketInterpolationDollar)}),$({id:`freemarker2.tag-angle.interpolation-bracket`,aliases:[`FreeMarker2 (Angle/Bracket)`,`Apache FreeMarker2 (Angle/Bracket)`],loader:()=>f(()=>import(`./freemarker2-DWNK8h2Y.js`),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>e.TagAngleInterpolationBracket)}),$({id:`freemarker2.tag-bracket.interpolation-bracket`,aliases:[`FreeMarker2 (Bracket/Bracket)`,`Apache FreeMarker2 (Bracket/Bracket)`],loader:()=>f(()=>import(`./freemarker2-DWNK8h2Y.js`),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>e.TagBracketInterpolationBracket)}),$({id:`freemarker2.tag-auto.interpolation-dollar`,aliases:[`FreeMarker2 (Auto/Dollar)`,`Apache FreeMarker2 (Auto/Dollar)`],loader:()=>f(()=>import(`./freemarker2-DWNK8h2Y.js`),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>e.TagAutoInterpolationDollar)}),$({id:`freemarker2.tag-auto.interpolation-bracket`,aliases:[`FreeMarker2 (Auto/Bracket)`,`Apache FreeMarker2 (Auto/Bracket)`],loader:()=>f(()=>import(`./freemarker2-DWNK8h2Y.js`),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>e.TagAutoInterpolationBracket)}),$({id:`go`,extensions:[`.go`],aliases:[`Go`],loader:()=>f(()=>import(`./go-D9Kmq0uW.js`),[],import.meta.url)}),$({id:`graphql`,extensions:[`.graphql`,`.gql`],aliases:[`GraphQL`,`graphql`,`gql`],mimetypes:[`application/graphql`],loader:()=>f(()=>import(`./graphql-DcAcgMbq.js`),[],import.meta.url)}),$({id:`handlebars`,extensions:[`.handlebars`,`.hbs`],aliases:[`Handlebars`,`handlebars`,`hbs`],mimetypes:[`text/x-handlebars-template`],loader:()=>f(()=>import(`./handlebars-DaiFdHQQ.js`),__vite__mapDeps([5,1,2,3,4]),import.meta.url)}),$({id:`hcl`,extensions:[`.tf`,`.tfvars`,`.hcl`],aliases:[`Terraform`,`tf`,`HCL`,`hcl`],loader:()=>f(()=>import(`./hcl-lM4ndxtF.js`),[],import.meta.url)}),$({id:`html`,extensions:[`.html`,`.htm`,`.shtml`,`.xhtml`,`.mdoc`,`.jsp`,`.asp`,`.aspx`,`.jshtm`],aliases:[`HTML`,`htm`,`html`,`xhtml`],mimetypes:[`text/html`,`text/x-jshtm`,`text/template`,`text/ng-template`],loader:()=>f(()=>import(`./html-L6-wg7Wu.js`),__vite__mapDeps([6,1,2,3,4]),import.meta.url)}),$({id:`ini`,extensions:[`.ini`,`.properties`,`.gitconfig`],filenames:[`config`,`.gitattributes`,`.gitconfig`,`.editorconfig`],aliases:[`Ini`,`ini`],loader:()=>f(()=>import(`./ini-0WVGEeVo.js`),[],import.meta.url)}),$({id:`java`,extensions:[`.java`,`.jav`],aliases:[`Java`,`java`],mimetypes:[`text/x-java-source`,`text/x-java`],loader:()=>f(()=>import(`./java-D26038rx.js`),[],import.meta.url)}),$({id:`javascript`,extensions:[`.js`,`.es6`,`.jsx`,`.mjs`,`.cjs`],firstLine:`^#!.*\\bnode`,filenames:[`jakefile`],aliases:[`JavaScript`,`javascript`,`js`],mimetypes:[`text/javascript`],loader:()=>f(()=>import(`./javascript-Z6-NWV1A.js`),__vite__mapDeps([7,1,2,3,4,8]),import.meta.url)}),$({id:`julia`,extensions:[`.jl`],aliases:[`julia`,`Julia`],loader:()=>f(()=>import(`./julia-B3_SBenA.js`),[],import.meta.url)}),$({id:`kotlin`,extensions:[`.kt`,`.kts`],aliases:[`Kotlin`,`kotlin`],mimetypes:[`text/x-kotlin-source`,`text/x-kotlin`],loader:()=>f(()=>import(`./kotlin-DSzrmGB2.js`),[],import.meta.url)}),$({id:`less`,extensions:[`.less`],aliases:[`Less`,`less`],mimetypes:[`text/x-less`,`text/less`],loader:()=>f(()=>import(`./less-D1SSVYG9.js`),[],import.meta.url)}),$({id:`lexon`,extensions:[`.lex`],aliases:[`Lexon`],loader:()=>f(()=>import(`./lexon-BwT7lspy.js`),[],import.meta.url)}),$({id:`lua`,extensions:[`.lua`],aliases:[`Lua`,`lua`],loader:()=>f(()=>import(`./lua-CSDA-YQX.js`),[],import.meta.url)}),$({id:`liquid`,extensions:[`.liquid`,`.html.liquid`],aliases:[`Liquid`,`liquid`],mimetypes:[`application/liquid`],loader:()=>f(()=>import(`./liquid-kssafRJQ.js`),__vite__mapDeps([9,1,2,3,4]),import.meta.url)}),$({id:`m3`,extensions:[`.m3`,`.i3`,`.mg`,`.ig`],aliases:[`Modula-3`,`Modula3`,`modula3`,`m3`],loader:()=>f(()=>import(`./m3-74RbrBCp.js`),[],import.meta.url)}),$({id:`markdown`,extensions:[`.md`,`.markdown`,`.mdown`,`.mkdn`,`.mkd`,`.mdwn`,`.mdtxt`,`.mdtext`],aliases:[`Markdown`,`markdown`],loader:()=>f(()=>import(`./markdown-4_DAgS1i.js`),[],import.meta.url)}),$({id:`mdx`,extensions:[`.mdx`],aliases:[`MDX`,`mdx`],loader:()=>f(()=>import(`./mdx-D_bsT8UI.js`),__vite__mapDeps([10,1,2,3,4]),import.meta.url)}),$({id:`mips`,extensions:[`.s`],aliases:[`MIPS`,`MIPS-V`],mimetypes:[`text/x-mips`,`text/mips`,`text/plaintext`],loader:()=>f(()=>import(`./mips-RPID7v_5.js`),[],import.meta.url)}),$({id:`msdax`,extensions:[`.dax`,`.msdax`],aliases:[`DAX`,`MSDAX`],loader:()=>f(()=>import(`./msdax-CyEhPSU3.js`),[],import.meta.url)}),$({id:`mysql`,extensions:[],aliases:[`MySQL`,`mysql`],loader:()=>f(()=>import(`./mysql-DteGNfQ1.js`),[],import.meta.url)}),$({id:`objective-c`,extensions:[`.m`],aliases:[`Objective-C`],loader:()=>f(()=>import(`./objective-c-Da95tKwm.js`),[],import.meta.url)}),$({id:`pascal`,extensions:[`.pas`,`.p`,`.pp`],aliases:[`Pascal`,`pas`],mimetypes:[`text/x-pascal-source`,`text/x-pascal`],loader:()=>f(()=>import(`./pascal-RGJh3ZCi.js`),[],import.meta.url)}),$({id:`pascaligo`,extensions:[`.ligo`],aliases:[`Pascaligo`,`ligo`],loader:()=>f(()=>import(`./pascaligo-BEUTwn38.js`),[],import.meta.url)}),$({id:`perl`,extensions:[`.pl`,`.pm`],aliases:[`Perl`,`pl`],loader:()=>f(()=>import(`./perl-9Z6EVKi8.js`),[],import.meta.url)}),$({id:`pgsql`,extensions:[],aliases:[`PostgreSQL`,`postgres`,`pg`,`postgre`],loader:()=>f(()=>import(`./pgsql-DX4_oZs8.js`),[],import.meta.url)}),$({id:`php`,extensions:[`.php`,`.php4`,`.php5`,`.phtml`,`.ctp`],aliases:[`PHP`,`php`],mimetypes:[`application/x-php`],loader:()=>f(()=>import(`./php-Ci8C8NRk.js`),[],import.meta.url)}),$({id:`pla`,extensions:[`.pla`],loader:()=>f(()=>import(`./pla-DAvJn9O3.js`),[],import.meta.url)}),$({id:`postiats`,extensions:[`.dats`,`.sats`,`.hats`],aliases:[`ATS`,`ATS/Postiats`],loader:()=>f(()=>import(`./postiats-BFAA3V92.js`),[],import.meta.url)}),$({id:`powerquery`,extensions:[`.pq`,`.pqm`],aliases:[`PQ`,`M`,`Power Query`,`Power Query M`],loader:()=>f(()=>import(`./powerquery-3Wl9cIqh.js`),[],import.meta.url)}),$({id:`powershell`,extensions:[`.ps1`,`.psm1`,`.psd1`],aliases:[`PowerShell`,`powershell`,`ps`,`ps1`],loader:()=>f(()=>import(`./powershell-CZXiSMFR.js`),[],import.meta.url)}),$({id:`proto`,extensions:[`.proto`],aliases:[`protobuf`,`Protocol Buffers`],loader:()=>f(()=>import(`./protobuf-1ZvVbRWz.js`),[],import.meta.url)}),$({id:`pug`,extensions:[`.jade`,`.pug`],aliases:[`Pug`,`Jade`,`jade`],loader:()=>f(()=>import(`./pug-Ndj6Vz5x.js`),[],import.meta.url)}),$({id:`python`,extensions:[`.py`,`.rpy`,`.pyw`,`.cpy`,`.gyp`,`.gypi`],aliases:[`Python`,`py`],firstLine:`^#!/.*\\bpython[0-9.-]*\\b`,loader:()=>f(()=>import(`./python-BkvP4oVx.js`),__vite__mapDeps([11,1,2,3,4]),import.meta.url)}),$({id:`qsharp`,extensions:[`.qs`],aliases:[`Q#`,`qsharp`],loader:()=>f(()=>import(`./qsharp-vWzKKYoC.js`),[],import.meta.url)}),$({id:`r`,extensions:[`.r`,`.rhistory`,`.rmd`,`.rprofile`,`.rt`],aliases:[`R`,`r`],loader:()=>f(()=>import(`./r-NOyx2C5-.js`),[],import.meta.url)}),$({id:`razor`,extensions:[`.cshtml`],aliases:[`Razor`,`razor`],mimetypes:[`text/x-cshtml`],loader:()=>f(()=>import(`./razor-Jg-R2qWX.js`),__vite__mapDeps([12,1,2,3,4]),import.meta.url)}),$({id:`redis`,extensions:[`.redis`],aliases:[`redis`],loader:()=>f(()=>import(`./redis-Bb7T7jCE.js`),[],import.meta.url)}),$({id:`redshift`,extensions:[],aliases:[`Redshift`,`redshift`],loader:()=>f(()=>import(`./redshift-GITjDoXQ.js`),[],import.meta.url)}),$({id:`restructuredtext`,extensions:[`.rst`],aliases:[`reStructuredText`,`restructuredtext`],loader:()=>f(()=>import(`./restructuredtext-DawPHt-G.js`),[],import.meta.url)}),$({id:`ruby`,extensions:[`.rb`,`.rbx`,`.rjs`,`.gemspec`,`.pp`],filenames:[`rakefile`,`Gemfile`],aliases:[`Ruby`,`rb`],loader:()=>f(()=>import(`./ruby-BW6hE4cm.js`),[],import.meta.url)}),$({id:`rust`,extensions:[`.rs`,`.rlib`],aliases:[`Rust`,`rust`],loader:()=>f(()=>import(`./rust-B-kGjn9K.js`),[],import.meta.url)}),$({id:`sb`,extensions:[`.sb`],aliases:[`Small Basic`,`sb`],loader:()=>f(()=>import(`./sb-BPbtcMlf.js`),[],import.meta.url)}),$({id:`scala`,extensions:[`.scala`,`.sc`,`.sbt`],aliases:[`Scala`,`scala`,`SBT`,`Sbt`,`sbt`,`Dotty`,`dotty`],mimetypes:[`text/x-scala-source`,`text/x-scala`,`text/x-sbt`,`text/x-dotty`],loader:()=>f(()=>import(`./scala-DPlwKg1n.js`),[],import.meta.url)}),$({id:`scheme`,extensions:[`.scm`,`.ss`,`.sch`,`.rkt`],aliases:[`scheme`,`Scheme`],loader:()=>f(()=>import(`./scheme-79Z2p2kJ.js`),[],import.meta.url)}),$({id:`scss`,extensions:[`.scss`],aliases:[`Sass`,`sass`,`scss`],mimetypes:[`text/x-scss`,`text/scss`],loader:()=>f(()=>import(`./scss-Bsk7m8Cp.js`),[],import.meta.url)}),$({id:`shell`,extensions:[`.sh`,`.bash`],aliases:[`Shell`,`sh`],loader:()=>f(()=>import(`./shell-DUa0jIID.js`),[],import.meta.url)}),$({id:`sol`,extensions:[`.sol`],aliases:[`sol`,`solidity`,`Solidity`],loader:()=>f(()=>import(`./solidity-CQfwUVk0.js`),[],import.meta.url)}),$({id:`aes`,extensions:[`.aes`],aliases:[`aes`,`sophia`,`Sophia`],loader:()=>f(()=>import(`./sophia-DNu14VMV.js`),[],import.meta.url)}),$({id:`sparql`,extensions:[`.rq`],aliases:[`sparql`,`SPARQL`],loader:()=>f(()=>import(`./sparql-BOm5ntp8.js`),[],import.meta.url)}),$({id:`sql`,extensions:[`.sql`],aliases:[`SQL`],loader:()=>f(()=>import(`./sql-DEImmmDE.js`),[],import.meta.url)}),$({id:`st`,extensions:[`.st`,`.iecst`,`.iecplc`,`.lc3lib`,`.TcPOU`,`.TcDUT`,`.TcGVL`,`.TcIO`],aliases:[`StructuredText`,`scl`,`stl`],loader:()=>f(()=>import(`./st-Bl4F9o2z.js`),[],import.meta.url)}),$({id:`swift`,aliases:[`Swift`,`swift`],extensions:[`.swift`],mimetypes:[`text/swift`],loader:()=>f(()=>import(`./swift-Bw2hRu97.js`),[],import.meta.url)}),$({id:`systemverilog`,extensions:[`.sv`,`.svh`],aliases:[`SV`,`sv`,`SystemVerilog`,`systemverilog`],loader:()=>f(()=>import(`./systemverilog-BKDDL_Hj.js`),[],import.meta.url)}),$({id:`verilog`,extensions:[`.v`,`.vh`],aliases:[`V`,`v`,`Verilog`,`verilog`],loader:()=>f(()=>import(`./systemverilog-BKDDL_Hj.js`),[],import.meta.url)}),$({id:`tcl`,extensions:[`.tcl`],aliases:[`tcl`,`Tcl`,`tcltk`,`TclTk`,`tcl/tk`,`Tcl/Tk`],loader:()=>f(()=>import(`./tcl-BQP_0vdy.js`),[],import.meta.url)}),$({id:`twig`,extensions:[`.twig`],aliases:[`Twig`,`twig`],mimetypes:[`text/x-twig`],loader:()=>f(()=>import(`./twig-33Scpkkt.js`),[],import.meta.url)}),$({id:`typescript`,extensions:[`.ts`,`.tsx`,`.cts`,`.mts`],aliases:[`TypeScript`,`ts`,`typescript`],mimetypes:[`text/typescript`],loader:()=>f(()=>import(`./typescript-FbkqV4Jg.js`),__vite__mapDeps([13,1,2,3,4,8]),import.meta.url)}),$({id:`typespec`,extensions:[`.tsp`],aliases:[`TypeSpec`],loader:()=>f(()=>import(`./typespec-BU7naJO3.js`),[],import.meta.url)}),$({id:`vb`,extensions:[`.vb`],aliases:[`Visual Basic`,`vb`],loader:()=>f(()=>import(`./vb-CGdhi5ri.js`),[],import.meta.url)}),$({id:`wgsl`,extensions:[`.wgsl`],aliases:[`WebGPU Shading Language`,`WGSL`,`wgsl`],loader:()=>f(()=>import(`./wgsl-3KmLLj69.js`),[],import.meta.url)}),$({id:`xml`,extensions:[`.xml`,`.xsd`,`.dtd`,`.ascx`,`.csproj`,`.config`,`.props`,`.targets`,`.wxi`,`.wxl`,`.wxs`,`.xaml`,`.svg`,`.svgz`,`.opf`,`.xslt`,`.xsl`],firstLine:`(\\<\\?xml.*)|(\\<svg)|(\\<\\!doctype\\s+svg)`,aliases:[`XML`,`xml`],mimetypes:[`text/xml`,`application/xml`,`application/xaml+xml`,`application/xml-dtd`],loader:()=>f(()=>import(`./xml-x1REfXKD.js`),__vite__mapDeps([14,1,2,3,4]),import.meta.url)}),$({id:`yaml`,extensions:[`.yaml`,`.yml`],aliases:[`YAML`,`yaml`,`YML`,`yml`],mimetypes:[`application/x-yaml`,`text/x-yaml`],loader:()=>f(()=>import(`./yaml-B4nWhTtk.js`),__vite__mapDeps([15,1,2,3,4]),import.meta.url)});
/*!-----------------------------------------------------------------------------
* Copyright (c) Microsoft Corporation. All rights reserved.
* Version: 0.54.0(7c2310116c57517348bbd868a21139f32454be22)
* Released under the MIT license
* https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
*-----------------------------------------------------------------------------*/
var NV=Object.defineProperty,PV=Object.getOwnPropertyDescriptor,FV=Object.getOwnPropertyNames,IV=Object.prototype.hasOwnProperty,LV=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of FV(t))!IV.call(e,i)&&i!==n&&NV(e,i,{get:()=>t[i],enumerable:!(r=PV(t,i))||r.enumerable});return e},RV=(e,t,n)=>(LV(e,t,`default`),n&&LV(n,t,`default`)),zV={};RV(zV,xc);var BV=class{constructor(e,t,n){this._onDidChange=new zV.Emitter,this._languageId=e,this.setOptions(t),this.setModeConfiguration(n)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get modeConfiguration(){return this._modeConfiguration}get diagnosticsOptions(){return this.options}get options(){return this._options}setOptions(e){this._options=e||Object.create(null),this._onDidChange.fire(this)}setDiagnosticsOptions(e){this.setOptions(e)}setModeConfiguration(e){this._modeConfiguration=e||Object.create(null),this._onDidChange.fire(this)}},VV={validate:!0,lint:{compatibleVendorPrefixes:`ignore`,vendorPrefix:`warning`,duplicateProperties:`warning`,emptyRules:`warning`,importStatement:`ignore`,boxModel:`ignore`,universalSelector:`ignore`,zeroUnits:`ignore`,fontFaceProperties:`warning`,hexColorLength:`error`,argumentsInColorFunction:`error`,unknownProperties:`warning`,ieHack:`ignore`,unknownVendorSpecificProperties:`ignore`,propertyIgnoredDueToDisplay:`warning`,important:`ignore`,float:`ignore`,idSelector:`ignore`},data:{useDefaultDataProvider:!0},format:{newlineBetweenSelectors:!0,newlineBetweenRules:!0,spaceAroundSelectorSeparator:!1,braceStyle:`collapse`,maxPreserveNewLines:void 0,preserveNewLines:!0}},HV={completionItems:!0,hovers:!0,documentSymbols:!0,definitions:!0,references:!0,documentHighlights:!0,rename:!0,colors:!0,foldingRanges:!0,diagnostics:!0,selectionRanges:!0,documentFormattingEdits:!0,documentRangeFormattingEdits:!0},UV=new BV(`css`,VV,HV),WV=new BV(`scss`,VV,HV),GV=new BV(`less`,VV,HV);zV.languages.css={cssDefaults:UV,lessDefaults:GV,scssDefaults:WV};function KV(){return f(()=>import(`./cssMode-DIF0dc_9.js`),__vite__mapDeps([16,1,2,3,4]),import.meta.url)}zV.languages.onLanguage(`less`,()=>{KV().then(e=>e.setupMode(GV))}),zV.languages.onLanguage(`scss`,()=>{KV().then(e=>e.setupMode(WV))}),zV.languages.onLanguage(`css`,()=>{KV().then(e=>e.setupMode(UV))});
/*!-----------------------------------------------------------------------------
* Copyright (c) Microsoft Corporation. All rights reserved.
* Version: 0.54.0(7c2310116c57517348bbd868a21139f32454be22)
* Released under the MIT license
* https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
*-----------------------------------------------------------------------------*/
var qV=Object.defineProperty,JV=Object.getOwnPropertyDescriptor,YV=Object.getOwnPropertyNames,XV=Object.prototype.hasOwnProperty,ZV=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of YV(t))!XV.call(e,i)&&i!==n&&qV(e,i,{get:()=>t[i],enumerable:!(r=JV(t,i))||r.enumerable});return e},QV=(e,t,n)=>(ZV(e,t,`default`),n&&ZV(n,t,`default`)),$V={};QV($V,xc);var eH=class{constructor(e,t,n){this._onDidChange=new $V.Emitter,this._languageId=e,this.setOptions(t),this.setModeConfiguration(n)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get options(){return this._options}get modeConfiguration(){return this._modeConfiguration}setOptions(e){this._options=e||Object.create(null),this._onDidChange.fire(this)}setModeConfiguration(e){this._modeConfiguration=e||Object.create(null),this._onDidChange.fire(this)}},tH={format:{tabSize:4,insertSpaces:!1,wrapLineLength:120,unformatted:`default": "a, abbr, acronym, b, bdo, big, br, button, cite, code, dfn, em, i, img, input, kbd, label, map, object, q, samp, select, small, span, strong, sub, sup, textarea, tt, var`,contentUnformatted:`pre`,indentInnerHtml:!1,preserveNewLines:!0,maxPreserveNewLines:void 0,indentHandlebars:!1,endWithNewline:!1,extraLiners:`head, body, /html`,wrapAttributes:`auto`},suggest:{},data:{useDefaultDataProvider:!0}};function nH(e){return{completionItems:!0,hovers:!0,documentSymbols:!0,links:!0,documentHighlights:!0,rename:!0,colors:!0,foldingRanges:!0,selectionRanges:!0,diagnostics:e===rH,documentFormattingEdits:e===rH,documentRangeFormattingEdits:e===rH}}var rH=`html`,iH=`handlebars`,aH=`razor`,oH=pH(rH,tH,nH(rH)),sH=oH.defaults,cH=pH(iH,tH,nH(iH)),lH=cH.defaults,uH=pH(aH,tH,nH(aH)),dH=uH.defaults;$V.languages.html={htmlDefaults:sH,razorDefaults:dH,handlebarDefaults:lH,htmlLanguageService:oH,handlebarLanguageService:cH,razorLanguageService:uH,registerHTMLLanguageService:pH};function fH(){return f(()=>import(`./htmlMode-B1hD6-oV.js`),__vite__mapDeps([17,1,2,3,4]),import.meta.url)}function pH(e,t=tH,n=nH(e)){let r=new eH(e,t,n),i,a=$V.languages.onLanguage(e,async()=>{i=(await fH()).setupMode(r)});return{defaults:r,dispose(){a.dispose(),i?.dispose(),i=void 0}}}
/*!-----------------------------------------------------------------------------
* Copyright (c) Microsoft Corporation. All rights reserved.
* Version: 0.54.0(7c2310116c57517348bbd868a21139f32454be22)
* Released under the MIT license
* https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
*-----------------------------------------------------------------------------*/
var mH=Object.defineProperty,hH=Object.getOwnPropertyDescriptor,gH=Object.getOwnPropertyNames,_H=Object.prototype.hasOwnProperty,vH=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of gH(t))!_H.call(e,i)&&i!==n&&mH(e,i,{get:()=>t[i],enumerable:!(r=hH(t,i))||r.enumerable});return e},yH=(e,t,n)=>(vH(e,t,`default`),n&&vH(n,t,`default`)),bH={};yH(bH,xc);var xH=new class{constructor(e,t,n){this._onDidChange=new bH.Emitter,this._languageId=e,this.setDiagnosticsOptions(t),this.setModeConfiguration(n)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get modeConfiguration(){return this._modeConfiguration}get diagnosticsOptions(){return this._diagnosticsOptions}setDiagnosticsOptions(e){this._diagnosticsOptions=e||Object.create(null),this._onDidChange.fire(this)}setModeConfiguration(e){this._modeConfiguration=e||Object.create(null),this._onDidChange.fire(this)}}(`json`,{validate:!0,allowComments:!0,schemas:[],enableSchemaRequest:!1,schemaRequest:`warning`,schemaValidation:`warning`,comments:`error`,trailingCommas:`error`},{documentFormattingEdits:!0,documentRangeFormattingEdits:!0,completionItems:!0,hovers:!0,documentSymbols:!0,tokens:!0,colors:!0,foldingRanges:!0,diagnostics:!0,selectionRanges:!0}),SH=()=>CH().then(e=>e.getWorker());bH.languages.json={jsonDefaults:xH,getWorker:SH};function CH(){return f(()=>import(`./jsonMode-C4XadRpH.js`),__vite__mapDeps([18,1,2,3,4]),import.meta.url)}bH.languages.register({id:`json`,extensions:[`.json`,`.bowerrc`,`.jshintrc`,`.jscsrc`,`.eslintrc`,`.babelrc`,`.har`],aliases:[`JSON`,`json`],mimetypes:[`application/json`]}),bH.languages.onLanguage(`json`,()=>{CH().then(e=>e.setupMode(xH))});var wH=d({CancellationTokenSource:()=>ql,Emitter:()=>Mc,KeyCode:()=>wl,KeyMod:()=>Os,MarkerSeverity:()=>Va,MarkerTag:()=>Uc,Position:()=>Fl,Range:()=>uo,Selection:()=>uc,SelectionDirection:()=>iu,Token:()=>So,Uri:()=>Wo,editor:()=>tl,languages:()=>gs}),TH=Object.defineProperty,EH=Object.getOwnPropertyDescriptor,DH=Object.getOwnPropertyNames,OH=Object.prototype.hasOwnProperty,kH=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of DH(t))!OH.call(e,i)&&i!==n&&TH(e,i,{get:()=>t[i],enumerable:!(r=EH(t,i))||r.enumerable});return e},AH=(e,t,n)=>(kH(e,t,`default`),n&&kH(n,t,`default`)),jH={};AH(jH,SV);function MH(e,t){let n=globalThis.MonacoEnvironment;if(n?.createTrustedTypesPolicy)try{return n.createTrustedTypesPolicy(e,t)}catch(e){console.error(e);return}try{return globalThis.trustedTypes?.createPolicy(e,t)}catch(e){console.error(e);return}}var NH=typeof self==`object`&&self.constructor&&self.constructor.name===`DedicatedWorkerGlobalScope`&&globalThis.workerttPolicy!==void 0?globalThis.workerttPolicy:MH(`defaultWorkerFactory`,{createScriptURL:e=>e});function PH(e){let t=e.label,n=globalThis.MonacoEnvironment;if(n){if(typeof n.getWorker==`function`)return n.getWorker(`workerMain.js`,t);if(typeof n.getWorkerUrl==`function`){let e=n.getWorkerUrl(`workerMain.js`,t);return new Worker(NH?NH.createScriptURL(e):e,{name:t,type:`module`})}}throw Error(`You must define a function MonacoEnvironment.getWorkerUrl or MonacoEnvironment.getWorker`)}function FH(e){let t=Promise.resolve(PH({label:e.label??`monaco-editor-worker`,moduleId:e.moduleId})).then(t=>(t.postMessage(`ignore`),t.postMessage(e.createData),t));return jH.editor.createWebWorker({worker:t,host:e.host,keepIdleModels:e.keepIdleModels})}var IH=tl.createWebWorker;tl.createWebWorker=function(e){return e.worker===void 0?FH(e):IH(e)};function LH(e){return new Worker(``+new URL(`editor.worker-BCdqK6va.js`,import.meta.url).href,{name:e?.name})}function RH(e){return new Worker(``+new URL(`json.worker-Bmz_UeuT.js`,import.meta.url).href,{name:e?.name})}function zH(e){return new Worker(``+new URL(`css.worker-Bp4tJZMO.js`,import.meta.url).href,{name:e?.name})}function BH(e){return new Worker(``+new URL(`html.worker-DVbTOP0f.js`,import.meta.url).href,{name:e?.name})}function VH(e){return new Worker(``+new URL(`ts.worker-C7LOXJbd.js`,import.meta.url).href,{name:e?.name})}var HH=!1;typeof self<`u`&&(self.MonacoEnvironment={getWorker(e,t){return t===`json`?new RH:t===`css`||t===`scss`||t===`less`?new zH:t===`html`||t===`handlebars`||t===`razor`?new BH:t===`typescript`||t===`javascript`?new VH:new LH}}),kf.config({monaco:wH});async function UH(e){HH||(HH=!0,console.log(`  Monaco Editor...`),e.languages.typescript.typescriptDefaults.setCompilerOptions({target:e.languages.typescript.ScriptTarget.ES2020,allowNonTsExtensions:!0,moduleResolution:e.languages.typescript.ModuleResolutionKind.NodeJs,module:e.languages.typescript.ModuleKind.CommonJS,noEmit:!0,esModuleInterop:!0,allowJs:!0,typeRoots:[`node_modules/@types`]}),e.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),e.languages.typescript.typescriptDefaults.setEagerModelSync(!0),e.languages.typescript.javascriptDefaults.setCompilerOptions({target:e.languages.typescript.ScriptTarget.ES2020,allowNonTsExtensions:!0,allowJs:!0,checkJs:!0}),e.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),e.languages.typescript.javascriptDefaults.setEagerModelSync(!0),console.log(` Monaco Editor `),console.log(` TypeScript : checkJs=true, EagerModelSync=true`))}async function WH(){return await UH(wH),wH}var GH=i({__name:`CodeEditor`,props:{modelValue:{type:String,default:``},language:{type:String,default:`javascript`},readonly:{type:Boolean,default:!1},theme:{type:String,default:`vs`},options:{type:Object,default:()=>({})}},emits:[`update:modelValue`,`ready`],setup(e,{expose:n,emit:i}){let a=e,u=i,d=s(),f=null,p=null;async function m(){if(!d.value)return;p=await WH();let e=a.language===`typescript`?`ts`:a.language===`javascript`?`js`:a.language===`json`?`json`:a.language===`html`?`html`:a.language===`css`?`css`:`txt`,t=p.Uri.parse(`file:///editor-${Date.now()}.${e}`),n=p.editor.createModel(a.modelValue,a.language,t);console.log(` : ${t.toString()}, : ${a.language}`);let r={model:n,theme:a.theme,readOnly:a.readonly,automaticLayout:!0,minimap:{enabled:!0},scrollBeyondLastLine:!1,fontSize:14,fontWeight:`bold`,lineNumbers:`on`,roundedSelection:!1,scrollbar:{verticalScrollbarSize:10,horizontalScrollbarSize:10},tabSize:2,wordWrap:`off`,quickSuggestions:{other:`on`,comments:!1,strings:!1},parameterHints:{enabled:!0},suggestOnTriggerCharacters:!0,acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:`on`,wordBasedSuggestions:`allDocuments`,suggest:{showKeywords:!0,showSnippets:!0,showClasses:!0,showFunctions:!0,showVariables:!0,showModules:!0,showProperties:!0,showValues:!0,showConstants:!0,showMethods:!0}};f=p.editor.create(d.value,{...r,...a.options}),console.log(` `),f.onDidChangeModelContent(()=>{f&&u(`update:modelValue`,f.getValue())});let i=f.getDomNode();i&&(i.addEventListener(`wheel`,g,{passive:!1}),i.addEventListener(`keydown`,h,!0)),u(`ready`,f,p)}function h(e){f&&f?.hasTextFocus()&&e.key===` `&&e.stopPropagation()}function g(e){if(e.ctrlKey&&f){e.preventDefault();let t=f.getOption(p.editor.EditorOption.fontSize),n=e.deltaY>0?-1:1,r=Math.max(8,Math.min(30,t+n));f.updateOptions({fontSize:r})}}c(()=>a.modelValue,e=>{f&&f.getValue()!==e&&f.setValue(e)}),c(()=>a.language,e=>{if(f&&p){let t=f.getModel();t&&p.editor.setModelLanguage(t,e)}}),c(()=>a.theme,e=>{p&&p.editor.setTheme(e)}),c(()=>a.readonly,e=>{f&&f.updateOptions({readOnly:e})}),r(()=>{m()}),o(()=>{if(f){let e=f.getDomNode();e&&(e.removeEventListener(`wheel`,g),e.removeEventListener(`keydown`,h,!0));let t=f.getModel();f.dispose(),f=null,t&&t.dispose()}});function _(){return f}function ee(){return p}return n({getEditor:_,getMonaco:ee}),(e,n)=>(l(),t(`div`,{ref_key:`editorContainer`,ref:d,class:`w-full h-full`},null,512))}}),KH=yd(GH,[[`__scopeId`,`data-v-6e659b13`]]);export{KH as t};