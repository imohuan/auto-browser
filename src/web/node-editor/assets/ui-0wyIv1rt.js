import{$ as e,A as t,At as n,B as r,Ct as i,Dt as a,E as o,Et as s,F as c,H as l,J as u,M as d,Mt as f,N as p,O as m,P as h,Q as g,S as _,V as v,X as y,_t as b,at as x,b as S,bt as C,ct as w,dt as T,et as E,gt as D,it as O,j as k,k as A,kt as ee,lt as te,mt as ne,nt as re,q as ie,rt as j,st as ae,ut as M,v as oe,vt as se,wt as N,x as ce,xt as le,z as P}from"./index-BxA7zcD7.js";import{n as F,r as ue}from"./events-D1p43SY5.js";import{t as I}from"./_plugin-vue_export-helper-DEnkkObV.js";import{t as de}from"./IconChevronRight-pbfYoEdW.js";function fe(e,t){return oe(e,t)}var pe=fe;function me(e,t){return ne()?(b(e,t),!0):!1}var he=typeof window<`u`&&typeof document<`u`;typeof WorkerGlobalScope<`u`&&globalThis instanceof WorkerGlobalScope;var ge=e=>e!=null,_e=Object.prototype.toString,ve=e=>_e.call(e)===`[object Object]`,ye=()=>{},be=xe();function xe(){var e,t;return he&&((e=window)==null||(e=e.navigator)==null?void 0:e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((t=window)==null||(t=t.navigator)==null?void 0:t.maxTouchPoints)>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function Se(e){return Array.isArray(e)?e:[e]}function Ce(e,t,n){return w(e,t,{...n,immediate:!0})}function we(e,t,n){let r=w(e,(e,i,a)=>{e&&(n?.once&&u(()=>r()),t(e,i,a))},{...n,once:!1});return r}var Te=he?window:void 0;he&&window.document,he&&window.navigator,he&&window.location;function Ee(e){let t=N(e);return t?.$el??t}function De(...e){let t=[],n=()=>{t.forEach(e=>e()),t.length=0},r=(e,t,n,r)=>(e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)),i=k(()=>{let t=Se(N(e[0])).filter(e=>e!=null);return t.every(e=>typeof e!=`string`)?t:void 0}),a=Ce(()=>[i.value?.map(e=>Ee(e))??[Te].filter(e=>e!=null),Se(N(i.value?e[1]:e[0])),Se(s(i.value?e[2]:e[1])),N(i.value?e[3]:e[2])],([e,i,a,o])=>{if(n(),!e?.length||!i?.length||!a?.length)return;let s=ve(o)?{...o}:o;t.push(...e.flatMap(e=>i.flatMap(t=>a.map(n=>r(e,t,n,s)))))},{flush:`post`});return me(n),()=>{a(),n()}}var Oe=!1;function ke(e,t,n={}){let{window:r=Te,ignore:i=[],capture:a=!0,detectIframe:o=!1,controls:s=!1}=n;if(!r)return s?{stop:ye,cancel:ye,trigger:ye}:ye;if(be&&!Oe){Oe=!0;let e={passive:!0};Array.from(r.document.body.children).forEach(t=>t.addEventListener(`click`,ye,e)),r.document.documentElement.addEventListener(`click`,ye,e)}let c=!0,l=e=>N(i).some(t=>{if(typeof t==`string`)return Array.from(r.document.querySelectorAll(t)).some(t=>t===e.target||e.composedPath().includes(t));{let n=Ee(t);return n&&(e.target===n||e.composedPath().includes(n))}});function u(e){let t=N(e);return t&&t.$.subTree.shapeFlag===16}function d(e,t){let n=N(e),r=n.$.subTree&&n.$.subTree.children;return r==null||!Array.isArray(r)?!1:r.some(e=>e.el===t.target||t.composedPath().includes(e.el))}let f=n=>{let r=Ee(e);if(n.target!=null&&!(!(r instanceof Element)&&u(e)&&d(e,n))&&!(!r||r===n.target||n.composedPath().includes(r))){if(`detail`in n&&n.detail===0&&(c=!l(n)),!c){c=!0;return}t(n)}},p=!1,m=[De(r,`click`,e=>{p||(p=!0,setTimeout(()=>{p=!1},0),f(e))},{passive:!0,capture:a}),De(r,`pointerdown`,t=>{let n=Ee(e);c=!l(t)&&!!(n&&!t.composedPath().includes(n))},{passive:!0}),o&&De(r,`blur`,n=>{setTimeout(()=>{let i=Ee(e);r.document.activeElement?.tagName===`IFRAME`&&!i?.contains(r.document.activeElement)&&t(n)},0)},{passive:!0})].filter(Boolean),h=()=>m.forEach(e=>e());return s?{stop:h,cancel:()=>{c=!1},trigger:e=>{c=!0,f(e),c=!1}}:h}function Ae(){let e=le(!1),t=l();return t&&g(()=>{e.value=!0},t),e}function je(e){let t=Ae();return k(()=>(t.value,!!e()))}function Me(e,t,n={}){let{window:r=Te,...i}=n,a,o=je(()=>r&&`MutationObserver`in r),s=()=>{a&&=(a.disconnect(),void 0)},c=w(k(()=>{let t=Se(N(e)).map(Ee).filter(ge);return new Set(t)}),e=>{s(),o.value&&e.size&&(a=new MutationObserver(t),e.forEach(e=>a.observe(e,i)))},{immediate:!0,flush:`post`}),l=()=>a?.takeRecords(),u=()=>{c(),s()};return me(u),{isSupported:o,stop:u,takeRecords:l}}function Ne(e,t,n={}){let{window:r=Te,document:i=r?.document,flush:a=`sync`}=n;if(!r||!i)return ye;let o,s=e=>{o?.(),o=e},c=te(()=>{let n=Ee(e);if(n){let{stop:e}=Me(i,e=>{e.map(e=>[...e.removedNodes]).flat().some(e=>e===n||e.contains(n))&&t(e)},{window:r,childList:!0,subtree:!0});s(e)}},{flush:a}),l=()=>{c(),s()};return me(l),l}function Pe(e){return typeof e==`function`?e:typeof e==`string`?t=>t.key===e:Array.isArray(e)?t=>e.includes(t.key):()=>!0}function Fe(...e){let t,n,r={};e.length===3?(t=e[0],n=e[1],r=e[2]):e.length===2?typeof e[1]==`object`?(t=!0,n=e[0],r=e[1]):(t=e[0],n=e[1]):(t=!0,n=e[0]);let{target:i=Te,eventName:a=`keydown`,passive:o=!1,dedupe:s=!1}=r,c=Pe(t);return De(i,a,e=>{e.repeat&&N(s)||c(e)&&n(e)},o)}function Ie(e={}){let{window:t=Te,deep:n=!0,triggerOnRemoval:r=!1}=e,i=e.document??t?.document,a=()=>{let e=i?.activeElement;if(n)for(var t;e?.shadowRoot;)e=e==null||(t=e.shadowRoot)==null?void 0:t.activeElement;return e},o=le(),s=()=>{o.value=a()};if(t){let e={capture:!0,passive:!0};De(t,`blur`,e=>{e.relatedTarget===null&&s()},e),De(t,`focus`,s,e)}return r&&Ne(o,s,{document:i}),s(),o}var Le={ctrl:`control`,command:`meta`,cmd:`meta`,option:`alt`,up:`arrowup`,down:`arrowdown`,left:`arrowleft`,right:`arrowright`};function Re(e={}){let{reactive:t=!1,target:n=Te,aliasMap:r=Le,passive:i=!0,onEventFired:a=ye}=e,o=se(new Set),s={toJSON(){return{}},current:o},c=t?se(s):s,l=new Set,u=new Map([[`Meta`,l],[`Shift`,new Set],[`Alt`,new Set]]),d=new Set;function f(e,n){e in c&&(t?c[e]=n:c[e].value=n)}function p(){o.clear();for(let e of d)f(e,!1)}function m(e,t,n){if(!(!e||typeof t.getModifierState!=`function`)){for(let[e,r]of u)if(t.getModifierState(e)){n.forEach(e=>r.add(e));break}}}function h(e,t){if(e)return;let n=`${t[0].toUpperCase()}${t.slice(1)}`,r=u.get(n);if(![`shift`,`alt`].includes(t)||!r)return;let i=Array.from(r),a=i.indexOf(t);i.forEach((e,t)=>{t>=a&&(o.delete(e),f(e,!1))}),r.clear()}function g(e,t){let n=e.key?.toLowerCase(),r=[e.code?.toLowerCase(),n].filter(Boolean);n&&(t?o.add(n):o.delete(n));for(let e of r)d.add(e),f(e,t);m(t,e,[...o,...r]),h(t,n),n===`meta`&&!t&&(l.forEach(e=>{o.delete(e),f(e,!1)}),l.clear())}De(n,`keydown`,e=>(g(e,!0),a(e)),{passive:i}),De(n,`keyup`,e=>(g(e,!1),a(e)),{passive:i}),De(`blur`,p,{passive:i}),De(`focus`,p,{passive:i});let _=new Proxy(c,{get(e,n,i){if(typeof n!=`string`)return Reflect.get(e,n,i);if(n=n.toLowerCase(),n in r&&(n=r[n]),!(n in c))if(/[+_-]/.test(n)){let e=n.split(/[+_-]/g).map(e=>e.trim());c[n]=k(()=>e.map(e=>N(_[e])).every(Boolean))}else c[n]=le(!1);let a=Reflect.get(e,n,i);return t?N(a):a}});return _}var ze={page:e=>[e.pageX,e.pageY],client:e=>[e.clientX,e.clientY],screen:e=>[e.screenX,e.screenY],movement:e=>e instanceof MouseEvent?[e.movementX,e.movementY]:null};function Be(e={}){let{type:t=`page`,touch:n=!0,resetOnTouchEnds:r=!1,initialValue:i={x:0,y:0},window:a=Te,target:o=a,scroll:s=!0,eventFilter:c}=e,l=null,u=0,d=0,f=le(i.x),p=le(i.y),m=le(null),h=typeof t==`function`?t:ze[t],g=e=>{let t=h(e);l=e,t&&([f.value,p.value]=t,m.value=`mouse`),a&&(u=a.scrollX,d=a.scrollY)},_=e=>{if(e.touches.length>0){let t=h(e.touches[0]);t&&([f.value,p.value]=t,m.value=`touch`)}},v=()=>{if(!l||!a)return;let e=h(l);l instanceof MouseEvent&&e&&(f.value=e[0]+a.scrollX-u,p.value=e[1]+a.scrollY-d)},y=()=>{f.value=i.x,p.value=i.y},b=c?e=>c(()=>g(e),{}):e=>g(e),x=c?e=>c(()=>_(e),{}):e=>_(e),S=c?()=>c(()=>v(),{}):()=>v();if(o){let e={passive:!0};De(o,[`mousemove`,`dragover`],b,e),n&&t!==`movement`&&(De(o,[`touchstart`,`touchmove`],x,e),r&&De(o,`touchend`,y,e)),s&&t===`page`&&De(a,`scroll`,S,e)}return{x:f,y:p,sourceType:m}}var Ve=`http://localhost:3001`;function He(e={}){let t=e.serverUrl||Ve;async function n(e,n=[]){let r=`${t}/api/invoke`,i={channel:e,args:n};console.log(`[ç¼“å­˜è¯·æ±‚] å‘é€åˆ°: ${r}`),console.log(`[ç¼“å­˜è¯·æ±‚] æ“ä½œ: ${e}`),console.log(`[ç¼“å­˜è¯·æ±‚] å‚æ•°:`,n);try{let e=await fetch(r,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify(i)});if(console.log(`[ç¼“å­˜å“åº”] çŠ¶æ€ç : ${e.status}`),console.log(`[ç¼“å­˜å“åº”] çŠ¶æ€: ${e.ok?`æˆåŠŸ`:`å¤±è´¥`}`),!e.ok){let t;try{t=await e.json(),console.log(`[ç¼“å­˜å“åº”] é”™è¯¯æ•°æ®:`,t)}catch{t={error:`HTTP ${e.status}`},console.log(`[ç¼“å­˜å“åº”] æ— æ³•è§£æé”™è¯¯å“åº”ï¼ŒçŠ¶æ€ç : ${e.status}`)}throw Error(t.error||`HTTP ${e.status}`)}let t=await e.json();if(console.log(`[ç¼“å­˜å“åº”] æˆåŠŸ:`,t),!t.success)throw Error(t.error||`æ“ä½œå¤±è´¥`);return t.data}catch(t){throw console.error(`ç¼“å­˜æ“ä½œå¤±è´¥ [${e}]:`,t),t}}return{async get(e,t){try{return(await n(`cache:get`,[e,t])).value}catch(t){let n=t instanceof Error?t.message:String(t);console.warn(`[ç¼“å­˜] è¯»å–å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°å­˜å‚¨ä½œä¸ºå¤‡é€‰ [${e}]:`,n);return}},async set(e,t,r){try{await n(`cache:set`,[e,t,r])}catch(e){throw console.error(`ä¿å­˜ç¼“å­˜å¤±è´¥:`,e),e}},async remove(e,t){try{await n(`cache:remove`,[e,t])}catch(e){throw console.error(`åˆ é™¤ç¼“å­˜å¤±è´¥:`,e),e}},async clear(e){try{await n(`cache:clear`,[e])}catch(e){throw console.error(`æ¸…ç©ºç¼“å­˜å¤±è´¥:`,e),e}}}}function Ue(){if(typeof window>`u`)return;let e;if(window?.httpApi?.url)e=window.httpApi.url;else{let t=window.location.href.split(`?`)[1];t&&(e=new URLSearchParams(t).get(`httpUrl`)||void 0)}e&&(globalThis.__CONTEXT__HANDLER__=He({serverUrl:e}))}Ue();var We=`app`;function Ge(e,t){return`ctx:${t||We}:${e}`}var Ke={async get(e,t){try{let n=Ge(e,t?.namespace),r=globalThis.localStorage?.getItem(n);if(!r)return;let i=JSON.parse(r);if(typeof i?.expireAt==`number`&&Date.now()>i.expireAt){globalThis.localStorage?.removeItem(n);return}return i?.value}catch{return}},async set(e,t,n){let r=Ge(e,n?.namespace),i={value:t,expireAt:n?.ttlMs?Date.now()+n.ttlMs:void 0};globalThis.localStorage?.setItem(r,JSON.stringify(i))},async remove(e,t){let n=Ge(e,t?.namespace);globalThis.localStorage?.removeItem(n)},async clear(e){let t=`ctx:${e?.namespace||We}:`,n=globalThis.localStorage;if(!n)return;let r=[];for(let e=0;e<n.length;e++){let i=n.key(e);i&&i.startsWith(t)&&r.push(i)}for(let e of r)n.removeItem(e)}};function qe(){let e=ue(),t=Ke;return{cache:{get handler(){return t},setHandler(e){t=e},async save(n,r,i){try{await t.set(n,r,i),e.emit(`save`,{key:n,value:r,options:i})}catch(t){throw e.emit(`save`,{key:n,value:r,options:i,error:t}),t}},async read(n,r){try{let i=await t.get(n,r);return e.emit(`read`,{key:n,options:r,result:i}),i}catch(t){throw e.emit(`read`,{key:n,options:r,error:t}),t}},async remove(n,r){try{await t.remove(n,r),e.emit(`remove`,{key:n,options:r})}catch(t){throw e.emit(`remove`,{key:n,options:r,error:t}),t}},async clear(n){try{typeof t.clear==`function`&&await t.clear(n),e.emit(`clear`,{options:n})}catch(t){throw e.emit(`clear`,{options:n,error:t}),t}},subscribe(t,n){return e.on(t,n),()=>e.off(t,n)}}}}globalThis.__CONTEXT__||(globalThis.__CONTEXT__=qe(),globalThis.__CONTEXT__HANDLER__&&(console.log(`ğŸš€ ~ åŠ è½½ä¸Šä¸‹æ–‡å¤„ç†å™¨:`,globalThis.__CONTEXT__HANDLER__),globalThis.__CONTEXT__.cache.setHandler(globalThis.__CONTEXT__HANDLER__)));const Je=()=>globalThis.__CONTEXT__,Ye={autoSave:!0,gridSize:20,snapToGrid:!1,executionMode:`worker`,serverUrl:`http://localhost:3000`,maxConcurrent:3,defaultZoom:1,minZoom:.1,maxZoom:4,edgeType:`default`,edgeWidth:2,edgeColor:`#94a3b8`,edgeActiveColor:`#3b82f6`,edgeAnimation:!1,edgeShowArrow:!0,showGrid:!0,gridType:`dots`,gridGap:20,bgColor:`#ffffff`,gridColor:`#e2e8f0`,showMiniMap:!1,autoLayoutDirection:`LR`,autoLayoutNodeSpacing:50,autoLayoutRankSpacing:80,autoLayoutPadding:120,autoLayoutFitView:!0,autoLayoutFitViewPadding:.2,autoLayoutFitViewDuration:400};var Xe=`editorConfig`,Ze=`v2`;async function Qe(){try{let e=await Je().cache.read(Xe,{namespace:Ze});if(e)return{...Ye,...e}}catch(e){console.error(`[EditorConfig Store] åŠ è½½é…ç½®å¤±è´¥:`,e)}return{...Ye}}async function $e(e){try{await Je().cache.save(Xe,e,{namespace:Ze})}catch(e){console.error(`[EditorConfig Store] ä¿å­˜é…ç½®å¤±è´¥:`,e)}}const et=S(`editorConfig`,()=>{let e=C(!1),t=C({...Ye});(async()=>{t.value=await Qe();let n=new URLSearchParams(window.location.href.split(`?`)[1]),r=n.get(`serverUrl`);console.log(n,r),r&&(t.value.executionMode=`server`,t.value.serverUrl=r),e.value=!0})();let n=null;function r(e){t.value={...t.value,...e}}function i(){t.value={...Ye}}function a(){return JSON.stringify(t.value,null,2)}function o(e){try{let n=JSON.parse(e);return t.value={...Ye,...n},!0}catch(e){return console.error(`[EditorConfig Store] å¯¼å…¥é…ç½®å¤±è´¥:`,e),!1}}w(t,e=>{n!==null&&clearTimeout(n),n=window.setTimeout(()=>{$e(e),n=null},500)},{deep:!0,flush:`post`});async function s(){for(;!e.value;)await new Promise(e=>setTimeout(e,10));return!0}return{init:e,config:t,updateConfig:r,resetConfig:i,exportConfig:a,importConfig:o,ready:s}});var tt=`workflows`,nt=`current-workflow-id`,rt=`global-variables`,it=2,at=`v2`;function ot(e){return`${e}-${Math.random().toString(36).slice(2,8)}-${Date.now()}`}async function st(){try{return await Je().cache.read(nt,{namespace:at})??null}catch(e){return console.error(`åŠ è½½å½“å‰å·¥ä½œæµ ID å¤±è´¥:`,e),null}}async function ct(e){try{let t=Je();e?await t.cache.save(nt,e,{namespace:at}):await t.cache.remove(nt,{namespace:at})}catch(e){console.error(`ä¿å­˜å½“å‰å·¥ä½œæµ ID å¤±è´¥:`,e)}}async function lt(){try{let e=await Je().cache.read(rt,{namespace:at});return Array.isArray(e)?e:[]}catch(e){return console.error(`åŠ è½½å…¨å±€å˜é‡å¤±è´¥:`,e),[]}}async function ut(e){try{await Je().cache.save(rt,e,{namespace:at})}catch(e){console.error(`ä¿å­˜å…¨å±€å˜é‡å¤±è´¥:`,e)}}function dt(){let e=Date.now(),t={id:ot(`folder`),name:`æˆ‘çš„å·¥ä½œæµ`,parentId:null,order:0,createdAt:e,updatedAt:e},n={workflow_id:`workflow-1`,name:`åŸºç¡€æµç¨‹`,description:`åŸºç¡€æµç¨‹ç¤ºä¾‹`,folderId:t.id,order:0,nodes:[],edges:[],createdAt:e,updatedAt:e};return{version:it,workflows:[n],folders:[t]}}function ft(e){let t=Date.now(),n=[],r=new Map,i=new Map,a=e=>{let t=i.get(e)??0;return i.set(e,t+1),t},o=e=>{if(!e)return null;if(r.has(e))return r.get(e)||null;let i=e.split(`/`).filter(Boolean),o=null,s=``;for(let e of i){if(s=s?`${s}/${e}`:e,r.has(s)){o=r.get(s)||null;continue}let i={id:ot(`folder`),name:e,parentId:o,order:a(o),createdAt:t,updatedAt:t};n.push(i),r.set(s,i.id),o=i.id}return r.get(e)??null},s=e.map((e,n)=>{let r=o(e.path);return{...e,folderId:r,order:n,createdAt:e.createdAt??t,updatedAt:e.updatedAt??t}});if(n.length===0){let e=dt();return{version:it,workflows:e.workflows,folders:e.folders}}return{version:it,workflows:s,folders:n}}async function pt(){try{let e=await Je().cache.read(tt,{namespace:at});if(!e)return dt();if(Array.isArray(e))return ft(e);if(!e.version||e.version<it){let t=e.workflows;return t&&Array.isArray(t)?ft(t):dt()}return e}catch(e){return console.error(`åŠ è½½å·¥ä½œæµå¤±è´¥:`,e),dt()}}async function mt(e){try{await Je().cache.save(tt,e,{namespace:at})}catch(e){console.error(`ä¿å­˜å·¥ä½œæµå¤±è´¥:`,e)}}function ht(e,t,n){if(!t)return``;if(n.has(t))return n.get(t)||``;let r=e.find(e=>e.id===t);if(!r)return``;let i=ht(e,r.parentId,n),a=i?`${i}/${r.name}`:r.name;return n.set(t,a),a}function gt(e){let t=[],n=new Map,r=i=>{let a=e.filter(e=>e.parentId===i).sort((e,t)=>e.order-t.order);for(let i of a){let a=ht(e,i.id,n);a&&t.push(a),r(i.id)}};return r(null),t}function _t(e,t){return t.type===`folder`?e.kind===`folder`&&e.data.id===t.folderId:e.kind===`workflow`&&e.data.workflow_id===t.workflowId}function vt(e,t){let n=new Map,r=i=>{let a=e.filter(e=>e.parentId===i).map(t=>{let i=r(t.id),a={type:`folder`,folderId:t.id,parentFolderId:t.parentId,order:t.order,path:ht(e,t.id,n)};return{key:`folder-${t.id}`,label:t.name,isLeaf:!1,children:i,meta:a}}),o=t.filter(e=>e.folderId===i).map(t=>{let r={type:`workflow`,workflowId:t.workflow_id,parentFolderId:t.folderId,order:t.order,path:ht(e,t.folderId,n),createdAt:t.createdAt,updatedAt:t.updatedAt,nodeCount:t.nodes.length,description:t.description};return{key:t.workflow_id,label:t.name||`æœªå‘½åå·¥ä½œæµ`,isLeaf:!0,meta:r}}),s=[...a,...o];return s.sort((e,t)=>{let n=e.meta,r=t.meta,i=n?.order??0,a=r?.order??0;return i-a}),s};return r(null)}const yt=S(`workflow`,()=>{let e=dt(),t=C(e.workflows),n=C(e.folders),r=C(null),i=C([]);(async()=>{let e=await pt();t.value=e.workflows,n.value=e.folders,r.value=await st(),i.value=await lt()})();let a=null,o=k(()=>r.value&&t.value.find(e=>e.workflow_id===r.value)||null),s=k(()=>t.value.length),c=k(()=>vt(n.value,t.value)),l=k(()=>gt(n.value));async function u(){await mt({version:it,workflows:t.value,folders:n.value})}w([t,n],()=>{a!==null&&clearTimeout(a),a=window.setTimeout(()=>{u(),a=null},500)},{deep:!0,flush:`post`}),w(r,e=>{ct(e)}),w(i,()=>{ut(i.value)},{deep:!0});function d(e){if(e)return n.value.find(t=>t.id===e)}function f(e){return t.value.find(t=>t.workflow_id===e)}function p(e){return ht(n.value,e,new Map)}function m(e){let r=n.value.filter(t=>t.parentId===e).map(e=>({kind:`folder`,data:e})),i=t.value.filter(t=>t.folderId===e).map(e=>({kind:`workflow`,data:e})),a=[...r,...i];return a.sort((e,t)=>{let n=(e.kind,e.data.order),r=(t.kind,t.data.order);return n-r}),a}function h(e){e.forEach((e,t)=>{e.kind,e.data.order=t,e.data.updatedAt=Date.now()})}function g(e){let t=e.split(`/`).map(e=>e.trim()).filter(Boolean);if(t.length===0)return null;let r=null;for(let e of t){let t=n.value.find(t=>t.parentId===r&&t.name===e);if(!t){let i=Date.now(),a=m(r).length;t={id:ot(`folder`),name:e,parentId:r,order:a,createdAt:i,updatedAt:i},n.value.push(t)}r=t.id}return r}function _(e,n=`æˆ‘çš„å·¥ä½œæµ`,r){let i=Date.now(),a=n?g(n):null,o=m(a).length,s={workflow_id:ot(`workflow`),name:e,description:r,folderId:a,order:o,nodes:[],edges:[],createdAt:i,updatedAt:i};return t.value.push(s),s}function v(e){let n=t.value.findIndex(t=>t.workflow_id===e);if(n===-1)return;let i=t.value[n],a=m(i.folderId).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));h(a),t.value.splice(n,1),r.value===e&&(r.value=null)}function y(e,t){let n=f(e);n&&Object.assign(n,t,{updatedAt:Date.now()})}function b(e){r.value=e}function x(e){return f(e)}function S(e,t){y(e,{name:t})}function T(e,t){let n=f(e);if(!n)return;let r=t?g(t):null,i=m(r).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));if(n.folderId!==r){let t=m(n.folderId).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e));h(t)}i.push({kind:`workflow`,data:n}),h(i),n.folderId=r,n.updatedAt=Date.now()}function E(e){let n=f(e);if(!n)return null;let r=Date.now(),i=m(n.folderId).length,a={...JSON.parse(JSON.stringify(n)),workflow_id:ot(`workflow`),name:`${n.name} (å‰¯æœ¬)`,order:i,createdAt:r,updatedAt:r};return t.value.push(a),a}function D(){t.value=[],n.value=[],r.value=null}function O(){let e=dt();t.value=e.workflows,n.value=e.folders,r.value=null}function A(e){let t=f(e);return t?JSON.stringify(t,null,2):null}function ee(e){try{let n=JSON.parse(e),r=Date.now(),i=m(null).length,a={...n,workflow_id:ot(`workflow`),folderId:null,order:i,createdAt:r,updatedAt:r};return t.value.push(a),a}catch(e){return console.error(`å¯¼å…¥å·¥ä½œæµå¤±è´¥:`,e),null}}function te(e,t=``){let r=e.trim(),i=t.trim(),a=i?g(i):null,o=n.value.find(e=>e.parentId===a&&e.name===r);if(o)return o;let s=Date.now(),c=m(a).length,l={id:ot(`folder`),name:r,parentId:a,order:c,createdAt:s,updatedAt:s};return n.value.push(l),l}function ne(e,i=!1){let a=d(e);if(!a)return{success:!1,message:`æ–‡ä»¶å¤¹ä¸å­˜åœ¨`};let o=m(e);if(o.length>0&&!i)return{success:!1,message:`æ–‡ä»¶å¤¹ä¸ä¸ºç©ºï¼ŒåŒ…å« ${o.length} ä¸ªé¡¹ç›®`};let s=0,c=0;if(i){let i=e=>{let a=m(e);for(let e of a)if(e.kind===`folder`){i(e.data.id);let t=n.value.findIndex(t=>t.id===e.data.id);t>-1&&(n.value.splice(t,1),s++)}else{let n=t.value.findIndex(t=>t.workflow_id===e.data.workflow_id);n>-1&&(t.value.splice(n,1),c++,r.value===e.data.workflow_id&&(r.value=null))}};i(e)}let l=n.value.findIndex(t=>t.id===e);l>-1&&(n.value.splice(l,1),s++);let u=m(a.parentId).filter(t=>!(t.kind===`folder`&&t.data.id===e));return h(u),{success:!0,message:i?`å·²åˆ é™¤æ–‡ä»¶å¤¹åŠå…¶å†…å®¹`:`æ–‡ä»¶å¤¹å·²åˆ é™¤`,deletedCount:{folders:s,workflows:c}}}function re(e,t){let n=e;for(;n;){if(n===t)return!0;n=d(n)?.parentId??null}return!1}function ie(e,t){return t===`inside`?e.type===`folder`?e.folderId:e.parentFolderId:(e.type,e.parentFolderId)}function j(e,t,n){if(n===`inside`)return e.length;let r=e.findIndex(e=>_t(e,t));return r===-1?e.length:n===`before`?r:r+1}function ae(e){let{dragMeta:t,targetMeta:n,dropPosition:r}=e;if(t.type===`workflow`&&n.type===`workflow`&&t.workflowId===n.workflowId||t.type===`folder`&&n.type===`folder`&&t.folderId===n.folderId)return;let i=ie(n,r);if(t.type===`workflow`){let e=f(t.workflowId);if(!e)return;let a=e.folderId,o=m(i).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e.workflow_id));if(a!==i){let t=m(a).filter(t=>!(t.kind===`workflow`&&t.data.workflow_id===e.workflow_id));h(t),e.folderId=i}let s=j(o,n,r);o.splice(s,0,{kind:`workflow`,data:e}),h(o),e.updatedAt=Date.now();return}let a=d(t.type===`folder`?t.folderId:null);if(!a||i===a.id||re(i,a.id))return;let o=a.parentId,s=m(i).filter(e=>!(e.kind===`folder`&&e.data.id===a.id));if(o!==i){let e=m(o).filter(e=>!(e.kind===`folder`&&e.data.id===a.id));h(e),a.parentId=i}let c=j(s,n,r);s.splice(c,0,{kind:`folder`,data:a}),h(s),a.updatedAt=Date.now()}function M(e){i.value.push(e)}function oe(e,t){let n=i.value.find(t=>t.key===e);n&&Object.assign(n,t)}function se(e){let t=i.value.findIndex(t=>t.key===e);t>-1&&i.value.splice(t,1)}function N(e){return i.value.find(t=>t.key===e)}function ce(e){i.value=e}function le(){return i.value.reduce((e,t)=>(e[t.key]=t.value,e),{})}return{workflows:t,folders:n,currentWorkflowId:r,currentWorkflow:o,workflowCount:s,treeData:c,folderPathList:l,createWorkflow:_,deleteWorkflow:v,updateWorkflow:y,setCurrentWorkflow:b,getWorkflowById:x,renameWorkflow:S,moveWorkflow:T,duplicateWorkflow:E,clearAllWorkflows:D,resetToDefaults:O,exportWorkflow:A,importWorkflow:ee,createFolder:te,deleteFolder:ne,ensureFolderPath:g,handleTreeDrop:ae,buildFolderPath:p,globalVariables:i,addGlobalVariable:M,updateGlobalVariable:oe,deleteGlobalVariable:se,getGlobalVariable:N,setGlobalVariables:ce,getGlobalVariableJson:le}});function bt(){let e=C(`idle`),t=C(0),n=C(null),r=C(null),i=C(new Map),a=C(null),o=C(null),s=C(null),c=k(()=>e.value===`running`),l=k(()=>e.value===`paused`),u=k(()=>e.value===`completed`),d=k(()=>e.value===`error`),f=k(()=>o.value?(s.value||Date.now())-o.value:null);function p(t){e.value=t}function m(e){t.value=Math.max(0,Math.min(1,e))}function h(a,c){n.value=a,r.value=c,e.value=`running`,t.value=0,o.value=Date.now(),s.value=null,i.value.clear()}function g(n){a.value=n,e.value=n.success?`completed`:`error`,t.value=1,s.value=Date.now(),n.nodeResults&&(n.nodeResults instanceof Map?i.value=new Map(n.nodeResults):typeof n.nodeResults==`object`&&(i.value=new Map(Object.entries(n.nodeResults))))}function _(e,t){let n={...i.value.get(e)||{nodeId:e,status:`pending`},...t};i.value.set(e,n),i.value=new Map(i.value)}function v(){e.value=`idle`,t.value=0,n.value=null,r.value=null,i.value.clear(),a.value=null,o.value=null,s.value=null}return{state:e,progress:t,executionId:n,workflowId:r,nodeStates:i,lastResult:a,isExecuting:c,isPaused:l,isCompleted:u,hasError:d,startTime:o,endTime:s,duration:f,setState:p,setProgress:m,startExecution:h,completeExecution:g,updateNodeState:_,reset:v}}var xt=class{constructor(e){this.ws=null,this.reconnectAttempts=0,this.reconnectTimer=null,this.messageHandlers=new Map,this.loggerPrefix=`[WSClient]`,this.initialized=!1,this.pendingCommands=[],this.config={url:e.url,autoReconnect:e.autoReconnect??!0,reconnectInterval:e.reconnectInterval??3e3,maxReconnectAttempts:e.maxReconnectAttempts??5,enableLogging:e.enableLogging??!0}}async connect(){return new Promise((e,t)=>{try{this.log(`æ­£åœ¨è¿æ¥åˆ°æœåŠ¡å™¨:`,this.config.url),this.ws=new WebSocket(this.config.url),this.ws.onopen=()=>{this.log(`å·²è¿æ¥åˆ°æœåŠ¡å™¨`),this.reconnectAttempts=0,this.sendCommand({type:`INIT`}),this.flushPendingCommands(),e()},this.ws.onmessage=e=>{this.handleMessage(e.data)},this.ws.onerror=e=>{this.error(`WebSocket é”™è¯¯:`,e),t(e)},this.ws.onclose=()=>{this.log(`è¿æ¥å·²å…³é—­`),this.initialized=!1,this.config.autoReconnect&&this.attemptReconnect()}}catch(e){t(e)}})}attemptReconnect(){if(this.reconnectAttempts>=this.config.maxReconnectAttempts){this.error(`å·²è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°`);return}this.reconnectAttempts++,this.log(`å°è¯•é‡è¿ (${this.reconnectAttempts}/${this.config.maxReconnectAttempts})`),this.reconnectTimer=window.setTimeout(()=>{this.connect().catch(()=>{})},this.config.reconnectInterval)}disconnect(){this.reconnectTimer&&=(clearTimeout(this.reconnectTimer),null),this.ws&&=(this.ws.close(),null)}sendCommand(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){this.pendingCommands.push(e);return}this.ws.send(JSON.stringify(e))}flushPendingCommands(){for(;this.pendingCommands.length>0;){let e=this.pendingCommands.shift();e&&this.sendCommand(e)}}handleMessage(e){try{let t=JSON.parse(e),n=this.messageHandlers.get(t.type);n&&n(t.payload),t.type===`INITIALIZED`&&(this.initialized=!0,this.log(`æœåŠ¡ç«¯æ‰§è¡Œå™¨å·²åˆå§‹åŒ–`))}catch(e){this.error(`è§£ææ¶ˆæ¯å¤±è´¥:`,e)}}on(e,t){this.messageHandlers.set(e,t)}off(e){this.messageHandlers.delete(e)}execute(e,t){this.sendCommand({type:`EXECUTE`,payload:{workflow:e,options:t}})}pause(){this.sendCommand({type:`PAUSE`})}resume(){this.sendCommand({type:`RESUME`})}stop(){this.sendCommand({type:`STOP`})}getCacheStats(e,t){this.sendCommand({type:`GET_CACHE_STATS`,payload:{workflowId:e,requestId:t}})}clearCache(e){this.sendCommand({type:`CLEAR_CACHE`,payload:{workflowId:e}})}clearAllCache(){this.sendCommand({type:`CLEAR_ALL_CACHE`})}getNodeList(e){this.sendCommand({type:`GET_NODE_LIST`,payload:{requestId:e}})}getHistory(e,t,n,r){this.sendCommand({type:`GET_HISTORY`,payload:{requestId:e,workflowId:t,page:n,pageSize:r}})}clearHistory(e){this.sendCommand({type:`CLEAR_HISTORY`,payload:{workflowId:e}})}deleteHistory(e){this.sendCommand({type:`DELETE_HISTORY`,payload:{executionId:e}})}isInitialized(){return this.initialized}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}log(...e){this.config.enableLogging&&console.log(this.loggerPrefix,...e)}error(...e){this.config.enableLogging&&console.error(this.loggerPrefix,...e)}},St={mode:`worker`,serverUrl:`ws://localhost:3001`,timeout:6e4,useCache:!0,autoReconnect:!0},Ct=5e3;function wt(e){let t=null,n=new Set,r=e=>{n.forEach(t=>t(e))};return{async init(){t||(t=e?new Worker(e,{type:`module`}):new Worker(new URL(``+new URL(`worker-OWulRmi7.js`,import.meta.url).href,``+import.meta.url),{type:`module`}),t.onmessage=e=>{r(e.data)},t.onerror=e=>{console.error(`[VueFlowExecution][Worker] é”™è¯¯:`,e.message)})},terminate(){t&&=(t.terminate(),null)},send(e){if(!t)throw Error(`æ‰§è¡Œé€šé“æœªåˆå§‹åŒ–`);t.postMessage(e)},onMessage(e){n.add(e)},offMessage(e){n.delete(e)}}}function Tt(t){let n={...St,...t},r=et(),{config:i}=ce(r),a=k(()=>i.value.executionMode),o=C(!1),s=bt(),c=null,l=null,u=null,d=new Map,f=new Map,p=new Map,m=new Map;async function h(){if(c&&o.value)return c;if(c&&ue(),await r.ready(),a.value===`worker`){let e=wt(n.workerUrl);l=P,e.onMessage(P),await e.init(),e.send({type:`INIT`}),c=e,o.value=!0,console.log(`[VueFlowExecution] Worker é€šé“å·²å‡†å¤‡`)}else if(a.value===`server`){let e=i.value.serverUrl;e.startsWith(`http://`)?e=e.replace(`http://`,`ws://`):e.startsWith(`https://`)?e=e.replace(`https://`,`wss://`):!e.startsWith(`ws://`)&&!e.startsWith(`wss://`)&&(e=`ws://`+e);let t=new xt({url:e,autoReconnect:!0,enableLogging:!0});await t.connect();let n={init:async()=>Promise.resolve(),send:e=>{switch(e.type){case`EXECUTE`:t.execute(e.payload.workflow,e.payload.options);break;case`PAUSE`:t.pause();break;case`RESUME`:t.resume();break;case`STOP`:t.stop();break;case`GET_CACHE_STATS`:t.getCacheStats(e.payload.workflowId,e.payload.requestId);break;case`CLEAR_CACHE`:t.clearCache(e.payload.workflowId);break;case`CLEAR_ALL_CACHE`:t.clearAllCache();break;case`GET_NODE_LIST`:t.getNodeList(e.payload.requestId);break;case`GET_HISTORY`:t.getHistory(e.payload.requestId,e.payload.workflowId,e.payload.page,e.payload.pageSize);break;case`CLEAR_HISTORY`:t.clearHistory(e.payload.workflowId);break;case`DELETE_HISTORY`:t.deleteHistory(e.payload.executionId);break;default:console.warn(`[VueFlowExecution] æœªçŸ¥çš„å‘½ä»¤ç±»å‹:`,e)}},onMessage:e=>{[`INITIALIZED`,`EXECUTION_START`,`EXECUTION_COMPLETE`,`EXECUTION_ERROR`,`NODE_START`,`NODE_COMPLETE`,`NODE_ERROR`,`PROGRESS`,`CACHE_HIT`,`ITERATION_UPDATE`,`STATE_CHANGE`,`CACHE_STATS`,`NODE_LIST`,`HISTORY_DATA`,`ERROR`].forEach(n=>{t.on(n,t=>{e({type:n,payload:t})})})},offMessage:()=>{},terminate:()=>{t.disconnect()}};c=n,l=P,n.onMessage(P),o.value=!0,console.log(`[VueFlowExecution] WebSocket é€šé“å·²å‡†å¤‡`)}else throw Error(`ä¸æ”¯æŒçš„æ‰§è¡Œæ¨¡å¼: ${a.value}`);return c}async function g(e,t){return await h(),u?Promise.reject(Error(`å·²æœ‰æ‰§è¡Œä»»åŠ¡æ­£åœ¨ç­‰å¾…å¼€å§‹`)):new Promise((n,r)=>{u={resolve:n,reject:r},c.send({type:`EXECUTE`,payload:{workflow:e,options:t}})})}function _(){c?.send({type:`PAUSE`})}function v(){c?.send({type:`RESUME`})}function y(){c?.send({type:`STOP`})}async function b(e){await h();let t=I();return new Promise((n,r)=>{let i=setTimeout(()=>{f.delete(t),r(Error(`è·å–ç¼“å­˜ç»Ÿè®¡è¶…æ—¶`))},Ct);f.set(t,{resolve:n,reject:r,timer:i}),c.send({type:`GET_CACHE_STATS`,payload:{workflowId:e,requestId:t}})})}async function x(e){await h(),c.send({type:`CLEAR_CACHE`,payload:{workflowId:e}})}async function S(){await h(),c.send({type:`CLEAR_ALL_CACHE`})}async function w(){await h();let e=I();return new Promise((t,n)=>{let r=setTimeout(()=>{p.delete(e),n(Error(`è·å–èŠ‚ç‚¹åˆ—è¡¨è¶…æ—¶`))},Ct);p.set(e,{resolve:t,reject:n,timer:r}),c.send({type:`GET_NODE_LIST`,payload:{requestId:e}})})}async function T(e,t=1,n=20){await h();let r=I();return new Promise((i,a)=>{let o=setTimeout(()=>{m.delete(r),a(Error(`è·å–å†å²è®°å½•è¶…æ—¶`))},Ct);m.set(r,{resolve:i,reject:a,timer:o}),c.send({type:`GET_HISTORY`,payload:{requestId:r,workflowId:e,page:t,pageSize:n}})})}async function E(e){await h(),c.send({type:`CLEAR_HISTORY`,payload:{workflowId:e}})}async function D(e){await h(),c.send({type:`DELETE_HISTORY`,payload:{executionId:e}})}async function O(e){console.warn(`[VueFlowExecution] switchMode å·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨é…ç½®é¢æ¿åˆ‡æ¢æ‰§è¡Œæ¨¡å¼`),e!==a.value&&(ue(),r.updateConfig({executionMode:e}),await h(),console.log(`[VueFlowExecution] å·²åˆ‡æ¢åˆ° ${e} æ¨¡å¼`))}function A(e){s.startExecution(e.executionId,e.workflowId),F.emit(`execution:start`,e),F.emit(`workflow:execution-started`,{workflowId:e.workflowId}),u&&=(d.set(e.executionId,u),null)}function ee(e){s.completeExecution(e),F.emit(`execution:complete`,e),F.emit(`workflow:execution-completed`,{workflowId:e.workflowId,success:e.success});let t=d.get(e.executionId);t&&(t.resolve(e),d.delete(e.executionId))}function te(e){s.setState(`error`),F.emit(`execution:error`,e);let t=d.get(e.executionId);if(t){t.reject(Error(e.error)),d.delete(e.executionId);return}u&&=(u.reject(Error(e.error)),null)}function ne(e){s.updateNodeState(e.nodeId,{status:`running`,startTime:Date.now()}),F.emit(`execution:node:start`,e)}function re(e){s.updateNodeState(e.nodeId,{status:`success`,outputs:e.result,endTime:Date.now()}),F.emit(`execution:node:complete`,e)}function ie(e){s.updateNodeState(e.nodeId,{status:`error`,error:e.error,endTime:Date.now()}),F.emit(`execution:node:error`,e)}function j(e){s.setProgress(e.progress),F.emit(`execution:progress`,e)}function ae(e){s.updateNodeState(e.nodeId,{status:`cached`,outputs:e.cachedResult.outputs,fromCache:!0}),F.emit(`execution:cache-hit`,e)}function M(e){F.emit(`execution:iteration:update`,e)}function oe(e){s.setState(e.state),F.emit(`execution:state`,e)}function se(e,t){let n=f.get(e);n&&(clearTimeout(n.timer),n.resolve(t),f.delete(e))}function N(e,t){let n=p.get(e);n&&(clearTimeout(n.timer),n.resolve(t),p.delete(e))}function le(e,t,n,r,i){let a=m.get(e);a&&(clearTimeout(a.timer),a.resolve({history:t,total:n,page:r,pageSize:i}),m.delete(e))}function P(e){switch(e.type){case`INITIALIZED`:console.log(`[VueFlowExecution] Worker åˆå§‹åŒ–å®Œæˆ`);break;case`EXECUTION_START`:A(e.payload);break;case`EXECUTION_COMPLETE`:ee(e.payload);break;case`EXECUTION_ERROR`:te(e.payload);break;case`NODE_START`:ne(e.payload);break;case`NODE_COMPLETE`:re(e.payload);break;case`NODE_ERROR`:ie(e.payload);break;case`PROGRESS`:j(e.payload);break;case`CACHE_HIT`:ae(e.payload);break;case`ITERATION_UPDATE`:M(e.payload);break;case`CACHE_STATS`:se(e.payload.requestId,e.payload.stats);break;case`NODE_LIST`:N(e.payload.requestId,e.payload.nodes);break;case`HISTORY_DATA`:le(e.payload.requestId,e.payload.history,e.payload.total,e.payload.page,e.payload.pageSize);break;case`STATE_CHANGE`:oe(e.payload);break;case`ERROR`:console.error(`[VueFlowExecution] é€šé“é”™è¯¯:`,e.payload);break;default:console.warn(`[VueFlowExecution] æœªçŸ¥çš„é€šé“æ¶ˆæ¯:`,e)}}function ue(){c&&(l&&c.offMessage(l),c.terminate(),c=null,l=null),u&&=(u.reject(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`)),null),d.forEach(({reject:e})=>e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))),d.clear(),f.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),f.clear(),p.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),p.clear(),m.forEach(({reject:e,timer:t})=>{clearTimeout(t),e(Error(`æ‰§è¡Œé€šé“å·²å…³é—­`))}),m.clear(),o.value=!1}e(()=>{ue()});function I(){return`req_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}return{mode:a,state:s,execute:g,pause:_,resume:v,stop:y,getCacheStats:b,clearCache:x,clearAllCache:S,switchMode:O,getNodeList:w,getHistory:T,clearHistory:E,deleteHistory:D,isInitialized:o,ensureChannel:h,cleanupChannel:ue}}const Et=S(`newCanvas`,()=>{let e=yt(),t=D(Tt()),n=C(!1),r=C([]),i=C(0),a=C([]),o=C(!1),s=C(null),c=C(new Map),l=C(null),u=k(()=>e.currentWorkflow?.nodes||[]),d=k(()=>e.currentWorkflow?.edges||[]),f=k(()=>u.value.length),p=k(()=>d.value.length),m=k(()=>e.currentWorkflowId),h=k(()=>e.currentWorkflow?.name||`æœªå‘½åå·¥ä½œæµ`),g=0,_=performance.now(),v=null;function y(){g++;let e=performance.now(),t=e-_;t>=1e3&&(i.value=Math.round(g*1e3/t),g=0,_=e),v=requestAnimationFrame(y)}y();function b(e){n.value=e}function x(e){let t=new Date().toLocaleTimeString();r.value=[{...e,timestamp:t},...r.value].slice(0,10)}function S(){r.value=[]}function w(e){return u.value.find(t=>t.id===e)}function T(t){if(!e.currentWorkflow){console.warn(`æ²¡æœ‰æ´»åŠ¨çš„å·¥ä½œæµï¼Œæ— æ³•æ·»åŠ èŠ‚ç‚¹`);return}e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:[...u.value,t]})}function E(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:u.value.filter(e=>e.id!==t),edges:d.value.filter(e=>e.source!==t&&e.target!==t)})}function O(t,n){if(!e.currentWorkflow)return;let r=u.value.map(e=>e.id===t?{...e,...n}:e);e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:r})}function A(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:t})}function ee(t){if(!e.currentWorkflow){console.warn(`æ²¡æœ‰æ´»åŠ¨çš„å·¥ä½œæµï¼Œæ— æ³•æ·»åŠ è¿çº¿`);return}e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:[...d.value,t]})}function te(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:d.value.filter(e=>e.id!==t)})}function ne(t){e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{edges:t})}function re(t){e.setCurrentWorkflow(t),S()}function ie(){e.currentWorkflow&&(e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:[],edges:[]}),S())}function j(){v!==null&&(cancelAnimationFrame(v),v=null)}function ae(e,t){let n=w(e);if(!n)return;let r=n.data?.iterationHistory||{iterations:[],totalIterations:0,currentPage:1};r.iterations.push(t),r.totalIterations=r.iterations.length,O(e,{data:{...n.data,iterationHistory:r}})}function M(e,t){let n=w(e);if(!n?.data?.iterationHistory)return;let r=n.data.iterationHistory;r.currentPage=Math.max(1,Math.min(t,r.totalIterations)),O(e,{data:{...n.data,iterationHistory:r}})}function oe(e){let t=w(e);t&&O(e,{data:{...t.data,iterationHistory:void 0}})}async function se(e=!1){if(!o.value&&!(!e&&a.value.length>0)){o.value=!0;try{a.value=await t.getNodeList(),s.value=Date.now()}catch(e){console.error(`[Canvas] åŠ è½½èŠ‚ç‚¹åˆ—è¡¨å¤±è´¥:`,e),a.value=[]}finally{o.value=!1}}}function N(e){return c.value.get(e)}function ce(e,t){let n=c.value.get(e),r={nodeId:e,status:`pending`,...n,...t};r.duration===void 0&&r.startTime&&r.endTime&&(r.duration=r.endTime-r.startTime),c.value.set(e,r),c.value=new Map(c.value)}function le(){c.value.clear(),l.value=null}function P(n,r){if(console.log(`[Canvas] åŠ è½½æ‰§è¡ŒçŠ¶æ€:`,n),le(),l.value=n.executionId,t.state.completeExecution(n),r?.nodes&&r?.edges&&(console.log(`[Canvas] æ¢å¤å·¥ä½œæµç»“æ„:`,{nodes:r.nodes.length,edges:r.edges.length}),e.currentWorkflow&&e.updateWorkflow(e.currentWorkflow.workflow_id,{nodes:r.nodes,edges:r.edges})),n.nodeResults){let e=n.nodeResults instanceof Map?n.nodeResults:new Map(Object.entries(n.nodeResults));for(let[t,n]of e.entries())if(n&&typeof n==`object`){let e=n,r=e.status||`success`;r===`success`||r===`completed`?ce(t,{status:`success`,result:e.outputs||n,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()}):r===`error`||r===`failed`?ce(t,{status:`error`,error:e.error||`æ‰§è¡Œå¤±è´¥`,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()}):r===`cached`&&ce(t,{status:`cached`,result:e.outputs||n,duration:e.duration||0,endTime:e.endTime||Date.now(),startTime:e.startTime||Date.now(),timestamp:e.timestamp||Date.now()})}}console.log(`[Canvas] å·²åŠ è½½æ‰§è¡ŒçŠ¶æ€ï¼ŒèŠ‚ç‚¹æ•°é‡:`,c.value.size)}return{nodes:u,edges:d,nodeCount:f,edgeCount:p,currentWorkflowId:m,currentWorkflowName:h,isExecuting:n,lastNodeResults:r,fps:i,setExecuting:b,pushNodeResult:x,clearResults:S,getNodeById:w,addNode:T,removeNode:E,updateNode:O,updateNodes:A,addEdge:ee,removeEdge:te,updateEdges:ne,loadWorkflowById:re,clearCanvas:ie,appendNodeIterationHistory:ae,setNodeIterationPage:M,clearNodeIterationHistory:oe,availableNodes:a,isLoadingNodeList:o,nodeListLoadedAt:s,loadNodeList:se,nodeExecutionStatuses:c,currentExecutionId:l,getNodeExecutionStatus:N,setNodeExecutionStatus:ce,clearNodeExecutionStatuses:le,loadExecutionStatus:P,vueFlowExecution:t,stopFPSCalculation:j}});var L=class{getStyleConfig(){return{}}getInputs(){return this.defineInputs()}getOutputs(){return this.defineOutputs()}getStyle(){return this.getStyleConfig()}getInput(e,t,n){if(e&&Object.prototype.hasOwnProperty.call(e,t))return e[t];let r=this.defineInputs().find(e=>e.name===t);return r&&r.defaultValue!==void 0?r.defaultValue:n}createOutput(e,t,n){let r=this.defineOutputs();if(r.length===1&&!this.isPlainObject(e)){let[i]=r;return{outputs:{[i.name]:e},raw:t??e,summary:n,success:!0}}return{outputs:this.isPlainObject(e)?e:{},raw:t??e,summary:n,success:!0}}createError(e){return{success:!1,error:e instanceof Error?e.message:e,outputs:{}}}validateInputs(e){let t=[],n=this.defineInputs();for(let r of n)if(r.required){let n=e[r.name];(n==null||n===``)&&t.push(`"${r.name}" æ˜¯å¿…å¡«é¡¹`)}return{valid:t.length===0,errors:t}}getMetadata(){return{type:this.type,label:this.label,description:this.description,category:this.category,inputs:this.defineInputs(),outputs:this.defineOutputs(),style:this.getStyleConfig()}}shouldUseCache(e,t){return!0}getCacheableInputs(e){return e}computeConfigHash(e,t={}){let n=this.getCacheableInputs(e),r={type:this.type,inputs:n};return this.hashObject(r)}hashObject(e){let t=this.stableStringify(e),n=5381;for(let e=0;e<t.length;e++)n=n*33^t.charCodeAt(e);return(n>>>0).toString(16)}stableStringify(e){return e==null?String(e):typeof e==`object`?Array.isArray(e)?`[`+e.map(e=>this.stableStringify(e)).join(`,`)+`]`:`{`+Object.keys(e).sort().map(t=>JSON.stringify(t)+`:`+this.stableStringify(e[t])).join(`,`)+`}`:JSON.stringify(e)}isPlainObject(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}},Dt=class{extractOutputs(e){let t=e.data;if(!t)return null;if(t.executionResult)return typeof t.executionResult==`object`&&!Array.isArray(t.executionResult)?t.executionResult:{default:t.executionResult};if(t.result?.data?.outputs){let e=t.result.data.outputs,n={};return Object.entries(e).forEach(([e,t])=>{t&&typeof t==`object`&&`value`in t?n[e]=t.value:n[e]=t}),n}return t.result?.data?.raw===void 0?null:{default:t.result.data.raw}}};function Ot(e,t,n){let r=new Set,i=[],a=new Map(n.map(e=>[e.id,e])),o=e=>{let n=t.filter(t=>t.target===e);for(let e of n){if(!e.source||r.has(e.source))continue;let t=a.get(e.source);if(!t)continue;let n=t.data?.config?.forNodeId;if(n){if(!a.get(n))continue;r.add(n),i.push(n),o(n);continue}r.add(e.source),i.push(e.source),o(e.source)}};return o(e),i}function kt(e,t,n){return e==null?[]:Array.isArray(e)?e.map((e,r)=>{let i=`${t}[${r}]`;n.set(i,e);let a=e!=null&&(Array.isArray(e)||typeof e==`object`);return{id:i,label:`[${r}]`,valueType:jt(e),reference:Mt(i),value:e,children:a?kt(e,i,n):[]}}):typeof e==`object`?Object.entries(e).filter(([e])=>e!==`type`).map(([e,r])=>{let i=`${t}.${e}`;n.set(i,r);let a=r!=null&&(Array.isArray(r)||typeof r==`object`);return{id:i,label:e,valueType:jt(r),reference:Mt(i),value:r,children:a?kt(r,i,n):[]}}):[]}function At(e,t,n,r){if(t==null)return[];let i=n&&e?`${n}.${e}`:n||e;if(Array.isArray(t))return t.map((e,t)=>{let n=`${i}[${t}]`;r.set(n,e);let a=e!=null&&(Array.isArray(e)||typeof e==`object`);return{id:n,label:`[${t}]`,valueType:jt(e),reference:Mt(n),value:e,children:a?kt(e,n,r):[]}});if(typeof t==`object`){let a=Object.entries(t).filter(([e])=>e!==`type`),o=(e,t)=>e.map(([e,n])=>{let i=`${t}.${e}`;r.set(i,n);let a=n!=null&&(Array.isArray(n)||typeof n==`object`);return{id:i,label:e,valueType:jt(n),reference:Mt(i),value:n,children:a?kt(n,i,r):[]}});if(!e)return o(a,i);r.set(i,t);let s=o(a,i);return[{id:i,label:e,valueType:`object`,reference:Mt(i),value:t,children:s,nodeId:n,outputId:e}]}return r.set(i,t),[{id:i,label:e,valueType:jt(t),reference:Mt(i),value:t,children:[],nodeId:n,outputId:e}]}function jt(e){return e===null?`null`:e===void 0?`undefined`:Array.isArray(e)?`array`:typeof e}function Mt(e){return`{{ ${e} }}`}function Nt(e,t,n,r,i,a){let o=new Map(t.map(e=>[e.id,e])),s=new Map,c=[],l=o.get(e),u=l?.parentNode||l?.data?.parentNode,d=Ot(e,n,t).reverse(),f=null;if(u){let e=o.get(u);if(e?.type===`forLoopContainer`&&(f=e.data?.config?.forNodeId,!f)){for(let e of t)if(e.type===`for`&&e.data?.config?.containerId===u){f=e.id;break}}}let p=r||new Dt;if(i&&Object.keys(i).length>0){let e=`å…¨å±€å˜é‡`,t={id:`global-variables`,label:`å…¨å±€å˜é‡`,valueType:`object`,reference:e,value:{},children:[]};Object.entries(i).forEach(([n,r])=>{s.set(`${e}.${n}`,r);let i=At(n,r,e,s);t.children?.push(...i)}),c.push(t)}return d.forEach(e=>{let t=o.get(e);if(!t)return;let n=t.label||t.data?.label||e,r=t.type,i=p.extractOutputs(t);if(r===`for`){let r=t.data?.config||{},i=r.containerId;if(u&&i&&u===i&&f===e){let i={id:e,label:n,valueType:`node`,value:null,children:[],nodeId:e},o=r.itemName||`item`,l=r.indexName||`index`,u,d,f=[],p=!1,m=t.data?.params?.items;if(m!=null){let e=Rt(m,s);Array.isArray(e)&&(f=e)}a?(u=a[o],d=a[l],p=!0):(u=f.length>0?f[0]:null,d=0);let h=At(o,u,n,s);!p&&h[0]&&(h[0].label=h[0].label+` [ç¤ºä¾‹]`),h[0]&&i.children?.push(h[0]);let g=At(l,d,n,s);!p&&g[0]&&(g[0].label=g[0].label+` [ç¤ºä¾‹]`),g[0]&&i.children?.push(g[0]);let _=`${n}.list`;s.set(_,f);let v={id:_,label:`list`,valueType:`array`,reference:Mt(_),value:f,children:f.length>0?kt(f,_,s):[],nodeId:e,outputId:`list`};i.children?.push(v),c.push(i);return}}if(!i||Object.keys(i).length===0)return;let l={id:e,label:n,valueType:`node`,value:null,children:[],nodeId:e};Object.entries(i).forEach(([e,t])=>{if(t===void 0)return;let r=t;if(r&&typeof r==`object`&&!Array.isArray(r)&&`data`in r){let e=r.data,t=r.isError;e&&typeof e==`object`&&(r={...e,...t===void 0?{}:{isError:t}})}let a=Object.keys(i);a.length===1&&a[0]===`default`?s.set(n,r):(s.set(n,r),s.set(`${n}.${e}`,r));let o=At(e,r,n,s);l.children?.push(...o)}),c.push(l)}),{tree:c.reverse(),map:s}}function Pt(e,t){let n=JSON.parse(JSON.stringify(e));return Ft(n,t)}function Ft(e,t){if(typeof e==`string`)return Rt(e,t);if(Array.isArray(e))return e.map(e=>Ft(e,t));if(e&&typeof e==`object`){let n={};return Object.entries(e).forEach(([e,r])=>{n[e]=Ft(r,t)}),n}return e}const It=/\{\{\s*\$?([^{}]+?)\s*\}\}/g;function Lt(e){return It.test(e)}function Rt(e,t){let n=[...e.matchAll(It)];if(n.length===0)return e;let r=n[0];if(!r)return e;if(n.length===1&&e.trim()===r[0]){let n=r[1];if(!n)return e;let i=n.trim(),a=t.get(i);return a===void 0?e:a}let i=e;return n.forEach(([e,n])=>{if(!n)return;let r=n.trim();if(!t.has(r))return;let a=t.get(r),o=typeof a==`string`?a:JSON.stringify(a,null,2);i=i.replace(e,o)}),i}var zt=f({DATA_TYPE_LABELS:()=>Vt,IfNode:()=>Ut,OPERATORS_BY_TYPE:()=>Ht,OPERATOR_LABELS:()=>Bt});const Bt={"is equal to":`ç­‰äº`,"is not equal to":`ä¸ç­‰äº`,exists:`å­˜åœ¨`,"does not exist":`ä¸å­˜åœ¨`,"is empty":`ä¸ºç©º`,"is not empty":`ä¸ä¸ºç©º`,contains:`åŒ…å«`,"does not contain":`ä¸åŒ…å«`,"starts with":`å¼€å¤´ä¸º`,"ends with":`ç»“å°¾ä¸º`,"is greater than":`å¤§äº`,"is less than":`å°äº`,"is greater than or equal to":`å¤§äºç­‰äº`,"is less than or equal to":`å°äºç­‰äº`,"is true":`ä¸ºçœŸ`,"is false":`ä¸ºå‡`,"is before":`æ—©äº`,"is after":`æ™šäº`,"is before or equal to":`æ—©äºæˆ–ç­‰äº`,"is after or equal to":`æ™šäºæˆ–ç­‰äº`,"length equal to":`é•¿åº¦ç­‰äº`,"length not equal to":`é•¿åº¦ä¸ç­‰äº`,"length greater than":`é•¿åº¦å¤§äº`,"length less than":`é•¿åº¦å°äº`,"length greater than or equal to":`é•¿åº¦å¤§äºç­‰äº`,"length less than or equal to":`é•¿åº¦å°äºç­‰äº`},Vt={string:`å­—ç¬¦ä¸²`,number:`æ•°å­—`,date:`æ—¥æœŸ`,boolean:`å¸ƒå°”å€¼`,array:`æ•°ç»„`,object:`å¯¹è±¡`},Ht={string:[`is equal to`,`is not equal to`,`contains`,`does not contain`,`starts with`,`ends with`,`exists`,`does not exist`,`is empty`,`is not empty`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],number:[`is equal to`,`is not equal to`,`is greater than`,`is less than`,`is greater than or equal to`,`is less than or equal to`,`exists`,`does not exist`],date:[`is equal to`,`is not equal to`,`is before`,`is after`,`is before or equal to`,`is after or equal to`,`exists`,`does not exist`],boolean:[`is equal to`,`is not equal to`,`is true`,`is false`,`exists`,`does not exist`],array:[`exists`,`does not exist`,`is empty`,`is not empty`,`contains`,`does not contain`,`length equal to`,`length not equal to`,`length greater than`,`length less than`,`length greater than or equal to`,`length less than or equal to`],object:[`exists`,`does not exist`,`is empty`,`is not empty`]};var Ut=class extends L{constructor(...e){super(...e),this.type=`if`,this.label=`æ¡ä»¶åˆ¤æ–­`,this.description=`æ ¹æ®æ¡ä»¶åˆ¤æ–­æ‰§è¡Œä¸åŒçš„åˆ†æ”¯`,this.category=`æµç¨‹æ§åˆ¶`,this.currentConfig=null}defineInputs(){return[{name:`config`,type:`object`,description:`æ¡ä»¶é…ç½®`,defaultValue:this.getDefaultConfig(),required:!1}]}defineOutputs(){return this.currentConfig?this.getOutputsForConfig(this.currentConfig):this.getOutputsForConfig(this.getDefaultConfig())}getOutputsForConfig(e){let t=e.conditions||[],n=Math.max(t.length,1),r=[];for(let e=0;e<n;e++){let n=t[e];r.push({name:this.getConditionOutputId(e),type:`any`,description:n?this.describeCondition(n):`æœªé…ç½®æ¡ä»¶`})}return r.push({name:`else`,type:`any`,description:`æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³æ—¶æ‰§è¡Œ`}),r}updateConfig(e){this.currentConfig=e}getDefaultConfig(){return{conditions:[{logic:`and`,subConditions:[{field:``,dataType:`string`,operator:`is equal to`,value:``}]}]}}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`â“`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`config`,this.getDefaultConfig());this.updateConfig(t);let n=Array.isArray(t.conditions)?t.conditions:[];console.log(`[IfNode] å¼€å§‹è¯„ä¼°æ¡ä»¶ï¼Œæ¡ä»¶æ•°é‡:`,n.length),console.log(`[IfNode] åŸå§‹æ¡ä»¶é…ç½®:`,JSON.stringify(n,null,2));let r=n.map((e,t)=>{console.log(`\n[IfNode] è¯„ä¼°æ¡ä»¶ ${t+1}:`,{logic:e.logic,subConditionsCount:e.subConditions.length});let n=e.subConditions.map((e,t)=>{console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - åŸå§‹å€¼:`,{field:e.field,value:e.value,operator:e.operator,dataType:e.dataType});let n=this.resolveOperandValue(e.field,e.dataType),r=this.resolveOperandValue(e.value,e.dataType);if(console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - è§£æåçš„å€¼:`,{actualValue:n,targetValue:r,actualType:typeof n,targetType:typeof r}),this.isEmptyCondition(e.field,e.value,e.operator))return console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - æœªé…ç½®ï¼ˆå·¦å³å€¼éƒ½ä¸ºç©ºï¼‰ï¼Œè¿”å› false`),{...e,actualValue:n,targetValue:r,result:!1};let i=this.compareValues(n,r,e.operator,e.dataType);return console.log(`  [IfNode] å­æ¡ä»¶ ${t+1} - æ¯”è¾ƒç»“æœ:`,i),{...e,actualValue:n,targetValue:r,result:i}}),r=e.logic===`or`?n.some(e=>e.result):n.every(e=>e.result);return console.log(`[IfNode] æ¡ä»¶ ${t+1} æœ€ç»ˆç»“æœ:`,{logic:e.logic,subResults:n.map(e=>e.result),conditionResult:r}),{index:t,outputId:this.getConditionOutputId(t),logic:e.logic,subResults:n,result:r}}),i=r.findIndex(e=>e.result),a=i!==-1;console.log(`
[IfNode] æ¡ä»¶è¯„ä¼°æ±‡æ€»:`,{totalConditions:r.length,firstPassedIndex:i,anyPassed:a,allResults:r.map((e,t)=>({index:t,outputId:e.outputId,result:e.result}))});let o={};r.forEach((e,t)=>{o[e.outputId]=t===i?{branch:e.outputId,passed:!0,evaluation:e,allEvaluations:r}:void 0}),o.else=a?void 0:{branch:`else`,passed:!1,allEvaluations:r};let s=i===-1?null:r[i];return console.log(`[IfNode] æœ€ç»ˆè¾“å‡ºç«¯å£:`,{selectedBranch:s?s.outputId:`else`,outputKeys:Object.keys(o),outputsWithData:Object.entries(o).filter(([e,t])=>t!==void 0).map(([e])=>e)}),this.createOutput(o,{branch:s?s.outputId:`else`,passed:a,evaluations:r},s?`æ¡ä»¶${i+1}æ»¡è¶³`:`æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæ‰§è¡Œ else`)}catch(e){return this.createError(e)}}getConditionOutputId(e){return`condition-${e}`}describeCondition(e){let{logic:t,subConditions:n}=e;if(!n||n.length===0)return`æœªé…ç½®å­æ¡ä»¶`;if(n.length===1)return this.describeSubCondition(n[0]);let r=t===`and`?` ä¸” `:` æˆ– `,i=n.map(e=>this.describeSubCondition(e)).join(r);return i.length>60?i.slice(0,57)+`...`:i}describeSubCondition(e){if(!e)return`æœªé…ç½®`;let t=this.formatOperand(e.field,`è¾“å…¥å€¼`),n=Bt[e.operator]||e.operator;if([`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(e.operator))return`${t} ${n}`;let r=this.truncateValue(e.value,20,`''`);return`${t} ${n} ${r}`}truncateValue(e,t=48,n=``){let r=this.formatOperand(e,n);return r?r.length<=t?r:`${r.slice(0,t-1)}â€¦`:n}formatOperand(e,t=``){if(e==null)return t;if(typeof e==`string`){let n=e.trim();return n.length>0?n:t}if(typeof e==`number`||typeof e==`boolean`)return String(e);if(e instanceof Date)return e.toISOString();try{return JSON.stringify(e)}catch{return String(e)}}isEmptyCondition(e,t,n){return[`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(n)?this.isOperandEmpty(e):this.isOperandEmpty(e)&&this.isOperandEmpty(t)}isOperandEmpty(e){return e==null?!0:typeof e==`string`?e.trim()===``:!1}resolveOperandValue(e,t){return e==null?e:this.coerceValueByType(e,t)}coerceValueByType(e,t){if(e==null)return e;switch(t){case`number`:{if(typeof e==`number`)return e;if(typeof e==`boolean`)return e?1:0;if(typeof e==`string`){let t=Number(e);return Number.isNaN(t)?e:t}let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`number`)return e!==0;if(typeof e==`string`){let t=e.toLowerCase();if([`true`,`1`,`yes`].includes(t))return!0;if([`false`,`0`,`no`].includes(t))return!1}return!!e;case`date`:if(e instanceof Date)return e;if(typeof e==`number`)return new Date(e);if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?e:t}return e;case`array`:if(Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return[];try{let n=JSON.parse(t);return Array.isArray(n)?n:e}catch{return e}}return e;case`object`:if(e&&typeof e==`object`&&!Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return{};try{let n=JSON.parse(t);return n&&typeof n==`object`?n:e}catch{return e}}return e;default:return typeof e==`string`?e:String(e)}}compareValues(e,t,n,r){console.log(`    [IfNode.compareValues] æ¯”è¾ƒå‚æ•°:`,{actual:e,target:t,operator:n,dataType:r,actualType:typeof e,targetType:typeof t});let i;switch(n){case`is equal to`:return i=this.compareEquality(e,t,r),console.log(`    [IfNode.compareValues] is equal to ç»“æœ:`,i),i;case`is not equal to`:return!this.compareEquality(e,t,r);case`exists`:return e!=null;case`does not exist`:return e==null;case`is empty`:return e==null?!0:typeof e==`string`?e.trim().length===0:Array.isArray(e)?e.length===0:typeof e==`object`?Object.keys(e).length===0:!1;case`is not empty`:return e==null?!1:typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:typeof e==`object`?Object.keys(e).length>0:!0;case`contains`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?e.includes(t):!1;case`does not contain`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?!e.includes(t):!0;case`starts with`:return typeof e==`string`&&typeof t==`string`?e.startsWith(t):!1;case`ends with`:return typeof e==`string`&&typeof t==`string`?e.endsWith(t):!1;case`is greater than`:return Number(e)>Number(t);case`is less than`:return Number(e)<Number(t);case`is greater than or equal to`:return Number(e)>=Number(t);case`is less than or equal to`:return Number(e)<=Number(t);case`is true`:return e===!0;case`is false`:return e===!1;case`is before`:return new Date(e)<new Date(t);case`is after`:return new Date(e)>new Date(t);case`is before or equal to`:return new Date(e)<=new Date(t);case`is after or equal to`:return new Date(e)>=new Date(t);case`length equal to`:return this.getLength(e)===Number(t);case`length not equal to`:return this.getLength(e)!==Number(t);case`length greater than`:return this.getLength(e)>Number(t);case`length less than`:return this.getLength(e)<Number(t);case`length greater than or equal to`:return this.getLength(e)>=Number(t);case`length less than or equal to`:return this.getLength(e)<=Number(t);default:return!1}}getLength(e){return typeof e==`string`||Array.isArray(e)?e.length:typeof e==`object`&&e?Object.keys(e).length:0}compareEquality(e,t,n){let r=this.normalizeEqualityValue(e,n),i=this.normalizeEqualityValue(t,n);return n===`array`||n===`object`?pe(r,i):r===i}normalizeEqualityValue(e,t){if(e==null)return e;switch(t){case`number`:{let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`string`){let t=e.trim().toLowerCase();if(t===`true`||t===`1`)return!0;if(t===`false`||t===`0`)return!1}return typeof e==`number`?e===1:!!e;case`date`:{let t=e instanceof Date?e.getTime():new Date(e).getTime();return Number.isNaN(t)?e:t}case`string`:return String(e);default:return e}}},Wt=f({CodeNode:()=>qt}),Gt=`export async function main(params) {
  return {
    receivedKeys: Object.keys(params),
    example: params,
  };
}`,Kt=/^[A-Za-z][A-Za-z0-9_]*$/,qt=class extends L{constructor(...e){super(...e),this.type=`code`,this.label=`ä»£ç æ‰§è¡Œ`,this.description=`æ‰§è¡Œè‡ªå®šä¹‰ TypeScript/JavaScript ä»£ç `,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`dataItems`,type:`array`,description:`å‚æ•°å¯¹è±¡ï¼ˆå¦‚æä¾›åˆ™è¦†ç›–ç”± dataItems æ„å»ºçš„å‚æ•°ï¼‰`,required:!1},{name:`code`,type:`string`,description:`åŠ¨æ€ä»£ç ï¼ˆå¦‚æä¾›åˆ™è¦†ç›–é…ç½®ä¸­çš„ codeï¼‰`,required:!1}]}defineOutputs(){return[{name:`result`,type:`any`,description:`æ‰§è¡Œç»“æœ`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],showIcon:!0}}getDefaultConfig(){return{code:Gt,dataItems:[]}}shouldUseCache(e,t){return!1}async execute(e,t){try{let t=this.getDefaultConfig(),n=this.getInput(e,`code`,``),r=typeof n==`string`&&n.trim()?n:void 0,i=this.getInput(e,`dataItems`,null),a=Array.isArray(i),o=i&&typeof i==`object`&&!a?i:void 0,s=r??t.code,c=o??this.buildParams(a?i:t.dataItems),l=this.prepareRuntime(s);try{let e=Function(`params`,l)(c),t=e instanceof Promise?await e:e,n={result:t};return this.createOutput(n,t,this.buildSummary(t,Object.keys(c)))}catch(e){throw Error(`ä»£ç æ‰§è¡Œé”™è¯¯: ${e?.message??e}`)}}catch(e){return this.createError(e)}}buildParams(e){let t={},n=new Set;return e.forEach((e,r)=>{let i=(e?.key??``).trim();if(!i){console.error(`ç¬¬ ${r+1} é¡¹çš„é”®åä¸èƒ½ä¸ºç©º`);return}if(!Kt.test(i)){console.error(`ç¬¬ ${r+1} é¡¹çš„é”®å "${i}" æ— æ•ˆï¼šä»…æ”¯æŒä»¥å­—æ¯å¼€å¤´ï¼Œç”±å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ç»„æˆ`);return}if(n.has(i)){console.error(`æ£€æµ‹åˆ°é‡å¤çš„é”®å "${i}"ï¼Œè¯·ç¡®ä¿å”¯ä¸€`);return}n.add(i),t[i]=e?.value}),t}prepareRuntime(e){return`"use strict";
${this.normalizeExports(e)}

if (typeof main !== "function") {
  throw new Error("main å‡½æ•°æœªå®šä¹‰ï¼Œè¯·ç¡®ä¿å¯¼å‡º export function main(params) {}");
}

const result = main(params);
return result;`}normalizeExports(e){let t=e;return[[/export\s+default\s+async\s+function\s+main/g,`async function main`],[/export\s+default\s+function\s+main/g,`function main`],[/export\s+async\s+function\s+main/g,`async function main`],[/export\s+function\s+main/g,`function main`],[/export\s+default\s+main\s*;?/g,``],[/export\s+{\s*main\s+as\s+default\s*};?/g,``],[/export\s+const\s+main\s*=\s*/g,`const main = `],[/export\s+let\s+main\s*=\s*/g,`let main = `],[/export\s+var\s+main\s*=\s*/g,`var main = `]].forEach(([e,n])=>{t=t.replace(e,n)}),t}buildSummary(e,t){let n=t.length>0?t.join(`, `):`æ— `,r=this.formatValue(e);return`main(params) æ‰§è¡Œå®Œæˆ | å‚æ•°é”®: [${n}] | ç»“æœ: ${r}`}formatValue(e){if(e===null)return`null`;if(e===void 0)return`undefined`;if(typeof e==`string`)return e.length>40?`"${e.slice(0,37)}..."`:`"${e}"`;if(typeof e==`number`||typeof e==`boolean`)return String(e);if(Array.isArray(e))return`Array(${e.length})`;if(typeof e==`object`){let t=Object.keys(e);if(t.length===0)return`{}`;let n=t.slice(0,3).join(`, `),r=t.length>3?`, ...`:``;return`{ ${n}${r} }`}return String(e)}},Jt=f({ConnectorNode:()=>Yt}),Yt=class extends L{constructor(...e){super(...e),this.type=`connector`,this.label=`è¿æ¥`,this.description=`ç”¨äºä¼˜åŒ–è¿æ¥çº¿å¸ƒå±€ï¼Œæ‰§è¡Œæ—¶è¿”å› undefined`,this.category=`å·¥å…·`}defineInputs(){return[]}defineOutputs(){return[{name:`output`,type:`any`,description:`è¾“å‡ºæ•°æ®ï¼ˆundefinedï¼‰`}]}getStyleConfig(){return{}}async execute(e,t){return this.createOutput({output:void 0},void 0,`è¿æ¥èŠ‚ç‚¹ï¼šå·²è¿”å› undefined`)}},Xt=f({ArrayFilterNode:()=>Qt,DataMergeNode:()=>Zt}),Zt=class extends L{constructor(...e){super(...e),this.type=`data-merge`,this.label=`æ•°æ®åˆå¹¶`,this.description=`å°†å¤šä¸ªè¾“å…¥åˆå¹¶ä¸ºä¸€ä¸ªå¯¹è±¡`,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`input1`,type:`any`,description:`è¾“å…¥æ•°æ®1`,multiple:!0},{name:`input2`,type:`any`,description:`è¾“å…¥æ•°æ®2`,multiple:!0},{name:`input3`,type:`any`,description:`è¾“å…¥æ•°æ®3`}]}defineOutputs(){return[{name:`merged`,type:`object`,description:`åˆå¹¶åçš„å¯¹è±¡`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#ec4899`],icon:`ğŸ”—`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`input1`),n=this.getInput(e,`input2`),r=this.getInput(e,`input3`),i={data1:t,data2:n,data3:r,mergedAt:new Date().toISOString()};return this.createOutput(i)}catch(e){return this.createError(e)}}},Qt=class extends L{constructor(...e){super(...e),this.type=`array-filter`,this.label=`æ•°ç»„è¿‡æ»¤`,this.description=`æ ¹æ®æ¡ä»¶è¿‡æ»¤æ•°ç»„å…ƒç´ `,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`array`,type:`array`,description:`è¾“å…¥æ•°ç»„`,required:!0},{name:`condition`,type:`string`,description:`è¿‡æ»¤æ¡ä»¶ï¼ˆJavaScript è¡¨è¾¾å¼ï¼Œä½¿ç”¨ item è¡¨ç¤ºå½“å‰å…ƒç´ ï¼‰`,required:!0,defaultValue:`item > 0`}]}defineOutputs(){return[{name:`filtered`,type:`array`,description:`è¿‡æ»¤åçš„æ•°ç»„`},{name:`count`,type:`number`,description:`è¿‡æ»¤åçš„å…ƒç´ æ•°é‡`}]}getStyleConfig(){return{headerColor:`#10b981`,icon:`ğŸ”`,showIcon:!0,headerStyle:{fontWeight:`600`}}}async execute(e,t){try{let t=this.getInput(e,`array`,[]),n=this.getInput(e,`condition`,`true`);if(!Array.isArray(t))return this.createError(`è¾“å…¥å¿…é¡»æ˜¯æ•°ç»„ç±»å‹`);let r=Function(`item`,`return ${n}`),i=t.filter(r);return this.createOutput({filtered:i,count:i.length},i,`è¿‡æ»¤å®Œæˆï¼š${t.length} -> ${i.length} é¡¹`)}catch(e){return this.createError(e)}}},$t=f({DelayNode:()=>en}),en=class extends L{constructor(...e){super(...e),this.type=`delay`,this.label=`å»¶è¿Ÿ`,this.description=`æš‚åœå·¥ä½œæµæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´`,this.category=`æ§åˆ¶æµ`}defineInputs(){return[{name:`delay`,type:`number`,description:`å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰`,required:!0,defaultValue:1e3}]}defineOutputs(){return[{name:`output`,type:`any`,description:`å»¶è¿Ÿåè¾“å‡ºçš„æ•°æ®`}]}getStyleConfig(){return{headerColor:[`#f59e0b`,`#d97706`],icon:`â±ï¸`,showIcon:!0}}shouldUseCache(e,t){return!1}async execute(e,t){try{let n=this.getInput(e,`delay`,1e3);return console.log(`DelayNode execute`,n),typeof n!=`number`||n<0?this.createError(`å»¶è¿Ÿæ—¶é—´å¿…é¡»æ˜¯éè´Ÿæ•°`):n===0?this.createOutput({output:void 0}):(await this.sleep(n,t.signal),this.createOutput({output:void 0},void 0,`å»¶è¿Ÿ ${n}ms å®Œæˆ`))}catch(e){return e instanceof Error&&e.name===`AbortError`?this.createError(`å»¶è¿Ÿè¢«å–æ¶ˆ`):this.createError(e)}}sleep(e,t){return new Promise((n,r)=>{if(t?.aborted){let e=Error(`å»¶è¿Ÿè¢«å–æ¶ˆ`);e.name=`AbortError`,r(e);return}let i=setTimeout(()=>{o(),n()},e),a=()=>{o();let e=Error(`å»¶è¿Ÿè¢«å–æ¶ˆ`);e.name=`AbortError`,r(e)},o=()=>{clearTimeout(i),t?.removeEventListener(`abort`,a)};t?.addEventListener(`abort`,a)})}},tn=f({EndNode:()=>nn}),nn=class extends L{constructor(...e){super(...e),this.type=`end`,this.label=`ç»“æŸ`,this.description=`å·¥ä½œæµç¨‹çš„ç»“æŸèŠ‚ç‚¹`,this.category=`æ§åˆ¶æµ`}defineInputs(){return[{name:`input`,type:`any`,description:`æ¥æ”¶ä»»æ„è¾“å…¥`,required:!1}]}defineOutputs(){return[]}getStyleConfig(){return{headerColor:[`#ef4444`,`#dc2626`],icon:`â¹ï¸`,showIcon:!0}}async execute(e,t){let n=this.getInput(e,`input`,null);return{success:!0,summary:`å·¥ä½œæµç»“æŸ`,outputs:{},raw:{completed:!0,timestamp:Date.now(),finalInput:n}}}},rn=f({ForNode:()=>an}),an=class extends L{constructor(...e){super(...e),this.type=`for`,this.label=`æ‰¹å¤„ç†`,this.description=`éå†é›†åˆå¹¶è¿è¡Œå¾ªç¯ä½“`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{name:`items`,type:`array`,description:`è¾“å…¥é›†åˆ`,required:!1}]}defineOutputs(){return[{name:`loop`,type:`any`,description:`å¾ªç¯ä½“`},{name:`next`,type:`any`,description:`å¾ªç¯ç»“æŸ`}]}getStyleConfig(){return{headerColor:[`#f97316`,`#ea580c`],showIcon:!0}}async execute(e,t){try{let n=this.getInput(e,`items`,[]);if(!Array.isArray(n))throw Error(`å¾ªç¯æºæ•°æ®å¿…é¡»æ˜¯æ•°ç»„`);let r=t.nodeData||{},i={...this.getDefaultConfig(),...r.config||{}};if(!i.containerId)throw Error(`For èŠ‚ç‚¹æœªé…ç½®å¾ªç¯ä½“å®¹å™¨`);if(!t.executeContainer)throw Error(`æ‰§è¡Œä¸Šä¸‹æ–‡ç¼ºå°‘ executeContainer æ–¹æ³•`);let a=n.map((e,t)=>({[i.itemName]:e,[i.indexName]:t,list:n}));if(a.length===0)return this.createOutput({next:{totalCount:0,executedCount:0,successCount:0,errorCount:0,results:[],summary:`æ— è¿­ä»£æ•°æ®`}},{count:0},`æ— è¿­ä»£æ•°æ®`);let o=i.pagination,s=o?.enabled??!1,c=o?.pageSize??10,l=o?.currentPage??1,u=a,d=0,f=a.length;s&&c>0?(d=(l-1)*c,f=Math.min(d+c,a.length),u=a.slice(d,f),console.log(`[ForNode] å¯ç”¨åˆ†é¡µï¼šç¬¬ ${l} é¡µï¼Œæ¯é¡µ ${c} æ¡ï¼Œæ‰§è¡Œ ${u.length} æ¬¡è¿­ä»£ï¼ˆæ€»å…± ${a.length} æ¬¡ï¼‰`)):console.log(`[ForNode] å¼€å§‹æ‰§è¡Œå¾ªç¯ï¼Œå…± ${a.length} æ¬¡è¿­ä»£`);let p=[];for(let e=0;e<u.length;e++){let n=d+e,r=u[e]||{};console.log(`[ForNode] æ‰§è¡Œç¬¬ ${n+1}/${a.length} æ¬¡è¿­ä»£`,r);try{let e=await t.executeContainer(i.containerId,r);p.push({index:n,variables:r,result:e,status:`success`})}catch(e){let t=e instanceof Error?e.message:String(e);if(console.error(`[ForNode] ç¬¬ ${n+1} æ¬¡è¿­ä»£å¤±è´¥:`,t),p.push({index:n,variables:r,error:t,status:`error`}),!i.errorHandling?.continueOnError)throw e}}let m=a.length,h=u.length,g=p.filter(e=>e.status===`success`).length,_=p.filter(e=>e.status===`error`).length,v={next:{totalCount:m,executedCount:h,successCount:g,errorCount:_,results:p,pagination:s?{enabled:!0,currentPage:l,pageSize:c,totalPages:Math.ceil(m/c),startIndex:d,endIndex:f-1}:void 0,summary:s?`ç¬¬ ${l} é¡µï¼šæ‰§è¡Œ ${h} æ¬¡ï¼ŒæˆåŠŸ ${g} æ¬¡ï¼Œå¤±è´¥ ${_} æ¬¡`:`å¾ªç¯æ‰§è¡Œ ${h} æ¬¡ï¼ŒæˆåŠŸ ${g} æ¬¡ï¼Œå¤±è´¥ ${_} æ¬¡`}};return this.createOutput(v,{totalCount:m,executedCount:h,successCount:g,errorCount:_},v.next.summary)}catch(e){return this.createError(e)}}getDefaultConfig(){return{mode:`variable`,variable:``,range:{start:0,end:10,step:1},itemName:`item`,indexName:`index`,containerId:null,errorHandling:{continueOnError:!1}}}},on=f({HttpRequestNode:()=>sn,JsonParseNode:()=>cn,ObjectGetNode:()=>ln}),sn=class extends L{constructor(...e){super(...e),this.type=`http-request`,this.label=`HTTP è¯·æ±‚`,this.description=`å‘é€ HTTP è¯·æ±‚å¹¶è¿”å›å“åº”`,this.category=`ç½‘ç»œ`}defineInputs(){return[{name:`url`,type:`string`,description:`è¯·æ±‚ URL`,required:!0},{name:`method`,type:`string`,description:`è¯·æ±‚æ–¹æ³•ï¼ˆGET/POST/PUT/DELETE/PATCHï¼‰`,defaultValue:`GET`},{name:`headers`,type:`object`,description:`è¯·æ±‚å¤´ï¼ˆJSON å¯¹è±¡ï¼‰`,defaultValue:{}},{name:`body`,type:`any`,description:`è¯·æ±‚ä½“ï¼ˆPOST/PUT/PATCH æ—¶ä½¿ç”¨ï¼‰`},{name:`timeout`,type:`number`,description:`è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰`,defaultValue:3e4}]}defineOutputs(){return[{name:`data`,type:`any`,description:`å“åº”æ•°æ®`},{name:`status`,type:`number`,description:`HTTP çŠ¶æ€ç `},{name:`headers`,type:`object`,description:`å“åº”å¤´`},{name:`success`,type:`boolean`,description:`è¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆçŠ¶æ€ç  2xxï¼‰`}]}getStyleConfig(){return{headerColor:[`#3b82f6`,`#06b6d4`],icon:`ğŸŒ`,showIcon:!0,bodyStyle:{minWidth:`240px`}}}async execute(e,t){try{let n=this.getInput(e,`url`),r=this.getInput(e,`method`,`GET`),i=this.getInput(e,`headers`,{}),a=this.getInput(e,`body`),o=this.getInput(e,`timeout`,3e4),s=this.validateInputs(e);if(!s.valid)return this.createError(s.errors.join(`; `));if(t.signal?.aborted)return this.createError(`è¯·æ±‚å·²ä¸­æ­¢`);let c={method:r,headers:{"Content-Type":`application/json`,...i},signal:t.signal};[`POST`,`PUT`,`PATCH`].includes(r)&&a!==void 0&&(c.body=typeof a==`string`?a:JSON.stringify(a));let l=new AbortController,u=setTimeout(()=>l.abort(),o);try{let e=await fetch(n,{...c,signal:l.signal});clearTimeout(u);let t,i=e.headers.get(`content-type`);t=i?.includes(`application/json`)?await e.json():i?.includes(`text/`)?await e.text():await e.blob();let a={};e.headers.forEach((e,t)=>{a[t]=e});let o=e.ok;return this.createOutput({data:t,status:e.status,headers:a,success:o},t,`${r} ${n} - ${e.status} ${e.statusText}`)}catch(e){if(clearTimeout(u),e.name===`AbortError`)return this.createError(`è¯·æ±‚è¶…æ—¶`);throw e}}catch(e){return this.createError(e)}}},cn=class extends L{constructor(...e){super(...e),this.type=`json-parse`,this.label=`JSON è§£æ`,this.description=`å°† JSON å­—ç¬¦ä¸²è§£æä¸ºå¯¹è±¡`,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`json`,type:`string`,description:`JSON å­—ç¬¦ä¸²`,required:!0}]}defineOutputs(){return[{name:`data`,type:`object`,description:`è§£æåçš„å¯¹è±¡`}]}getStyleConfig(){return{headerColor:`#8b5cf6`,icon:`ğŸ“‹`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`json`,``),n=this.validateInputs(e);if(!n.valid)return this.createError(n.errors.join(`; `));let r=JSON.parse(t);return this.createOutput(r,r,`è§£ææˆåŠŸ`)}catch(e){return this.createError(`JSON è§£æå¤±è´¥: ${e.message}`)}}},ln=class extends L{constructor(...e){super(...e),this.type=`object-get`,this.label=`å¯¹è±¡å–å€¼`,this.description=`ä»å¯¹è±¡ä¸­æå–æŒ‡å®šè·¯å¾„çš„å€¼`,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{name:`object`,type:`object`,description:`è¾“å…¥å¯¹è±¡`,required:!0},{name:`path`,type:`string`,description:`å¯¹è±¡è·¯å¾„ï¼ˆå¦‚ "user.name" æˆ– "items[0].id"ï¼‰`,required:!0},{name:`defaultValue`,type:`any`,description:`é»˜è®¤å€¼ï¼ˆè·¯å¾„ä¸å­˜åœ¨æ—¶è¿”å›ï¼‰`}]}defineOutputs(){return[{name:`value`,type:`any`,description:`æå–çš„å€¼`}]}getStyleConfig(){return{headerColor:`#f59e0b`,icon:`ğŸ”‘`,showIcon:!0}}async execute(e,t){try{let t=this.getInput(e,`object`),n=this.getInput(e,`path`,``),r=this.getInput(e,`defaultValue`),i=this.validateInputs(e);if(!i.valid)return this.createError(i.errors.join(`; `));let a=this.getValueByPath(t,n,r);return this.createOutput(a,a,`æå–è·¯å¾„: ${n}`)}catch(e){return this.createError(e)}}getValueByPath(e,t,n){if(!e||!t)return n;let r=t.replace(/\[(\w+)\]/g,`.$1`).split(`.`).filter(e=>e.length>0),i=e;for(let e of r){if(i==null)return n;i=i[e]}return i===void 0?n:i}},un=f({NoteNode:()=>dn}),dn=class extends L{constructor(...e){super(...e),this.type=`note`,this.label=`ç¬”è®°`,this.description=`åœ¨å·¥ä½œæµä¸­æ·»åŠ æ³¨é‡Šå’Œè¯´æ˜`,this.category=`å·¥å…·`}defineInputs(){return[]}defineOutputs(){return[]}getStyleConfig(){return{headerColor:`#fbbf24`,icon:`ğŸ“`,showIcon:!0}}async execute(e,t){return{success:!0,summary:`ç¬”è®°èŠ‚ç‚¹ï¼ˆè·³è¿‡æ‰§è¡Œï¼‰`,outputs:{}}}},fn=f({StartNode:()=>pn}),pn=class extends L{constructor(...e){super(...e),this.type=`start`,this.label=`å¼€å§‹`,this.description=`å·¥ä½œæµç¨‹çš„èµ·å§‹èŠ‚ç‚¹`,this.category=`æ§åˆ¶æµ`}defineInputs(){return[]}defineOutputs(){return[{name:`output`,type:`any`,description:`å¼€å§‹ä¿¡å·`}]}getStyleConfig(){return{headerColor:[`#10b981`,`#059669`],showIcon:!0}}async execute(e,t){return console.log(`[StartNode execute]`,t),this.createOutput({output:{started:!0,timestamp:Date.now(),workflowId:t.workflow?.workflowId,datas:{name:`John Doe`,age:30,address:{street:`123 Main St`,city:`Anytown`}},lists:[{name:`John Doe`,age:30},{name:`IXOA Doe`,age:10},{name:`UN NJH Doe`,age:25}],maps:{name:`John Doe`,age:30}}})}},mn=f({TextProcessNode:()=>hn}),hn=class extends L{constructor(...e){super(...e),this.type=`text-process`,this.label=`æ–‡æœ¬å¤„ç†`,this.description=`å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œè½¬æ¢å¤„ç†`,this.category=`æ–‡æœ¬å·¥å…·`}defineInputs(){return[{name:`text`,type:`string`,description:`è¾“å…¥æ–‡æœ¬`,required:!0},{name:`mode`,type:`string`,description:`å¤„ç†æ¨¡å¼`,defaultValue:`uppercase`,options:[{label:`å¤§å†™`,value:`uppercase`},{label:`å°å†™`,value:`lowercase`},{label:`åè½¬`,value:`reverse`}]},{name:`prefix`,type:`string`,description:`æ·»åŠ å‰ç¼€`,defaultValue:``}]}defineOutputs(){return[{name:`result`,type:`string`,description:`å¤„ç†åçš„æ–‡æœ¬`},{name:`length`,type:`number`,description:`æ–‡æœ¬é•¿åº¦`}]}getStyleConfig(){return{headerColor:`#3b82f6`,icon:`ğŸ“`,showIcon:!0,bodyStyle:{minWidth:`200px`}}}async execute(e,t){try{let t=this.getInput(e,`text`,``).toString(),n=this.getInput(e,`mode`,`uppercase`),r=this.getInput(e,`prefix`,``),i=this.validateInputs(e);if(!i.valid)return this.createError(i.errors.join(`; `));let a=t;switch(n){case`uppercase`:a=t.toUpperCase();break;case`lowercase`:a=t.toLowerCase();break;case`reverse`:a=t.split(``).reverse().join(``);break}return r&&(a=r+a),this.createOutput({result:a,length:a.length})}catch(e){return this.createError(e)}}},gn=f({ImagePreviewNode:()=>_n}),_n=class extends L{constructor(...e){super(...e),this.type=`preview`,this.label=`å›¾ç‰‡é¢„è§ˆ`,this.description=`é¢„è§ˆå›¾ç‰‡ï¼Œæ”¯æŒå®Œæ•´ URL æˆ–ç›¸å¯¹è·¯å¾„`,this.category=`è°ƒè¯•å·¥å…·`}defineInputs(){return[{name:`imageUrl`,type:`string`,description:`å›¾ç‰‡ URL`,required:!1},{name:`baseUrl`,type:`string`,description:`åŸºç¡€ URL`,required:!1}]}defineOutputs(){return[{name:`imageUrl`,type:`string`,description:`å¤„ç†åçš„å›¾ç‰‡åœ°å€`},{name:`imageInfo`,type:`object`,description:`å›¾ç‰‡çš„å…ƒæ•°æ®ä¿¡æ¯`}]}getStyleConfig(){return{headerColor:[`#8b5cf6`,`#7c3aed`],icon:`ğŸ–¼ï¸`,showIcon:!0,bodyStyle:{minWidth:`300px`}}}async execute(e,t){try{let t=this.getInput(e,`imageUrl`,``),n=this.getInput(e,`baseUrl`,``),r;if(!t)return this.createError(`è¯·æä¾›å›¾ç‰‡ URL æˆ–ç›¸å¯¹è·¯å¾„`);if(t.startsWith(`http://`)||t.startsWith(`https://`))r=t;else{if(!n)return this.createError(`ç›¸å¯¹è·¯å¾„éœ€è¦æä¾› baseUrl`);r=this.concatenateUrl(n,t)}let i={url:r,type:`url`,size:`æœªçŸ¥`};try{if(typeof window<`u`&&`Image`in window){let e=await this.getImageDimensions(r);i={...i,width:e.width,height:e.height}}}catch(e){console.warn(`æ— æ³•è·å–å›¾ç‰‡å°ºå¯¸:`,e)}let a=`å›¾ç‰‡é¢„è§ˆ`;return i.width&&i.height&&(a=`å›¾ç‰‡: ${i.width}x${i.height}`),this.createOutput({imageUrl:r,imageInfo:i},a)}catch(e){return this.createError(e)}}concatenateUrl(e,t){if(t.startsWith(`http://`)||t.startsWith(`https://`))return t;let n=e.endsWith(`/`)?e.slice(0,-1):e,r=t.startsWith(`/`)?t.slice(1):t;return`${n}/${r}`}getImageDimensions(e){return new Promise((t,n)=>{let r=document.createElement(`img`);r.onload=()=>{t({width:r.naturalWidth,height:r.naturalHeight})},r.onerror=()=>{n(Error(`æ— æ³•åŠ è½½å›¾ç‰‡`))},r.src=e,setTimeout(()=>{n(Error(`åŠ è½½å›¾ç‰‡è¶…æ—¶`))},5e3)})}};const vn={};var yn={"./nodes/CodeNode.ts":Wt,"./nodes/ConnectorNode.ts":Jt,"./nodes/DataTransformNode.ts":Xt,"./nodes/DelayNode.ts":$t,"./nodes/EndNode.ts":tn,"./nodes/ForNode.ts":rn,"./nodes/HttpRequestNode.ts":on,"./nodes/IfNode.ts":zt,"./nodes/NoteNode.ts":un,"./nodes/StartNode.ts":fn,"./nodes/TextProcessNode.ts":mn,"./nodes/previewNode.ts":gn};for(let e in yn){let t=yn[e];for(let e in t){let n=t[e];if(typeof n==`function`&&n.prototype)try{let e=new n;e&&typeof e.type==`string`&&(vn[e.type]=n)}catch{}}}function bn(e){let t=vn[e];if(!t)throw Error(`æœªçŸ¥çš„èŠ‚ç‚¹ç±»å‹: ${e}`);return new t}var xn={},Sn={class:`w-4 h-4`,viewBox:`0 0 24 24`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function Cn(e,t){return E(),c(`svg`,Sn,[...t[0]||=[d(`path`,{d:`M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1),d(`path`,{d:`M15 12a3 3 0 11-6 0 3 3 0 016 0z`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1)]])}var wn=I(xn,[[`render`,Cn]]),Tn={},En={viewBox:`0 0 24 24`,class:`n8n-icon`,"aria-hidden":`true`,focusable:`false`,role:`img`,"data-icon":`external-link`};function Dn(e,t){return E(),c(`svg`,En,[...t[0]||=[d(`path`,{fill:`none`,stroke:`currentColor`,"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M15 3h6v6m-11 5L21 3m-3 10v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6`},null,-1)]])}var On=I(Tn,[[`render`,Dn]]);const kn=S(`ui`,()=>{let e=C(!1),t=C(null),n=C(`medium`),r=C(null),i=C({x:0,y:0}),a={small:280,medium:360,large:480},o=k(()=>r.value??a[n.value]),s=C(!1),c=C({title:``,content:``,type:`info`}),l=C(!1),u=C({title:``,content:``,language:`javascript`}),d=C(!1),f=C(!1),p=C({value:``,onSave:null}),m=C(!1),h=C({title:``,content:``,language:`javascript`,onSave:null}),g=C(null),_=C(null),v=C(null),y=Ie(),b=k(()=>y.value?.tagName!==`INPUT`&&y.value?.tagName!==`TEXTAREA`&&!y.value?.isContentEditable),x=k(()=>s.value||l.value||d.value||f.value||m.value),S=k(()=>x.value?!1:b.value);function w(n){t.value===n&&e.value?e.value=!1:(t.value=n,e.value=!0)}function T(){e.value=!1}function E(){t.value||=`workflows`,e.value=!0}function D(){e.value=!e.value}function O(e){n.value=e,r.value=null}function A(e){r.value=e}function ee(){n.value=`medium`,r.value=null,i.value={x:0,y:0}}function te(e,t,n=`info`){c.value={title:e,content:t,type:n},s.value=!0}function ne(){s.value=!1}function re(e,t,n=`javascript`){u.value={title:e,content:t,language:n},l.value=!0}function ie(){l.value=!1}function j(e){g.value=e,e&&(d.value=!0)}function ae(){g.value=null,d.value=!1,t.value===`node-config`&&(e.value=!1)}function M(){g.value&&(d.value=!0)}function oe(){d.value=!1}function se(e,t){p.value={value:e,onSave:t},f.value=!0}function N(){f.value=!1,setTimeout(()=>{p.value={value:``,onSave:null}},300)}function ce(n,r){_.value=n,v.value=r,t.value=`node-result-preview`,e.value=!0}function le(){_.value=null,v.value=null,t.value===`node-result-preview`&&(e.value=!1)}function P(e,t,n=`javascript`,r){h.value={title:e,content:t,language:n,onSave:r||null},m.value=!0}function F(){m.value=!1,setTimeout(()=>{h.value={title:``,content:``,language:`javascript`,onSave:null}},300)}return{hasModalOpen:x,hasFoucsInput:b,enableShortcut:S,floatingPanelVisible:e,activeTab:t,panelSize:n,customPanelWidth:r,panelPosition:i,panelWidth:o,infoModalVisible:s,infoModalContent:c,editorModalVisible:l,editorModalContent:u,nodeConfigModalVisible:d,variableEditorModalVisible:f,variableEditorModalContent:p,editorPanelModalVisible:m,editorPanelContent:h,selectedNodeId:g,previewNodeId:_,previewNodeData:v,setActiveTab:w,closeFloatingPanel:T,openFloatingPanel:E,toggleFloatingPanel:D,setPanelSize:O,setCustomPanelWidth:A,resetPanel:ee,showInfoModal:te,closeInfoModal:ne,showEditorModal:re,closeEditorModal:ie,selectNode:j,clearNodeSelection:ae,openNodeConfigModal:M,closeNodeConfigModal:oe,openVariableEditorModal:se,closeVariableEditorModal:N,openEditorPanelModal:P,closeEditorPanelModal:F,showNodePreview:ce,clearNodePreview:le}});var An={},jn={class:`w-4 h-4`,viewBox:`0 0 24 24`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function Mn(e,t){return E(),c(`svg`,jn,[...t[0]||=[d(`path`,{d:`M6 18L18 6M6 6l12 12`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`},null,-1)]])}var Nn=I(An,[[`render`,Mn]]),Pn={key:0,class:`shrink-0 text-slate-500`},Fn={class:`flex-1 min-w-0`},In={key:0,class:`text-sm font-semibold leading-6 text-slate-900`},Ln={key:1,class:`mt-1 text-xs leading-5 text-slate-500`},Rn={class:`flex items-center gap-2 shrink-0`},zn=v({__name:`PanelShell`,props:{title:{default:void 0},description:{default:void 0},closable:{type:Boolean,default:!1},size:{default:`md`},padding:{default:`md`},elevated:{type:Boolean,default:!1},headerSticky:{type:Boolean,default:!1},footerSticky:{type:Boolean,default:!1}},emits:[`close`],setup(e,{emit:t}){let o=e,l=t,u=ae(),f=k(()=>({sm:`w-72`,md:`w-80`,lg:`w-96`,xl:`w-[28rem]`,full:`w-full`})[o.size]),m=k(()=>({none:`p-0`,xs:`px-4 py-3`,sm:`px-4 py-4`,md:`px-5 py-5`,lg:`px-6 py-6`})[o.padding]),g=k(()=>!!(o.title||o.description||u.header||u.icon||u.actions||o.closable)),{headerSticky:_,footerSticky:v,elevated:y}=i(o);return(t,i)=>{let o=O(`n-button`);return E(),c(`section`,{class:a([`panel-shell flex flex-col rounded-xl border border-slate-200 bg-white text-slate-900 shadow-sm transition-shadow duration-200`,s(y)?`shadow-lg`:`shadow-sm`,f.value])},[g.value?(E(),c(`header`,{key:0,class:a([`flex items-center gap-3 border-b border-slate-200 px-4`,e.description?`items-start py-3`:`items-center py-2`,s(_)?`sticky top-0 z-10 bg-white/95 backdrop-blur supports-backdrop-filter:bg-white/80`:``])},[t.$slots.icon?(E(),c(`div`,Pn,[j(t.$slots,`icon`,{},void 0,!0)])):h(``,!0),d(`div`,Fn,[e.title?(E(),c(`h2`,In,n(e.title),1)):h(``,!0),e.description?(E(),c(`p`,Ln,n(e.description),1)):h(``,!0),j(t.$slots,`header`,{},void 0,!0)]),d(`div`,Rn,[j(t.$slots,`actions`,{},void 0,!0),e.closable?(E(),p(o,{key:0,text:``,class:`h-9! w-9! min-w-0! p-0!`,onClick:i[0]||=e=>l(`close`)},{default:M(()=>[r(Nn,{class:`h-4 w-4`})]),_:1})):h(``,!0)])],2)):h(``,!0),d(`div`,{class:a([`flex-1 overflow-auto variable-scroll`,m.value])},[j(t.$slots,`default`,{},void 0,!0)],2),t.$slots.footer?(E(),c(`footer`,{key:1,class:a([`border-t border-slate-200 px-5 py-3`,s(v)?`sticky bottom-0 z-10 bg-white/95 backdrop-blur supports-backdrop-filter:bg-white/80`:``])},[j(t.$slots,`footer`,{},void 0,!0)],2)):h(``,!0)],2)}}}),Bn=I(zn,[[`__scopeId`,`data-v-5b177938`]]),Vn={key:0,class:`flex items-center justify-between px-5 py-3 bg-white border-b border-slate-200 shrink-0`},Hn={class:`flex items-center gap-3`},Un={key:0,class:`flex items-center justify-center w-7 h-7 rounded-lg bg-linear-to-br from-purple-500 to-purple-700 text-white transition-transform duration-200 hover:scale-105`},Wn={key:1,class:`flex items-center justify-center w-7 h-7 rounded-lg bg-linear-to-br from-purple-500 to-purple-700 text-white transition-transform duration-200 hover:scale-105`},Gn={class:`flex-1 min-w-0`},Kn={key:0,class:`text-[15px] font-medium text-[#1a1a1a] tracking-tight`},qn={key:1,class:`mt-1 text-sm text-slate-500`},Jn={class:`flex items-center gap-2`},Yn={key:1,class:`border-t border-slate-200 px-6 py-4`},Xn=v({__name:`ModalShell`,props:{modelValue:{type:Boolean},title:{default:void 0},description:{default:void 0},width:{default:`lg`},padding:{default:`md`},closable:{type:Boolean,default:!0},closeOnOverlay:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},verticalAlign:{default:`center`},zIndex:{default:60}},emits:[`update:modelValue`,`close`],setup(e,{emit:o}){let l=e,u=o,f=ae(),{modelValue:v,closeOnEsc:b,verticalAlign:x}=i(l),S=k(()=>!!(l.title||l.description||f.header||f.icon||f.actions||l.closable)),C=k(()=>({sm:`max-w-md`,md:`max-w-lg`,lg:`max-w-3xl`,xl:`max-w-4xl`,"2xl":`max-w-5xl`,full:`w-[95vw] h-[95vh]`})[l.width]),T=k(()=>({none:`p-0`,sm:`px-5 py-5`,md:`px-6 py-6`,lg:`px-8 py-8`})[l.padding]),D=()=>{u(`update:modelValue`,!1),u(`close`)},O=()=>{l.closeOnOverlay&&D()};g(()=>{v.value&&document.body.classList.add(`overflow-hidden`)}),y(()=>{document.body.classList.remove(`overflow-hidden`)}),w(()=>v.value,e=>{if(e){document.body.classList.add(`overflow-hidden`);return}document.body.classList.remove(`overflow-hidden`)});let{zIndex:A,closable:te}=i(l);return(i,o)=>(E(),p(t,{to:`body`},[r(_,{name:s(x)===`top`?`slide-up`:`fade`},{default:M(()=>[s(v)?(E(),c(`div`,{key:0,style:ee({zIndex:s(A).toString()}),class:a([`fixed inset-0 flex justify-center bg-black/10 backdrop-blur-sm transition`,s(x)===`center`?`items-center`:`items-end`]),onClick:m(O,[`self`])},[d(`div`,{class:a([`modal-shell relative mx-auto flex w-10/12 flex-col overflow-hidden bg-[#fafafa] text-slate-900 shadow-[0_8px_40px_rgba(0,0,0,0.08)]`,C.value,s(x)===`center`?l.width===`full`?`rounded-md border border-slate-200`:`my-auto max-h-[calc(100vh-4rem)] rounded-md border border-slate-200`:`max-h-[85vh] rounded-t-2xl`]),role:`dialog`,"aria-modal":`true`},[S.value?(E(),c(`header`,Vn,[d(`div`,Hn,[i.$slots.icon?(E(),c(`div`,Un,[j(i.$slots,`icon`,{},void 0,!0)])):e.title?(E(),c(`div`,Wn,[r(wn,{class:`w-4 h-4`})])):h(``,!0),d(`div`,Gn,[e.title?(E(),c(`h2`,Kn,n(e.title),1)):h(``,!0),e.description?(E(),c(`p`,qn,n(e.description),1)):h(``,!0),j(i.$slots,`header`,{},void 0,!0)])]),d(`div`,Jn,[j(i.$slots,`actions`,{},void 0,!0),s(te)?(E(),c(`button`,{key:0,class:`flex items-center justify-center w-7 h-7 rounded-lg text-slate-400 transition-colors duration-200 hover:bg-slate-100 hover:text-slate-700`,onClick:o[0]||=e=>D()},[r(Nn,{class:`w-4 h-4`})])):h(``,!0)])])):h(``,!0),d(`div`,{class:a([`flex-1 overflow-auto variable-scroll`,T.value])},[j(i.$slots,`default`,{},void 0,!0)],2),i.$slots.footer?(E(),c(`footer`,Yn,[j(i.$slots,`footer`,{},void 0,!0)])):h(``,!0)],2)],6)):h(``,!0)]),_:3},8,[`name`])]))}}),Zn=I(Xn,[[`__scopeId`,`data-v-bfb4b045`]]),Qn={},$n={width:`14`,height:`14`,viewBox:`0 0 14 14`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`};function er(e,t){return E(),c(`svg`,$n,[...t[0]||=[d(`path`,{d:`M3.69653 4.35645L3.29907 4.80566L3.33813 4.97559H4.36157C4.15258 6.18457 3.99633 7.27441 3.69653 8.9541C3.33813 11.0967 3.13207 11.623 3.01 11.8154C2.90258 12.0059 2.74829 12.1045 2.5393 12.1045C2.30981 12.1045 1.89477 11.9229 1.67211 11.7168C1.59204 11.6621 1.49731 11.6758 1.39672 11.7422C1.19555 11.9121 1.00024 12.1738 1.00024 12.4082C0.988519 12.7246 1.41137 13 1.81469 13C2.17016 13 2.6936 12.7773 3.24438 12.2539C3.99731 11.54 4.56079 10.5605 5.03149 8.44336C5.33422 7.0918 5.4768 6.21289 5.68969 4.97656L6.96118 4.86133L7.23657 4.35645H5.80493C6.17504 2.02832 6.46411 1.68359 6.81957 1.68359C7.0559 1.68359 7.33129 1.86523 7.6477 2.22266C7.74145 2.35156 7.88207 2.33789 7.9895 2.25C8.17016 2.14258 8.39282 1.86719 8.40747 1.61719C8.41821 1.3418 8.09008 1 7.52563 1C7.01391 1 6.22973 1.3418 5.57055 2.01367C4.99243 2.62598 4.68969 3.39062 4.48071 4.35645H3.69653ZM7.76489 5.91504C8.15942 5.38965 8.39575 5.21484 8.51782 5.21484C8.64379 5.21484 8.74438 5.33887 8.9602 6.03613L9.32934 7.22656C8.61547 8.31836 8.09301 8.92676 7.77563 8.92676C7.67016 8.92676 7.56372 8.89355 7.48852 8.81934C7.4143 8.74512 7.33227 8.68359 7.25219 8.68359C6.99047 8.68359 6.66625 9.00098 6.66039 9.39453C6.65454 9.7959 6.93579 10.083 7.30493 10.083C7.93872 10.083 8.47485 9.46094 9.51 7.81152L9.81274 8.83203C10.0725 9.70898 10.3772 10.083 10.7581 10.083C11.2288 10.083 11.8616 9.68164 12.552 8.59668L12.2629 8.2666C11.8479 8.7666 11.5725 9.00098 11.4094 9.00098C11.2278 9.00098 11.0686 8.72363 10.8586 8.04199L10.4163 6.60352C10.678 6.21777 10.9358 5.89355 11.1623 5.63477C11.4319 5.32715 11.6399 5.19629 11.7815 5.19629C11.9006 5.19629 12.0041 5.24707 12.0686 5.31836C12.1536 5.41211 12.2043 5.45605 12.3049 5.45605C12.5325 5.45605 12.884 5.16699 12.8967 4.78418C12.9084 4.42871 12.6877 4.12598 12.3049 4.12598C11.7268 4.12598 11.217 4.62402 10.2356 6.08301L10.0334 5.45703C9.75024 4.57812 9.56274 4.12598 9.16821 4.12598C8.70922 4.12598 8.07836 4.69043 7.46118 5.58496L7.76489 5.91504Z`,fill:`#7D838F`},null,-1)]])}var tr=I(Qn,[[`render`,er],[`__scopeId`,`data-v-6c4a700e`]]),nr=v({__name:`Dropdown`,props:{modelValue:{type:Boolean,default:!1},dropdownClass:{default:``},offset:{default:4},placement:{default:`bottom-start`},widthMode:{default:`trigger`}},emits:[`update:modelValue`],setup(n,{expose:i,emit:s}){let l=n,u=s,f=C(null),h=C(null),v=C(l.modelValue),y=C({top:0,left:0,width:0}),b=k(()=>{let e={position:`fixed`,top:`${y.value.top}px`,left:`${y.value.left}px`,zIndex:9999};return l.widthMode===`trigger`&&y.value.width&&(e.width=`${y.value.width}px`),e});w(()=>l.modelValue,e=>{v.value=e,e&&D()}),w(v,e=>{u(`update:modelValue`,e),e&&D()});function x(){v.value=!v.value}function S(){v.value=!1}function D(){if(!f.value)return;let e=f.value.getBoundingClientRect(),t=h.value,n=t?.offsetHeight||0,r=0,i=0;l.placement.startsWith(`bottom`)?r=e.bottom+l.offset:l.placement.startsWith(`top`)&&(r=e.top-n-l.offset),l.placement.endsWith(`start`)?i=e.left:l.placement.endsWith(`end`)&&(i=e.right-(t?.offsetWidth||0));let a=window.innerWidth,o=window.innerHeight,s=t?.offsetWidth||0;i+s>a-10&&(i=a-s-10),i<10&&(i=10),r+n>o-10&&l.placement.startsWith(`bottom`)&&(r=e.top-n-l.offset),r<10&&(r=10),y.value={top:r,left:i,width:e.width}}function O(){v.value&&D()}function A(){v.value&&D()}function te(e){if(!v.value)return;let t=e.target,n=f.value,r=h.value;n&&!n.contains(t)&&r&&!r.contains(t)&&S()}return g(()=>{window.addEventListener(`scroll`,O,!0),window.addEventListener(`resize`,A),document.addEventListener(`mousedown`,te,!0)}),e(()=>{window.removeEventListener(`scroll`,O,!0),window.removeEventListener(`resize`,A),document.removeEventListener(`mousedown`,te,!0)}),i({toggle:x,close:S,updatePosition:D}),(e,i)=>(E(),c(`div`,{ref_key:`triggerRef`,ref:f,class:`relative`},[j(e.$slots,`trigger`,{toggle:x,show:v.value}),(E(),p(t,{to:`body`},[r(_,{"enter-active-class":`transition duration-150 ease-out`,"enter-from-class":`opacity-0 scale-95`,"enter-to-class":`opacity-100 scale-100`,"leave-active-class":`transition duration-100 ease-in`,"leave-from-class":`opacity-100 scale-100`,"leave-to-class":`opacity-0 scale-95`},{default:M(()=>[T(d(`div`,{ref_key:`dropdownRef`,ref:h,class:a([`absolute rounded-lg border border-slate-200 bg-white shadow-xl`,n.dropdownClass]),style:ee(b.value),onMousedown:i[0]||=m(()=>{},[`prevent`])},[j(e.$slots,`default`,{close:S})],38),[[o,v.value]])]),_:3})]))],512))}});function rr(e){return{id:e.id,type:e.type||`custom`,label:e.data?.label||e.label,position:e.position,data:e.data||{},parentNode:e.parentNode}}function ir(e){return{id:e.id,source:e.source,sourceHandle:e.sourceHandle||void 0,target:e.target,targetHandle:e.targetHandle||void 0,data:e.data||{}}}function ar(e,t,n,r){let i=t.map(rr),a=n.map(ir);return Nt(e,i,a,void 0,r)}function or(){let e=kn(),t=Et(),n=yt(),{selectedNodeId:r}=ce(e),i=k(()=>{if(!r.value)return null;try{let e=t.nodes||[],i=t.edges||[],a=n.getGlobalVariableJson();return console.log(`[useVariableContext] æå–å˜é‡`,e,i),ar(r.value,e,i,a)}catch(e){return console.error(`[useVariableContext] æå–å˜é‡ä¸Šä¸‹æ–‡å¤±è´¥:`,e),null}}),a=k(()=>i.value?.tree||[]),o=k(()=>i.value?.map||new Map);return{variableContext:i,variableTree:a,contextMap:o}}var sr=[`innerHTML`],cr={key:1,class:`p-3 bg-white/90 border border-slate-200 rounded-md shadow-sm`},lr=[`innerHTML`],ur=v({__name:`VariablePreview`,props:{value:{},currentItemIndex:{default:void 0},inline:{type:Boolean,default:!1}},setup(e){let t=e,{contextMap:n}=or(),r=k(()=>{let e=t.value;if(!e||typeof e!=`string`||!/\{\{\s*\$?[^{}]+?\s*\}\}/.test(e)||!n.value||n.value.size===0)return``;try{let r=Pt({preview:e},n.value).preview;return r===e?``:t.currentItemIndex!==void 0&&Array.isArray(r)&&r[t.currentItemIndex]!==void 0?o(r[t.currentItemIndex]):o(r)}catch(e){return`è§£æé”™è¯¯: ${e}`}}),i=k(()=>{let e=t.value;if(!e||typeof e!=`string`||!/\{\{\s*\$?[^{}]+?\s*\}\}/.test(e)||!n.value||n.value.size===0)return``;try{return a(e,n.value,t.currentItemIndex)}catch(e){return s(`è§£æé”™è¯¯: ${e}`)}});function a(e,t,n){let r=/\{\{\s*\$?[^{}]+?\s*\}\}/g,i=0,a=``,c;for(;(c=r.exec(e))!==null;){let r=c[0],l=c.index;a+=s(e.slice(i,l));let u=Pt({temp:r},t),d;d=n!==void 0&&Array.isArray(u.temp)?o(u.temp[n]):o(u.temp),a+=`<span class="inline-flex items-baseline mx-[1px] bg-indigo-100/80 text-[12px] font-medium text-indigo-700 shadow-sm" title="${s(r)}">${s(d)}</span>`,i=l+r.length}return a+=s(e.slice(i)),a}function o(e){if(e==null)return``;if(typeof e==`object`)try{return JSON.stringify(e,null,2)}catch{return String(e)}return String(e)}function s(e){return e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/"/g,`&quot;`).replace(/'/g,`&#39;`)}return(t,n)=>e.inline&&r.value?(E(),c(`div`,{key:0,class:`text-xs text-slate-700 whitespace-pre-wrap wrap-break-word`,style:{"font-family":`'Fira Code', 'Courier New', 'Microsoft YaHei', 'SimHei', monospace`},innerHTML:i.value},null,8,sr)):!e.inline&&r.value?(E(),c(`div`,cr,[n[0]||=d(`div`,{class:`flex items-center justify-between mb-2`},[d(`span`,{class:`text-[10px] font-semibold tracking-wide text-slate-500`},`å®æ—¶é¢„è§ˆ`),d(`span`,{class:`text-[9px] text-slate-400`},`å·²è§£æå˜é‡`)],-1),d(`div`,{class:`text-xs text-slate-700 whitespace-pre-wrap wrap-break-word max-h-32 overflow-y-auto variable-scroll`,style:{"font-family":`'Fira Code', 'Courier New', 'Microsoft YaHei', 'SimHei', monospace`},innerHTML:i.value},null,8,lr)])):h(``,!0)}});function R(e){this.content=e}R.prototype={constructor:R,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return t==-1?void 0:this.content[t+1]},update:function(e,t,n){var r=n&&n!=e?this.remove(n):this,i=r.find(e),a=r.content.slice();return i==-1?a.push(n||e,t):(a[i+1]=t,n&&(a[i]=n)),new R(a)},remove:function(e){var t=this.find(e);if(t==-1)return this;var n=this.content.slice();return n.splice(t,2),new R(n)},addToStart:function(e,t){return new R([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new R(n)},addBefore:function(e,t,n){var r=this.remove(t),i=r.content.slice(),a=r.find(e);return i.splice(a==-1?i.length:a,0,t,n),new R(i)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return e=R.from(e),e.size?new R(e.content.concat(this.subtract(e).content)):this},append:function(e){return e=R.from(e),e.size?new R(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=R.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach(function(t,n){e[t]=n}),e},get size(){return this.content.length>>1}},R.from=function(e){if(e instanceof R)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new R(t)};var dr=R;function fr(e,t,n){for(let r=0;;r++){if(r==e.childCount||r==t.childCount)return e.childCount==t.childCount?null:n;let i=e.child(r),a=t.child(r);if(i==a){n+=i.nodeSize;continue}if(!i.sameMarkup(a))return n;if(i.isText&&i.text!=a.text){for(let e=0;i.text[e]==a.text[e];e++)n++;return n}if(i.content.size||a.content.size){let e=fr(i.content,a.content,n+1);if(e!=null)return e}n+=i.nodeSize}}function pr(e,t,n,r){for(let i=e.childCount,a=t.childCount;;){if(i==0||a==0)return i==a?null:{a:n,b:r};let o=e.child(--i),s=t.child(--a),c=o.nodeSize;if(o==s){n-=c,r-=c;continue}if(!o.sameMarkup(s))return{a:n,b:r};if(o.isText&&o.text!=s.text){let e=0,t=Math.min(o.text.length,s.text.length);for(;e<t&&o.text[o.text.length-e-1]==s.text[s.text.length-e-1];)e++,n--,r--;return{a:n,b:r}}if(o.content.size||s.content.size){let e=pr(o.content,s.content,n-1,r-1);if(e)return e}n-=c,r-=c}}var z=class e{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let t=0;t<e.length;t++)this.size+=e[t].nodeSize}nodesBetween(e,t,n,r=0,i){for(let a=0,o=0;o<t;a++){let s=this.content[a],c=o+s.nodeSize;if(c>e&&n(s,r+o,i||null,a)!==!1&&s.content.size){let i=o+1;s.nodesBetween(Math.max(0,e-i),Math.min(s.content.size,t-i),n,r+i)}o=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let i=``,a=!0;return this.nodesBetween(e,t,(o,s)=>{let c=o.isText?o.text.slice(Math.max(e,s)-s,t-s):o.isLeaf?r?typeof r==`function`?r(o):r:o.type.spec.leafText?o.type.spec.leafText(o):``:``;o.isBlock&&(o.isLeaf&&c||o.isTextblock)&&n&&(a?a=!1:i+=n),i+=c},0),i}append(t){if(!t.size)return this;if(!this.size)return t;let n=this.lastChild,r=t.firstChild,i=this.content.slice(),a=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),a=1);a<t.content.length;a++)i.push(t.content[a]);return new e(i,this.size+t.size)}cut(t,n=this.size){if(t==0&&n==this.size)return this;let r=[],i=0;if(n>t)for(let e=0,a=0;a<n;e++){let o=this.content[e],s=a+o.nodeSize;s>t&&((a<t||s>n)&&(o=o.isText?o.cut(Math.max(0,t-a),Math.min(o.text.length,n-a)):o.cut(Math.max(0,t-a-1),Math.min(o.content.size,n-a-1))),r.push(o),i+=o.nodeSize),a=s}return new e(r,i)}cutByIndex(t,n){return t==n?e.empty:t==0&&n==this.content.length?this:new e(this.content.slice(t,n))}replaceChild(t,n){let r=this.content[t];if(r==n)return this;let i=this.content.slice(),a=this.size+n.nodeSize-r.nodeSize;return i[t]=n,new e(i,a)}addToStart(t){return new e([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new e(this.content.concat(t),this.size+t.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw RangeError(`Index `+e+` out of range for `+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return fr(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return pr(this,e,t,n)}findIndex(e){if(e==0)return hr(0,e);if(e==this.size)return hr(this.content.length,e);if(e>this.size||e<0)throw RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let r=this.child(t),i=n+r.nodeSize;if(i>=e)return i==e?hr(t+1,i):hr(t,n);n=i}}toString(){return`<`+this.toStringInner()+`>`}toStringInner(){return this.content.join(`, `)}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(t,n){if(!n)return e.empty;if(!Array.isArray(n))throw RangeError(`Invalid input for Fragment.fromJSON`);return new e(n.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return e.empty;let n,r=0;for(let e=0;e<t.length;e++){let i=t[e];r+=i.nodeSize,e&&i.isText&&t[e-1].sameMarkup(i)?(n||=t.slice(0,e),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new e(n||t,r)}static from(t){if(!t)return e.empty;if(t instanceof e)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new e([t],t.nodeSize);throw RangeError(`Can not convert `+t+` to a Fragment`+(t.nodesBetween?` (looks like multiple versions of prosemirror-model were loaded)`:``))}};z.empty=new z([],0);var mr={index:0,offset:0};function hr(e,t){return mr.index=e,mr.offset=t,mr}function gr(e,t){if(e===t)return!0;if(!(e&&typeof e==`object`)||!(t&&typeof t==`object`))return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!gr(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!gr(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}var B=class e{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let i=e[r];if(this.eq(i))return e;if(this.type.excludes(i.type))t||=e.slice(0,r);else if(i.type.excludes(this.type))return e;else !n&&i.type.rank>this.type.rank&&(t||=e.slice(0,r),t.push(this),n=!0),t&&t.push(i)}return t||=e.slice(),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&gr(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw RangeError(`Invalid input for Mark.fromJSON`);let n=e.marks[t.type];if(!n)throw RangeError(`There is no mark type ${t.type} in this schema`);let r=n.create(t.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return e.none;if(t instanceof e)return[t];let n=t.slice();return n.sort((e,t)=>e.type.rank-t.type.rank),n}};B.none=[];var _r=class extends Error{},V=class e{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,n){let r=yr(this.content,t+this.openStart,n);return r&&new e(r,this.openStart,this.openEnd)}removeBetween(t,n){return new e(vr(this.content,t+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+`(`+this.openStart+`,`+this.openEnd+`)`}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(t,n){if(!n)return e.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!=`number`||typeof i!=`number`)throw RangeError(`Invalid input for Slice.fromJSON`);return new e(z.fromJSON(t,n.content),r,i)}static maxOpen(t,n=!0){let r=0,i=0;for(let e=t.firstChild;e&&!e.isLeaf&&(n||!e.type.spec.isolating);e=e.firstChild)r++;for(let e=t.lastChild;e&&!e.isLeaf&&(n||!e.type.spec.isolating);e=e.lastChild)i++;return new e(t,r,i)}};V.empty=new V(z.empty,0,0);function vr(e,t,n){let{index:r,offset:i}=e.findIndex(t),a=e.maybeChild(r),{index:o,offset:s}=e.findIndex(n);if(i==t||a.isText){if(s!=n&&!e.child(o).isText)throw RangeError(`Removing non-flat range`);return e.cut(0,t).append(e.cut(n))}if(r!=o)throw RangeError(`Removing non-flat range`);return e.replaceChild(r,a.copy(vr(a.content,t-i-1,n-i-1)))}function yr(e,t,n,r){let{index:i,offset:a}=e.findIndex(t),o=e.maybeChild(i);if(a==t||o.isText)return r&&!r.canReplace(i,i,n)?null:e.cut(0,t).append(n).append(e.cut(t));let s=yr(o.content,t-a-1,n,o);return s&&e.replaceChild(i,o.copy(s))}function br(e,t,n){if(n.openStart>e.depth)throw new _r(`Inserted content deeper than insertion position`);if(e.depth-n.openStart!=t.depth-n.openEnd)throw new _r(`Inconsistent open depths`);return xr(e,t,n,0)}function xr(e,t,n,r){let i=e.index(r),a=e.node(r);if(i==t.index(r)&&r<e.depth-n.openStart){let o=xr(e,t,n,r+1);return a.copy(a.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&e.depth==r&&t.depth==r){let r=e.parent,i=r.content;return Er(r,i.cut(0,e.parentOffset).append(n.content).append(i.cut(t.parentOffset)))}else{let{start:i,end:o}=kr(n,e);return Er(a,Dr(e,i,o,t,r))}else return Er(a,Or(e,t,r))}function Sr(e,t){if(!t.type.compatibleContent(e.type))throw new _r(`Cannot join `+t.type.name+` onto `+e.type.name)}function Cr(e,t,n){let r=e.node(n);return Sr(r,t.node(n)),r}function wr(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function Tr(e,t,n,r){let i=(t||e).node(n),a=0,o=t?t.index(n):i.childCount;e&&(a=e.index(n),e.depth>n?a++:e.textOffset&&(wr(e.nodeAfter,r),a++));for(let e=a;e<o;e++)wr(i.child(e),r);t&&t.depth==n&&t.textOffset&&wr(t.nodeBefore,r)}function Er(e,t){return e.type.checkContent(t),e.copy(t)}function Dr(e,t,n,r,i){let a=e.depth>i&&Cr(e,t,i+1),o=r.depth>i&&Cr(n,r,i+1),s=[];return Tr(null,e,i,s),a&&o&&t.index(i)==n.index(i)?(Sr(a,o),wr(Er(a,Dr(e,t,n,r,i+1)),s)):(a&&wr(Er(a,Or(e,t,i+1)),s),Tr(t,n,i,s),o&&wr(Er(o,Or(n,r,i+1)),s)),Tr(r,null,i,s),new z(s)}function Or(e,t,n){let r=[];if(Tr(null,e,n,r),e.depth>n){let i=Cr(e,t,n+1);wr(Er(i,Or(e,t,n+1)),r)}return Tr(t,null,n,r),new z(r)}function kr(e,t){let n=t.depth-e.openStart,r=t.node(n).copy(e.content);for(let e=n-1;e>=0;e--)r=t.node(e).copy(z.from(r));return{start:r.resolveNoCache(e.openStart+n),end:r.resolveNoCache(r.content.size-e.openEnd-n)}}var Ar=class e{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw RangeError(`There is no position before the top-level node`);return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw RangeError(`There is no position after the top-level node`);return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],r=t==0?0:this.path[t*3-1]+1;for(let t=0;t<e;t++)r+=n.child(t).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return B.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let e=n;n=r,r=e}let i=n.marks;for(var a=0;a<i.length;a++)i[a].type.spec.inclusive===!1&&(!r||!i[a].isInSet(r.marks))&&(i=i[a--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var i=0;i<n.length;i++)n[i].type.spec.inclusive===!1&&(!r||!n[i].isInSet(r.marks))&&(n=n[i--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new Pr(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e=``;for(let t=1;t<=this.depth;t++)e+=(e?`/`:``)+this.node(t).type.name+`_`+this.index(t-1);return e+`:`+this.parentOffset}static resolve(t,n){if(!(n>=0&&n<=t.content.size))throw RangeError(`Position `+n+` out of range`);let r=[],i=0,a=n;for(let e=t;;){let{index:t,offset:n}=e.content.findIndex(a),o=a-n;if(r.push(e,t,i+n),!o||(e=e.child(t),e.isText))break;a=o-1,i+=n+1}return new e(n,r,a)}static resolveCached(t,n){let r=Nr.get(t);if(r)for(let e=0;e<r.elts.length;e++){let t=r.elts[e];if(t.pos==n)return t}else Nr.set(t,r=new jr);let i=r.elts[r.i]=e.resolve(t,n);return r.i=(r.i+1)%Mr,i}},jr=class{constructor(){this.elts=[],this.i=0}},Mr=12,Nr=new WeakMap,Pr=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},Fr=Object.create(null),Ir=class e{constructor(e,t,n,r=B.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||z.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,``)}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&gr(this.attrs,t||e.defaultAttrs||Fr)&&B.sameSet(this.marks,n||B.none)}copy(t=null){return t==this.content?this:new e(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new e(this.type,this.attrs,this.content,t)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return V.empty;let r=this.resolve(e),i=this.resolve(t),a=n?0:r.sharedDepth(t),o=r.start(a),s=r.node(a).content.cut(r.pos-o,i.pos-o);return new V(s,r.depth-a,i.depth-a)}replace(e,t,n){return br(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return Ar.resolveCached(this,e)}resolveNoCache(e){return Ar.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,e=>(n.isInSet(e.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+=`(`+this.content.toStringInner()+`)`),Rr(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw Error(`Called contentMatchAt on a node with invalid content`);return t}canReplace(e,t,n=z.empty,r=0,i=n.childCount){let a=this.contentMatchAt(e).matchFragment(n,r,i),o=a&&a.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let e=r;e<i;e++)if(!this.type.allowsMarks(n.child(e).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(e).matchType(n),a=i&&i.matchFragment(this.content,t);return a?a.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=B.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!B.sameSet(e,this.marks))throw RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(e=>e.toJSON())),e}static fromJSON(e,t){if(!t)throw RangeError(`Invalid input for Node.fromJSON`);let n;if(t.marks){if(!Array.isArray(t.marks))throw RangeError(`Invalid mark data for Node.fromJSON`);n=t.marks.map(e.markFromJSON)}if(t.type==`text`){if(typeof t.text!=`string`)throw RangeError(`Invalid text node in JSON`);return e.text(t.text,n)}let r=z.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,r,n);return i.type.checkAttrs(i.attrs),i}};Ir.prototype.text=void 0;var Lr=class e extends Ir{constructor(e,t,n,r){if(super(e,t,null,r),!n)throw RangeError(`Empty text nodes are not allowed`);this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Rr(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function Rr(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+`(`+t+`)`;return t}var zr=class e{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(t,n){let r=new Br(t,n);if(r.next==null)return e.empty;let i=Vr(r);r.next&&r.err(`Unexpected trailing text`);let a=Zr(Jr(i));return Qr(a,r),a}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let i=t;r&&i<n;i++)r=r.matchType(e.child(i).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];function i(a,o){let s=a.matchFragment(e,n);if(s&&(!t||s.validEnd))return z.from(o.map(e=>e.createAndFill()));for(let e=0;e<a.next.length;e++){let{type:t,next:n}=a.next[e];if(!(t.isText||t.hasRequiredAttrs())&&r.indexOf(n)==-1){r.push(n);let e=i(n,o.concat(t));if(e)return e}}return null}return i(this,[])}findWrapping(e){for(let t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),i=r.match;if(i.matchType(e)){let e=[];for(let t=r;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<i.next.length;e++){let{type:a,next:o}=i.next[e];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!r.type||o.validEnd)&&(n.push({match:a.contentMatch,type:a,via:r}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let r=0;r<n.next.length;r++)e.indexOf(n.next[r].next)==-1&&t(n.next[r].next)}return t(this),e.map((t,n)=>{let r=n+(t.validEnd?`*`:` `)+` `;for(let n=0;n<t.next.length;n++)r+=(n?`, `:``)+t.next[n].type.name+`->`+e.indexOf(t.next[n].next);return r}).join(`
`)}};zr.empty=new zr(!0);var Br=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==``&&this.tokens.pop(),this.tokens[0]==``&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw SyntaxError(e+` (in content expression '`+this.string+`')`)}};function Vr(e){let t=[];do t.push(Hr(e));while(e.eat(`|`));return t.length==1?t[0]:{type:`choice`,exprs:t}}function Hr(e){let t=[];do t.push(Ur(e));while(e.next&&e.next!=`)`&&e.next!=`|`);return t.length==1?t[0]:{type:`seq`,exprs:t}}function Ur(e){let t=qr(e);for(;;)if(e.eat(`+`))t={type:`plus`,expr:t};else if(e.eat(`*`))t={type:`star`,expr:t};else if(e.eat(`?`))t={type:`opt`,expr:t};else if(e.eat(`{`))t=Gr(e,t);else break;return t}function Wr(e){/\D/.test(e.next)&&e.err(`Expected number, got '`+e.next+`'`);let t=Number(e.next);return e.pos++,t}function Gr(e,t){let n=Wr(e),r=n;return e.eat(`,`)&&(r=e.next==`}`?-1:Wr(e)),e.eat(`}`)||e.err(`Unclosed braced range`),{type:`range`,min:n,max:r,expr:t}}function Kr(e,t){let n=e.nodeTypes,r=n[t];if(r)return[r];let i=[];for(let e in n){let r=n[e];r.isInGroup(t)&&i.push(r)}return i.length==0&&e.err(`No node type or group '`+t+`' found`),i}function qr(e){if(e.eat(`(`)){let t=Vr(e);return e.eat(`)`)||e.err(`Missing closing paren`),t}else if(/\W/.test(e.next))e.err(`Unexpected token '`+e.next+`'`);else{let t=Kr(e,e.next).map(t=>(e.inline==null?e.inline=t.isInline:e.inline!=t.isInline&&e.err(`Mixing inline and block content`),{type:`name`,value:t}));return e.pos++,t.length==1?t[0]:{type:`choice`,exprs:t}}}function Jr(e){let t=[[]];return i(a(e,0),n()),t;function n(){return t.push([])-1}function r(e,n,r){let i={term:r,to:n};return t[e].push(i),i}function i(e,t){e.forEach(e=>e.to=t)}function a(e,t){if(e.type==`choice`)return e.exprs.reduce((e,n)=>e.concat(a(n,t)),[]);if(e.type==`seq`)for(let r=0;;r++){let o=a(e.exprs[r],t);if(r==e.exprs.length-1)return o;i(o,t=n())}else if(e.type==`star`){let o=n();return r(t,o),i(a(e.expr,o),o),[r(o)]}else if(e.type==`plus`){let o=n();return i(a(e.expr,t),o),i(a(e.expr,o),o),[r(o)]}else if(e.type==`opt`)return[r(t)].concat(a(e.expr,t));else if(e.type==`range`){let o=t;for(let t=0;t<e.min;t++){let t=n();i(a(e.expr,o),t),o=t}if(e.max==-1)i(a(e.expr,o),o);else for(let t=e.min;t<e.max;t++){let t=n();r(o,t),i(a(e.expr,o),t),o=t}return[r(o)]}else if(e.type==`name`)return[r(t,void 0,e.value)];else throw Error(`Unknown expr type`)}}function Yr(e,t){return t-e}function Xr(e,t){let n=[];return r(t),n.sort(Yr);function r(t){let i=e[t];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(t);for(let e=0;e<i.length;e++){let{term:t,to:a}=i[e];!t&&n.indexOf(a)==-1&&r(a)}}}function Zr(e){let t=Object.create(null);return n(Xr(e,0));function n(r){let i=[];r.forEach(t=>{e[t].forEach(({term:t,to:n})=>{if(!t)return;let r;for(let e=0;e<i.length;e++)i[e][0]==t&&(r=i[e][1]);Xr(e,n).forEach(e=>{r||i.push([t,r=[]]),r.indexOf(e)==-1&&r.push(e)})})});let a=t[r.join(`,`)]=new zr(r.indexOf(e.length-1)>-1);for(let e=0;e<i.length;e++){let r=i[e][1].sort(Yr);a.next.push({type:i[e][0],next:t[r.join(`,`)]||n(r)})}return a}}function Qr(e,t){for(let n=0,r=[e];n<r.length;n++){let e=r[n],i=!e.validEnd,a=[];for(let t=0;t<e.next.length;t++){let{type:n,next:o}=e.next[t];a.push(n.name),i&&!(n.isText||n.hasRequiredAttrs())&&(i=!1),r.indexOf(o)==-1&&r.push(o)}i&&t.err(`Only non-generatable nodes (`+a.join(`, `)+`) in a required position (see https://prosemirror.net/docs/guide/#generatable)`)}}function $r(e){let t=Object.create(null);for(let n in e){let r=e[n];if(!r.hasDefault)return null;t[n]=r.default}return t}function ei(e,t){let n=Object.create(null);for(let r in e){let i=t&&t[r];if(i===void 0){let t=e[r];if(t.hasDefault)i=t.default;else throw RangeError(`No value supplied for attribute `+r)}n[r]=i}return n}function ti(e,t,n,r){for(let r in t)if(!(r in e))throw RangeError(`Unsupported attribute ${r} for ${n} of type ${r}`);for(let n in e){let r=e[n];r.validate&&r.validate(t[n])}}function ni(e,t){let n=Object.create(null);if(t)for(let r in t)n[r]=new ai(e,r,t[r]);return n}var ri=class e{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(` `):[],this.attrs=ni(e,n.attrs),this.defaultAttrs=$r(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e==`text`),this.isText=e==`text`}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==zr.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?`pre`:`normal`)}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:ei(this.attrs,e)}create(e=null,t,n){if(this.isText)throw Error(`NodeType.create can't construct text nodes`);return new Ir(this,this.computeAttrs(e),z.from(t),B.setFrom(n))}createChecked(e=null,t,n){return t=z.from(t),this.checkContent(t),new Ir(this,this.computeAttrs(e),t,B.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=z.from(t),t.size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let r=this.contentMatch.matchFragment(t),i=r&&r.fillBefore(z.empty,!0);return i?new Ir(this,e,t.append(i),B.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let t=0;t<e.childCount;t++)if(!this.allowsMarks(e.child(t).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){ti(this.attrs,e,`node`,this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||=e.slice(0,n);return t?t.length?t:B.none:e}static compile(t,n){let r=Object.create(null);t.forEach((t,i)=>r[t]=new e(t,n,i));let i=n.spec.topNode||`doc`;if(!r[i])throw RangeError(`Schema is missing its top node type ('`+i+`')`);if(!r.text)throw RangeError(`Every schema needs a 'text' type`);for(let e in r.text.attrs)throw RangeError(`The text node type should not have attributes`);return r}};function ii(e,t,n){let r=n.split(`|`);return n=>{let i=n===null?`null`:typeof n;if(r.indexOf(i)<0)throw RangeError(`Expected value of type ${r} for attribute ${t} on type ${e}, got ${i}`)}}var ai=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,`default`),this.default=n.default,this.validate=typeof n.validate==`string`?ii(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},oi=class e{constructor(e,t,n,r){this.name=e,this.rank=t,this.schema=n,this.spec=r,this.attrs=ni(e,r.attrs),this.excluded=null;let i=$r(this.attrs);this.instance=i?new B(this,i):null}create(e=null){return!e&&this.instance?this.instance:new B(this,ei(this.attrs,e))}static compile(t,n){let r=Object.create(null),i=0;return t.forEach((t,a)=>r[t]=new e(t,i++,n,a)),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){ti(this.attrs,e,`mark`,this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},si=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let n in e)t[n]=e[n];t.nodes=dr.from(e.nodes),t.marks=dr.from(e.marks||{}),this.nodes=ri.compile(this.spec.nodes,this),this.marks=oi.compile(this.spec.marks,this);let n=Object.create(null);for(let e in this.nodes){if(e in this.marks)throw RangeError(e+` can not be both a node and a mark`);let t=this.nodes[e],r=t.spec.content||``,i=t.spec.marks;if(t.contentMatch=n[r]||(n[r]=zr.parse(r,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.spec.linebreakReplacement){if(this.linebreakReplacement)throw RangeError(`Multiple linebreak nodes defined`);if(!t.isInline||!t.isLeaf)throw RangeError(`Linebreak replacement nodes must be inline leaf nodes`);this.linebreakReplacement=t}t.markSet=i==`_`?null:i?ci(this,i.split(` `)):i==``||!t.inlineContent?[]:null}for(let e in this.marks){let t=this.marks[e],n=t.spec.excludes;t.excluded=n==null?[t]:n==``?[]:ci(this,n.split(` `))}this.nodeFromJSON=e=>Ir.fromJSON(this,e),this.markFromJSON=e=>B.fromJSON(this,e),this.topNodeType=this.nodes[this.spec.topNode||`doc`],this.cached.wrappings=Object.create(null)}node(e,t=null,n,r){if(typeof e==`string`)e=this.nodeType(e);else if(e instanceof ri){if(e.schema!=this)throw RangeError(`Node type from different schema used (`+e.name+`)`)}else throw RangeError(`Invalid node type: `+e);return e.createChecked(t,n,r)}text(e,t){let n=this.nodes.text;return new Lr(n,n.defaultAttrs,e,B.setFrom(t))}mark(e,t){return typeof e==`string`&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw RangeError(`Unknown node type: `+e);return t}};function ci(e,t){let n=[];for(let r=0;r<t.length;r++){let i=t[r],a=e.marks[i],o=a;if(a)n.push(a);else for(let t in e.marks){let r=e.marks[t];(i==`_`||r.spec.group&&r.spec.group.split(` `).indexOf(i)>-1)&&n.push(o=r)}if(!o)throw SyntaxError(`Unknown mark type: '`+t[r]+`'`)}return n}function li(e){return e.tag!=null}function ui(e){return e.style!=null}var di=class e{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(e=>{if(li(e))this.tags.push(e);else if(ui(e)){let t=/[^=]*/.exec(e.style)[0];n.indexOf(t)<0&&n.push(t),this.styles.push(e)}}),this.normalizeLists=!this.tags.some(t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)})}parse(e,t={}){let n=new bi(this,t,!1);return n.addAll(e,B.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new bi(this,t,!0);return n.addAll(e,B.none,t.from,t.to),V.maxOpen(n.finish())}matchTag(e,t,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(Si(e,n.tag)&&(n.namespace===void 0||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(t===!1)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let r=this.styles[i],a=r.style;if(!(a.indexOf(e)!=0||r.context&&!n.matchesContext(r.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(r.getAttrs){let e=r.getAttrs(t);if(e===!1)continue;r.attrs=e||void 0}return r}}}static schemaRules(e){let t=[];function n(e){let n=e.priority==null?50:e.priority,r=0;for(;r<t.length;r++){let e=t[r];if((e.priority==null?50:e.priority)<n)break}t.splice(r,0,e)}for(let t in e.marks){let r=e.marks[t].spec.parseDOM;r&&r.forEach(e=>{n(e=Ci(e)),e.mark||e.ignore||e.clearMark||(e.mark=t)})}for(let t in e.nodes){let r=e.nodes[t].spec.parseDOM;r&&r.forEach(e=>{n(e=Ci(e)),e.node||e.ignore||e.mark||(e.node=t)})}return t}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new e(t,e.schemaRules(t)))}},fi={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},pi={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},mi={ol:!0,ul:!0},hi=1,gi=2,_i=4;function vi(e,t,n){return t==null?e&&e.whitespace==`pre`?hi|gi:n&~_i:(t?hi:0)|(t===`full`?gi:0)}var yi=class{constructor(e,t,n,r,i,a){this.type=e,this.attrs=t,this.marks=n,this.solid=r,this.options=a,this.content=[],this.activeMarks=B.none,this.match=i||(a&_i?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(z.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let t=this.type.contentMatch,n;return(n=t.findWrapping(e.type))?(this.match=t,n):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&hi)){let e=this.content[this.content.length-1],t;if(e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))){let n=e;e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-t[0].length))}}let t=z.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!fi.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},bi=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r=t.topNode,i,a=vi(null,t.preserveWhitespace,0)|(n?_i:0);i=r?new yi(r.type,r.attrs,B.none,!0,t.topMatch||r.type.contentMatch,a):n?new yi(null,null,B.none,!0,null,a):new yi(e.schema.topNodeType,null,B.none,!0,null,a),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,r=this.top,i=r.options&gi?`full`:this.localPreserveWS||(r.options&hi)>0,{schema:a}=this.parser;if(i===`full`||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(i)if(i===`full`)n=n.replace(/\r\n?/g,`
`);else if(a.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(a.linebreakReplacement.create())){let e=n.split(/\r?\n|\r/);for(let n=0;n<e.length;n++)n&&this.insertNode(a.linebreakReplacement.create(),t,!0),e[n]&&this.insertNode(a.text(e[n]),t,!/\S/.test(e[n]));n=``}else n=n.replace(/\r?\n|\r/g,` `);else if(n=n.replace(/[ \t\r\n\u000c]+/g,` `),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let t=r.content[r.content.length-1],i=e.previousSibling;(!t||i&&i.nodeName==`BR`||t.isText&&/[ \t\r\n\u000c]$/.test(t.text))&&(n=n.slice(1))}n&&this.insertNode(a.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let r=this.localPreserveWS,i=this.top;(e.tagName==`PRE`||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let a=e.nodeName.toLowerCase(),o;mi.hasOwnProperty(a)&&this.parser.normalizeLists&&xi(e);let s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));out:if(s?s.ignore:pi.hasOwnProperty(a))this.findInside(e),this.ignoreFallback(e,t);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);let n,r=this.needsBlock;if(fi.hasOwnProperty(a))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),n=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break out}let o=s&&s.skip?t:this.readStyles(e,t);o&&this.addAll(e,o),n&&this.sync(i),this.needsBlock=r}else{let n=this.readStyles(e,t);n&&this.addElementByRule(e,s,n,s.consuming===!1?o:void 0)}this.localPreserveWS=r}leafFallback(e,t){e.nodeName==`BR`&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName==`BR`&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text(`-`),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let e=0;e<this.parser.matchedStyles.length;e++){let r=this.parser.matchedStyles[e],i=n.getPropertyValue(r);if(i)for(let e;;){let n=this.parser.matchStyle(r,i,this,e);if(!n)break;if(n.ignore)return null;if(t=n.clearMark?t.filter(e=>!n.clearMark(e)):t.concat(this.parser.schema.marks[n.mark].create(n.attrs)),n.consuming===!1)e=n;else break}}return t}addElementByRule(e,t,n,r){let i,a;if(t.node)if(a=this.parser.schema.nodes[t.node],a.isLeaf)this.insertNode(a.create(t.attrs),n,e.nodeName==`BR`)||this.leafFallback(e,n);else{let e=this.enter(a,t.attrs||null,n,t.preserveWhitespace);e&&(i=!0,n=e)}else{let e=this.parser.schema.marks[t.mark];n=n.concat(e.create(t.attrs))}let o=this.top;if(a&&a.isLeaf)this.findInside(e);else if(r)this.addElement(e,n,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(e=>this.insertNode(e,n,!1));else{let r=e;typeof t.contentElement==`string`?r=e.querySelector(t.contentElement):typeof t.contentElement==`function`?r=t.contentElement(e):t.contentElement&&(r=t.contentElement),this.findAround(e,r,!0),this.addAll(r,n),this.findAround(e,r,!1)}i&&this.sync(o)&&this.open--}addAll(e,t,n,r){let i=n||0;for(let a=n?e.childNodes[n]:e.firstChild,o=r==null?null:e.childNodes[r];a!=o;a=a.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(a,t);this.findAtPoint(e,i)}findPlace(e,t,n){let r,i;for(let t=this.open,a=0;t>=0;t--){let o=this.nodes[t],s=o.findWrapping(e);if(s&&(!r||r.length>s.length+a)&&(r=s,i=o,!s.length))break;if(o.solid){if(n)break;a+=2}}if(!r)return null;this.sync(i);for(let e=0;e<r.length;e++)t=this.enterInner(r[e],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&(t=this.enterInner(e,null,t))}let r=this.findPlace(e,t,n);if(r){this.closeExtra();let t=this.top;t.match&&=t.match.matchType(e.type);let n=B.none;for(let i of r.concat(e.marks))(t.type?t.type.allowsMarkType(i.type):wi(i.type,e.type))&&(n=i.addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n,r){let i=this.findPlace(e.create(t),n,!1);return i&&=this.enterInner(e,t,n,!0,r),i}enterInner(e,t,n,r=!1,i){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(e);let o=vi(e,i,a.options);a.options&_i&&a.content.length==0&&(o|=_i);let s=B.none;return n=n.filter(t=>(a.type?a.type.allowsMarkType(t.type):wi(t.type,e))?(s=t.addToSet(s),!1):!0),this.nodes.push(new yi(e,t,s,r,null,o)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;else this.localPreserveWS&&(this.nodes[t].options|=hi);return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&t.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf(`|`)>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split(`/`),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),a=(e,o)=>{for(;e>=0;e--){let s=t[e];if(s==``){if(e==t.length-1||e==0)continue;for(;o>=i;o--)if(a(e-1,o))return!0;return!1}else{let e=o>0||o==0&&r?this.nodes[o].type:n&&o>=i?n.node(o-i).type:null;if(!e||e.name!=s&&!e.isInGroup(s))return!1;o--}}return!0};return a(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}};function xi(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=t.nodeType==1?t.nodeName.toLowerCase():null;e&&mi.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):e==`li`?n=t:e&&(n=null)}}function Si(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function Ci(e){let t={};for(let n in e)t[n]=e[n];return t}function wi(e,t){let n=t.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(e))continue;let a=[],o=e=>{a.push(e);for(let n=0;n<e.edgeCount;n++){let{type:r,next:i}=e.edge(n);if(r==t||a.indexOf(i)<0&&o(i))return!0}};if(o(i.contentMatch))return!0}}var Ti=class e{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||=Di(t).createDocumentFragment();let r=n,i=[];return e.forEach(e=>{if(i.length||e.marks.length){let n=0,a=0;for(;n<i.length&&a<e.marks.length;){let t=e.marks[a];if(!this.marks[t.type.name]){a++;continue}if(!t.eq(i[n][0])||t.type.spec.spanning===!1)break;n++,a++}for(;n<i.length;)r=i.pop()[1];for(;a<e.marks.length;){let n=e.marks[a++],o=this.serializeMark(n,e.isInline,t);o&&(i.push([n,r]),r.appendChild(o.dom),r=o.contentDOM||o.dom)}}r.appendChild(this.serializeNodeInner(e,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=ji(Di(t),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw RangeError(`Content hole not allowed in a leaf node spec`);this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let i=this.serializeMark(e.marks[r],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&ji(Di(n),r(e,t),null,e.attrs)}static renderSpec(e,t,n=null,r){return ji(e,t,n,r)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new e(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(e){let t=Ei(e.nodes);return t.text||=e=>e.text,t}static marksFromSchema(e){return Ei(e.marks)}};function Ei(e){let t={};for(let n in e){let r=e[n].spec.toDOM;r&&(t[n]=r)}return t}function Di(e){return e.document||window.document}var Oi=new WeakMap;function ki(e){let t=Oi.get(e);return t===void 0&&Oi.set(e,t=Ai(e)),t}function Ai(e){let t=null;function n(e){if(e&&typeof e==`object`)if(Array.isArray(e))if(typeof e[0]==`string`)t||=[],t.push(e);else for(let t=0;t<e.length;t++)n(e[t]);else for(let t in e)n(e[t])}return n(e),t}function ji(e,t,n,r){if(typeof t==`string`)return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let i=t[0],a;if(typeof i!=`string`)throw RangeError(`Invalid array passed to renderSpec`);if(r&&(a=ki(r))&&a.indexOf(t)>-1)throw RangeError(`Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.`);let o=i.indexOf(` `);o>0&&(n=i.slice(0,o),i=i.slice(o+1));let s,c=n?e.createElementNS(n,i):e.createElement(i),l=t[1],u=1;if(l&&typeof l==`object`&&l.nodeType==null&&!Array.isArray(l)){for(let e in u=2,l)if(l[e]!=null){let t=e.indexOf(` `);t>0?c.setAttributeNS(e.slice(0,t),e.slice(t+1),l[e]):e==`style`&&c.style?c.style.cssText=l[e]:c.setAttribute(e,l[e])}}for(let i=u;i<t.length;i++){let a=t[i];if(a===0){if(i<t.length-1||i>u)throw RangeError(`Content hole must be the only child of its parent node`);return{dom:c,contentDOM:c}}else{let{dom:t,contentDOM:i}=ji(e,a,n,r);if(c.appendChild(t),i){if(s)throw RangeError(`Multiple content holes`);s=i}}}return{dom:c,contentDOM:s}}var Mi=65535,Ni=2**16;function Pi(e,t){return e+t*Ni}function Fi(e){return e&Mi}function Ii(e){return(e-(e&Mi))/Ni}var Li=1,Ri=2,zi=4,Bi=8,Vi=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Bi)>0}get deletedBefore(){return(this.delInfo&(Li|zi))>0}get deletedAfter(){return(this.delInfo&(Ri|zi))>0}get deletedAcross(){return(this.delInfo&zi)>0}},Hi=class e{constructor(t,n=!1){if(this.ranges=t,this.inverted=n,!t.length&&e.empty)return e.empty}recover(e){let t=0,n=Fi(e);if(!this.inverted)for(let e=0;e<n;e++)t+=this.ranges[e*3+2]-this.ranges[e*3+1];return this.ranges[n*3]+t+Ii(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,i=this.inverted?2:1,a=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let s=this.ranges[o]-(this.inverted?r:0);if(s>e)break;let c=this.ranges[o+i],l=this.ranges[o+a],u=s+c;if(e<=u){let i=c?e==s?-1:e==u?1:t:t,a=s+r+(i<0?0:l);if(n)return a;let d=e==(t<0?s:u)?null:Pi(o/3,e-s),f=e==s?Ri:e==u?Li:zi;return(t<0?e!=s:e!=u)&&(f|=Bi),new Vi(a,f,d)}r+=l-c}return n?e+r:new Vi(e+r,0,null)}touches(e,t){let n=0,r=Fi(t),i=this.inverted?2:1,a=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let o=this.ranges[t]-(this.inverted?n:0);if(o>e)break;let s=this.ranges[t+i],c=o+s;if(e<=c&&t==r*3)return!0;n+=this.ranges[t+a]-s}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let a=this.ranges[r],o=a-(this.inverted?i:0),s=a+(this.inverted?0:i),c=this.ranges[r+t],l=this.ranges[r+n];e(o,o+c,s,s+l),i+=l-c}}invert(){return new e(this.ranges,!this.inverted)}toString(){return(this.inverted?`-`:``)+JSON.stringify(this.ranges)}static offset(t){return t==0?e.empty:new e(t<0?[0,-t,0]:[0,0,t])}};Hi.empty=new Hi([]);var Ui=class e{constructor(e,t,n=0,r=e?e.length:0){this.mirror=t,this.from=n,this.to=r,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(t=0,n=this.maps.length){return new e(this._maps,this.mirror,t,n)}appendMap(e,t){this.ownData||=(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let r=e.getMirror(t);this.appendMap(e._maps[t],r!=null&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||=[],this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e._maps[t].invert(),r!=null&&r>t?n-r-1:void 0)}}invert(){let t=new e;return t.appendMappingInverted(this),t}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let n=this.from;n<this.to;n++){let i=this._maps[n].mapResult(e,t);if(i.recover!=null){let t=this.getMirror(n);if(t!=null&&t>n&&t<this.to){n=t,e=this._maps[t].recover(i.recover);continue}}r|=i.delInfo,e=i.pos}return n?e:new Vi(e,r,null)}},Wi=Object.create(null),H=class{getMap(){return Hi.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw RangeError(`Invalid input for Step.fromJSON`);let n=Wi[t.stepType];if(!n)throw RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Wi)throw RangeError(`Duplicate use of step JSON ID `+e);return Wi[e]=t,t.prototype.jsonID=e,t}},U=class e{constructor(e,t){this.doc=e,this.failed=t}static ok(t){return new e(t,null)}static fail(t){return new e(null,t)}static fromReplace(t,n,r,i){try{return e.ok(t.replace(n,r,i))}catch(t){if(t instanceof _r)return e.fail(t.message);throw t}}};function Gi(e,t,n){let r=[];for(let i=0;i<e.childCount;i++){let a=e.child(i);a.content.size&&(a=a.copy(Gi(a.content,t,a))),a.isInline&&(a=t(a,n,i)),r.push(a)}return z.fromArray(r)}var Ki=class e extends H{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),i=new V(Gi(t.content,(e,t)=>!e.isAtom||!t.type.allowsMarkType(this.mark.type)?e:e.mark(this.mark.addToSet(e.marks)),r),t.openStart,t.openEnd);return U.fromReplace(e,this.from,this.to,i)}invert(){return new qi(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:`addMark`,mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if(typeof n.from!=`number`||typeof n.to!=`number`)throw RangeError(`Invalid input for AddMarkStep.fromJSON`);return new e(n.from,n.to,t.markFromJSON(n.mark))}};H.jsonID(`addMark`,Ki);var qi=class e extends H{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new V(Gi(t.content,e=>e.mark(this.mark.removeFromSet(e.marks)),e),t.openStart,t.openEnd);return U.fromReplace(e,this.from,this.to,n)}invert(){return new Ki(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)}merge(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:`removeMark`,mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if(typeof n.from!=`number`||typeof n.to!=`number`)throw RangeError(`Invalid input for RemoveMarkStep.fromJSON`);return new e(n.from,n.to,t.markFromJSON(n.mark))}};H.jsonID(`removeMark`,qi);var Ji=class e extends H{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return U.fail(`No node at mark step's position`);let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return U.fromReplace(e,this.pos,this.pos+1,new V(z.from(n),0,t.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);if(n){let t=this.mark.addToSet(n.marks);if(t.length==n.marks.length){for(let r=0;r<n.marks.length;r++)if(!n.marks[r].isInSet(t))return new e(this.pos,n.marks[r]);return new e(this.pos,this.mark)}}return new Yi(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:`addNodeMark`,pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if(typeof n.pos!=`number`)throw RangeError(`Invalid input for AddNodeMarkStep.fromJSON`);return new e(n.pos,t.markFromJSON(n.mark))}};H.jsonID(`addNodeMark`,Ji);var Yi=class e extends H{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return U.fail(`No node at mark step's position`);let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return U.fromReplace(e,this.pos,this.pos+1,new V(z.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Ji(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}toJSON(){return{stepType:`removeNodeMark`,pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if(typeof n.pos!=`number`)throw RangeError(`Invalid input for RemoveNodeMarkStep.fromJSON`);return new e(n.pos,t.markFromJSON(n.mark))}};H.jsonID(`removeNodeMark`,Yi);var Xi=class e extends H{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&Qi(e,this.from,this.to)?U.fail(`Structure replace would overwrite content`):U.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Hi([this.from,this.to-this.from,this.slice.size])}invert(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let n=this.slice.size+t.slice.size==0?V.empty:new V(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),n,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let n=this.slice.size+t.slice.size==0?V.empty:new V(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:`replace`,from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if(typeof n.from!=`number`||typeof n.to!=`number`)throw RangeError(`Invalid input for ReplaceStep.fromJSON`);return new e(n.from,n.to,V.fromJSON(t,n.slice),!!n.structure)}};H.jsonID(`replace`,Xi);var Zi=class e extends H{constructor(e,t,n,r,i,a,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=a,this.structure=o}apply(e){if(this.structure&&(Qi(e,this.from,this.gapFrom)||Qi(e,this.gapTo,this.to)))return U.fail(`Structure gap-replace would overwrite content`);let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return U.fail(`Gap is not a flat range`);let n=this.slice.insertAt(this.insert,t.content);return n?U.fromReplace(e,this.from,this.to,n):U.fail(`Content does not fit in gap`)}getMap(){return new Hi([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:t.map(this.gapFrom,-1),a=this.to==this.gapTo?r.pos:t.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||a>r.pos?null:new e(n.pos,r.pos,i,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:`replaceAround`,from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(t,n){if(typeof n.from!=`number`||typeof n.to!=`number`||typeof n.gapFrom!=`number`||typeof n.gapTo!=`number`||typeof n.insert!=`number`)throw RangeError(`Invalid input for ReplaceAroundStep.fromJSON`);return new e(n.from,n.to,n.gapFrom,n.gapTo,V.fromJSON(t,n.slice),n.insert,!!n.structure)}};H.jsonID(`replaceAround`,Zi);function Qi(e,t,n){let r=e.resolve(t),i=n-t,a=r.depth;for(;i>0&&a>0&&r.indexAfter(a)==r.node(a).childCount;)a--,i--;if(i>0){let e=r.node(a).maybeChild(r.indexAfter(a));for(;i>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,i--}}return!1}function $i(e,t,n,r){let i=[],a=[],o,s;e.doc.nodesBetween(t,n,(e,c,l)=>{if(!e.isInline)return;let u=e.marks;if(!r.isInSet(u)&&l.type.allowsMarkType(r.type)){let l=Math.max(c,t),d=Math.min(c+e.nodeSize,n),f=r.addToSet(u);for(let e=0;e<u.length;e++)u[e].isInSet(f)||(o&&o.to==l&&o.mark.eq(u[e])?o.to=d:i.push(o=new qi(l,d,u[e])));s&&s.to==l?s.to=d:a.push(s=new Ki(l,d,r))}}),i.forEach(t=>e.step(t)),a.forEach(t=>e.step(t))}function ea(e,t,n,r){let i=[],a=0;e.doc.nodesBetween(t,n,(e,o)=>{if(!e.isInline)return;a++;let s=null;if(r instanceof oi){let t=e.marks,n;for(;n=r.isInSet(t);)(s||=[]).push(n),t=n.removeFromSet(t)}else r?r.isInSet(e.marks)&&(s=[r]):s=e.marks;if(s&&s.length){let r=Math.min(o+e.nodeSize,n);for(let e=0;e<s.length;e++){let n=s[e],c;for(let e=0;e<i.length;e++){let t=i[e];t.step==a-1&&n.eq(i[e].style)&&(c=t)}c?(c.to=r,c.step=a):i.push({style:n,from:Math.max(o,t),to:r,step:a})}}}),i.forEach(t=>e.step(new qi(t.from,t.to,t.style)))}function ta(e,t,n,r=n.contentMatch,i=!0){let a=e.doc.nodeAt(t),o=[],s=t+1;for(let t=0;t<a.childCount;t++){let c=a.child(t),l=s+c.nodeSize,u=r.matchType(c.type);if(!u)o.push(new Xi(s,l,V.empty));else{r=u;for(let t=0;t<c.marks.length;t++)n.allowsMarkType(c.marks[t].type)||e.step(new qi(s,l,c.marks[t]));if(i&&c.isText&&n.whitespace!=`pre`){let e,t=/\r?\n|\r/g,r;for(;e=t.exec(c.text);)r||=new V(z.from(n.schema.text(` `,n.allowedMarks(c.marks))),0,0),o.push(new Xi(s+e.index,s+e.index+e[0].length,r))}}s=l}if(!r.validEnd){let t=r.fillBefore(z.empty,!0);e.replace(s,s,new V(t,0,0))}for(let t=o.length-1;t>=0;t--)e.step(o[t])}function na(e,t,n){return(t==0||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function ra(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth,r=0,i=0;;--n){let a=e.$from.node(n),o=e.$from.index(n)+r,s=e.$to.indexAfter(n)-i;if(n<e.depth&&a.canReplace(o,s,t))return n;if(n==0||a.type.spec.isolating||!na(a,o,s))break;o&&(r=1),s<a.childCount&&(i=1)}return null}function ia(e,t,n){let{$from:r,$to:i,depth:a}=t,o=r.before(a+1),s=i.after(a+1),c=o,l=s,u=z.empty,d=0;for(let e=a,t=!1;e>n;e--)t||r.index(e)>0?(t=!0,u=z.from(r.node(e).copy(u)),d++):c--;let f=z.empty,p=0;for(let e=a,t=!1;e>n;e--)t||i.after(e+1)<i.end(e)?(t=!0,f=z.from(i.node(e).copy(f)),p++):l++;e.step(new Zi(c,l,o,s,new V(u.append(f),d,p),u.size-d,!0))}function aa(e,t,n){let r=z.empty;for(let e=n.length-1;e>=0;e--){if(r.size){let t=n[e].type.contentMatch.matchFragment(r);if(!t||!t.validEnd)throw RangeError(`Wrapper type given to Transform.wrap does not form valid content of its parent wrapper`)}r=z.from(n[e].type.create(n[e].attrs,r))}let i=t.start,a=t.end;e.step(new Zi(i,a,i,a,new V(r,0,0),n.length,!0))}function oa(e,t,n,r,i){if(!r.isTextblock)throw RangeError(`Type given to setBlockType should be a textblock`);let a=e.steps.length;e.doc.nodesBetween(t,n,(t,n)=>{let o=typeof i==`function`?i(t):i;if(t.isTextblock&&!t.hasMarkup(r,o)&&la(e.doc,e.mapping.slice(a).map(n),r)){let i=null;if(r.schema.linebreakReplacement){let e=r.whitespace==`pre`,t=!!r.contentMatch.matchType(r.schema.linebreakReplacement);e&&!t?i=!1:!e&&t&&(i=!0)}i===!1&&ca(e,t,n,a),ta(e,e.mapping.slice(a).map(n,1),r,void 0,i===null);let s=e.mapping.slice(a),c=s.map(n,1),l=s.map(n+t.nodeSize,1);return e.step(new Zi(c,l,c+1,l-1,new V(z.from(r.create(o,null,t.marks)),0,0),1,!0)),i===!0&&sa(e,t,n,a),!1}})}function sa(e,t,n,r){t.forEach((i,a)=>{if(i.isText){let o,s=/\r?\n|\r/g;for(;o=s.exec(i.text);){let i=e.mapping.slice(r).map(n+1+a+o.index);e.replaceWith(i,i+1,t.type.schema.linebreakReplacement.create())}}})}function ca(e,t,n,r){t.forEach((i,a)=>{if(i.type==i.type.schema.linebreakReplacement){let i=e.mapping.slice(r).map(n+1+a);e.replaceWith(i,i+1,t.type.schema.text(`
`))}})}function la(e,t,n){let r=e.resolve(t),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function ua(e,t,n,r,i){let a=e.doc.nodeAt(t);if(!a)throw RangeError(`No node at given position`);n||=a.type;let o=n.create(r,null,i||a.marks);if(a.isLeaf)return e.replaceWith(t,t+a.nodeSize,o);if(!n.validContent(a.content))throw RangeError(`Invalid content for node type `+n.name);e.step(new Zi(t,t+a.nodeSize,t+1,t+a.nodeSize-1,new V(z.from(o),0,0),1,!0))}function da(e,t,n=1,r){let i=e.resolve(t),a=i.depth-n,o=r&&r[r.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let e=i.depth-1,t=n-2;e>a;e--,t--){let n=i.node(e),a=i.index(e);if(n.type.spec.isolating)return!1;let o=n.content.cutByIndex(a,n.childCount),s=r&&r[t+1];s&&(o=o.replaceChild(0,s.type.create(s.attrs)));let c=r&&r[t]||n;if(!n.canReplace(a+1,n.childCount)||!c.type.validContent(o))return!1}let s=i.indexAfter(a),c=r&&r[0];return i.node(a).canReplaceWith(s,s,c?c.type:i.node(a+1).type)}function fa(e,t,n=1,r){let i=e.doc.resolve(t),a=z.empty,o=z.empty;for(let e=i.depth,t=i.depth-n,s=n-1;e>t;e--,s--){a=z.from(i.node(e).copy(a));let t=r&&r[s];o=z.from(t?t.type.create(t.attrs,o):i.node(e).copy(o))}e.step(new Xi(t,t,new V(a.append(o),n,n),!0))}function pa(e,t){let n=e.resolve(t),r=n.index();return ha(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function ma(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:r}=e.type.schema;for(let i=0;i<t.childCount;i++){let a=t.child(i),o=a.type==r?e.type.schema.nodes.text:a.type;if(n=n.matchType(o),!n||!e.type.allowsMarks(a.marks))return!1}return n.validEnd}function ha(e,t){return!!(e&&t&&!e.isLeaf&&ma(e,t))}function ga(e,t,n){let r=null,{linebreakReplacement:i}=e.doc.type.schema,a=e.doc.resolve(t-n),o=a.node().type;if(i&&o.inlineContent){let e=o.whitespace==`pre`,t=!!o.contentMatch.matchType(i);e&&!t?r=!1:!e&&t&&(r=!0)}let s=e.steps.length;if(r===!1){let r=e.doc.resolve(t+n);ca(e,r.node(),r.before(),s)}o.inlineContent&&ta(e,t+n-1,o,a.node().contentMatchAt(a.index()),r==null);let c=e.mapping.slice(s),l=c.map(t-n);if(e.step(new Xi(l,c.map(t+n,-1),V.empty,!0)),r===!0){let t=e.doc.resolve(l);sa(e,t.node(),t.before(),e.steps.length)}return e}function _a(e,t,n){let r=e.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),n))return t;if(r.parentOffset==0)for(let e=r.depth-1;e>=0;e--){let t=r.index(e);if(r.node(e).canReplaceWith(t,t,n))return r.before(e+1);if(t>0)return null}if(r.parentOffset==r.parent.content.size)for(let e=r.depth-1;e>=0;e--){let t=r.indexAfter(e);if(r.node(e).canReplaceWith(t,t,n))return r.after(e+1);if(t<r.node(e).childCount)return null}return null}function va(e,t,n){let r=e.resolve(t);if(!n.content.size)return t;let i=n.content;for(let e=0;e<n.openStart;e++)i=i.firstChild.content;for(let e=1;e<=(n.openStart==0&&n.size?2:1);e++)for(let t=r.depth;t>=0;t--){let n=t==r.depth?0:r.pos<=(r.start(t+1)+r.end(t+1))/2?-1:1,a=r.index(t)+(n>0?1:0),o=r.node(t),s=!1;if(e==1)s=o.canReplace(a,a,i);else{let e=o.contentMatchAt(a).findWrapping(i.firstChild.type);s=e&&o.canReplaceWith(a,a,e[0])}if(s)return n==0?r.pos:n<0?r.before(t+1):r.after(t+1)}return null}function ya(e,t,n=t,r=V.empty){if(t==n&&!r.size)return null;let i=e.resolve(t),a=e.resolve(n);return ba(i,a,r)?new Xi(t,n,r):new xa(i,a,r).fit()}function ba(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}var xa=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=z.empty;for(let t=0;t<=e.depth;t++){let n=e.node(t);this.frontier.push({type:n.type,match:n.contentMatchAt(e.indexAfter(t))})}for(let t=e.depth;t>0;t--)this.placed=z.from(e.node(t).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(e<0?this.$to:n.doc.resolve(e));if(!r)return null;let i=this.placed,a=n.depth,o=r.depth;for(;a&&o&&i.childCount==1;)i=i.firstChild.content,a--,o--;let s=new V(i,a,o);return e>-1?new Zi(n.pos,e,this.$to.pos,this.$to.end(),s,t):s.size||n.pos!=this.$to.pos?new Xi(n.pos,r.pos,s):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let i=t.firstChild;if(t.childCount>1&&(r=0),i.type.spec.isolating&&r<=n){e=n;break}t=i.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let e,r=null;n?(r=wa(this.unplaced.content,n-1).firstChild,e=r.content):e=this.unplaced.content;let i=e.firstChild;for(let e=this.depth;e>=0;e--){let{type:a,match:o}=this.frontier[e],s,c=null;if(t==1&&(i?o.matchType(i.type)||(c=o.fillBefore(z.from(i),!1)):r&&a.compatibleContent(r.type)))return{sliceDepth:n,frontierDepth:e,parent:r,inject:c};if(t==2&&i&&(s=o.findWrapping(i.type)))return{sliceDepth:n,frontierDepth:e,parent:r,wrap:s};if(r&&o.matchType(r.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=wa(e,t);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new V(e,t+1,Math.max(n,r.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=wa(e,t);if(r.childCount<=1&&t>0){let i=e.size-t<=t+r.size;this.unplaced=new V(Sa(e,t-1,1),t-1,i?t-1:n)}else this.unplaced=new V(Sa(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:r,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let e=0;e<i.length;e++)this.openFrontierNode(i[e]);let a=this.unplaced,o=n?n.content:a.content,s=a.openStart-e,c=0,l=[],{match:u,type:d}=this.frontier[t];if(r){for(let e=0;e<r.childCount;e++)l.push(r.child(e));u=u.matchFragment(r)}let f=o.size+e-(a.content.size-a.openEnd);for(;c<o.childCount;){let e=o.child(c),t=u.matchType(e.type);if(!t)break;c++,(c>1||s==0||e.content.size)&&(u=t,l.push(Ta(e.mark(d.allowedMarks(e.marks)),c==1?s:0,c==o.childCount?f:-1)))}let p=c==o.childCount;p||(f=-1),this.placed=Ca(this.placed,t,z.from(l)),this.frontier[t].match=u,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let e=0,t=o;e<f;e++){let e=t.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),t=e.content}this.unplaced=p?e==0?V.empty:new V(Sa(a.content,e-1,1),e-1,f<0?a.openEnd:e-1):new V(Sa(a.content,e,c),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Ea(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(e){scan:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:r}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),a=Ea(e,t,r,n,i);if(a){for(let n=t-1;n>=0;n--){let{match:t,type:r}=this.frontier[n],i=Ea(e,n,r,t,!0);if(!i||i.childCount)continue scan}return{depth:t,fit:a,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Ca(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),r=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,r)}return e}openFrontierNode(e,t=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(e),this.placed=Ca(this.placed,this.depth,z.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(z.empty,!0);e.childCount&&(this.placed=Ca(this.placed,this.frontier.length,e))}};function Sa(e,t,n){return t==0?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(Sa(e.firstChild.content,t-1,n)))}function Ca(e,t,n){return t==0?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(Ca(e.lastChild.content,t-1,n)))}function wa(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function Ta(e,t,n){if(t<=0)return e;let r=e.content;return t>1&&(r=r.replaceChild(0,Ta(r.firstChild,t-1,r.childCount==1?n-1:0))),t>0&&(r=e.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(e.type.contentMatch.matchFragment(r).fillBefore(z.empty,!0)))),e.copy(r)}function Ea(e,t,n,r,i){let a=e.node(t),o=i?e.indexAfter(t):e.index(t);if(o==a.childCount&&!n.compatibleContent(a.type))return null;let s=r.fillBefore(a.content,!0,o);return s&&!Da(n,a.content,o)?s:null}function Da(e,t,n){for(let r=n;r<t.childCount;r++)if(!e.allowsMarks(t.child(r).marks))return!0;return!1}function Oa(e){return e.spec.defining||e.spec.definingForContent}function ka(e,t,n,r){if(!r.size)return e.deleteRange(t,n);let i=e.doc.resolve(t),a=e.doc.resolve(n);if(ba(i,a,r))return e.step(new Xi(t,n,r));let o=Na(i,a);o[o.length-1]==0&&o.pop();let s=-(i.depth+1);o.unshift(s);for(let e=i.depth,t=i.pos-1;e>0;e--,t--){let n=i.node(e).type.spec;if(n.defining||n.definingAsContext||n.isolating)break;o.indexOf(e)>-1?s=e:i.before(e)==t&&o.splice(1,0,-e)}let c=o.indexOf(s),l=[],u=r.openStart;for(let e=r.content,t=0;;t++){let n=e.firstChild;if(l.push(n),t==r.openStart)break;e=n.content}for(let e=u-1;e>=0;e--){let t=l[e],n=Oa(t.type);if(n&&!t.sameMarkup(i.node(Math.abs(s)-1)))u=e;else if(n||!t.type.isTextblock)break}for(let t=r.openStart;t>=0;t--){let s=(t+u+1)%(r.openStart+1),d=l[s];if(d)for(let t=0;t<o.length;t++){let l=o[(t+c)%o.length],u=!0;l<0&&(u=!1,l=-l);let f=i.node(l-1),p=i.index(l-1);if(f.canReplaceWith(p,p,d.type,d.marks))return e.replace(i.before(l),u?a.after(l):n,new V(Aa(r.content,0,r.openStart,s),s,r.openEnd))}}let d=e.steps.length;for(let s=o.length-1;s>=0&&(e.replace(t,n,r),!(e.steps.length>d));s--){let e=o[s];e<0||(t=i.before(e),n=a.after(e))}}function Aa(e,t,n,r,i){if(t<n){let i=e.firstChild;e=e.replaceChild(0,i.copy(Aa(i.content,t+1,n,r,i)))}if(t>r){let t=i.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(z.empty,!0))}return e}function ja(e,t,n,r){if(!r.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let i=_a(e.doc,t,r.type);i!=null&&(t=n=i)}e.replaceRange(t,n,new V(z.from(r),0,0))}function Ma(e,t,n){let r=e.doc.resolve(t),i=e.doc.resolve(n),a=Na(r,i);for(let t=0;t<a.length;t++){let n=a[t],o=t==a.length-1;if(o&&n==0||r.node(n).type.contentMatch.validEnd)return e.delete(r.start(n),i.end(n));if(n>0&&(o||r.node(n-1).canReplace(r.index(n-1),i.indexAfter(n-1))))return e.delete(r.before(n),i.after(n))}for(let a=1;a<=r.depth&&a<=i.depth;a++)if(t-r.start(a)==r.depth-a&&n>r.end(a)&&i.end(a)-n!=i.depth-a&&r.start(a-1)==i.start(a-1)&&r.node(a-1).canReplace(r.index(a-1),i.index(a-1)))return e.delete(r.before(a),n);e.delete(t,n)}function Na(e,t){let n=[],r=Math.min(e.depth,t.depth);for(let i=r;i>=0;i--){let r=e.start(i);if(r<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(r==t.start(i)||i==e.depth&&i==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==r-1)&&n.push(i)}return n}var Pa=class e extends H{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return U.fail(`No node at attribute step's position`);let n=Object.create(null);for(let e in t.attrs)n[e]=t.attrs[e];n[this.attr]=this.value;let r=t.type.create(n,null,t.marks);return U.fromReplace(e,this.pos,this.pos+1,new V(z.from(r),0,t.isLeaf?0:1))}getMap(){return Hi.empty}invert(t){return new e(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.attr,this.value)}toJSON(){return{stepType:`attr`,pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,n){if(typeof n.pos!=`number`||typeof n.attr!=`string`)throw RangeError(`Invalid input for AttrStep.fromJSON`);return new e(n.pos,n.attr,n.value)}};H.jsonID(`attr`,Pa);var Fa=class e extends H{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let n in e.attrs)t[n]=e.attrs[n];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return U.ok(n)}getMap(){return Hi.empty}invert(t){return new e(this.attr,t.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:`docAttr`,attr:this.attr,value:this.value}}static fromJSON(t,n){if(typeof n.attr!=`string`)throw RangeError(`Invalid input for DocAttrStep.fromJSON`);return new e(n.attr,n.value)}};H.jsonID(`docAttr`,Fa);var Ia=class extends Error{};Ia=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},Ia.prototype=Object.create(Error.prototype),Ia.prototype.constructor=Ia,Ia.prototype.name=`TransformError`;var La=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ui}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Ia(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=V.empty){let r=ya(this.doc,e,t,n);return r&&this.step(r),this}replaceWith(e,t,n){return this.replace(e,t,new V(z.from(n),0,0))}delete(e,t){return this.replace(e,t,V.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return ka(this,e,t,n),this}replaceRangeWith(e,t,n){return ja(this,e,t,n),this}deleteRange(e,t){return Ma(this,e,t),this}lift(e,t){return ia(this,e,t),this}join(e,t=1){return ga(this,e,t),this}wrap(e,t){return aa(this,e,t),this}setBlockType(e,t=e,n,r=null){return oa(this,e,t,n,r),this}setNodeMarkup(e,t,n=null,r){return ua(this,e,t,n,r),this}setNodeAttribute(e,t,n){return this.step(new Pa(e,t,n)),this}setDocAttribute(e,t){return this.step(new Fa(e,t)),this}addNodeMark(e,t){return this.step(new Ji(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw RangeError(`No node at position `+e);if(t instanceof B)t.isInSet(n.marks)&&this.step(new Yi(e,t));else{let r=n.marks,i,a=[];for(;i=t.isInSet(r);)a.push(new Yi(e,i)),r=i.removeFromSet(r);for(let e=a.length-1;e>=0;e--)this.step(a[e])}return this}split(e,t=1,n){return fa(this,e,t,n),this}addMark(e,t,n){return $i(this,e,t,n),this}removeMark(e,t,n){return ea(this,e,t,n),this}clearIncompatible(e,t,n){return ta(this,e,t,n),this}},Ra=Object.create(null),W=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new za(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=V.empty){let n=t.content.lastChild,r=null;for(let e=0;e<t.openEnd;e++)r=n,n=n.lastChild;let i=e.steps.length,a=this.ranges;for(let o=0;o<a.length;o++){let{$from:s,$to:c}=a[o],l=e.mapping.slice(i);e.replaceRange(l.map(s.pos),l.map(c.pos),o?V.empty:t),o==0&&qa(e,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:a,$to:o}=r[i],s=e.mapping.slice(n),c=s.map(a.pos),l=s.map(o.pos);i?e.deleteRange(c,l):(e.replaceRangeWith(c,l,t),qa(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new G(e):Ka(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let r=e.depth-1;r>=0;r--){let i=t<0?Ka(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):Ka(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(i)return i}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Wa(e.node(0))}static atStart(e){return Ka(e,e,0,0,1)||new Wa(e)}static atEnd(e){return Ka(e,e,e.content.size,e.childCount,-1)||new Wa(e)}static fromJSON(e,t){if(!t||!t.type)throw RangeError(`Invalid input for Selection.fromJSON`);let n=Ra[t.type];if(!n)throw RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Ra)throw RangeError(`Duplicate use of selection JSON ID `+e);return Ra[e]=t,t.prototype.jsonID=e,t}getBookmark(){return G.between(this.$anchor,this.$head).getBookmark()}};W.prototype.visible=!0;var za=class{constructor(e,t){this.$from=e,this.$to=t}},Ba=!1;function Va(e){!Ba&&!e.parent.inlineContent&&(Ba=!0,console.warn(`TextSelection endpoint not pointing into a node with inline content (`+e.parent.type.name+`)`))}var G=class e extends W{constructor(e,t=e){Va(e),Va(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,n){let r=t.resolve(n.map(this.head));if(!r.parent.inlineContent)return W.near(r);let i=t.resolve(n.map(this.anchor));return new e(i.parent.inlineContent?i:r,r)}replace(e,t=V.empty){if(super.replace(e,t),t==V.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new Ha(this.anchor,this.head)}toJSON(){return{type:`text`,anchor:this.anchor,head:this.head}}static fromJSON(t,n){if(typeof n.anchor!=`number`||typeof n.head!=`number`)throw RangeError(`Invalid input for TextSelection.fromJSON`);return new e(t.resolve(n.anchor),t.resolve(n.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(t,n,r){let i=t.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let e=W.findFrom(n,r,!0)||W.findFrom(n,-r,!0);if(e)n=e.$head;else return W.near(n,r)}return t.parent.inlineContent||(i==0?t=n:(t=(W.findFrom(t,-r,!0)||W.findFrom(t,r,!0)).$anchor,t.pos<n.pos!=i<0&&(t=n))),new e(t,n)}};W.jsonID(`text`,G);var Ha=class e{constructor(e,t){this.anchor=e,this.head=t}map(t){return new e(t.map(this.anchor),t.map(this.head))}resolve(e){return G.between(e.resolve(this.anchor),e.resolve(this.head))}},K=class e extends W{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(t,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),a=t.resolve(i);return r?W.near(a):new e(a)}content(){return new V(z.from(this.node),0,0)}eq(t){return t instanceof e&&t.anchor==this.anchor}toJSON(){return{type:`node`,anchor:this.anchor}}getBookmark(){return new Ua(this.anchor)}static fromJSON(t,n){if(typeof n.anchor!=`number`)throw RangeError(`Invalid input for NodeSelection.fromJSON`);return new e(t.resolve(n.anchor))}static create(t,n){return new e(t.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};K.prototype.visible=!1,W.jsonID(`node`,K);var Ua=class e{constructor(e){this.anchor=e}map(t){let{deleted:n,pos:r}=t.mapResult(this.anchor);return n?new Ha(r,r):new e(r)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&K.isSelectable(n)?new K(t):W.near(t)}},Wa=class e extends W{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=V.empty){if(t==V.empty){e.delete(0,e.doc.content.size);let t=W.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:`all`}}static fromJSON(t){return new e(t)}map(t){return new e(t)}eq(t){return t instanceof e}getBookmark(){return Ga}};W.jsonID(`all`,Wa);var Ga={map(){return this},resolve(e){return new Wa(e)}};function Ka(e,t,n,r,i,a=!1){if(t.inlineContent)return G.create(e,n);for(let o=r-(i>0?0:1);i>0?o<t.childCount:o>=0;o+=i){let r=t.child(o);if(r.isAtom){if(!a&&K.isSelectable(r))return K.create(e,n-(i<0?r.nodeSize:0))}else{let t=Ka(e,r,n+i,i<0?r.childCount:0,i,a);if(t)return t}n+=r.nodeSize*i}return null}function qa(e,t,n){let r=e.steps.length-1;if(r<t)return;let i=e.steps[r];if(!(i instanceof Xi||i instanceof Zi))return;let a=e.mapping.maps[r],o;a.forEach((e,t,n,r)=>{o??=r}),e.setSelection(W.near(e.doc.resolve(o),n))}var Ja=1,Ya=2,Xa=4,Za=class extends La{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw RangeError(`Selection passed to setSelection must point at the current document`);return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Ja)&~Ya,this.storedMarks=null,this}get selectionSet(){return(this.updated&Ja)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Ya,this}ensureMarks(e){return B.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ya)>0}addStep(e,t){super.addStep(e,t),this.updated&=~Ya,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||B.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(n??=t,!e)return this.deleteRange(t,n);let i=this.storedMarks;if(!i){let e=this.doc.resolve(t);i=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,i)),!this.selection.empty&&this.selection.to==t+e.length&&this.setSelection(W.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e==`string`?e:e.key]=t,this}getMeta(e){return this.meta[typeof e==`string`?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Xa,this}get scrolledIntoView(){return(this.updated&Xa)>0}};function Qa(e,t){return!t||!e?e:e.bind(t)}var $a=class{constructor(e,t,n){this.name=e,this.init=Qa(t.init,n),this.apply=Qa(t.apply,n)}},eo=[new $a(`doc`,{init(e){return e.doc||e.schema.topNodeType.createAndFill()},apply(e){return e.doc}}),new $a(`selection`,{init(e,t){return e.selection||W.atStart(t.doc)},apply(e){return e.selection}}),new $a(`storedMarks`,{init(e){return e.storedMarks||null},apply(e,t,n,r){return r.selection.$cursor?e.storedMarks:null}}),new $a(`scrollToSelection`,{init(){return 0},apply(e,t){return e.scrolledIntoView?t+1:t}})],to=class{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=eo.slice(),t&&t.forEach(e=>{if(this.pluginsByKey[e.key])throw RangeError(`Adding different instances of a keyed plugin (`+e.key+`)`);this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new $a(e.key,e.spec.state,e))})}},no=class e{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let i=!1;for(let a=0;a<this.config.plugins.length;a++){let o=this.config.plugins[a];if(o.spec.appendTransaction){let s=r?r[a].n:0,c=r?r[a].state:this,l=s<t.length&&o.spec.appendTransaction.call(o,s?t.slice(s):t,c,n);if(l&&n.filterTransaction(l,a)){if(l.setMeta(`appendedTransaction`,e),!r){r=[];for(let e=0;e<this.config.plugins.length;e++)r.push(e<a?{state:n,n:t.length}:{state:this,n:0})}t.push(l),n=n.applyInner(l),i=!0}r&&(r[a]={state:n,n:t.length})}}if(!i)return{state:n,transactions:t}}}applyInner(t){if(!t.before.eq(this.doc))throw RangeError(`Applying a mismatched transaction`);let n=new e(this.config),r=this.config.fields;for(let e=0;e<r.length;e++){let i=r[e];n[i.name]=i.apply(t,this[i.name],this,n)}return n}get tr(){return new Za(this)}static create(t){let n=new to(t.doc?t.doc.type.schema:t.schema,t.plugins),r=new e(n);for(let e=0;e<n.fields.length;e++)r[n.fields[e].name]=n.fields[e].init(t,r);return r}reconfigure(t){let n=new to(this.schema,t.plugins),r=n.fields,i=new e(n);for(let e=0;e<r.length;e++){let n=r[e].name;i[n]=this.hasOwnProperty(n)?this[n]:r[e].init(t,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(e=>e.toJSON())),e&&typeof e==`object`)for(let n in e){if(n==`doc`||n==`selection`)throw RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],i=r.spec.state;i&&i.toJSON&&(t[n]=i.toJSON.call(r,this[r.key]))}return t}static fromJSON(t,n,r){if(!n)throw RangeError(`Invalid input for EditorState.fromJSON`);if(!t.schema)throw RangeError(`Required config field 'schema' missing`);let i=new to(t.schema,t.plugins),a=new e(i);return i.fields.forEach(e=>{if(e.name==`doc`)a.doc=Ir.fromJSON(t.schema,n.doc);else if(e.name==`selection`)a.selection=W.fromJSON(a.doc,n.selection);else if(e.name==`storedMarks`)n.storedMarks&&(a.storedMarks=n.storedMarks.map(t.schema.markFromJSON));else{if(r)for(let i in r){let o=r[i],s=o.spec.state;if(o.key==e.name&&s&&s.fromJSON&&Object.prototype.hasOwnProperty.call(n,i)){a[e.name]=s.fromJSON.call(o,t,n[i],a);return}}a[e.name]=e.init(t,a)}}),a}};function ro(e,t,n){for(let r in e){let i=e[r];i instanceof Function?i=i.bind(t):r==`handleDOMEvents`&&(i=ro(i,t,{})),n[r]=i}return n}var io=class{constructor(e){this.spec=e,this.props={},e.props&&ro(e.props,this,this.props),this.key=e.key?e.key.key:oo(`plugin`)}getState(e){return e[this.key]}},ao=Object.create(null);function oo(e){return e in ao?e+`$`+ ++ao[e]:(ao[e]=0,e+`$`)}var so=class{constructor(e=`key`){this.key=oo(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}},q=function(e){for(var t=0;;t++)if(e=e.previousSibling,!e)return t},co=function(e){let t=e.assignedSlot||e.parentNode;return t&&t.nodeType==11?t.host:t},lo=null,uo=function(e,t,n){let r=lo||=document.createRange();return r.setEnd(e,n??e.nodeValue.length),r.setStart(e,t||0),r},fo=function(){lo=null},po=function(e,t,n,r){return n&&(ho(e,t,n,r,-1)||ho(e,t,n,r,1))},mo=/^(img|br|input|textarea|hr)$/i;function ho(e,t,n,r,i){for(;;){if(e==n&&t==r)return!0;if(t==(i<0?0:go(e))){let n=e.parentNode;if(!n||n.nodeType!=1||bo(e)||mo.test(e.nodeName)||e.contentEditable==`false`)return!1;t=q(e)+(i<0?0:1),e=n}else if(e.nodeType==1){let n=e.childNodes[t+(i<0?-1:0)];if(n.nodeType==1&&n.contentEditable==`false`)if(n.pmViewDesc?.ignoreForSelection)t+=i;else return!1;else e=n,t=i<0?go(e):0}else return!1}}function go(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function _o(e,t){for(;;){if(e.nodeType==3&&t)return e;if(e.nodeType==1&&t>0){if(e.contentEditable==`false`)return null;e=e.childNodes[t-1],t=go(e)}else if(e.parentNode&&!bo(e))t=q(e),e=e.parentNode;else return null}}function vo(e,t){for(;;){if(e.nodeType==3&&t<e.nodeValue.length)return e;if(e.nodeType==1&&t<e.childNodes.length){if(e.contentEditable==`false`)return null;e=e.childNodes[t],t=0}else if(e.parentNode&&!bo(e))t=q(e)+1,e=e.parentNode;else return null}}function yo(e,t,n){for(let r=t==0,i=t==go(e);r||i;){if(e==n)return!0;let t=q(e);if(e=e.parentNode,!e)return!1;r&&=t==0,i&&=t==go(e)}}function bo(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}var xo=function(e){return e.focusNode&&po(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function So(e,t){let n=document.createEvent(`Event`);return n.initEvent(`keydown`,!0,!0),n.keyCode=e,n.key=n.code=t,n}function Co(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function wo(e,t,n){if(e.caretPositionFromPoint)try{let r=e.caretPositionFromPoint(t,n);if(r)return{node:r.offsetNode,offset:Math.min(go(r.offsetNode),r.offset)}}catch{}if(e.caretRangeFromPoint){let r=e.caretRangeFromPoint(t,n);if(r)return{node:r.startContainer,offset:Math.min(go(r.startContainer),r.startOffset)}}}var To=typeof navigator<`u`?navigator:null,Eo=typeof document<`u`?document:null,Do=To&&To.userAgent||``,Oo=/Edge\/(\d+)/.exec(Do),ko=/MSIE \d/.exec(Do),Ao=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Do),jo=!!(ko||Ao||Oo),Mo=ko?document.documentMode:Ao?+Ao[1]:Oo?+Oo[1]:0,No=!jo&&/gecko\/(\d+)/i.test(Do);No&&+(/Firefox\/(\d+)/.exec(Do)||[0,0])[1];var Po=!jo&&/Chrome\/(\d+)/.exec(Do),J=!!Po,Fo=Po?+Po[1]:0,Y=!jo&&!!To&&/Apple Computer/.test(To.vendor),Io=Y&&(/Mobile\/\w+/.test(Do)||!!To&&To.maxTouchPoints>2),Lo=Io||(To?/Mac/.test(To.platform):!1),Ro=To?/Win/.test(To.platform):!1,zo=/Android \d/.test(Do),Bo=!!Eo&&`webkitFontSmoothing`in Eo.documentElement.style,Vo=Bo?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Ho(e){let t=e.defaultView&&e.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function Uo(e,t){return typeof e==`number`?e:e[t]}function Wo(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,r=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*r}}function Go(e,t,n){let r=e.someProp(`scrollThreshold`)||0,i=e.someProp(`scrollMargin`)||5,a=e.dom.ownerDocument;for(let o=n||e.dom;o;){if(o.nodeType!=1){o=co(o);continue}let e=o,n=e==a.body,s=n?Ho(a):Wo(e),c=0,l=0;if(t.top<s.top+Uo(r,`top`)?l=-(s.top-t.top+Uo(i,`top`)):t.bottom>s.bottom-Uo(r,`bottom`)&&(l=t.bottom-t.top>s.bottom-s.top?t.top+Uo(i,`top`)-s.top:t.bottom-s.bottom+Uo(i,`bottom`)),t.left<s.left+Uo(r,`left`)?c=-(s.left-t.left+Uo(i,`left`)):t.right>s.right-Uo(r,`right`)&&(c=t.right-s.right+Uo(i,`right`)),c||l)if(n)a.defaultView.scrollBy(c,l);else{let n=e.scrollLeft,r=e.scrollTop;l&&(e.scrollTop+=l),c&&(e.scrollLeft+=c);let i=e.scrollLeft-n,a=e.scrollTop-r;t={left:t.left-i,top:t.top-a,right:t.right-i,bottom:t.bottom-a}}let u=n?`fixed`:getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(u))break;o=u==`absolute`?o.offsetParent:co(o)}}function Ko(e){let t=e.dom.getBoundingClientRect(),n=Math.max(0,t.top),r,i;for(let a=(t.left+t.right)/2,o=n+1;o<Math.min(innerHeight,t.bottom);o+=5){let t=e.root.elementFromPoint(a,o);if(!t||t==e.dom||!e.dom.contains(t))continue;let s=t.getBoundingClientRect();if(s.top>=n-20){r=t,i=s.top;break}}return{refDOM:r,refTop:i,stack:qo(e.dom)}}function qo(e){let t=[],n=e.ownerDocument;for(let r=e;r&&(t.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),e!=n);r=co(r));return t}function Jo({refDOM:e,refTop:t,stack:n}){let r=e?e.getBoundingClientRect().top:0;Yo(n,r==0?0:r-t)}function Yo(e,t){for(let n=0;n<e.length;n++){let{dom:r,top:i,left:a}=e[n];r.scrollTop!=i+t&&(r.scrollTop=i+t),r.scrollLeft!=a&&(r.scrollLeft=a)}}var Xo=null;function Zo(e){if(e.setActive)return e.setActive();if(Xo)return e.focus(Xo);let t=qo(e);e.focus(Xo==null?{get preventScroll(){return Xo={preventScroll:!0},!0}}:void 0),Xo||(Xo=!1,Yo(t,0))}function Qo(e,t){let n,r=2e8,i,a=0,o=t.top,s=t.top,c,l;for(let u=e.firstChild,d=0;u;u=u.nextSibling,d++){let e;if(u.nodeType==1)e=u.getClientRects();else if(u.nodeType==3)e=uo(u).getClientRects();else continue;for(let f=0;f<e.length;f++){let p=e[f];if(p.top<=o&&p.bottom>=s){o=Math.max(p.bottom,o),s=Math.min(p.top,s);let e=p.left>t.left?p.left-t.left:p.right<t.left?t.left-p.right:0;if(e<r){n=u,r=e,i=e&&n.nodeType==3?{left:p.right<t.left?p.right:p.left,top:t.top}:t,u.nodeType==1&&e&&(a=d+(t.left>=(p.left+p.right)/2?1:0));continue}}else p.top>t.top&&!c&&p.left<=t.left&&p.right>=t.left&&(c=u,l={left:Math.max(p.left,Math.min(p.right,t.left)),top:p.top});!n&&(t.left>=p.right&&t.top>=p.top||t.left>=p.left&&t.top>=p.bottom)&&(a=d+1)}}return!n&&c&&(n=c,i=l,r=0),n&&n.nodeType==3?$o(n,i):!n||r&&n.nodeType==1?{node:e,offset:a}:Qo(n,i)}function $o(e,t){let n=e.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(e,i+1),r.setStart(e,i);let n=us(r,1);if(n.top!=n.bottom&&es(t,n))return{node:e,offset:i+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}function es(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function ts(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}function ns(e,t,n){let{node:r,offset:i}=Qo(t,n),a=-1;if(r.nodeType==1&&!r.firstChild){let e=r.getBoundingClientRect();a=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(r,i,a)}function rs(e,t,n,r){let i=-1;for(let n=t,a=!1;n!=e.dom;){let t=e.docView.nearestDesc(n,!0),o;if(!t)return null;if(t.dom.nodeType==1&&(t.node.isBlock&&t.parent||!t.contentDOM)&&((o=t.dom.getBoundingClientRect()).width||o.height)&&(t.node.isBlock&&t.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(t.dom.nodeName)&&(!a&&o.left>r.left||o.top>r.top?i=t.posBefore:(!a&&o.right<r.left||o.bottom<r.top)&&(i=t.posAfter),a=!0),!t.contentDOM&&i<0&&!t.node.isText))return(t.node.isBlock?r.top<(o.top+o.bottom)/2:r.left<(o.left+o.right)/2)?t.posBefore:t.posAfter;n=t.dom.parentNode}return i>-1?i:e.docView.posFromDOM(t,n,-1)}function ss(e,t,n){let r=e.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(t.top-n.top)/(n.bottom-n.top))-2)),a=i;;){let n=e.childNodes[a];if(n.nodeType==1){let e=n.getClientRects();for(let r=0;r<e.length;r++){let i=e[r];if(es(t,i))return ss(n,t,i)}}if((a=(a+1)%r)==i)break}return e}function cs(e,t){let n=e.dom.ownerDocument,r,i=0,a=wo(n,t.left,t.top);a&&({node:r,offset:i}=a);let o=(e.root.elementFromPoint?e.root:n).elementFromPoint(t.left,t.top),s;if(!o||!e.dom.contains(o.nodeType==1?o:o.parentNode)){let n=e.dom.getBoundingClientRect();if(!es(t,n)||(o=ss(e.dom,t,n),!o))return null}if(Y)for(let e=o;r&&e;e=co(e))e.draggable&&(r=void 0);if(o=ts(o,t),r){if(No&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let e=r.childNodes[i],n;e.nodeName==`IMG`&&(n=e.getBoundingClientRect()).right<=t.left&&n.bottom>t.top&&i++}let n;Bo&&i&&r.nodeType==1&&(n=r.childNodes[i-1]).nodeType==1&&n.contentEditable==`false`&&n.getBoundingClientRect().top>=t.top&&i--,r==e.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&t.top>r.lastChild.getBoundingClientRect().bottom?s=e.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!=`BR`)&&(s=rs(e,r,i,t))}s??=ns(e,o,t);let c=e.docView.nearestDesc(o,!0);return{pos:s,inside:c?c.posAtStart-c.border:-1}}function ls(e){return e.top<e.bottom||e.left<e.right}function us(e,t){let n=e.getClientRects();if(n.length){let e=n[t<0?0:n.length-1];if(ls(e))return e}return Array.prototype.find.call(n,ls)||e.getBoundingClientRect()}var ds=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function fs(e,t,n){let{node:r,offset:i,atom:a}=e.docView.domFromPos(t,n<0?-1:1),o=Bo||No;if(r.nodeType==3)if(o&&(ds.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let e=us(uo(r,i,i),n);if(No&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let t=us(uo(r,i-1,i-1),-1);if(t.top==e.top){let n=us(uo(r,i,i+1),-1);if(n.top!=e.top)return ps(n,n.left<t.left)}}return e}else{let e=i,t=i,a=n<0?1:-1;return n<0&&!i?(t++,a=-1):n>=0&&i==r.nodeValue.length?(e--,a=1):n<0?e--:t++,ps(us(uo(r,e,t),a),a<0)}if(!e.state.doc.resolve(t-(a||0)).parent.inlineContent){if(a==null&&i&&(n<0||i==go(r))){let e=r.childNodes[i-1];if(e.nodeType==1)return ms(e.getBoundingClientRect(),!1)}if(a==null&&i<go(r)){let e=r.childNodes[i];if(e.nodeType==1)return ms(e.getBoundingClientRect(),!0)}return ms(r.getBoundingClientRect(),n>=0)}if(a==null&&i&&(n<0||i==go(r))){let e=r.childNodes[i-1],t=e.nodeType==3?uo(e,go(e)-(o?0:1)):e.nodeType==1&&(e.nodeName!=`BR`||!e.nextSibling)?e:null;if(t)return ps(us(t,1),!1)}if(a==null&&i<go(r)){let e=r.childNodes[i];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?e.nodeType==3?uo(e,0,o?0:1):e.nodeType==1?e:null:null;if(t)return ps(us(t,-1),!0)}return ps(us(r.nodeType==3?uo(r):r,-n),n>=0)}function ps(e,t){if(e.width==0)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function ms(e,t){if(e.height==0)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function hs(e,t,n){let r=e.state,i=e.root.activeElement;r!=t&&e.updateState(t),i!=e.dom&&e.focus();try{return n()}finally{r!=t&&e.updateState(r),i!=e.dom&&i&&i.focus()}}function gs(e,t,n){let r=t.selection,i=n==`up`?r.$from:r.$to;return hs(e,t,()=>{let{node:t}=e.docView.domFromPos(i.pos,n==`up`?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let r=fs(e,i.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(e.nodeType==1)t=e.getClientRects();else if(e.nodeType==3)t=uo(e,0,e.nodeValue.length).getClientRects();else continue;for(let e=0;e<t.length;e++){let i=t[e];if(i.bottom>i.top+1&&(n==`up`?r.top-i.top>(i.bottom-r.top)*2:i.bottom-r.bottom>(r.bottom-i.top)*2))return!1}}return!0})}var _s=/[\u0590-\u08ac]/;function vs(e,t,n){let{$head:r}=t.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,a=!i,o=i==r.parent.content.size,s=e.domSelection();return s?!_s.test(r.parent.textContent)||!s.modify?n==`left`||n==`backward`?a:o:hs(e,t,()=>{let{focusNode:t,focusOffset:i,anchorNode:a,anchorOffset:o}=e.domSelectionRange(),c=s.caretBidiLevel;s.modify(`move`,n,`character`);let l=r.depth?e.docView.domAfterPos(r.before()):e.dom,{focusNode:u,focusOffset:d}=e.domSelectionRange(),f=u&&!l.contains(u.nodeType==1?u:u.parentNode)||t==u&&i==d;try{s.collapse(a,o),t&&(t!=a||i!=o)&&s.extend&&s.extend(t,i)}catch{}return c!=null&&(s.caretBidiLevel=c),f}):r.pos==r.start()||r.pos==r.end()}var ys=null,bs=null,xs=!1;function Ss(e,t,n){return ys==t&&bs==n?xs:(ys=t,bs=n,xs=n==`up`||n==`down`?gs(e,t,n):vs(e,t,n))}var Cs=0,ws=1,Ts=2,Es=3,Ds=class{constructor(e,t,n,r){this.parent=e,this.children=t,this.dom=n,this.contentDOM=r,this.dirty=Cs,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let r=this.children[t];if(r==e)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let n,r;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&!((r=n.pmViewDesc)&&r.parent==this);)n=n.previousSibling;return n?this.posBeforeChild(r)+r.size:this.posAtStart}else{let n,r;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&!((r=n.pmViewDesc)&&r.parent==this);)n=n.nextSibling;return n?this.posBeforeChild(r):this.posAtEnd}let r;if(e==this.dom&&this.contentDOM)r=t>q(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let t=e;;t=t.parentNode){if(t==this.dom){r=!1;break}if(t.previousSibling)break}if(r==null&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){r=!0;break}if(t.nextSibling)break}}return r??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,r=e;r;r=r.parentNode){let i=this.getDesc(r),a;if(i&&(!t||i.node))if(n&&(a=i.nodeDOM)&&!(a.nodeType==1?a.contains(e.nodeType==1?e:e.parentNode):a==e))n=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let e=t;e;e=e.parent)if(e==this)return t}posFromDOM(e,t,n){for(let r=e;r;r=r.parentNode){let i=this.getDesc(r);if(i)return i.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let r=this.children[t],i=n+r.size;if(n==e&&i!=n){for(;!r.border&&r.children.length;)for(let e=0;e<r.children.length;e++){let t=r.children[e];if(t.size){r=t;break}}return r}if(e<i)return r.descAt(e-n-r.border);n=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,r=0;for(let t=0;n<this.children.length;n++){let i=this.children[n],a=t+i.size;if(a>e||i instanceof Ps){r=e-t;break}t=a}if(r)return this.children[n].domFromPos(r-this.children[n].border,t);for(let e;n&&!(e=this.children[n-1]).size&&e instanceof Os&&e.side>=0;n--);if(t<=0){let e,r=!0;for(;e=n?this.children[n-1]:null,!(!e||e.dom.parentNode==this.contentDOM);n--,r=!1);return e&&t&&r&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?q(e.dom)+1:0}}else{let e,r=!0;for(;e=n<this.children.length?this.children[n]:null,!(!e||e.dom.parentNode==this.contentDOM);n++,r=!1);return e&&r&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?q(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,i=-1;for(let a=n,o=0;;o++){let n=this.children[o],s=a+n.size;if(r==-1&&e<=s){let i=a+n.border;if(e>=i&&t<=s-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,i);e=a;for(let t=o;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){r=q(n.dom)+1;break}e-=n.size}r==-1&&(r=0)}if(r>-1&&(s>t||o==this.children.length-1)){t=s;for(let e=o+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){i=q(n.dom);break}t+=n.size}i==-1&&(i=this.contentDOM.childNodes.length);break}a=s}return{node:this.contentDOM,from:e,to:t,fromOffset:r,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(t.nodeType!=1||n==t.childNodes.length)throw RangeError(`No node after pos `+e);return t.childNodes[n]}setSelection(e,t,n,r=!1){let i=Math.min(e,t),a=Math.max(e,t);for(let o=0,s=0;o<this.children.length;o++){let c=this.children[o],l=s+c.size;if(i>s&&a<l)return c.setSelection(e-s-c.border,t-s-c.border,n,r);s=l}let o=this.domFromPos(e,e?-1:1),s=t==e?o:this.domFromPos(t,t?-1:1),c=n.root.getSelection(),l=n.domSelectionRange(),u=!1;if((No||Y)&&e==t){let{node:e,offset:t}=o;if(e.nodeType==3){if(u=!!(t&&e.nodeValue[t-1]==`
`),u&&t==e.nodeValue.length)for(let t=e,n;t;t=t.parentNode){if(n=t.nextSibling){n.nodeName==`BR`&&(o=s={node:n.parentNode,offset:q(n)+1});break}let e=t.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];u=n&&(n.nodeName==`BR`||n.contentEditable==`false`)}}if(No&&l.focusNode&&l.focusNode!=s.node&&l.focusNode.nodeType==1){let e=l.focusNode.childNodes[l.focusOffset];e&&e.contentEditable==`false`&&(r=!0)}if(!(r||u&&Y)&&po(o.node,o.offset,l.anchorNode,l.anchorOffset)&&po(s.node,s.offset,l.focusNode,l.focusOffset))return;let d=!1;if((c.extend||e==t)&&!(u&&No)){c.collapse(o.node,o.offset);try{e!=t&&c.extend(s.node,s.offset),d=!0}catch{}}if(!d){if(e>t){let e=o;o=s,s=e}let n=document.createRange();n.setEnd(s.node,s.offset),n.setStart(o.node,o.offset),c.removeAllRanges(),c.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&e.type!=`selection`}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,r=0;r<this.children.length;r++){let i=this.children[r],a=n+i.size;if(n==a?e<=a&&t>=n:e<a&&t>n){let r=n+i.border,o=a-i.border;if(e>=r&&t<=o){this.dirty=e==n||t==a?Ts:ws,e==r&&t==o&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=Es:i.markDirty(e-r,t-r);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Ts:Es}n=a}this.dirty=Ts}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=e==1?Ts:ws;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}},Os=class extends Ds{constructor(e,t,n,r){let i,a=t.type.toDOM;if(typeof a==`function`&&(a=a(n,()=>{if(!i)return r;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(a.nodeType!=1){let e=document.createElement(`span`);e.appendChild(a),a=e}a.contentEditable=`false`,a.classList.add(`ProseMirror-widget`)}super(e,[],a,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==Cs&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!=`selection`||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}},ks=class extends Ds{constructor(e,t,n,r){super(e,[],t,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(e,t){return e==this.textDOM?this.posAtStart+t:this.posAtStart+(t?this.size:0)}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type===`characterData`&&e.target.nodeValue==e.oldValue}},As=class e extends Ds{constructor(e,t,n,r,i){super(e,[],n,r),this.mark=t,this.spec=i}static create(t,n,r,i){let a=i.nodeViews[n.type.name],o=a&&a(n,i,r);return(!o||!o.dom)&&(o=Ti.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new e(t,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&Es||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Es&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Cs){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=Cs}}slice(t,n,r){let i=e.create(this.parent,this.mark,!0,r),a=this.children,o=this.size;n<o&&(a=Zs(a,n,o,r)),t>0&&(a=Zs(a,0,t,r));for(let e=0;e<a.length;e++)a[e].parent=i;return i.children=a,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}},js=class e extends Ds{constructor(e,t,n,r,i,a,o,s,c){super(e,[],i,a),this.node=t,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=o}static create(t,n,r,i,a,o){let s=a.nodeViews[n.type.name],c,l=s&&s(n,a,()=>{if(!c)return o;if(c.parent)return c.parent.posBeforeChild(c)},r,i),u=l&&l.dom,d=l&&l.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw RangeError(`Text must be rendered as a DOM text node`)}else if(!u){let e=Ti.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs);({dom:u,contentDOM:d}=e)}!d&&!n.isText&&u.nodeName!=`BR`&&(u.hasAttribute(`contenteditable`)||(u.contentEditable=`false`),n.type.spec.draggable&&(u.draggable=!0));let f=u;return u=Hs(u,r,n),l?c=new Fs(t,n,r,i,u,d||null,f,l,a,o+1):n.isText?new Ns(t,n,r,i,u,f,a):new e(t,n,r,i,u,d||null,f,a,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace==`pre`&&(e.preserveWhitespace=`full`),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>z.empty)}return e}matchesNode(e,t,n){return this.dirty==Cs&&e.eq(this.node)&&Us(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,r=t,i=e.composing?this.localCompositionInfo(e,t):null,a=i&&i.pos>-1?i:null,o=i&&i.pos<0,s=new Gs(this,a&&a.node,e);Js(this.node,this.innerDeco,(t,i,a)=>{t.spec.marks?s.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!a&&s.syncToMarks(i==this.node.childCount?B.none:this.node.child(i).marks,n,e),s.placeWidget(t,e,r)},(t,a,c,l)=>{s.syncToMarks(t.marks,n,e);let u;s.findNodeMatch(t,a,c,l)||o&&e.state.selection.from>r&&e.state.selection.to<r+t.nodeSize&&(u=s.findIndexWithChild(i.node))>-1&&s.updateNodeAt(t,a,c,u,e)||s.updateNextNode(t,a,c,e,l,r)||s.addNode(t,a,c,e,r),r+=t.nodeSize}),s.syncToMarks([],n,e),this.node.isTextblock&&s.addTextblockHacks(),s.destroyRest(),(s.changed||this.dirty==Ts)&&(a&&this.protectLocalComposition(e,a),Is(this.contentDOM,this.children,e),Io&&Ys(this.dom))}localCompositionInfo(e,t){let{from:n,to:r}=e.state.selection;if(!(e.state.selection instanceof G)||n<t||r>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let e=i.nodeValue,a=Xs(this.node.content,e,n-t,r-t);return a<0?null:{node:i,pos:a,text:e}}else return{node:i,pos:-1,text:``}}protectLocalComposition(e,{node:t,pos:n,text:r}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&=void 0}let a=new ks(this,i,t,r);e.input.compositionNodes.push(a),this.children=Zs(this.children,n,n+r.length,e,a)}update(e,t,n,r){return this.dirty==Es||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,n,r),!0)}updateInner(e,t,n,r){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=Cs}updateOuterDeco(e){if(Us(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=Bs(this.dom,this.nodeDOM,zs(this.outerDeco,this.node,t),zs(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add(`ProseMirror-selectednode`),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove(`ProseMirror-selectednode`),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute(`draggable`))}get domAtom(){return this.node.isAtom}};function Ms(e,t,n,r,i){Hs(r,t,e);let a=new js(void 0,e,t,n,r,r,r,i,0);return a.contentDOM&&a.updateChildren(i,0),a}var Ns=class e extends js{constructor(e,t,n,r,i,a,o){super(e,t,n,r,i,null,a,o,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,r){return this.dirty==Es||this.dirty!=Cs&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Cs||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=e,this.dirty=Cs,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return e.type!=`characterData`&&e.type!=`selection`}slice(t,n,r){let i=this.node.cut(t,n),a=document.createTextNode(i.text);return new e(this.parent,i,this.outerDeco,this.innerDeco,a,a,r)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=Es)}get domAtom(){return!1}isText(e){return this.node.text==e}},Ps=class extends Ds{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Cs&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName==`IMG`}},Fs=class extends js{constructor(e,t,n,r,i,a,o,s,c,l){super(e,t,n,r,i,a,o,c,l),this.spec=s}update(e,t,n,r){if(this.dirty==Es)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,n);return i&&this.updateInner(e,t,n,r),i}else if(!this.contentDOM&&!e.isLeaf)return!1;else return super.update(e,t,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,r){this.spec.setSelection?this.spec.setSelection(e,t,n.root):super.setSelection(e,t,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}};function Is(e,t,n){let r=e.firstChild,i=!1;for(let a=0;a<t.length;a++){let o=t[a],s=o.dom;if(s.parentNode==e){for(;s!=r;)r=Ws(r),i=!0;r=r.nextSibling}else i=!0,e.insertBefore(s,r);if(o instanceof As){let t=r?r.previousSibling:e.lastChild;Is(o.contentDOM,o.children,n),r=t?t.nextSibling:e.firstChild}}for(;r;)r=Ws(r),i=!0;i&&n.trackWrites==e&&(n.trackWrites=null)}var Ls=function(e){e&&(this.nodeName=e)};Ls.prototype=Object.create(null);var Rs=[new Ls];function zs(e,t,n){if(e.length==0)return Rs;let r=n?Rs[0]:new Ls,i=[r];for(let a=0;a<e.length;a++){let o=e[a].type.attrs;if(o)for(let e in o.nodeName&&i.push(r=new Ls(o.nodeName)),o){let a=o[e];a!=null&&(n&&i.length==1&&i.push(r=new Ls(t.isInline?`span`:`div`)),e==`class`?r.class=(r.class?r.class+` `:``)+a:e==`style`?r.style=(r.style?r.style+`;`:``)+a:e!=`nodeName`&&(r[e]=a))}}return i}function Bs(e,t,n,r){if(n==Rs&&r==Rs)return t;let i=t;for(let t=0;t<r.length;t++){let a=r[t],o=n[t];if(t){let t;o&&o.nodeName==a.nodeName&&i!=e&&(t=i.parentNode)&&t.nodeName.toLowerCase()==a.nodeName?i=t:(t=document.createElement(a.nodeName),t.pmIsDeco=!0,t.appendChild(i),o=Rs[0],i=t)}Vs(i,o||Rs[0],a)}return i}function Vs(e,t,n){for(let r in t)r!=`class`&&r!=`style`&&r!=`nodeName`&&!(r in n)&&e.removeAttribute(r);for(let r in n)r!=`class`&&r!=`style`&&r!=`nodeName`&&n[r]!=t[r]&&e.setAttribute(r,n[r]);if(t.class!=n.class){let r=t.class?t.class.split(` `).filter(Boolean):[],i=n.class?n.class.split(` `).filter(Boolean):[];for(let t=0;t<r.length;t++)i.indexOf(r[t])==-1&&e.classList.remove(r[t]);for(let t=0;t<i.length;t++)r.indexOf(i[t])==-1&&e.classList.add(i[t]);e.classList.length==0&&e.removeAttribute(`class`)}if(t.style!=n.style){if(t.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,r;for(;r=n.exec(t.style);)e.style.removeProperty(r[1])}n.style&&(e.style.cssText+=n.style)}}function Hs(e,t,n){return Bs(e,e,Rs,zs(t,n,e.nodeType!=1))}function Us(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function Ws(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}var Gs=class{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Ks(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let r=0,i=this.stack.length>>1,a=Math.min(i,e.length);for(;r<a&&(r==i-1?this.top:this.stack[r+1<<1]).matchesMark(e[r])&&e[r].type.spec.spanning!==!1;)r++;for(;r<i;)this.destroyRest(),this.top.dirty=Cs,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let r=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[i])&&!this.isLocked(n.dom)){r=t;break}}if(r>-1)r>this.index&&(this.changed=!0,this.destroyBetween(this.index,r)),this.top=this.top.children[this.index];else{let r=As.create(this.top,e[i],t,n);this.top.children.splice(this.index,0,r),this.top=r,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,n,r){let i=-1,a;if(r>=this.preMatch.index&&(a=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&a.matchesNode(e,t,n))i=this.top.children.indexOf(a,this.index);else for(let r=this.index,a=Math.min(this.top.children.length,r+5);r<a;r++){let a=this.top.children[r];if(a.matchesNode(e,t,n)&&!this.preMatch.matched.has(a)){i=r;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,n,r,i){let a=this.top.children[r];return a.dirty==Es&&a.dom==a.contentDOM&&(a.dirty=Ts),a.update(e,t,n,i)?(this.destroyBetween(this.index,r),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t){for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e}return-1}e=t}}updateNextNode(e,t,n,r,i,a){for(let o=this.index;o<this.top.children.length;o++){let s=this.top.children[o];if(s instanceof js){let c=this.preMatch.matched.get(s);if(c!=null&&c!=i)return!1;let l=s.dom,u,d=this.isLocked(l)&&!(e.isText&&s.node&&s.node.isText&&s.nodeDOM.nodeValue==e.text&&s.dirty!=Es&&Us(t,s.outerDeco));if(!d&&s.update(e,t,n,r))return this.destroyBetween(this.index,o),s.dom!=l&&(this.changed=!0),this.index++,!0;if(!d&&(u=this.recreateWrapper(s,e,t,n,r,a)))return this.destroyBetween(this.index,o),this.top.children[this.index]=u,u.contentDOM&&(u.dirty=Ts,u.updateChildren(r,a+1),u.dirty=Cs),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,r,i,a){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!Us(n,e.outerDeco)||!r.eq(e.innerDeco))return null;let o=js.create(this.top,t,n,r,i,a);if(o.contentDOM){o.children=e.children,e.children=[];for(let e of o.children)e.parent=o}return e.destroy(),o}addNode(e,t,n,r,i){let a=js.create(this.top,e,t,n,r,i);a.contentDOM&&a.updateChildren(r,i+1),this.top.children.splice(this.index++,0,a),this.changed=!0}placeWidget(e,t,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(r&&r.matchesWidget(e)&&(e==r.widget||!r.widget.type.toDOM.parentNode))this.index++;else{let r=new Os(this.top,e,t,n);this.top.children.splice(this.index++,0,r),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof As;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Ns)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Y||J)&&e&&e.dom.contentEditable==`false`&&this.addHackNode(`IMG`,t),this.addHackNode(`BR`,this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e==`IMG`&&(n.className=`ProseMirror-separator`,n.alt=``),e==`BR`&&(n.className=`ProseMirror-trailingBreak`);let r=new Ps(this.top,[],n,null);t==this.top?t.children.splice(this.index++,0,r):t.children.push(r),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}};function Ks(e,t){let n=t,r=n.children.length,i=e.childCount,a=new Map,o=[];outer:for(;i>0;){let s;for(;;)if(r){let e=n.children[r-1];if(e instanceof As)n=e,r=e.children.length;else{s=e,r--;break}}else if(n==t)break outer;else r=n.parent.children.indexOf(n),n=n.parent;let c=s.node;if(c){if(c!=e.child(i-1))break;--i,a.set(s,i),o.push(s)}}return{index:i,matched:a,matches:o.reverse()}}function qs(e,t){return e.type.side-t.type.side}function Js(e,t,n,r){let i=t.locals(e),a=0;if(i.length==0){for(let n=0;n<e.childCount;n++){let o=e.child(n);r(o,i,t.forChild(a,o),n),a+=o.nodeSize}return}let o=0,s=[],c=null;for(let l=0;;){let u,d;for(;o<i.length&&i[o].to==a;){let e=i[o++];e.widget&&(u?(d||=[u]).push(e):u=e)}if(u)if(d){d.sort(qs);for(let e=0;e<d.length;e++)n(d[e],l,!!c)}else n(u,l,!!c);let f,p;if(c)p=-1,f=c,c=null;else if(l<e.childCount)p=l,f=e.child(l++);else break;for(let e=0;e<s.length;e++)s[e].to<=a&&s.splice(e--,1);for(;o<i.length&&i[o].from<=a&&i[o].to>a;)s.push(i[o++]);let m=a+f.nodeSize;if(f.isText){let e=m;o<i.length&&i[o].from<e&&(e=i[o].from);for(let t=0;t<s.length;t++)s[t].to<e&&(e=s[t].to);e<m&&(c=f.cut(e-a),f=f.cut(0,e-a),m=e,p=-1)}else for(;o<i.length&&i[o].to<m;)o++;let h=f.isInline&&!f.isLeaf?s.filter(e=>!e.inline):s.slice();r(f,h,t.forChild(a,f),p),a=m}}function Ys(e){if(e.nodeName==`UL`||e.nodeName==`OL`){let t=e.style.cssText;e.style.cssText=t+`; list-style: square !important`,window.getComputedStyle(e).listStyle,e.style.cssText=t}}function Xs(e,t,n,r){for(let i=0,a=0;i<e.childCount&&a<=r;){let o=e.child(i++),s=a;if(a+=o.nodeSize,!o.isText)continue;let c=o.text;for(;i<e.childCount;){let t=e.child(i++);if(a+=t.nodeSize,!t.isText)break;c+=t.text}if(a>=n){if(a>=r&&c.slice(r-t.length-s,r-s)==t)return r-t.length;let e=s<r?c.lastIndexOf(t,r-s-1):-1;if(e>=0&&e+t.length+s>=n)return s+e;if(n==r&&c.length>=r+t.length-s&&c.slice(r-s,r-s+t.length)==t)return r}}return-1}function Zs(e,t,n,r,i){let a=[];for(let o=0,s=0;o<e.length;o++){let c=e[o],l=s,u=s+=c.size;l>=n||u<=t?a.push(c):(l<t&&a.push(c.slice(0,t-l,r)),i&&=(a.push(i),void 0),u>n&&a.push(c.slice(n-l,c.size,r)))}return a}function Qs(e,t=null){let n=e.domSelectionRange(),r=e.state.doc;if(!n.focusNode)return null;let i=e.docView.nearestDesc(n.focusNode),a=i&&i.size==0,o=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let s=r.resolve(o),c,l;if(xo(n)){for(c=o;i&&!i.node;)i=i.parent;let e=i.node;if(i&&e.isAtom&&K.isSelectable(e)&&i.parent&&!(e.isInline&&yo(n.focusNode,n.focusOffset,i.dom))){let e=i.posBefore;l=new K(o==e?s:r.resolve(e))}}else{if(n instanceof e.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let t=o,i=o;for(let r=0;r<n.rangeCount;r++){let a=n.getRangeAt(r);t=Math.min(t,e.docView.posFromDOM(a.startContainer,a.startOffset,1)),i=Math.max(i,e.docView.posFromDOM(a.endContainer,a.endOffset,-1))}if(t<0)return null;[c,o]=i==e.state.selection.anchor?[i,t]:[t,i],s=r.resolve(o)}else c=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(c<0)return null}let u=r.resolve(c);if(!l){let n=t==`pointer`||e.state.selection.head<s.pos&&!a?1:-1;l=lc(e,u,s,n)}return l}function $s(e){return e.editable?e.hasFocus():dc(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function ec(e,t=!1){let n=e.state.selection;if(sc(e,n),$s(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&J){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&po(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset)){e.input.mouseDown.delayedSelectionSync=!0,e.domObserver.setCurSelection();return}}if(e.domObserver.disconnectSelection(),e.cursorWrapper)oc(e);else{let{anchor:r,head:i}=n,a,o;tc&&!(n instanceof G)&&(n.$from.parent.inlineContent||(a=nc(e,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=nc(e,n.to))),e.docView.setSelection(r,i,e,t),tc&&(a&&ic(a),o&&ic(o)),n.visible?e.dom.classList.remove(`ProseMirror-hideselection`):(e.dom.classList.add(`ProseMirror-hideselection`),`onselectionchange`in document&&ac(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}var tc=Y||J&&Fo<63;function nc(e,t){let{node:n,offset:r}=e.docView.domFromPos(t,0),i=r<n.childNodes.length?n.childNodes[r]:null,a=r?n.childNodes[r-1]:null;if(Y&&i&&i.contentEditable==`false`)return rc(i);if((!i||i.contentEditable==`false`)&&(!a||a.contentEditable==`false`)){if(i)return rc(i);if(a)return rc(a)}}function rc(e){return e.contentEditable=`true`,Y&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function ic(e){e.contentEditable=`false`,e.wasDraggable&&=(e.draggable=!0,null)}function ac(e){let t=e.dom.ownerDocument;t.removeEventListener(`selectionchange`,e.input.hideSelectionGuard);let n=e.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;t.addEventListener(`selectionchange`,e.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(t.removeEventListener(`selectionchange`,e.input.hideSelectionGuard),setTimeout(()=>{(!$s(e)||e.state.selection.visible)&&e.dom.classList.remove(`ProseMirror-hideselection`)},20))})}function oc(e){let t=e.domSelection();if(!t)return;let n=e.cursorWrapper.dom,r=n.nodeName==`IMG`;r?t.collapse(n.parentNode,q(n)+1):t.collapse(n,0),!r&&!e.state.selection.visible&&jo&&Mo<=11&&(n.disabled=!0,n.disabled=!1)}function sc(e,t){if(t instanceof K){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(cc(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else cc(e)}function cc(e){e.lastSelectedViewDesc&&=(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),void 0)}function lc(e,t,n,r){return e.someProp(`createSelectionBetween`,r=>r(e,t,n))||G.between(t,n,r)}function uc(e){return e.editable&&!e.hasFocus()?!1:dc(e)}function dc(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function fc(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return po(t.node,t.offset,n.anchorNode,n.anchorOffset)}function pc(e,t){let{$anchor:n,$head:r}=e.selection,i=t>0?n.max(r):n.min(r),a=i.parent.inlineContent?i.depth?e.doc.resolve(t>0?i.after():i.before()):null:i;return a&&W.findFrom(a,t)}function mc(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function hc(e,t,n){let r=e.state.selection;if(r instanceof G)if(n.indexOf(`s`)>-1){let{$head:n}=r,i=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let a=e.state.doc.resolve(n.pos+i.nodeSize*(t<0?-1:1));return mc(e,new G(r.$anchor,a))}else if(r.empty){if(e.endOfTextblock(t>0?`forward`:`backward`)){let n=pc(e.state,t);return n&&n instanceof K?mc(e,n):!1}else if(!(Lo&&n.indexOf(`m`)>-1)){let n=r.$head,i=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter,a;if(!i||i.isText)return!1;let o=t<0?n.pos-i.nodeSize:n.pos;return i.isAtom||(a=e.docView.descAt(o))&&!a.contentDOM?K.isSelectable(i)?mc(e,new K(t<0?e.state.doc.resolve(n.pos-i.nodeSize):n)):Bo?mc(e,new G(e.state.doc.resolve(t<0?o:o+i.nodeSize))):!1:!1}}else return!1;else if(r instanceof K&&r.node.isInline)return mc(e,new G(t>0?r.$to:r.$from));else{let n=pc(e.state,t);return n?mc(e,n):!1}}function gc(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function _c(e,t){let n=e.pmViewDesc;return n&&n.size==0&&(t<0||e.nextSibling||e.nodeName!=`BR`)}function vc(e,t){return t<0?yc(e):bc(e)}function yc(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let i,a,o=!1;for(No&&n.nodeType==1&&r<gc(n)&&_c(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let e=n.childNodes[r-1];if(_c(e,-1))i=n,a=--r;else if(e.nodeType==3)n=e,r=n.nodeValue.length;else break}}else if(xc(n))break;else{let t=n.previousSibling;for(;t&&_c(t,-1);)i=n.parentNode,a=q(t),t=t.previousSibling;if(t)n=t,r=gc(n);else{if(n=n.parentNode,n==e.dom)break;r=0}}o?wc(e,n,r):i&&wc(e,i,a)}function bc(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let i=gc(n),a,o;for(;;)if(r<i){if(n.nodeType!=1)break;let e=n.childNodes[r];if(_c(e,1))a=n,o=++r;else break}else if(xc(n))break;else{let t=n.nextSibling;for(;t&&_c(t,1);)a=t.parentNode,o=q(t)+1,t=t.nextSibling;if(t)n=t,r=0,i=gc(n);else{if(n=n.parentNode,n==e.dom)break;r=i=0}}a&&wc(e,a,o)}function xc(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Sc(e,t){for(;e&&t==e.childNodes.length&&!bo(e);)t=q(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable==`false`)break;e=n,t=0}}function Cc(e,t){for(;e&&!t&&!bo(e);)t=q(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable==`false`)break;e=n,t=e.childNodes.length}}function wc(e,t,n){if(t.nodeType!=3){let e,r;(r=Sc(t,n))?(t=r,n=0):(e=Cc(t,n))&&(t=e,n=e.nodeValue.length)}let r=e.domSelection();if(!r)return;if(xo(r)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),r.removeAllRanges(),r.addRange(e)}else r.extend&&r.extend(t,n);e.domObserver.setCurSelection();let{state:i}=e;setTimeout(()=>{e.state==i&&ec(e)},50)}function Tc(e,t){let n=e.state.doc.resolve(t);if(!(J||Ro)&&n.parent.inlineContent){let r=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),i=(n.top+n.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(n.left-r.left)>1)return n.left<r.left?`ltr`:`rtl`}if(t<n.end()){let n=e.coordsAtPos(t+1),i=(n.top+n.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(n.left-r.left)>1)return n.left>r.left?`ltr`:`rtl`}}return getComputedStyle(e.dom).direction==`rtl`?`rtl`:`ltr`}function Ec(e,t,n){let r=e.state.selection;if(r instanceof G&&!r.empty||n.indexOf(`s`)>-1||Lo&&n.indexOf(`m`)>-1)return!1;let{$from:i,$to:a}=r;if(!i.parent.inlineContent||e.endOfTextblock(t<0?`up`:`down`)){let n=pc(e.state,t);if(n&&n instanceof K)return mc(e,n)}if(!i.parent.inlineContent){let n=t<0?i:a,o=r instanceof Wa?W.near(n,t):W.findFrom(n,t);return o?mc(e,o):!1}return!1}function Dc(e,t){if(!(e.state.selection instanceof G))return!0;let{$head:n,$anchor:r,empty:i}=e.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(e.endOfTextblock(t>0?`forward`:`backward`))return!0;let a=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(a&&!a.isText){let r=e.state.tr;return t<0?r.delete(n.pos-a.nodeSize,n.pos):r.delete(n.pos,n.pos+a.nodeSize),e.dispatch(r),!0}return!1}function Oc(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function kc(e){if(!Y||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&t.nodeType==1&&n==0&&t.firstChild&&t.firstChild.contentEditable==`false`){let n=t.firstChild;Oc(e,n,`true`),setTimeout(()=>Oc(e,n,`false`),20)}return!1}function Ac(e){let t=``;return e.ctrlKey&&(t+=`c`),e.metaKey&&(t+=`m`),e.altKey&&(t+=`a`),e.shiftKey&&(t+=`s`),t}function jc(e,t){let n=t.keyCode,r=Ac(t);if(n==8||Lo&&n==72&&r==`c`)return Dc(e,-1)||vc(e,-1);if(n==46&&!t.shiftKey||Lo&&n==68&&r==`c`)return Dc(e,1)||vc(e,1);if(n==13||n==27)return!0;if(n==37||Lo&&n==66&&r==`c`){let t=n==37?Tc(e,e.state.selection.from)==`ltr`?-1:1:-1;return hc(e,t,r)||vc(e,t)}else if(n==39||Lo&&n==70&&r==`c`){let t=n==39?Tc(e,e.state.selection.from)==`ltr`?1:-1:1;return hc(e,t,r)||vc(e,t)}else if(n==38||Lo&&n==80&&r==`c`)return Ec(e,-1,r)||vc(e,-1);else if(n==40||Lo&&n==78&&r==`c`)return kc(e)||Ec(e,1,r)||vc(e,1);else if(r==(Lo?`m`:`c`)&&(n==66||n==73||n==89||n==90))return!0;return!1}function Mc(e,t){e.someProp(`transformCopied`,n=>{t=n(t,e)});let n=[],{content:r,openStart:i,openEnd:a}=t;for(;i>1&&a>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,a--;let e=r.firstChild;n.push(e.type.name,e.attrs==e.type.defaultAttrs?null:e.attrs),r=e.content}let o=e.someProp(`clipboardSerializer`)||Ti.fromSchema(e.state.schema),s=Uc(),c=s.createElement(`div`);c.appendChild(o.serializeFragment(r,{document:s}));let l=c.firstChild,u,d=0;for(;l&&l.nodeType==1&&(u=Vc[l.nodeName.toLowerCase()]);){for(let e=u.length-1;e>=0;e--){let t=s.createElement(u[e]);for(;c.firstChild;)t.appendChild(c.firstChild);c.appendChild(t),d++}l=c.firstChild}l&&l.nodeType==1&&l.setAttribute(`data-pm-slice`,`${i} ${a}${d?` -${d}`:``} ${JSON.stringify(n)}`);let f=e.someProp(`clipboardTextSerializer`,n=>n(t,e))||t.content.textBetween(0,t.content.size,`

`);return{dom:c,text:f,slice:t}}function Nc(e,t,n,r,i){let a=i.parent.type.spec.code,o,s;if(!n&&!t)return null;let c=!!t&&(r||a||!n);if(c){if(e.someProp(`transformPastedText`,n=>{t=n(t,a||r,e)}),a)return s=new V(z.from(e.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0),e.someProp(`transformPasted`,t=>{s=t(s,e,!0)}),s;let n=e.someProp(`clipboardTextParser`,n=>n(t,i,r,e));if(n)s=n;else{let n=i.marks(),{schema:r}=e.state,a=Ti.fromSchema(r);o=document.createElement(`div`),t.split(/(?:\r\n?|\n)+/).forEach(e=>{let t=o.appendChild(document.createElement(`p`));e&&t.appendChild(a.serializeNode(r.text(e,n)))})}}else e.someProp(`transformPastedHTML`,t=>{n=t(n,e)}),o=Kc(n),Bo&&qc(o);let l=o&&o.querySelector(`[data-pm-slice]`),u=l&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(l.getAttribute(`data-pm-slice`)||``);if(u&&u[3])for(let e=+u[3];e>0;e--){let e=o.firstChild;for(;e&&e.nodeType!=1;)e=e.nextSibling;if(!e)break;o=e}if(s||=(e.someProp(`clipboardParser`)||e.someProp(`domParser`)||di.fromSchema(e.state.schema)).parseSlice(o,{preserveWhitespace:!!(c||u),context:i,ruleFromNode(e){return e.nodeName==`BR`&&!e.nextSibling&&e.parentNode&&!Pc.test(e.parentNode.nodeName)?{ignore:!0}:null}}),u)s=Jc(Bc(s,+u[1],+u[2]),u[4]);else if(s=V.maxOpen(Fc(s.content,i),!0),s.openStart||s.openEnd){let e=0,t=0;for(let t=s.content.firstChild;e<s.openStart&&!t.type.spec.isolating;e++,t=t.firstChild);for(let e=s.content.lastChild;t<s.openEnd&&!e.type.spec.isolating;t++,e=e.lastChild);s=Bc(s,e,t)}return e.someProp(`transformPasted`,t=>{s=t(s,e,c)}),s}var Pc=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Fc(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let r=t.node(n).contentMatchAt(t.index(n)),i,a=[];if(e.forEach(e=>{if(!a)return;let t=r.findWrapping(e.type),n;if(!t)return a=null;if(n=a.length&&i.length&&Lc(t,i,e,a[a.length-1],0))a[a.length-1]=n;else{a.length&&(a[a.length-1]=Rc(a[a.length-1],i.length));let n=Ic(e,t);a.push(n),r=r.matchType(n.type),i=t}}),a)return z.from(a)}return e}function Ic(e,t,n=0){for(let r=t.length-1;r>=n;r--)e=t[r].create(null,z.from(e));return e}function Lc(e,t,n,r,i){if(i<e.length&&i<t.length&&e[i]==t[i]){let a=Lc(e,t,n,r.lastChild,i+1);if(a)return r.copy(r.content.replaceChild(r.childCount-1,a));if(r.contentMatchAt(r.childCount).matchType(i==e.length-1?n.type:e[i+1]))return r.copy(r.content.append(z.from(Ic(n,e,i+1))))}}function Rc(e,t){if(t==0)return e;let n=e.content.replaceChild(e.childCount-1,Rc(e.lastChild,t-1)),r=e.contentMatchAt(e.childCount).fillBefore(z.empty,!0);return e.copy(n.append(r))}function zc(e,t,n,r,i,a){let o=t<0?e.firstChild:e.lastChild,s=o.content;return e.childCount>1&&(a=0),i<r-1&&(s=zc(s,t,n,r,i+1,a)),i>=n&&(s=t<0?o.contentMatchAt(0).fillBefore(s,a<=i).append(s):s.append(o.contentMatchAt(o.childCount).fillBefore(z.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,o.copy(s))}function Bc(e,t,n){return t<e.openStart&&(e=new V(zc(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new V(zc(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}var Vc={thead:[`table`],tbody:[`table`],tfoot:[`table`],caption:[`table`],colgroup:[`table`],col:[`table`,`colgroup`],tr:[`table`,`tbody`],td:[`table`,`tbody`,`tr`],th:[`table`,`tbody`,`tr`]},Hc=null;function Uc(){return Hc||=document.implementation.createHTMLDocument(`title`)}var Wc=null;function Gc(e){let t=window.trustedTypes;return t?(Wc||=t.defaultPolicy||t.createPolicy(`ProseMirrorClipboard`,{createHTML:e=>e}),Wc.createHTML(e)):e}function Kc(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n=Uc().createElement(`div`),r=/<([a-z][^>\s]+)/i.exec(e),i;if((i=r&&Vc[r[1].toLowerCase()])&&(e=i.map(e=>`<`+e+`>`).join(``)+e+i.map(e=>`</`+e+`>`).reverse().join(``)),n.innerHTML=Gc(e),i)for(let e=0;e<i.length;e++)n=n.querySelector(i[e])||n;return n}function qc(e){let t=e.querySelectorAll(J?`span:not([class]):not([style])`:`span.Apple-converted-space`);for(let n=0;n<t.length;n++){let r=t[n];r.childNodes.length==1&&r.textContent==`\xA0`&&r.parentNode&&r.parentNode.replaceChild(e.ownerDocument.createTextNode(` `),r)}}function Jc(e,t){if(!e.size)return e;let n=e.content.firstChild.type.schema,r;try{r=JSON.parse(t)}catch{return e}let{content:i,openStart:a,openEnd:o}=e;for(let e=r.length-2;e>=0;e-=2){let t=n.nodes[r[e]];if(!t||t.hasRequiredAttrs())break;i=z.from(t.create(r[e+1],i)),a++,o++}return new V(i,a,o)}var X={},Z={},Yc={touchstart:!0,touchmove:!0},Xc=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:``,button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function Zc(e){for(let t in X){let n=X[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{nl(e,t)&&!tl(e,t)&&(e.editable||!(t.type in Z))&&n(e,t)},Yc[t]?{passive:!0}:void 0)}Y&&e.dom.addEventListener(`input`,()=>null),el(e)}function Qc(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function $c(e){for(let t in e.domObserver.stop(),e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}function el(e){e.someProp(`handleDOMEvents`,t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>tl(e,t))})}function tl(e,t){return e.someProp(`handleDOMEvents`,n=>{let r=n[t.type];return r?r(e,t)||t.defaultPrevented:!1})}function nl(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function rl(e,t){!tl(e,t)&&X[t.type]&&(e.editable||!(t.type in Z))&&X[t.type](e,t)}Z.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=n.keyCode==16||n.shiftKey,!_l(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!(zo&&J&&n.keyCode==13)))if(n.keyCode!=229&&e.domObserver.forceFlush(),Io&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{e.input.lastIOSEnter==t&&(e.someProp(`handleKeyDown`,t=>t(e,So(13,`Enter`))),e.input.lastIOSEnter=0)},200)}else e.someProp(`handleKeyDown`,t=>t(e,n))||jc(e,n)?n.preventDefault():Qc(e,`key`)},Z.keyup=(e,t)=>{t.keyCode==16&&(e.input.shiftKey=!1)},Z.keypress=(e,t)=>{let n=t;if(_l(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||Lo&&n.metaKey)return;if(e.someProp(`handleKeyPress`,t=>t(e,n))){n.preventDefault();return}let r=e.state.selection;if(!(r instanceof G)||!r.$from.sameParent(r.$to)){let t=String.fromCharCode(n.charCode),i=()=>e.state.tr.insertText(t).scrollIntoView();!/[\r\n]/.test(t)&&!e.someProp(`handleTextInput`,n=>n(e,r.$from.pos,r.$to.pos,t,i))&&e.dispatch(i()),n.preventDefault()}};function il(e){return{left:e.clientX,top:e.clientY}}function al(e,t){let n=t.x-e.clientX,r=t.y-e.clientY;return n*n+r*r<100}function ol(e,t,n,r,i){if(r==-1)return!1;let a=e.state.doc.resolve(r);for(let r=a.depth+1;r>0;r--)if(e.someProp(t,t=>r>a.depth?t(e,n,a.nodeAfter,a.before(r),i,!0):t(e,n,a.node(r),a.before(r),i,!1)))return!0;return!1}function sl(e,t,n){if(e.focused||e.focus(),e.state.selection.eq(t))return;let r=e.state.tr.setSelection(t);n==`pointer`&&r.setMeta(`pointer`,!0),e.dispatch(r)}function cl(e,t){if(t==-1)return!1;let n=e.state.doc.resolve(t),r=n.nodeAfter;return r&&r.isAtom&&K.isSelectable(r)?(sl(e,new K(n),`pointer`),!0):!1}function ll(e,t){if(t==-1)return!1;let n=e.state.selection,r,i;n instanceof K&&(r=n.node);let a=e.state.doc.resolve(t);for(let e=a.depth+1;e>0;e--){let t=e>a.depth?a.nodeAfter:a.node(e);if(K.isSelectable(t)){i=r&&n.$from.depth>0&&e>=n.$from.depth&&a.before(n.$from.depth+1)==n.$from.pos?a.before(n.$from.depth):a.before(e);break}}return i==null?!1:(sl(e,K.create(e.state.doc,i),`pointer`),!0)}function ul(e,t,n,r,i){return ol(e,`handleClickOn`,t,n,r)||e.someProp(`handleClick`,n=>n(e,t,r))||(i?ll(e,n):cl(e,n))}function dl(e,t,n,r){return ol(e,`handleDoubleClickOn`,t,n,r)||e.someProp(`handleDoubleClick`,n=>n(e,t,r))}function fl(e,t,n,r){return ol(e,`handleTripleClickOn`,t,n,r)||e.someProp(`handleTripleClick`,n=>n(e,t,r))||pl(e,n,r)}function pl(e,t,n){if(n.button!=0)return!1;let r=e.state.doc;if(t==-1)return r.inlineContent?(sl(e,G.create(r,0,r.content.size),`pointer`),!0):!1;let i=r.resolve(t);for(let t=i.depth+1;t>0;t--){let n=t>i.depth?i.nodeAfter:i.node(t),a=i.before(t);if(n.inlineContent)sl(e,G.create(r,a+1,a+1+n.content.size),`pointer`);else if(K.isSelectable(n))sl(e,K.create(r,a),`pointer`);else continue;return!0}}function ml(e){return Cl(e)}var hl=Lo?`metaKey`:`ctrlKey`;X.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let r=ml(e),i=Date.now(),a=`singleClick`;i-e.input.lastClick.time<500&&al(n,e.input.lastClick)&&!n[hl]&&e.input.lastClick.button==n.button&&(e.input.lastClick.type==`singleClick`?a=`doubleClick`:e.input.lastClick.type==`doubleClick`&&(a=`tripleClick`)),e.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:a,button:n.button};let o=e.posAtCoords(il(n));o&&(a==`singleClick`?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new gl(e,o,n,!!r)):(a==`doubleClick`?dl:fl)(e,o.pos,o.inside,n)?n.preventDefault():Qc(e,`pointer`))};var gl=class{constructor(e,t,n,r){this.view=e,this.pos=t,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[hl],this.allowDefault=n.shiftKey;let i,a;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),a=t.inside;else{let n=e.state.doc.resolve(t.pos);i=n.parent,a=n.depth?n.before():0}let o=r?null:n.target,s=o?e.docView.nearestDesc(o,!0):null;this.target=s&&s.nodeDOM.nodeType==1?s.nodeDOM:null;let{selection:c}=e.state;(n.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof K&&c.from<=a&&c.to>a)&&(this.mightDrag={node:i,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&No&&!this.target.hasAttribute(`contentEditable`))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute(`contentEditable`,`false`)},20),this.view.domObserver.start()),e.root.addEventListener(`mouseup`,this.up=this.up.bind(this)),e.root.addEventListener(`mousemove`,this.move=this.move.bind(this)),Qc(e,`pointer`)}done(){this.view.root.removeEventListener(`mouseup`,this.up),this.view.root.removeEventListener(`mousemove`,this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute(`draggable`),this.mightDrag.setUneditable&&this.target.removeAttribute(`contentEditable`),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ec(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(il(e))),this.updateAllowDefault(e),this.allowDefault||!t?Qc(this.view,`pointer`):ul(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Y&&this.mightDrag&&!this.mightDrag.node.isAtom||J&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(sl(this.view,W.near(this.view.state.doc.resolve(t.pos)),`pointer`),e.preventDefault()):Qc(this.view,`pointer`)}move(e){this.updateAllowDefault(e),Qc(this.view,`pointer`),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}};X.touchstart=e=>{e.input.lastTouch=Date.now(),ml(e),Qc(e,`pointer`)},X.touchmove=e=>{e.input.lastTouch=Date.now(),Qc(e,`pointer`)},X.contextmenu=e=>ml(e);function _l(e,t){return e.composing?!0:Y&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500?(e.input.compositionEndedAt=-2e8,!0):!1}var vl=zo?5e3:-1;Z.compositionstart=Z.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$to;if(t.selection instanceof G&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(e=>e.type.spec.inclusive===!1)))e.markCursor=e.state.storedMarks||n.marks(),Cl(e,!0),e.markCursor=null;else if(Cl(e,!t.selection.empty),No&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,r=t.focusOffset;n&&n.nodeType==1&&r!=0;){let t=r<0?n.lastChild:n.childNodes[r-1];if(!t)break;if(t.nodeType==3){let n=e.domSelection();n&&n.collapse(t,t.nodeValue.length);break}else n=t,r=-1}}e.input.composing=!0}yl(e,vl)},Z.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then(()=>e.domObserver.flush()),e.input.compositionID++,yl(e,20))};function yl(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout(()=>Cl(e),t))}function bl(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=Sl());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function xl(e){let t=e.domSelectionRange();if(!t.focusNode)return null;let n=_o(t.focusNode,t.focusOffset),r=vo(t.focusNode,t.focusOffset);if(n&&r&&n!=r){let t=r.pmViewDesc,i=e.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!t||!t.isText(r.nodeValue))return r;if(e.input.compositionNode==r){let e=n.pmViewDesc;if(!(!e||!e.isText(n.nodeValue)))return r}}return n||r}function Sl(){let e=document.createEvent(`Event`);return e.initEvent(`event`,!0,!0),e.timeStamp}function Cl(e,t=!1){if(!(zo&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),bl(e),t||e.docView&&e.docView.dirty){let n=Qs(e),r=e.state.selection;return n&&!n.eq(r)?e.dispatch(e.state.tr.setSelection(n)):(e.markCursor||t)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?e.dispatch(e.state.tr.deleteSelection()):e.updateState(e.state),!0}return!1}}function wl(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement(`div`));n.appendChild(t),n.style.cssText=`position: fixed; left: -10000px; top: 10px`;let r=getSelection(),i=document.createRange();i.selectNodeContents(t),e.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()},50)}var Tl=jo&&Mo<15||Io&&Vo<604;X.copy=Z.cut=(e,t)=>{let n=t,r=e.state.selection,i=n.type==`cut`;if(r.empty)return;let a=Tl?null:n.clipboardData,o=r.content(),{dom:s,text:c}=Mc(e,o);a?(n.preventDefault(),a.clearData(),a.setData(`text/html`,s.innerHTML),a.setData(`text/plain`,c)):wl(e,s),i&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta(`uiEvent`,`cut`))};function El(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function Dl(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,r=e.dom.parentNode.appendChild(document.createElement(n?`textarea`:`div`));n||(r.contentEditable=`true`),r.style.cssText=`position: fixed; left: -10000px; top: 10px`,r.focus();let i=e.input.shiftKey&&e.input.lastKeyCode!=45;setTimeout(()=>{e.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Ol(e,r.value,null,i,t):Ol(e,r.textContent,r.innerHTML,i,t)},50)}function Ol(e,t,n,r,i){let a=Nc(e,t,n,r,e.state.selection.$from);if(e.someProp(`handlePaste`,t=>t(e,i,a||V.empty)))return!0;if(!a)return!1;let o=El(a),s=o?e.state.tr.replaceSelectionWith(o,r):e.state.tr.replaceSelection(a);return e.dispatch(s.scrollIntoView().setMeta(`paste`,!0).setMeta(`uiEvent`,`paste`)),!0}function kl(e){let t=e.getData(`text/plain`)||e.getData(`Text`);if(t)return t;let n=e.getData(`text/uri-list`);return n?n.replace(/\r?\n/g,` `):``}Z.paste=(e,t)=>{let n=t;if(e.composing&&!zo)return;let r=Tl?null:n.clipboardData,i=e.input.shiftKey&&e.input.lastKeyCode!=45;r&&Ol(e,kl(r),r.getData(`text/html`),i,n)?n.preventDefault():Dl(e,n)};var Al=class{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}},jl=Lo?`altKey`:`ctrlKey`;function Ml(e,t){return e.someProp(`dragCopies`,e=>!e(t))??!t[jl]}for(let e in X.dragstart=(e,t)=>{let n=t,r=e.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=e.state.selection,a=i.empty?null:e.posAtCoords(il(n)),o;if(!(a&&a.pos>=i.from&&a.pos<=(i instanceof K?i.to-1:i.to))){if(r&&r.mightDrag)o=K.create(e.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&(o=K.create(e.state.doc,t.posBefore))}}let s=(o||e.state.selection).content(),{dom:c,text:l,slice:u}=Mc(e,s);(!n.dataTransfer.files.length||!J||Fo>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Tl?`Text`:`text/html`,c.innerHTML),n.dataTransfer.effectAllowed=`copyMove`,Tl||n.dataTransfer.setData(`text/plain`,l),e.dragging=new Al(u,Ml(e,n),o)},X.dragend=e=>{let t=e.dragging;window.setTimeout(()=>{e.dragging==t&&(e.dragging=null)},50)},Z.dragover=Z.dragenter=(e,t)=>t.preventDefault(),Z.drop=(e,t)=>{let n=t,r=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let i=e.posAtCoords(il(n));if(!i)return;let a=e.state.doc.resolve(i.pos),o=r&&r.slice;o?e.someProp(`transformPasted`,t=>{o=t(o,e,!1)}):o=Nc(e,kl(n.dataTransfer),Tl?null:n.dataTransfer.getData(`text/html`),!1,a);let s=!!(r&&Ml(e,n));if(e.someProp(`handleDrop`,t=>t(e,n,o||V.empty,s))){n.preventDefault();return}if(!o)return;n.preventDefault();let c=o?va(e.state.doc,a.pos,o):a.pos;c??=a.pos;let l=e.state.tr;if(s){let{node:e}=r;e?e.replace(l):l.deleteSelection()}let u=l.mapping.map(c),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=l.doc;if(d?l.replaceRangeWith(u,u,o.content.firstChild):l.replaceRange(u,u,o),l.doc.eq(f))return;let p=l.doc.resolve(u);if(d&&K.isSelectable(o.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(o.content.firstChild))l.setSelection(new K(p));else{let t=l.mapping.map(c);l.mapping.maps[l.mapping.maps.length-1].forEach((e,n,r,i)=>t=i),l.setSelection(lc(e,p,l.doc.resolve(t)))}e.focus(),e.dispatch(l.setMeta(`uiEvent`,`drop`))},X.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add(`ProseMirror-focused`),e.domObserver.start(),e.focused=!0,setTimeout(()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&ec(e)},20))},X.blur=(e,t)=>{let n=t;e.focused&&=(e.domObserver.stop(),e.dom.classList.remove(`ProseMirror-focused`),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),!1)},X.beforeinput=(e,t)=>{if(J&&zo&&t.inputType==`deleteContentBackward`){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout(()=>{if(e.input.domChangeCount!=t||(e.dom.blur(),e.focus(),e.someProp(`handleKeyDown`,t=>t(e,So(8,`Backspace`)))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())},50)}},Z)X[e]=Z[e];function Nl(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}var Pl=class e{constructor(e,t){this.toDOM=e,this.spec=t||zl,this.side=this.spec.side||0}map(e,t,n,r){let{pos:i,deleted:a}=e.mapResult(t.from+r,this.side<0?-1:1);return a?null:new Ll(i-n,i-n,this)}valid(){return!0}eq(t){return this==t||t instanceof e&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Nl(this.spec,t.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}},Fl=class e{constructor(e,t){this.attrs=e,this.spec=t||zl}map(e,t,n,r){let i=e.map(t.from+r,this.spec.inclusiveStart?-1:1)-n,a=e.map(t.to+r,this.spec.inclusiveEnd?1:-1)-n;return i>=a?null:new Ll(i,a,this)}valid(e,t){return t.from<t.to}eq(t){return this==t||t instanceof e&&Nl(this.attrs,t.attrs)&&Nl(this.spec,t.spec)}static is(t){return t.type instanceof e}destroy(){}},Il=class e{constructor(e,t){this.attrs=e,this.spec=t||zl}map(e,t,n,r){let i=e.mapResult(t.from+r,1);if(i.deleted)return null;let a=e.mapResult(t.to+r,-1);return a.deleted||a.pos<=i.pos?null:new Ll(i.pos-n,a.pos-n,this)}valid(e,t){let{index:n,offset:r}=e.content.findIndex(t.from),i;return r==t.from&&!(i=e.child(n)).isText&&r+i.nodeSize==t.to}eq(t){return this==t||t instanceof e&&Nl(this.attrs,t.attrs)&&Nl(this.spec,t.spec)}destroy(){}},Ll=class e{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(t,n){return new e(t,n,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(t,n,r){return new e(t,t,new Pl(n,r))}static inline(t,n,r,i){return new e(t,n,new Fl(r,i))}static node(t,n,r,i){return new e(t,n,new Il(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Fl}get widget(){return this.type instanceof Pl}},Rl=[],zl={},Bl=class e{constructor(e,t){this.local=e.length?e:Rl,this.children=t.length?t:Rl}static create(e,t){return t.length?ql(t,e,0,zl):Q}find(e,t,n){let r=[];return this.findInner(e??0,t??1e9,r,0,n),r}findInner(e,t,n,r,i){for(let a=0;a<this.local.length;a++){let o=this.local[a];o.from<=t&&o.to>=e&&(!i||i(o.spec))&&n.push(o.copy(o.from+r,o.to+r))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<t&&this.children[a+1]>e){let o=this.children[a]+1;this.children[a+2].findInner(e-o,t-o,n,r+o,i)}}map(e,t,n){return this==Q||e.maps.length==0?this:this.mapInner(e,t,0,0,n||zl)}mapInner(t,n,r,i,a){let o;for(let e=0;e<this.local.length;e++){let s=this.local[e].map(t,r,i);s&&s.type.valid(n,s)?(o||=[]).push(s):a.onRemove&&a.onRemove(this.local[e].spec)}return this.children.length?Hl(this.children,o||[],t,n,r,i,a):o?new e(o.sort(Jl),Rl):Q}add(t,n){return n.length?this==Q?e.create(t,n):this.addInner(t,n,0):this}addInner(t,n,r){let i,a=0;t.forEach((e,t)=>{let o=t+r,s;if(s=Gl(n,e,o)){for(i||=this.children.slice();a<i.length&&i[a]<t;)a+=3;i[a]==t?i[a+2]=i[a+2].addInner(e,s,o+1):i.splice(a,0,t,t+e.nodeSize,ql(s,e,o+1,zl)),a+=3}});let o=Ul(a?Kl(n):n,-r);for(let e=0;e<o.length;e++)o[e].type.valid(t,o[e])||o.splice(e--,1);return new e(o.length?this.local.concat(o).sort(Jl):this.local,i||this.children)}remove(e){return e.length==0||this==Q?this:this.removeInner(e,0)}removeInner(t,n){let r=this.children,i=this.local;for(let e=0;e<r.length;e+=3){let i,a=r[e]+n,o=r[e+1]+n;for(let e=0,n;e<t.length;e++)(n=t[e])&&n.from>a&&n.to<o&&(t[e]=null,(i||=[]).push(n));if(!i)continue;r==this.children&&(r=this.children.slice());let s=r[e+2].removeInner(i,a+1);s==Q?(r.splice(e,3),e-=3):r[e+2]=s}if(i.length){for(let e=0,r;e<t.length;e++)if(r=t[e])for(let e=0;e<i.length;e++)i[e].eq(r,n)&&(i==this.local&&(i=this.local.slice()),i.splice(e--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new e(i,r):Q}forChild(t,n){if(this==Q)return this;if(n.isLeaf)return e.empty;let r,i;for(let e=0;e<this.children.length;e+=3)if(this.children[e]>=t){this.children[e]==t&&(r=this.children[e+2]);break}let a=t+1,o=a+n.content.size;for(let e=0;e<this.local.length;e++){let t=this.local[e];if(t.from<o&&t.to>a&&t.type instanceof Fl){let e=Math.max(a,t.from)-a,n=Math.min(o,t.to)-a;e<n&&(i||=[]).push(t.copy(e,n))}}if(i){let t=new e(i.sort(Jl),Rl);return r?new Vl([t,r]):t}return r||Q}eq(t){if(this==t)return!0;if(!(t instanceof e)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(e){return Yl(this.localsInner(e))}localsInner(e){if(this==Q)return Rl;if(e.inlineContent||!this.local.some(Fl.is))return this.local;let t=[];for(let e=0;e<this.local.length;e++)this.local[e].type instanceof Fl||t.push(this.local[e]);return t}forEachSet(e){e(this)}};Bl.empty=new Bl([],[]),Bl.removeOverlap=Yl;var Q=Bl.empty,Vl=class e{constructor(e){this.members=e}map(t,n){let r=this.members.map(e=>e.map(t,n,zl));return e.from(r)}forChild(t,n){if(n.isLeaf)return Bl.empty;let r=[];for(let i=0;i<this.members.length;i++){let a=this.members[i].forChild(t,n);a!=Q&&(a instanceof e?r=r.concat(a.members):r.push(a))}return e.from(r)}eq(t){if(!(t instanceof e)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(e){let t,n=!0;for(let r=0;r<this.members.length;r++){let i=this.members[r].localsInner(e);if(i.length)if(!t)t=i;else{n&&=(t=t.slice(),!1);for(let e=0;e<i.length;e++)t.push(i[e])}}return t?Yl(n?t:t.sort(Jl)):Rl}static from(t){switch(t.length){case 0:return Q;case 1:return t[0];default:return new e(t.every(e=>e instanceof Bl)?t:t.reduce((e,t)=>e.concat(t instanceof Bl?t:t.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}};function Hl(e,t,n,r,i,a,o){let s=e.slice();for(let e=0,t=a;e<n.maps.length;e++){let r=0;n.maps[e].forEach((e,n,i,a)=>{let o=a-i-(n-e);for(let i=0;i<s.length;i+=3){let a=s[i+1];if(a<0||e>a+t-r)continue;let c=s[i]+t-r;n>=c?s[i+1]=e<=c?-2:-1:e>=t&&o&&(s[i]+=o,s[i+1]+=o)}r+=o}),t=n.maps[e].map(t,-1)}let c=!1;for(let t=0;t<s.length;t+=3)if(s[t+1]<0){if(s[t+1]==-2){c=!0,s[t+1]=-1;continue}let l=n.map(e[t]+a),u=l-i;if(u<0||u>=r.content.size){c=!0;continue}let d=n.map(e[t+1]+a,-1)-i,{index:f,offset:p}=r.content.findIndex(u),m=r.maybeChild(f);if(m&&p==u&&p+m.nodeSize==d){let r=s[t+2].mapInner(n,m,l+1,e[t]+a+1,o);r==Q?(s[t+1]=-2,c=!0):(s[t]=u,s[t+1]=d,s[t+2]=r)}else c=!0}if(c){let c=Wl(s,e,t,n,i,a,o),l=ql(c,r,0,o);t=l.local;for(let e=0;e<s.length;e+=3)s[e+1]<0&&(s.splice(e,3),e-=3);for(let e=0,t=0;e<l.children.length;e+=3){let n=l.children[e];for(;t<s.length&&s[t]<n;)t+=3;s.splice(t,0,l.children[e],l.children[e+1],l.children[e+2])}}return new Bl(t.sort(Jl),s)}function Ul(e,t){if(!t||!e.length)return e;let n=[];for(let r=0;r<e.length;r++){let i=e[r];n.push(new Ll(i.from+t,i.to+t,i.type))}return n}function Wl(e,t,n,r,i,a,o){function s(e,t){for(let a=0;a<e.local.length;a++){let s=e.local[a].map(r,i,t);s?n.push(s):o.onRemove&&o.onRemove(e.local[a].spec)}for(let n=0;n<e.children.length;n+=3)s(e.children[n+2],e.children[n]+t+1)}for(let n=0;n<e.length;n+=3)e[n+1]==-1&&s(e[n+2],t[n]+a+1);return n}function Gl(e,t,n){if(t.isLeaf)return null;let r=n+t.nodeSize,i=null;for(let t=0,a;t<e.length;t++)(a=e[t])&&a.from>n&&a.to<r&&((i||=[]).push(a),e[t]=null);return i}function Kl(e){let t=[];for(let n=0;n<e.length;n++)e[n]!=null&&t.push(e[n]);return t}function ql(e,t,n,r){let i=[],a=!1;t.forEach((t,o)=>{let s=Gl(e,t,o+n);if(s){a=!0;let e=ql(s,t,n+o+1,r);e!=Q&&i.push(o,o+t.nodeSize,e)}});let o=Ul(a?Kl(e):e,-n).sort(Jl);for(let e=0;e<o.length;e++)o[e].type.valid(t,o[e])||(r.onRemove&&r.onRemove(o[e].spec),o.splice(e--,1));return o.length||i.length?new Bl(o,i):Q}function Jl(e,t){return e.from-t.from||e.to-t.to}function Yl(e){let t=e;for(let n=0;n<t.length-1;n++){let r=t[n];if(r.from!=r.to)for(let i=n+1;i<t.length;i++){let a=t[i];if(a.from==r.from){a.to!=r.to&&(t==e&&(t=e.slice()),t[i]=a.copy(a.from,r.to),Xl(t,i+1,a.copy(r.to,a.to)));continue}else{a.from<r.to&&(t==e&&(t=e.slice()),t[n]=r.copy(r.from,a.from),Xl(t,i,r.copy(a.from,r.to)));break}}}return t}function Xl(e,t,n){for(;t<e.length&&Jl(n,e[t])>0;)t++;e.splice(t,0,n)}function Zl(e){let t=[];return e.someProp(`decorations`,n=>{let r=n(e.state);r&&r!=Q&&t.push(r)}),e.cursorWrapper&&t.push(Bl.create(e.state.doc,[e.cursorWrapper.deco])),Vl.from(t)}var Ql={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},$l=jo&&Mo<=11,eu=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}},tu=class{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new eu,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);jo&&Mo<=11&&e.some(e=>e.type==`childList`&&e.removedNodes.length||e.type==`characterData`&&e.oldValue.length>e.target.nodeValue.length)?this.flushSoon():this.flush()}),$l&&(this.onCharData=e=>{this.queue.push({target:e.target,type:`characterData`,oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Ql)),this.onCharData&&this.view.dom.addEventListener(`DOMCharacterDataModified`,this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener(`DOMCharacterDataModified`,this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener(`selectionchange`,this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener(`selectionchange`,this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(uc(this.view)){if(this.suppressingSelectionUpdates)return ec(this.view);if(jo&&Mo<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&po(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,n;for(let n=e.focusNode;n;n=co(n))t.add(n);for(let r=e.anchorNode;r;r=co(r))if(t.has(r)){n=r;break}let r=n&&this.view.docView.nearestDesc(n);if(r&&r.ignoreMutation({type:`selection`,target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&uc(e)&&!this.ignoreSelectionChange(n),i=-1,a=-1,o=!1,s=[];if(e.editable)for(let e=0;e<t.length;e++){let n=this.registerMutation(t[e],s);n&&(i=i<0?n.from:Math.min(n.from,i),a=a<0?n.to:Math.max(n.to,a),n.typeOver&&(o=!0))}if(No&&s.length){let t=s.filter(e=>e.nodeName==`BR`);if(t.length==2){let[e,n]=t;e.parentNode&&e.parentNode.parentNode==n.parentNode?n.remove():e.remove()}else{let{focusNode:n}=this.currentSelection;for(let r of t){let t=r.parentNode;t&&t.nodeName==`LI`&&(!n||su(e,n)!=t)&&r.remove()}}}let c=null;i<0&&r&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&xo(n)&&(c=Qs(e))&&c.eq(W.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ec(e),this.currentSelection.set(n),e.scrollToSelection()):(i>-1||r)&&(i>-1&&(e.docView.markDirty(i,a),iu(e)),this.handleDOMChange(i,a,o,s),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||ec(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type==`attributes`&&(n==this.view.docView||e.attributeName==`contenteditable`||e.attributeName==`style`&&!e.oldValue&&!e.target.getAttribute(`style`))||!n||n.ignoreMutation(e))return null;if(e.type==`childList`){for(let n=0;n<e.addedNodes.length;n++){let r=e.addedNodes[n];t.push(r),r.nodeType==3&&(this.lastChangedTextNode=r)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let r=e.previousSibling,i=e.nextSibling;if(jo&&Mo<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:a}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(r=n),(!a||Array.prototype.indexOf.call(e.addedNodes,a)<0)&&(i=a)}let a=r&&r.parentNode==e.target?q(r)+1:0,o=n.localPosFromDOM(e.target,a,-1),s=i&&i.parentNode==e.target?q(i):e.target.childNodes.length,c=n.localPosFromDOM(e.target,s,1);return{from:o,to:c}}else if(e.type==`attributes`)return{from:n.posAtStart-n.border,to:n.posAtEnd+n.border};else return this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}},nu=new WeakMap,ru=!1;function iu(e){if(!nu.has(e)&&(nu.set(e,null),[`normal`,`nowrap`,`pre-line`].indexOf(getComputedStyle(e.dom).whiteSpace)!==-1)){if(e.requiresGeckoHackNode=No,ru)return;console.warn(`ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package.`),ru=!0}}function au(e,t){let n=t.startContainer,r=t.startOffset,i=t.endContainer,a=t.endOffset,o=e.domAtPos(e.state.selection.anchor);return po(o.node,o.offset,i,a)&&([n,r,i,a]=[i,a,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a}}function ou(e,t){if(t.getComposedRanges){let n=t.getComposedRanges(e.root)[0];if(n)return au(e,n)}let n;function r(e){e.preventDefault(),e.stopImmediatePropagation(),n=e.getTargetRanges()[0]}return e.dom.addEventListener(`beforeinput`,r,!0),document.execCommand(`indent`),e.dom.removeEventListener(`beforeinput`,r,!0),n?au(e,n):null}function su(e,t){for(let n=t.parentNode;n&&n!=e.dom;n=n.parentNode){let t=e.docView.nearestDesc(n,!0);if(t&&t.node.isBlock)return n}return null}function cu(e,t,n){let{node:r,fromOffset:i,toOffset:a,from:o,to:s}=e.docView.parseRange(t,n),c=e.domSelectionRange(),l,u=c.anchorNode;if(u&&e.dom.contains(u.nodeType==1?u:u.parentNode)&&(l=[{node:u,offset:c.anchorOffset}],xo(c)||l.push({node:c.focusNode,offset:c.focusOffset})),J&&e.input.lastKeyCode===8)for(let e=a;e>i;e--){let t=r.childNodes[e-1],n=t.pmViewDesc;if(t.nodeName==`BR`&&!n){a=e;break}if(!n||n.size)break}let d=e.state.doc,f=e.someProp(`domParser`)||di.fromSchema(e.state.schema),p=d.resolve(o),m=null,h=f.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:i,to:a,preserveWhitespace:p.parent.type.whitespace==`pre`?`full`:!0,findPositions:l,ruleFromNode:lu,context:p});if(l&&l[0].pos!=null){let e=l[0].pos,t=l[1]&&l[1].pos;t??=e,m={anchor:e+o,head:t+o}}return{doc:h,sel:m,from:o,to:s}}function lu(e){let t=e.pmViewDesc;if(t)return t.parseRule();if(e.nodeName==`BR`&&e.parentNode){if(Y&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement(`div`);return e.appendChild(document.createElement(`li`)),{skip:e}}else if(e.parentNode.lastChild==e||Y&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if(e.nodeName==`IMG`&&e.getAttribute(`mark-placeholder`))return{ignore:!0};return null}var uu=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function du(e,t,n,r,i){let a=e.input.compositionPendingChanges||(e.composing?e.input.compositionID:0);if(e.input.compositionPendingChanges=0,t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=Qs(e,t);if(n&&!e.state.selection.eq(n)){if(J&&zo&&e.input.lastKeyCode===13&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp(`handleKeyDown`,t=>t(e,So(13,`Enter`))))return;let r=e.state.tr.setSelection(n);t==`pointer`?r.setMeta(`pointer`,!0):t==`key`&&r.scrollIntoView(),a&&r.setMeta(`composition`,a),e.dispatch(r)}return}let o=e.state.doc.resolve(t),s=o.sharedDepth(n);t=o.before(s+1),n=e.state.doc.resolve(n).after(s+1);let c=e.state.selection,l=cu(e,t,n),u=e.state.doc,d=u.slice(l.from,l.to),f,p;e.input.lastKeyCode===8&&Date.now()-100<e.input.lastKeyCodeTime?(f=e.state.selection.to,p=`end`):(f=e.state.selection.from,p=`start`),e.input.lastKeyCode=null;let m=gu(d.content,l.doc.content,l.from,f,p);if(m&&e.input.domChangeCount++,(Io&&e.input.lastIOSEnter>Date.now()-225||zo)&&i.some(e=>e.nodeType==1&&!uu.test(e.nodeName))&&(!m||m.endA>=m.endB)&&e.someProp(`handleKeyDown`,t=>t(e,So(13,`Enter`)))){e.input.lastIOSEnter=0;return}if(!m)if(r&&c instanceof G&&!c.empty&&c.$head.sameParent(c.$anchor)&&!e.composing&&!(l.sel&&l.sel.anchor!=l.sel.head))m={start:c.from,endA:c.to,endB:c.to};else{if(l.sel){let t=fu(e,e.state.doc,l.sel);if(t&&!t.eq(e.state.selection)){let n=e.state.tr.setSelection(t);a&&n.setMeta(`composition`,a),e.dispatch(n)}}return}e.state.selection.from<e.state.selection.to&&m.start==m.endB&&e.state.selection instanceof G&&(m.start>e.state.selection.from&&m.start<=e.state.selection.from+2&&e.state.selection.from>=l.from?m.start=e.state.selection.from:m.endA<e.state.selection.to&&m.endA>=e.state.selection.to-2&&e.state.selection.to<=l.to&&(m.endB+=e.state.selection.to-m.endA,m.endA=e.state.selection.to)),jo&&Mo<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>l.from&&l.doc.textBetween(m.start-l.from-1,m.start-l.from+1)==` \xA0`&&(m.start--,m.endA--,m.endB--);let h=l.doc.resolveNoCache(m.start-l.from),g=l.doc.resolveNoCache(m.endB-l.from),_=u.resolve(m.start),v=h.sameParent(g)&&h.parent.inlineContent&&_.end()>=m.endA;if((Io&&e.input.lastIOSEnter>Date.now()-225&&(!v||i.some(e=>e.nodeName==`DIV`||e.nodeName==`P`))||!v&&h.pos<l.doc.content.size&&(!h.sameParent(g)||!h.parent.inlineContent)&&h.pos<g.pos&&!/\S/.test(l.doc.textBetween(h.pos,g.pos,``,``)))&&e.someProp(`handleKeyDown`,t=>t(e,So(13,`Enter`)))){e.input.lastIOSEnter=0;return}if(e.state.selection.anchor>m.start&&mu(u,m.start,m.endA,h,g)&&e.someProp(`handleKeyDown`,t=>t(e,So(8,`Backspace`)))){zo&&J&&e.domObserver.suppressSelectionUpdates();return}J&&m.endB==m.start&&(e.input.lastChromeDelete=Date.now()),zo&&!v&&h.start()!=g.start()&&g.parentOffset==0&&h.depth==g.depth&&l.sel&&l.sel.anchor==l.sel.head&&l.sel.head==m.endA&&(m.endB-=2,g=l.doc.resolveNoCache(m.endB-l.from),setTimeout(()=>{e.someProp(`handleKeyDown`,function(t){return t(e,So(13,`Enter`))})},20));let y=m.start,b=m.endA,x=t=>{let n=t||e.state.tr.replace(y,b,l.doc.slice(m.start-l.from,m.endB-l.from));if(l.sel){let t=fu(e,n.doc,l.sel);t&&!(J&&e.composing&&t.empty&&(m.start!=m.endB||e.input.lastChromeDelete<Date.now()-100)&&(t.head==y||t.head==n.mapping.map(b)-1)||jo&&t.empty&&t.head==y)&&n.setSelection(t)}return a&&n.setMeta(`composition`,a),n.scrollIntoView()},S;if(v)if(h.pos==g.pos){jo&&Mo<=11&&h.parentOffset==0&&(e.domObserver.suppressSelectionUpdates(),setTimeout(()=>ec(e),20));let t=x(e.state.tr.delete(y,b)),n=u.resolve(m.start).marksAcross(u.resolve(m.endA));n&&t.ensureMarks(n),e.dispatch(t)}else if(m.endA==m.endB&&(S=pu(h.parent.content.cut(h.parentOffset,g.parentOffset),_.parent.content.cut(_.parentOffset,m.endA-_.start())))){let t=x(e.state.tr);S.type==`add`?t.addMark(y,b,S.mark):t.removeMark(y,b,S.mark),e.dispatch(t)}else if(h.parent.child(h.index()).isText&&h.index()==g.index()-(g.textOffset?0:1)){let t=h.parent.textBetween(h.parentOffset,g.parentOffset),n=()=>x(e.state.tr.insertText(t,y,b));e.someProp(`handleTextInput`,r=>r(e,y,b,t,n))||e.dispatch(n())}else e.dispatch(x());else e.dispatch(x())}function fu(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:lc(e,t.resolve(n.anchor),t.resolve(n.head))}function pu(e,t){let n=e.firstChild.marks,r=t.firstChild.marks,i=n,a=r,o,s,c;for(let e=0;e<r.length;e++)i=r[e].removeFromSet(i);for(let e=0;e<n.length;e++)a=n[e].removeFromSet(a);if(i.length==1&&a.length==0)s=i[0],o=`add`,c=e=>e.mark(s.addToSet(e.marks));else if(i.length==0&&a.length==1)s=a[0],o=`remove`,c=e=>e.mark(s.removeFromSet(e.marks));else return null;let l=[];for(let e=0;e<t.childCount;e++)l.push(c(t.child(e)));if(z.from(l).eq(e))return{mark:s,type:o}}function mu(e,t,n,r,i){if(n-t<=i.pos-r.pos||hu(r,!0,!1)<i.pos)return!1;let a=e.resolve(t);if(!r.parent.isTextblock){let e=a.nodeAfter;return e!=null&&n==t+e.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let o=e.resolve(hu(a,!0,!0));return!o.parent.isTextblock||o.pos>n||hu(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function hu(e,t,n){let r=e.depth,i=t?e.end():e.pos;for(;r>0&&(t||e.indexAfter(r)==e.node(r).childCount);)r--,i++,t=!1;if(n){let t=e.node(r).maybeChild(e.indexAfter(r));for(;t&&!t.isLeaf;)t=t.firstChild,i++}return i}function gu(e,t,n,r,i){let a=e.findDiffStart(t,n);if(a==null)return null;let{a:o,b:s}=e.findDiffEnd(t,n+e.size,n+t.size);if(i==`end`){let e=Math.max(0,a-Math.min(o,s));r-=o+e-a}if(o<a&&e.size<t.size){let e=r<=a&&r>=o?a-r:0;a-=e,a&&a<t.size&&_u(t.textBetween(a-1,a+1))&&(a+=e?1:-1),s=a+(s-o),o=a}else if(s<a){let t=r<=a&&r>=s?a-r:0;a-=t,a&&a<e.size&&_u(e.textBetween(a-1,a+1))&&(a+=t?1:-1),o=a+(o-s),s=a}return{start:a,endA:o,endB:s}}function _u(e){if(e.length!=2)return!1;let t=e.charCodeAt(0),n=e.charCodeAt(1);return t>=56320&&t<=57343&&n>=55296&&n<=56319}var vu=class{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Xc,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(Tu),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement(`div`),e&&(e.appendChild?e.appendChild(this.dom):typeof e==`function`?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=xu(this),bu(this),this.nodeViews=Cu(this),this.docView=Ms(this.state.doc,yu(this),Zl(this),this.dom,this),this.domObserver=new tu(this,(e,t,n,r)=>du(this,e,t,n,r)),this.domObserver.start(),Zc(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;for(let t in this._props={},e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&el(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Tu),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let e in this._props)t[e]=this._props[e];for(let n in t.state=this.state,e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){let n=this.state,r=!1,i=!1;e.storedMarks&&this.composing&&(bl(this),i=!0),this.state=e;let a=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=Cu(this);wu(e,this.nodeViews)&&(this.nodeViews=e,r=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&el(this),this.editable=xu(this),bu(this);let o=Zl(this),s=yu(this),c=n.plugins!=e.plugins&&!n.doc.eq(e.doc)?`reset`:e.scrollToSelection>n.scrollToSelection?`to selection`:`preserve`,l=r||!this.docView.matchesNode(e.doc,s,o);(l||!e.selection.eq(n.selection))&&(i=!0);let u=c==`preserve`&&i&&this.dom.style.overflowAnchor==null&&Ko(this);if(i){this.domObserver.stop();let t=l&&(jo||J)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&Su(n.selection,e.selection);if(l){let n=J?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=xl(this)),(r||!this.docView.update(e.doc,s,o,this))&&(this.docView.updateOuterDeco(s),this.docView.destroy(),this.docView=Ms(e.doc,s,o,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&fc(this))?ec(this,t):(sc(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),this.dragging?.node&&!n.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,n),c==`reset`?this.dom.scrollTop=0:c==`to selection`?this.scrollToSelection():u&&Jo(u)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))&&!this.someProp(`handleScrollToSelection`,e=>e(this)))if(this.state.selection instanceof K){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Go(this,t.getBoundingClientRect(),e)}else Go(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}}updateDraggedNode(e,t){let n=e.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{let e=n.from+(this.state.doc.content.size-t.doc.content.size);(e>0&&this.state.doc.nodeAt(e))==n.node&&(r=e)}this.dragging=new Al(e.slice,e.move,r<0?void 0:K.create(this.state.doc,r))}someProp(e,t){let n=this._props&&this._props[e],r;if(n!=null&&(r=t?t(n):n))return r;for(let n=0;n<this.directPlugins.length;n++){let i=this.directPlugins[n].props[e];if(i!=null&&(r=t?t(i):i))return r}let i=this.state.plugins;if(i)for(let n=0;n<i.length;n++){let a=i[n].props[e];if(a!=null&&(r=t?t(a):a))return r}}hasFocus(){if(jo){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable==`false`)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Zo(this.dom),ec(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return e||document}updateRoot(){this._root=null}posAtCoords(e){return cs(this,e)}coordsAtPos(e,t=1){return fs(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let r=this.docView.posFromDOM(e,t,n);if(r==null)throw RangeError(`DOM position not inside the editor`);return r}endOfTextblock(e,t){return Ss(this,t||this.state,e)}pasteHTML(e,t){return Ol(this,``,e,!1,t||new ClipboardEvent(`paste`))}pasteText(e,t){return Ol(this,e,null,!0,t||new ClipboardEvent(`paste`))}serializeForClipboard(e){return Mc(this,e)}destroy(){this.docView&&($c(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Zl(this),this),this.dom.textContent=``):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,fo())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return rl(this,e)}domSelectionRange(){let e=this.domSelection();return e?Y&&this.root.nodeType===11&&Co(this.dom.ownerDocument)==this.dom&&ou(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}};vu.prototype.dispatch=function(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))};function yu(e){let t=Object.create(null);return t.class=`ProseMirror`,t.contenteditable=String(e.editable),e.someProp(`attributes`,n=>{if(typeof n==`function`&&(n=n(e.state)),n)for(let e in n)e==`class`?t.class+=` `+n[e]:e==`style`?t.style=(t.style?t.style+`;`:``)+n[e]:!t[e]&&e!=`contenteditable`&&e!=`nodeName`&&(t[e]=String(n[e]))}),t.translate||=`no`,[Ll.node(0,e.state.doc.content.size,t)]}function bu(e){if(e.markCursor){let t=document.createElement(`img`);t.className=`ProseMirror-separator`,t.setAttribute(`mark-placeholder`,`true`),t.setAttribute(`alt`,``),e.cursorWrapper={dom:t,deco:Ll.widget(e.state.selection.from,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function xu(e){return!e.someProp(`editable`,t=>t(e.state)===!1)}function Su(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}function Cu(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp(`nodeViews`,n),e.someProp(`markViews`,n),t}function wu(e,t){let n=0,r=0;for(let r in e){if(e[r]!=t[r])return!0;n++}for(let e in t)r++;return n!=r}function Tu(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw RangeError(`Plugins passed directly to the view must not have a state component`)}for(var Eu={8:`Backspace`,9:`Tab`,10:`Enter`,12:`NumLock`,13:`Enter`,16:`Shift`,17:`Control`,18:`Alt`,20:`CapsLock`,27:`Escape`,32:` `,33:`PageUp`,34:`PageDown`,35:`End`,36:`Home`,37:`ArrowLeft`,38:`ArrowUp`,39:`ArrowRight`,40:`ArrowDown`,44:`PrintScreen`,45:`Insert`,46:`Delete`,59:`;`,61:`=`,91:`Meta`,92:`Meta`,106:`*`,107:`+`,108:`,`,109:`-`,110:`.`,111:`/`,144:`NumLock`,145:`ScrollLock`,160:`Shift`,161:`Shift`,162:`Control`,163:`Control`,164:`Alt`,165:`Alt`,173:`-`,186:`;`,187:`=`,188:`,`,189:`-`,190:`.`,191:`/`,192:"`",219:`[`,220:`\\`,221:`]`,222:`'`},Du={48:`)`,49:`!`,50:`@`,51:`#`,52:`$`,53:`%`,54:`^`,55:`&`,56:`*`,57:`(`,59:`:`,61:`+`,173:`_`,186:`:`,187:`+`,188:`<`,189:`_`,190:`>`,191:`?`,192:`~`,219:`{`,220:`|`,221:`}`,222:`"`},Ou=typeof navigator<`u`&&/Mac/.test(navigator.platform),ku=typeof navigator<`u`&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Au=0;Au<10;Au++)Eu[48+Au]=Eu[96+Au]=String(Au);for(var Au=1;Au<=24;Au++)Eu[Au+111]=`F`+Au;for(var Au=65;Au<=90;Au++)Eu[Au]=String.fromCharCode(Au+32),Du[Au]=String.fromCharCode(Au);for(var ju in Eu)Du.hasOwnProperty(ju)||(Du[ju]=Eu[ju]);function Mu(e){var t=!(Ou&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||ku&&e.shiftKey&&e.key&&e.key.length==1||e.key==`Unidentified`)&&e.key||(e.shiftKey?Du:Eu)[e.keyCode]||e.key||`Unidentified`;return t==`Esc`&&(t=`Escape`),t==`Del`&&(t=`Delete`),t==`Left`&&(t=`ArrowLeft`),t==`Up`&&(t=`ArrowUp`),t==`Right`&&(t=`ArrowRight`),t==`Down`&&(t=`ArrowDown`),t}var Nu=typeof navigator<`u`&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Pu=typeof navigator<`u`&&/Win/.test(navigator.platform);function Fu(e){let t=e.split(/-(?!$)/),n=t[t.length-1];n==`Space`&&(n=` `);let r,i,a,o;for(let e=0;e<t.length-1;e++){let n=t[e];if(/^(cmd|meta|m)$/i.test(n))o=!0;else if(/^a(lt)?$/i.test(n))r=!0;else if(/^(c|ctrl|control)$/i.test(n))i=!0;else if(/^s(hift)?$/i.test(n))a=!0;else if(/^mod$/i.test(n))Nu?o=!0:i=!0;else throw Error(`Unrecognized modifier name: `+n)}return r&&(n=`Alt-`+n),i&&(n=`Ctrl-`+n),o&&(n=`Meta-`+n),a&&(n=`Shift-`+n),n}function Iu(e){let t=Object.create(null);for(let n in e)t[Fu(n)]=e[n];return t}function Lu(e,t,n=!0){return t.altKey&&(e=`Alt-`+e),t.ctrlKey&&(e=`Ctrl-`+e),t.metaKey&&(e=`Meta-`+e),n&&t.shiftKey&&(e=`Shift-`+e),e}function Ru(e){return new io({props:{handleKeyDown:zu(e)}})}function zu(e){let t=Iu(e);return function(e,n){let r=Mu(n),i,a=t[Lu(r,n)];if(a&&a(e.state,e.dispatch,e))return!0;if(r.length==1&&r!=` `){if(n.shiftKey){let i=t[Lu(r,n,!1)];if(i&&i(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Pu&&n.ctrlKey&&n.altKey)&&(i=Eu[n.keyCode])&&i!=r){let r=t[Lu(i,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}var Bu=(e,t)=>e.selection.empty?!1:(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function Vu(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock(`backward`,e):n.parentOffset>0)?null:n}var Hu=(e,t,n)=>{let r=Vu(e,n);if(!r)return!1;let i=Gu(r);if(!i){let n=r.blockRange(),i=n&&ra(n);return i==null?!1:(t&&t(e.tr.lift(n,i).scrollIntoView()),!0)}let a=i.nodeBefore;if(ad(e,i,t,-1))return!0;if(r.parent.content.size==0&&(Uu(a,`end`)||K.isSelectable(a)))for(let n=r.depth;;n--){let o=ya(e.doc,r.before(n),r.after(n),V.empty);if(o&&o.slice.size<o.to-o.from){if(t){let n=e.tr.step(o);n.setSelection(Uu(a,`end`)?W.findFrom(n.doc.resolve(n.mapping.map(i.pos,-1)),-1):K.create(n.doc,i.pos-a.nodeSize)),t(n.scrollIntoView())}return!0}if(n==1||r.node(n-1).childCount>1)break}return a.isAtom&&i.depth==r.depth-1?(t&&t(e.tr.delete(i.pos-a.nodeSize,i.pos).scrollIntoView()),!0):!1};function Uu(e,t,n=!1){for(let r=e;r;r=t==`start`?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}var Wu=(e,t,n)=>{let{$head:r,empty:i}=e.selection,a=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock(`backward`,e):r.parentOffset>0)return!1;a=Gu(r)}let o=a&&a.nodeBefore;return!o||!K.isSelectable(o)?!1:(t&&t(e.tr.setSelection(K.create(e.doc,a.pos-o.nodeSize)).scrollIntoView()),!0)};function Gu(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function Ku(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock(`forward`,e):n.parentOffset<n.parent.content.size)?null:n}var qu=(e,t,n)=>{let r=Ku(e,n);if(!r)return!1;let i=Yu(r);if(!i)return!1;let a=i.nodeAfter;if(ad(e,i,t,1))return!0;if(r.parent.content.size==0&&(Uu(a,`start`)||K.isSelectable(a))){let n=ya(e.doc,r.before(),r.after(),V.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(Uu(a,`start`)?W.findFrom(r.doc.resolve(r.mapping.map(i.pos)),1):K.create(r.doc,r.mapping.map(i.pos))),t(r.scrollIntoView())}return!0}}return a.isAtom&&i.depth==r.depth-1?(t&&t(e.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1},Ju=(e,t,n)=>{let{$head:r,empty:i}=e.selection,a=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock(`forward`,e):r.parentOffset<r.parent.content.size)return!1;a=Yu(r)}let o=a&&a.nodeAfter;return!o||!K.isSelectable(o)?!1:(t&&t(e.tr.setSelection(K.create(e.doc,a.pos)).scrollIntoView()),!0)};function Yu(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}var Xu=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(t&&t(e.tr.insertText(`
`).scrollIntoView()),!0)};function Zu(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}var Qu=(e,t)=>{let{$head:n,$anchor:r}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),a=n.indexAfter(-1),o=Zu(i.contentMatchAt(a));if(!o||!i.canReplaceWith(a,a,o))return!1;if(t){let r=n.after(),i=e.tr.replaceWith(r,r,o.createAndFill());i.setSelection(W.near(i.doc.resolve(r),1)),t(i.scrollIntoView())}return!0},$u=(e,t)=>{let n=e.selection,{$from:r,$to:i}=n;if(n instanceof Wa||r.parent.inlineContent||i.parent.inlineContent)return!1;let a=Zu(i.parent.contentMatchAt(i.indexAfter()));if(!a||!a.isTextblock)return!1;if(t){let n=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,o=e.tr.insert(n,a.createAndFill());o.setSelection(G.create(o.doc,n+1)),t(o.scrollIntoView())}return!0},ed=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if(da(e.doc,r))return t&&t(e.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),i=r&&ra(r);return i==null?!1:(t&&t(e.tr.lift(r,i).scrollIntoView()),!0)};function td(e){return(t,n)=>{let{$from:r,$to:i}=t.selection;if(t.selection instanceof K&&t.selection.node.isBlock)return!r.parentOffset||!da(t.doc,r.pos)?!1:(n&&n(t.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let a=[],o,s,c=!1,l=!1;for(let t=r.depth;;t--)if(r.node(t).isBlock){c=r.end(t)==r.pos+(r.depth-t),l=r.start(t)==r.pos-(r.depth-t),s=Zu(r.node(t-1).contentMatchAt(r.indexAfter(t-1)));let n=e&&e(i.parent,c,r);a.unshift(n||(c&&s?{type:s}:null)),o=t;break}else{if(t==1)return!1;a.unshift(null)}let u=t.tr;(t.selection instanceof G||t.selection instanceof Wa)&&u.deleteSelection();let d=u.mapping.map(r.pos),f=da(u.doc,d,a.length,a);if(f||=(a[0]=s?{type:s}:null,da(u.doc,d,a.length,a)),!f)return!1;if(u.split(d,a.length,a),!c&&l&&r.node(o).type!=s){let e=u.mapping.map(r.before(o)),t=u.doc.resolve(e);s&&r.node(o-1).canReplaceWith(t.index(),t.index()+1,s)&&u.setNodeMarkup(u.mapping.map(r.before(o)),s)}return n&&n(u.scrollIntoView()),!0}}var nd=td(),rd=(e,t)=>(t&&t(e.tr.setSelection(new Wa(e.doc))),!0);function id(e,t,n){let r=t.nodeBefore,i=t.nodeAfter,a=t.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&t.parent.canReplace(a-1,a)?(n&&n(e.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(a,a+1)||!(i.isTextblock||pa(e.doc,t.pos))?!1:(n&&n(e.tr.join(t.pos).scrollIntoView()),!0)}function ad(e,t,n,r){let i=t.nodeBefore,a=t.nodeAfter,o,s,c=i.type.spec.isolating||a.type.spec.isolating;if(!c&&id(e,t,n))return!0;let l=!c&&t.parent.canReplace(t.index(),t.index()+1);if(l&&(o=(s=i.contentMatchAt(i.childCount)).findWrapping(a.type))&&s.matchType(o[0]||a.type).validEnd){if(n){let r=t.pos+a.nodeSize,s=z.empty;for(let e=o.length-1;e>=0;e--)s=z.from(o[e].create(null,s));s=z.from(i.copy(s));let c=e.tr.step(new Zi(t.pos-1,r,t.pos,r,new V(s,1,0),o.length,!0)),l=c.doc.resolve(r+2*o.length);l.nodeAfter&&l.nodeAfter.type==i.type&&pa(c.doc,l.pos)&&c.join(l.pos),n(c.scrollIntoView())}return!0}let u=a.type.spec.isolating||r>0&&c?null:W.findFrom(t,1),d=u&&u.$from.blockRange(u.$to),f=d&&ra(d);if(f!=null&&f>=t.depth)return n&&n(e.tr.lift(d,f).scrollIntoView()),!0;if(l&&Uu(a,`start`,!0)&&Uu(i,`end`)){let r=i,o=[];for(;o.push(r),!r.isTextblock;)r=r.lastChild;let s=a,c=1;for(;!s.isTextblock;s=s.firstChild)c++;if(r.canReplace(r.childCount,r.childCount,s.content)){if(n){let r=z.empty;for(let e=o.length-1;e>=0;e--)r=z.from(o[e].copy(r));let i=e.tr.step(new Zi(t.pos-o.length,t.pos+a.nodeSize,t.pos+c,t.pos+a.nodeSize-c,new V(r,o.length,0),0,!0));n(i.scrollIntoView())}return!0}}return!1}function od(e){return function(t,n){let r=t.selection,i=e<0?r.$from:r.$to,a=i.depth;for(;i.node(a).isInline;){if(!a)return!1;a--}return i.node(a).isTextblock?(n&&n(t.tr.setSelection(G.create(t.doc,e<0?i.start(a):i.end(a)))),!0):!1}}var sd=od(-1),cd=od(1);function ld(...e){return function(t,n,r){for(let i=0;i<e.length;i++)if(e[i](t,n,r))return!0;return!1}}var ud=ld(Bu,Hu,Wu),dd=ld(Bu,qu,Ju),fd={Enter:ld(Xu,$u,ed,nd),"Mod-Enter":Qu,Backspace:ud,"Mod-Backspace":ud,"Shift-Backspace":ud,Delete:dd,"Mod-Delete":dd,"Mod-a":rd},pd={"Ctrl-h":fd.Backspace,"Alt-Backspace":fd[`Mod-Backspace`],"Ctrl-d":fd.Delete,"Ctrl-Alt-Backspace":fd[`Mod-Delete`],"Alt-Delete":fd[`Mod-Delete`],"Alt-d":fd[`Mod-Delete`],"Ctrl-a":sd,"Ctrl-e":cd};for(let e in fd)pd[e]=fd[e];var md=(typeof navigator<`u`?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<`u`&&os.platform&&os.platform()==`darwin`)?pd:fd,hd=200,$=function(){};$.prototype.append=function(e){return e.length?(e=$.from(e),!this.length&&e||e.length<hd&&this.leafAppend(e)||this.length<hd&&e.leafPrepend(this)||this.appendInner(e)):this},$.prototype.prepend=function(e){return e.length?$.from(e).append(this):this},$.prototype.appendInner=function(e){return new _d(this,e)},$.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?$.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},$.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},$.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},$.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var r=[];return this.forEach(function(t,n){return r.push(e(t,n))},t,n),r},$.from=function(e){return e instanceof $?e:e&&e.length?new gd(e):$.empty};var gd=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return e==0&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,r){for(var i=t;i<n;i++)if(e(this.values[i],r+i)===!1)return!1},t.prototype.forEachInvertedInner=function(e,t,n,r){for(var i=t-1;i>=n;i--)if(e(this.values[i],r+i)===!1)return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=hd)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=hd)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}($);$.empty=new gd([]);var _d=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,r){var i=this.left.length;if(t<i&&this.left.forEachInner(e,t,Math.min(n,i),r)===!1||n>i&&this.right.forEachInner(e,Math.max(t-i,0),Math.min(this.length,n)-i,r+i)===!1)return!1},t.prototype.forEachInvertedInner=function(e,t,n,r){var i=this.left.length;if(t>i&&this.right.forEachInvertedInner(e,t-i,Math.max(n,i)-i,r+i)===!1||n<i&&this.left.forEachInvertedInner(e,Math.min(t,i),n,r)===!1)return!1},t.prototype.sliceInner=function(e,t){if(e==0&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}($),vd=$,yd=500,bd=class e{constructor(e,t){this.items=e,this.eventCount=t}popEvent(t,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,a;n&&(i=this.remapping(r,this.items.length),a=i.maps.length);let o=t.tr,s,c,l=[],u=[];return this.items.forEach((t,n)=>{if(!t.step){i||(i=this.remapping(r,n+1),a=i.maps.length),a--,u.push(t);return}if(i){u.push(new Sd(t.map));let e=t.step.map(i.slice(a)),n;e&&o.maybeStep(e).doc&&(n=o.mapping.maps[o.mapping.maps.length-1],l.push(new Sd(n,void 0,void 0,l.length+u.length))),a--,n&&i.appendMap(n,a)}else o.maybeStep(t.step);if(t.selection)return s=i?t.selection.map(i.slice(a)):t.selection,c=new e(this.items.slice(0,r).append(u.reverse().concat(l)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:o,selection:s}}addTransform(t,n,r,i){let a=[],o=this.eventCount,s=this.items,c=!i&&s.length?s.get(s.length-1):null;for(let e=0;e<t.steps.length;e++){let r=t.steps[e].invert(t.docs[e]),l=new Sd(t.mapping.maps[e],r,n),u;(u=c&&c.merge(l))&&(l=u,e?a.pop():s=s.slice(0,s.length-1)),a.push(l),n&&=(o++,void 0),i||(c=l)}let l=o-r.depth;return l>wd&&(s=xd(s,l),o-=l),new e(s.append(a),o)}remapping(e,t){let n=new Ui;return this.items.forEach((t,r)=>{let i=t.mirrorOffset!=null&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,i)},e,t),n}addMaps(t){return this.eventCount==0?this:new e(this.items.append(t.map(e=>new Sd(e))),this.eventCount)}rebased(t,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),a=t.mapping,o=t.steps.length,s=this.eventCount;this.items.forEach(e=>{e.selection&&s--},i);let c=n;this.items.forEach(e=>{let n=a.getMirror(--c);if(n==null)return;o=Math.min(o,n);let i=a.maps[n];if(e.step){let o=t.steps[n].invert(t.docs[n]),l=e.selection&&e.selection.map(a.slice(c+1,n));l&&s++,r.push(new Sd(i,o,l))}else r.push(new Sd(i))},i);let l=[];for(let e=n;e<o;e++)l.push(new Sd(a.maps[e]));let u=this.items.slice(0,i).append(l).append(r),d=new e(u,s);return d.emptyItemCount()>yd&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(t=this.items.length){let n=this.remapping(0,t),r=n.maps.length,i=[],a=0;return this.items.forEach((e,o)=>{if(o>=t)i.push(e),e.selection&&a++;else if(e.step){let t=e.step.map(n.slice(r)),o=t&&t.getMap();if(r--,o&&n.appendMap(o,r),t){let s=e.selection&&e.selection.map(n.slice(r));s&&a++;let c=new Sd(o.invert(),t,s),l,u=i.length-1;(l=i.length&&i[u].merge(c))?i[u]=l:i.push(c)}}else e.map&&r--},this.items.length,0),new e(vd.from(i.reverse()),a)}};bd.empty=new bd(vd.empty,0);function xd(e,t){let n;return e.forEach((e,r)=>{if(e.selection&&t--==0)return n=r,!1}),e.slice(n)}var Sd=class e{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(t){if(this.step&&t.step&&!t.selection){let n=t.step.merge(this.step);if(n)return new e(n.getMap().invert(),n,this.selection)}}},Cd=class{constructor(e,t,n,r,i){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r,this.prevComposition=i}},wd=20;function Td(e,t,n,r){let i=n.getMeta(Nd),a;if(i)return i.historyState;n.getMeta(Pd)&&(e=new Cd(e.done,e.undone,null,0,-1));let o=n.getMeta(`appendedTransaction`);if(n.steps.length==0)return e;if(o&&o.getMeta(Nd))return o.getMeta(Nd).redo?new Cd(e.done.addTransform(n,void 0,r,Md(t)),e.undone,Dd(n.mapping.maps),e.prevTime,e.prevComposition):new Cd(e.done,e.undone.addTransform(n,void 0,r,Md(t)),null,e.prevTime,e.prevComposition);if(n.getMeta(`addToHistory`)!==!1&&!(o&&o.getMeta(`addToHistory`)===!1)){let i=n.getMeta(`composition`),a=e.prevTime==0||!o&&e.prevComposition!=i&&(e.prevTime<(n.time||0)-r.newGroupDelay||!Ed(n,e.prevRanges)),s=o?Od(e.prevRanges,n.mapping):Dd(n.mapping.maps);return new Cd(e.done.addTransform(n,a?t.selection.getBookmark():void 0,r,Md(t)),bd.empty,s,n.time,i??e.prevComposition)}else if(a=n.getMeta(`rebased`))return new Cd(e.done.rebased(n,a),e.undone.rebased(n,a),Od(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);else return new Cd(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),Od(e.prevRanges,n.mapping),e.prevTime,e.prevComposition)}function Ed(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((e,r)=>{for(let i=0;i<t.length;i+=2)e<=t[i+1]&&r>=t[i]&&(n=!0)}),n}function Dd(e){let t=[];for(let n=e.length-1;n>=0&&t.length==0;n--)e[n].forEach((e,n,r,i)=>t.push(r,i));return t}function Od(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let i=t.map(e[r],1),a=t.map(e[r+1],-1);i<=a&&n.push(i,a)}return n}function kd(e,t,n){let r=Md(t),i=Nd.get(t).spec.config,a=(n?e.undone:e.done).popEvent(t,r);if(!a)return null;let o=a.selection.resolve(a.transform.doc),s=(n?e.done:e.undone).addTransform(a.transform,t.selection.getBookmark(),i,r),c=new Cd(n?s:a.remaining,n?a.remaining:s,null,0,-1);return a.transform.setSelection(o).setMeta(Nd,{redo:n,historyState:c})}var Ad=!1,jd=null;function Md(e){let t=e.plugins;if(jd!=t){Ad=!1,jd=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){Ad=!0;break}}return Ad}var Nd=new so(`history`),Pd=new so(`closeHistory`);function Fd(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new io({key:Nd,state:{init(){return new Cd(bd.empty,bd.empty,null,0,-1)},apply(t,n,r){return Td(n,r,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r=n==`historyUndo`?Ld:n==`historyRedo`?Rd:null;return r?(t.preventDefault(),r(e.state,e.dispatch)):!1}}}})}function Id(e,t){return(n,r)=>{let i=Nd.getState(n);if(!i||(e?i.undone:i.done).eventCount==0)return!1;if(r){let a=kd(i,n,e);a&&r(t?a.scrollIntoView():a)}return!0}}var Ld=Id(!1,!0),Rd=Id(!0,!0);function zd(){return new si({nodes:{doc:{content:`text*`},text:{inline:!0}},marks:{variable:{attrs:{reference:{default:``}},parseDOM:[{tag:`span.variable-token`,getAttrs(e){return{reference:e.getAttribute(`data-reference`)||``}}}],toDOM(){return[`span`,{class:`variable-token`,style:`color: #10b981; background-color: #ecfdf5; padding: 0 2px; border-radius: 2px;`}]}}}})}function Bd(e){let t=[],n=/\{\{\s*[^{}]+?\s*\}\}/g;return e.nodesBetween(0,e.content.size,(e,r)=>{if(e.isText){let i=e.text||``,a;for(n.lastIndex=0;(a=n.exec(i))!==null;){let e=r+a.index,n=e+a[0].length;t.push(Ll.inline(e,n,{class:`variable-token`}))}}}),t}function Vd(){let e=new so(`variableHighlight`);return new io({key:e,state:{init(e){let t=Bd(e.doc);return Bl.create(e.doc,t)},apply(e,t,n,r){let i=Bd(r.doc);return Bl.create(r.doc,i)}},props:{decorations(e){return this.getState(e)}}})}function Hd(){let e=/\{\{\s*[^{}]+?\s*\}\}/g;return new io({key:new so(`variableDeletion`),props:{handleKeyDown(t,n){if(n.key===`Backspace`||n.key===`Delete`){let{state:r,dispatch:i}=t,{$from:a,$to:o}=r.selection;if(a.pos!==o.pos)return!1;let s=r.doc.textContent,c=a.pos-1;if(n.key===`Backspace`){let t=s.slice(0,c+1),n,a=null;for(e.lastIndex=0;(n=e.exec(t))!==null;)a=n;if(a&&a.index+a[0].length===t.length){let e=a.index+1,t=e+a[0].length;return i(r.tr.delete(e,t)),!0}}else if(n.key===`Delete`){let t=s.slice(c+1).match(e);if(t&&t.index===0){let e=c+1,n=e+t[0].length;return i(r.tr.delete(e,n)),!0}}}return!1}}})}function Ud(e,t=``){let n=e.nodeFromJSON({type:`doc`,content:t?[{type:`text`,text:t}]:[]});return no.create({doc:n,plugins:[Fd(),Vd(),Hd(),Ru({"Mod-z":Ld,"Mod-y":Rd,"Mod-Shift-z":Rd,...md})]})}function Wd(e){let t=``;return e.doc.forEach(e=>{e.isText&&(t+=e.text)}),t}function Gd(e,t,n){let r=t.nodeFromJSON({type:`doc`,content:n?[{type:`text`,text:n}]:[]});return e.apply(e.tr.replaceWith(0,e.doc.content.size,r.content))}var Kd=v({__name:`VariableEditor`,props:{modelValue:{default:``},placeholder:{default:``},multiline:{type:Boolean,default:!1},density:{default:`default`},readonly:{type:Boolean,default:!1}},emits:[`update:modelValue`,`focus`,`blur`,`variable-drop`],setup(e,{expose:t,emit:n}){let r=e,i=n,a=C(null),o=C(!1),s=null,l=zd(),u=!1;function d(){if(!a.value)return;let e=Ud(l,r.modelValue);s=new vu(a.value,{state:e,dispatchTransaction(e){if(!s)return;let t=s.state.apply(e);if(s.updateState(t),!u){let e=Wd(t);i(`update:modelValue`,e)}},attributes:{class:`ProseMirror variable-scroll-x`,style:`
        outline: none;
        border: none;
        padding: ${r.density===`compact`?`0.25rem 0.5rem`:`0.5rem`};
        font-family: 'Fira Code', 'Courier New', 'Microsoft YaHei', 'SimHei', monospace;
        font-size: ${r.density===`compact`?`0.75rem`:`0.875rem`};
        line-height: 1.5;
        min-height: ${r.multiline?r.density===`compact`?`3rem`:`4rem`:`auto`};
        max-height: ${r.multiline?`15rem`:`auto`};
        overflow-y: ${r.multiline?`auto`:`hidden`};
        white-space: ${r.multiline?`pre-wrap`:`nowrap`};
        word-wrap: break-word;
      `},editable:()=>!r.readonly}),s.dom.addEventListener(`focus`,p),s.dom.addEventListener(`blur`,m),s.dom.addEventListener(`variable-drop`,h)}function f(){s&&=(s.dom.removeEventListener(`focus`,p),s.dom.removeEventListener(`blur`,m),s.dom.removeEventListener(`variable-drop`,h),s.destroy(),null)}function p(){o.value=!0,i(`focus`)}function m(){o.value=!1,i(`blur`)}function h(e){i(`variable-drop`,e)}return w(()=>r.modelValue,e=>{if(s&&Wd(s.state)!==e){u=!0;let t=Gd(s.state,l,e||``);s.updateState(t),u=!1}}),g(()=>{d()}),y(()=>{f()}),t({focus:()=>s?.focus(),blur:()=>s?.dom.blur(),getContent:()=>s?Wd(s.state):``,setContent:e=>{if(s){let t=Gd(s.state,l,e);s.updateState(t)}}}),(e,t)=>(E(),c(`div`,{ref_key:`editorContainer`,ref:a,class:`variable-editor-container`,onFocus:p,onBlur:m},null,544))}}),qd=I(Kd,[[`__scopeId`,`data-v-47df69f7`]]),Jd={class:`pointer-events-none flex items-center justify-center w-7 text-gray-600 rounded-l-md shrink-0 border-r border-gray-200`,style:{"background-color":`#f1f3f9`}},Yd={class:`relative flex-1 min-w-0`},Xd={class:`w-5 h-8 pt-3`},Zd={key:0,class:`overflow-hidden`},Qd={class:`flex items-center justify-between border-b border-slate-100 bg-slate-50/90 px-2 py-1.5`},$d={class:`flex items-center gap-1 text-[10px] text-slate-500`},ef=[`value`,`disabled`],tf=[`disabled`],nf=[`disabled`],rf={class:`max-h-56 overflow-y-auto variable-scroll px-2 py-2`},af={key:1,class:`text-xs text-slate-400`},sf={key:0,class:`border-t border-slate-100 bg-slate-50 px-2 py-1.5`},cf={key:2,class:`text-[10px] leading-tight text-slate-400 px-1`},lf=v({inheritAttrs:!1,__name:`VariableTextInput`,props:{modelValue:{default:``},placeholder:{default:``},rows:{default:1},multiline:{type:Boolean,default:!1},previewMode:{default:`bottom`},density:{default:`default`},showBorder:{type:Boolean,default:!1},showTip:{type:Boolean,default:!0}},emits:[`update:modelValue`],setup(e,{emit:t}){let i=e,o=t,s=C(null),l=C(A(i.modelValue)),u=C(!1),f=C(0),g=C(`0`),_=C(!1),v=kn(),{selectedNodeId:y}=ce(v),{contextMap:b}=or(),x=k(()=>!l.value&&i.placeholder);w(()=>i.modelValue,e=>{let t=A(e);t!==l.value&&(l.value=t)});let S=k(()=>{let e=l.value;return!e||typeof e!=`string`?!1:/\{\{\s*[^{}]+?\s*\}\}/.test(e)}),T=k(()=>{let e=l.value;if(!e)return[];if(!S.value||!y.value||!b.value||b.value.size===0)return[e];try{let t=Pt({preview:e},b.value).preview;return Array.isArray(t)?t:t==null?[]:[t]}catch{return[`è§£æé”™è¯¯`]}}),D=k(()=>T.value.length>1&&f.value>0),O=k(()=>T.value.length>1&&f.value<T.value.length-1);w(T,e=>{if(!e.length){f.value=0,g.value=`0`;return}f.value>e.length-1&&(f.value=e.length-1),g.value=String(f.value+1)},{immediate:!0}),w(f,e=>{if(!T.value.length){g.value=`0`;return}g.value=String(e+1)});function A(e){return e==null?``:String(e)}function ee(){_.value=!0,i.previewMode===`dropdown`&&(f.value=0,u.value=!0)}function te(){_.value=!1}function ne(e){l.value=e,o(`update:modelValue`,e)}function re(){f.value<=0||--f.value}function j(){f.value>=T.value.length-1||(f.value+=1)}function ae(e){if(!T.value.length){g.value=`0`;return}g.value=e.target.value.replace(/[^0-9]/g,``)}function oe(){if(!T.value.length){g.value=`0`;return}let e=g.value.trim();if(!e){g.value=String(f.value+1);return}let t=T.value.length,n=Number(e);if(Number.isNaN(n)){g.value=String(f.value+1);return}let r=Math.min(Math.max(Math.floor(n),1),t);f.value=r-1,g.value=String(r)}function se(e){e.key===`Enter`&&(e.preventDefault(),oe())}function N(e){let t=e.detail;if(!t?.reference)return;let n=t.reference.trim();if(!n)return;let r=t.isReplace?n:l.value+n;ne(r)}function le(){v.openVariableEditorModal(l.value,e=>{ne(e)})}return(t,i)=>(E(),c(`div`,ie(t.$attrs,{class:`space-y-2`}),[e.previewMode===`top`&&_.value?(E(),p(ur,{key:0,value:l.value},null,8,[`value`])):h(``,!0),r(nr,{modelValue:u.value,"onUpdate:modelValue":i[0]||=e=>u.value=e,"width-mode":e.previewMode===`dropdown`?`trigger`:`auto`,placement:`bottom-start`,offset:4},{trigger:M(()=>[d(`div`,{class:a([`variable-text-input`,`relative flex items-stretch h-full rounded-md border transition-all duration-200`,e.showBorder?`border-dashed border-red-600`:_.value?`border-slate-400 ring-2 ring-slate-200`:`border-slate-200`])},[d(`div`,Jd,[r(tr,{class:`w-4 h-4`})]),d(`div`,Yd,[x.value?(E(),c(`span`,{key:0,class:a([`pointer-events-none absolute select-none text-slate-400 z-10`,e.density===`compact`?`left-2 top-1 text-xs`:`left-2 top-2 text-sm`])},n(e.placeholder),3)):h(``,!0),r(qd,{ref_key:`editorRef`,ref:s,"model-value":l.value,multiline:e.multiline,density:e.density,class:`w-full`,"onUpdate:modelValue":ne,onFocus:ee,onBlur:te,onVariableDrop:N},null,8,[`model-value`,`multiline`,`density`])]),d(`div`,Xd,[d(`button`,{type:`button`,class:`flex items-center justify-center w-full h-full border-l rounded-tl-md border-t border-slate-200 bg-white text-slate-500 transition-colors hover:border-slate-300 hover:text-slate-700 hover:bg-slate-100 rounded-r-md shrink-0`,onClick:m(le,[`stop`]),title:`æ‰“å¼€å˜é‡ç¼–è¾‘å™¨`},[r(On,{class:`h-3 w-3`})])])],2)]),default:M(()=>[e.previewMode===`dropdown`?(E(),c(`div`,Zd,[d(`div`,Qd,[i[2]||=d(`div`,{class:`text-[10px] font-semibold uppercase tracking-wide text-slate-500`},` Result `,-1),d(`div`,$d,[i[1]||=d(`span`,{class:`font-medium`},`Page`,-1),d(`input`,{value:g.value,type:`text`,inputmode:`numeric`,pattern:`[0-9]*`,placeholder:`0`,disabled:!T.value.length,class:`h-5 w-7 rounded bg-white px-1 text-center text-[10px] font-medium text-slate-600 shadow-inner ring-1 ring-inset ring-slate-200 transition focus:outline-none focus:ring-2 focus:ring-slate-300 disabled:bg-slate-100 disabled:text-slate-400`,onInput:ae,onBlur:oe,onKeydown:se},null,40,ef),d(`span`,null,`/ `+n(T.value.length||0),1),d(`button`,{type:`button`,class:`flex h-5 w-5 items-center justify-center text-slate-400 transition-colors hover:text-slate-700 disabled:cursor-not-allowed disabled:text-slate-300`,disabled:!D.value,"aria-label":`ä¸Šä¸€é¡µ`,onClick:m(re,[`stop`])},[r(de,{class:`h-3 w-3 -rotate-180`})],8,tf),d(`button`,{type:`button`,class:`flex h-5 w-5 items-center justify-center text-slate-400 transition-colors hover:text-slate-700 disabled:cursor-not-allowed disabled:text-slate-300`,disabled:!O.value,"aria-label":`ä¸‹ä¸€é¡µ`,onClick:m(j,[`stop`])},[r(de,{class:`h-3 w-3`})],8,nf)])]),d(`div`,rf,[T.value.length?(E(),p(ur,{key:0,value:l.value,"current-item-index":f.value,inline:``},null,8,[`value`,`current-item-index`])):(E(),c(`p`,af,[...i[3]||=[d(`span`,{class:`font-mono bg-gray-100`},`[empty]`,-1)]]))]),e.showTip?(E(),c(`div`,sf,[...i[4]||=[d(`p`,{class:`text-[10px] leading-tight text-slate-400`},[P(` Tip: æ”¯æŒæ‹–æ‹½å˜é‡æ’å…¥ï¼Œå˜é‡ä»¥ `),d(`span`,{class:`font-mono text-emerald-600`},`{{ èŠ‚ç‚¹å.å­—æ®µ }}`),P(` å½¢å¼è¡¨ç¤º `)],-1)]])):h(``,!0)])):h(``,!0)]),_:1},8,[`modelValue`,`width-mode`]),e.previewMode===`bottom`&&_.value?(E(),p(ur,{key:1,value:l.value},null,8,[`value`])):h(``,!0),e.previewMode!==`dropdown`&&_.value&&e.showTip?(E(),c(`p`,cf,[...i[5]||=[P(` Tip: æ”¯æŒæ‹–æ‹½å˜é‡æ’å…¥ï¼Œå˜é‡ä»¥ `,-1),d(`span`,{class:`font-mono text-emerald-600`},`{{ èŠ‚ç‚¹å.å­—æ®µ }}`,-1),P(` å½¢å¼è¡¨ç¤º `,-1)]])):h(``,!0)],16))}}),uf=I(lf,[[`__scopeId`,`data-v-50e39008`]]),df={class:`config-field mb-4`},ff={key:0,class:`mb-2 block text-sm font-medium text-slate-700`},pf={key:0,class:`text-red-500`},mf={key:1,class:`mb-2 text-xs text-slate-500`},hf={class:`field-input`},gf={key:10,class:`text-sm text-red-500`},_f={key:2,class:`mt-1 text-xs text-red-500`},vf=v({__name:`ConfigField`,props:{field:{},modelValue:{},isDraggingVariable:{type:Boolean}},emits:[`update:modelValue`],setup(e,{emit:t}){let i=e,a=t,o=C(``),s=k(()=>Lt(i.modelValue)||i.isDraggingVariable);function l(e){let t=_(e);o.value=t,t||a(`update:modelValue`,e)}function u(e){try{let t=JSON.parse(e);o.value=``,a(`update:modelValue`,t)}catch{o.value=`JSON æ ¼å¼é”™è¯¯`}}function f(e){let t=e.file;a(`update:modelValue`,t)}function m(e){if(!e)return``;try{return JSON.stringify(e,null,2)}catch{return String(e)}}function g(e){return i.field.validation?.find(t=>t.type===e)?.value}function _(e){let{field:t}=i;if(t.required&&(e==null||e===``))return`${t.label} ä¸ºå¿…å¡«é¡¹`;if(t.validation)for(let n of t.validation){let t=v(n,e);if(t)return t}return``}function v(e,t){switch(e.type){case`min`:if(typeof t==`number`&&t<e.value)return`æœ€å°å€¼ä¸º ${e.value}`;if(typeof t==`string`&&t.length<e.value)return`æœ€å°‘è¾“å…¥ ${e.value} ä¸ªå­—ç¬¦`;break;case`max`:if(typeof t==`number`&&t>e.value)return`æœ€å¤§å€¼ä¸º ${e.value}`;if(typeof t==`string`&&t.length>e.value)return`æœ€å¤šè¾“å…¥ ${e.value} ä¸ªå­—ç¬¦`;break;case`url`:try{new URL(t)}catch{return`è¯·è¾“å…¥æœ‰æ•ˆçš„ URL`}break;case`email`:if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return`è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€`;break;case`pattern`:if(e.value&&!new RegExp(e.value).test(t))return e.message||`æ ¼å¼ä¸æ­£ç¡®`;break;default:break}return``}return w(()=>i.modelValue,()=>{o.value=``}),(t,i)=>{let a=O(`n-input-number`),_=O(`n-select`),v=O(`n-switch`),y=O(`n-checkbox`),b=O(`n-space`),x=O(`n-checkbox-group`),S=O(`n-radio`),C=O(`n-radio-group`),w=O(`n-color-picker`),T=O(`n-button`),D=O(`n-upload`);return E(),c(`div`,df,[e.field.label?(E(),c(`label`,ff,[P(n(e.field.label)+` `,1),e.field.required?(E(),c(`span`,pf,`*`)):h(``,!0)])):h(``,!0),e.field.description?(E(),c(`p`,mf,n(e.field.description),1)):h(``,!0),d(`div`,hf,[[`input`,`textarea`].includes(e.field.type)||s.value?(E(),c(A,{key:0},[e.field.type===`textarea`?(E(),p(uf,{key:0,"model-value":e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,multiline:!0,"show-border":e.isDraggingVariable,"preview-mode":`bottom`,"onUpdate:modelValue":l},null,8,[`model-value`,`placeholder`,`disabled`,`show-border`])):(E(),p(uf,{key:1,"model-value":e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,multiline:!1,"show-border":e.isDraggingVariable,"preview-mode":`bottom`,"onUpdate:modelValue":l},null,8,[`model-value`,`placeholder`,`disabled`,`show-border`]))],64)):e.field.type===`number`?(E(),p(a,{key:1,value:e.modelValue,placeholder:e.field.placeholder,disabled:e.field.disabled,min:g(`min`),max:g(`max`),step:g(`step`)||1,class:`w-full`,"onUpdate:value":l},null,8,[`value`,`placeholder`,`disabled`,`min`,`max`,`step`])):e.field.type===`select`?(E(),p(_,{key:2,value:e.modelValue,options:e.field.options,placeholder:e.field.placeholder,disabled:e.field.disabled,"onUpdate:value":l},null,8,[`value`,`options`,`placeholder`,`disabled`])):e.field.type===`switch`?(E(),p(v,{key:3,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":l},null,8,[`value`,`disabled`])):e.field.type===`checkbox`?(E(),p(x,{key:4,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":l},{default:M(()=>[r(b,{vertical:``},{default:M(()=>[(E(!0),c(A,null,re(e.field.options,e=>(E(),p(y,{key:e.value,value:e.value,label:e.label},null,8,[`value`,`label`]))),128))]),_:1})]),_:1},8,[`value`,`disabled`])):e.field.type===`radio`?(E(),p(C,{key:5,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":l},{default:M(()=>[r(b,{vertical:``},{default:M(()=>[(E(!0),c(A,null,re(e.field.options,e=>(E(),p(S,{key:e.value,value:e.value,label:e.label},null,8,[`value`,`label`]))),128))]),_:1})]),_:1},8,[`value`,`disabled`])):e.field.type===`color`?(E(),p(w,{key:6,value:e.modelValue,disabled:e.field.disabled,"onUpdate:value":l},null,8,[`value`,`disabled`])):e.field.type===`file`?(E(),p(D,{key:7,disabled:e.field.disabled,onChange:f},{default:M(()=>[r(T,{secondary:``},{default:M(()=>[...i[0]||=[P(`é€‰æ‹©æ–‡ä»¶`,-1)]]),_:1})]),_:1},8,[`disabled`])):e.field.type===`json-editor`?(E(),p(uf,{key:8,"model-value":m(e.modelValue),placeholder:e.field.placeholder||`è¾“å…¥ JSON æ•°æ®...`,disabled:e.field.disabled,multiline:!0,"preview-mode":`bottom`,"onUpdate:modelValue":u},null,8,[`model-value`,`placeholder`,`disabled`])):e.field.type===`code-editor`?(E(),p(uf,{key:9,"model-value":e.modelValue,placeholder:e.field.placeholder||`è¾“å…¥ä»£ç ...`,disabled:e.field.disabled,multiline:!0,"preview-mode":`bottom`,"onUpdate:modelValue":l},null,8,[`model-value`,`placeholder`,`disabled`])):(E(),c(`div`,gf,` ä¸æ”¯æŒçš„å­—æ®µç±»å‹: `+n(e.field.type),1))]),o.value?(E(),c(`div`,_f,n(o.value),1)):h(``,!0)])}}}),yf=I(vf,[[`__scopeId`,`data-v-35e9b26e`]]),bf={},xf={t:`1762602673971`,class:`icon`,viewBox:`0 0 1024 1024`,version:`1.1`,xmlns:`http://www.w3.org/2000/svg`,"p-id":`4550`,width:`200`,height:`200`};function Sf(e,t){return E(),c(`svg`,xf,[...t[0]||=[d(`path`,{d:`M219.428571 585.142857c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142858-73.142857-36.571429-73.142857-73.142858-73.142857z m585.142858-146.285714c36.571429 0 73.142857-36.571429 73.142857-73.142857s-36.571429-73.142857-73.142857-73.142857-73.142857 36.571429-73.142858 73.142857 36.571429 73.142857 73.142858 73.142857zM219.428571 292.571429c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142858-73.142857-36.571429-73.142857-73.142858-73.142857z m585.142858 292.571428c-36.571429 0-73.142857 36.571429-73.142858 73.142857s36.571429 73.142857 73.142858 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857zM512 292.571429c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857z m0 292.571428c-36.571429 0-73.142857 36.571429-73.142857 73.142857s36.571429 73.142857 73.142857 73.142857 73.142857-36.571429 73.142857-73.142857-36.571429-73.142857-73.142857-73.142857z`,"p-id":`4551`},null,-1)]])}var Cf=I(bf,[[`render`,Sf]]),wf={},Tf={t:`1762602894224`,class:`icon`,viewBox:`0 0 1024 1024`,version:`1.1`,xmlns:`http://www.w3.org/2000/svg`,"p-id":`6340`,stroke:`currentColor`,fill:`currentColor`};function Ef(e,t){return E(),c(`svg`,Tf,[...t[0]||=[d(`path`,{d:`M457.941333 844.373333a32 32 0 1 0 44.117334-46.293333L235.349333 544H864a32 32 0 0 0 0-64H235.349333l266.709334-254.08a32 32 0 0 0-44.117334-46.336l-316.586666 301.525333a42.453333 42.453333 0 0 0-12.8 24.746667 32.128 32.128 0 0 0 0.042666 12.330667 42.453333 42.453333 0 0 0 12.8 24.704l316.544 301.525333z`,"p-id":`6341`},null,-1)]])}var Df=I(wf,[[`render`,Ef]]),Of={class:`split-layout fixed inset-0 bg-black/30 backdrop-blur-sm overflow-hidden`},kf={class:`flex h-full px-10 py-6`,style:{"min-width":`0`,"max-width":`100vw`,overflow:`hidden`}},Af={class:`h-full overflow-auto variable-scroll`},jf={class:`bg-white rounded-md px-3 py-1 flex items-center justify-center border border-slate-200`},Mf={class:`w-full h-full rounded-lg overflow-hidden bg-white flex flex-col`},Nf={key:0,class:`shrink-0 border-b border-slate-200 bg-white px-6 py-3 rounded-t-lg`},Pf={key:0,class:`text-base font-semibold text-slate-900`},Ff={class:`flex-1 h-full overflow-auto variable-scroll`},If={class:`h-full overflow-auto variable-scroll`},Lf=v({__name:`SplitLayout`,props:{leftWidth:{default:void 0},rightWidth:{default:void 0},centerWidth:{default:400},minLeftWidth:{default:200},minRightWidth:{default:200},centerTitle:{default:void 0},showBackButton:{type:Boolean,default:!0},backText:{default:`Back to canvas`}},emits:[`back`,`resize`],setup(e,{emit:t}){let i=e,o=t,s=C(),l=C(),f=C(),p=C(),m=C(),_=()=>m.value?m.value.clientWidth:window.innerWidth-80,v=e=>e<=1,b=(e,t)=>v(e)?t*e:e,x=()=>{let e=_();return b(i.centerWidth,e)},S=()=>{let e=_(),t=x(),n=e-t;return b(i.minLeftWidth,n)},w=()=>{let e=_(),t=x(),n=e-t;return b(i.minRightWidth,n)},T=()=>{let e=_(),t=x(),n=e-t;if(i.leftWidth!==void 0&&i.rightWidth!==void 0){let e=b(i.leftWidth,n),t=b(i.rightWidth,n);return{left:e,right:t}}let r=S(),a=Math.max(r,Math.floor(n/2));return{left:a,right:n-a}},D=C(0),O=C(0),A=C(!1),te=C(0),ne=()=>{if(!m.value)return;let e=m.value.clientWidth,t=x(),n=e-t,r=S(),i=w();te.value=Math.max(r,n-i)},re=()=>{let e=T();D.value=e.left,O.value=e.right,ne()},ie=k(()=>{let e=S();return{width:`${Math.max(e,Math.min(D.value,te.value))}px`,minWidth:`${e}px`,maxWidth:`${te.value}px`}}),ae=k(()=>{let e=x();return{width:`${e}px`,minWidth:`${e}px`,maxWidth:`${e}px`}}),M=k(()=>({minWidth:`${w()}px`})),oe=C(!1),se=0,N=0,ce=0,le=e=>{e.preventDefault(),e.stopPropagation(),ne(),oe.value=!0,se=e.clientX,N=D.value,ce=O.value,document.addEventListener(`mousemove`,P),document.addEventListener(`mouseup`,F),document.body.style.cursor=`col-resize`,document.body.style.userSelect=`none`},P=e=>{if(!oe.value||(e.preventDefault(),e.stopPropagation(),!m.value))return;let t=e.clientX-se,n=m.value.clientWidth,r=x(),i=n-r,a=N+t,s=ce-t,c=S(),l=w();a=Math.max(c,Math.min(te.value,a));let u=i-c;s=Math.max(l,Math.min(u,s)),a+s>i&&(s=i-a,s<l&&(s=l,a=Math.max(c,i-s))),D.value=Math.round(a),O.value=Math.round(s),o(`resize`,{leftWidth:D.value,rightWidth:O.value})},F=e=>{if(oe.value&&(oe.value=!1,document.removeEventListener(`mousemove`,P),document.removeEventListener(`mouseup`,F),document.body.style.cursor=``,document.body.style.userSelect=``,e&&f.value)){let t=f.value.getBoundingClientRect(),n=e.clientY;n>=t.top&&n<=t.top+50&&(A.value=!0)}},ue=()=>{o(`back`)},I=null,fe=``;return g(async()=>{if(fe=document.body.style.overflow,document.body.style.overflow=`hidden`,await u(),ne(),i.leftWidth!==void 0&&i.rightWidth!==void 0){let e=_(),t=x(),n=e-t;D.value=b(i.leftWidth,n),O.value=b(i.rightWidth,n)}else re();I=()=>{if(ne(),i.leftWidth!==void 0&&i.rightWidth!==void 0){let e=_(),t=x(),n=e-t;if(v(i.leftWidth)||v(i.rightWidth))D.value=b(i.leftWidth,n),O.value=b(i.rightWidth,n);else{let e=S(),t=w(),r=D.value+O.value;if(r>n){let i=n/r;D.value=Math.max(e,Math.min(te.value,Math.round(D.value*i))),O.value=Math.max(t,Math.round(O.value*i))}}}else{let e=_(),t=x(),n=e-t,r=D.value+O.value,i=S(),a=w();if(r>n){let e=n/r;D.value=Math.max(i,Math.min(te.value,Math.round(D.value*e))),O.value=Math.max(a,Math.round(O.value*e))}}},window.addEventListener(`resize`,I)}),y(()=>{F(),I&&window.removeEventListener(`resize`,I),document.body.style.overflow=fe}),(t,i)=>(E(),c(`div`,Of,[e.showBackButton?(E(),c(`button`,{key:0,class:`absolute left-5 top-0 z-50 flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-white/90 hover:text-white`,onClick:ue},[i[2]||=d(`svg`,{class:`h-4 w-4`,fill:`none`,stroke:`currentColor`,"stroke-width":`2`,viewBox:`0 0 24 24`},[d(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,d:`M15 19l-7-7 7-7`})],-1),d(`span`,null,n(e.backText),1)])):h(``,!0),d(`div`,kf,[d(`div`,{ref_key:`containerRef`,ref:m,class:`flex w-full h-full`},[d(`div`,{ref_key:`leftPanelRef`,ref:s,class:`overflow-hidden bg-white border-r border-slate-200 my-6 rounded-l-lg shrink-0`,style:ee(ie.value)},[d(`div`,Af,[j(t.$slots,`left`)])],4),d(`div`,{ref_key:`centerPanelRef`,ref:f,class:`relative flex flex-col h-full shrink-0 shadow-lg z-10`,style:ee(ae.value),onMouseenter:i[0]||=e=>A.value=!0,onMouseleave:i[1]||=e=>A.value=!1},[d(`div`,{class:a([`absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 -z-5 transition-opacity duration-200`,A.value||oe.value?`opacity-100`:`opacity-0`])},[d(`div`,{ref_key:`dragHandleRef`,ref:p,class:`group cursor-col-resize flex items-center gap-2 pointer-events-auto`,onMousedown:le},[d(`div`,{class:a([`flex items-center transition-opacity duration-200 opacity-0 group-hover:opacity-100 -translate-y-2 scale-75`,oe.value&&`opacity-100`])},[r(Df,{class:`w-4 h-4 text-white`})],2),d(`div`,jf,[r(Cf,{class:`w-14 h-5 scale-110 -translate-y-0.5 text-slate-400`})]),d(`div`,{class:a([`flex items-center transition-opacity duration-200 opacity-0 group-hover:opacity-100 -translate-y-2 scale-75`,oe.value&&`opacity-100`])},[r(de,{class:`w-4 h-4 text-white`})],2)],544)],2),d(`div`,Mf,[e.centerTitle||t.$slots.centerHeader?(E(),c(`div`,Nf,[j(t.$slots,`centerHeader`,{},()=>[e.centerTitle?(E(),c(`h2`,Pf,n(e.centerTitle),1)):h(``,!0)])])):h(``,!0),d(`div`,Ff,[j(t.$slots,`center`)])])],36),d(`div`,{ref_key:`rightPanelRef`,ref:l,class:`overflow-hidden bg-white border-l border-slate-200 my-6 rounded-r-lg flex-1 min-w-0`,style:ee(M.value)},[d(`div`,If,[j(t.$slots,`right`)])],4)],512)])]))}}),Rf=[`onClick`],zf=v({name:`ToggleButtonGroup`,props:{options:{},modelValue:{},size:{}},emits:[`update:modelValue`],setup(e,{emit:t}){let r=e,i=t,o=C(null),s=C(new Map),l=k(()=>{switch(r.size??`md`){case`sm`:return`h-6`;case`lg`:return`h-8`;default:return`h-7`}}),f=k(()=>{switch(r.size??`md`){case`sm`:return`h-5`;case`lg`:return`h-7`;default:return`h-6`}}),m=k(()=>{switch(r.size??`md`){case`sm`:return`px-2 py-0.5`;case`lg`:return`px-3 py-1.5`;default:return`px-2.5 py-1`}}),_=k(()=>{switch(r.size??`md`){case`sm`:return`text-[11px]`;case`lg`:return`text-sm`;default:return`text-xs`}}),v=k(()=>{switch(r.size??`md`){case`sm`:return`h-3 w-3`;case`lg`:return`h-4 w-4`;default:return`h-3.5 w-3.5`}}),y=k(()=>{let e=s.value.get(r.modelValue);if(!e||!o.value)return{width:`0px`,left:`0px`,opacity:0};let t=o.value.getBoundingClientRect(),n=e.getBoundingClientRect();return{width:`${n.width}px`,left:`${n.left-t.left}px`,opacity:1}}),b=e=>{i(`update:modelValue`,e)},S=(e,t)=>{if(Array.isArray(e)){let n=e[0];n?s.value.set(t,n):s.value.delete(t)}else e?s.value.set(t,e):s.value.delete(t)};return w(()=>r.modelValue,async()=>{await u()}),g(async()=>{await u()}),(t,r)=>(E(),c(`div`,{ref_key:`containerRef`,ref:o,class:a([`relative flex items-center bg-slate-200 rounded-md p-0.5`,l.value])},[d(`div`,{class:a([`absolute bg-white rounded transition-all duration-200 ease-out`,f.value]),style:ee(y.value)},null,6),(E(!0),c(A,null,re(e.options,t=>(E(),c(`button`,{key:t.value,ref_for:!0,ref:e=>S(e,t.value),onClick:e=>b(t.value),class:a([`relative z-10 font-medium rounded transition-all flex items-center gap-1.5`,m.value,_.value,e.modelValue===t.value?`text-slate-900`:`text-slate-500`])},[t.icon?(E(),p(x(t.icon),{key:0,class:a(v.value)},null,8,[`class`])):h(``,!0),P(` `+n(t.label),1)],10,Rf))),128))],2))}});export{Fe as C,we as D,Be as E,ke as S,Re as T,Pt as _,qd as a,et as b,nr as c,kn as d,On as f,Bt as g,Ht as h,uf as i,Zn as l,bn as m,Lf as n,ur as o,wn as p,yf as r,or as s,zf as t,Bn as u,Et as v,De as w,Je as x,yt as y};