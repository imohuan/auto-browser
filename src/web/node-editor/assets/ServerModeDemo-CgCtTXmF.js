import{Dt as e,Yt as t,at as n,ct as r,en as i,ht as a,in as o,kt as s,lt as c,ot as l,rt as u,tn as d,yt as f}from"./index-BBQwUZyz.js";import{i as p,r as m}from"./useWorkflowServerClient-CnqqAGsX.js";var h={class:`flex flex-col w-screen h-screen bg-gray-50`},g={class:`bg-white border-b border-gray-200 px-6 py-4`},_={class:`flex items-center justify-between`},v={class:`flex items-center gap-4`},y={class:`flex items-center gap-2`},b={class:`text-sm font-medium text-gray-700`},x={class:`flex-1 flex gap-6 p-6 overflow-hidden`},S={class:`w-1/3 bg-white rounded-lg shadow-sm p-6 overflow-y-auto`},C={class:`space-y-4`},w={key:0},T={class:`mt-1 p-3 bg-gray-50 rounded-md`},E={class:`text-sm text-gray-900`},D={class:`mt-1 p-3 bg-gray-50 rounded-md`},O={class:`text-2xl font-bold text-blue-600`},k={key:1,class:`p-4 bg-red-50 rounded-md`},A={class:`text-sm text-red-600 mt-1`},j={key:0,class:`mt-6`},M={class:`text-md font-semibold text-gray-900 mb-3`},N={class:`space-y-2 max-h-96 overflow-y-auto`},P={class:`flex items-center justify-between`},F={class:`text-sm font-medium text-gray-900`},I={class:`text-xs text-gray-500`},L={class:`px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded`},R={class:`flex-1 bg-white rounded-lg shadow-sm p-6 overflow-y-auto`},z={class:`space-y-4`},B=[`disabled`],V={key:0,class:`w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin`},H={key:0,class:`mt-6`},U={class:`space-y-2 max-h-96 overflow-y-auto bg-gray-900 rounded-lg p-4`},W={class:`text-gray-400`},G=`ws://localhost:3001`,K=a({__name:`ServerModeDemo`,setup(a){let K=m(G),q=n(()=>{switch(K.status.value){case`disconnected`:return`未连接`;case`connecting`:return`连接中...`;case`ready`:return`已连接`;case`error`:return`连接错误`;default:return`未知状态`}}),J=t(!1),Y=t([]);function X(e,t){let n=new Date().toLocaleTimeString();Y.value.push({timestamp:n,type:e,message:t}),Y.value.length>100&&Y.value.shift()}let Z=f(`workflowEmitter`);Z&&(Z.on(p.STARTED,e=>{X(`info`,`工作流开始执行: ${e.workflowId}`)}),Z.on(p.COMPLETED,e=>{X(`success`,`工作流执行完成，耗时: ${e.duration}ms`),J.value=!1}),Z.on(p.ERROR,e=>{X(`error`,`工作流执行错误: ${e.error.message}`),J.value=!1}),Z.on(p.NODE_STATUS,e=>{X(`info`,`节点 ${e.nodeId} 状态: ${e.status}`)}),Z.on(p.NODE_LOG,e=>{X(`info`,`[${e.nodeId}] ${e.message}`)}));async function Q(){if(!K.isReady.value||J.value)return;Y.value=[],J.value=!0,X(`info`,`准备执行测试工作流...`);let e=`exec_${Date.now()}`,t=[{id:`start_1`,type:`custom`,parentNode:void 0,data:{label:`开始`,category:`控制`,variant:`start`,inputs:[],outputs:[{id:`__output__`,name:`输出`,type:`any`,isPort:!0}],config:{}}},{id:`httpRequest_2`,type:`custom`,parentNode:void 0,data:{label:`HTTP 请求`,category:`网络`,variant:`custom`,inputs:[{id:`url`,name:`URL`,type:`string`,isPort:!1},{id:`method`,name:`方法`,type:`string`,isPort:!1},{id:`__input__`,name:`输入`,type:`any`,isPort:!0}],outputs:[{id:`__output__`,name:`输出`,type:`any`,isPort:!0}],config:{url:`https://jsonplaceholder.typicode.com/todos/1`,method:`GET`,headers:{},body:``,timeout:3e4}}},{id:`end_3`,type:`custom`,parentNode:void 0,data:{label:`结束`,category:`控制`,variant:`end`,inputs:[{id:`__input__`,name:`输入`,type:`any`,isPort:!0}],outputs:[],config:{}}}],n=[{id:`edge_1`,source:`start_1`,target:`httpRequest_2`,sourceHandle:`__output__`,targetHandle:`__input__`},{id:`edge_2`,source:`httpRequest_2`,target:`end_3`,sourceHandle:`__output__`,targetHandle:`__input__`}];try{K.executeWorkflow(e,`test-workflow`,t,n),X(`success`,`工作流已提交到服务器执行`)}catch(e){X(`error`,`执行失败: ${e}`),J.value=!1}}return(t,n)=>(e(),c(`div`,h,[l(`div`,g,[l(`div`,_,[n[1]||=l(`div`,null,[l(`h1`,{class:`text-2xl font-bold text-gray-900`},`工作流服务器模式演示`),l(`p`,{class:`text-sm text-gray-500 mt-1`},` 使用 WebSocket 服务器替代 Web Worker 执行工作流 `)],-1),l(`div`,v,[l(`div`,y,[l(`div`,{class:d([`w-3 h-3 rounded-full`,{"bg-gray-400":i(K).status.value===`disconnected`,"bg-yellow-400 animate-pulse":i(K).status.value===`connecting`,"bg-green-500":i(K).status.value===`ready`,"bg-red-500":i(K).status.value===`error`}])},null,2),l(`span`,b,o(q.value),1)]),i(K).status.value===`disconnected`?(e(),c(`button`,{key:0,onClick:n[0]||=e=>i(K).reconnect(),class:`px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors`},` 重新连接 `)):r(``,!0)])])]),l(`div`,x,[l(`div`,S,[n[7]||=l(`h2`,{class:`text-lg font-semibold text-gray-900 mb-4`},`服务器信息`,-1),l(`div`,C,[l(`div`,null,[n[2]||=l(`label`,{class:`text-sm font-medium text-gray-700`},`服务器地址`,-1),l(`div`,{class:`mt-1 p-3 bg-gray-50 rounded-md`},[l(`code`,{class:`text-sm text-gray-900`},o(G))])]),i(K).serverId.value?(e(),c(`div`,w,[n[3]||=l(`label`,{class:`text-sm font-medium text-gray-700`},`服务器 ID`,-1),l(`div`,T,[l(`code`,E,o(i(K).serverId.value),1)])])):r(``,!0),l(`div`,null,[n[5]||=l(`label`,{class:`text-sm font-medium text-gray-700`},`已加载节点`,-1),l(`div`,D,[l(`span`,O,o(i(K).nodeMetadata.value.length),1),n[4]||=l(`span`,{class:`text-sm text-gray-500 ml-2`},`个节点`,-1)])]),i(K).error.value?(e(),c(`div`,k,[n[6]||=l(`p`,{class:`text-sm font-medium text-red-800`},`错误`,-1),l(`p`,A,o(i(K).error.value),1)])):r(``,!0)]),i(K).nodeMetadata.value.length>0?(e(),c(`div`,j,[l(`h3`,M,` 节点列表 (`+o(i(K).nodeMetadata.value.length)+`) `,1),l(`div`,N,[(e(!0),c(u,null,s(i(K).nodeMetadata.value,t=>(e(),c(`div`,{key:t.type,class:`p-3 bg-gray-50 rounded-md hover:bg-gray-100 transition-colors`},[l(`div`,P,[l(`div`,null,[l(`p`,F,o(t.label),1),l(`p`,I,o(t.type),1)]),l(`span`,L,o(t.category),1)])]))),128))])])):r(``,!0)]),l(`div`,R,[n[10]||=l(`h2`,{class:`text-lg font-semibold text-gray-900 mb-4`},`工作流测试`,-1),l(`div`,z,[l(`button`,{onClick:Q,disabled:!i(K).isReady.value||J.value,class:`w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2`},[J.value?(e(),c(`span`,V)):r(``,!0),l(`span`,null,o(J.value?`执行中...`:`执行测试工作流`),1)],8,B),n[8]||=l(`p`,{class:`text-sm text-gray-500 text-center`},` 点击按钮执行一个包含 HTTP 请求节点的测试工作流 `,-1)]),Y.value.length>0?(e(),c(`div`,H,[n[9]||=l(`h3`,{class:`text-md font-semibold text-gray-900 mb-3`},`执行日志`,-1),l(`div`,U,[(e(!0),c(u,null,s(Y.value,(t,n)=>(e(),c(`div`,{key:n,class:`text-sm font-mono`},[l(`span`,W,`[`+o(t.timestamp)+`]`,1),l(`span`,{class:d({"text-green-400":t.type===`success`,"text-blue-400":t.type===`info`,"text-yellow-400":t.type===`warning`,"text-red-400":t.type===`error`})},o(t.message),3)]))),128))])])):r(``,!0)])])]))}});export{K as default};