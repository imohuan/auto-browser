(function(){let e=function(e){return e.STARTED=`workflow:started`,e.COMPLETED=`workflow:completed`,e.ERROR=`workflow:error`,e.PAUSED=`workflow:paused`,e.RESUMED=`workflow:resumed`,e.LOOP_STARTED=`workflow:loop:started`,e.ITERATION_STARTED=`workflow:loop:iteration-started`,e.ITERATION_COMPLETED=`workflow:loop:iteration-completed`,e.LOOP_COMPLETED=`workflow:loop:completed`,e.NODE_STATUS=`workflow:node:status`,e.NODE_PROGRESS=`workflow:node:progress`,e.NODE_LOG=`workflow:node:log`,e.EDGE_ACTIVE=`workflow:edge:active`,e.EDGE_INACTIVE=`workflow:edge:inactive`,e.RESTORE_REQUEST=`workflow:restore:request`,e.RESTORE_DATA=`workflow:restore:data`,e}({});var t=class{getStyleConfig(){return{}}createNodeData(){let e=this.defineInputs(),t=this.defineOutputs(),n=e.some(e=>e.isPort),r=t.some(e=>e.isPort),i=e.filter(e=>!e.isPort),a=n?e:[...i,{id:`__input__`,name:`è¾“å…¥`,type:`any`,isPort:!0}],o=r?t:[{id:`__output__`,name:`è¾“å‡º`,type:`any`,isPort:!0}];return{config:this.getDefaultConfig(),inputs:a,outputs:o,label:this.label,category:this.category,style:this.getStyleConfig()}}getInputDefinitions(){return this.defineInputs()}getOutputDefinitions(){return this.defineOutputs()}async run(e,t,n){let r=Date.now(),i=Date.now();try{let a={...e};for(let[e,n]of Object.entries(t))n!=null&&(a[e]=n);let o=await this.execute(a,t,n),s=Date.now()-r,c=this.formatExecutionResult(o);return{duration:s,data:c,status:`success`,timestamp:i}}catch(e){return{duration:Date.now()-r,data:{outputs:{},raw:null},status:`error`,error:e.message||`æ‰§è¡Œå¤±è´¥`,timestamp:i}}}formatExecutionResult(e){let t=this.getOutputDefinitions(),{outputsPayload:n,rawPayload:r,summary:i}=this.extractOutputs(e),a={};if(t.length===0)return{outputs:a,raw:r,summary:i};if(t.length===1){let[e]=t;if(e){let t=this.pickOutputValue(n,e.id,r);a[e.id]={id:e.id,label:e.name,type:e.type,description:e.description,value:t}}}else for(let e of t){if(!e)continue;let t=this.pickOutputValue(n,e.id,void 0);a[e.id]={id:e.id,label:e.name,type:e.type,description:e.description,value:t}}return{outputs:a,raw:r,summary:i}}extractOutputs(e){let t=e,n=e,r;if(e&&typeof e==`object`&&!Array.isArray(e)){let i=Object.prototype.hasOwnProperty.call(e,`outputs`),a=Object.prototype.hasOwnProperty.call(e,`raw`);i&&(t=e.outputs),n=a?e.raw:i?e.outputs:e,typeof e.summary==`string`&&(r=e.summary)}return{outputsPayload:t,rawPayload:n,summary:r}}pickOutputValue(e,t,n){if(e&&typeof e==`object`&&!Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,t))return e[t];if(n!==void 0)return n}validateConfig(e){let t=[],n=this.defineInputs();for(let r of n)r.required&&!e[r.id]&&t.push(`${r.name} æ˜¯å¿…å¡«é¡¹`);return{valid:t.length===0,errors:t}}getMetadata(){return{type:this.type,label:this.label,description:this.description,category:this.category,inputs:this.defineInputs(),outputs:this.defineOutputs(),defaultConfig:this.getDefaultConfig()}}},n=class{constructor(e){this.nodeMap=e??{}}getNodeByType(e){return this.nodeMap[e]}getAllNodes(){return Object.values(this.nodeMap)}getNodesByCategory(){let e={};return Object.values(this.nodeMap).forEach(t=>{let n=t.category;e[n]||(e[n]=[]),e[n].push(t)}),e}hasNodeType(e){return e in this.nodeMap}getAllNodeTypes(){return Object.keys(this.nodeMap)}registerNode(e){this.nodeMap[e.type]=e}registerNodes(e){e.forEach(e=>{this.registerNode(e)})}getRegistry(){return{...this.nodeMap}}extractMetadata(e){let t=e.createNodeData();return{type:e.type,label:e.label,description:e.description,category:e.category,inputs:t.inputs,outputs:t.outputs,defaultConfig:t.config}}getAllMetadata(){return Object.values(this.nodeMap).map(e=>this.extractMetadata(e))}getMetadataByType(e){let t=this.nodeMap[e];return t?this.extractMetadata(t):void 0}getMetadataByTypes(e){return e.map(e=>this.getMetadataByType(e)).filter(e=>e!==void 0)}getMetadataByCategory(){let e={};return Object.values(this.nodeMap).forEach(t=>{let n=t.category;e[n]||(e[n]=[]),e[n].push(this.extractMetadata(t))}),e}},r=class extends t{constructor(...e){super(...e),this.type=`start`,this.label=`å¼€å§‹`,this.description=`å·¥ä½œæµçš„å…¥å£èŠ‚ç‚¹`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{id:`initialPayload`,name:`åˆå§‹æ•°æ®`,type:`any`,description:`ä½œä¸ºæµç¨‹ä¸Šä¸‹æ–‡ä¼ é€’ç»™åç»­èŠ‚ç‚¹ï¼Œå¯ä¸ºç©º`}]}defineOutputs(){return[{id:`next`,name:`è¾“å‡º`,type:`any`,isPort:!0,description:`ä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®`}]}getDefaultConfig(){return{initialPayload:null}}createNodeData(){return{config:this.getDefaultConfig(),inputs:this.defineInputs(),outputs:this.defineOutputs(),label:this.label,category:this.category,variant:this.type}}async execute(e,t,n){let r=e.initialPayload??null;return{outputs:{next:r},raw:r,summary:`æµç¨‹å¼€å§‹`}}},i=class extends t{constructor(...e){super(...e),this.type=`end`,this.label=`ç»“æŸ`,this.description=`å·¥ä½œæµçš„ç»“æŸèŠ‚ç‚¹`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{id:`input`,name:`è¾“å…¥`,type:`any`,isPort:!0,description:`æ¥æ”¶ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œç»“æœ`},{id:`returnInput`,name:`è¿”å›è¾“å…¥ç»“æœ`,type:`boolean`,description:`å¼€å¯åå°†è¾“å…¥ä½œä¸ºæœ€ç»ˆè¾“å‡ºè¿”å›`},{id:`summary`,name:`ç»“æŸæ‘˜è¦`,type:`string`,description:`å¯é€‰ï¼Œå±•ç¤ºåœ¨æ‰§è¡Œæ—¥å¿—ä¸­çš„æè¿°ä¿¡æ¯`}]}defineOutputs(){return[]}getDefaultConfig(){return{returnInput:!0,summary:`æµç¨‹ç»“æŸ`}}createNodeData(){return{config:this.getDefaultConfig(),inputs:this.defineInputs(),outputs:[],label:this.label,category:this.category,variant:this.type}}async execute(e,t,n){return{raw:e.returnInput?t.input??null:e,summary:e.summary||`æµç¨‹ç»“æŸ`}}},a=typeof global==`object`&&global&&global.Object===Object&&global,o=typeof self==`object`&&self&&self.Object===Object&&self,s=a||o||Function(`return this`)(),c=s.Symbol,l=Object.prototype,u=l.hasOwnProperty,d=l.toString,f=c?c.toStringTag:void 0;function p(e){var t=u.call(e,f),n=e[f];try{e[f]=void 0;var r=!0}catch{}var i=d.call(e);return r&&(t?e[f]=n:delete e[f]),i}var m=p,h=Object.prototype.toString;function g(e){return h.call(e)}var _=g,v=`[object Null]`,y=`[object Undefined]`,b=c?c.toStringTag:void 0;function x(e){return e==null?e===void 0?y:v:b&&b in Object(e)?m(e):_(e)}var S=x;function C(e){return typeof e==`object`&&!!e}var w=C,T=Array.isArray;function E(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)}var D=E,O=`[object AsyncFunction]`,ee=`[object Function]`,te=`[object GeneratorFunction]`,ne=`[object Proxy]`;function re(e){if(!D(e))return!1;var t=S(e);return t==ee||t==te||t==O||t==ne}var ie=re,ae=s[`__core-js_shared__`],oe=function(){var e=/[^.]+$/.exec(ae&&ae.keys&&ae.keys.IE_PROTO||``);return e?`Symbol(src)_1.`+e:``}();function se(e){return!!oe&&oe in e}var ce=se,le=Function.prototype.toString;function ue(e){if(e!=null){try{return le.call(e)}catch{}try{return e+``}catch{}}return``}var k=ue,de=/[\\^$.*+?()[\]{}|]/g,fe=/^\[object .+?Constructor\]$/,pe=Function.prototype,me=Object.prototype,he=pe.toString,ge=me.hasOwnProperty,_e=RegExp(`^`+he.call(ge).replace(de,`\\$&`).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,`$1.*?`)+`$`);function ve(e){return!D(e)||ce(e)?!1:(ie(e)?_e:fe).test(k(e))}var ye=ve;function be(e,t){return e?.[t]}var xe=be;function Se(e,t){var n=xe(e,t);return ye(n)?n:void 0}var A=Se,j=A(s,`WeakMap`),Ce=9007199254740991,we=/^(?:0|[1-9]\d*)$/;function Te(e,t){var n=typeof e;return t??=Ce,!!t&&(n==`number`||n!=`symbol`&&we.test(e))&&e>-1&&e%1==0&&e<t}var Ee=Te;function De(e,t){return e===t||e!==e&&t!==t}var Oe=De,ke=9007199254740991;function Ae(e){return typeof e==`number`&&e>-1&&e%1==0&&e<=ke}var je=Ae;function Me(e){return e!=null&&je(e.length)&&!ie(e)}var Ne=Me,Pe=Object.prototype;function Fe(e){var t=e&&e.constructor,n=typeof t==`function`&&t.prototype||Pe;return e===n}var Ie=Fe;function Le(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var Re=Le,ze=`[object Arguments]`;function Be(e){return w(e)&&S(e)==ze}var Ve=Be,He=Object.prototype,Ue=He.hasOwnProperty,We=He.propertyIsEnumerable,Ge=Ve(function(){return arguments}())?Ve:function(e){return w(e)&&Ue.call(e,`callee`)&&!We.call(e,`callee`)};function Ke(){return!1}var qe=Ke,Je=typeof exports==`object`&&exports&&!exports.nodeType&&exports,Ye=Je&&typeof module==`object`&&module&&!module.nodeType&&module,Xe=Ye&&Ye.exports===Je?s.Buffer:void 0,M=(Xe?Xe.isBuffer:void 0)||qe,Ze=`[object Arguments]`,Qe=`[object Array]`,$e=`[object Boolean]`,et=`[object Date]`,tt=`[object Error]`,nt=`[object Function]`,rt=`[object Map]`,it=`[object Number]`,at=`[object Object]`,ot=`[object RegExp]`,st=`[object Set]`,ct=`[object String]`,lt=`[object WeakMap]`,ut=`[object ArrayBuffer]`,dt=`[object DataView]`,ft=`[object Float32Array]`,pt=`[object Float64Array]`,mt=`[object Int8Array]`,ht=`[object Int16Array]`,gt=`[object Int32Array]`,_t=`[object Uint8Array]`,vt=`[object Uint8ClampedArray]`,yt=`[object Uint16Array]`,bt=`[object Uint32Array]`,N={};N[ft]=N[pt]=N[mt]=N[ht]=N[gt]=N[_t]=N[vt]=N[yt]=N[bt]=!0,N[Ze]=N[Qe]=N[ut]=N[$e]=N[dt]=N[et]=N[tt]=N[nt]=N[rt]=N[it]=N[at]=N[ot]=N[st]=N[ct]=N[lt]=!1;function xt(e){return w(e)&&je(e.length)&&!!N[S(e)]}var St=xt;function Ct(e){return function(t){return e(t)}}var wt=Ct,Tt=typeof exports==`object`&&exports&&!exports.nodeType&&exports,P=Tt&&typeof module==`object`&&module&&!module.nodeType&&module,F=P&&P.exports===Tt&&a.process,Et=function(){try{return P&&P.require&&P.require(`util`).types||F&&F.binding&&F.binding(`util`)}catch{}}(),Dt=Et&&Et.isTypedArray,Ot=Dt?wt(Dt):St,kt=Object.prototype.hasOwnProperty;function At(e,t){var n=T(e),r=!n&&Ge(e),i=!n&&!r&&M(e),a=!n&&!r&&!i&&Ot(e),o=n||r||i||a,s=o?Re(e.length,String):[],c=s.length;for(var l in e)(t||kt.call(e,l))&&!(o&&(l==`length`||i&&(l==`offset`||l==`parent`)||a&&(l==`buffer`||l==`byteLength`||l==`byteOffset`)||Ee(l,c)))&&s.push(l);return s}var jt=At;function Mt(e,t){return function(n){return e(t(n))}}var Nt=Mt(Object.keys,Object),Pt=Object.prototype.hasOwnProperty;function Ft(e){if(!Ie(e))return Nt(e);var t=[];for(var n in Object(e))Pt.call(e,n)&&n!=`constructor`&&t.push(n);return t}var It=Ft;function Lt(e){return Ne(e)?jt(e):It(e)}var Rt=Lt,I=A(Object,`create`);function zt(){this.__data__=I?I(null):{},this.size=0}var Bt=zt;function Vt(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Ht=Vt,Ut=`__lodash_hash_undefined__`,Wt=Object.prototype.hasOwnProperty;function Gt(e){var t=this.__data__;if(I){var n=t[e];return n===Ut?void 0:n}return Wt.call(t,e)?t[e]:void 0}var Kt=Gt,qt=Object.prototype.hasOwnProperty;function Jt(e){var t=this.__data__;return I?t[e]!==void 0:qt.call(t,e)}var Yt=Jt,Xt=`__lodash_hash_undefined__`;function Zt(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=I&&t===void 0?Xt:t,this}var Qt=Zt;function L(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}L.prototype.clear=Bt,L.prototype.delete=Ht,L.prototype.get=Kt,L.prototype.has=Yt,L.prototype.set=Qt;var $t=L;function en(){this.__data__=[],this.size=0}var tn=en;function nn(e,t){for(var n=e.length;n--;)if(Oe(e[n][0],t))return n;return-1}var R=nn,rn=Array.prototype.splice;function an(e){var t=this.__data__,n=R(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():rn.call(t,n,1),--this.size,!0}var on=an;function sn(e){var t=this.__data__,n=R(t,e);return n<0?void 0:t[n][1]}var cn=sn;function ln(e){return R(this.__data__,e)>-1}var un=ln;function dn(e,t){var n=this.__data__,r=R(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var fn=dn;function z(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}z.prototype.clear=tn,z.prototype.delete=on,z.prototype.get=cn,z.prototype.has=un,z.prototype.set=fn;var B=z,V=A(s,`Map`);function pn(){this.size=0,this.__data__={hash:new $t,map:new(V||B),string:new $t}}var mn=pn;function hn(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null}var gn=hn;function _n(e,t){var n=e.__data__;return gn(t)?n[typeof t==`string`?`string`:`hash`]:n.map}var H=_n;function vn(e){var t=H(this,e).delete(e);return this.size-=t?1:0,t}var yn=vn;function bn(e){return H(this,e).get(e)}var xn=bn;function Sn(e){return H(this,e).has(e)}var Cn=Sn;function wn(e,t){var n=H(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var Tn=wn;function U(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}U.prototype.clear=mn,U.prototype.delete=yn,U.prototype.get=xn,U.prototype.has=Cn,U.prototype.set=Tn;var En=U;function Dn(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var On=Dn;function kn(){this.__data__=new B,this.size=0}var An=kn;function jn(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var Mn=jn;function Nn(e){return this.__data__.get(e)}var Pn=Nn;function Fn(e){return this.__data__.has(e)}var In=Fn,Ln=200;function Rn(e,t){var n=this.__data__;if(n instanceof B){var r=n.__data__;if(!V||r.length<Ln-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new En(r)}return n.set(e,t),this.size=n.size,this}var zn=Rn;function W(e){this.size=(this.__data__=new B(e)).size}W.prototype.clear=An,W.prototype.delete=Mn,W.prototype.get=Pn,W.prototype.has=In,W.prototype.set=zn;var G=W;function Bn(e,t){for(var n=-1,r=e==null?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}var Vn=Bn;function Hn(){return[]}var Un=Hn,Wn=Object.prototype.propertyIsEnumerable,Gn=Object.getOwnPropertySymbols,Kn=Gn?function(e){return e==null?[]:(e=Object(e),Vn(Gn(e),function(t){return Wn.call(e,t)}))}:Un;function qn(e,t,n){var r=t(e);return T(e)?r:On(r,n(e))}var Jn=qn;function Yn(e){return Jn(e,Rt,Kn)}var Xn=Yn,K=A(s,`DataView`),q=A(s,`Promise`),J=A(s,`Set`),Zn=`[object Map]`,Qn=`[object Object]`,$n=`[object Promise]`,er=`[object Set]`,tr=`[object WeakMap]`,nr=`[object DataView]`,rr=k(K),ir=k(V),ar=k(q),or=k(J),sr=k(j),Y=S;(K&&Y(new K(new ArrayBuffer(1)))!=nr||V&&Y(new V)!=Zn||q&&Y(q.resolve())!=$n||J&&Y(new J)!=er||j&&Y(new j)!=tr)&&(Y=function(e){var t=S(e),n=t==Qn?e.constructor:void 0,r=n?k(n):``;if(r)switch(r){case rr:return nr;case ir:return Zn;case ar:return $n;case or:return er;case sr:return tr}return t});var cr=Y,lr=s.Uint8Array,ur=`__lodash_hash_undefined__`;function dr(e){return this.__data__.set(e,ur),this}var fr=dr;function pr(e){return this.__data__.has(e)}var mr=pr;function X(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new En;++t<n;)this.add(e[t])}X.prototype.add=X.prototype.push=fr,X.prototype.has=mr;var hr=X;function gr(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var _r=gr;function vr(e,t){return e.has(t)}var yr=vr,br=1,xr=2;function Sr(e,t,n,r,i,a){var o=n&br,s=e.length,c=t.length;if(s!=c&&!(o&&c>s))return!1;var l=a.get(e),u=a.get(t);if(l&&u)return l==t&&u==e;var d=-1,f=!0,p=n&xr?new hr:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var m=e[d],h=t[d];if(r)var g=o?r(h,m,d,t,e,a):r(m,h,d,e,t,a);if(g!==void 0){if(g)continue;f=!1;break}if(p){if(!_r(t,function(e,t){if(!yr(p,t)&&(m===e||i(m,e,n,r,a)))return p.push(t)})){f=!1;break}}else if(!(m===h||i(m,h,n,r,a))){f=!1;break}}return a.delete(e),a.delete(t),f}var Cr=Sr;function wr(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}var Tr=wr;function Er(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var Dr=Er,Or=1,kr=2,Ar=`[object Boolean]`,jr=`[object Date]`,Mr=`[object Error]`,Nr=`[object Map]`,Pr=`[object Number]`,Fr=`[object RegExp]`,Ir=`[object Set]`,Lr=`[object String]`,Rr=`[object Symbol]`,zr=`[object ArrayBuffer]`,Br=`[object DataView]`,Vr=c?c.prototype:void 0,Hr=Vr?Vr.valueOf:void 0;function Ur(e,t,n,r,i,a,o){switch(n){case Br:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case zr:return!(e.byteLength!=t.byteLength||!a(new lr(e),new lr(t)));case Ar:case jr:case Pr:return Oe(+e,+t);case Mr:return e.name==t.name&&e.message==t.message;case Fr:case Lr:return e==t+``;case Nr:var s=Tr;case Ir:var c=r&Or;if(s||=Dr,e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=kr,o.set(e,t);var u=Cr(s(e),s(t),r,i,a,o);return o.delete(e),u;case Rr:if(Hr)return Hr.call(e)==Hr.call(t)}return!1}var Wr=Ur,Gr=1,Kr=Object.prototype.hasOwnProperty;function qr(e,t,n,r,i,a){var o=n&Gr,s=Xn(e),c=s.length,l=Xn(t).length;if(c!=l&&!o)return!1;for(var u=c;u--;){var d=s[u];if(!(o?d in t:Kr.call(t,d)))return!1}var f=a.get(e),p=a.get(t);if(f&&p)return f==t&&p==e;var m=!0;a.set(e,t),a.set(t,e);for(var h=o;++u<c;){d=s[u];var g=e[d],_=t[d];if(r)var v=o?r(_,g,d,t,e,a):r(g,_,d,e,t,a);if(!(v===void 0?g===_||i(g,_,n,r,a):v)){m=!1;break}h||=d==`constructor`}if(m&&!h){var y=e.constructor,b=t.constructor;y!=b&&`constructor`in e&&`constructor`in t&&!(typeof y==`function`&&y instanceof y&&typeof b==`function`&&b instanceof b)&&(m=!1)}return a.delete(e),a.delete(t),m}var Jr=qr,Yr=1,Xr=`[object Arguments]`,Zr=`[object Array]`,Z=`[object Object]`,Qr=Object.prototype.hasOwnProperty;function $r(e,t,n,r,i,a){var o=T(e),s=T(t),c=o?Zr:cr(e),l=s?Zr:cr(t);c=c==Xr?Z:c,l=l==Xr?Z:l;var u=c==Z,d=l==Z,f=c==l;if(f&&M(e)){if(!M(t))return!1;o=!0,u=!1}if(f&&!u)return a||=new G,o||Ot(e)?Cr(e,t,n,r,i,a):Wr(e,t,c,n,r,i,a);if(!(n&Yr)){var p=u&&Qr.call(e,`__wrapped__`),m=d&&Qr.call(t,`__wrapped__`);if(p||m){var h=p?e.value():e,g=m?t.value():t;return a||=new G,i(h,g,n,r,a)}}return f?(a||=new G,Jr(e,t,n,r,i,a)):!1}var ei=$r;function ti(e,t,n,r,i){return e===t?!0:e==null||t==null||!w(e)&&!w(t)?e!==e&&t!==t:ei(e,t,n,r,ti,i)}var ni=ti;function ri(e,t){return ni(e,t)}var ii=ri;let ai={"is equal to":`ç­‰äº`,"is not equal to":`ä¸ç­‰äº`,exists:`å­˜åœ¨`,"does not exist":`ä¸å­˜åœ¨`,"is empty":`ä¸ºç©º`,"is not empty":`ä¸ä¸ºç©º`,contains:`åŒ…å«`,"does not contain":`ä¸åŒ…å«`,"starts with":`å¼€å¤´ä¸º`,"ends with":`ç»“å°¾ä¸º`,"is greater than":`å¤§äº`,"is less than":`å°äº`,"is greater than or equal to":`å¤§äºç­‰äº`,"is less than or equal to":`å°äºç­‰äº`,"is true":`ä¸ºçœŸ`,"is false":`ä¸ºå‡`,"is before":`æ—©äº`,"is after":`æ™šäº`,"is before or equal to":`æ—©äºæˆ–ç­‰äº`,"is after or equal to":`æ™šäºæˆ–ç­‰äº`,"length equal to":`é•¿åº¦ç­‰äº`,"length not equal to":`é•¿åº¦ä¸ç­‰äº`,"length greater than":`é•¿åº¦å¤§äº`,"length less than":`é•¿åº¦å°äº`,"length greater than or equal to":`é•¿åº¦å¤§äºç­‰äº`,"length less than or equal to":`é•¿åº¦å°äºç­‰äº`};var oi=class extends t{constructor(...e){super(...e),this.type=`if`,this.label=`æ¡ä»¶åˆ¤æ–­`,this.description=`æ ¹æ®æ¡ä»¶åˆ¤æ–­æ‰§è¡Œä¸åŒçš„åˆ†æ”¯`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{id:`input`,name:`è¾“å…¥æ•°æ®`,type:`any`,required:!1,isPort:!0}]}defineOutputs(){return this.getOutputsForConfig(this.getDefaultConfig())}getDefaultConfig(){return{conditions:[{logic:`and`,subConditions:[{field:``,dataType:`string`,operator:`is equal to`,value:``}]}]}}getOutputsForConfig(e){let t=e.conditions||[],n=Math.max(t.length,1),r=[];for(let e=0;e<n;e++){let n=t[e];r.push({id:this.getConditionOutputId(e),name:this.createConditionPortName(e),type:`any`,description:n?this.describeCondition(n):`æœªé…ç½®æ¡ä»¶`,isPort:!0})}return r.push({id:`else`,name:`å¦åˆ™`,type:`any`,description:`æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³æ—¶æ‰§è¡Œ`,isPort:!0}),r}async execute(e,t,n){let r=t.input,i=(Array.isArray(e.conditions)?e.conditions:[]).map((e,t)=>{let n=e.subConditions.map(e=>{let t=this.resolveOperandValue(e.field,e.dataType,{fallbackSource:r,preferPath:!0}),n=this.resolveOperandValue(e.value,e.dataType),i=this.compareValues(t,n,e.operator,e.dataType);return{...e,actualValue:t,targetValue:n,result:i}}),i=e.logic===`or`?n.some(e=>e.result):n.every(e=>e.result);return{index:t,outputId:this.getConditionOutputId(t),logic:e.logic,subResults:n,result:i}}),a=i.findIndex(e=>e.result),o=a!==-1,s={};i.forEach((e,t)=>{s[e.outputId]=t===a?{branch:e.outputId,passed:!0,input:r,evaluation:e,allEvaluations:i}:void 0}),s.else=o?void 0:{branch:`else`,passed:!1,input:r,allEvaluations:i};let c=a===-1?null:i[a];return{outputs:s,raw:{branch:c?c.outputId:`else`,passed:o,input:r,evaluations:i},summary:c?`æ¡ä»¶${a+1}æ»¡è¶³`:`æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæ‰§è¡Œ else`}}getConditionOutputId(e){return`condition_${e+1}`}createConditionPortName(e){return`æ¡ä»¶${e+1}`}describeCondition(e){let{logic:t,subConditions:n}=e;if(!n||n.length===0)return`æœªé…ç½®å­æ¡ä»¶`;if(n.length===1)return this.describeSubCondition(n[0]);let r=t===`and`?` ä¸” `:` æˆ– `,i=n.map(e=>this.describeSubCondition(e)).join(r);return i.length>60?i.slice(0,57)+`...`:i}describeSubCondition(e){if(!e)return`æœªé…ç½®`;let t=this.formatOperand(e.field,`è¾“å…¥å€¼`),n=ai[e.operator]||e.operator;if([`exists`,`does not exist`,`is empty`,`is not empty`,`is true`,`is false`].includes(e.operator))return`${t} ${n}`;let r=this.truncateValue(e.value,20,`''`);return`${t} ${n} ${r}`}truncateValue(e,t=48,n=``){let r=this.formatOperand(e,n);return r?r.length<=t?r:`${r.slice(0,t-1)}â€¦`:n}formatOperand(e,t=``){if(e==null)return t;if(typeof e==`string`){let n=e.trim();return n.length>0?n:t}if(typeof e==`number`||typeof e==`boolean`)return String(e);if(e instanceof Date)return e.toISOString();try{return JSON.stringify(e)}catch{return String(e)}}resolveFieldValue(e,t){if(!t)return e;if(e==null)return;let n=t.split(`.`).map(e=>e.trim()).filter(Boolean),r=e;for(let e of n){if(r==null)return;if(Array.isArray(r)){let t=Number(e);r=Number.isInteger(t)?r[t]:void 0}else r=r[e]}return r}resolveOperandValue(e,t,n={}){if(e==null)return e;if(typeof e==`string`){let r=e.trim();if(n.preferPath&&n.fallbackSource!==void 0&&this.isPathLikeString(r)){let e=this.resolveFieldValue(n.fallbackSource,r);if(e!==void 0)return e}return this.coerceValueByType(r,t)}return this.coerceValueByType(e,t)}coerceValueByType(e,t){if(e==null)return e;switch(t){case`number`:{if(typeof e==`number`)return e;if(typeof e==`boolean`)return e?1:0;if(typeof e==`string`){let t=Number(e);return Number.isNaN(t)?e:t}let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`number`)return e!==0;if(typeof e==`string`){let t=e.toLowerCase();if([`true`,`1`,`yes`].includes(t))return!0;if([`false`,`0`,`no`].includes(t))return!1}return!!e;case`date`:if(e instanceof Date)return e;if(typeof e==`number`)return new Date(e);if(typeof e==`string`){let t=new Date(e);return Number.isNaN(t.getTime())?e:t}return e;case`array`:if(Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return[];try{let n=JSON.parse(t);return Array.isArray(n)?n:e}catch{return e}}return e;case`object`:if(e&&typeof e==`object`&&!Array.isArray(e))return e;if(typeof e==`string`){let t=e.trim();if(!t)return{};try{let n=JSON.parse(t);return n&&typeof n==`object`?n:e}catch{return e}}return e;default:return typeof e==`string`?e:String(e)}}isPathLikeString(e){return!e||/\s/.test(e)?!1:e===`input`?!0:e.includes(`.`)||/\[\d+\]/.test(e)}compareValues(e,t,n,r){switch(n){case`is equal to`:return this.compareEquality(e,t,r);case`is not equal to`:return!this.compareEquality(e,t,r);case`exists`:return e!=null;case`does not exist`:return e==null;case`is empty`:return e==null?!0:typeof e==`string`?e.trim().length===0:Array.isArray(e)?e.length===0:typeof e==`object`?Object.keys(e).length===0:!1;case`is not empty`:return e==null?!1:typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:typeof e==`object`?Object.keys(e).length>0:!0;case`contains`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?e.includes(t):!1;case`does not contain`:return typeof e==`string`&&typeof t==`string`||Array.isArray(e)?!e.includes(t):!0;case`starts with`:return typeof e==`string`&&typeof t==`string`?e.startsWith(t):!1;case`ends with`:return typeof e==`string`&&typeof t==`string`?e.endsWith(t):!1;case`is greater than`:return Number(e)>Number(t);case`is less than`:return Number(e)<Number(t);case`is greater than or equal to`:return Number(e)>=Number(t);case`is less than or equal to`:return Number(e)<=Number(t);case`is true`:return e===!0;case`is false`:return e===!1;case`is before`:return new Date(e)<new Date(t);case`is after`:return new Date(e)>new Date(t);case`is before or equal to`:return new Date(e)<=new Date(t);case`is after or equal to`:return new Date(e)>=new Date(t);case`length equal to`:return this.getLength(e)===Number(t);case`length not equal to`:return this.getLength(e)!==Number(t);case`length greater than`:return this.getLength(e)>Number(t);case`length less than`:return this.getLength(e)<Number(t);case`length greater than or equal to`:return this.getLength(e)>=Number(t);case`length less than or equal to`:return this.getLength(e)<=Number(t);default:return!1}}getLength(e){return typeof e==`string`||Array.isArray(e)?e.length:typeof e==`object`&&e?Object.keys(e).length:0}compareEquality(e,t,n){let r=this.normalizeEqualityValue(e,n),i=this.normalizeEqualityValue(t,n);return n===`array`||n===`object`?ii(r,i):r===i}normalizeEqualityValue(e,t){if(e==null)return e;switch(t){case`number`:{let t=Number(e);return Number.isNaN(t)?e:t}case`boolean`:if(typeof e==`boolean`)return e;if(typeof e==`string`){let t=e.trim().toLowerCase();if(t===`true`||t===`1`)return!0;if(t===`false`||t===`0`)return!1}return typeof e==`number`?e===1:!!e;case`date`:{let t=e instanceof Date?e.getTime():new Date(e).getTime();return Number.isNaN(t)?e:t}case`string`:return String(e);default:return e}}},si=class extends t{constructor(...e){super(...e),this.type=`for`,this.label=`æ‰¹å¤„ç†`,this.description=`éå†é›†åˆå¹¶è¿è¡Œå¾ªç¯ä½“`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{id:`items`,name:`è¾“å…¥é›†åˆ`,type:`array`,required:!1,isPort:!0}]}defineOutputs(){return[{id:`loop`,name:`å¾ªç¯ä½“`,type:`any`,isPort:!0},{id:`next`,name:`å¾ªç¯ç»“æŸ`,type:`any`,isPort:!0}]}getDefaultConfig(){return{mode:`input`,itemsPath:``,staticItems:[],range:{start:0,end:5,step:1},itemName:`item`,indexName:`index`,containerId:null,errorHandling:{continueOnError:!1}}}async execute(e,t,n){let r=this.resolveItems(e,t.items);if(!Array.isArray(r))throw Error(`å¾ªç¯æºæ•°æ®å¿…é¡»æ˜¯æ•°ç»„`);let i=r.map((t,n)=>({[e.itemName]:t,[e.indexName]:n})),a={mode:e.mode,count:r.length,items:r,itemName:e.itemName,indexName:e.indexName,containerId:e.containerId||null,errorHandling:e.errorHandling,iterations:i};return{outputs:{loop:i,next:{count:a.count,items:a.items,itemName:a.itemName,indexName:a.indexName,containerId:a.containerId}},raw:a,summary:`å¾ªç¯ ${a.count} æ¬¡`}}resolveItems(e,t){switch(e.mode){case`input`:{if(!e.itemsPath)return Array.isArray(t)?t:[];let n=this.resolveByPath(t,e.itemsPath);return Array.isArray(n)?n:[]}case`static`:return Array.isArray(e.staticItems)?e.staticItems:[];case`range`:{let{start:t=0,end:n=0,step:r=1}=e.range||{};if(r===0)throw Error(`æ­¥é•¿ä¸èƒ½ä¸º 0`);let i=[];if(r>0)for(let e=t;e<n;e+=r)i.push(e);else for(let e=t;e>n;e+=r)i.push(e);return i}default:return[]}}resolveByPath(e,t){if(!t)return e;if(e==null)return;let n=t.split(`.`).map(e=>e.trim()).filter(Boolean),r=e;for(let e of n){if(r==null)return;if(Array.isArray(r)){let t=Number(e);r=Number.isInteger(t)?r[t]:void 0}else r=r[e]}return r}};let ci={flow:{start:new r,end:new i,if:new oi,for:new si}};function li(){let e={};return Object.values(ci).forEach(t=>{Object.values(t).forEach(t=>{e[t.type]=t})}),e}var ui=class extends n{constructor(){super(li())}};let di={start:new r,end:new i,if:new oi,for:new si};async function fi(t){let{nodes:n,edges:r,startNodeId:i,nodeFactory:a,signal:o,logId:s,emitter:c,executionId:l,workflowId:u}=t,d=e=>di[e]??a?.(e);if(!Array.isArray(n)||n.length===0)throw Error(`æ‰§è¡Œå¤±è´¥ï¼šè‡³å°‘éœ€è¦ä¸€ä¸ªèŠ‚ç‚¹`);if(o?.aborted)throw Error(`æ‰§è¡Œå·²è¢«å–æ¶ˆ`);let f=l||`exec_${Date.now()}`,p=u||`default-workflow`;c&&c.emit(e.STARTED,{executionId:f,workflowId:p,mode:`worker`,timestamp:Date.now(),totalNodes:n.length});let m=pi({nodes:n,explicitStartId:i});if(!m)throw Error(`æ‰§è¡Œå¤±è´¥ï¼šæœªæ‰¾åˆ°å¼€å§‹èŠ‚ç‚¹`);let h=new Map;n.forEach(e=>{h.set(e.id,{...e,data:{...e.data}})});let g=mi(r,`source`),_=mi(r,`target`),v={logId:s??`workflow_${Date.now()}`,startTime:Date.now(),status:`running`,nodes:n.map(e=>wi(e))},y=new Map;v.nodes.forEach(e=>y.set(e.nodeId,e));let b={},x=new Set,S=[m.id],C=new Set,w=`running`,T,E={};for(;S.length>0;){if(o?.aborted){w=`aborted`,T=`æ‰§è¡Œå·²è¢«å–æ¶ˆ`;break}let t=S.shift();if(C.has(t))continue;C.add(t);let n=h.get(t);if(!n)continue;let i=y.get(t);if(i){i.status=`running`,i.startTime=Date.now(),c&&c.emit(e.NODE_STATUS,{executionId:f,nodeId:t,status:`running`,timestamp:Date.now()});try{if(!d)throw Error(`nodeFactory æ˜¯å¿…éœ€çš„ï¼Œè¯·æä¾›èŠ‚ç‚¹å·¥å‚å‡½æ•°`);let a=Ci(n,d);if(!a)throw Error(`æœªæ‰¾åˆ°èŠ‚ç‚¹æ‰§è¡Œå™¨: ${Q(n)}`);let o=hi(n.id,{incomingMap:_,nodeResults:b});i.input=o;let s={...n.data.config},l=await a.run(s,o,E),u=l,p=!1;if(Q(n)===`for`){let e=await gi({currentNode:n,result:l,context:E,nodeMap:h,edges:r,nodeResults:b,nodeFactory:d,incomingMap:_,outgoingMap:g,emitter:c,executionId:f,nodeLogMap:y,executedNodeIds:x});u=e.result,p=e.handled}b[n.id]=u,x.add(n.id),n.data={...n.data,result:u};let m=Date.now();if(i.status=`success`,i.endTime=m,i.input=o,i.output=u,c&&c.emit(e.NODE_STATUS,{executionId:f,nodeId:t,status:`success`,timestamp:m,output:u,duration:m-i.startTime}),Q(n)===`end`)continue;let v=g.get(t)??[],w=new Set;Object.entries(u.data?.outputs??{}).forEach(([e,t])=>{let n=t;n&&n.value!==void 0&&w.add(e)}),p&&w.delete(`loop`);let T=v;w.size>0&&(T=v.filter(e=>{let t=e.sourceHandle??null;return t?w.has(t)?!0:t===`__output__`||t===`result`:w.size===1})),T.forEach(t=>{C.has(t.target)||(S.push(t.target),c&&t.id&&c.emit(e.EDGE_ACTIVE,{executionId:f,edgeId:t.id,fromNodeId:t.source,toNodeId:t.target,timestamp:Date.now()}))})}catch(n){let r=n instanceof Error?n.message:String(n??`æ‰§è¡Œå¼‚å¸¸`),a=Date.now();i.status=`error`,i.endTime=a,i.input=i.input??null,i.error=r,w=`error`,T=r,c&&c.emit(e.NODE_STATUS,{executionId:f,nodeId:t,status:`error`,timestamp:a,error:{message:r,stack:n instanceof Error?n.stack:void 0},duration:a-i.startTime});break}}}w===`running`&&(w=`success`);let D=[];v.nodes.forEach(e=>{x.has(e.nodeId)||(e.status!==`error`&&(e.status=`skipped`),e.endTime=e.endTime??Date.now(),e.input=e.input??null,D.push(e.nodeId))});let O=Date.now();if(v.status=w,v.endTime=O,v.error=T,c)if(w===`success`){let t=v.nodes.filter(e=>e.status===`success`).length,n=v.nodes.filter(e=>e.status===`error`).length;c.emit(e.COMPLETED,{executionId:f,timestamp:O,duration:O-v.startTime,successNodes:t,failedNodes:n})}else w===`error`&&c.emit(e.ERROR,{executionId:f,error:{message:T||`å·¥ä½œæµæ‰§è¡Œå¤±è´¥`},timestamp:O});return w===`aborted`&&Ti(T),{status:w,log:v,nodeResults:b,nodes:Array.from(h.values()),skippedNodeIds:D}}function pi({nodes:e,explicitStartId:t}){return t?e.find(e=>e.id===t):e.find(e=>e.data?.variant===`start`)||e.find(e=>Q(e)===`start`)}function Q(e){return e.data?.variant?String(e.data.variant):e.id.includes(`_`)?e.id.split(`_`)[0]??``:e.type??``}function mi(e,t){let n=new Map;return e.forEach(e=>{let r=e[t];r&&(n.has(r)||n.set(r,[]),n.get(r)?.push(e))}),n}function hi(e,t){let{incomingMap:n,nodeResults:r}=t,i={};return(n.get(e)??[]).forEach(e=>{let t=r[e.source];if(!t)return;let n=e.targetHandle??`default`,a=e.sourceHandle??`__output__`,o=t.data?.outputs||{},s=Object.keys(o),c,l=e.sourceHandle??void 0,u=Ei(o,l);if(u)c=u.value;else if(s.length===1){let e=s[0];c=o[e]?.value}else c=Ei(o,a)?.value;c===void 0&&(c=t.data?.raw??null),i[n]=c}),i}async function gi(t){let{currentNode:n,result:r,context:i,nodeMap:a,edges:o,nodeResults:s,nodeFactory:c,incomingMap:l,outgoingMap:u,emitter:d,executionId:f,nodeLogMap:p,executedNodeIds:m}=t,h=n.data.config||{},g=h.containerId;if(!g)return{result:r,handled:!1};let _=bi(r);if(!Array.isArray(_))return{result:r,handled:!0};let v=vi(g,a);if(v.size===0)return{result:r,handled:!0};let y=!!h.errorHandling?.continueOnError,b=[],x=Date.now();d&&d.emit(e.LOOP_STARTED,{executionId:f,forNodeId:n.id,containerId:g,totalIterations:_.length,timestamp:x});let S=0,C=0;for(let t=0;t<_.length;t++){let r=_[t]??{},h=Date.now();d&&d.emit(e.ITERATION_STARTED,{executionId:f,forNodeId:n.id,iterationIndex:t,variables:r,timestamp:h});let x=i.loopVariables;i.loopVariables=r,yi(v,a,s,p);try{let{containerResults:_}=await _i({containerId:g,context:i,nodeMap:a,nodeResults:s,nodeFactory:c,incomingMap:l,outgoingMap:u,edges:o,childNodeIds:v,nodeLogMap:p,executedNodeIds:m,emitter:d,executionId:f}),y=Date.now()-h;b.push({index:t,variables:r,nodeResults:_,duration:y,status:`success`}),S+=1,d&&d.emit(e.ITERATION_COMPLETED,{executionId:f,forNodeId:n.id,iterationIndex:t,duration:y,status:`success`,timestamp:Date.now()})}catch(a){let o=Date.now()-h,s=a instanceof Error?a.message:String(a??`è¿­ä»£æ‰§è¡Œå¤±è´¥`);if(b.push({index:t,variables:r,nodeResults:{},duration:o,status:`error`,error:s}),C+=1,d&&d.emit(e.ITERATION_COMPLETED,{executionId:f,forNodeId:n.id,iterationIndex:t,duration:o,status:`error`,error:s,timestamp:Date.now()}),!y)throw i.loopVariables=x,a}finally{i.loopVariables=x}}let w=Date.now()-x;d&&d.emit(e.LOOP_COMPLETED,{executionId:f,forNodeId:n.id,containerId:g,totalIterations:_.length,successCount:S,errorCount:C,duration:w,timestamp:Date.now()});let T=b.reduce((e,t)=>e+t.duration,0),E=[`å¾ªç¯æ‰§è¡Œ ${_.length} æ¬¡`,`æ€»è€—æ—¶ ${T}ms`];return{result:{...r,iterations:b,data:{...r.data,summary:E.join(`ï¼Œ`)}},handled:!0}}async function _i(t){let{containerId:n,context:r,nodeMap:i,nodeResults:a,nodeFactory:o,incomingMap:s,outgoingMap:c,edges:l,childNodeIds:u,nodeLogMap:d,executedNodeIds:f,emitter:p,executionId:m}=t,h=Array.from(i.values()),g=xi(n,h,l),_=Si(n,h,l);if(!g)throw Error(`å®¹å™¨ ${n} æ²¡æœ‰å…¥å£èŠ‚ç‚¹`);if(!_)throw Error(`å®¹å™¨ ${n} æ²¡æœ‰å‡ºå£èŠ‚ç‚¹`);let v=[g],y=new Set,b={};for(;v.length>0;){let t=v.shift();if(!t||y.has(t))continue;y.add(t);let n=i.get(t);if(!n)continue;let l=d.get(t),h=Date.now();l&&(l.status=`running`,l.startTime=h,l.endTime=void 0,l.error=void 0,l.output=void 0,l.input=null),p&&p.emit(e.NODE_STATUS,{executionId:m,nodeId:t,status:`running`,timestamp:h});try{let i=Ci(n,o);if(!i)throw Error(`æœªæ‰¾åˆ°èŠ‚ç‚¹æ‰§è¡Œå™¨: ${Q(n)}`);let d=hi(t,{incomingMap:s,nodeResults:{...a,...b}});l&&(l.input=d);let g={...n.data.config},x=await i.run(g,d,r);b[t]=x,a[t]=x,f.add(t),n.data={...n.data,result:x};let S=Date.now();if(l&&(l.status=`success`,l.endTime=S,l.output=x),p&&p.emit(e.NODE_STATUS,{executionId:m,nodeId:t,status:`success`,timestamp:S,output:x,duration:S-h}),t===_)break;let C=c.get(t)??[],w=C,T=new Set;Object.entries(x.data?.outputs??{}).forEach(([e,t])=>{let n=t;n&&n.value!==void 0&&T.add(e)}),T.size>0&&(w=C.filter(e=>{let t=e.sourceHandle??null;return t?T.has(t)?!0:t===`__output__`||t===`result`:T.size===1})),w.forEach(t=>{t.target&&(u.has(t.target)&&!y.has(t.target)&&v.push(t.target),p&&t.id&&p.emit(e.EDGE_ACTIVE,{executionId:m,edgeId:t.id,fromNodeId:t.source,toNodeId:t.target,timestamp:Date.now()}))})}catch(n){let r=n instanceof Error?n.message:String(n??`è¿­ä»£æ‰§è¡Œå¤±è´¥`),i=Date.now();throw l&&(l.status=`error`,l.endTime=i,l.error=r),p&&p.emit(e.NODE_STATUS,{executionId:m,nodeId:t,status:`error`,timestamp:i,error:{message:r,stack:n instanceof Error?n.stack:void 0},duration:i-h}),n}}return{containerResults:b,exitNodeId:_}}function vi(e,t){let n=new Set;return t.forEach(t=>{t.parentNode===e&&n.add(t.id)}),n}function yi(e,t,n,r){e.forEach(e=>{delete n[e];let i=t.get(e);i&&(i.data={...i.data,result:void 0});let a=r.get(e);a&&(a.status=`pending`,a.startTime=0,a.endTime=void 0,a.error=void 0,a.output=void 0,a.input=null)})}function bi(e){let t=e.data?.outputs?.loop;if(t&&Array.isArray(t.value))return t.value;let n=e.data?.raw;return n&&Array.isArray(n.iterations)?n.iterations:[]}function xi(e,t,n){let r=t.filter(t=>t.parentNode===e);if(r.length===0)return null;let i=n.find(t=>t.source===e&&(t.sourceHandle===`loop-left`||t.sourceHandle===`input`));if(i)return i.target??null;let a=new Set(r.map(e=>e.id));for(let t of r)if(!n.some(n=>n.target===t.id&&n.source!==e&&a.has(n.source)))return t.id;return r[0]?.id??null}function Si(e,t,n){let r=t.filter(t=>t.parentNode===e);if(r.length===0)return null;let i=n.find(t=>t.target===e&&(t.targetHandle===`loop-right`||t.targetHandle===`output`));if(i)return i.source??null;let a=new Set(r.map(e=>e.id));for(let t=r.length-1;t>=0;t--){let i=r[t];if(!n.some(t=>t.source===i.id&&t.target!==e&&a.has(t.target)))return i.id}return r[r.length-1]?.id??null}function Ci(e,t){let n=Q(e);if(n)return t(n)}function wi(e){return{nodeId:e.id,nodeName:e.data?.label??e.id,status:`pending`,startTime:0,input:null}}function Ti(e){let t=Error(e||`æ‰§è¡Œå·²è¢«å–æ¶ˆ`);throw t.name=`AbortError`,t}function Ei(e,t){if(t&&Object.prototype.hasOwnProperty.call(e,t))return e[t]}var Di=class{constructor(e={}){this.requestId=1,this.sessionId=null,this.isInitialized=!1,this.apiUrl=e.apiUrl||`/api/mcp`,this.protocolVersion=e.protocolVersion||`2024-11-05`,this.clientInfo=e.clientInfo||{name:`mcp-client`,version:`1.0.0`},this.enableLog=e.enableLog??!0}async request(e,t){let n={jsonrpc:`2.0`,id:this.requestId++,method:e,params:t};this.log(`ğŸ“¤ å‘é€è¯·æ±‚:`,e,t?`\n   å‚æ•°: ${JSON.stringify(t,null,2)}`:``);try{let e={"Content-Type":`application/json`,Accept:`application/json, text/event-stream`,"Cache-Control":`no-cache`};this.sessionId&&(e[`mcp-session-id`]=this.sessionId);let t=await fetch(this.apiUrl,{method:`POST`,headers:e,body:JSON.stringify(n)}),r=t.headers.get(`mcp-session-id`);return r&&!this.sessionId&&(this.sessionId=r,this.log(`ğŸ’¾ ä¿å­˜ Session ID:`,r)),await this.parseResponse(t)}catch(e){return this.logError(`âŒ ç½‘ç»œé”™è¯¯:`,e.message),{success:!1,error:{code:-1,message:e.message}}}}async initialize(){this.log(`ğŸš€ ========== åˆå§‹åŒ– MCP ä¼šè¯ ==========`);let e={protocolVersion:this.protocolVersion,capabilities:{},clientInfo:this.clientInfo},t=await this.request(`initialize`,e);if(t.success){let e={"Content-Type":`application/json`,Accept:`application/json, text/event-stream`};return this.sessionId&&(e[`mcp-session-id`]=this.sessionId),await fetch(this.apiUrl,{method:`POST`,headers:e,body:JSON.stringify({jsonrpc:`2.0`,method:`notifications/initialized`})}),this.isInitialized=!0,this.log(`âœ… ä¼šè¯åˆå§‹åŒ–æˆåŠŸ
`),!0}else return this.logError(`âŒ ä¼šè¯åˆå§‹åŒ–å¤±è´¥:`,t.error?.message,`
`),!1}async callTool(e,t={}){if(!this.isInitialized){if(this.log(`âš ï¸  æœªåˆå§‹åŒ–ï¼Œå…ˆåˆå§‹åŒ–...`),!await this.initialize())return{success:!1,error:{code:-1,message:`åˆå§‹åŒ–å¤±è´¥`}};await this.sleep(1e3)}this.log(`ğŸ”§ ========== è°ƒç”¨å·¥å…·: ${e} ==========`);let n={name:e,arguments:t};return await this.request(`tools/call`,n)}async listTools(){return!this.isInitialized&&(this.log(`âš ï¸  æœªåˆå§‹åŒ–ï¼Œå…ˆåˆå§‹åŒ–...`),!await this.initialize())?{success:!1,error:{code:-1,message:`åˆå§‹åŒ–å¤±è´¥`}}:(this.log(`ğŸ“‹ ========== è·å–å·¥å…·åˆ—è¡¨ ==========`),await this.request(`tools/list`))}async getWindowsAndTabs(){return await this.callTool(`get_windows_and_tabs`)}async navigate(e,t){return await this.callTool(`chrome_navigate`,{url:e,...t})}async closeTabs(e){return await this.callTool(`chrome_close_tabs`,e)}async goBackOrForward(e=!1){return await this.callTool(`chrome_go_back_or_forward`,{isForward:e})}async screenshot(e){return await this.callTool(`chrome_screenshot`,e)}async networkCaptureStart(e){return await this.callTool(`chrome_network_capture_start`,e)}async networkCaptureStop(){return await this.callTool(`chrome_network_capture_stop`)}async networkDebuggerStart(e){return await this.callTool(`chrome_network_debugger_start`,{...e&&{url:e}})}async networkDebuggerStop(){return await this.callTool(`chrome_network_debugger_stop`)}async networkRequest(e,t){return await this.callTool(`chrome_network_request`,{url:e,...t})}async searchTabsContent(e){return await this.callTool(`search_tabs_content`,{query:e})}async getWebContent(e){return await this.callTool(`chrome_get_web_content`,e)}async getInteractiveElements(e){return await this.callTool(`chrome_get_interactive_elements`,e)}async clickElement(e){return await this.callTool(`chrome_click_element`,e)}async fillOrSelect(e,t){return await this.callTool(`chrome_fill_or_select`,{selector:e,value:t})}async keyboard(e,t){return await this.callTool(`chrome_keyboard`,{keys:e,...t})}async searchHistory(e){return await this.callTool(`chrome_history`,e)}async searchBookmarks(e){return await this.callTool(`chrome_bookmark_search`,e)}async addBookmark(e){return await this.callTool(`chrome_bookmark_add`,e)}async deleteBookmark(e){return await this.callTool(`chrome_bookmark_delete`,e)}async injectScript(e,t,n){return await this.callTool(`chrome_inject_script`,{jsScript:e,type:t,...n&&{url:n}})}async sendCommandToInjectScript(e,t,n){return await this.callTool(`chrome_send_command_to_inject_script`,{eventName:e,...t&&{payload:t},...n&&{tabId:n}})}async captureConsole(e){return await this.callTool(`chrome_console`,e)}reset(){this.sessionId=null,this.isInitialized=!1,this.requestId=1,this.log(`ğŸ”„ ä¼šè¯å·²é‡ç½®`)}getStatus(){return{sessionId:this.sessionId,isInitialized:this.isInitialized,requestCount:this.requestId,apiUrl:this.apiUrl}}isReady(){return this.isInitialized&&this.sessionId!==null}async parseResponse(e){let t=e.headers.get(`content-type`);if(t&&t.includes(`text/event-stream`)){let t=await e.text();return this.parseSSEResponse(t)}else{let t=await e.json();return t.error?(this.logError(`âŒ é”™è¯¯:`,t.error),{success:!1,error:t.error}):(this.log(`âœ… æˆåŠŸ:`,t.result),{success:!0,result:this.parseMCPContent(t.result)})}}parseSSEResponse(e){this.log(`ğŸ“¥ åŸå§‹å“åº”:`,e);let t=e.split(`
`),n=``;for(let e of t)if(e.startsWith(`data: `)){n=e.substring(6);break}if(!n)return this.logError(`âŒ æ— æ³•ä» SSE å“åº”ä¸­æå–æ•°æ®`),{success:!1,error:{code:-1,message:`No data in SSE response`}};let r=JSON.parse(n);return r.error?(this.logError(`âŒ é”™è¯¯:`,r.error),{success:!1,error:r.error}):(this.log(`âœ… æˆåŠŸ:`,r.result),{success:!0,result:this.parseMCPContent(r.result)})}parseMCPContent(e){return this.deepParseTextContent(e)}deepParseTextContent(e){if(e==null)return e;if(typeof e==`object`&&!Array.isArray(e)&&e.type===`text`&&typeof e.text==`string`)try{let t=JSON.parse(e.text);return this.deepParseTextContent(t)}catch{return e.text}if(typeof e==`object`&&!Array.isArray(e)&&Array.isArray(e.content)&&e.content.length>0){let t=e.content[0];if(t&&t.type===`text`&&typeof t.text==`string`)try{let e=JSON.parse(t.text);return e&&typeof e==`object`&&e.data?this.deepParseTextContent(e.data):this.deepParseTextContent(e)}catch{return t.text}}if(Array.isArray(e))return e.map(e=>this.deepParseTextContent(e));if(typeof e==`object`){let t={};for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=this.deepParseTextContent(e[n]));return t}return e}sleep(e){return new Promise(t=>setTimeout(t,e))}log(...e){this.enableLog&&console.log(...e)}logError(...e){this.enableLog&&console.error(...e)}};function Oi(e){return new Di(e)}var ki=class extends t{constructor(...e){super(...e),this.type=`initializeMCP`,this.label=`åˆå§‹åŒ–MCPæœåŠ¡`,this.description=`åˆå§‹åŒ– MCP å®¢æˆ·ç«¯æœåŠ¡ï¼Œåç»­èŠ‚ç‚¹å°†ä½¿ç”¨æ­¤æœåŠ¡`,this.category=`æµè§ˆå™¨ç®¡ç†`}defineInputs(){return[{id:`apiUrl`,name:`APIåœ°å€`,type:`string`,required:!1},{id:`enableLog`,name:`å¯ç”¨æ—¥å¿—`,type:`boolean`,required:!1}]}defineOutputs(){return[{id:`client`,name:`MCPå®¢æˆ·ç«¯`,type:`object`,description:`åˆå§‹åŒ–åçš„ MCP å®¢æˆ·ç«¯å®ä¾‹`},{id:`status`,name:`çŠ¶æ€ä¿¡æ¯`,type:`object`,description:`å®¢æˆ·ç«¯åˆå§‹åŒ–çŠ¶æ€`}]}getDefaultConfig(){return{apiUrl:`/api/mcp`,enableLog:!0}}async execute(e,t,n){throw Error(`InitializeMCPNode å¿…é¡»é€šè¿‡ run æ–¹æ³•è°ƒç”¨`)}async run(e,t,n){let r=Date.now(),i=Date.now();try{let a={...e};for(let[e,n]of Object.entries(t))n!=null&&(a[e]=n);let o=t.apiUrl||e.apiUrl||`/api/mcp`,s=t.enableLog===void 0?e.enableLog===void 0?!0:e.enableLog:t.enableLog,c=Oi({apiUrl:o,enableLog:s});if(!await c.initialize())throw Error(`MCP å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥`);n.mcpClient=c;let l=c.getStatus(),u={outputs:{client:c,status:{sessionId:l.sessionId,isInitialized:l.isInitialized,apiUrl:l.apiUrl}},raw:{client:c,status:l},summary:`MCP å®¢æˆ·ç«¯å·²åˆå§‹åŒ–ï¼ˆSession ID: ${l.sessionId||`N/A`}ï¼‰`},d=Date.now()-r,f=this.formatExecutionResult(u);return{duration:d,data:f,status:`success`,timestamp:i}}catch(e){return{duration:Date.now()-r,data:{outputs:{},raw:null},status:`error`,error:e.message||`æ‰§è¡Œå¤±è´¥`,timestamp:i}}}},Ai=class extends t{constructor(...e){super(...e),this.type=`navigate`,this.label=`å¯¼èˆªåˆ°URL`,this.description=`å¯¼èˆªåˆ°æŒ‡å®šçš„ URL åœ°å€`,this.category=`æµè§ˆå™¨ç®¡ç†`}defineInputs(){return[{id:`url`,name:`URL`,type:`string`,required:!0},{id:`tabId`,name:`æ ‡ç­¾é¡µID`,type:`number`,required:!1},{id:`waitForLoad`,name:`ç­‰å¾…åŠ è½½`,type:`boolean`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{url:`https://www.baidu.com`,waitForLoad:!0}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.url||e.url,a={};e.tabId&&(a.tabId=e.tabId),e.waitForLoad!==void 0&&(a.waitForLoad=e.waitForLoad);let o=await r.navigate(i,a);if(!o.success)throw Error(o.error?.message||`å¯¼èˆªå¤±è´¥`);let s=o.result;return{outputs:{result:s},raw:s,summary:i?`å·²å¯¼èˆªåˆ° ${i}`:void 0}}},ji=class extends t{constructor(...e){super(...e),this.type=`getWindowsAndTabs`,this.label=`è·å–çª—å£å’Œæ ‡ç­¾é¡µ`,this.description=`è·å–æ‰€æœ‰æµè§ˆå™¨çª—å£å’Œæ ‡ç­¾é¡µä¿¡æ¯`,this.category=`æµè§ˆå™¨ç®¡ç†`}defineInputs(){return[]}defineOutputs(){return[{id:`windows`,name:`çª—å£åˆ—è¡¨`,type:`array`}]}getDefaultConfig(){return{}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=await r.getWindowsAndTabs();if(!i.success)throw Error(i.error?.message||`è·å–çª—å£å’Œæ ‡ç­¾é¡µå¤±è´¥`);let a=i.result;return{outputs:{windows:a},raw:a,summary:Array.isArray(a)?`å…± ${a.length} ä¸ªçª—å£`:void 0}}},Mi=class extends t{constructor(...e){super(...e),this.type=`closeTabs`,this.label=`å…³é—­æ ‡ç­¾é¡µ`,this.description=`å…³é—­æŒ‡å®šçš„æ ‡ç­¾é¡µæˆ–çª—å£`,this.category=`æµè§ˆå™¨ç®¡ç†`}defineInputs(){return[{id:`tabIds`,name:`æ ‡ç­¾é¡µIDåˆ—è¡¨`,type:`array`,required:!1},{id:`windowIds`,name:`çª—å£IDåˆ—è¡¨`,type:`array`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.tabIds&&(i.tabIds=Array.isArray(e.tabIds)?e.tabIds:[e.tabIds]),e.windowIds&&(i.windowIds=Array.isArray(e.windowIds)?e.windowIds:[e.windowIds]);let a=await r.closeTabs(i);if(!a.success)throw Error(a.error?.message||`å…³é—­æ ‡ç­¾é¡µå¤±è´¥`);let o=a.result;return{outputs:{result:o},raw:o,summary:Array.isArray(i.tabIds)?`å·²å…³é—­ ${i.tabIds.length} ä¸ªæ ‡ç­¾`:void 0}}},Ni=class extends t{constructor(...e){super(...e),this.type=`goBackOrForward`,this.label=`å‰è¿›/åé€€`,this.description=`æµè§ˆå™¨å†å²è®°å½•å‰è¿›æˆ–åé€€`,this.category=`æµè§ˆå™¨ç®¡ç†`}defineInputs(){return[{id:`isForward`,name:`æ˜¯å¦å‰è¿›`,type:`boolean`,required:!0}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{isForward:!1}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.isForward??e.isForward??!1,a=await r.goBackOrForward(i);if(!a.success)throw Error(a.error?.message||`å†å²å¯¼èˆªå¤±è´¥`);let o=a.result;return{outputs:{result:o},raw:o,summary:i?`å‰è¿›ä¸€æ­¥`:`åé€€ä¸€æ­¥`}}},Pi=class extends t{constructor(...e){super(...e),this.type=`screenshot`,this.label=`æˆªå›¾`,this.description=`å¯¹å½“å‰é¡µé¢æˆ–æŒ‡å®šåŒºåŸŸè¿›è¡Œæˆªå›¾`,this.category=`æˆªå›¾å’Œè§†è§‰`}defineInputs(){return[{id:`fullPage`,name:`å…¨é¡µæˆªå›¾`,type:`boolean`,required:!1},{id:`quality`,name:`è´¨é‡`,type:`number`,required:!1},{id:`format`,name:`æ ¼å¼`,type:`string`,required:!1}]}defineOutputs(){return[{id:`screenshot`,name:`æˆªå›¾æ•°æ®`,type:`string`}]}getDefaultConfig(){return{fullPage:!1,quality:90,format:`png`}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.fullPage!==void 0&&(i.fullPage=e.fullPage),e.quality!==void 0&&(i.quality=e.quality),e.format&&(i.format=e.format);let a=await r.screenshot(i);if(!a.success)throw Error(a.error?.message||`æˆªå›¾å¤±è´¥`);let o=a.result;return{outputs:{screenshot:o},raw:o,summary:`æˆªå›¾å®Œæˆ`}}},Fi=class extends t{constructor(...e){super(...e),this.type=`networkCaptureStart`,this.label=`å¼€å§‹ç½‘ç»œæ•è·`,this.description=`å¼€å§‹ç›‘å¬ç½‘ç»œè¯·æ±‚`,this.category=`ç½‘ç»œç›‘æ§`}defineInputs(){return[{id:`filter`,name:`è¿‡æ»¤å™¨`,type:`string`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.filter&&(i.filter=e.filter);let a=await r.networkCaptureStart(i);if(!a.success)throw Error(a.error?.message||`å¼€å§‹ç½‘ç»œæ•è·å¤±è´¥`);let o=a.result;return{outputs:{result:o},raw:o,summary:`å·²å¼€å¯ç½‘ç»œæ•è·`}}},Ii=class extends t{constructor(...e){super(...e),this.type=`networkCaptureStop`,this.label=`åœæ­¢ç½‘ç»œæ•è·`,this.description=`åœæ­¢ç›‘å¬å¹¶è·å–æ•è·çš„ç½‘ç»œæ•°æ®`,this.category=`ç½‘ç»œç›‘æ§`}defineInputs(){return[]}defineOutputs(){return[{id:`requests`,name:`ç½‘ç»œè¯·æ±‚`,type:`array`}]}getDefaultConfig(){return{}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=await r.networkCaptureStop();if(!i.success)throw Error(i.error?.message||`åœæ­¢ç½‘ç»œæ•è·å¤±è´¥`);let a=i.result;return{outputs:{requests:a},raw:a,summary:Array.isArray(a)?`æ•è·åˆ° ${a.length} æ¡è¯·æ±‚`:void 0}}},Li=class extends t{constructor(...e){super(...e),this.type=`networkDebuggerStart`,this.label=`å¼€å§‹è°ƒè¯•å™¨æ•è·`,this.description=`å¼€å§‹ç›‘å¬ç½‘ç»œè¯·æ±‚ï¼ˆåŒ…å«å“åº”ä½“ï¼‰`,this.category=`ç½‘ç»œç›‘æ§`}defineInputs(){return[{id:`url`,name:`URL`,type:`string`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.url||e.url,a=await r.networkDebuggerStart(i);if(!a.success)throw Error(a.error?.message||`å¼€å§‹è°ƒè¯•å™¨æ•è·å¤±è´¥`);let o=a.result;return{outputs:{result:o},raw:o,summary:`å·²å¼€å¯è°ƒè¯•å™¨ç½‘ç»œæ•è·`}}},Ri=class extends t{constructor(...e){super(...e),this.type=`networkDebuggerStop`,this.label=`åœæ­¢è°ƒè¯•å™¨æ•è·`,this.description=`åœæ­¢ç›‘å¬å¹¶è·å–æ•è·çš„ç½‘ç»œæ•°æ®ï¼ˆå«å“åº”ä½“ï¼‰`,this.category=`ç½‘ç»œç›‘æ§`}defineInputs(){return[]}defineOutputs(){return[{id:`requests`,name:`ç½‘ç»œè¯·æ±‚`,type:`array`}]}getDefaultConfig(){return{}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=await r.networkDebuggerStop();if(!i.success)throw Error(i.error?.message||`åœæ­¢è°ƒè¯•å™¨æ•è·å¤±è´¥`);let a=i.result;return{outputs:{requests:a},raw:a,summary:Array.isArray(a)?`æ•è·åˆ° ${a.length} æ¡è°ƒè¯•è®°å½•`:void 0}}},zi=class extends t{constructor(...e){super(...e),this.type=`networkRequest`,this.label=`å‘é€HTTPè¯·æ±‚`,this.description=`å‘é€è‡ªå®šä¹‰ HTTP è¯·æ±‚`,this.category=`ç½‘ç»œç›‘æ§`}defineInputs(){return[{id:`url`,name:`URL`,type:`string`,required:!0},{id:`method`,name:`è¯·æ±‚æ–¹æ³•`,type:`string`,required:!1},{id:`headers`,name:`è¯·æ±‚å¤´`,type:`object`,required:!1},{id:`body`,name:`è¯·æ±‚ä½“`,type:`string`,required:!1}]}defineOutputs(){return[{id:`response`,name:`å“åº”`,type:`any`}]}getDefaultConfig(){return{url:`https://api.example.com`,method:`GET`}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.url||e.url,a={};e.method&&(a.method=e.method),e.headers&&(a.headers=e.headers),e.body&&(a.body=e.body);let o=await r.networkRequest(i,a);if(!o.success)throw Error(o.error?.message||`ç½‘ç»œè¯·æ±‚å¤±è´¥`);let s=o.result;return{outputs:{response:s},raw:s,summary:`${a.method||`GET`} ${i}`}}},Bi=class extends t{constructor(...e){super(...e),this.type=`searchTabsContent`,this.label=`æœç´¢æ ‡ç­¾é¡µå†…å®¹`,this.description=`è·¨æ ‡ç­¾é¡µè¿›è¡Œè¯­ä¹‰æœç´¢`,this.category=`å†…å®¹åˆ†æ`}defineInputs(){return[{id:`query`,name:`æœç´¢æŸ¥è¯¢`,type:`string`,required:!0}]}defineOutputs(){return[{id:`results`,name:`æœç´¢ç»“æœ`,type:`array`}]}getDefaultConfig(){return{query:``}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.query||e.query;if(!i)throw Error(`æœç´¢æŸ¥è¯¢ä¸èƒ½ä¸ºç©º`);let a=await r.searchTabsContent(i);if(!a.success)throw Error(a.error?.message||`æœç´¢æ ‡ç­¾é¡µå†…å®¹å¤±è´¥`);let o=a.result;return{outputs:{results:o},raw:o,summary:Array.isArray(o)?`åŒ¹é… ${o.length} æ¡è®°å½•`:void 0}}},Vi=class extends t{constructor(...e){super(...e),this.type=`getWebContent`,this.label=`è·å–ç½‘é¡µå†…å®¹`,this.description=`è·å–å½“å‰é¡µé¢çš„æ–‡æœ¬å†…å®¹`,this.category=`å†…å®¹åˆ†æ`}defineInputs(){return[{id:`selector`,name:`é€‰æ‹©å™¨`,type:`string`,required:!1},{id:`includeHTML`,name:`åŒ…å«HTML`,type:`boolean`,required:!1}]}defineOutputs(){return[{id:`content`,name:`å†…å®¹`,type:`string`}]}getDefaultConfig(){return{includeHTML:!1}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.selector&&(i.selector=e.selector),e.includeHTML!==void 0&&(i.includeHTML=e.includeHTML);let a=await r.getWebContent(i);if(!a.success)throw Error(a.error?.message||`è·å–ç½‘é¡µå†…å®¹å¤±è´¥`);let o=a.result;return{outputs:{content:o},raw:o,summary:e.selector?`å·²è·å– ${e.selector} åŒ¹é…å†…å®¹`:`å·²è·å–é¡µé¢å†…å®¹`}}},Hi=class extends t{constructor(...e){super(...e),this.type=`getInteractiveElements`,this.label=`è·å–å¯äº¤äº’å…ƒç´ `,this.description=`è·å–é¡µé¢ä¸Šçš„å¯äº¤äº’å…ƒç´ `,this.category=`å†…å®¹åˆ†æ`}defineInputs(){return[{id:`textQuery`,name:`æ–‡æœ¬æŸ¥è¯¢`,type:`string`,required:!1},{id:`selector`,name:`é€‰æ‹©å™¨`,type:`string`,required:!1},{id:`includeCoordinates`,name:`åŒ…å«åæ ‡`,type:`boolean`,required:!1}]}defineOutputs(){return[{id:`elements`,name:`å…ƒç´ åˆ—è¡¨`,type:`array`}]}getDefaultConfig(){return{includeCoordinates:!0}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.textQuery&&(i.textQuery=e.textQuery),e.selector&&(i.selector=e.selector),e.includeCoordinates!==void 0&&(i.includeCoordinates=e.includeCoordinates);let a=await r.getInteractiveElements(i);if(!a.success)throw Error(a.error?.message||`è·å–å¯äº¤äº’å…ƒç´ å¤±è´¥`);let o=a.result;return{outputs:{elements:o},raw:o,summary:Array.isArray(o)?`æ£€æµ‹åˆ° ${o.length} ä¸ªå…ƒç´ `:void 0}}},Ui=class extends t{constructor(...e){super(...e),this.type=`clickElement`,this.label=`ç‚¹å‡»å…ƒç´ `,this.description=`ç‚¹å‡»é¡µé¢ä¸Šçš„å…ƒç´ æˆ–åæ ‡`,this.category=`äº¤äº’æ“ä½œ`}defineInputs(){return[{id:`selector`,name:`é€‰æ‹©å™¨`,type:`string`,required:!1},{id:`coordinates`,name:`åæ ‡`,type:`object`,required:!1},{id:`waitForNavigation`,name:`ç­‰å¾…å¯¼èˆª`,type:`boolean`,required:!1},{id:`timeout`,name:`è¶…æ—¶æ—¶é—´`,type:`number`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{waitForNavigation:!1,timeout:5e3}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};if(e.selector&&(i.selector=e.selector),e.coordinates&&(i.coordinates=e.coordinates),e.waitForNavigation!==void 0&&(i.waitForNavigation=e.waitForNavigation),e.timeout!==void 0&&(i.timeout=e.timeout),!i.selector&&!i.coordinates)throw Error(`å¿…é¡»æä¾›é€‰æ‹©å™¨æˆ–åæ ‡`);let a=await r.clickElement(i);if(!a.success)throw Error(a.error?.message||`ç‚¹å‡»å…ƒç´ å¤±è´¥`);let o=a.result;return{outputs:{result:o},raw:o,summary:i.selector?`ç‚¹å‡»å…ƒç´  ${i.selector}`:`ç‚¹å‡»æŒ‡å®šåæ ‡`}}},Wi=class extends t{constructor(...e){super(...e),this.type=`fillOrSelect`,this.label=`å¡«å……/é€‰æ‹©`,this.description=`å¡«å……è¡¨å•æˆ–é€‰æ‹©é€‰é¡¹`,this.category=`äº¤äº’æ“ä½œ`}defineInputs(){return[{id:`selector`,name:`é€‰æ‹©å™¨`,type:`string`,required:!0},{id:`value`,name:`å€¼`,type:`string`,required:!0}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{selector:``,value:``}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.selector||e.selector,a=t.value||e.value;if(!i)throw Error(`é€‰æ‹©å™¨ä¸èƒ½ä¸ºç©º`);if(!a)throw Error(`å€¼ä¸èƒ½ä¸ºç©º`);let o=await r.fillOrSelect(i,a);if(!o.success)throw Error(o.error?.message||`å¡«å……æˆ–é€‰æ‹©å¤±è´¥`);let s=o.result;return{outputs:{result:s},raw:s,summary:`å·²å¡«å…… ${i}`}}},Gi=class extends t{constructor(...e){super(...e),this.type=`keyboard`,this.label=`é”®ç›˜è¾“å…¥`,this.description=`æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥`,this.category=`äº¤äº’æ“ä½œ`}defineInputs(){return[{id:`keys`,name:`æŒ‰é”®`,type:`string`,required:!0},{id:`selector`,name:`é€‰æ‹©å™¨`,type:`string`,required:!1},{id:`delay`,name:`å»¶è¿Ÿ(ms)`,type:`number`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{keys:``,delay:0}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.keys||e.keys;if(!i)throw Error(`æŒ‰é”®ä¸èƒ½ä¸ºç©º`);let a={};e.selector&&(a.selector=e.selector),e.delay!==void 0&&(a.delay=e.delay);let o=await r.keyboard(i,a);if(!o.success)throw Error(o.error?.message||`é”®ç›˜è¾“å…¥å¤±è´¥`);let s=o.result;return{outputs:{result:s},raw:s,summary:`æ¨¡æ‹ŸæŒ‰é”®: ${i}`}}},Ki=class extends t{constructor(...e){super(...e),this.type=`searchHistory`,this.label=`æœç´¢å†å²è®°å½•`,this.description=`æœç´¢æµè§ˆå™¨å†å²è®°å½•`,this.category=`æ•°æ®ç®¡ç†`}defineInputs(){return[{id:`query`,name:`æœç´¢æŸ¥è¯¢`,type:`string`,required:!1},{id:`maxResults`,name:`æœ€å¤§ç»“æœæ•°`,type:`number`,required:!1},{id:`startTime`,name:`å¼€å§‹æ—¶é—´`,type:`number`,required:!1},{id:`endTime`,name:`ç»“æŸæ—¶é—´`,type:`number`,required:!1}]}defineOutputs(){return[{id:`history`,name:`å†å²è®°å½•`,type:`array`}]}getDefaultConfig(){return{maxResults:100}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.query&&(i.query=e.query),e.maxResults!==void 0&&(i.maxResults=e.maxResults),e.startTime!==void 0&&(i.startTime=e.startTime),e.endTime!==void 0&&(i.endTime=e.endTime);let a=await r.searchHistory(i);if(!a.success)throw Error(a.error?.message||`æœç´¢å†å²è®°å½•å¤±è´¥`);let o=a.result;return{outputs:{history:o},raw:o,summary:Array.isArray(o)?`æ‰¾åˆ° ${o.length} æ¡å†å²è®°å½•`:void 0}}},qi=class extends t{constructor(...e){super(...e),this.type=`searchBookmarks`,this.label=`æœç´¢ä¹¦ç­¾`,this.description=`æœç´¢æµè§ˆå™¨ä¹¦ç­¾`,this.category=`æ•°æ®ç®¡ç†`}defineInputs(){return[{id:`query`,name:`æœç´¢æŸ¥è¯¢`,type:`string`,required:!1}]}defineOutputs(){return[{id:`bookmarks`,name:`ä¹¦ç­¾åˆ—è¡¨`,type:`array`}]}getDefaultConfig(){return{}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.query&&(i.query=e.query);let a=await r.searchBookmarks(i);if(!a.success)throw Error(a.error?.message||`æœç´¢ä¹¦ç­¾å¤±è´¥`);let o=a.result;return{outputs:{bookmarks:o},raw:o,summary:Array.isArray(o)?`æ‰¾åˆ° ${o.length} ä¸ªä¹¦ç­¾`:void 0}}},Ji=class extends t{constructor(...e){super(...e),this.type=`addBookmark`,this.label=`æ·»åŠ ä¹¦ç­¾`,this.description=`æ·»åŠ æ–°ä¹¦ç­¾`,this.category=`æ•°æ®ç®¡ç†`}defineInputs(){return[{id:`title`,name:`æ ‡é¢˜`,type:`string`,required:!1},{id:`url`,name:`URL`,type:`string`,required:!1}]}defineOutputs(){return[{id:`bookmark`,name:`ä¹¦ç­¾`,type:`object`}]}getDefaultConfig(){return{}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.title&&(i.title=e.title),e.url&&(i.url=e.url);let a=await r.addBookmark(i);if(!a.success)throw Error(a.error?.message||`æ·»åŠ ä¹¦ç­¾å¤±è´¥`);let o=a.result;return{outputs:{bookmark:o},raw:o,summary:i.title?`å·²æ·»åŠ ä¹¦ç­¾ã€Œ${i.title}ã€`:`æ·»åŠ ä¹¦ç­¾æˆåŠŸ`}}},Yi=class extends t{constructor(...e){super(...e),this.type=`deleteBookmark`,this.label=`åˆ é™¤ä¹¦ç­¾`,this.description=`åˆ é™¤æŒ‡å®šä¹¦ç­¾`,this.category=`æ•°æ®ç®¡ç†`}defineInputs(){return[{id:`bookmarkId`,name:`ä¹¦ç­¾ID`,type:`string`,required:!0}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{bookmarkId:``}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.bookmarkId||e.bookmarkId;if(!i)throw Error(`ä¹¦ç­¾IDä¸èƒ½ä¸ºç©º`);let a=await r.deleteBookmark({bookmarkId:i});if(!a.success)throw Error(a.error?.message||`åˆ é™¤ä¹¦ç­¾å¤±è´¥`);let o=a.result;return{outputs:{result:o},raw:o,summary:`å·²åˆ é™¤ä¹¦ç­¾ ${i}`}}},Xi=class extends t{constructor(...e){super(...e),this.type=`injectScript`,this.label=`æ³¨å…¥è„šæœ¬`,this.description=`å‘ç½‘é¡µæ³¨å…¥ JavaScript ä»£ç `,this.category=`é«˜çº§åŠŸèƒ½`}defineInputs(){return[{id:`jsScript`,name:`JSä»£ç `,type:`string`,required:!0},{id:`type`,name:`æ‰§è¡Œç¯å¢ƒ`,type:`string`,required:!0},{id:`url`,name:`URL`,type:`string`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{jsScript:`console.log('Hello World');`,type:`ISOLATED`}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.jsScript||e.jsScript,a=t.type||e.type;if(!i)throw Error(`JSä»£ç ä¸èƒ½ä¸ºç©º`);if(a!==`ISOLATED`&&a!==`MAIN`)throw Error(`æ‰§è¡Œç¯å¢ƒå¿…é¡»æ˜¯ ISOLATED æˆ– MAIN`);let o=t.url||e.url,s=await r.injectScript(i,a,o);if(!s.success)throw Error(s.error?.message||`æ³¨å…¥è„šæœ¬å¤±è´¥`);let c=s.result;return{outputs:{result:c},raw:c,summary:`è„šæœ¬å·²æ³¨å…¥(${a})`}}},Zi=class extends t{constructor(...e){super(...e),this.type=`sendCommandToInjectScript`,this.label=`å‘é€å‘½ä»¤åˆ°è„šæœ¬`,this.description=`å‘æ³¨å…¥çš„è„šæœ¬å‘é€å‘½ä»¤`,this.category=`é«˜çº§åŠŸèƒ½`}defineInputs(){return[{id:`eventName`,name:`äº‹ä»¶å`,type:`string`,required:!0},{id:`payload`,name:`æ•°æ®`,type:`string`,required:!1},{id:`tabId`,name:`æ ‡ç­¾é¡µID`,type:`number`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{eventName:``}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i=t.eventName||e.eventName;if(!i)throw Error(`äº‹ä»¶åä¸èƒ½ä¸ºç©º`);let a=t.payload||e.payload,o=t.tabId||e.tabId,s=await r.sendCommandToInjectScript(i,a,o);if(!s.success)throw Error(s.error?.message||`å‘é€å‘½ä»¤å¤±è´¥`);let c=s.result;return{outputs:{result:c},raw:c,summary:`å·²å‘é€äº‹ä»¶ ${i}`}}},Qi=class extends t{constructor(...e){super(...e),this.type=`captureConsole`,this.label=`æ•è·æ§åˆ¶å°`,this.description=`æ•è·æµè§ˆå™¨æ§åˆ¶å°è¾“å‡º`,this.category=`é«˜çº§åŠŸèƒ½`}defineInputs(){return[{id:`url`,name:`URL`,type:`string`,required:!1},{id:`includeExceptions`,name:`åŒ…å«å¼‚å¸¸`,type:`boolean`,required:!1},{id:`maxMessages`,name:`æœ€å¤§æ¶ˆæ¯æ•°`,type:`number`,required:!1}]}defineOutputs(){return[{id:`console`,name:`æ§åˆ¶å°è¾“å‡º`,type:`array`}]}getDefaultConfig(){return{includeExceptions:!0,maxMessages:100}}async execute(e,t,n){let r=n.mcpClient;if(!r)throw Error(`MCP å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆä½¿ç”¨åˆå§‹åŒ–MCPæœåŠ¡èŠ‚ç‚¹`);let i={};e.url&&(i.url=e.url),e.includeExceptions!==void 0&&(i.includeExceptions=e.includeExceptions),e.maxMessages!==void 0&&(i.maxMessages=e.maxMessages);let a=await r.captureConsole(i);if(!a.success)throw Error(a.error?.message||`æ•è·æ§åˆ¶å°å¤±è´¥`);let o=a.result;return{outputs:{console:o},raw:o,summary:Array.isArray(o)?`æ•è· ${o.length} æ¡æ§åˆ¶å°æ¶ˆæ¯`:void 0}}},$i=class extends t{constructor(...e){super(...e),this.type=`delay`,this.label=`å»¶è¿Ÿ`,this.description=`ç­‰å¾…æŒ‡å®šæ—¶é—´åç»§ç»­æ‰§è¡Œ`,this.category=`æµç¨‹æ§åˆ¶`}defineInputs(){return[{id:`delay`,name:`å»¶è¿Ÿæ—¶é—´(ms)`,type:`number`,description:`å»¶è¿Ÿçš„æ¯«ç§’æ•°ï¼Œé»˜è®¤1000ms`}]}defineOutputs(){return[{id:`output`,name:`è¾“å‡º`,type:`any`,description:`å»¶è¿Ÿåè¾“å‡ºçš„æ•°æ®`}]}getDefaultConfig(){return{delay:1e3,passthrough:!0}}getStyleConfig(){return{}}async execute(e,t,n){let r=e.delay||1e3;await new Promise(e=>setTimeout(e,r));let i={delayed:!0};return{outputs:{output:i},raw:i,summary:`å·²å»¶è¿Ÿ ${r}ms`}}},ea=class extends t{constructor(...e){super(...e),this.type=`merge`,this.label=`å˜é‡èšåˆ`,this.description=`å°†å¤šä¸ªè¾“å…¥åˆå¹¶ä¸ºä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„`,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{id:`input1`,name:`è¾“å…¥1`,type:`any`,required:!1},{id:`input2`,name:`è¾“å…¥2`,type:`any`,required:!1},{id:`input3`,name:`è¾“å…¥3`,type:`any`,required:!1},{id:`input4`,name:`è¾“å…¥4`,type:`any`,required:!1},{id:`input5`,name:`è¾“å…¥5`,type:`any`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{mode:`object`,keys:[`key1`,`key2`,`key3`,`key4`,`key5`]}}async execute(e,t,n){let r=e.mode||`object`,i=e.keys||[`key1`,`key2`,`key3`,`key4`,`key5`];if(r===`object`){let e={};for(let n=1;n<=5;n++){let r=`input${n}`,a=t[r];if(a!==void 0){let t=i[n-1]||r;e[t]=a}}return{outputs:{result:e},raw:e,summary:`å·²åˆå¹¶ ${Object.keys(e).length} ä¸ªå­—æ®µ`}}else if(r===`array`){let e=[];for(let n=1;n<=5;n++){let r=`input${n}`,i=t[r];i!==void 0&&e.push(i)}return{outputs:{result:e},raw:e,summary:`å·²æ”¶é›† ${e.length} ä¸ªè¾“å…¥`}}throw Error(`ä¸æ”¯æŒçš„æ¨¡å¼: ${r}`)}},ta=class extends t{constructor(...e){super(...e),this.type=`code`,this.label=`ä»£ç æ‰§è¡Œ`,this.description=`æ‰§è¡Œè‡ªå®šä¹‰ JavaScript ä»£ç `,this.category=`æ•°æ®å¤„ç†`}defineInputs(){return[{id:`input1`,name:`è¾“å…¥1`,type:`any`,required:!1},{id:`input2`,name:`è¾“å…¥2`,type:`any`,required:!1},{id:`input3`,name:`è¾“å…¥3`,type:`any`,required:!1}]}defineOutputs(){return[{id:`result`,name:`ç»“æœ`,type:`any`}]}getDefaultConfig(){return{code:`// å¯ä»¥ä½¿ç”¨çš„å˜é‡:
// - input1, input2, input3: è¾“å…¥æ•°æ®
//
// ç¤ºä¾‹ 1: ç®€å•è®¡ç®—
// return input1 + input2;
//
// ç¤ºä¾‹ 2: å¯¹è±¡å¤„ç†
// return {
//   sum: input1 + input2,
//   product: input1 * input2,
//   message: 'è®¡ç®—å®Œæˆ'
// };
//
// ç¤ºä¾‹ 3: æ•°ç»„å¤„ç†
// return input1.map(item => item * 2);

return input1;`}}async execute(e,t,n){let r=e.code||`return null;`,i=t.input1,a=t.input2,o=t.input3;try{let e={input1:i,input2:a,input3:o};e.JSON=JSON,e.Math=Math,e.Date=Date,e.console=console;let t=Object.keys(e),n=Object.values(e),s=Function(...t,r)(...n);if(s instanceof Promise){let e=await s;return{outputs:{result:e},raw:e}}return{outputs:{result:s},raw:s}}catch(e){throw Error(`ä»£ç æ‰§è¡Œé”™è¯¯: ${e.message}`)}}};let na={browser:{initializeMCP:new ki,navigate:new Ai,getWindowsAndTabs:new ji,closeTabs:new Mi,goBackOrForward:new Ni},screenshot:{screenshot:new Pi},network:{networkCaptureStart:new Fi,networkCaptureStop:new Ii,networkDebuggerStart:new Li,networkDebuggerStop:new Ri,networkRequest:new zi},content:{searchTabsContent:new Bi,getWebContent:new Vi,getInteractiveElements:new Hi},interaction:{clickElement:new Ui,fillOrSelect:new Wi,keyboard:new Gi},data:{searchHistory:new Ki,searchBookmarks:new qi,addBookmark:new Ji,deleteBookmark:new Yi},advanced:{injectScript:new Xi,sendCommandToInjectScript:new Zi,captureConsole:new Qi},flow:{delay:new $i},transform:{merge:new ea,code:new ta}};function ra(){let e={};return Object.values(na).forEach(t=>{Object.values(t).forEach(t=>{e[t.type]=t})}),e}var ia=class extends n{constructor(){super(ra())}};let aa=[new ui,new ia],$=new Map;function oa(){aa.forEach(e=>{e.getAllNodes().forEach(e=>{$.set(e.type,e)})}),console.log(`[Worker] å·²åŠ è½½ ${$.size} ä¸ªèŠ‚ç‚¹`)}function sa(e){return $.get(e)}function ca(){let e=[];return $.forEach(t=>{let n=t.createNodeData();e.push({type:t.type,label:t.label,description:t.description,category:t.category,inputs:n.inputs,outputs:n.outputs,defaultConfig:n.config})}),e}function la(){return{emit(e,t){let n={type:`WORKFLOW_EVENT`,payload:{eventType:e,eventData:t}};self.postMessage(n)},on(){},off(){}}}async function ua(e,t,n,r){try{let i=la(),a=await fi({nodes:n,edges:r,nodeFactory:sa,emitter:i,executionId:e,workflowId:t});console.log(`[Worker] å·¥ä½œæµæ‰§è¡Œå®Œæˆ: ${e}`,a)}catch(t){console.error(`[Worker] å·¥ä½œæµæ‰§è¡Œå¤±è´¥: ${e}`,t);let n={type:`ERROR`,payload:{message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}};self.postMessage(n)}}self.addEventListener(`message`,async e=>{let t=e.data;switch(t.type){case`INIT`:try{oa();let e=ca(),t={type:`INITIALIZED`,payload:{nodeMetadata:e}};self.postMessage(t),console.log(`[Worker] åˆå§‹åŒ–å®Œæˆï¼Œå·²å‘é€ ${e.length} ä¸ªèŠ‚ç‚¹å…ƒæ•°æ®`)}catch(e){console.error(`[Worker] åˆå§‹åŒ–å¤±è´¥`,e);let t={type:`ERROR`,payload:{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}};self.postMessage(t)}break;case`EXECUTE_WORKFLOW`:{let{executionId:e,workflowId:n,nodes:r,edges:i}=t.payload;console.log(`[Worker] æ”¶åˆ°æ‰§è¡Œè¯·æ±‚: ${e}`,{nodes:r,edges:i}),ua(e,n,r,i);break}case`REGISTER_NODES`:console.log(`[Worker] åŠ¨æ€èŠ‚ç‚¹æ³¨å†ŒåŠŸèƒ½å°šæœªå®ç°`);break;default:console.warn(`[Worker] æœªçŸ¥æ¶ˆæ¯ç±»å‹`,t)}}),console.log(`[Worker] å·¥ä½œæµæ‰§è¡Œ Worker å·²å¯åŠ¨`)})();